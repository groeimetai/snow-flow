---
import BaseLayout from '../../layouts/BaseLayout.astro';
import { getLangFromUrl, useTranslations, type Lang } from '../../i18n/utils';
import mcpToolsData from '../../data/mcp-tools.json';

export function getStaticPaths() {
  return [
    { params: { lang: 'en' } },
    { params: { lang: 'nl' } }
  ];
}

const lang = getLangFromUrl(Astro.url) as Lang;
const t = useTranslations(lang);

const title = lang === 'en' ? 'MCP Tools Reference | Snow-Flow' : 'MCP Tools Referentie | Snow-Flow';
const description = lang === 'en'
  ? `Complete reference of ${mcpToolsData.totalTools}+ MCP tools for ServiceNow development across ${mcpToolsData.totalCategories} categories.`
  : `Complete referentie van ${mcpToolsData.totalTools}+ MCP tools voor ServiceNow ontwikkeling verdeeld over ${mcpToolsData.totalCategories} categorieÃ«n.`;

// Category icons mapping
const categoryIcons: Record<string, string> = {
  'advanced': 'ðŸ§ ',
  'asset-management': 'ðŸ“¦',
  'automation': 'âš¡',
  'cmdb': 'ðŸŒ',
  'core-operations': 'âš™ï¸',
  'development': 'ðŸ—ï¸',
  'integration': 'ðŸ”—',
  'itsm': 'ðŸŽ«',
  'ml-analytics': 'ðŸ¤–',
  'performance-analytics': 'ðŸ“ˆ',
  'reporting': 'ðŸ“Š',
  'security': 'ðŸ”’',
  'ui-builder': 'ðŸŽ¨',
  'ui-frameworks': 'ðŸ–¼ï¸',
  'workspace': 'ðŸ’¼'
};

// Transform data for display
const categories = mcpToolsData.categories.map(cat => ({
  id: cat.id,
  name: cat.name,
  icon: categoryIcons[cat.id] || 'ðŸ”§',
  description: lang === 'en' ? cat.description.en : cat.description.nl,
  toolCount: cat.toolCount,
  readCount: cat.readCount,
  writeCount: cat.writeCount,
  tools: cat.tools
}));

const totalTools = mcpToolsData.totalTools;
const totalRead = categories.reduce((sum, cat) => sum + cat.readCount, 0);
const totalWrite = categories.reduce((sum, cat) => sum + cat.writeCount, 0);
---

<BaseLayout title={title} description={description}>
    <!-- Background Effects -->
    <div class="bg-grid"></div>
    <div class="bg-gradient"></div>

    <!-- Hero -->
    <section class="reference-hero">
        <div class="container">
            <div class="hero-badge">
                <span class="pulse"></span>
                {totalTools}+ MCP Tools
            </div>
            <h1>{lang === 'en' ? 'MCP Tools Reference' : 'MCP Tools Referentie'}</h1>
            <p class="hero-subtitle">
                {lang === 'en'
                    ? `Complete reference of all Snow-Flow MCP tools across ${categories.length} categories for comprehensive ServiceNow development.`
                    : `Complete referentie van alle Snow-Flow MCP tools verdeeld over ${categories.length} categorieÃ«n.`}
            </p>
        </div>
    </section>

    <!-- Search -->
    <section class="search-section">
        <div class="container">
            <div class="search-box">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="11" cy="11" r="8"></circle>
                    <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
                </svg>
                <input type="text" id="tool-search" placeholder={lang === 'en' ? 'Search tools or servers...' : 'Zoek tools of servers...'}>
            </div>
        </div>
    </section>

    <!-- Stats -->
    <section class="stats-section">
        <div class="container">
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-number">{totalTools}+</div>
                    <div class="stat-label">MCP Tools</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">{categories.length}</div>
                    <div class="stat-label">{lang === 'en' ? 'Categories' : 'CategorieÃ«n'}</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">{totalRead}</div>
                    <div class="stat-label">{lang === 'en' ? 'Read Tools' : 'Lees Tools'}</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">{totalWrite}</div>
                    <div class="stat-label">{lang === 'en' ? 'Write Tools' : 'Schrijf Tools'}</div>
                </div>
            </div>
        </div>
    </section>

    <!-- Categories -->
    <section class="servers-section">
        <div class="container">
            <div class="servers-list">
                {categories.map((category) => (
                    <div class="server-section" data-server={category.id}>
                        <div class="server-header">
                            <span class="server-icon">{category.icon}</span>
                            <div>
                                <h2>{category.name}</h2>
                                <p>{category.description}</p>
                            </div>
                            <div class="tool-badges">
                                <span class="tool-badge">{category.toolCount} tools</span>
                                <span class="tool-badge read-badge">{category.readCount} read</span>
                                <span class="tool-badge write-badge">{category.writeCount} write</span>
                            </div>
                        </div>
                        <div class="tools-grid">
                            {category.tools.map((tool) => (
                                <div class="tool-card" data-tool={tool.name.toLowerCase()} data-permission={tool.permission}>
                                    <code>{tool.name}</code>
                                    <span class={`permission-badge ${tool.permission}`}>{tool.permission}</span>
                                </div>
                            ))}
                        </div>
                    </div>
                ))}
            </div>
        </div>
    </section>

    <!-- CTA -->
    <section class="cta-section">
        <div class="container">
            <h2>{lang === 'en' ? 'Get Started' : 'Aan de Slag'}</h2>
            <p>{lang === 'en' ? 'Install Snow-Flow and start building.' : 'Installeer Snow-Flow en begin met bouwen.'}</p>
            <div class="cta-buttons">
                <a href="https://github.com/groeimetai/snow-flow" class="btn btn-primary">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M12 0C5.37 0 0 5.37 0 12c0 5.31 3.435 9.795 8.205 11.385.6.105.825-.255.825-.57 0-.285-.015-1.23-.015-2.235-3.015.555-3.795-.735-4.035-1.41-.135-.345-.72-1.41-1.23-1.695-.42-.225-1.02-.78-.015-.795.945-.015 1.62.87 1.845 1.23 1.08 1.815 2.805 1.305 3.495.99.105-.78.42-1.305.765-1.605-2.67-.3-5.46-1.335-5.46-5.925 0-1.305.465-2.385 1.23-3.225-.12-.3-.54-1.53.12-3.18 0 0 1.005-.315 3.3 1.23.96-.27 1.98-.405 3-.405s2.04.135 3 .405c2.295-1.56 3.3-1.23 3.3-1.23.66 1.65.24 2.88.12 3.18.765.84 1.23 1.905 1.23 3.225 0 4.605-2.805 5.625-5.475 5.925.435.375.81 1.095.81 2.22 0 1.605-.015 2.895-.015 3.3 0 .315.225.69.825.57A12.02 12.02 0 0024 12c0-6.63-5.37-12-12-12z"/>
                    </svg>
                    GitHub
                </a>
                <a href={`/${lang}/docs`} class="btn btn-secondary">
                    {lang === 'en' ? 'Documentation' : 'Documentatie'}
                </a>
            </div>
        </div>
    </section>

    <!-- JSON-LD -->
    <script type="application/ld+json" set:html={JSON.stringify({
        "@context": "https://schema.org",
        "@type": "ItemList",
        "name": "Snow-Flow MCP Tools",
        "description": description,
        "numberOfItems": totalTools,
        "itemListElement": categories.map((category, index) => ({
            "@type": "ListItem",
            "position": index + 1,
            "name": category.name,
            "description": category.description
        }))
    })} />
</BaseLayout>

<style>
    /* Hero */
    .reference-hero {
        padding: 10rem 0 3rem;
        text-align: center;
        position: relative;
        z-index: 1;
    }

    .reference-hero h1 {
        font-size: 3rem;
        font-weight: 800;
        margin-bottom: 1rem;
        background: linear-gradient(135deg, #FFFFFF 0%, var(--accent-cyan) 100%);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
    }

    .hero-badge {
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        padding: 0.5rem 1rem;
        background: rgba(0, 217, 255, 0.1);
        border: 1px solid rgba(0, 217, 255, 0.3);
        border-radius: 100px;
        font-size: 0.875rem;
        font-weight: 600;
        color: var(--accent-cyan);
        margin-bottom: 1.5rem;
    }

    .pulse {
        width: 8px;
        height: 8px;
        background: var(--accent-cyan);
        border-radius: 50%;
        animation: pulse 2s infinite;
    }

    @keyframes pulse {
        0%, 100% { opacity: 1; }
        50% { opacity: 0.5; }
    }

    .hero-subtitle {
        color: var(--text-secondary);
        font-size: 1.25rem;
        max-width: 700px;
        margin: 0 auto;
        line-height: 1.7;
    }

    /* Search */
    .search-section {
        padding: 0 0 2rem;
        position: relative;
        z-index: 1;
    }

    .search-box {
        display: flex;
        align-items: center;
        gap: 1rem;
        max-width: 600px;
        margin: 0 auto;
        padding: 1rem 1.5rem;
        background: var(--bg-card);
        border: 1px solid var(--border-subtle);
        border-radius: 12px;
        transition: border-color 0.3s;
    }

    .search-box:focus-within {
        border-color: var(--accent-cyan);
    }

    .search-box svg {
        color: var(--text-muted);
    }

    .search-box input {
        flex: 1;
        background: none;
        border: none;
        color: var(--text-primary);
        font-size: 1rem;
        outline: none;
    }

    .search-box input::placeholder {
        color: var(--text-muted);
    }

    /* Stats */
    .stats-section {
        padding: 2rem 0;
        position: relative;
        z-index: 1;
    }

    .stats-grid {
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        gap: 1rem;
    }

    @media (max-width: 768px) {
        .stats-grid {
            grid-template-columns: repeat(2, 1fr);
        }
    }

    .stat-card {
        background: var(--bg-card);
        border: 1px solid var(--border-subtle);
        border-radius: 12px;
        padding: 1.25rem;
        text-align: center;
    }

    .stat-number {
        font-size: 1.75rem;
        font-weight: 800;
        color: var(--accent-cyan);
    }

    .stat-label {
        color: var(--text-secondary);
        font-size: 0.8rem;
    }

    /* Servers */
    .servers-section {
        padding: 2rem 0 4rem;
        position: relative;
        z-index: 1;
    }

    .servers-list {
        display: flex;
        flex-direction: column;
        gap: 2rem;
    }

    .server-section {
        background: var(--bg-card);
        border: 1px solid var(--border-subtle);
        border-radius: 16px;
        padding: 1.5rem;
        transition: border-color 0.3s;
    }

    .server-section:hover {
        border-color: rgba(0, 217, 255, 0.3);
    }

    .server-header {
        display: flex;
        align-items: center;
        gap: 1rem;
        margin-bottom: 1.25rem;
        flex-wrap: wrap;
    }

    .server-icon {
        font-size: 2rem;
    }

    .server-header h2 {
        font-size: 1.25rem;
        font-weight: 700;
        margin: 0;
        color: var(--text-primary);
    }

    .server-header p {
        margin: 0;
        color: var(--text-secondary);
        font-size: 0.875rem;
    }

    .tool-badges {
        display: flex;
        gap: 0.5rem;
        margin-left: auto;
        flex-wrap: wrap;
    }

    .tool-badge {
        background: rgba(0, 217, 255, 0.1);
        color: var(--accent-cyan);
        padding: 0.375rem 0.875rem;
        border-radius: 100px;
        font-size: 0.75rem;
        font-weight: 600;
    }

    .tool-badge.read-badge {
        background: rgba(34, 197, 94, 0.1);
        color: #22c55e;
    }

    .tool-badge.write-badge {
        background: rgba(249, 115, 22, 0.1);
        color: #f97316;
    }

    .tools-grid {
        display: flex;
        flex-wrap: wrap;
        gap: 0.5rem;
    }

    .tool-card {
        background: var(--bg-secondary);
        border: 1px solid var(--border-subtle);
        border-radius: 6px;
        padding: 0.5rem 0.75rem;
        transition: all 0.2s ease;
    }

    .tool-card:hover {
        border-color: var(--accent-cyan);
        background: rgba(0, 217, 255, 0.05);
    }

    .tool-card {
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }

    .tool-card code {
        font-family: var(--font-mono);
        font-size: 0.8rem;
        color: var(--accent-cyan);
    }

    .permission-badge {
        font-size: 0.6rem;
        padding: 0.15rem 0.4rem;
        border-radius: 4px;
        font-weight: 600;
        text-transform: uppercase;
    }

    .permission-badge.read {
        background: rgba(34, 197, 94, 0.15);
        color: #22c55e;
    }

    .permission-badge.write {
        background: rgba(249, 115, 22, 0.15);
        color: #f97316;
    }

    /* CTA */
    .cta-section {
        padding: 4rem 0;
        text-align: center;
        position: relative;
        z-index: 1;
    }

    .cta-section h2 {
        font-size: 2rem;
        font-weight: 700;
        margin-bottom: 0.5rem;
    }

    .cta-section p {
        color: var(--text-secondary);
        margin-bottom: 1.5rem;
    }

    .cta-buttons {
        display: flex;
        gap: 1rem;
        justify-content: center;
        flex-wrap: wrap;
    }

    .btn {
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        padding: 0.75rem 1.5rem;
        border-radius: 8px;
        font-weight: 600;
        text-decoration: none;
        transition: all 0.3s;
    }

    .btn-primary {
        background: var(--accent-cyan);
        color: var(--bg-primary);
    }

    .btn-primary:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 20px rgba(0, 217, 255, 0.3);
    }

    .btn-secondary {
        background: transparent;
        border: 1px solid var(--border-medium);
        color: var(--text-primary);
    }

    .btn-secondary:hover {
        border-color: var(--accent-cyan);
        color: var(--accent-cyan);
    }

    /* Mobile */
    @media (max-width: 768px) {
        .reference-hero h1 {
            font-size: 2rem;
        }

        .hero-subtitle {
            font-size: 1rem;
        }

        .server-header {
            flex-direction: column;
            align-items: flex-start;
        }

        .tool-badge {
            margin-left: 0;
        }
    }
</style>

<script>
    const searchInput = document.getElementById('tool-search') as HTMLInputElement;
    const toolCards = document.querySelectorAll('.tool-card');
    const serverSections = document.querySelectorAll('.server-section');

    searchInput?.addEventListener('input', (e) => {
        const query = (e.target as HTMLInputElement).value.toLowerCase();

        toolCards.forEach((card) => {
            const tool = card.getAttribute('data-tool') || '';
            const match = tool.includes(query);
            (card as HTMLElement).style.display = match || !query ? 'flex' : 'none';
        });

        serverSections.forEach((section) => {
            const serverName = section.getAttribute('data-server') || '';
            const serverMatch = serverName.includes(query);
            const visibleTools = section.querySelectorAll('.tool-card');
            const hasVisibleTools = Array.from(visibleTools).some((t) =>
                (t as HTMLElement).style.display !== 'none'
            );
            (section as HTMLElement).style.display = (hasVisibleTools || serverMatch || !query) ? 'block' : 'none';
        });
    });
</script>
