---
import BaseLayout from '../../layouts/BaseLayout.astro';
import { getLangFromUrl, useTranslations, type Lang } from '../../i18n/utils';

export function getStaticPaths() {
  return [
    { params: { lang: 'en' } },
    { params: { lang: 'nl' } }
  ];
}

const lang = getLangFromUrl(Astro.url) as Lang;
const t = useTranslations(lang);

const title = lang === 'en' ? 'MCP Tools Reference | Snow-Flow' : 'MCP Tools Referentie | Snow-Flow';
const description = lang === 'en'
  ? 'Complete reference of 410+ MCP tools for ServiceNow development across 18 specialized servers.'
  : 'Complete referentie van 410+ MCP tools voor ServiceNow ontwikkeling verdeeld over 18 gespecialiseerde servers.';

const servers = [
  {
    name: 'Operations Server',
    icon: 'âš™ï¸',
    description: lang === 'en' ? 'Core ServiceNow operations and queries' : 'Core ServiceNow operaties en queries',
    tools: ['snow_query_table', 'snow_query_incidents', 'snow_cmdb_search', 'snow_user_lookup', 'snow_operational_metrics', 'snow_knowledge_search', 'snow_create_incident', 'snow_update_incident']
  },
  {
    name: 'Deployment Server',
    icon: 'ðŸš€',
    description: lang === 'en' ? 'Widget & artifact deployment with validation' : 'Widget & artifact deployment met validatie',
    tools: ['snow_create_artifact', 'snow_update', 'snow_delete', 'snow_validate_deployment', 'snow_rollback_deployment', 'snow_preview_widget', 'snow_widget_test', 'snow_batch_deploy']
  },
  {
    name: 'Automation Server',
    icon: 'âš¡',
    description: lang === 'en' ? 'Script execution and automation' : 'Script executie en automatisering',
    tools: ['snow_execute_background_script', 'snow_execute_script_with_output', 'snow_get_script_output', 'snow_execute_script_sync', 'snow_get_logs', 'snow_schedule_job', 'snow_create_event']
  },
  {
    name: 'Platform Development',
    icon: 'ðŸ—ï¸',
    description: lang === 'en' ? 'Business rules, client scripts, UI actions' : 'Business rules, client scripts, UI actions',
    tools: ['snow_create_business_rule', 'snow_create_client_script', 'snow_create_ui_action', 'snow_create_script_include', 'snow_create_ui_page', 'snow_create_ui_policy']
  },
  {
    name: 'Integration Server',
    icon: 'ðŸ”—',
    description: lang === 'en' ? 'REST, SOAP, data transforms' : 'REST, SOAP, data transforms',
    tools: ['snow_create_rest_message', 'snow_create_transform_map', 'snow_create_import_set', 'snow_test_web_service', 'snow_configure_email']
  },
  {
    name: 'System Properties',
    icon: 'ðŸ”§',
    description: lang === 'en' ? 'System property management' : 'Systeem property beheer',
    tools: ['snow_property_get', 'snow_property_set', 'snow_property_list', 'snow_property_delete', 'snow_property_bulk_update', 'snow_property_export', 'snow_property_import']
  },
  {
    name: 'Update Set Server',
    icon: 'ðŸ“¦',
    description: lang === 'en' ? 'Change management and deployment' : 'Change management en deployment',
    tools: ['snow_update_set_create', 'snow_update_set_switch', 'snow_update_set_current', 'snow_update_set_complete', 'snow_update_set_export', 'snow_ensure_active_update_set']
  },
  {
    name: 'Development Assistant',
    icon: 'ðŸ¤–',
    description: lang === 'en' ? 'Intelligent artifact search & editing' : 'Intelligente artifact zoek & bewerking',
    tools: ['snow_find_artifact', 'snow_edit_artifact', 'snow_get_by_sysid', 'snow_analyze_artifact', 'snow_comprehensive_search', 'snow_analyze_requirements']
  },
  {
    name: 'Security & Compliance',
    icon: 'ðŸ”’',
    description: lang === 'en' ? 'Security policies and compliance' : 'Security policies en compliance',
    tools: ['snow_create_security_policy', 'snow_audit_compliance', 'snow_scan_vulnerabilities', 'snow_assess_risk', 'snow_review_access_control']
  },
  {
    name: 'Reporting & Analytics',
    icon: 'ðŸ“Š',
    description: lang === 'en' ? 'Reports, dashboards, KPIs' : 'Reports, dashboards, KPIs',
    tools: ['snow_create_report', 'snow_create_dashboard', 'snow_define_kpi', 'snow_schedule_report', 'snow_analyze_data_quality']
  },
  {
    name: 'Machine Learning',
    icon: 'ðŸ§ ',
    description: lang === 'en' ? 'AI/ML capabilities with TensorFlow.js' : 'AI/ML mogelijkheden met TensorFlow.js',
    tools: ['ml_train_incident_classifier', 'ml_predict_change_risk', 'ml_detect_anomalies', 'ml_forecast_incidents', 'ml_performance_analytics']
  },
  {
    name: 'Knowledge & Catalog',
    icon: 'ðŸ“š',
    description: lang === 'en' ? 'Knowledge articles and service catalog' : 'Knowledge artikelen en service catalog',
    tools: ['snow_create_kb_article', 'snow_create_catalog_item', 'snow_manage_catalog_variables', 'snow_create_catalog_category']
  },
  {
    name: 'CMDB & Events',
    icon: 'ðŸŒ',
    description: lang === 'en' ? 'CI management and event correlation' : 'CI beheer en event correlatie',
    tools: ['snow_create_ci', 'snow_manage_ci_relationships', 'snow_event_correlation', 'snow_alert_management', 'snow_discovery_status']
  },
  {
    name: 'Flow & Workspace',
    icon: 'ðŸ”„',
    description: lang === 'en' ? 'Flow Designer and workspace config' : 'Flow Designer en workspace config',
    tools: ['snow_create_flow', 'snow_create_subflow', 'snow_configure_workspace', 'snow_create_action', 'snow_create_spoke']
  },
  {
    name: 'Change & Virtual Agent',
    icon: 'ðŸŽ¯',
    description: lang === 'en' ? 'Change management and NLU' : 'Change management en NLU',
    tools: ['snow_create_change', 'snow_create_va_topic', 'snow_train_nlu', 'snow_manage_intents', 'snow_analyze_conversations']
  }
];

const totalTools = servers.reduce((sum, server) => sum + server.tools.length, 0) + 300; // Add 300 for unlisted tools
---

<BaseLayout title={title} description={description}>
    <!-- Background Effects -->
    <div class="bg-grid"></div>
    <div class="bg-gradient"></div>

    <!-- Hero -->
    <section class="reference-hero">
        <div class="container">
            <div class="hero-badge">
                <span class="pulse"></span>
                410+ MCP Tools
            </div>
            <h1>{lang === 'en' ? 'MCP Tools Reference' : 'MCP Tools Referentie'}</h1>
            <p class="hero-subtitle">
                {lang === 'en'
                    ? 'Complete reference of all Snow-Flow MCP tools across 18 specialized servers for comprehensive ServiceNow development.'
                    : 'Complete referentie van alle Snow-Flow MCP tools verdeeld over 18 gespecialiseerde servers.'}
            </p>
        </div>
    </section>

    <!-- Search -->
    <section class="search-section">
        <div class="container">
            <div class="search-box">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="11" cy="11" r="8"></circle>
                    <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
                </svg>
                <input type="text" id="tool-search" placeholder={lang === 'en' ? 'Search tools or servers...' : 'Zoek tools of servers...'}>
            </div>
        </div>
    </section>

    <!-- Stats -->
    <section class="stats-section">
        <div class="container">
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-number">410+</div>
                    <div class="stat-label">MCP Tools</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">{servers.length}</div>
                    <div class="stat-label">{lang === 'en' ? 'Servers' : 'Servers'}</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">75+</div>
                    <div class="stat-label">{lang === 'en' ? 'LLM Providers' : 'LLM Providers'}</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">100%</div>
                    <div class="stat-label">Open Source</div>
                </div>
            </div>
        </div>
    </section>

    <!-- Servers -->
    <section class="servers-section">
        <div class="container">
            <div class="servers-list">
                {servers.map((server) => (
                    <div class="server-section" data-server={server.name.toLowerCase()}>
                        <div class="server-header">
                            <span class="server-icon">{server.icon}</span>
                            <div>
                                <h2>{server.name}</h2>
                                <p>{server.description}</p>
                            </div>
                            <span class="tool-badge">{server.tools.length}+ tools</span>
                        </div>
                        <div class="tools-grid">
                            {server.tools.map((tool) => (
                                <div class="tool-card" data-tool={tool.toLowerCase()}>
                                    <code>{tool}</code>
                                </div>
                            ))}
                        </div>
                    </div>
                ))}
            </div>
        </div>
    </section>

    <!-- CTA -->
    <section class="cta-section">
        <div class="container">
            <h2>{lang === 'en' ? 'Get Started' : 'Aan de Slag'}</h2>
            <p>{lang === 'en' ? 'Install Snow-Flow and start building.' : 'Installeer Snow-Flow en begin met bouwen.'}</p>
            <div class="cta-buttons">
                <a href="https://github.com/groeimetai/snow-flow" class="btn btn-primary">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M12 0C5.37 0 0 5.37 0 12c0 5.31 3.435 9.795 8.205 11.385.6.105.825-.255.825-.57 0-.285-.015-1.23-.015-2.235-3.015.555-3.795-.735-4.035-1.41-.135-.345-.72-1.41-1.23-1.695-.42-.225-1.02-.78-.015-.795.945-.015 1.62.87 1.845 1.23 1.08 1.815 2.805 1.305 3.495.99.105-.78.42-1.305.765-1.605-2.67-.3-5.46-1.335-5.46-5.925 0-1.305.465-2.385 1.23-3.225-.12-.3-.54-1.53.12-3.18 0 0 1.005-.315 3.3 1.23.96-.27 1.98-.405 3-.405s2.04.135 3 .405c2.295-1.56 3.3-1.23 3.3-1.23.66 1.65.24 2.88.12 3.18.765.84 1.23 1.905 1.23 3.225 0 4.605-2.805 5.625-5.475 5.925.435.375.81 1.095.81 2.22 0 1.605-.015 2.895-.015 3.3 0 .315.225.69.825.57A12.02 12.02 0 0024 12c0-6.63-5.37-12-12-12z"/>
                    </svg>
                    GitHub
                </a>
                <a href={`/${lang}/docs`} class="btn btn-secondary">
                    {lang === 'en' ? 'Documentation' : 'Documentatie'}
                </a>
            </div>
        </div>
    </section>

    <!-- JSON-LD -->
    <script type="application/ld+json" set:html={JSON.stringify({
        "@context": "https://schema.org",
        "@type": "ItemList",
        "name": "Snow-Flow MCP Tools",
        "description": description,
        "numberOfItems": 410,
        "itemListElement": servers.map((server, index) => ({
            "@type": "ListItem",
            "position": index + 1,
            "name": server.name,
            "description": server.description
        }))
    })} />
</BaseLayout>

<style>
    /* Hero */
    .reference-hero {
        padding: 10rem 0 3rem;
        text-align: center;
        position: relative;
        z-index: 1;
    }

    .reference-hero h1 {
        font-size: 3rem;
        font-weight: 800;
        margin-bottom: 1rem;
        background: linear-gradient(135deg, #FFFFFF 0%, var(--accent-cyan) 100%);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
    }

    .hero-badge {
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        padding: 0.5rem 1rem;
        background: rgba(0, 217, 255, 0.1);
        border: 1px solid rgba(0, 217, 255, 0.3);
        border-radius: 100px;
        font-size: 0.875rem;
        font-weight: 600;
        color: var(--accent-cyan);
        margin-bottom: 1.5rem;
    }

    .pulse {
        width: 8px;
        height: 8px;
        background: var(--accent-cyan);
        border-radius: 50%;
        animation: pulse 2s infinite;
    }

    @keyframes pulse {
        0%, 100% { opacity: 1; }
        50% { opacity: 0.5; }
    }

    .hero-subtitle {
        color: var(--text-secondary);
        font-size: 1.25rem;
        max-width: 700px;
        margin: 0 auto;
        line-height: 1.7;
    }

    /* Search */
    .search-section {
        padding: 0 0 2rem;
        position: relative;
        z-index: 1;
    }

    .search-box {
        display: flex;
        align-items: center;
        gap: 1rem;
        max-width: 600px;
        margin: 0 auto;
        padding: 1rem 1.5rem;
        background: var(--bg-card);
        border: 1px solid var(--border-subtle);
        border-radius: 12px;
        transition: border-color 0.3s;
    }

    .search-box:focus-within {
        border-color: var(--accent-cyan);
    }

    .search-box svg {
        color: var(--text-muted);
    }

    .search-box input {
        flex: 1;
        background: none;
        border: none;
        color: var(--text-primary);
        font-size: 1rem;
        outline: none;
    }

    .search-box input::placeholder {
        color: var(--text-muted);
    }

    /* Stats */
    .stats-section {
        padding: 2rem 0;
        position: relative;
        z-index: 1;
    }

    .stats-grid {
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        gap: 1rem;
    }

    @media (max-width: 768px) {
        .stats-grid {
            grid-template-columns: repeat(2, 1fr);
        }
    }

    .stat-card {
        background: var(--bg-card);
        border: 1px solid var(--border-subtle);
        border-radius: 12px;
        padding: 1.25rem;
        text-align: center;
    }

    .stat-number {
        font-size: 1.75rem;
        font-weight: 800;
        color: var(--accent-cyan);
    }

    .stat-label {
        color: var(--text-secondary);
        font-size: 0.8rem;
    }

    /* Servers */
    .servers-section {
        padding: 2rem 0 4rem;
        position: relative;
        z-index: 1;
    }

    .servers-list {
        display: flex;
        flex-direction: column;
        gap: 2rem;
    }

    .server-section {
        background: var(--bg-card);
        border: 1px solid var(--border-subtle);
        border-radius: 16px;
        padding: 1.5rem;
        transition: border-color 0.3s;
    }

    .server-section:hover {
        border-color: rgba(0, 217, 255, 0.3);
    }

    .server-header {
        display: flex;
        align-items: center;
        gap: 1rem;
        margin-bottom: 1.25rem;
        flex-wrap: wrap;
    }

    .server-icon {
        font-size: 2rem;
    }

    .server-header h2 {
        font-size: 1.25rem;
        font-weight: 700;
        margin: 0;
        color: var(--text-primary);
    }

    .server-header p {
        margin: 0;
        color: var(--text-secondary);
        font-size: 0.875rem;
    }

    .tool-badge {
        margin-left: auto;
        background: rgba(0, 217, 255, 0.1);
        color: var(--accent-cyan);
        padding: 0.375rem 0.875rem;
        border-radius: 100px;
        font-size: 0.75rem;
        font-weight: 600;
    }

    .tools-grid {
        display: flex;
        flex-wrap: wrap;
        gap: 0.5rem;
    }

    .tool-card {
        background: var(--bg-secondary);
        border: 1px solid var(--border-subtle);
        border-radius: 6px;
        padding: 0.5rem 0.75rem;
        transition: all 0.2s ease;
    }

    .tool-card:hover {
        border-color: var(--accent-cyan);
        background: rgba(0, 217, 255, 0.05);
    }

    .tool-card code {
        font-family: var(--font-mono);
        font-size: 0.8rem;
        color: var(--accent-cyan);
    }

    /* CTA */
    .cta-section {
        padding: 4rem 0;
        text-align: center;
        position: relative;
        z-index: 1;
    }

    .cta-section h2 {
        font-size: 2rem;
        font-weight: 700;
        margin-bottom: 0.5rem;
    }

    .cta-section p {
        color: var(--text-secondary);
        margin-bottom: 1.5rem;
    }

    .cta-buttons {
        display: flex;
        gap: 1rem;
        justify-content: center;
        flex-wrap: wrap;
    }

    .btn {
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        padding: 0.75rem 1.5rem;
        border-radius: 8px;
        font-weight: 600;
        text-decoration: none;
        transition: all 0.3s;
    }

    .btn-primary {
        background: var(--accent-cyan);
        color: var(--bg-primary);
    }

    .btn-primary:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 20px rgba(0, 217, 255, 0.3);
    }

    .btn-secondary {
        background: transparent;
        border: 1px solid var(--border-medium);
        color: var(--text-primary);
    }

    .btn-secondary:hover {
        border-color: var(--accent-cyan);
        color: var(--accent-cyan);
    }

    /* Mobile */
    @media (max-width: 768px) {
        .reference-hero h1 {
            font-size: 2rem;
        }

        .hero-subtitle {
            font-size: 1rem;
        }

        .server-header {
            flex-direction: column;
            align-items: flex-start;
        }

        .tool-badge {
            margin-left: 0;
        }
    }
</style>

<script>
    const searchInput = document.getElementById('tool-search') as HTMLInputElement;
    const toolCards = document.querySelectorAll('.tool-card');
    const serverSections = document.querySelectorAll('.server-section');

    searchInput?.addEventListener('input', (e) => {
        const query = (e.target as HTMLInputElement).value.toLowerCase();

        toolCards.forEach((card) => {
            const tool = card.getAttribute('data-tool') || '';
            const match = tool.includes(query);
            (card as HTMLElement).style.display = match || !query ? 'flex' : 'none';
        });

        serverSections.forEach((section) => {
            const serverName = section.getAttribute('data-server') || '';
            const serverMatch = serverName.includes(query);
            const visibleTools = section.querySelectorAll('.tool-card');
            const hasVisibleTools = Array.from(visibleTools).some((t) =>
                (t as HTMLElement).style.display !== 'none'
            );
            (section as HTMLElement).style.display = (hasVisibleTools || serverMatch || !query) ? 'block' : 'none';
        });
    });
</script>
