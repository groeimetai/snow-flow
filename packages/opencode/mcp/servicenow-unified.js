#!/usr/bin/env node
import{createRequire as Ef}from"node:module";var vf=Object.create;var{getPrototypeOf:Df,defineProperty:XX,getOwnPropertyNames:jf}=Object;var Cf=Object.prototype.hasOwnProperty;var u4=(Y,X,J)=>{J=Y!=null?vf(Df(Y)):{};let z=X||!Y||!Y.__esModule?XX(J,"default",{value:Y,enumerable:!0}):J;for(let Q of jf(Y))if(!Cf.call(z,Q))XX(z,Q,{get:()=>Y[Q],enumerable:!0});return z};var C=(Y,X)=>()=>(X||Y((X={exports:{}}).exports,X),X.exports);var G0=(Y,X)=>{for(var J in X)XX(Y,J,{get:X[J],enumerable:!0,configurable:!0,set:(z)=>X[J]=()=>z})};var Q0=Ef(import.meta.url);var u5=C((CU)=>{Object.defineProperty(CU,"__esModule",{value:!0});CU.regexpCode=CU.getEsmExportName=CU.getProperty=CU.safeStringify=CU.stringify=CU.strConcat=CU.addCodeArg=CU.str=CU._=CU.nil=CU._Code=CU.Name=CU.IDENTIFIER=CU._CodeOrName=void 0;class s3{}CU._CodeOrName=s3;CU.IDENTIFIER=/^[a-z$_][a-z$_0-9]*$/i;class P6 extends s3{constructor(Y){super();if(!CU.IDENTIFIER.test(Y))throw Error("CodeGen: name must be a valid identifier");this.str=Y}toString(){return this.str}emptyStr(){return!1}get names(){return{[this.str]:1}}}CU.Name=P6;class W4 extends s3{constructor(Y){super();this._items=typeof Y==="string"?[Y]:Y}toString(){return this.str}emptyStr(){if(this._items.length>1)return!1;let Y=this._items[0];return Y===""||Y==='""'}get str(){var Y;return(Y=this._str)!==null&&Y!==void 0?Y:this._str=this._items.reduce((X,J)=>`${X}${J}`,"")}get names(){var Y;return(Y=this._names)!==null&&Y!==void 0?Y:this._names=this._items.reduce((X,J)=>{if(J instanceof P6)X[J.str]=(X[J.str]||0)+1;return X},{})}}CU._Code=W4;CU.nil=new W4("");function DU(Y,...X){let J=[Y[0]],z=0;while(z<X.length)WJ(J,X[z]),J.push(Y[++z]);return new W4(J)}CU._=DU;var HJ=new W4("+");function jU(Y,...X){let J=[m5(Y[0])],z=0;while(z<X.length)J.push(HJ),WJ(J,X[z]),J.push(HJ,m5(Y[++z]));return nm(J),new W4(J)}CU.str=jU;function WJ(Y,X){if(X instanceof W4)Y.push(...X._items);else if(X instanceof P6)Y.push(X);else Y.push(sm(X))}CU.addCodeArg=WJ;function nm(Y){let X=1;while(X<Y.length-1){if(Y[X]===HJ){let J=om(Y[X-1],Y[X+1]);if(J!==void 0){Y.splice(X-1,3,J);continue}Y[X++]="+"}X++}}function om(Y,X){if(X==='""')return Y;if(Y==='""')return X;if(typeof Y=="string"){if(X instanceof P6||Y[Y.length-1]!=='"')return;if(typeof X!="string")return`${Y.slice(0,-1)}${X}"`;if(X[0]==='"')return Y.slice(0,-1)+X.slice(1);return}if(typeof X=="string"&&X[0]==='"'&&!(Y instanceof P6))return`"${Y}${X.slice(1)}`;return}function am(Y,X){return X.emptyStr()?Y:Y.emptyStr()?X:jU`${Y}${X}`}CU.strConcat=am;function sm(Y){return typeof Y=="number"||typeof Y=="boolean"||Y===null?Y:m5(Array.isArray(Y)?Y.join(","):Y)}function rm(Y){return new W4(m5(Y))}CU.stringify=rm;function m5(Y){return JSON.stringify(Y).replace(/\u2028/g,"\\u2028").replace(/\u2029/g,"\\u2029")}CU.safeStringify=m5;function tm(Y){return typeof Y=="string"&&CU.IDENTIFIER.test(Y)?new W4(`.${Y}`):DU`[${Y}]`}CU.getProperty=tm;function em(Y){if(typeof Y=="string"&&CU.IDENTIFIER.test(Y))return new W4(`${Y}`);throw Error(`CodeGen: invalid export name: ${Y}, use explicit $id name mapping`)}CU.getEsmExportName=em;function Yu(Y){return new W4(Y.toString())}CU.regexpCode=Yu});var VJ=C((_U)=>{Object.defineProperty(_U,"__esModule",{value:!0});_U.ValueScope=_U.ValueScopeName=_U.Scope=_U.varKinds=_U.UsedValueState=void 0;var _1=u5();class SU extends Error{constructor(Y){super(`CodeGen: "code" for ${Y} not defined`);this.value=Y.value}}var t3;(function(Y){Y[Y.Started=0]="Started",Y[Y.Completed=1]="Completed"})(t3||(_U.UsedValueState=t3={}));_U.varKinds={const:new _1.Name("const"),let:new _1.Name("let"),var:new _1.Name("var")};class UJ{constructor({prefixes:Y,parent:X}={}){this._names={},this._prefixes=Y,this._parent=X}toName(Y){return Y instanceof _1.Name?Y:this.name(Y)}name(Y){return new _1.Name(this._newName(Y))}_newName(Y){let X=this._names[Y]||this._nameGroup(Y);return`${Y}${X.index++}`}_nameGroup(Y){var X,J;if(((J=(X=this._parent)===null||X===void 0?void 0:X._prefixes)===null||J===void 0?void 0:J.has(Y))||this._prefixes&&!this._prefixes.has(Y))throw Error(`CodeGen: prefix "${Y}" is not allowed in this scope`);return this._names[Y]={prefix:Y,index:0}}}_U.Scope=UJ;class BJ extends _1.Name{constructor(Y,X){super(X);this.prefix=Y}setValue(Y,{property:X,itemIndex:J}){this.value=Y,this.scopePath=_1._`.${new _1.Name(X)}[${J}]`}}_U.ValueScopeName=BJ;var Vu=_1._`\n`;class kU extends UJ{constructor(Y){super(Y);this._values={},this._scope=Y.scope,this.opts={...Y,_n:Y.lines?Vu:_1.nil}}get(){return this._scope}name(Y){return new BJ(Y,this._newName(Y))}value(Y,X){var J;if(X.ref===void 0)throw Error("CodeGen: ref must be passed in value");let z=this.toName(Y),{prefix:Q}=z,G=(J=X.key)!==null&&J!==void 0?J:X.ref,Z=this._values[Q];if(Z){let W=Z.get(G);if(W)return W}else Z=this._values[Q]=new Map;Z.set(G,z);let $=this._scope[Q]||(this._scope[Q]=[]),H=$.length;return $[H]=X.ref,z.setValue(X,{property:Q,itemIndex:H}),z}getValue(Y,X){let J=this._values[Y];if(!J)return;return J.get(X)}scopeRefs(Y,X=this._values){return this._reduceValues(X,(J)=>{if(J.scopePath===void 0)throw Error(`CodeGen: name "${J}" has no value`);return _1._`${Y}${J.scopePath}`})}scopeCode(Y=this._values,X,J){return this._reduceValues(Y,(z)=>{if(z.value===void 0)throw Error(`CodeGen: name "${z}" has no value`);return z.value.code},X,J)}_reduceValues(Y,X,J={},z){let Q=_1.nil;for(let G in Y){let Z=Y[G];if(!Z)continue;let $=J[G]=J[G]||new Map;Z.forEach((H)=>{if($.has(H))return;$.set(H,t3.Started);let W=X(H);if(W){let K=this.opts.es5?_U.varKinds.var:_U.varKinds.const;Q=_1._`${Q}${K} ${H} = ${W};${this.opts._n}`}else if(W=z===null||z===void 0?void 0:z(H))Q=_1._`${Q}${W}${this.opts._n}`;else throw new SU(H);$.set(H,t3.Completed)})}return Q}}_U.ValueScope=kU});var F0=C((b1)=>{Object.defineProperty(b1,"__esModule",{value:!0});b1.or=b1.and=b1.not=b1.CodeGen=b1.operators=b1.varKinds=b1.ValueScopeName=b1.ValueScope=b1.Scope=b1.Name=b1.regexpCode=b1.stringify=b1.getProperty=b1.nil=b1.strConcat=b1.str=b1._=void 0;var D0=u5(),K4=VJ(),B8=u5();Object.defineProperty(b1,"_",{enumerable:!0,get:function(){return B8._}});Object.defineProperty(b1,"str",{enumerable:!0,get:function(){return B8.str}});Object.defineProperty(b1,"strConcat",{enumerable:!0,get:function(){return B8.strConcat}});Object.defineProperty(b1,"nil",{enumerable:!0,get:function(){return B8.nil}});Object.defineProperty(b1,"getProperty",{enumerable:!0,get:function(){return B8.getProperty}});Object.defineProperty(b1,"stringify",{enumerable:!0,get:function(){return B8.stringify}});Object.defineProperty(b1,"regexpCode",{enumerable:!0,get:function(){return B8.regexpCode}});Object.defineProperty(b1,"Name",{enumerable:!0,get:function(){return B8.Name}});var Q9=VJ();Object.defineProperty(b1,"Scope",{enumerable:!0,get:function(){return Q9.Scope}});Object.defineProperty(b1,"ValueScope",{enumerable:!0,get:function(){return Q9.ValueScope}});Object.defineProperty(b1,"ValueScopeName",{enumerable:!0,get:function(){return Q9.ValueScopeName}});Object.defineProperty(b1,"varKinds",{enumerable:!0,get:function(){return Q9.varKinds}});b1.operators={GT:new D0._Code(">"),GTE:new D0._Code(">="),LT:new D0._Code("<"),LTE:new D0._Code("<="),EQ:new D0._Code("==="),NEQ:new D0._Code("!=="),NOT:new D0._Code("!"),OR:new D0._Code("||"),AND:new D0._Code("&&"),ADD:new D0._Code("+")};class V8{optimizeNodes(){return this}optimizeNames(Y,X){return this}}class RU extends V8{constructor(Y,X,J){super();this.varKind=Y,this.name=X,this.rhs=J}render({es5:Y,_n:X}){let J=Y?K4.varKinds.var:this.varKind,z=this.rhs===void 0?"":` = ${this.rhs}`;return`${J} ${this.name}${z};`+X}optimizeNames(Y,X){if(!Y[this.name.str])return;if(this.rhs)this.rhs=w6(this.rhs,Y,X);return this}get names(){return this.rhs instanceof D0._CodeOrName?this.rhs.names:{}}}class LJ extends V8{constructor(Y,X,J){super();this.lhs=Y,this.rhs=X,this.sideEffects=J}render({_n:Y}){return`${this.lhs} = ${this.rhs};`+Y}optimizeNames(Y,X){if(this.lhs instanceof D0.Name&&!Y[this.lhs.str]&&!this.sideEffects)return;return this.rhs=w6(this.rhs,Y,X),this}get names(){let Y=this.lhs instanceof D0.Name?{}:{...this.lhs.names};return z9(Y,this.rhs)}}class fU extends LJ{constructor(Y,X,J,z){super(Y,J,z);this.op=X}render({_n:Y}){return`${this.lhs} ${this.op}= ${this.rhs};`+Y}}class yU extends V8{constructor(Y){super();this.label=Y,this.names={}}render({_n:Y}){return`${this.label}:`+Y}}class hU extends V8{constructor(Y){super();this.label=Y,this.names={}}render({_n:Y}){return`break${this.label?` ${this.label}`:""};`+Y}}class mU extends V8{constructor(Y){super();this.error=Y}render({_n:Y}){return`throw ${this.error};`+Y}get names(){return this.error.names}}class uU extends V8{constructor(Y){super();this.code=Y}render({_n:Y}){return`${this.code};`+Y}optimizeNodes(){return`${this.code}`?this:void 0}optimizeNames(Y,X){return this.code=w6(this.code,Y,X),this}get names(){return this.code instanceof D0._CodeOrName?this.code.names:{}}}class G9 extends V8{constructor(Y=[]){super();this.nodes=Y}render(Y){return this.nodes.reduce((X,J)=>X+J.render(Y),"")}optimizeNodes(){let{nodes:Y}=this,X=Y.length;while(X--){let J=Y[X].optimizeNodes();if(Array.isArray(J))Y.splice(X,1,...J);else if(J)Y[X]=J;else Y.splice(X,1)}return Y.length>0?this:void 0}optimizeNames(Y,X){let{nodes:J}=this,z=J.length;while(z--){let Q=J[z];if(Q.optimizeNames(Y,X))continue;Nu(Y,Q.names),J.splice(z,1)}return J.length>0?this:void 0}get names(){return this.nodes.reduce((Y,X)=>R8(Y,X.names),{})}}class O8 extends G9{render(Y){return"{"+Y._n+super.render(Y)+"}"+Y._n}}class gU extends G9{}class g5 extends O8{}g5.kind="else";class l4 extends O8{constructor(Y,X){super(X);this.condition=Y}render(Y){let X=`if(${this.condition})`+super.render(Y);if(this.else)X+="else "+this.else.render(Y);return X}optimizeNodes(){super.optimizeNodes();let Y=this.condition;if(Y===!0)return this.nodes;let X=this.else;if(X){let J=X.optimizeNodes();X=this.else=Array.isArray(J)?new g5(J):J}if(X){if(Y===!1)return X instanceof l4?X:X.nodes;if(this.nodes.length)return this;return new l4(iU(Y),X instanceof l4?[X]:X.nodes)}if(Y===!1||!this.nodes.length)return;return this}optimizeNames(Y,X){var J;if(this.else=(J=this.else)===null||J===void 0?void 0:J.optimizeNames(Y,X),!(super.optimizeNames(Y,X)||this.else))return;return this.condition=w6(this.condition,Y,X),this}get names(){let Y=super.names;if(z9(Y,this.condition),this.else)R8(Y,this.else.names);return Y}}l4.kind="if";class A6 extends O8{}A6.kind="for";class pU extends A6{constructor(Y){super();this.iteration=Y}render(Y){return`for(${this.iteration})`+super.render(Y)}optimizeNames(Y,X){if(!super.optimizeNames(Y,X))return;return this.iteration=w6(this.iteration,Y,X),this}get names(){return R8(super.names,this.iteration.names)}}class cU extends A6{constructor(Y,X,J,z){super();this.varKind=Y,this.name=X,this.from=J,this.to=z}render(Y){let X=Y.es5?K4.varKinds.var:this.varKind,{name:J,from:z,to:Q}=this;return`for(${X} ${J}=${z}; ${J}<${Q}; ${J}++)`+super.render(Y)}get names(){let Y=z9(super.names,this.from);return z9(Y,this.to)}}class OJ extends A6{constructor(Y,X,J,z){super();this.loop=Y,this.varKind=X,this.name=J,this.iterable=z}render(Y){return`for(${this.varKind} ${this.name} ${this.loop} ${this.iterable})`+super.render(Y)}optimizeNames(Y,X){if(!super.optimizeNames(Y,X))return;return this.iterable=w6(this.iterable,Y,X),this}get names(){return R8(super.names,this.iterable.names)}}class e3 extends O8{constructor(Y,X,J){super();this.name=Y,this.args=X,this.async=J}render(Y){return`${this.async?"async ":""}function ${this.name}(${this.args})`+super.render(Y)}}e3.kind="func";class Y9 extends G9{render(Y){return"return "+super.render(Y)}}Y9.kind="return";class dU extends O8{render(Y){let X="try"+super.render(Y);if(this.catch)X+=this.catch.render(Y);if(this.finally)X+=this.finally.render(Y);return X}optimizeNodes(){var Y,X;return super.optimizeNodes(),(Y=this.catch)===null||Y===void 0||Y.optimizeNodes(),(X=this.finally)===null||X===void 0||X.optimizeNodes(),this}optimizeNames(Y,X){var J,z;return super.optimizeNames(Y,X),(J=this.catch)===null||J===void 0||J.optimizeNames(Y,X),(z=this.finally)===null||z===void 0||z.optimizeNames(Y,X),this}get names(){let Y=super.names;if(this.catch)R8(Y,this.catch.names);if(this.finally)R8(Y,this.finally.names);return Y}}class X9 extends O8{constructor(Y){super();this.error=Y}render(Y){return`catch(${this.error})`+super.render(Y)}}X9.kind="catch";class J9 extends O8{render(Y){return"finally"+super.render(Y)}}J9.kind="finally";class lU{constructor(Y,X={}){this._values={},this._blockStarts=[],this._constants={},this.opts={...X,_n:X.lines?`
`:""},this._extScope=Y,this._scope=new K4.Scope({parent:Y}),this._nodes=[new gU]}toString(){return this._root.render(this.opts)}name(Y){return this._scope.name(Y)}scopeName(Y){return this._extScope.name(Y)}scopeValue(Y,X){let J=this._extScope.value(Y,X);return(this._values[J.prefix]||(this._values[J.prefix]=new Set)).add(J),J}getScopeValue(Y,X){return this._extScope.getValue(Y,X)}scopeRefs(Y){return this._extScope.scopeRefs(Y,this._values)}scopeCode(){return this._extScope.scopeCode(this._values)}_def(Y,X,J,z){let Q=this._scope.toName(X);if(J!==void 0&&z)this._constants[Q.str]=J;return this._leafNode(new RU(Y,Q,J)),Q}const(Y,X,J){return this._def(K4.varKinds.const,Y,X,J)}let(Y,X,J){return this._def(K4.varKinds.let,Y,X,J)}var(Y,X,J){return this._def(K4.varKinds.var,Y,X,J)}assign(Y,X,J){return this._leafNode(new LJ(Y,X,J))}add(Y,X){return this._leafNode(new fU(Y,b1.operators.ADD,X))}code(Y){if(typeof Y=="function")Y();else if(Y!==D0.nil)this._leafNode(new uU(Y));return this}object(...Y){let X=["{"];for(let[J,z]of Y){if(X.length>1)X.push(",");if(X.push(J),J!==z||this.opts.es5)X.push(":"),(0,D0.addCodeArg)(X,z)}return X.push("}"),new D0._Code(X)}if(Y,X,J){if(this._blockNode(new l4(Y)),X&&J)this.code(X).else().code(J).endIf();else if(X)this.code(X).endIf();else if(J)throw Error('CodeGen: "else" body without "then" body');return this}elseIf(Y){return this._elseNode(new l4(Y))}else(){return this._elseNode(new g5)}endIf(){return this._endBlockNode(l4,g5)}_for(Y,X){if(this._blockNode(Y),X)this.code(X).endFor();return this}for(Y,X){return this._for(new pU(Y),X)}forRange(Y,X,J,z,Q=this.opts.es5?K4.varKinds.var:K4.varKinds.let){let G=this._scope.toName(Y);return this._for(new cU(Q,G,X,J),()=>z(G))}forOf(Y,X,J,z=K4.varKinds.const){let Q=this._scope.toName(Y);if(this.opts.es5){let G=X instanceof D0.Name?X:this.var("_arr",X);return this.forRange("_i",0,D0._`${G}.length`,(Z)=>{this.var(Q,D0._`${G}[${Z}]`),J(Q)})}return this._for(new OJ("of",z,Q,X),()=>J(Q))}forIn(Y,X,J,z=this.opts.es5?K4.varKinds.var:K4.varKinds.const){if(this.opts.ownProperties)return this.forOf(Y,D0._`Object.keys(${X})`,J);let Q=this._scope.toName(Y);return this._for(new OJ("in",z,Q,X),()=>J(Q))}endFor(){return this._endBlockNode(A6)}label(Y){return this._leafNode(new yU(Y))}break(Y){return this._leafNode(new hU(Y))}return(Y){let X=new Y9;if(this._blockNode(X),this.code(Y),X.nodes.length!==1)throw Error('CodeGen: "return" should have one node');return this._endBlockNode(Y9)}try(Y,X,J){if(!X&&!J)throw Error('CodeGen: "try" without "catch" and "finally"');let z=new dU;if(this._blockNode(z),this.code(Y),X){let Q=this.name("e");this._currNode=z.catch=new X9(Q),X(Q)}if(J)this._currNode=z.finally=new J9,this.code(J);return this._endBlockNode(X9,J9)}throw(Y){return this._leafNode(new mU(Y))}block(Y,X){if(this._blockStarts.push(this._nodes.length),Y)this.code(Y).endBlock(X);return this}endBlock(Y){let X=this._blockStarts.pop();if(X===void 0)throw Error("CodeGen: not in self-balancing block");let J=this._nodes.length-X;if(J<0||Y!==void 0&&J!==Y)throw Error(`CodeGen: wrong number of nodes: ${J} vs ${Y} expected`);return this._nodes.length=X,this}func(Y,X=D0.nil,J,z){if(this._blockNode(new e3(Y,X,J)),z)this.code(z).endFunc();return this}endFunc(){return this._endBlockNode(e3)}optimize(Y=1){while(Y-- >0)this._root.optimizeNodes(),this._root.optimizeNames(this._root.names,this._constants)}_leafNode(Y){return this._currNode.nodes.push(Y),this}_blockNode(Y){this._currNode.nodes.push(Y),this._nodes.push(Y)}_endBlockNode(Y,X){let J=this._currNode;if(J instanceof Y||X&&J instanceof X)return this._nodes.pop(),this;throw Error(`CodeGen: not in block "${X?`${Y.kind}/${X.kind}`:Y.kind}"`)}_elseNode(Y){let X=this._currNode;if(!(X instanceof l4))throw Error('CodeGen: "else" without "if"');return this._currNode=X.else=Y,this}get _root(){return this._nodes[0]}get _currNode(){let Y=this._nodes;return Y[Y.length-1]}set _currNode(Y){let X=this._nodes;X[X.length-1]=Y}}b1.CodeGen=lU;function R8(Y,X){for(let J in X)Y[J]=(Y[J]||0)+(X[J]||0);return Y}function z9(Y,X){return X instanceof D0._CodeOrName?R8(Y,X.names):Y}function w6(Y,X,J){if(Y instanceof D0.Name)return z(Y);if(!Q(Y))return Y;return new D0._Code(Y._items.reduce((G,Z)=>{if(Z instanceof D0.Name)Z=z(Z);if(Z instanceof D0._Code)G.push(...Z._items);else G.push(Z);return G},[]));function z(G){let Z=J[G.str];if(Z===void 0||X[G.str]!==1)return G;return delete X[G.str],Z}function Q(G){return G instanceof D0._Code&&G._items.some((Z)=>Z instanceof D0.Name&&X[Z.str]===1&&J[Z.str]!==void 0)}}function Nu(Y,X){for(let J in X)Y[J]=(Y[J]||0)-(X[J]||0)}function iU(Y){return typeof Y=="boolean"||typeof Y=="number"||Y===null?!Y:D0._`!${MJ(Y)}`}b1.not=iU;var qu=nU(b1.operators.AND);function xu(...Y){return Y.reduce(qu)}b1.and=xu;var Fu=nU(b1.operators.OR);function Pu(...Y){return Y.reduce(Fu)}b1.or=Pu;function nU(Y){return(X,J)=>X===D0.nil?J:J===D0.nil?X:D0._`${MJ(X)} ${Y} ${MJ(J)}`}function MJ(Y){return Y instanceof D0.Name?Y:D0._`(${Y})`}});var E0=C((JB)=>{Object.defineProperty(JB,"__esModule",{value:!0});JB.checkStrictMode=JB.getErrorPath=JB.Type=JB.useFunc=JB.setEvaluated=JB.evaluatedPropsToName=JB.mergeEvaluated=JB.eachItem=JB.unescapeJsonPointer=JB.escapeJsonPointer=JB.escapeFragment=JB.unescapeFragment=JB.schemaRefOrVal=JB.schemaHasRulesButRef=JB.schemaHasRules=JB.checkUnknownRules=JB.alwaysValidSchema=JB.toHash=void 0;var y0=F0(),Iu=u5();function vu(Y){let X={};for(let J of Y)X[J]=!0;return X}JB.toHash=vu;function Du(Y,X){if(typeof X=="boolean")return X;if(Object.keys(X).length===0)return!0;return rU(Y,X),!tU(X,Y.self.RULES.all)}JB.alwaysValidSchema=Du;function rU(Y,X=Y.schema){let{opts:J,self:z}=Y;if(!J.strictSchema)return;if(typeof X==="boolean")return;let Q=z.RULES.keywords;for(let G in X)if(!Q[G])XB(Y,`unknown keyword: "${G}"`)}JB.checkUnknownRules=rU;function tU(Y,X){if(typeof Y=="boolean")return!Y;for(let J in Y)if(X[J])return!0;return!1}JB.schemaHasRules=tU;function ju(Y,X){if(typeof Y=="boolean")return!Y;for(let J in Y)if(J!=="$ref"&&X.all[J])return!0;return!1}JB.schemaHasRulesButRef=ju;function Cu({topSchemaRef:Y,schemaPath:X},J,z,Q){if(!Q){if(typeof J=="number"||typeof J=="boolean")return J;if(typeof J=="string")return y0._`${J}`}return y0._`${Y}${X}${(0,y0.getProperty)(z)}`}JB.schemaRefOrVal=Cu;function Eu(Y){return eU(decodeURIComponent(Y))}JB.unescapeFragment=Eu;function Su(Y){return encodeURIComponent(qJ(Y))}JB.escapeFragment=Su;function qJ(Y){if(typeof Y=="number")return`${Y}`;return Y.replace(/~/g,"~0").replace(/\//g,"~1")}JB.escapeJsonPointer=qJ;function eU(Y){return Y.replace(/~1/g,"/").replace(/~0/g,"~")}JB.unescapeJsonPointer=eU;function ku(Y,X){if(Array.isArray(Y))for(let J of Y)X(J);else X(Y)}JB.eachItem=ku;function aU({mergeNames:Y,mergeToName:X,mergeValues:J,resultToName:z}){return(Q,G,Z,$)=>{let H=Z===void 0?G:Z instanceof y0.Name?(G instanceof y0.Name?Y(Q,G,Z):X(Q,G,Z),Z):G instanceof y0.Name?(X(Q,Z,G),G):J(G,Z);return $===y0.Name&&!(H instanceof y0.Name)?z(Q,H):H}}JB.mergeEvaluated={props:aU({mergeNames:(Y,X,J)=>Y.if(y0._`${J} !== true && ${X} !== undefined`,()=>{Y.if(y0._`${X} === true`,()=>Y.assign(J,!0),()=>Y.assign(J,y0._`${J} || {}`).code(y0._`Object.assign(${J}, ${X})`))}),mergeToName:(Y,X,J)=>Y.if(y0._`${J} !== true`,()=>{if(X===!0)Y.assign(J,!0);else Y.assign(J,y0._`${J} || {}`),xJ(Y,J,X)}),mergeValues:(Y,X)=>Y===!0?!0:{...Y,...X},resultToName:YB}),items:aU({mergeNames:(Y,X,J)=>Y.if(y0._`${J} !== true && ${X} !== undefined`,()=>Y.assign(J,y0._`${X} === true ? true : ${J} > ${X} ? ${J} : ${X}`)),mergeToName:(Y,X,J)=>Y.if(y0._`${J} !== true`,()=>Y.assign(J,X===!0?!0:y0._`${J} > ${X} ? ${J} : ${X}`)),mergeValues:(Y,X)=>Y===!0?!0:Math.max(Y,X),resultToName:(Y,X)=>Y.var("items",X)})};function YB(Y,X){if(X===!0)return Y.var("props",!0);let J=Y.var("props",y0._`{}`);if(X!==void 0)xJ(Y,J,X);return J}JB.evaluatedPropsToName=YB;function xJ(Y,X,J){Object.keys(J).forEach((z)=>Y.assign(y0._`${X}${(0,y0.getProperty)(z)}`,!0))}JB.setEvaluated=xJ;var sU={};function _u(Y,X){return Y.scopeValue("func",{ref:X,code:sU[X.code]||(sU[X.code]=new Iu._Code(X.code))})}JB.useFunc=_u;var NJ;(function(Y){Y[Y.Num=0]="Num",Y[Y.Str=1]="Str"})(NJ||(JB.Type=NJ={}));function bu(Y,X,J){if(Y instanceof y0.Name){let z=X===NJ.Num;return J?z?y0._`"[" + ${Y} + "]"`:y0._`"['" + ${Y} + "']"`:z?y0._`"/" + ${Y}`:y0._`"/" + ${Y}.replace(/~/g, "~0").replace(/\\//g, "~1")`}return J?(0,y0.getProperty)(Y).toString():"/"+qJ(Y)}JB.getErrorPath=bu;function XB(Y,X,J=Y.opts.strictSchema){if(!J)return;if(X=`strict mode: ${X}`,J===!0)throw Error(X);Y.self.logger.warn(X)}JB.checkStrictMode=XB});var i4=C((QB)=>{Object.defineProperty(QB,"__esModule",{value:!0});var I1=F0(),tu={data:new I1.Name("data"),valCxt:new I1.Name("valCxt"),instancePath:new I1.Name("instancePath"),parentData:new I1.Name("parentData"),parentDataProperty:new I1.Name("parentDataProperty"),rootData:new I1.Name("rootData"),dynamicAnchors:new I1.Name("dynamicAnchors"),vErrors:new I1.Name("vErrors"),errors:new I1.Name("errors"),this:new I1.Name("this"),self:new I1.Name("self"),scope:new I1.Name("scope"),json:new I1.Name("json"),jsonPos:new I1.Name("jsonPos"),jsonLen:new I1.Name("jsonLen"),jsonPart:new I1.Name("jsonPart")};QB.default=tu});var p5=C((HB)=>{Object.defineProperty(HB,"__esModule",{value:!0});HB.extendErrors=HB.resetErrorsCount=HB.reportExtraError=HB.reportError=HB.keyword$DataError=HB.keywordError=void 0;var j0=F0(),$9=E0(),D1=i4();HB.keywordError={message:({keyword:Y})=>j0.str`must pass "${Y}" keyword validation`};HB.keyword$DataError={message:({keyword:Y,schemaType:X})=>X?j0.str`"${Y}" keyword must be ${X} ($data)`:j0.str`"${Y}" keyword is invalid ($data)`};function Yg(Y,X=HB.keywordError,J,z){let{it:Q}=Y,{gen:G,compositeRule:Z,allErrors:$}=Q,H=$B(Y,X,J);if(z!==null&&z!==void 0?z:Z||$)GB(G,H);else ZB(Q,j0._`[${H}]`)}HB.reportError=Yg;function Xg(Y,X=HB.keywordError,J){let{it:z}=Y,{gen:Q,compositeRule:G,allErrors:Z}=z,$=$B(Y,X,J);if(GB(Q,$),!(G||Z))ZB(z,D1.default.vErrors)}HB.reportExtraError=Xg;function Jg(Y,X){Y.assign(D1.default.errors,X),Y.if(j0._`${D1.default.vErrors} !== null`,()=>Y.if(X,()=>Y.assign(j0._`${D1.default.vErrors}.length`,X),()=>Y.assign(D1.default.vErrors,null)))}HB.resetErrorsCount=Jg;function zg({gen:Y,keyword:X,schemaValue:J,data:z,errsCount:Q,it:G}){if(Q===void 0)throw Error("ajv implementation error");let Z=Y.name("err");Y.forRange("i",Q,D1.default.errors,($)=>{if(Y.const(Z,j0._`${D1.default.vErrors}[${$}]`),Y.if(j0._`${Z}.instancePath === undefined`,()=>Y.assign(j0._`${Z}.instancePath`,(0,j0.strConcat)(D1.default.instancePath,G.errorPath))),Y.assign(j0._`${Z}.schemaPath`,j0.str`${G.errSchemaPath}/${X}`),G.opts.verbose)Y.assign(j0._`${Z}.schema`,J),Y.assign(j0._`${Z}.data`,z)})}HB.extendErrors=zg;function GB(Y,X){let J=Y.const("err",X);Y.if(j0._`${D1.default.vErrors} === null`,()=>Y.assign(D1.default.vErrors,j0._`[${J}]`),j0._`${D1.default.vErrors}.push(${J})`),Y.code(j0._`${D1.default.errors}++`)}function ZB(Y,X){let{gen:J,validateName:z,schemaEnv:Q}=Y;if(Q.$async)J.throw(j0._`new ${Y.ValidationError}(${X})`);else J.assign(j0._`${z}.errors`,X),J.return(!1)}var f8={keyword:new j0.Name("keyword"),schemaPath:new j0.Name("schemaPath"),params:new j0.Name("params"),propertyName:new j0.Name("propertyName"),message:new j0.Name("message"),schema:new j0.Name("schema"),parentSchema:new j0.Name("parentSchema")};function $B(Y,X,J){let{createErrors:z}=Y.it;if(z===!1)return j0._`{}`;return Qg(Y,X,J)}function Qg(Y,X,J={}){let{gen:z,it:Q}=Y,G=[Gg(Q,J),Zg(Y,J)];return $g(Y,X,G),z.object(...G)}function Gg({errorPath:Y},{instancePath:X}){let J=X?j0.str`${Y}${(0,$9.getErrorPath)(X,$9.Type.Str)}`:Y;return[D1.default.instancePath,(0,j0.strConcat)(D1.default.instancePath,J)]}function Zg({keyword:Y,it:{errSchemaPath:X}},{schemaPath:J,parentSchema:z}){let Q=z?X:j0.str`${X}/${Y}`;if(J)Q=j0.str`${Q}${(0,$9.getErrorPath)(J,$9.Type.Str)}`;return[f8.schemaPath,Q]}function $g(Y,{params:X,message:J},z){let{keyword:Q,data:G,schemaValue:Z,it:$}=Y,{opts:H,propertyName:W,topSchemaRef:K,schemaPath:U}=$;if(z.push([f8.keyword,Q],[f8.params,typeof X=="function"?X(Y):X||j0._`{}`]),H.messages)z.push([f8.message,typeof J=="function"?J(Y):J]);if(H.verbose)z.push([f8.schema,Z],[f8.parentSchema,j0._`${K}${U}`],[D1.default.data,G]);if(W)z.push([f8.propertyName,W])}});var VB=C((UB)=>{Object.defineProperty(UB,"__esModule",{value:!0});UB.boolOrEmptySchema=UB.topBoolOrEmptySchema=void 0;var Bg=p5(),Vg=F0(),Og=i4(),Mg={message:"boolean schema is false"};function Lg(Y){let{gen:X,schema:J,validateName:z}=Y;if(J===!1)KB(Y,!1);else if(typeof J=="object"&&J.$async===!0)X.return(Og.default.data);else X.assign(Vg._`${z}.errors`,null),X.return(!0)}UB.topBoolOrEmptySchema=Lg;function Ng(Y,X){let{gen:J,schema:z}=Y;if(z===!1)J.var(X,!1),KB(Y);else J.var(X,!0)}UB.boolOrEmptySchema=Ng;function KB(Y,X){let{gen:J,data:z}=Y,Q={gen:J,keyword:"false schema",data:z,schema:!1,schemaCode:!1,schemaValue:!1,params:{},it:Y};(0,Bg.reportError)(Q,Mg,void 0,X)}});var PJ=C((OB)=>{Object.defineProperty(OB,"__esModule",{value:!0});OB.getRules=OB.isJSONType=void 0;var xg=["string","number","integer","boolean","null","object","array"],Fg=new Set(xg);function Pg(Y){return typeof Y=="string"&&Fg.has(Y)}OB.isJSONType=Pg;function Ag(){let Y={number:{type:"number",rules:[]},string:{type:"string",rules:[]},array:{type:"array",rules:[]},object:{type:"object",rules:[]}};return{types:{...Y,integer:!0,boolean:!0,null:!0},rules:[{rules:[]},Y.number,Y.string,Y.array,Y.object],post:{rules:[]},all:{},keywords:{}}}OB.getRules=Ag});var AJ=C((qB)=>{Object.defineProperty(qB,"__esModule",{value:!0});qB.shouldUseRule=qB.shouldUseGroup=qB.schemaHasRulesForType=void 0;function Tg({schema:Y,self:X},J){let z=X.RULES.types[J];return z&&z!==!0&&LB(Y,z)}qB.schemaHasRulesForType=Tg;function LB(Y,X){return X.rules.some((J)=>NB(Y,J))}qB.shouldUseGroup=LB;function NB(Y,X){var J;return Y[X.keyword]!==void 0||((J=X.definition.implements)===null||J===void 0?void 0:J.some((z)=>Y[z]!==void 0))}qB.shouldUseRule=NB});var c5=C((wB)=>{Object.defineProperty(wB,"__esModule",{value:!0});wB.reportTypeError=wB.checkDataTypes=wB.checkDataType=wB.coerceAndCheckDataType=wB.getJSONTypes=wB.getSchemaTypes=wB.DataType=void 0;var Dg=PJ(),jg=AJ(),Cg=p5(),x0=F0(),FB=E0(),T6;(function(Y){Y[Y.Correct=0]="Correct",Y[Y.Wrong=1]="Wrong"})(T6||(wB.DataType=T6={}));function Eg(Y){let X=PB(Y.type);if(X.includes("null")){if(Y.nullable===!1)throw Error("type: null contradicts nullable: false")}else{if(!X.length&&Y.nullable!==void 0)throw Error('"nullable" cannot be used without "type"');if(Y.nullable===!0)X.push("null")}return X}wB.getSchemaTypes=Eg;function PB(Y){let X=Array.isArray(Y)?Y:Y?[Y]:[];if(X.every(Dg.isJSONType))return X;throw Error("type must be JSONType or JSONType[]: "+X.join(","))}wB.getJSONTypes=PB;function Sg(Y,X){let{gen:J,data:z,opts:Q}=Y,G=kg(X,Q.coerceTypes),Z=X.length>0&&!(G.length===0&&X.length===1&&(0,jg.schemaHasRulesForType)(Y,X[0]));if(Z){let $=TJ(X,z,Q.strictNumbers,T6.Wrong);J.if($,()=>{if(G.length)_g(Y,X,G);else IJ(Y)})}return Z}wB.coerceAndCheckDataType=Sg;var AB=new Set(["string","number","integer","boolean","null"]);function kg(Y,X){return X?Y.filter((J)=>AB.has(J)||X==="array"&&J==="array"):[]}function _g(Y,X,J){let{gen:z,data:Q,opts:G}=Y,Z=z.let("dataType",x0._`typeof ${Q}`),$=z.let("coerced",x0._`undefined`);if(G.coerceTypes==="array")z.if(x0._`${Z} == 'object' && Array.isArray(${Q}) && ${Q}.length == 1`,()=>z.assign(Q,x0._`${Q}[0]`).assign(Z,x0._`typeof ${Q}`).if(TJ(X,Q,G.strictNumbers),()=>z.assign($,Q)));z.if(x0._`${$} !== undefined`);for(let W of J)if(AB.has(W)||W==="array"&&G.coerceTypes==="array")H(W);z.else(),IJ(Y),z.endIf(),z.if(x0._`${$} !== undefined`,()=>{z.assign(Q,$),bg(Y,$)});function H(W){switch(W){case"string":z.elseIf(x0._`${Z} == "number" || ${Z} == "boolean"`).assign($,x0._`"" + ${Q}`).elseIf(x0._`${Q} === null`).assign($,x0._`""`);return;case"number":z.elseIf(x0._`${Z} == "boolean" || ${Q} === null
              || (${Z} == "string" && ${Q} && ${Q} == +${Q})`).assign($,x0._`+${Q}`);return;case"integer":z.elseIf(x0._`${Z} === "boolean" || ${Q} === null
              || (${Z} === "string" && ${Q} && ${Q} == +${Q} && !(${Q} % 1))`).assign($,x0._`+${Q}`);return;case"boolean":z.elseIf(x0._`${Q} === "false" || ${Q} === 0 || ${Q} === null`).assign($,!1).elseIf(x0._`${Q} === "true" || ${Q} === 1`).assign($,!0);return;case"null":z.elseIf(x0._`${Q} === "" || ${Q} === 0 || ${Q} === false`),z.assign($,null);return;case"array":z.elseIf(x0._`${Z} === "string" || ${Z} === "number"
              || ${Z} === "boolean" || ${Q} === null`).assign($,x0._`[${Q}]`)}}}function bg({gen:Y,parentData:X,parentDataProperty:J},z){Y.if(x0._`${X} !== undefined`,()=>Y.assign(x0._`${X}[${J}]`,z))}function wJ(Y,X,J,z=T6.Correct){let Q=z===T6.Correct?x0.operators.EQ:x0.operators.NEQ,G;switch(Y){case"null":return x0._`${X} ${Q} null`;case"array":G=x0._`Array.isArray(${X})`;break;case"object":G=x0._`${X} && typeof ${X} == "object" && !Array.isArray(${X})`;break;case"integer":G=Z(x0._`!(${X} % 1) && !isNaN(${X})`);break;case"number":G=Z();break;default:return x0._`typeof ${X} ${Q} ${Y}`}return z===T6.Correct?G:(0,x0.not)(G);function Z($=x0.nil){return(0,x0.and)(x0._`typeof ${X} == "number"`,$,J?x0._`isFinite(${X})`:x0.nil)}}wB.checkDataType=wJ;function TJ(Y,X,J,z){if(Y.length===1)return wJ(Y[0],X,J,z);let Q,G=(0,FB.toHash)(Y);if(G.array&&G.object){let Z=x0._`typeof ${X} != "object"`;Q=G.null?Z:x0._`!${X} || ${Z}`,delete G.null,delete G.array,delete G.object}else Q=x0.nil;if(G.number)delete G.integer;for(let Z in G)Q=(0,x0.and)(Q,wJ(Z,X,J,z));return Q}wB.checkDataTypes=TJ;var Rg={message:({schema:Y})=>`must be ${Y}`,params:({schema:Y,schemaValue:X})=>typeof Y=="string"?x0._`{type: ${Y}}`:x0._`{type: ${X}}`};function IJ(Y){let X=fg(Y);(0,Cg.reportError)(X,Rg)}wB.reportTypeError=IJ;function fg(Y){let{gen:X,data:J,schema:z}=Y,Q=(0,FB.schemaRefOrVal)(Y,z,"type");return{gen:X,keyword:"type",data:J,schema:z.type,schemaCode:Q,schemaValue:Q,parentSchema:z,params:{},it:Y}}});var jB=C((vB)=>{Object.defineProperty(vB,"__esModule",{value:!0});vB.assignDefaults=void 0;var I6=F0(),cg=E0();function dg(Y,X){let{properties:J,items:z}=Y.schema;if(X==="object"&&J)for(let Q in J)IB(Y,Q,J[Q].default);else if(X==="array"&&Array.isArray(z))z.forEach((Q,G)=>IB(Y,G,Q.default))}vB.assignDefaults=dg;function IB(Y,X,J){let{gen:z,compositeRule:Q,data:G,opts:Z}=Y;if(J===void 0)return;let $=I6._`${G}${(0,I6.getProperty)(X)}`;if(Q){(0,cg.checkStrictMode)(Y,`default is ignored for: ${$}`);return}let H=I6._`${$} === undefined`;if(Z.useDefaults==="empty")H=I6._`${H} || ${$} === null || ${$} === ""`;z.if(H,I6._`${$} = ${(0,I6.stringify)(J)}`)}});var r1=C((SB)=>{Object.defineProperty(SB,"__esModule",{value:!0});SB.validateUnion=SB.validateArray=SB.usePattern=SB.callValidateCode=SB.schemaProperties=SB.allSchemaProperties=SB.noPropertyInData=SB.propertyInData=SB.isOwnProperty=SB.hasPropFunc=SB.reportMissingProp=SB.checkMissingProp=SB.checkReportMissingProp=void 0;var g0=F0(),vJ=E0(),M8=i4(),lg=E0();function ig(Y,X){let{gen:J,data:z,it:Q}=Y;J.if(jJ(J,z,X,Q.opts.ownProperties),()=>{Y.setParams({missingProperty:g0._`${X}`},!0),Y.error()})}SB.checkReportMissingProp=ig;function ng({gen:Y,data:X,it:{opts:J}},z,Q){return(0,g0.or)(...z.map((G)=>(0,g0.and)(jJ(Y,X,G,J.ownProperties),g0._`${Q} = ${G}`)))}SB.checkMissingProp=ng;function og(Y,X){Y.setParams({missingProperty:X},!0),Y.error()}SB.reportMissingProp=og;function CB(Y){return Y.scopeValue("func",{ref:Object.prototype.hasOwnProperty,code:g0._`Object.prototype.hasOwnProperty`})}SB.hasPropFunc=CB;function DJ(Y,X,J){return g0._`${CB(Y)}.call(${X}, ${J})`}SB.isOwnProperty=DJ;function ag(Y,X,J,z){let Q=g0._`${X}${(0,g0.getProperty)(J)} !== undefined`;return z?g0._`${Q} && ${DJ(Y,X,J)}`:Q}SB.propertyInData=ag;function jJ(Y,X,J,z){let Q=g0._`${X}${(0,g0.getProperty)(J)} === undefined`;return z?(0,g0.or)(Q,(0,g0.not)(DJ(Y,X,J))):Q}SB.noPropertyInData=jJ;function EB(Y){return Y?Object.keys(Y).filter((X)=>X!=="__proto__"):[]}SB.allSchemaProperties=EB;function sg(Y,X){return EB(X).filter((J)=>!(0,vJ.alwaysValidSchema)(Y,X[J]))}SB.schemaProperties=sg;function rg({schemaCode:Y,data:X,it:{gen:J,topSchemaRef:z,schemaPath:Q,errorPath:G},it:Z},$,H,W){let K=W?g0._`${Y}, ${X}, ${z}${Q}`:X,U=[[M8.default.instancePath,(0,g0.strConcat)(M8.default.instancePath,G)],[M8.default.parentData,Z.parentData],[M8.default.parentDataProperty,Z.parentDataProperty],[M8.default.rootData,M8.default.rootData]];if(Z.opts.dynamicRef)U.push([M8.default.dynamicAnchors,M8.default.dynamicAnchors]);let B=g0._`${K}, ${J.object(...U)}`;return H!==g0.nil?g0._`${$}.call(${H}, ${B})`:g0._`${$}(${B})`}SB.callValidateCode=rg;var tg=g0._`new RegExp`;function eg({gen:Y,it:{opts:X}},J){let z=X.unicodeRegExp?"u":"",{regExp:Q}=X.code,G=Q(J,z);return Y.scopeValue("pattern",{key:G.toString(),ref:G,code:g0._`${Q.code==="new RegExp"?tg:(0,lg.useFunc)(Y,Q)}(${J}, ${z})`})}SB.usePattern=eg;function Yp(Y){let{gen:X,data:J,keyword:z,it:Q}=Y,G=X.name("valid");if(Q.allErrors){let $=X.let("valid",!0);return Z(()=>X.assign($,!1)),$}return X.var(G,!0),Z(()=>X.break()),G;function Z($){let H=X.const("len",g0._`${J}.length`);X.forRange("i",0,H,(W)=>{Y.subschema({keyword:z,dataProp:W,dataPropType:vJ.Type.Num},G),X.if((0,g0.not)(G),$)})}}SB.validateArray=Yp;function Xp(Y){let{gen:X,schema:J,keyword:z,it:Q}=Y;if(!Array.isArray(J))throw Error("ajv implementation error");if(J.some((H)=>(0,vJ.alwaysValidSchema)(Q,H))&&!Q.opts.unevaluated)return;let Z=X.let("valid",!1),$=X.name("_valid");X.block(()=>J.forEach((H,W)=>{let K=Y.subschema({keyword:z,schemaProp:W,compositeRule:!0},$);if(X.assign(Z,g0._`${Z} || ${$}`),!Y.mergeValidEvaluated(K,$))X.if((0,g0.not)(Z))})),Y.result(Z,()=>Y.reset(),()=>Y.error(!0))}SB.validateUnion=Xp});var yB=C((RB)=>{Object.defineProperty(RB,"__esModule",{value:!0});RB.validateKeywordUsage=RB.validSchemaType=RB.funcKeywordCode=RB.macroKeywordCode=void 0;var j1=F0(),y8=i4(),Op=r1(),Mp=p5();function Lp(Y,X){let{gen:J,keyword:z,schema:Q,parentSchema:G,it:Z}=Y,$=X.macro.call(Z.self,Q,G,Z),H=bB(J,z,$);if(Z.opts.validateSchema!==!1)Z.self.validateSchema($,!0);let W=J.name("valid");Y.subschema({schema:$,schemaPath:j1.nil,errSchemaPath:`${Z.errSchemaPath}/${z}`,topSchemaRef:H,compositeRule:!0},W),Y.pass(W,()=>Y.error(!0))}RB.macroKeywordCode=Lp;function Np(Y,X){var J;let{gen:z,keyword:Q,schema:G,parentSchema:Z,$data:$,it:H}=Y;xp(H,X);let W=!$&&X.compile?X.compile.call(H.self,G,Z,H):X.validate,K=bB(z,Q,W),U=z.let("valid");Y.block$data(U,B),Y.ok((J=X.valid)!==null&&J!==void 0?J:U);function B(){if(X.errors===!1){if(L(),X.modifying)_B(Y);q(()=>Y.error())}else{let F=X.async?O():V();if(X.modifying)_B(Y);q(()=>qp(Y,F))}}function O(){let F=z.let("ruleErrs",null);return z.try(()=>L(j1._`await `),(P)=>z.assign(U,!1).if(j1._`${P} instanceof ${H.ValidationError}`,()=>z.assign(F,j1._`${P}.errors`),()=>z.throw(P))),F}function V(){let F=j1._`${K}.errors`;return z.assign(F,null),L(j1.nil),F}function L(F=X.async?j1._`await `:j1.nil){let P=H.opts.passContext?y8.default.this:y8.default.self,A=!(("compile"in X)&&!$||X.schema===!1);z.assign(U,j1._`${F}${(0,Op.callValidateCode)(Y,K,P,A)}`,X.modifying)}function q(F){var P;z.if((0,j1.not)((P=X.valid)!==null&&P!==void 0?P:U),F)}}RB.funcKeywordCode=Np;function _B(Y){let{gen:X,data:J,it:z}=Y;X.if(z.parentData,()=>X.assign(J,j1._`${z.parentData}[${z.parentDataProperty}]`))}function qp(Y,X){let{gen:J}=Y;J.if(j1._`Array.isArray(${X})`,()=>{J.assign(y8.default.vErrors,j1._`${y8.default.vErrors} === null ? ${X} : ${y8.default.vErrors}.concat(${X})`).assign(y8.default.errors,j1._`${y8.default.vErrors}.length`),(0,Mp.extendErrors)(Y)},()=>Y.error())}function xp({schemaEnv:Y},X){if(X.async&&!Y.$async)throw Error("async keyword in sync schema")}function bB(Y,X,J){if(J===void 0)throw Error(`keyword "${X}" failed to compile`);return Y.scopeValue("keyword",typeof J=="function"?{ref:J}:{ref:J,code:(0,j1.stringify)(J)})}function Fp(Y,X,J=!1){return!X.length||X.some((z)=>z==="array"?Array.isArray(Y):z==="object"?Y&&typeof Y=="object"&&!Array.isArray(Y):typeof Y==z||J&&typeof Y>"u")}RB.validSchemaType=Fp;function Pp({schema:Y,opts:X,self:J,errSchemaPath:z},Q,G){if(Array.isArray(Q.keyword)?!Q.keyword.includes(G):Q.keyword!==G)throw Error("ajv implementation error");let Z=Q.dependencies;if(Z===null||Z===void 0?void 0:Z.some(($)=>!Object.prototype.hasOwnProperty.call(Y,$)))throw Error(`parent schema must have dependencies of ${G}: ${Z.join(",")}`);if(Q.validateSchema){if(!Q.validateSchema(Y[G])){let H=`keyword "${G}" value is invalid at path "${z}": `+J.errorsText(Q.validateSchema.errors);if(X.validateSchema==="log")J.logger.error(H);else throw Error(H)}}}RB.validateKeywordUsage=Pp});var gB=C((mB)=>{Object.defineProperty(mB,"__esModule",{value:!0});mB.extendSubschemaMode=mB.extendSubschemaData=mB.getSubschema=void 0;var v4=F0(),hB=E0();function Ip(Y,{keyword:X,schemaProp:J,schema:z,schemaPath:Q,errSchemaPath:G,topSchemaRef:Z}){if(X!==void 0&&z!==void 0)throw Error('both "keyword" and "schema" passed, only one allowed');if(X!==void 0){let $=Y.schema[X];return J===void 0?{schema:$,schemaPath:v4._`${Y.schemaPath}${(0,v4.getProperty)(X)}`,errSchemaPath:`${Y.errSchemaPath}/${X}`}:{schema:$[J],schemaPath:v4._`${Y.schemaPath}${(0,v4.getProperty)(X)}${(0,v4.getProperty)(J)}`,errSchemaPath:`${Y.errSchemaPath}/${X}/${(0,hB.escapeFragment)(J)}`}}if(z!==void 0){if(Q===void 0||G===void 0||Z===void 0)throw Error('"schemaPath", "errSchemaPath" and "topSchemaRef" are required with "schema"');return{schema:z,schemaPath:Q,topSchemaRef:Z,errSchemaPath:G}}throw Error('either "keyword" or "schema" must be passed')}mB.getSubschema=Ip;function vp(Y,X,{dataProp:J,dataPropType:z,data:Q,dataTypes:G,propertyName:Z}){if(Q!==void 0&&J!==void 0)throw Error('both "data" and "dataProp" passed, only one allowed');let{gen:$}=X;if(J!==void 0){let{errorPath:W,dataPathArr:K,opts:U}=X,B=$.let("data",v4._`${X.data}${(0,v4.getProperty)(J)}`,!0);H(B),Y.errorPath=v4.str`${W}${(0,hB.getErrorPath)(J,z,U.jsPropertySyntax)}`,Y.parentDataProperty=v4._`${J}`,Y.dataPathArr=[...K,Y.parentDataProperty]}if(Q!==void 0){let W=Q instanceof v4.Name?Q:$.let("data",Q,!0);if(H(W),Z!==void 0)Y.propertyName=Z}if(G)Y.dataTypes=G;function H(W){Y.data=W,Y.dataLevel=X.dataLevel+1,Y.dataTypes=[],X.definedProperties=new Set,Y.parentData=X.data,Y.dataNames=[...X.dataNames,W]}}mB.extendSubschemaData=vp;function Dp(Y,{jtdDiscriminator:X,jtdMetadata:J,compositeRule:z,createErrors:Q,allErrors:G}){if(z!==void 0)Y.compositeRule=z;if(Q!==void 0)Y.createErrors=Q;if(G!==void 0)Y.allErrors=G;Y.jtdDiscriminator=X,Y.jtdMetadata=J}mB.extendSubschemaMode=Dp});var CJ=C((QH0,pB)=>{pB.exports=function Y(X,J){if(X===J)return!0;if(X&&J&&typeof X=="object"&&typeof J=="object"){if(X.constructor!==J.constructor)return!1;var z,Q,G;if(Array.isArray(X)){if(z=X.length,z!=J.length)return!1;for(Q=z;Q--!==0;)if(!Y(X[Q],J[Q]))return!1;return!0}if(X.constructor===RegExp)return X.source===J.source&&X.flags===J.flags;if(X.valueOf!==Object.prototype.valueOf)return X.valueOf()===J.valueOf();if(X.toString!==Object.prototype.toString)return X.toString()===J.toString();if(G=Object.keys(X),z=G.length,z!==Object.keys(J).length)return!1;for(Q=z;Q--!==0;)if(!Object.prototype.hasOwnProperty.call(J,G[Q]))return!1;for(Q=z;Q--!==0;){var Z=G[Q];if(!Y(X[Z],J[Z]))return!1}return!0}return X!==X&&J!==J}});var dB=C((GH0,cB)=>{var L8=cB.exports=function(Y,X,J){if(typeof X=="function")J=X,X={};J=X.cb||J;var z=typeof J=="function"?J:J.pre||function(){},Q=J.post||function(){};H9(X,z,Q,Y,"",Y)};L8.keywords={additionalItems:!0,items:!0,contains:!0,additionalProperties:!0,propertyNames:!0,not:!0,if:!0,then:!0,else:!0};L8.arrayKeywords={items:!0,allOf:!0,anyOf:!0,oneOf:!0};L8.propsKeywords={$defs:!0,definitions:!0,properties:!0,patternProperties:!0,dependencies:!0};L8.skipKeywords={default:!0,enum:!0,const:!0,required:!0,maximum:!0,minimum:!0,exclusiveMaximum:!0,exclusiveMinimum:!0,multipleOf:!0,maxLength:!0,minLength:!0,pattern:!0,format:!0,maxItems:!0,minItems:!0,uniqueItems:!0,maxProperties:!0,minProperties:!0};function H9(Y,X,J,z,Q,G,Z,$,H,W){if(z&&typeof z=="object"&&!Array.isArray(z)){X(z,Q,G,Z,$,H,W);for(var K in z){var U=z[K];if(Array.isArray(U)){if(K in L8.arrayKeywords)for(var B=0;B<U.length;B++)H9(Y,X,J,U[B],Q+"/"+K+"/"+B,G,Q,K,z,B)}else if(K in L8.propsKeywords){if(U&&typeof U=="object")for(var O in U)H9(Y,X,J,U[O],Q+"/"+K+"/"+Ep(O),G,Q,K,z,O)}else if(K in L8.keywords||Y.allKeys&&!(K in L8.skipKeywords))H9(Y,X,J,U,Q+"/"+K,G,Q,K,z)}J(z,Q,G,Z,$,H,W)}}function Ep(Y){return Y.replace(/~/g,"~0").replace(/\//g,"~1")}});var d5=C((oB)=>{Object.defineProperty(oB,"__esModule",{value:!0});oB.getSchemaRefs=oB.resolveUrl=oB.normalizeId=oB._getFullPath=oB.getFullPath=oB.inlineRef=void 0;var Sp=E0(),kp=CJ(),_p=dB(),bp=new Set(["type","format","pattern","maxLength","minLength","maxProperties","minProperties","maxItems","minItems","maximum","minimum","uniqueItems","multipleOf","required","enum","const"]);function Rp(Y,X=!0){if(typeof Y=="boolean")return!0;if(X===!0)return!EJ(Y);if(!X)return!1;return lB(Y)<=X}oB.inlineRef=Rp;var fp=new Set(["$ref","$recursiveRef","$recursiveAnchor","$dynamicRef","$dynamicAnchor"]);function EJ(Y){for(let X in Y){if(fp.has(X))return!0;let J=Y[X];if(Array.isArray(J)&&J.some(EJ))return!0;if(typeof J=="object"&&EJ(J))return!0}return!1}function lB(Y){let X=0;for(let J in Y){if(J==="$ref")return 1/0;if(X++,bp.has(J))continue;if(typeof Y[J]=="object")(0,Sp.eachItem)(Y[J],(z)=>X+=lB(z));if(X===1/0)return 1/0}return X}function iB(Y,X="",J){if(J!==!1)X=v6(X);let z=Y.parse(X);return nB(Y,z)}oB.getFullPath=iB;function nB(Y,X){return Y.serialize(X).split("#")[0]+"#"}oB._getFullPath=nB;var yp=/#\/?$/;function v6(Y){return Y?Y.replace(yp,""):""}oB.normalizeId=v6;function hp(Y,X,J){return J=v6(J),Y.resolve(X,J)}oB.resolveUrl=hp;var mp=/^[a-z_][-a-z0-9._]*$/i;function up(Y,X){if(typeof Y=="boolean")return{};let{schemaId:J,uriResolver:z}=this.opts,Q=v6(Y[J]||X),G={"":Q},Z=iB(z,Q,!1),$={},H=new Set;return _p(Y,{allKeys:!0},(U,B,O,V)=>{if(V===void 0)return;let L=Z+B,q=G[V];if(typeof U[J]=="string")q=F.call(this,U[J]);P.call(this,U.$anchor),P.call(this,U.$dynamicAnchor),G[B]=q;function F(A){let w=this.opts.uriResolver.resolve;if(A=v6(q?w(q,A):A),H.has(A))throw K(A);H.add(A);let v=this.refs[A];if(typeof v=="string")v=this.refs[v];if(typeof v=="object")W(U,v.schema,A);else if(A!==v6(L))if(A[0]==="#")W(U,$[A],A),$[A]=U;else this.refs[A]=L;return A}function P(A){if(typeof A=="string"){if(!mp.test(A))throw Error(`invalid anchor "${A}"`);F.call(this,`#${A}`)}}}),$;function W(U,B,O){if(B!==void 0&&!kp(U,B))throw K(O)}function K(U){return Error(`reference "${U}" resolves to more than one schema`)}}oB.getSchemaRefs=up});var n5=C((KV)=>{Object.defineProperty(KV,"__esModule",{value:!0});KV.getData=KV.KeywordCxt=KV.validateFunctionCode=void 0;var YV=VB(),sB=c5(),kJ=AJ(),W9=c5(),ip=jB(),i5=yB(),SJ=gB(),$0=F0(),M0=i4(),np=d5(),n4=E0(),l5=p5();function op(Y){if(zV(Y)){if(QV(Y),JV(Y)){rp(Y);return}}XV(Y,()=>(0,YV.topBoolOrEmptySchema)(Y))}KV.validateFunctionCode=op;function XV({gen:Y,validateName:X,schema:J,schemaEnv:z,opts:Q},G){if(Q.code.es5)Y.func(X,$0._`${M0.default.data}, ${M0.default.valCxt}`,z.$async,()=>{Y.code($0._`"use strict"; ${rB(J,Q)}`),sp(Y,Q),Y.code(G)});else Y.func(X,$0._`${M0.default.data}, ${ap(Q)}`,z.$async,()=>Y.code(rB(J,Q)).code(G))}function ap(Y){return $0._`{${M0.default.instancePath}="", ${M0.default.parentData}, ${M0.default.parentDataProperty}, ${M0.default.rootData}=${M0.default.data}${Y.dynamicRef?$0._`, ${M0.default.dynamicAnchors}={}`:$0.nil}}={}`}function sp(Y,X){Y.if(M0.default.valCxt,()=>{if(Y.var(M0.default.instancePath,$0._`${M0.default.valCxt}.${M0.default.instancePath}`),Y.var(M0.default.parentData,$0._`${M0.default.valCxt}.${M0.default.parentData}`),Y.var(M0.default.parentDataProperty,$0._`${M0.default.valCxt}.${M0.default.parentDataProperty}`),Y.var(M0.default.rootData,$0._`${M0.default.valCxt}.${M0.default.rootData}`),X.dynamicRef)Y.var(M0.default.dynamicAnchors,$0._`${M0.default.valCxt}.${M0.default.dynamicAnchors}`)},()=>{if(Y.var(M0.default.instancePath,$0._`""`),Y.var(M0.default.parentData,$0._`undefined`),Y.var(M0.default.parentDataProperty,$0._`undefined`),Y.var(M0.default.rootData,M0.default.data),X.dynamicRef)Y.var(M0.default.dynamicAnchors,$0._`{}`)})}function rp(Y){let{schema:X,opts:J,gen:z}=Y;XV(Y,()=>{if(J.$comment&&X.$comment)ZV(Y);if(Jc(Y),z.let(M0.default.vErrors,null),z.let(M0.default.errors,0),J.unevaluated)tp(Y);GV(Y),Gc(Y)});return}function tp(Y){let{gen:X,validateName:J}=Y;Y.evaluated=X.const("evaluated",$0._`${J}.evaluated`),X.if($0._`${Y.evaluated}.dynamicProps`,()=>X.assign($0._`${Y.evaluated}.props`,$0._`undefined`)),X.if($0._`${Y.evaluated}.dynamicItems`,()=>X.assign($0._`${Y.evaluated}.items`,$0._`undefined`))}function rB(Y,X){let J=typeof Y=="object"&&Y[X.schemaId];return J&&(X.code.source||X.code.process)?$0._`/*# sourceURL=${J} */`:$0.nil}function ep(Y,X){if(zV(Y)){if(QV(Y),JV(Y)){Yc(Y,X);return}}(0,YV.boolOrEmptySchema)(Y,X)}function JV({schema:Y,self:X}){if(typeof Y=="boolean")return!Y;for(let J in Y)if(X.RULES.all[J])return!0;return!1}function zV(Y){return typeof Y.schema!="boolean"}function Yc(Y,X){let{schema:J,gen:z,opts:Q}=Y;if(Q.$comment&&J.$comment)ZV(Y);zc(Y),Qc(Y);let G=z.const("_errs",M0.default.errors);GV(Y,G),z.var(X,$0._`${G} === ${M0.default.errors}`)}function QV(Y){(0,n4.checkUnknownRules)(Y),Xc(Y)}function GV(Y,X){if(Y.opts.jtd)return tB(Y,[],!1,X);let J=(0,sB.getSchemaTypes)(Y.schema),z=(0,sB.coerceAndCheckDataType)(Y,J);tB(Y,J,!z,X)}function Xc(Y){let{schema:X,errSchemaPath:J,opts:z,self:Q}=Y;if(X.$ref&&z.ignoreKeywordsWithRef&&(0,n4.schemaHasRulesButRef)(X,Q.RULES))Q.logger.warn(`$ref: keywords ignored in schema at path "${J}"`)}function Jc(Y){let{schema:X,opts:J}=Y;if(X.default!==void 0&&J.useDefaults&&J.strictSchema)(0,n4.checkStrictMode)(Y,"default is ignored in the schema root")}function zc(Y){let X=Y.schema[Y.opts.schemaId];if(X)Y.baseId=(0,np.resolveUrl)(Y.opts.uriResolver,Y.baseId,X)}function Qc(Y){if(Y.schema.$async&&!Y.schemaEnv.$async)throw Error("async schema in sync schema")}function ZV({gen:Y,schemaEnv:X,schema:J,errSchemaPath:z,opts:Q}){let G=J.$comment;if(Q.$comment===!0)Y.code($0._`${M0.default.self}.logger.log(${G})`);else if(typeof Q.$comment=="function"){let Z=$0.str`${z}/$comment`,$=Y.scopeValue("root",{ref:X.root});Y.code($0._`${M0.default.self}.opts.$comment(${G}, ${Z}, ${$}.schema)`)}}function Gc(Y){let{gen:X,schemaEnv:J,validateName:z,ValidationError:Q,opts:G}=Y;if(J.$async)X.if($0._`${M0.default.errors} === 0`,()=>X.return(M0.default.data),()=>X.throw($0._`new ${Q}(${M0.default.vErrors})`));else{if(X.assign($0._`${z}.errors`,M0.default.vErrors),G.unevaluated)Zc(Y);X.return($0._`${M0.default.errors} === 0`)}}function Zc({gen:Y,evaluated:X,props:J,items:z}){if(J instanceof $0.Name)Y.assign($0._`${X}.props`,J);if(z instanceof $0.Name)Y.assign($0._`${X}.items`,z)}function tB(Y,X,J,z){let{gen:Q,schema:G,data:Z,allErrors:$,opts:H,self:W}=Y,{RULES:K}=W;if(G.$ref&&(H.ignoreKeywordsWithRef||!(0,n4.schemaHasRulesButRef)(G,K))){Q.block(()=>HV(Y,"$ref",K.all.$ref.definition));return}if(!H.jtd)$c(Y,X);Q.block(()=>{for(let B of K.rules)U(B);U(K.post)});function U(B){if(!(0,kJ.shouldUseGroup)(G,B))return;if(B.type){if(Q.if((0,W9.checkDataType)(B.type,Z,H.strictNumbers)),eB(Y,B),X.length===1&&X[0]===B.type&&J)Q.else(),(0,W9.reportTypeError)(Y);Q.endIf()}else eB(Y,B);if(!$)Q.if($0._`${M0.default.errors} === ${z||0}`)}}function eB(Y,X){let{gen:J,schema:z,opts:{useDefaults:Q}}=Y;if(Q)(0,ip.assignDefaults)(Y,X.type);J.block(()=>{for(let G of X.rules)if((0,kJ.shouldUseRule)(z,G))HV(Y,G.keyword,G.definition,X.type)})}function $c(Y,X){if(Y.schemaEnv.meta||!Y.opts.strictTypes)return;if(Hc(Y,X),!Y.opts.allowUnionTypes)Wc(Y,X);Kc(Y,Y.dataTypes)}function Hc(Y,X){if(!X.length)return;if(!Y.dataTypes.length){Y.dataTypes=X;return}X.forEach((J)=>{if(!$V(Y.dataTypes,J))_J(Y,`type "${J}" not allowed by context "${Y.dataTypes.join(",")}"`)}),Bc(Y,X)}function Wc(Y,X){if(X.length>1&&!(X.length===2&&X.includes("null")))_J(Y,"use allowUnionTypes to allow union type keyword")}function Kc(Y,X){let J=Y.self.RULES.all;for(let z in J){let Q=J[z];if(typeof Q=="object"&&(0,kJ.shouldUseRule)(Y.schema,Q)){let{type:G}=Q.definition;if(G.length&&!G.some((Z)=>Uc(X,Z)))_J(Y,`missing type "${G.join(",")}" for keyword "${z}"`)}}}function Uc(Y,X){return Y.includes(X)||X==="number"&&Y.includes("integer")}function $V(Y,X){return Y.includes(X)||X==="integer"&&Y.includes("number")}function Bc(Y,X){let J=[];for(let z of Y.dataTypes)if($V(X,z))J.push(z);else if(X.includes("integer")&&z==="number")J.push("integer");Y.dataTypes=J}function _J(Y,X){let J=Y.schemaEnv.baseId+Y.errSchemaPath;X+=` at "${J}" (strictTypes)`,(0,n4.checkStrictMode)(Y,X,Y.opts.strictTypes)}class bJ{constructor(Y,X,J){if((0,i5.validateKeywordUsage)(Y,X,J),this.gen=Y.gen,this.allErrors=Y.allErrors,this.keyword=J,this.data=Y.data,this.schema=Y.schema[J],this.$data=X.$data&&Y.opts.$data&&this.schema&&this.schema.$data,this.schemaValue=(0,n4.schemaRefOrVal)(Y,this.schema,J,this.$data),this.schemaType=X.schemaType,this.parentSchema=Y.schema,this.params={},this.it=Y,this.def=X,this.$data)this.schemaCode=Y.gen.const("vSchema",WV(this.$data,Y));else if(this.schemaCode=this.schemaValue,!(0,i5.validSchemaType)(this.schema,X.schemaType,X.allowUndefined))throw Error(`${J} value must be ${JSON.stringify(X.schemaType)}`);if("code"in X?X.trackErrors:X.errors!==!1)this.errsCount=Y.gen.const("_errs",M0.default.errors)}result(Y,X,J){this.failResult((0,$0.not)(Y),X,J)}failResult(Y,X,J){if(this.gen.if(Y),J)J();else this.error();if(X){if(this.gen.else(),X(),this.allErrors)this.gen.endIf()}else if(this.allErrors)this.gen.endIf();else this.gen.else()}pass(Y,X){this.failResult((0,$0.not)(Y),void 0,X)}fail(Y){if(Y===void 0){if(this.error(),!this.allErrors)this.gen.if(!1);return}if(this.gen.if(Y),this.error(),this.allErrors)this.gen.endIf();else this.gen.else()}fail$data(Y){if(!this.$data)return this.fail(Y);let{schemaCode:X}=this;this.fail($0._`${X} !== undefined && (${(0,$0.or)(this.invalid$data(),Y)})`)}error(Y,X,J){if(X){this.setParams(X),this._error(Y,J),this.setParams({});return}this._error(Y,J)}_error(Y,X){(Y?l5.reportExtraError:l5.reportError)(this,this.def.error,X)}$dataError(){(0,l5.reportError)(this,this.def.$dataError||l5.keyword$DataError)}reset(){if(this.errsCount===void 0)throw Error('add "trackErrors" to keyword definition');(0,l5.resetErrorsCount)(this.gen,this.errsCount)}ok(Y){if(!this.allErrors)this.gen.if(Y)}setParams(Y,X){if(X)Object.assign(this.params,Y);else this.params=Y}block$data(Y,X,J=$0.nil){this.gen.block(()=>{this.check$data(Y,J),X()})}check$data(Y=$0.nil,X=$0.nil){if(!this.$data)return;let{gen:J,schemaCode:z,schemaType:Q,def:G}=this;if(J.if((0,$0.or)($0._`${z} === undefined`,X)),Y!==$0.nil)J.assign(Y,!0);if(Q.length||G.validateSchema){if(J.elseIf(this.invalid$data()),this.$dataError(),Y!==$0.nil)J.assign(Y,!1)}J.else()}invalid$data(){let{gen:Y,schemaCode:X,schemaType:J,def:z,it:Q}=this;return(0,$0.or)(G(),Z());function G(){if(J.length){if(!(X instanceof $0.Name))throw Error("ajv implementation error");let $=Array.isArray(J)?J:[J];return $0._`${(0,W9.checkDataTypes)($,X,Q.opts.strictNumbers,W9.DataType.Wrong)}`}return $0.nil}function Z(){if(z.validateSchema){let $=Y.scopeValue("validate$data",{ref:z.validateSchema});return $0._`!${$}(${X})`}return $0.nil}}subschema(Y,X){let J=(0,SJ.getSubschema)(this.it,Y);(0,SJ.extendSubschemaData)(J,this.it,Y),(0,SJ.extendSubschemaMode)(J,Y);let z={...this.it,...J,items:void 0,props:void 0};return ep(z,X),z}mergeEvaluated(Y,X){let{it:J,gen:z}=this;if(!J.opts.unevaluated)return;if(J.props!==!0&&Y.props!==void 0)J.props=n4.mergeEvaluated.props(z,Y.props,J.props,X);if(J.items!==!0&&Y.items!==void 0)J.items=n4.mergeEvaluated.items(z,Y.items,J.items,X)}mergeValidEvaluated(Y,X){let{it:J,gen:z}=this;if(J.opts.unevaluated&&(J.props!==!0||J.items!==!0))return z.if(X,()=>this.mergeEvaluated(Y,$0.Name)),!0}}KV.KeywordCxt=bJ;function HV(Y,X,J,z){let Q=new bJ(Y,J,X);if("code"in J)J.code(Q,z);else if(Q.$data&&J.validate)(0,i5.funcKeywordCode)(Q,J);else if("macro"in J)(0,i5.macroKeywordCode)(Q,J);else if(J.compile||J.validate)(0,i5.funcKeywordCode)(Q,J)}var Vc=/^\/(?:[^~]|~0|~1)*$/,Oc=/^([0-9]+)(#|\/(?:[^~]|~0|~1)*)?$/;function WV(Y,{dataLevel:X,dataNames:J,dataPathArr:z}){let Q,G;if(Y==="")return M0.default.rootData;if(Y[0]==="/"){if(!Vc.test(Y))throw Error(`Invalid JSON-pointer: ${Y}`);Q=Y,G=M0.default.rootData}else{let W=Oc.exec(Y);if(!W)throw Error(`Invalid JSON-pointer: ${Y}`);let K=+W[1];if(Q=W[2],Q==="#"){if(K>=X)throw Error(H("property/index",K));return z[X-K]}if(K>X)throw Error(H("data",K));if(G=J[X-K],!Q)return G}let Z=G,$=Q.split("/");for(let W of $)if(W)G=$0._`${G}${(0,$0.getProperty)((0,n4.unescapeJsonPointer)(W))}`,Z=$0._`${Z} && ${G}`;return Z;function H(W,K){return`Cannot access ${W} ${K} levels up, current level is ${X}`}}KV.getData=WV});var K9=C((VV)=>{Object.defineProperty(VV,"__esModule",{value:!0});class BV extends Error{constructor(Y){super("validation failed");this.errors=Y,this.ajv=this.validation=!0}}VV.default=BV});var o5=C((MV)=>{Object.defineProperty(MV,"__esModule",{value:!0});var RJ=d5();class OV extends Error{constructor(Y,X,J,z){super(z||`can't resolve reference ${J} from id ${X}`);this.missingRef=(0,RJ.resolveUrl)(Y,X,J),this.missingSchema=(0,RJ.normalizeId)((0,RJ.getFullPath)(Y,this.missingRef))}}MV.default=OV});var B9=C((qV)=>{Object.defineProperty(qV,"__esModule",{value:!0});qV.resolveSchema=qV.getCompilingSchema=qV.resolveRef=qV.compileSchema=qV.SchemaEnv=void 0;var U4=F0(),xc=K9(),h8=i4(),B4=d5(),LV=E0(),Fc=n5();class a5{constructor(Y){var X;this.refs={},this.dynamicAnchors={};let J;if(typeof Y.schema=="object")J=Y.schema;this.schema=Y.schema,this.schemaId=Y.schemaId,this.root=Y.root||this,this.baseId=(X=Y.baseId)!==null&&X!==void 0?X:(0,B4.normalizeId)(J===null||J===void 0?void 0:J[Y.schemaId||"$id"]),this.schemaPath=Y.schemaPath,this.localRefs=Y.localRefs,this.meta=Y.meta,this.$async=J===null||J===void 0?void 0:J.$async,this.refs={}}}qV.SchemaEnv=a5;function yJ(Y){let X=NV.call(this,Y);if(X)return X;let J=(0,B4.getFullPath)(this.opts.uriResolver,Y.root.baseId),{es5:z,lines:Q}=this.opts.code,{ownProperties:G}=this.opts,Z=new U4.CodeGen(this.scope,{es5:z,lines:Q,ownProperties:G}),$;if(Y.$async)$=Z.scopeValue("Error",{ref:xc.default,code:U4._`require("ajv/dist/runtime/validation_error").default`});let H=Z.scopeName("validate");Y.validateName=H;let W={gen:Z,allErrors:this.opts.allErrors,data:h8.default.data,parentData:h8.default.parentData,parentDataProperty:h8.default.parentDataProperty,dataNames:[h8.default.data],dataPathArr:[U4.nil],dataLevel:0,dataTypes:[],definedProperties:new Set,topSchemaRef:Z.scopeValue("schema",this.opts.code.source===!0?{ref:Y.schema,code:(0,U4.stringify)(Y.schema)}:{ref:Y.schema}),validateName:H,ValidationError:$,schema:Y.schema,schemaEnv:Y,rootId:J,baseId:Y.baseId||J,schemaPath:U4.nil,errSchemaPath:Y.schemaPath||(this.opts.jtd?"":"#"),errorPath:U4._`""`,opts:this.opts,self:this},K;try{this._compilations.add(Y),(0,Fc.validateFunctionCode)(W),Z.optimize(this.opts.code.optimize);let U=Z.toString();if(K=`${Z.scopeRefs(h8.default.scope)}return ${U}`,this.opts.code.process)K=this.opts.code.process(K,Y);let O=Function(`${h8.default.self}`,`${h8.default.scope}`,K)(this,this.scope.get());if(this.scope.value(H,{ref:O}),O.errors=null,O.schema=Y.schema,O.schemaEnv=Y,Y.$async)O.$async=!0;if(this.opts.code.source===!0)O.source={validateName:H,validateCode:U,scopeValues:Z._values};if(this.opts.unevaluated){let{props:V,items:L}=W;if(O.evaluated={props:V instanceof U4.Name?void 0:V,items:L instanceof U4.Name?void 0:L,dynamicProps:V instanceof U4.Name,dynamicItems:L instanceof U4.Name},O.source)O.source.evaluated=(0,U4.stringify)(O.evaluated)}return Y.validate=O,Y}catch(U){if(delete Y.validate,delete Y.validateName,K)this.logger.error("Error compiling schema, function code:",K);throw U}finally{this._compilations.delete(Y)}}qV.compileSchema=yJ;function Pc(Y,X,J){var z;J=(0,B4.resolveUrl)(this.opts.uriResolver,X,J);let Q=Y.refs[J];if(Q)return Q;let G=Tc.call(this,Y,J);if(G===void 0){let Z=(z=Y.localRefs)===null||z===void 0?void 0:z[J],{schemaId:$}=this.opts;if(Z)G=new a5({schema:Z,schemaId:$,root:Y,baseId:X})}if(G===void 0)return;return Y.refs[J]=Ac.call(this,G)}qV.resolveRef=Pc;function Ac(Y){if((0,B4.inlineRef)(Y.schema,this.opts.inlineRefs))return Y.schema;return Y.validate?Y:yJ.call(this,Y)}function NV(Y){for(let X of this._compilations)if(wc(X,Y))return X}qV.getCompilingSchema=NV;function wc(Y,X){return Y.schema===X.schema&&Y.root===X.root&&Y.baseId===X.baseId}function Tc(Y,X){let J;while(typeof(J=this.refs[X])=="string")X=J;return J||this.schemas[X]||U9.call(this,Y,X)}function U9(Y,X){let J=this.opts.uriResolver.parse(X),z=(0,B4._getFullPath)(this.opts.uriResolver,J),Q=(0,B4.getFullPath)(this.opts.uriResolver,Y.baseId,void 0);if(Object.keys(Y.schema).length>0&&z===Q)return fJ.call(this,J,Y);let G=(0,B4.normalizeId)(z),Z=this.refs[G]||this.schemas[G];if(typeof Z=="string"){let $=U9.call(this,Y,Z);if(typeof($===null||$===void 0?void 0:$.schema)!=="object")return;return fJ.call(this,J,$)}if(typeof(Z===null||Z===void 0?void 0:Z.schema)!=="object")return;if(!Z.validate)yJ.call(this,Z);if(G===(0,B4.normalizeId)(X)){let{schema:$}=Z,{schemaId:H}=this.opts,W=$[H];if(W)Q=(0,B4.resolveUrl)(this.opts.uriResolver,Q,W);return new a5({schema:$,schemaId:H,root:Y,baseId:Q})}return fJ.call(this,J,Z)}qV.resolveSchema=U9;var Ic=new Set(["properties","patternProperties","enum","dependencies","definitions"]);function fJ(Y,{baseId:X,schema:J,root:z}){var Q;if(((Q=Y.fragment)===null||Q===void 0?void 0:Q[0])!=="/")return;for(let $ of Y.fragment.slice(1).split("/")){if(typeof J==="boolean")return;let H=J[(0,LV.unescapeFragment)($)];if(H===void 0)return;J=H;let W=typeof J==="object"&&J[this.opts.schemaId];if(!Ic.has($)&&W)X=(0,B4.resolveUrl)(this.opts.uriResolver,X,W)}let G;if(typeof J!="boolean"&&J.$ref&&!(0,LV.schemaHasRulesButRef)(J,this.RULES)){let $=(0,B4.resolveUrl)(this.opts.uriResolver,X,J.$ref);G=U9.call(this,z,$)}let{schemaId:Z}=this.opts;if(G=G||new a5({schema:J,schemaId:Z,root:z,baseId:X}),G.schema!==G.root.schema)return G;return}});var FV=C((UH0,Ec)=>{Ec.exports={$id:"https://raw.githubusercontent.com/ajv-validator/ajv/master/lib/refs/data.json#",description:"Meta-schema for $data reference (JSON AnySchema extension proposal)",type:"object",required:["$data"],properties:{$data:{type:"string",anyOf:[{format:"relative-json-pointer"},{format:"json-pointer"}]}},additionalProperties:!1}});var mJ=C((BH0,TV)=>{var Sc=RegExp.prototype.test.bind(/^[\da-f]{8}-[\da-f]{4}-[\da-f]{4}-[\da-f]{4}-[\da-f]{12}$/iu),AV=RegExp.prototype.test.bind(/^(?:(?:25[0-5]|2[0-4]\d|1\d{2}|[1-9]\d|\d)\.){3}(?:25[0-5]|2[0-4]\d|1\d{2}|[1-9]\d|\d)$/u);function hJ(Y){let X="",J=0,z=0;for(z=0;z<Y.length;z++){if(J=Y[z].charCodeAt(0),J===48)continue;if(!(J>=48&&J<=57||J>=65&&J<=70||J>=97&&J<=102))return"";X+=Y[z];break}for(z+=1;z<Y.length;z++){if(J=Y[z].charCodeAt(0),!(J>=48&&J<=57||J>=65&&J<=70||J>=97&&J<=102))return"";X+=Y[z]}return X}var kc=RegExp.prototype.test.bind(/[^!"$&'()*+,\-.;=_`a-z{}~]/u);function PV(Y){return Y.length=0,!0}function _c(Y,X,J){if(Y.length){let z=hJ(Y);if(z!=="")X.push(z);else return J.error=!0,!1;Y.length=0}return!0}function bc(Y){let X=0,J={error:!1,address:"",zone:""},z=[],Q=[],G=!1,Z=!1,$=_c;for(let H=0;H<Y.length;H++){let W=Y[H];if(W==="["||W==="]")continue;if(W===":"){if(G===!0)Z=!0;if(!$(Q,z,J))break;if(++X>7){J.error=!0;break}if(H>0&&Y[H-1]===":")G=!0;z.push(":");continue}else if(W==="%"){if(!$(Q,z,J))break;$=PV}else{Q.push(W);continue}}if(Q.length)if($===PV)J.zone=Q.join("");else if(Z)z.push(Q.join(""));else z.push(hJ(Q));return J.address=z.join(""),J}function wV(Y){if(Rc(Y,":")<2)return{host:Y,isIPV6:!1};let X=bc(Y);if(!X.error){let{address:J,address:z}=X;if(X.zone)J+="%"+X.zone,z+="%25"+X.zone;return{host:J,isIPV6:!0,escapedHost:z}}else return{host:Y,isIPV6:!1}}function Rc(Y,X){let J=0;for(let z=0;z<Y.length;z++)if(Y[z]===X)J++;return J}function fc(Y){let X=Y,J=[],z=-1,Q=0;while(Q=X.length){if(Q===1)if(X===".")break;else if(X==="/"){J.push("/");break}else{J.push(X);break}else if(Q===2){if(X[0]==="."){if(X[1]===".")break;else if(X[1]==="/"){X=X.slice(2);continue}}else if(X[0]==="/"){if(X[1]==="."||X[1]==="/"){J.push("/");break}}}else if(Q===3){if(X==="/.."){if(J.length!==0)J.pop();J.push("/");break}}if(X[0]==="."){if(X[1]==="."){if(X[2]==="/"){X=X.slice(3);continue}}else if(X[1]==="/"){X=X.slice(2);continue}}else if(X[0]==="/"){if(X[1]==="."){if(X[2]==="/"){X=X.slice(2);continue}else if(X[2]==="."){if(X[3]==="/"){if(X=X.slice(3),J.length!==0)J.pop();continue}}}}if((z=X.indexOf("/",1))===-1){J.push(X);break}else J.push(X.slice(0,z)),X=X.slice(z)}return J.join("")}function yc(Y,X){let J=X!==!0?escape:unescape;if(Y.scheme!==void 0)Y.scheme=J(Y.scheme);if(Y.userinfo!==void 0)Y.userinfo=J(Y.userinfo);if(Y.host!==void 0)Y.host=J(Y.host);if(Y.path!==void 0)Y.path=J(Y.path);if(Y.query!==void 0)Y.query=J(Y.query);if(Y.fragment!==void 0)Y.fragment=J(Y.fragment);return Y}function hc(Y){let X=[];if(Y.userinfo!==void 0)X.push(Y.userinfo),X.push("@");if(Y.host!==void 0){let J=unescape(Y.host);if(!AV(J)){let z=wV(J);if(z.isIPV6===!0)J=`[${z.escapedHost}]`;else J=Y.host}X.push(J)}if(typeof Y.port==="number"||typeof Y.port==="string")X.push(":"),X.push(String(Y.port));return X.length?X.join(""):void 0}TV.exports={nonSimpleDomain:kc,recomposeAuthority:hc,normalizeComponentEncoding:yc,removeDotSegments:fc,isIPv4:AV,isUUID:Sc,normalizeIPv6:wV,stringArrayToHexStripped:hJ}});var CV=C((VH0,jV)=>{var{isUUID:mc}=mJ(),uc=/([\da-z][\d\-a-z]{0,31}):((?:[\w!$'()*+,\-.:;=@]|%[\da-f]{2})+)/iu,gc=["http","https","ws","wss","urn","urn:uuid"];function pc(Y){return gc.indexOf(Y)!==-1}function uJ(Y){if(Y.secure===!0)return!0;else if(Y.secure===!1)return!1;else if(Y.scheme)return Y.scheme.length===3&&(Y.scheme[0]==="w"||Y.scheme[0]==="W")&&(Y.scheme[1]==="s"||Y.scheme[1]==="S")&&(Y.scheme[2]==="s"||Y.scheme[2]==="S");else return!1}function IV(Y){if(!Y.host)Y.error=Y.error||"HTTP URIs must have a host.";return Y}function vV(Y){let X=String(Y.scheme).toLowerCase()==="https";if(Y.port===(X?443:80)||Y.port==="")Y.port=void 0;if(!Y.path)Y.path="/";return Y}function cc(Y){return Y.secure=uJ(Y),Y.resourceName=(Y.path||"/")+(Y.query?"?"+Y.query:""),Y.path=void 0,Y.query=void 0,Y}function dc(Y){if(Y.port===(uJ(Y)?443:80)||Y.port==="")Y.port=void 0;if(typeof Y.secure==="boolean")Y.scheme=Y.secure?"wss":"ws",Y.secure=void 0;if(Y.resourceName){let[X,J]=Y.resourceName.split("?");Y.path=X&&X!=="/"?X:void 0,Y.query=J,Y.resourceName=void 0}return Y.fragment=void 0,Y}function lc(Y,X){if(!Y.path)return Y.error="URN can not be parsed",Y;let J=Y.path.match(uc);if(J){let z=X.scheme||Y.scheme||"urn";Y.nid=J[1].toLowerCase(),Y.nss=J[2];let Q=`${z}:${X.nid||Y.nid}`,G=gJ(Q);if(Y.path=void 0,G)Y=G.parse(Y,X)}else Y.error=Y.error||"URN can not be parsed.";return Y}function ic(Y,X){if(Y.nid===void 0)throw Error("URN without nid cannot be serialized");let J=X.scheme||Y.scheme||"urn",z=Y.nid.toLowerCase(),Q=`${J}:${X.nid||z}`,G=gJ(Q);if(G)Y=G.serialize(Y,X);let Z=Y,$=Y.nss;return Z.path=`${z||X.nid}:${$}`,X.skipEscape=!0,Z}function nc(Y,X){let J=Y;if(J.uuid=J.nss,J.nss=void 0,!X.tolerant&&(!J.uuid||!mc(J.uuid)))J.error=J.error||"UUID is not valid.";return J}function oc(Y){let X=Y;return X.nss=(Y.uuid||"").toLowerCase(),X}var DV={scheme:"http",domainHost:!0,parse:IV,serialize:vV},ac={scheme:"https",domainHost:DV.domainHost,parse:IV,serialize:vV},V9={scheme:"ws",domainHost:!0,parse:cc,serialize:dc},sc={scheme:"wss",domainHost:V9.domainHost,parse:V9.parse,serialize:V9.serialize},rc={scheme:"urn",parse:lc,serialize:ic,skipNormalize:!0},tc={scheme:"urn:uuid",parse:nc,serialize:oc,skipNormalize:!0},O9={http:DV,https:ac,ws:V9,wss:sc,urn:rc,"urn:uuid":tc};Object.setPrototypeOf(O9,null);function gJ(Y){return Y&&(O9[Y]||O9[Y.toLowerCase()])||void 0}jV.exports={wsIsSecure:uJ,SCHEMES:O9,isValidSchemeName:pc,getSchemeHandler:gJ}});var kV=C((OH0,L9)=>{var{normalizeIPv6:ec,removeDotSegments:s5,recomposeAuthority:Yd,normalizeComponentEncoding:M9,isIPv4:Xd,nonSimpleDomain:Jd}=mJ(),{SCHEMES:zd,getSchemeHandler:EV}=CV();function Qd(Y,X){if(typeof Y==="string")Y=D4(o4(Y,X),X);else if(typeof Y==="object")Y=o4(D4(Y,X),X);return Y}function Gd(Y,X,J){let z=J?Object.assign({scheme:"null"},J):{scheme:"null"},Q=SV(o4(Y,z),o4(X,z),z,!0);return z.skipEscape=!0,D4(Q,z)}function SV(Y,X,J,z){let Q={};if(!z)Y=o4(D4(Y,J),J),X=o4(D4(X,J),J);if(J=J||{},!J.tolerant&&X.scheme)Q.scheme=X.scheme,Q.userinfo=X.userinfo,Q.host=X.host,Q.port=X.port,Q.path=s5(X.path||""),Q.query=X.query;else{if(X.userinfo!==void 0||X.host!==void 0||X.port!==void 0)Q.userinfo=X.userinfo,Q.host=X.host,Q.port=X.port,Q.path=s5(X.path||""),Q.query=X.query;else{if(!X.path)if(Q.path=Y.path,X.query!==void 0)Q.query=X.query;else Q.query=Y.query;else{if(X.path[0]==="/")Q.path=s5(X.path);else{if((Y.userinfo!==void 0||Y.host!==void 0||Y.port!==void 0)&&!Y.path)Q.path="/"+X.path;else if(!Y.path)Q.path=X.path;else Q.path=Y.path.slice(0,Y.path.lastIndexOf("/")+1)+X.path;Q.path=s5(Q.path)}Q.query=X.query}Q.userinfo=Y.userinfo,Q.host=Y.host,Q.port=Y.port}Q.scheme=Y.scheme}return Q.fragment=X.fragment,Q}function Zd(Y,X,J){if(typeof Y==="string")Y=unescape(Y),Y=D4(M9(o4(Y,J),!0),{...J,skipEscape:!0});else if(typeof Y==="object")Y=D4(M9(Y,!0),{...J,skipEscape:!0});if(typeof X==="string")X=unescape(X),X=D4(M9(o4(X,J),!0),{...J,skipEscape:!0});else if(typeof X==="object")X=D4(M9(X,!0),{...J,skipEscape:!0});return Y.toLowerCase()===X.toLowerCase()}function D4(Y,X){let J={host:Y.host,scheme:Y.scheme,userinfo:Y.userinfo,port:Y.port,path:Y.path,query:Y.query,nid:Y.nid,nss:Y.nss,uuid:Y.uuid,fragment:Y.fragment,reference:Y.reference,resourceName:Y.resourceName,secure:Y.secure,error:""},z=Object.assign({},X),Q=[],G=EV(z.scheme||J.scheme);if(G&&G.serialize)G.serialize(J,z);if(J.path!==void 0)if(!z.skipEscape){if(J.path=escape(J.path),J.scheme!==void 0)J.path=J.path.split("%3A").join(":")}else J.path=unescape(J.path);if(z.reference!=="suffix"&&J.scheme)Q.push(J.scheme,":");let Z=Yd(J);if(Z!==void 0){if(z.reference!=="suffix")Q.push("//");if(Q.push(Z),J.path&&J.path[0]!=="/")Q.push("/")}if(J.path!==void 0){let $=J.path;if(!z.absolutePath&&(!G||!G.absolutePath))$=s5($);if(Z===void 0&&$[0]==="/"&&$[1]==="/")$="/%2F"+$.slice(2);Q.push($)}if(J.query!==void 0)Q.push("?",J.query);if(J.fragment!==void 0)Q.push("#",J.fragment);return Q.join("")}var $d=/^(?:([^#/:?]+):)?(?:\/\/((?:([^#/?@]*)@)?(\[[^#/?\]]+\]|[^#/:?]*)(?::(\d*))?))?([^#?]*)(?:\?([^#]*))?(?:#((?:.|[\n\r])*))?/u;function o4(Y,X){let J=Object.assign({},X),z={scheme:void 0,userinfo:void 0,host:"",port:void 0,path:"",query:void 0,fragment:void 0},Q=!1;if(J.reference==="suffix")if(J.scheme)Y=J.scheme+":"+Y;else Y="//"+Y;let G=Y.match($d);if(G){if(z.scheme=G[1],z.userinfo=G[3],z.host=G[4],z.port=parseInt(G[5],10),z.path=G[6]||"",z.query=G[7],z.fragment=G[8],isNaN(z.port))z.port=G[5];if(z.host)if(Xd(z.host)===!1){let H=ec(z.host);z.host=H.host.toLowerCase(),Q=H.isIPV6}else Q=!0;if(z.scheme===void 0&&z.userinfo===void 0&&z.host===void 0&&z.port===void 0&&z.query===void 0&&!z.path)z.reference="same-document";else if(z.scheme===void 0)z.reference="relative";else if(z.fragment===void 0)z.reference="absolute";else z.reference="uri";if(J.reference&&J.reference!=="suffix"&&J.reference!==z.reference)z.error=z.error||"URI is not a "+J.reference+" reference.";let Z=EV(J.scheme||z.scheme);if(!J.unicodeSupport&&(!Z||!Z.unicodeSupport)){if(z.host&&(J.domainHost||Z&&Z.domainHost)&&Q===!1&&Jd(z.host))try{z.host=URL.domainToASCII(z.host.toLowerCase())}catch($){z.error=z.error||"Host's domain name can not be converted to ASCII: "+$}}if(!Z||Z&&!Z.skipNormalize){if(Y.indexOf("%")!==-1){if(z.scheme!==void 0)z.scheme=unescape(z.scheme);if(z.host!==void 0)z.host=unescape(z.host)}if(z.path)z.path=escape(unescape(z.path));if(z.fragment)z.fragment=encodeURI(decodeURIComponent(z.fragment))}if(Z&&Z.parse)Z.parse(z,J)}else z.error=z.error||"URI can not be parsed.";return z}var pJ={SCHEMES:zd,normalize:Qd,resolve:Gd,resolveComponent:SV,equal:Zd,serialize:D4,parse:o4};L9.exports=pJ;L9.exports.default=pJ;L9.exports.fastUri=pJ});var RV=C((bV)=>{Object.defineProperty(bV,"__esModule",{value:!0});var _V=kV();_V.code='require("ajv/dist/runtime/uri").default';bV.default=_V});var cV=C((a4)=>{Object.defineProperty(a4,"__esModule",{value:!0});a4.CodeGen=a4.Name=a4.nil=a4.stringify=a4.str=a4._=a4.KeywordCxt=void 0;var Wd=n5();Object.defineProperty(a4,"KeywordCxt",{enumerable:!0,get:function(){return Wd.KeywordCxt}});var D6=F0();Object.defineProperty(a4,"_",{enumerable:!0,get:function(){return D6._}});Object.defineProperty(a4,"str",{enumerable:!0,get:function(){return D6.str}});Object.defineProperty(a4,"stringify",{enumerable:!0,get:function(){return D6.stringify}});Object.defineProperty(a4,"nil",{enumerable:!0,get:function(){return D6.nil}});Object.defineProperty(a4,"Name",{enumerable:!0,get:function(){return D6.Name}});Object.defineProperty(a4,"CodeGen",{enumerable:!0,get:function(){return D6.CodeGen}});var Kd=K9(),uV=o5(),Ud=PJ(),r5=B9(),Bd=F0(),t5=d5(),N9=c5(),dJ=E0(),fV=FV(),Vd=RV(),gV=(Y,X)=>new RegExp(Y,X);gV.code="new RegExp";var Od=["removeAdditional","useDefaults","coerceTypes"],Md=new Set(["validate","serialize","parse","wrapper","root","schema","keyword","pattern","formats","validate$data","func","obj","Error"]),Ld={errorDataPath:"",format:"`validateFormats: false` can be used instead.",nullable:'"nullable" keyword is supported by default.',jsonPointers:"Deprecated jsPropertySyntax can be used instead.",extendRefs:"Deprecated ignoreKeywordsWithRef can be used instead.",missingRefs:"Pass empty schema with $id that should be ignored to ajv.addSchema.",processCode:"Use option `code: {process: (code, schemaEnv: object) => string}`",sourceCode:"Use option `code: {source: true}`",strictDefaults:"It is default now, see option `strict`.",strictKeywords:"It is default now, see option `strict`.",uniqueItems:'"uniqueItems" keyword is always validated.',unknownFormats:"Disable strict mode or pass `true` to `ajv.addFormat` (or `formats` option).",cache:"Map is used as cache, schema object as key.",serialize:"Map is used as cache, schema object as key.",ajvErrors:"It is default now."},Nd={ignoreKeywordsWithRef:"",jsPropertySyntax:"",unicode:'"minLength"/"maxLength" account for unicode characters by default.'},yV=200;function qd(Y){var X,J,z,Q,G,Z,$,H,W,K,U,B,O,V,L,q,F,P,A,w,v,T,D,j,E;let f=Y.strict,i=(X=Y.code)===null||X===void 0?void 0:X.optimize,o=i===!0||i===void 0?1:i||0,y=(z=(J=Y.code)===null||J===void 0?void 0:J.regExp)!==null&&z!==void 0?z:gV,a=(Q=Y.uriResolver)!==null&&Q!==void 0?Q:Vd.default;return{strictSchema:(Z=(G=Y.strictSchema)!==null&&G!==void 0?G:f)!==null&&Z!==void 0?Z:!0,strictNumbers:(H=($=Y.strictNumbers)!==null&&$!==void 0?$:f)!==null&&H!==void 0?H:!0,strictTypes:(K=(W=Y.strictTypes)!==null&&W!==void 0?W:f)!==null&&K!==void 0?K:"log",strictTuples:(B=(U=Y.strictTuples)!==null&&U!==void 0?U:f)!==null&&B!==void 0?B:"log",strictRequired:(V=(O=Y.strictRequired)!==null&&O!==void 0?O:f)!==null&&V!==void 0?V:!1,code:Y.code?{...Y.code,optimize:o,regExp:y}:{optimize:o,regExp:y},loopRequired:(L=Y.loopRequired)!==null&&L!==void 0?L:yV,loopEnum:(q=Y.loopEnum)!==null&&q!==void 0?q:yV,meta:(F=Y.meta)!==null&&F!==void 0?F:!0,messages:(P=Y.messages)!==null&&P!==void 0?P:!0,inlineRefs:(A=Y.inlineRefs)!==null&&A!==void 0?A:!0,schemaId:(w=Y.schemaId)!==null&&w!==void 0?w:"$id",addUsedSchema:(v=Y.addUsedSchema)!==null&&v!==void 0?v:!0,validateSchema:(T=Y.validateSchema)!==null&&T!==void 0?T:!0,validateFormats:(D=Y.validateFormats)!==null&&D!==void 0?D:!0,unicodeRegExp:(j=Y.unicodeRegExp)!==null&&j!==void 0?j:!0,int32range:(E=Y.int32range)!==null&&E!==void 0?E:!0,uriResolver:a}}class q9{constructor(Y={}){this.schemas={},this.refs={},this.formats={},this._compilations=new Set,this._loading={},this._cache=new Map,Y=this.opts={...Y,...qd(Y)};let{es5:X,lines:J}=this.opts.code;this.scope=new Bd.ValueScope({scope:{},prefixes:Md,es5:X,lines:J}),this.logger=Td(Y.logger);let z=Y.validateFormats;if(Y.validateFormats=!1,this.RULES=(0,Ud.getRules)(),hV.call(this,Ld,Y,"NOT SUPPORTED"),hV.call(this,Nd,Y,"DEPRECATED","warn"),this._metaOpts=Ad.call(this),Y.formats)Fd.call(this);if(this._addVocabularies(),this._addDefaultMetaSchema(),Y.keywords)Pd.call(this,Y.keywords);if(typeof Y.meta=="object")this.addMetaSchema(Y.meta);xd.call(this),Y.validateFormats=z}_addVocabularies(){this.addKeyword("$async")}_addDefaultMetaSchema(){let{$data:Y,meta:X,schemaId:J}=this.opts,z=fV;if(J==="id")z={...fV},z.id=z.$id,delete z.$id;if(X&&Y)this.addMetaSchema(z,z[J],!1)}defaultMeta(){let{meta:Y,schemaId:X}=this.opts;return this.opts.defaultMeta=typeof Y=="object"?Y[X]||Y:void 0}validate(Y,X){let J;if(typeof Y=="string"){if(J=this.getSchema(Y),!J)throw Error(`no schema with key or ref "${Y}"`)}else J=this.compile(Y);let z=J(X);if(!("$async"in J))this.errors=J.errors;return z}compile(Y,X){let J=this._addSchema(Y,X);return J.validate||this._compileSchemaEnv(J)}compileAsync(Y,X){if(typeof this.opts.loadSchema!="function")throw Error("options.loadSchema should be a function");let{loadSchema:J}=this.opts;return z.call(this,Y,X);async function z(W,K){await Q.call(this,W.$schema);let U=this._addSchema(W,K);return U.validate||G.call(this,U)}async function Q(W){if(W&&!this.getSchema(W))await z.call(this,{$ref:W},!0)}async function G(W){try{return this._compileSchemaEnv(W)}catch(K){if(!(K instanceof uV.default))throw K;return Z.call(this,K),await $.call(this,K.missingSchema),G.call(this,W)}}function Z({missingSchema:W,missingRef:K}){if(this.refs[W])throw Error(`AnySchema ${W} is loaded but ${K} cannot be resolved`)}async function $(W){let K=await H.call(this,W);if(!this.refs[W])await Q.call(this,K.$schema);if(!this.refs[W])this.addSchema(K,W,X)}async function H(W){let K=this._loading[W];if(K)return K;try{return await(this._loading[W]=J(W))}finally{delete this._loading[W]}}}addSchema(Y,X,J,z=this.opts.validateSchema){if(Array.isArray(Y)){for(let G of Y)this.addSchema(G,void 0,J,z);return this}let Q;if(typeof Y==="object"){let{schemaId:G}=this.opts;if(Q=Y[G],Q!==void 0&&typeof Q!="string")throw Error(`schema ${G} must be string`)}return X=(0,t5.normalizeId)(X||Q),this._checkUnique(X),this.schemas[X]=this._addSchema(Y,J,X,z,!0),this}addMetaSchema(Y,X,J=this.opts.validateSchema){return this.addSchema(Y,X,!0,J),this}validateSchema(Y,X){if(typeof Y=="boolean")return!0;let J;if(J=Y.$schema,J!==void 0&&typeof J!="string")throw Error("$schema must be a string");if(J=J||this.opts.defaultMeta||this.defaultMeta(),!J)return this.logger.warn("meta-schema not available"),this.errors=null,!0;let z=this.validate(J,Y);if(!z&&X){let Q="schema is invalid: "+this.errorsText();if(this.opts.validateSchema==="log")this.logger.error(Q);else throw Error(Q)}return z}getSchema(Y){let X;while(typeof(X=mV.call(this,Y))=="string")Y=X;if(X===void 0){let{schemaId:J}=this.opts,z=new r5.SchemaEnv({schema:{},schemaId:J});if(X=r5.resolveSchema.call(this,z,Y),!X)return;this.refs[Y]=X}return X.validate||this._compileSchemaEnv(X)}removeSchema(Y){if(Y instanceof RegExp)return this._removeAllSchemas(this.schemas,Y),this._removeAllSchemas(this.refs,Y),this;switch(typeof Y){case"undefined":return this._removeAllSchemas(this.schemas),this._removeAllSchemas(this.refs),this._cache.clear(),this;case"string":{let X=mV.call(this,Y);if(typeof X=="object")this._cache.delete(X.schema);return delete this.schemas[Y],delete this.refs[Y],this}case"object":{let X=Y;this._cache.delete(X);let J=Y[this.opts.schemaId];if(J)J=(0,t5.normalizeId)(J),delete this.schemas[J],delete this.refs[J];return this}default:throw Error("ajv.removeSchema: invalid parameter")}}addVocabulary(Y){for(let X of Y)this.addKeyword(X);return this}addKeyword(Y,X){let J;if(typeof Y=="string"){if(J=Y,typeof X=="object")this.logger.warn("these parameters are deprecated, see docs for addKeyword"),X.keyword=J}else if(typeof Y=="object"&&X===void 0){if(X=Y,J=X.keyword,Array.isArray(J)&&!J.length)throw Error("addKeywords: keyword must be string or non-empty array")}else throw Error("invalid addKeywords parameters");if(vd.call(this,J,X),!X)return(0,dJ.eachItem)(J,(Q)=>cJ.call(this,Q)),this;jd.call(this,X);let z={...X,type:(0,N9.getJSONTypes)(X.type),schemaType:(0,N9.getJSONTypes)(X.schemaType)};return(0,dJ.eachItem)(J,z.type.length===0?(Q)=>cJ.call(this,Q,z):(Q)=>z.type.forEach((G)=>cJ.call(this,Q,z,G))),this}getKeyword(Y){let X=this.RULES.all[Y];return typeof X=="object"?X.definition:!!X}removeKeyword(Y){let{RULES:X}=this;delete X.keywords[Y],delete X.all[Y];for(let J of X.rules){let z=J.rules.findIndex((Q)=>Q.keyword===Y);if(z>=0)J.rules.splice(z,1)}return this}addFormat(Y,X){if(typeof X=="string")X=new RegExp(X);return this.formats[Y]=X,this}errorsText(Y=this.errors,{separator:X=", ",dataVar:J="data"}={}){if(!Y||Y.length===0)return"No errors";return Y.map((z)=>`${J}${z.instancePath} ${z.message}`).reduce((z,Q)=>z+X+Q)}$dataMetaSchema(Y,X){let J=this.RULES.all;Y=JSON.parse(JSON.stringify(Y));for(let z of X){let Q=z.split("/").slice(1),G=Y;for(let Z of Q)G=G[Z];for(let Z in J){let $=J[Z];if(typeof $!="object")continue;let{$data:H}=$.definition,W=G[Z];if(H&&W)G[Z]=pV(W)}}return Y}_removeAllSchemas(Y,X){for(let J in Y){let z=Y[J];if(!X||X.test(J)){if(typeof z=="string")delete Y[J];else if(z&&!z.meta)this._cache.delete(z.schema),delete Y[J]}}}_addSchema(Y,X,J,z=this.opts.validateSchema,Q=this.opts.addUsedSchema){let G,{schemaId:Z}=this.opts;if(typeof Y=="object")G=Y[Z];else if(this.opts.jtd)throw Error("schema must be object");else if(typeof Y!="boolean")throw Error("schema must be object or boolean");let $=this._cache.get(Y);if($!==void 0)return $;J=(0,t5.normalizeId)(G||J);let H=t5.getSchemaRefs.call(this,Y,J);if($=new r5.SchemaEnv({schema:Y,schemaId:Z,meta:X,baseId:J,localRefs:H}),this._cache.set($.schema,$),Q&&!J.startsWith("#")){if(J)this._checkUnique(J);this.refs[J]=$}if(z)this.validateSchema(Y,!0);return $}_checkUnique(Y){if(this.schemas[Y]||this.refs[Y])throw Error(`schema with key or id "${Y}" already exists`)}_compileSchemaEnv(Y){if(Y.meta)this._compileMetaSchema(Y);else r5.compileSchema.call(this,Y);if(!Y.validate)throw Error("ajv implementation error");return Y.validate}_compileMetaSchema(Y){let X=this.opts;this.opts=this._metaOpts;try{r5.compileSchema.call(this,Y)}finally{this.opts=X}}}q9.ValidationError=Kd.default;q9.MissingRefError=uV.default;a4.default=q9;function hV(Y,X,J,z="error"){for(let Q in Y){let G=Q;if(G in X)this.logger[z](`${J}: option ${Q}. ${Y[G]}`)}}function mV(Y){return Y=(0,t5.normalizeId)(Y),this.schemas[Y]||this.refs[Y]}function xd(){let Y=this.opts.schemas;if(!Y)return;if(Array.isArray(Y))this.addSchema(Y);else for(let X in Y)this.addSchema(Y[X],X)}function Fd(){for(let Y in this.opts.formats){let X=this.opts.formats[Y];if(X)this.addFormat(Y,X)}}function Pd(Y){if(Array.isArray(Y)){this.addVocabulary(Y);return}this.logger.warn("keywords option as map is deprecated, pass array");for(let X in Y){let J=Y[X];if(!J.keyword)J.keyword=X;this.addKeyword(J)}}function Ad(){let Y={...this.opts};for(let X of Od)delete Y[X];return Y}var wd={log(){},warn(){},error(){}};function Td(Y){if(Y===!1)return wd;if(Y===void 0)return console;if(Y.log&&Y.warn&&Y.error)return Y;throw Error("logger must implement log, warn and error methods")}var Id=/^[a-z_$][a-z0-9_$:-]*$/i;function vd(Y,X){let{RULES:J}=this;if((0,dJ.eachItem)(Y,(z)=>{if(J.keywords[z])throw Error(`Keyword ${z} is already defined`);if(!Id.test(z))throw Error(`Keyword ${z} has invalid name`)}),!X)return;if(X.$data&&!(("code"in X)||("validate"in X)))throw Error('$data keyword must have "code" or "validate" function')}function cJ(Y,X,J){var z;let Q=X===null||X===void 0?void 0:X.post;if(J&&Q)throw Error('keyword with "post" flag cannot have "type"');let{RULES:G}=this,Z=Q?G.post:G.rules.find(({type:H})=>H===J);if(!Z)Z={type:J,rules:[]},G.rules.push(Z);if(G.keywords[Y]=!0,!X)return;let $={keyword:Y,definition:{...X,type:(0,N9.getJSONTypes)(X.type),schemaType:(0,N9.getJSONTypes)(X.schemaType)}};if(X.before)Dd.call(this,Z,$,X.before);else Z.rules.push($);G.all[Y]=$,(z=X.implements)===null||z===void 0||z.forEach((H)=>this.addKeyword(H))}function Dd(Y,X,J){let z=Y.rules.findIndex((Q)=>Q.keyword===J);if(z>=0)Y.rules.splice(z,0,X);else Y.rules.push(X),this.logger.warn(`rule ${J} is not defined`)}function jd(Y){let{metaSchema:X}=Y;if(X===void 0)return;if(Y.$data&&this.opts.$data)X=pV(X);Y.validateSchema=this.compile(X,!0)}var Cd={$ref:"https://raw.githubusercontent.com/ajv-validator/ajv/master/lib/refs/data.json#"};function pV(Y){return{anyOf:[Y,Cd]}}});var lV=C((dV)=>{Object.defineProperty(dV,"__esModule",{value:!0});var kd={keyword:"id",code(){throw Error('NOT SUPPORTED: keyword "id", use "$id" for schema ID')}};dV.default=kd});var rV=C((aV)=>{Object.defineProperty(aV,"__esModule",{value:!0});aV.callRef=aV.getValidate=void 0;var bd=o5(),iV=r1(),R1=F0(),j6=i4(),nV=B9(),x9=E0(),Rd={keyword:"$ref",schemaType:"string",code(Y){let{gen:X,schema:J,it:z}=Y,{baseId:Q,schemaEnv:G,validateName:Z,opts:$,self:H}=z,{root:W}=G;if((J==="#"||J==="#/")&&Q===W.baseId)return U();let K=nV.resolveRef.call(H,W,Q,J);if(K===void 0)throw new bd.default(z.opts.uriResolver,Q,J);if(K instanceof nV.SchemaEnv)return B(K);return O(K);function U(){if(G===W)return F9(Y,Z,G,G.$async);let V=X.scopeValue("root",{ref:W});return F9(Y,R1._`${V}.validate`,W,W.$async)}function B(V){let L=oV(Y,V);F9(Y,L,V,V.$async)}function O(V){let L=X.scopeValue("schema",$.code.source===!0?{ref:V,code:(0,R1.stringify)(V)}:{ref:V}),q=X.name("valid"),F=Y.subschema({schema:V,dataTypes:[],schemaPath:R1.nil,topSchemaRef:L,errSchemaPath:J},q);Y.mergeEvaluated(F),Y.ok(q)}}};function oV(Y,X){let{gen:J}=Y;return X.validate?J.scopeValue("validate",{ref:X.validate}):R1._`${J.scopeValue("wrapper",{ref:X})}.validate`}aV.getValidate=oV;function F9(Y,X,J,z){let{gen:Q,it:G}=Y,{allErrors:Z,schemaEnv:$,opts:H}=G,W=H.passContext?j6.default.this:R1.nil;if(z)K();else U();function K(){if(!$.$async)throw Error("async schema referenced by sync schema");let V=Q.let("valid");Q.try(()=>{if(Q.code(R1._`await ${(0,iV.callValidateCode)(Y,X,W)}`),O(X),!Z)Q.assign(V,!0)},(L)=>{if(Q.if(R1._`!(${L} instanceof ${G.ValidationError})`,()=>Q.throw(L)),B(L),!Z)Q.assign(V,!1)}),Y.ok(V)}function U(){Y.result((0,iV.callValidateCode)(Y,X,W),()=>O(X),()=>B(X))}function B(V){let L=R1._`${V}.errors`;Q.assign(j6.default.vErrors,R1._`${j6.default.vErrors} === null ? ${L} : ${j6.default.vErrors}.concat(${L})`),Q.assign(j6.default.errors,R1._`${j6.default.vErrors}.length`)}function O(V){var L;if(!G.opts.unevaluated)return;let q=(L=J===null||J===void 0?void 0:J.validate)===null||L===void 0?void 0:L.evaluated;if(G.props!==!0)if(q&&!q.dynamicProps){if(q.props!==void 0)G.props=x9.mergeEvaluated.props(Q,q.props,G.props)}else{let F=Q.var("props",R1._`${V}.evaluated.props`);G.props=x9.mergeEvaluated.props(Q,F,G.props,R1.Name)}if(G.items!==!0)if(q&&!q.dynamicItems){if(q.items!==void 0)G.items=x9.mergeEvaluated.items(Q,q.items,G.items)}else{let F=Q.var("items",R1._`${V}.evaluated.items`);G.items=x9.mergeEvaluated.items(Q,F,G.items,R1.Name)}}}aV.callRef=F9;aV.default=Rd});var eV=C((tV)=>{Object.defineProperty(tV,"__esModule",{value:!0});var hd=lV(),md=rV(),ud=["$schema","$id","$defs","$vocabulary",{keyword:"$comment"},"definitions",hd.default,md.default];tV.default=ud});var XO=C((YO)=>{Object.defineProperty(YO,"__esModule",{value:!0});var P9=F0(),N8=P9.operators,A9={maximum:{okStr:"<=",ok:N8.LTE,fail:N8.GT},minimum:{okStr:">=",ok:N8.GTE,fail:N8.LT},exclusiveMaximum:{okStr:"<",ok:N8.LT,fail:N8.GTE},exclusiveMinimum:{okStr:">",ok:N8.GT,fail:N8.LTE}},pd={message:({keyword:Y,schemaCode:X})=>P9.str`must be ${A9[Y].okStr} ${X}`,params:({keyword:Y,schemaCode:X})=>P9._`{comparison: ${A9[Y].okStr}, limit: ${X}}`},cd={keyword:Object.keys(A9),type:"number",schemaType:"number",$data:!0,error:pd,code(Y){let{keyword:X,data:J,schemaCode:z}=Y;Y.fail$data(P9._`${J} ${A9[X].fail} ${z} || isNaN(${J})`)}};YO.default=cd});var zO=C((JO)=>{Object.defineProperty(JO,"__esModule",{value:!0});var e5=F0(),ld={message:({schemaCode:Y})=>e5.str`must be multiple of ${Y}`,params:({schemaCode:Y})=>e5._`{multipleOf: ${Y}}`},id={keyword:"multipleOf",type:"number",schemaType:"number",$data:!0,error:ld,code(Y){let{gen:X,data:J,schemaCode:z,it:Q}=Y,G=Q.opts.multipleOfPrecision,Z=X.let("res"),$=G?e5._`Math.abs(Math.round(${Z}) - ${Z}) > 1e-${G}`:e5._`${Z} !== parseInt(${Z})`;Y.fail$data(e5._`(${z} === 0 || (${Z} = ${J}/${z}, ${$}))`)}};JO.default=id});var ZO=C((GO)=>{Object.defineProperty(GO,"__esModule",{value:!0});function QO(Y){let X=Y.length,J=0,z=0,Q;while(z<X)if(J++,Q=Y.charCodeAt(z++),Q>=55296&&Q<=56319&&z<X){if(Q=Y.charCodeAt(z),(Q&64512)===56320)z++}return J}GO.default=QO;QO.code='require("ajv/dist/runtime/ucs2length").default'});var HO=C(($O)=>{Object.defineProperty($O,"__esModule",{value:!0});var m8=F0(),ad=E0(),sd=ZO(),rd={message({keyword:Y,schemaCode:X}){let J=Y==="maxLength"?"more":"fewer";return m8.str`must NOT have ${J} than ${X} characters`},params:({schemaCode:Y})=>m8._`{limit: ${Y}}`},td={keyword:["maxLength","minLength"],type:"string",schemaType:"number",$data:!0,error:rd,code(Y){let{keyword:X,data:J,schemaCode:z,it:Q}=Y,G=X==="maxLength"?m8.operators.GT:m8.operators.LT,Z=Q.opts.unicode===!1?m8._`${J}.length`:m8._`${(0,ad.useFunc)(Y.gen,sd.default)}(${J})`;Y.fail$data(m8._`${Z} ${G} ${z}`)}};$O.default=td});var KO=C((WO)=>{Object.defineProperty(WO,"__esModule",{value:!0});var Yl=r1(),w9=F0(),Xl={message:({schemaCode:Y})=>w9.str`must match pattern "${Y}"`,params:({schemaCode:Y})=>w9._`{pattern: ${Y}}`},Jl={keyword:"pattern",type:"string",schemaType:"string",$data:!0,error:Xl,code(Y){let{data:X,$data:J,schema:z,schemaCode:Q,it:G}=Y,Z=G.opts.unicodeRegExp?"u":"",$=J?w9._`(new RegExp(${Q}, ${Z}))`:(0,Yl.usePattern)(Y,z);Y.fail$data(w9._`!${$}.test(${X})`)}};WO.default=Jl});var BO=C((UO)=>{Object.defineProperty(UO,"__esModule",{value:!0});var Y7=F0(),Ql={message({keyword:Y,schemaCode:X}){let J=Y==="maxProperties"?"more":"fewer";return Y7.str`must NOT have ${J} than ${X} properties`},params:({schemaCode:Y})=>Y7._`{limit: ${Y}}`},Gl={keyword:["maxProperties","minProperties"],type:"object",schemaType:"number",$data:!0,error:Ql,code(Y){let{keyword:X,data:J,schemaCode:z}=Y,Q=X==="maxProperties"?Y7.operators.GT:Y7.operators.LT;Y.fail$data(Y7._`Object.keys(${J}).length ${Q} ${z}`)}};UO.default=Gl});var OO=C((VO)=>{Object.defineProperty(VO,"__esModule",{value:!0});var X7=r1(),J7=F0(),$l=E0(),Hl={message:({params:{missingProperty:Y}})=>J7.str`must have required property '${Y}'`,params:({params:{missingProperty:Y}})=>J7._`{missingProperty: ${Y}}`},Wl={keyword:"required",type:"object",schemaType:"array",$data:!0,error:Hl,code(Y){let{gen:X,schema:J,schemaCode:z,data:Q,$data:G,it:Z}=Y,{opts:$}=Z;if(!G&&J.length===0)return;let H=J.length>=$.loopRequired;if(Z.allErrors)W();else K();if($.strictRequired){let O=Y.parentSchema.properties,{definedProperties:V}=Y.it;for(let L of J)if((O===null||O===void 0?void 0:O[L])===void 0&&!V.has(L)){let q=Z.schemaEnv.baseId+Z.errSchemaPath,F=`required property "${L}" is not defined at "${q}" (strictRequired)`;(0,$l.checkStrictMode)(Z,F,Z.opts.strictRequired)}}function W(){if(H||G)Y.block$data(J7.nil,U);else for(let O of J)(0,X7.checkReportMissingProp)(Y,O)}function K(){let O=X.let("missing");if(H||G){let V=X.let("valid",!0);Y.block$data(V,()=>B(O,V)),Y.ok(V)}else X.if((0,X7.checkMissingProp)(Y,J,O)),(0,X7.reportMissingProp)(Y,O),X.else()}function U(){X.forOf("prop",z,(O)=>{Y.setParams({missingProperty:O}),X.if((0,X7.noPropertyInData)(X,Q,O,$.ownProperties),()=>Y.error())})}function B(O,V){Y.setParams({missingProperty:O}),X.forOf(O,z,()=>{X.assign(V,(0,X7.propertyInData)(X,Q,O,$.ownProperties)),X.if((0,J7.not)(V),()=>{Y.error(),X.break()})},J7.nil)}}};VO.default=Wl});var LO=C((MO)=>{Object.defineProperty(MO,"__esModule",{value:!0});var z7=F0(),Ul={message({keyword:Y,schemaCode:X}){let J=Y==="maxItems"?"more":"fewer";return z7.str`must NOT have ${J} than ${X} items`},params:({schemaCode:Y})=>z7._`{limit: ${Y}}`},Bl={keyword:["maxItems","minItems"],type:"array",schemaType:"number",$data:!0,error:Ul,code(Y){let{keyword:X,data:J,schemaCode:z}=Y,Q=X==="maxItems"?z7.operators.GT:z7.operators.LT;Y.fail$data(z7._`${J}.length ${Q} ${z}`)}};MO.default=Bl});var T9=C((qO)=>{Object.defineProperty(qO,"__esModule",{value:!0});var NO=CJ();NO.code='require("ajv/dist/runtime/equal").default';qO.default=NO});var FO=C((xO)=>{Object.defineProperty(xO,"__esModule",{value:!0});var lJ=c5(),F1=F0(),Ml=E0(),Ll=T9(),Nl={message:({params:{i:Y,j:X}})=>F1.str`must NOT have duplicate items (items ## ${X} and ${Y} are identical)`,params:({params:{i:Y,j:X}})=>F1._`{i: ${Y}, j: ${X}}`},ql={keyword:"uniqueItems",type:"array",schemaType:"boolean",$data:!0,error:Nl,code(Y){let{gen:X,data:J,$data:z,schema:Q,parentSchema:G,schemaCode:Z,it:$}=Y;if(!z&&!Q)return;let H=X.let("valid"),W=G.items?(0,lJ.getSchemaTypes)(G.items):[];Y.block$data(H,K,F1._`${Z} === false`),Y.ok(H);function K(){let V=X.let("i",F1._`${J}.length`),L=X.let("j");Y.setParams({i:V,j:L}),X.assign(H,!0),X.if(F1._`${V} > 1`,()=>(U()?B:O)(V,L))}function U(){return W.length>0&&!W.some((V)=>V==="object"||V==="array")}function B(V,L){let q=X.name("item"),F=(0,lJ.checkDataTypes)(W,q,$.opts.strictNumbers,lJ.DataType.Wrong),P=X.const("indices",F1._`{}`);X.for(F1._`;${V}--;`,()=>{if(X.let(q,F1._`${J}[${V}]`),X.if(F,F1._`continue`),W.length>1)X.if(F1._`typeof ${q} == "string"`,F1._`${q} += "_"`);X.if(F1._`typeof ${P}[${q}] == "number"`,()=>{X.assign(L,F1._`${P}[${q}]`),Y.error(),X.assign(H,!1).break()}).code(F1._`${P}[${q}] = ${V}`)})}function O(V,L){let q=(0,Ml.useFunc)(X,Ll.default),F=X.name("outer");X.label(F).for(F1._`;${V}--;`,()=>X.for(F1._`${L} = ${V}; ${L}--;`,()=>X.if(F1._`${q}(${J}[${V}], ${J}[${L}])`,()=>{Y.error(),X.assign(H,!1).break(F)})))}}};xO.default=ql});var AO=C((PO)=>{Object.defineProperty(PO,"__esModule",{value:!0});var iJ=F0(),Fl=E0(),Pl=T9(),Al={message:"must be equal to constant",params:({schemaCode:Y})=>iJ._`{allowedValue: ${Y}}`},wl={keyword:"const",$data:!0,error:Al,code(Y){let{gen:X,data:J,$data:z,schemaCode:Q,schema:G}=Y;if(z||G&&typeof G=="object")Y.fail$data(iJ._`!${(0,Fl.useFunc)(X,Pl.default)}(${J}, ${Q})`);else Y.fail(iJ._`${G} !== ${J}`)}};PO.default=wl});var TO=C((wO)=>{Object.defineProperty(wO,"__esModule",{value:!0});var Q7=F0(),Il=E0(),vl=T9(),Dl={message:"must be equal to one of the allowed values",params:({schemaCode:Y})=>Q7._`{allowedValues: ${Y}}`},jl={keyword:"enum",schemaType:"array",$data:!0,error:Dl,code(Y){let{gen:X,data:J,$data:z,schema:Q,schemaCode:G,it:Z}=Y;if(!z&&Q.length===0)throw Error("enum must have non-empty array");let $=Q.length>=Z.opts.loopEnum,H,W=()=>H!==null&&H!==void 0?H:H=(0,Il.useFunc)(X,vl.default),K;if($||z)K=X.let("valid"),Y.block$data(K,U);else{if(!Array.isArray(Q))throw Error("ajv implementation error");let O=X.const("vSchema",G);K=(0,Q7.or)(...Q.map((V,L)=>B(O,L)))}Y.pass(K);function U(){X.assign(K,!1),X.forOf("v",G,(O)=>X.if(Q7._`${W()}(${J}, ${O})`,()=>X.assign(K,!0).break()))}function B(O,V){let L=Q[V];return typeof L==="object"&&L!==null?Q7._`${W()}(${J}, ${O}[${V}])`:Q7._`${J} === ${L}`}}};wO.default=jl});var vO=C((IO)=>{Object.defineProperty(IO,"__esModule",{value:!0});var El=XO(),Sl=zO(),kl=HO(),_l=KO(),bl=BO(),Rl=OO(),fl=LO(),yl=FO(),hl=AO(),ml=TO(),ul=[El.default,Sl.default,kl.default,_l.default,bl.default,Rl.default,fl.default,yl.default,{keyword:"type",schemaType:["string","array"]},{keyword:"nullable",schemaType:"boolean"},hl.default,ml.default];IO.default=ul});var oJ=C((jO)=>{Object.defineProperty(jO,"__esModule",{value:!0});jO.validateAdditionalItems=void 0;var u8=F0(),nJ=E0(),pl={message:({params:{len:Y}})=>u8.str`must NOT have more than ${Y} items`,params:({params:{len:Y}})=>u8._`{limit: ${Y}}`},cl={keyword:"additionalItems",type:"array",schemaType:["boolean","object"],before:"uniqueItems",error:pl,code(Y){let{parentSchema:X,it:J}=Y,{items:z}=X;if(!Array.isArray(z)){(0,nJ.checkStrictMode)(J,'"additionalItems" is ignored when "items" is not an array of schemas');return}DO(Y,z)}};function DO(Y,X){let{gen:J,schema:z,data:Q,keyword:G,it:Z}=Y;Z.items=!0;let $=J.const("len",u8._`${Q}.length`);if(z===!1)Y.setParams({len:X.length}),Y.pass(u8._`${$} <= ${X.length}`);else if(typeof z=="object"&&!(0,nJ.alwaysValidSchema)(Z,z)){let W=J.var("valid",u8._`${$} <= ${X.length}`);J.if((0,u8.not)(W),()=>H(W)),Y.ok(W)}function H(W){J.forRange("i",X.length,$,(K)=>{if(Y.subschema({keyword:G,dataProp:K,dataPropType:nJ.Type.Num},W),!Z.allErrors)J.if((0,u8.not)(W),()=>J.break())})}}jO.validateAdditionalItems=DO;jO.default=cl});var aJ=C((kO)=>{Object.defineProperty(kO,"__esModule",{value:!0});kO.validateTuple=void 0;var EO=F0(),I9=E0(),ll=r1(),il={keyword:"items",type:"array",schemaType:["object","array","boolean"],before:"uniqueItems",code(Y){let{schema:X,it:J}=Y;if(Array.isArray(X))return SO(Y,"additionalItems",X);if(J.items=!0,(0,I9.alwaysValidSchema)(J,X))return;Y.ok((0,ll.validateArray)(Y))}};function SO(Y,X,J=Y.schema){let{gen:z,parentSchema:Q,data:G,keyword:Z,it:$}=Y;if(K(Q),$.opts.unevaluated&&J.length&&$.items!==!0)$.items=I9.mergeEvaluated.items(z,J.length,$.items);let H=z.name("valid"),W=z.const("len",EO._`${G}.length`);J.forEach((U,B)=>{if((0,I9.alwaysValidSchema)($,U))return;z.if(EO._`${W} > ${B}`,()=>Y.subschema({keyword:Z,schemaProp:B,dataProp:B},H)),Y.ok(H)});function K(U){let{opts:B,errSchemaPath:O}=$,V=J.length,L=V===U.minItems&&(V===U.maxItems||U[X]===!1);if(B.strictTuples&&!L){let q=`"${Z}" is ${V}-tuple, but minItems or maxItems/${X} are not specified or different at path "${O}"`;(0,I9.checkStrictMode)($,q,B.strictTuples)}}}kO.validateTuple=SO;kO.default=il});var RO=C((bO)=>{Object.defineProperty(bO,"__esModule",{value:!0});var ol=aJ(),al={keyword:"prefixItems",type:"array",schemaType:["array"],before:"uniqueItems",code:(Y)=>(0,ol.validateTuple)(Y,"items")};bO.default=al});var hO=C((yO)=>{Object.defineProperty(yO,"__esModule",{value:!0});var fO=F0(),rl=E0(),tl=r1(),el=oJ(),Yi={message:({params:{len:Y}})=>fO.str`must NOT have more than ${Y} items`,params:({params:{len:Y}})=>fO._`{limit: ${Y}}`},Xi={keyword:"items",type:"array",schemaType:["object","boolean"],before:"uniqueItems",error:Yi,code(Y){let{schema:X,parentSchema:J,it:z}=Y,{prefixItems:Q}=J;if(z.items=!0,(0,rl.alwaysValidSchema)(z,X))return;if(Q)(0,el.validateAdditionalItems)(Y,Q);else Y.ok((0,tl.validateArray)(Y))}};yO.default=Xi});var uO=C((mO)=>{Object.defineProperty(mO,"__esModule",{value:!0});var t1=F0(),v9=E0(),zi={message:({params:{min:Y,max:X}})=>X===void 0?t1.str`must contain at least ${Y} valid item(s)`:t1.str`must contain at least ${Y} and no more than ${X} valid item(s)`,params:({params:{min:Y,max:X}})=>X===void 0?t1._`{minContains: ${Y}}`:t1._`{minContains: ${Y}, maxContains: ${X}}`},Qi={keyword:"contains",type:"array",schemaType:["object","boolean"],before:"uniqueItems",trackErrors:!0,error:zi,code(Y){let{gen:X,schema:J,parentSchema:z,data:Q,it:G}=Y,Z,$,{minContains:H,maxContains:W}=z;if(G.opts.next)Z=H===void 0?1:H,$=W;else Z=1;let K=X.const("len",t1._`${Q}.length`);if(Y.setParams({min:Z,max:$}),$===void 0&&Z===0){(0,v9.checkStrictMode)(G,'"minContains" == 0 without "maxContains": "contains" keyword ignored');return}if($!==void 0&&Z>$){(0,v9.checkStrictMode)(G,'"minContains" > "maxContains" is always invalid'),Y.fail();return}if((0,v9.alwaysValidSchema)(G,J)){let L=t1._`${K} >= ${Z}`;if($!==void 0)L=t1._`${L} && ${K} <= ${$}`;Y.pass(L);return}G.items=!0;let U=X.name("valid");if($===void 0&&Z===1)O(U,()=>X.if(U,()=>X.break()));else if(Z===0){if(X.let(U,!0),$!==void 0)X.if(t1._`${Q}.length > 0`,B)}else X.let(U,!1),B();Y.result(U,()=>Y.reset());function B(){let L=X.name("_valid"),q=X.let("count",0);O(L,()=>X.if(L,()=>V(q)))}function O(L,q){X.forRange("i",0,K,(F)=>{Y.subschema({keyword:"contains",dataProp:F,dataPropType:v9.Type.Num,compositeRule:!0},L),q()})}function V(L){if(X.code(t1._`${L}++`),$===void 0)X.if(t1._`${L} >= ${Z}`,()=>X.assign(U,!0).break());else if(X.if(t1._`${L} > ${$}`,()=>X.assign(U,!1).break()),Z===1)X.assign(U,!0);else X.if(t1._`${L} >= ${Z}`,()=>X.assign(U,!0))}}};mO.default=Qi});var iO=C((cO)=>{Object.defineProperty(cO,"__esModule",{value:!0});cO.validateSchemaDeps=cO.validatePropertyDeps=cO.error=void 0;var sJ=F0(),Zi=E0(),G7=r1();cO.error={message:({params:{property:Y,depsCount:X,deps:J}})=>{let z=X===1?"property":"properties";return sJ.str`must have ${z} ${J} when property ${Y} is present`},params:({params:{property:Y,depsCount:X,deps:J,missingProperty:z}})=>sJ._`{property: ${Y},
    missingProperty: ${z},
    depsCount: ${X},
    deps: ${J}}`};var $i={keyword:"dependencies",type:"object",schemaType:"object",error:cO.error,code(Y){let[X,J]=Hi(Y);gO(Y,X),pO(Y,J)}};function Hi({schema:Y}){let X={},J={};for(let z in Y){if(z==="__proto__")continue;let Q=Array.isArray(Y[z])?X:J;Q[z]=Y[z]}return[X,J]}function gO(Y,X=Y.schema){let{gen:J,data:z,it:Q}=Y;if(Object.keys(X).length===0)return;let G=J.let("missing");for(let Z in X){let $=X[Z];if($.length===0)continue;let H=(0,G7.propertyInData)(J,z,Z,Q.opts.ownProperties);if(Y.setParams({property:Z,depsCount:$.length,deps:$.join(", ")}),Q.allErrors)J.if(H,()=>{for(let W of $)(0,G7.checkReportMissingProp)(Y,W)});else J.if(sJ._`${H} && (${(0,G7.checkMissingProp)(Y,$,G)})`),(0,G7.reportMissingProp)(Y,G),J.else()}}cO.validatePropertyDeps=gO;function pO(Y,X=Y.schema){let{gen:J,data:z,keyword:Q,it:G}=Y,Z=J.name("valid");for(let $ in X){if((0,Zi.alwaysValidSchema)(G,X[$]))continue;J.if((0,G7.propertyInData)(J,z,$,G.opts.ownProperties),()=>{let H=Y.subschema({keyword:Q,schemaProp:$},Z);Y.mergeValidEvaluated(H,Z)},()=>J.var(Z,!0)),Y.ok(Z)}}cO.validateSchemaDeps=pO;cO.default=$i});var aO=C((oO)=>{Object.defineProperty(oO,"__esModule",{value:!0});var nO=F0(),Ui=E0(),Bi={message:"property name must be valid",params:({params:Y})=>nO._`{propertyName: ${Y.propertyName}}`},Vi={keyword:"propertyNames",type:"object",schemaType:["object","boolean"],error:Bi,code(Y){let{gen:X,schema:J,data:z,it:Q}=Y;if((0,Ui.alwaysValidSchema)(Q,J))return;let G=X.name("valid");X.forIn("key",z,(Z)=>{Y.setParams({propertyName:Z}),Y.subschema({keyword:"propertyNames",data:Z,dataTypes:["string"],propertyName:Z,compositeRule:!0},G),X.if((0,nO.not)(G),()=>{if(Y.error(!0),!Q.allErrors)X.break()})}),Y.ok(G)}};oO.default=Vi});var rJ=C((sO)=>{Object.defineProperty(sO,"__esModule",{value:!0});var D9=r1(),V4=F0(),Mi=i4(),j9=E0(),Li={message:"must NOT have additional properties",params:({params:Y})=>V4._`{additionalProperty: ${Y.additionalProperty}}`},Ni={keyword:"additionalProperties",type:["object"],schemaType:["boolean","object"],allowUndefined:!0,trackErrors:!0,error:Li,code(Y){let{gen:X,schema:J,parentSchema:z,data:Q,errsCount:G,it:Z}=Y;if(!G)throw Error("ajv implementation error");let{allErrors:$,opts:H}=Z;if(Z.props=!0,H.removeAdditional!=="all"&&(0,j9.alwaysValidSchema)(Z,J))return;let W=(0,D9.allSchemaProperties)(z.properties),K=(0,D9.allSchemaProperties)(z.patternProperties);U(),Y.ok(V4._`${G} === ${Mi.default.errors}`);function U(){X.forIn("key",Q,(q)=>{if(!W.length&&!K.length)V(q);else X.if(B(q),()=>V(q))})}function B(q){let F;if(W.length>8){let P=(0,j9.schemaRefOrVal)(Z,z.properties,"properties");F=(0,D9.isOwnProperty)(X,P,q)}else if(W.length)F=(0,V4.or)(...W.map((P)=>V4._`${q} === ${P}`));else F=V4.nil;if(K.length)F=(0,V4.or)(F,...K.map((P)=>V4._`${(0,D9.usePattern)(Y,P)}.test(${q})`));return(0,V4.not)(F)}function O(q){X.code(V4._`delete ${Q}[${q}]`)}function V(q){if(H.removeAdditional==="all"||H.removeAdditional&&J===!1){O(q);return}if(J===!1){if(Y.setParams({additionalProperty:q}),Y.error(),!$)X.break();return}if(typeof J=="object"&&!(0,j9.alwaysValidSchema)(Z,J)){let F=X.name("valid");if(H.removeAdditional==="failing")L(q,F,!1),X.if((0,V4.not)(F),()=>{Y.reset(),O(q)});else if(L(q,F),!$)X.if((0,V4.not)(F),()=>X.break())}}function L(q,F,P){let A={keyword:"additionalProperties",dataProp:q,dataPropType:j9.Type.Str};if(P===!1)Object.assign(A,{compositeRule:!0,createErrors:!1,allErrors:!1});Y.subschema(A,F)}}};sO.default=Ni});var Y2=C((eO)=>{Object.defineProperty(eO,"__esModule",{value:!0});var xi=n5(),rO=r1(),tJ=E0(),tO=rJ(),Fi={keyword:"properties",type:"object",schemaType:"object",code(Y){let{gen:X,schema:J,parentSchema:z,data:Q,it:G}=Y;if(G.opts.removeAdditional==="all"&&z.additionalProperties===void 0)tO.default.code(new xi.KeywordCxt(G,tO.default,"additionalProperties"));let Z=(0,rO.allSchemaProperties)(J);for(let U of Z)G.definedProperties.add(U);if(G.opts.unevaluated&&Z.length&&G.props!==!0)G.props=tJ.mergeEvaluated.props(X,(0,tJ.toHash)(Z),G.props);let $=Z.filter((U)=>!(0,tJ.alwaysValidSchema)(G,J[U]));if($.length===0)return;let H=X.name("valid");for(let U of $){if(W(U))K(U);else{if(X.if((0,rO.propertyInData)(X,Q,U,G.opts.ownProperties)),K(U),!G.allErrors)X.else().var(H,!0);X.endIf()}Y.it.definedProperties.add(U),Y.ok(H)}function W(U){return G.opts.useDefaults&&!G.compositeRule&&J[U].default!==void 0}function K(U){Y.subschema({keyword:"properties",schemaProp:U,dataProp:U},H)}}};eO.default=Fi});var G2=C((Q2)=>{Object.defineProperty(Q2,"__esModule",{value:!0});var X2=r1(),C9=F0(),J2=E0(),z2=E0(),Ai={keyword:"patternProperties",type:"object",schemaType:"object",code(Y){let{gen:X,schema:J,data:z,parentSchema:Q,it:G}=Y,{opts:Z}=G,$=(0,X2.allSchemaProperties)(J),H=$.filter((L)=>(0,J2.alwaysValidSchema)(G,J[L]));if($.length===0||H.length===$.length&&(!G.opts.unevaluated||G.props===!0))return;let W=Z.strictSchema&&!Z.allowMatchingProperties&&Q.properties,K=X.name("valid");if(G.props!==!0&&!(G.props instanceof C9.Name))G.props=(0,z2.evaluatedPropsToName)(X,G.props);let{props:U}=G;B();function B(){for(let L of $){if(W)O(L);if(G.allErrors)V(L);else X.var(K,!0),V(L),X.if(K)}}function O(L){for(let q in W)if(new RegExp(L).test(q))(0,J2.checkStrictMode)(G,`property ${q} matches pattern ${L} (use allowMatchingProperties)`)}function V(L){X.forIn("key",z,(q)=>{X.if(C9._`${(0,X2.usePattern)(Y,L)}.test(${q})`,()=>{let F=H.includes(L);if(!F)Y.subschema({keyword:"patternProperties",schemaProp:L,dataProp:q,dataPropType:z2.Type.Str},K);if(G.opts.unevaluated&&U!==!0)X.assign(C9._`${U}[${q}]`,!0);else if(!F&&!G.allErrors)X.if((0,C9.not)(K),()=>X.break())})})}}};Q2.default=Ai});var $2=C((Z2)=>{Object.defineProperty(Z2,"__esModule",{value:!0});var Ti=E0(),Ii={keyword:"not",schemaType:["object","boolean"],trackErrors:!0,code(Y){let{gen:X,schema:J,it:z}=Y;if((0,Ti.alwaysValidSchema)(z,J)){Y.fail();return}let Q=X.name("valid");Y.subschema({keyword:"not",compositeRule:!0,createErrors:!1,allErrors:!1},Q),Y.failResult(Q,()=>Y.reset(),()=>Y.error())},error:{message:"must NOT be valid"}};Z2.default=Ii});var W2=C((H2)=>{Object.defineProperty(H2,"__esModule",{value:!0});var Di=r1(),ji={keyword:"anyOf",schemaType:"array",trackErrors:!0,code:Di.validateUnion,error:{message:"must match a schema in anyOf"}};H2.default=ji});var U2=C((K2)=>{Object.defineProperty(K2,"__esModule",{value:!0});var E9=F0(),Ei=E0(),Si={message:"must match exactly one schema in oneOf",params:({params:Y})=>E9._`{passingSchemas: ${Y.passing}}`},ki={keyword:"oneOf",schemaType:"array",trackErrors:!0,error:Si,code(Y){let{gen:X,schema:J,parentSchema:z,it:Q}=Y;if(!Array.isArray(J))throw Error("ajv implementation error");if(Q.opts.discriminator&&z.discriminator)return;let G=J,Z=X.let("valid",!1),$=X.let("passing",null),H=X.name("_valid");Y.setParams({passing:$}),X.block(W),Y.result(Z,()=>Y.reset(),()=>Y.error(!0));function W(){G.forEach((K,U)=>{let B;if((0,Ei.alwaysValidSchema)(Q,K))X.var(H,!0);else B=Y.subschema({keyword:"oneOf",schemaProp:U,compositeRule:!0},H);if(U>0)X.if(E9._`${H} && ${Z}`).assign(Z,!1).assign($,E9._`[${$}, ${U}]`).else();X.if(H,()=>{if(X.assign(Z,!0),X.assign($,U),B)Y.mergeEvaluated(B,E9.Name)})})}}};K2.default=ki});var V2=C((B2)=>{Object.defineProperty(B2,"__esModule",{value:!0});var bi=E0(),Ri={keyword:"allOf",schemaType:"array",code(Y){let{gen:X,schema:J,it:z}=Y;if(!Array.isArray(J))throw Error("ajv implementation error");let Q=X.name("valid");J.forEach((G,Z)=>{if((0,bi.alwaysValidSchema)(z,G))return;let $=Y.subschema({keyword:"allOf",schemaProp:Z},Q);Y.ok(Q),Y.mergeEvaluated($)})}};B2.default=Ri});var N2=C((L2)=>{Object.defineProperty(L2,"__esModule",{value:!0});var S9=F0(),M2=E0(),yi={message:({params:Y})=>S9.str`must match "${Y.ifClause}" schema`,params:({params:Y})=>S9._`{failingKeyword: ${Y.ifClause}}`},hi={keyword:"if",schemaType:["object","boolean"],trackErrors:!0,error:yi,code(Y){let{gen:X,parentSchema:J,it:z}=Y;if(J.then===void 0&&J.else===void 0)(0,M2.checkStrictMode)(z,'"if" without "then" and "else" is ignored');let Q=O2(z,"then"),G=O2(z,"else");if(!Q&&!G)return;let Z=X.let("valid",!0),$=X.name("_valid");if(H(),Y.reset(),Q&&G){let K=X.let("ifClause");Y.setParams({ifClause:K}),X.if($,W("then",K),W("else",K))}else if(Q)X.if($,W("then"));else X.if((0,S9.not)($),W("else"));Y.pass(Z,()=>Y.error(!0));function H(){let K=Y.subschema({keyword:"if",compositeRule:!0,createErrors:!1,allErrors:!1},$);Y.mergeEvaluated(K)}function W(K,U){return()=>{let B=Y.subschema({keyword:K},$);if(X.assign(Z,$),Y.mergeValidEvaluated(B,Z),U)X.assign(U,S9._`${K}`);else Y.setParams({ifClause:K})}}}};function O2(Y,X){let J=Y.schema[X];return J!==void 0&&!(0,M2.alwaysValidSchema)(Y,J)}L2.default=hi});var x2=C((q2)=>{Object.defineProperty(q2,"__esModule",{value:!0});var ui=E0(),gi={keyword:["then","else"],schemaType:["object","boolean"],code({keyword:Y,parentSchema:X,it:J}){if(X.if===void 0)(0,ui.checkStrictMode)(J,`"${Y}" without "if" is ignored`)}};q2.default=gi});var P2=C((F2)=>{Object.defineProperty(F2,"__esModule",{value:!0});var ci=oJ(),di=RO(),li=aJ(),ii=hO(),ni=uO(),oi=iO(),ai=aO(),si=rJ(),ri=Y2(),ti=G2(),ei=$2(),Yn=W2(),Xn=U2(),Jn=V2(),zn=N2(),Qn=x2();function Gn(Y=!1){let X=[ei.default,Yn.default,Xn.default,Jn.default,zn.default,Qn.default,ai.default,si.default,oi.default,ri.default,ti.default];if(Y)X.push(di.default,ii.default);else X.push(ci.default,li.default);return X.push(ni.default),X}F2.default=Gn});var w2=C((A2)=>{Object.defineProperty(A2,"__esModule",{value:!0});var Y1=F0(),$n={message:({schemaCode:Y})=>Y1.str`must match format "${Y}"`,params:({schemaCode:Y})=>Y1._`{format: ${Y}}`},Hn={keyword:"format",type:["number","string"],schemaType:"string",$data:!0,error:$n,code(Y,X){let{gen:J,data:z,$data:Q,schema:G,schemaCode:Z,it:$}=Y,{opts:H,errSchemaPath:W,schemaEnv:K,self:U}=$;if(!H.validateFormats)return;if(Q)B();else O();function B(){let V=J.scopeValue("formats",{ref:U.formats,code:H.code.formats}),L=J.const("fDef",Y1._`${V}[${Z}]`),q=J.let("fType"),F=J.let("format");J.if(Y1._`typeof ${L} == "object" && !(${L} instanceof RegExp)`,()=>J.assign(q,Y1._`${L}.type || "string"`).assign(F,Y1._`${L}.validate`),()=>J.assign(q,Y1._`"string"`).assign(F,L)),Y.fail$data((0,Y1.or)(P(),A()));function P(){if(H.strictSchema===!1)return Y1.nil;return Y1._`${Z} && !${F}`}function A(){let w=K.$async?Y1._`(${L}.async ? await ${F}(${z}) : ${F}(${z}))`:Y1._`${F}(${z})`,v=Y1._`(typeof ${F} == "function" ? ${w} : ${F}.test(${z}))`;return Y1._`${F} && ${F} !== true && ${q} === ${X} && !${v}`}}function O(){let V=U.formats[G];if(!V){P();return}if(V===!0)return;let[L,q,F]=A(V);if(L===X)Y.pass(w());function P(){if(H.strictSchema===!1){U.logger.warn(v());return}throw Error(v());function v(){return`unknown format "${G}" ignored in schema at path "${W}"`}}function A(v){let T=v instanceof RegExp?(0,Y1.regexpCode)(v):H.code.formats?Y1._`${H.code.formats}${(0,Y1.getProperty)(G)}`:void 0,D=J.scopeValue("formats",{key:G,ref:v,code:T});if(typeof v=="object"&&!(v instanceof RegExp))return[v.type||"string",v.validate,Y1._`${D}.validate`];return["string",v,D]}function w(){if(typeof V=="object"&&!(V instanceof RegExp)&&V.async){if(!K.$async)throw Error("async format in sync schema");return Y1._`await ${F}(${z})`}return typeof q=="function"?Y1._`${F}(${z})`:Y1._`${F}.test(${z})`}}}};A2.default=Hn});var I2=C((T2)=>{Object.defineProperty(T2,"__esModule",{value:!0});var Kn=w2(),Un=[Kn.default];T2.default=Un});var j2=C((v2)=>{Object.defineProperty(v2,"__esModule",{value:!0});v2.contentVocabulary=v2.metadataVocabulary=void 0;v2.metadataVocabulary=["title","description","default","deprecated","readOnly","writeOnly","examples"];v2.contentVocabulary=["contentMediaType","contentEncoding","contentSchema"]});var S2=C((E2)=>{Object.defineProperty(E2,"__esModule",{value:!0});var On=eV(),Mn=vO(),Ln=P2(),Nn=I2(),C2=j2(),qn=[On.default,Mn.default,(0,Ln.default)(),Nn.default,C2.metadataVocabulary,C2.contentVocabulary];E2.default=qn});var R2=C((_2)=>{Object.defineProperty(_2,"__esModule",{value:!0});_2.DiscrError=void 0;var k2;(function(Y){Y.Tag="tag",Y.Mapping="mapping"})(k2||(_2.DiscrError=k2={}))});var h2=C((y2)=>{Object.defineProperty(y2,"__esModule",{value:!0});var C6=F0(),eJ=R2(),f2=B9(),Fn=o5(),Pn=E0(),An={message:({params:{discrError:Y,tagName:X}})=>Y===eJ.DiscrError.Tag?`tag "${X}" must be string`:`value of tag "${X}" must be in oneOf`,params:({params:{discrError:Y,tag:X,tagName:J}})=>C6._`{error: ${Y}, tag: ${J}, tagValue: ${X}}`},wn={keyword:"discriminator",type:"object",schemaType:"object",error:An,code(Y){let{gen:X,data:J,schema:z,parentSchema:Q,it:G}=Y,{oneOf:Z}=Q;if(!G.opts.discriminator)throw Error("discriminator: requires discriminator option");let $=z.propertyName;if(typeof $!="string")throw Error("discriminator: requires propertyName");if(z.mapping)throw Error("discriminator: mapping is not supported");if(!Z)throw Error("discriminator: requires oneOf keyword");let H=X.let("valid",!1),W=X.const("tag",C6._`${J}${(0,C6.getProperty)($)}`);X.if(C6._`typeof ${W} == "string"`,()=>K(),()=>Y.error(!1,{discrError:eJ.DiscrError.Tag,tag:W,tagName:$})),Y.ok(H);function K(){let O=B();X.if(!1);for(let V in O)X.elseIf(C6._`${W} === ${V}`),X.assign(H,U(O[V]));X.else(),Y.error(!1,{discrError:eJ.DiscrError.Mapping,tag:W,tagName:$}),X.endIf()}function U(O){let V=X.name("valid"),L=Y.subschema({keyword:"oneOf",schemaProp:O},V);return Y.mergeEvaluated(L,C6.Name),V}function B(){var O;let V={},L=F(Q),q=!0;for(let w=0;w<Z.length;w++){let v=Z[w];if((v===null||v===void 0?void 0:v.$ref)&&!(0,Pn.schemaHasRulesButRef)(v,G.self.RULES)){let D=v.$ref;if(v=f2.resolveRef.call(G.self,G.schemaEnv.root,G.baseId,D),v instanceof f2.SchemaEnv)v=v.schema;if(v===void 0)throw new Fn.default(G.opts.uriResolver,G.baseId,D)}let T=(O=v===null||v===void 0?void 0:v.properties)===null||O===void 0?void 0:O[$];if(typeof T!="object")throw Error(`discriminator: oneOf subschemas (or referenced schemas) must have "properties/${$}"`);q=q&&(L||F(v)),P(T,w)}if(!q)throw Error(`discriminator: "${$}" must be required`);return V;function F({required:w}){return Array.isArray(w)&&w.includes($)}function P(w,v){if(w.const)A(w.const,v);else if(w.enum)for(let T of w.enum)A(T,v);else throw Error(`discriminator: "properties/${$}" must have "const" or "enum"`)}function A(w,v){if(typeof w!="string"||w in V)throw Error(`discriminator: "${$}" values must be unique strings`);V[w]=v}}}};y2.default=wn});var m2=C((HW0,In)=>{In.exports={$schema:"http://json-schema.org/draft-07/schema#",$id:"http://json-schema.org/draft-07/schema#",title:"Core schema meta-schema",definitions:{schemaArray:{type:"array",minItems:1,items:{$ref:"#"}},nonNegativeInteger:{type:"integer",minimum:0},nonNegativeIntegerDefault0:{allOf:[{$ref:"#/definitions/nonNegativeInteger"},{default:0}]},simpleTypes:{enum:["array","boolean","integer","null","number","object","string"]},stringArray:{type:"array",items:{type:"string"},uniqueItems:!0,default:[]}},type:["object","boolean"],properties:{$id:{type:"string",format:"uri-reference"},$schema:{type:"string",format:"uri"},$ref:{type:"string",format:"uri-reference"},$comment:{type:"string"},title:{type:"string"},description:{type:"string"},default:!0,readOnly:{type:"boolean",default:!1},examples:{type:"array",items:!0},multipleOf:{type:"number",exclusiveMinimum:0},maximum:{type:"number"},exclusiveMaximum:{type:"number"},minimum:{type:"number"},exclusiveMinimum:{type:"number"},maxLength:{$ref:"#/definitions/nonNegativeInteger"},minLength:{$ref:"#/definitions/nonNegativeIntegerDefault0"},pattern:{type:"string",format:"regex"},additionalItems:{$ref:"#"},items:{anyOf:[{$ref:"#"},{$ref:"#/definitions/schemaArray"}],default:!0},maxItems:{$ref:"#/definitions/nonNegativeInteger"},minItems:{$ref:"#/definitions/nonNegativeIntegerDefault0"},uniqueItems:{type:"boolean",default:!1},contains:{$ref:"#"},maxProperties:{$ref:"#/definitions/nonNegativeInteger"},minProperties:{$ref:"#/definitions/nonNegativeIntegerDefault0"},required:{$ref:"#/definitions/stringArray"},additionalProperties:{$ref:"#"},definitions:{type:"object",additionalProperties:{$ref:"#"},default:{}},properties:{type:"object",additionalProperties:{$ref:"#"},default:{}},patternProperties:{type:"object",additionalProperties:{$ref:"#"},propertyNames:{format:"regex"},default:{}},dependencies:{type:"object",additionalProperties:{anyOf:[{$ref:"#"},{$ref:"#/definitions/stringArray"}]}},propertyNames:{$ref:"#"},const:!0,enum:{type:"array",items:!0,minItems:1,uniqueItems:!0},type:{anyOf:[{$ref:"#/definitions/simpleTypes"},{type:"array",items:{$ref:"#/definitions/simpleTypes"},minItems:1,uniqueItems:!0}]},format:{type:"string"},contentMediaType:{type:"string"},contentEncoding:{type:"string"},if:{$ref:"#"},then:{$ref:"#"},else:{$ref:"#"},allOf:{$ref:"#/definitions/schemaArray"},anyOf:{$ref:"#/definitions/schemaArray"},oneOf:{$ref:"#/definitions/schemaArray"},not:{$ref:"#"}},default:!0}});var Xz=C((f1,Yz)=>{Object.defineProperty(f1,"__esModule",{value:!0});f1.MissingRefError=f1.ValidationError=f1.CodeGen=f1.Name=f1.nil=f1.stringify=f1.str=f1._=f1.KeywordCxt=f1.Ajv=void 0;var vn=cV(),Dn=S2(),jn=h2(),u2=m2(),Cn=["/properties"],k9="http://json-schema.org/draft-07/schema";class Z7 extends vn.default{_addVocabularies(){if(super._addVocabularies(),Dn.default.forEach((Y)=>this.addVocabulary(Y)),this.opts.discriminator)this.addKeyword(jn.default)}_addDefaultMetaSchema(){if(super._addDefaultMetaSchema(),!this.opts.meta)return;let Y=this.opts.$data?this.$dataMetaSchema(u2,Cn):u2;this.addMetaSchema(Y,k9,!1),this.refs["http://json-schema.org/schema"]=k9}defaultMeta(){return this.opts.defaultMeta=super.defaultMeta()||(this.getSchema(k9)?k9:void 0)}}f1.Ajv=Z7;Yz.exports=f1=Z7;Yz.exports.Ajv=Z7;Object.defineProperty(f1,"__esModule",{value:!0});f1.default=Z7;var En=n5();Object.defineProperty(f1,"KeywordCxt",{enumerable:!0,get:function(){return En.KeywordCxt}});var E6=F0();Object.defineProperty(f1,"_",{enumerable:!0,get:function(){return E6._}});Object.defineProperty(f1,"str",{enumerable:!0,get:function(){return E6.str}});Object.defineProperty(f1,"stringify",{enumerable:!0,get:function(){return E6.stringify}});Object.defineProperty(f1,"nil",{enumerable:!0,get:function(){return E6.nil}});Object.defineProperty(f1,"Name",{enumerable:!0,get:function(){return E6.Name}});Object.defineProperty(f1,"CodeGen",{enumerable:!0,get:function(){return E6.CodeGen}});var Sn=K9();Object.defineProperty(f1,"ValidationError",{enumerable:!0,get:function(){return Sn.default}});var kn=o5();Object.defineProperty(f1,"MissingRefError",{enumerable:!0,get:function(){return kn.default}})});var s2=C((o2)=>{Object.defineProperty(o2,"__esModule",{value:!0});o2.formatNames=o2.fastFormats=o2.fullFormats=void 0;function j4(Y,X){return{validate:Y,compare:X}}o2.fullFormats={date:j4(d2,Gz),time:j4(zz(!0),Zz),"date-time":j4(g2(!0),i2),"iso-time":j4(zz(),l2),"iso-date-time":j4(g2(),n2),duration:/^P(?!$)((\d+Y)?(\d+M)?(\d+D)?(T(?=\d)(\d+H)?(\d+M)?(\d+S)?)?|(\d+W)?)$/,uri:un,"uri-reference":/^(?:[a-z][a-z0-9+\-.]*:)?(?:\/?\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:]|%[0-9a-f]{2})*@)?(?:\[(?:(?:(?:(?:[0-9a-f]{1,4}:){6}|::(?:[0-9a-f]{1,4}:){5}|(?:[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){4}|(?:(?:[0-9a-f]{1,4}:){0,1}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){3}|(?:(?:[0-9a-f]{1,4}:){0,2}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){2}|(?:(?:[0-9a-f]{1,4}:){0,3}[0-9a-f]{1,4})?::[0-9a-f]{1,4}:|(?:(?:[0-9a-f]{1,4}:){0,4}[0-9a-f]{1,4})?::)(?:[0-9a-f]{1,4}:[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?))|(?:(?:[0-9a-f]{1,4}:){0,5}[0-9a-f]{1,4})?::[0-9a-f]{1,4}|(?:(?:[0-9a-f]{1,4}:){0,6}[0-9a-f]{1,4})?::)|[Vv][0-9a-f]+\.[a-z0-9\-._~!$&'()*+,;=:]+)\]|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)|(?:[a-z0-9\-._~!$&'"()*+,;=]|%[0-9a-f]{2})*)(?::\d*)?(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*|\/(?:(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*)?|(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*)?(?:\?(?:[a-z0-9\-._~!$&'"()*+,;=:@/?]|%[0-9a-f]{2})*)?(?:#(?:[a-z0-9\-._~!$&'"()*+,;=:@/?]|%[0-9a-f]{2})*)?$/i,"uri-template":/^(?:(?:[^\x00-\x20"'<>%\\^`{|}]|%[0-9a-f]{2})|\{[+#./;?&=,!@|]?(?:[a-z0-9_]|%[0-9a-f]{2})+(?::[1-9][0-9]{0,3}|\*)?(?:,(?:[a-z0-9_]|%[0-9a-f]{2})+(?::[1-9][0-9]{0,3}|\*)?)*\})*$/i,url:/^(?:https?|ftp):\/\/(?:\S+(?::\S*)?@)?(?:(?!(?:10|127)(?:\.\d{1,3}){3})(?!(?:169\.254|192\.168)(?:\.\d{1,3}){2})(?!172\.(?:1[6-9]|2\d|3[0-1])(?:\.\d{1,3}){2})(?:[1-9]\d?|1\d\d|2[01]\d|22[0-3])(?:\.(?:1?\d{1,2}|2[0-4]\d|25[0-5])){2}(?:\.(?:[1-9]\d?|1\d\d|2[0-4]\d|25[0-4]))|(?:(?:[a-z0-9\u{00a1}-\u{ffff}]+-)*[a-z0-9\u{00a1}-\u{ffff}]+)(?:\.(?:[a-z0-9\u{00a1}-\u{ffff}]+-)*[a-z0-9\u{00a1}-\u{ffff}]+)*(?:\.(?:[a-z\u{00a1}-\u{ffff}]{2,})))(?::\d{2,5})?(?:\/[^\s]*)?$/iu,email:/^[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*@(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?$/i,hostname:/^(?=.{1,253}\.?$)[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?(?:\.[a-z0-9](?:[-0-9a-z]{0,61}[0-9a-z])?)*\.?$/i,ipv4:/^(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)\.){3}(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)$/,ipv6:/^((([0-9a-f]{1,4}:){7}([0-9a-f]{1,4}|:))|(([0-9a-f]{1,4}:){6}(:[0-9a-f]{1,4}|((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9a-f]{1,4}:){5}(((:[0-9a-f]{1,4}){1,2})|:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9a-f]{1,4}:){4}(((:[0-9a-f]{1,4}){1,3})|((:[0-9a-f]{1,4})?:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9a-f]{1,4}:){3}(((:[0-9a-f]{1,4}){1,4})|((:[0-9a-f]{1,4}){0,2}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9a-f]{1,4}:){2}(((:[0-9a-f]{1,4}){1,5})|((:[0-9a-f]{1,4}){0,3}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9a-f]{1,4}:){1}(((:[0-9a-f]{1,4}){1,6})|((:[0-9a-f]{1,4}){0,4}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(:(((:[0-9a-f]{1,4}){1,7})|((:[0-9a-f]{1,4}){0,5}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:)))$/i,regex:on,uuid:/^(?:urn:uuid:)?[0-9a-f]{8}-(?:[0-9a-f]{4}-){3}[0-9a-f]{12}$/i,"json-pointer":/^(?:\/(?:[^~/]|~0|~1)*)*$/,"json-pointer-uri-fragment":/^#(?:\/(?:[a-z0-9_\-.!$&'()*+,;:=@]|%[0-9a-f]{2}|~0|~1)*)*$/i,"relative-json-pointer":/^(?:0|[1-9][0-9]*)(?:#|(?:\/(?:[^~/]|~0|~1)*)*)$/,byte:gn,int32:{type:"number",validate:dn},int64:{type:"number",validate:ln},float:{type:"number",validate:c2},double:{type:"number",validate:c2},password:!0,binary:!0};o2.fastFormats={...o2.fullFormats,date:j4(/^\d\d\d\d-[0-1]\d-[0-3]\d$/,Gz),time:j4(/^(?:[0-2]\d:[0-5]\d:[0-5]\d|23:59:60)(?:\.\d+)?(?:z|[+-]\d\d(?::?\d\d)?)$/i,Zz),"date-time":j4(/^\d\d\d\d-[0-1]\d-[0-3]\dt(?:[0-2]\d:[0-5]\d:[0-5]\d|23:59:60)(?:\.\d+)?(?:z|[+-]\d\d(?::?\d\d)?)$/i,i2),"iso-time":j4(/^(?:[0-2]\d:[0-5]\d:[0-5]\d|23:59:60)(?:\.\d+)?(?:z|[+-]\d\d(?::?\d\d)?)?$/i,l2),"iso-date-time":j4(/^\d\d\d\d-[0-1]\d-[0-3]\d[t\s](?:[0-2]\d:[0-5]\d:[0-5]\d|23:59:60)(?:\.\d+)?(?:z|[+-]\d\d(?::?\d\d)?)?$/i,n2),uri:/^(?:[a-z][a-z0-9+\-.]*:)(?:\/?\/)?[^\s]*$/i,"uri-reference":/^(?:(?:[a-z][a-z0-9+\-.]*:)?\/?\/)?(?:[^\\\s#][^\s#]*)?(?:#[^\\\s]*)?$/i,email:/^[a-z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?(?:\.[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?)*$/i};o2.formatNames=Object.keys(o2.fullFormats);function Rn(Y){return Y%4===0&&(Y%100!==0||Y%400===0)}var fn=/^(\d\d\d\d)-(\d\d)-(\d\d)$/,yn=[0,31,28,31,30,31,30,31,31,30,31,30,31];function d2(Y){let X=fn.exec(Y);if(!X)return!1;let J=+X[1],z=+X[2],Q=+X[3];return z>=1&&z<=12&&Q>=1&&Q<=(z===2&&Rn(J)?29:yn[z])}function Gz(Y,X){if(!(Y&&X))return;if(Y>X)return 1;if(Y<X)return-1;return 0}var Jz=/^(\d\d):(\d\d):(\d\d(?:\.\d+)?)(z|([+-])(\d\d)(?::?(\d\d))?)?$/i;function zz(Y){return function(J){let z=Jz.exec(J);if(!z)return!1;let Q=+z[1],G=+z[2],Z=+z[3],$=z[4],H=z[5]==="-"?-1:1,W=+(z[6]||0),K=+(z[7]||0);if(W>23||K>59||Y&&!$)return!1;if(Q<=23&&G<=59&&Z<60)return!0;let U=G-K*H,B=Q-W*H-(U<0?1:0);return(B===23||B===-1)&&(U===59||U===-1)&&Z<61}}function Zz(Y,X){if(!(Y&&X))return;let J=new Date("2020-01-01T"+Y).valueOf(),z=new Date("2020-01-01T"+X).valueOf();if(!(J&&z))return;return J-z}function l2(Y,X){if(!(Y&&X))return;let J=Jz.exec(Y),z=Jz.exec(X);if(!(J&&z))return;if(Y=J[1]+J[2]+J[3],X=z[1]+z[2]+z[3],Y>X)return 1;if(Y<X)return-1;return 0}var Qz=/t|\s/i;function g2(Y){let X=zz(Y);return function(z){let Q=z.split(Qz);return Q.length===2&&d2(Q[0])&&X(Q[1])}}function i2(Y,X){if(!(Y&&X))return;let J=new Date(Y).valueOf(),z=new Date(X).valueOf();if(!(J&&z))return;return J-z}function n2(Y,X){if(!(Y&&X))return;let[J,z]=Y.split(Qz),[Q,G]=X.split(Qz),Z=Gz(J,Q);if(Z===void 0)return;return Z||Zz(z,G)}var hn=/\/|:/,mn=/^(?:[a-z][a-z0-9+\-.]*:)(?:\/?\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:]|%[0-9a-f]{2})*@)?(?:\[(?:(?:(?:(?:[0-9a-f]{1,4}:){6}|::(?:[0-9a-f]{1,4}:){5}|(?:[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){4}|(?:(?:[0-9a-f]{1,4}:){0,1}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){3}|(?:(?:[0-9a-f]{1,4}:){0,2}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){2}|(?:(?:[0-9a-f]{1,4}:){0,3}[0-9a-f]{1,4})?::[0-9a-f]{1,4}:|(?:(?:[0-9a-f]{1,4}:){0,4}[0-9a-f]{1,4})?::)(?:[0-9a-f]{1,4}:[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?))|(?:(?:[0-9a-f]{1,4}:){0,5}[0-9a-f]{1,4})?::[0-9a-f]{1,4}|(?:(?:[0-9a-f]{1,4}:){0,6}[0-9a-f]{1,4})?::)|[Vv][0-9a-f]+\.[a-z0-9\-._~!$&'()*+,;=:]+)\]|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)|(?:[a-z0-9\-._~!$&'()*+,;=]|%[0-9a-f]{2})*)(?::\d*)?(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*|\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*)?|(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*)(?:\?(?:[a-z0-9\-._~!$&'()*+,;=:@/?]|%[0-9a-f]{2})*)?(?:#(?:[a-z0-9\-._~!$&'()*+,;=:@/?]|%[0-9a-f]{2})*)?$/i;function un(Y){return hn.test(Y)&&mn.test(Y)}var p2=/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/gm;function gn(Y){return p2.lastIndex=0,p2.test(Y)}var pn=-2147483648,cn=2147483647;function dn(Y){return Number.isInteger(Y)&&Y<=cn&&Y>=pn}function ln(Y){return Number.isInteger(Y)}function c2(){return!0}var nn=/[^\\]\\Z/;function on(Y){if(nn.test(Y))return!1;try{return new RegExp(Y),!0}catch(X){return!1}}});var t2=C((r2)=>{Object.defineProperty(r2,"__esModule",{value:!0});r2.formatLimitDefinition=void 0;var sn=Xz(),O4=F0(),q8=O4.operators,_9={formatMaximum:{okStr:"<=",ok:q8.LTE,fail:q8.GT},formatMinimum:{okStr:">=",ok:q8.GTE,fail:q8.LT},formatExclusiveMaximum:{okStr:"<",ok:q8.LT,fail:q8.GTE},formatExclusiveMinimum:{okStr:">",ok:q8.GT,fail:q8.LTE}},rn={message:({keyword:Y,schemaCode:X})=>O4.str`should be ${_9[Y].okStr} ${X}`,params:({keyword:Y,schemaCode:X})=>O4._`{comparison: ${_9[Y].okStr}, limit: ${X}}`};r2.formatLimitDefinition={keyword:Object.keys(_9),type:"string",schemaType:"string",$data:!0,error:rn,code(Y){let{gen:X,data:J,schemaCode:z,keyword:Q,it:G}=Y,{opts:Z,self:$}=G;if(!Z.validateFormats)return;let H=new sn.KeywordCxt(G,$.RULES.all.format.definition,"format");if(H.$data)W();else K();function W(){let B=X.scopeValue("formats",{ref:$.formats,code:Z.code.formats}),O=X.const("fmt",O4._`${B}[${H.schemaCode}]`);Y.fail$data((0,O4.or)(O4._`typeof ${O} != "object"`,O4._`${O} instanceof RegExp`,O4._`typeof ${O}.compare != "function"`,U(O)))}function K(){let B=H.schema,O=$.formats[B];if(!O||O===!0)return;if(typeof O!="object"||O instanceof RegExp||typeof O.compare!="function")throw Error(`"${Q}": format "${B}" does not define "compare" function`);let V=X.scopeValue("formats",{key:B,ref:O,code:Z.code.formats?O4._`${Z.code.formats}${(0,O4.getProperty)(B)}`:void 0});Y.fail$data(U(V))}function U(B){return O4._`${B}.compare(${J}, ${z}) ${_9[Q].fail} 0`}},dependencies:["format"]};var tn=(Y)=>{return Y.addKeyword(r2.formatLimitDefinition),Y};r2.default=tn});var JM=C(($7,XM)=>{Object.defineProperty($7,"__esModule",{value:!0});var S6=s2(),Yo=t2(),Wz=F0(),e2=new Wz.Name("fullFormats"),Xo=new Wz.Name("fastFormats"),Kz=(Y,X={keywords:!0})=>{if(Array.isArray(X))return YM(Y,X,S6.fullFormats,e2),Y;let[J,z]=X.mode==="fast"?[S6.fastFormats,Xo]:[S6.fullFormats,e2],Q=X.formats||S6.formatNames;if(YM(Y,Q,J,z),X.keywords)(0,Yo.default)(Y);return Y};Kz.get=(Y,X="full")=>{let z=(X==="fast"?S6.fastFormats:S6.fullFormats)[Y];if(!z)throw Error(`Unknown format "${Y}"`);return z};function YM(Y,X,J,z){var Q,G;(Q=(G=Y.opts.code).formats)!==null&&Q!==void 0||(G.formats=Wz._`require("ajv-formats/dist/formats").${z}`);for(let Z of X)Y.addFormat(Z,J[Z])}XM.exports=$7=Kz;Object.defineProperty($7,"__esModule",{value:!0});$7.default=Kz});var PM=C((uW0,FM)=>{var xM=Q0("stream").Stream,co=Q0("util");FM.exports=L4;function L4(){this.source=null,this.dataSize=0,this.maxDataSize=1048576,this.pauseStream=!0,this._maxDataSizeExceeded=!1,this._released=!1,this._bufferedEvents=[]}co.inherits(L4,xM);L4.create=function(Y,X){var J=new this;X=X||{};for(var z in X)J[z]=X[z];J.source=Y;var Q=Y.emit;if(Y.emit=function(){return J._handleEmit(arguments),Q.apply(Y,arguments)},Y.on("error",function(){}),J.pauseStream)Y.pause();return J};Object.defineProperty(L4.prototype,"readable",{configurable:!0,enumerable:!0,get:function(){return this.source.readable}});L4.prototype.setEncoding=function(){return this.source.setEncoding.apply(this.source,arguments)};L4.prototype.resume=function(){if(!this._released)this.release();this.source.resume()};L4.prototype.pause=function(){this.source.pause()};L4.prototype.release=function(){this._released=!0,this._bufferedEvents.forEach(function(Y){this.emit.apply(this,Y)}.bind(this)),this._bufferedEvents=[]};L4.prototype.pipe=function(){var Y=xM.prototype.pipe.apply(this,arguments);return this.resume(),Y};L4.prototype._handleEmit=function(Y){if(this._released){this.emit.apply(this,Y);return}if(Y[0]==="data")this.dataSize+=Y[1].length,this._checkIfMaxDataSizeExceeded();this._bufferedEvents.push(Y)};L4.prototype._checkIfMaxDataSizeExceeded=function(){if(this._maxDataSizeExceeded)return;if(this.dataSize<=this.maxDataSize)return;this._maxDataSizeExceeded=!0;var Y="DelayedStream#maxDataSize of "+this.maxDataSize+" bytes exceeded.";this.emit("error",Error(Y))}});var IM=C((gW0,TM)=>{var lo=Q0("util"),wM=Q0("stream").Stream,AM=PM();TM.exports=r0;function r0(){this.writable=!1,this.readable=!0,this.dataSize=0,this.maxDataSize=2097152,this.pauseStreams=!0,this._released=!1,this._streams=[],this._currentStream=null,this._insideLoop=!1,this._pendingNext=!1}lo.inherits(r0,wM);r0.create=function(Y){var X=new this;Y=Y||{};for(var J in Y)X[J]=Y[J];return X};r0.isStreamLike=function(Y){return typeof Y!=="function"&&typeof Y!=="string"&&typeof Y!=="boolean"&&typeof Y!=="number"&&!Buffer.isBuffer(Y)};r0.prototype.append=function(Y){var X=r0.isStreamLike(Y);if(X){if(!(Y instanceof AM)){var J=AM.create(Y,{maxDataSize:1/0,pauseStream:this.pauseStreams});Y.on("data",this._checkDataSize.bind(this)),Y=J}if(this._handleErrors(Y),this.pauseStreams)Y.pause()}return this._streams.push(Y),this};r0.prototype.pipe=function(Y,X){return wM.prototype.pipe.call(this,Y,X),this.resume(),Y};r0.prototype._getNext=function(){if(this._currentStream=null,this._insideLoop){this._pendingNext=!0;return}this._insideLoop=!0;try{do this._pendingNext=!1,this._realGetNext();while(this._pendingNext)}finally{this._insideLoop=!1}};r0.prototype._realGetNext=function(){var Y=this._streams.shift();if(typeof Y>"u"){this.end();return}if(typeof Y!=="function"){this._pipeNext(Y);return}var X=Y;X(function(J){var z=r0.isStreamLike(J);if(z)J.on("data",this._checkDataSize.bind(this)),this._handleErrors(J);this._pipeNext(J)}.bind(this))};r0.prototype._pipeNext=function(Y){this._currentStream=Y;var X=r0.isStreamLike(Y);if(X){Y.on("end",this._getNext.bind(this)),Y.pipe(this,{end:!1});return}var J=Y;this.write(J),this._getNext()};r0.prototype._handleErrors=function(Y){var X=this;Y.on("error",function(J){X._emitError(J)})};r0.prototype.write=function(Y){this.emit("data",Y)};r0.prototype.pause=function(){if(!this.pauseStreams)return;if(this.pauseStreams&&this._currentStream&&typeof this._currentStream.pause=="function")this._currentStream.pause();this.emit("pause")};r0.prototype.resume=function(){if(!this._released)this._released=!0,this.writable=!0,this._getNext();if(this.pauseStreams&&this._currentStream&&typeof this._currentStream.resume=="function")this._currentStream.resume();this.emit("resume")};r0.prototype.end=function(){this._reset(),this.emit("end")};r0.prototype.destroy=function(){this._reset(),this.emit("close")};r0.prototype._reset=function(){this.writable=!1,this._streams=[],this._currentStream=null};r0.prototype._checkDataSize=function(){if(this._updateDataSize(),this.dataSize<=this.maxDataSize)return;var Y="DelayedStream#maxDataSize of "+this.maxDataSize+" bytes exceeded.";this._emitError(Error(Y))};r0.prototype._updateDataSize=function(){this.dataSize=0;var Y=this;if(this._streams.forEach(function(X){if(!X.dataSize)return;Y.dataSize+=X.dataSize}),this._currentStream&&this._currentStream.dataSize)this.dataSize+=this._currentStream.dataSize};r0.prototype._emitError=function(Y){this._reset(),this.emit("error",Y)}});var vM=C((pW0,io)=>{io.exports={"application/1d-interleaved-parityfec":{source:"iana"},"application/3gpdash-qoe-report+xml":{source:"iana",charset:"UTF-8",compressible:!0},"application/3gpp-ims+xml":{source:"iana",compressible:!0},"application/3gpphal+json":{source:"iana",compressible:!0},"application/3gpphalforms+json":{source:"iana",compressible:!0},"application/a2l":{source:"iana"},"application/ace+cbor":{source:"iana"},"application/activemessage":{source:"iana"},"application/activity+json":{source:"iana",compressible:!0},"application/alto-costmap+json":{source:"iana",compressible:!0},"application/alto-costmapfilter+json":{source:"iana",compressible:!0},"application/alto-directory+json":{source:"iana",compressible:!0},"application/alto-endpointcost+json":{source:"iana",compressible:!0},"application/alto-endpointcostparams+json":{source:"iana",compressible:!0},"application/alto-endpointprop+json":{source:"iana",compressible:!0},"application/alto-endpointpropparams+json":{source:"iana",compressible:!0},"application/alto-error+json":{source:"iana",compressible:!0},"application/alto-networkmap+json":{source:"iana",compressible:!0},"application/alto-networkmapfilter+json":{source:"iana",compressible:!0},"application/alto-updatestreamcontrol+json":{source:"iana",compressible:!0},"application/alto-updatestreamparams+json":{source:"iana",compressible:!0},"application/aml":{source:"iana"},"application/andrew-inset":{source:"iana",extensions:["ez"]},"application/applefile":{source:"iana"},"application/applixware":{source:"apache",extensions:["aw"]},"application/at+jwt":{source:"iana"},"application/atf":{source:"iana"},"application/atfx":{source:"iana"},"application/atom+xml":{source:"iana",compressible:!0,extensions:["atom"]},"application/atomcat+xml":{source:"iana",compressible:!0,extensions:["atomcat"]},"application/atomdeleted+xml":{source:"iana",compressible:!0,extensions:["atomdeleted"]},"application/atomicmail":{source:"iana"},"application/atomsvc+xml":{source:"iana",compressible:!0,extensions:["atomsvc"]},"application/atsc-dwd+xml":{source:"iana",compressible:!0,extensions:["dwd"]},"application/atsc-dynamic-event-message":{source:"iana"},"application/atsc-held+xml":{source:"iana",compressible:!0,extensions:["held"]},"application/atsc-rdt+json":{source:"iana",compressible:!0},"application/atsc-rsat+xml":{source:"iana",compressible:!0,extensions:["rsat"]},"application/atxml":{source:"iana"},"application/auth-policy+xml":{source:"iana",compressible:!0},"application/bacnet-xdd+zip":{source:"iana",compressible:!1},"application/batch-smtp":{source:"iana"},"application/bdoc":{compressible:!1,extensions:["bdoc"]},"application/beep+xml":{source:"iana",charset:"UTF-8",compressible:!0},"application/calendar+json":{source:"iana",compressible:!0},"application/calendar+xml":{source:"iana",compressible:!0,extensions:["xcs"]},"application/call-completion":{source:"iana"},"application/cals-1840":{source:"iana"},"application/captive+json":{source:"iana",compressible:!0},"application/cbor":{source:"iana"},"application/cbor-seq":{source:"iana"},"application/cccex":{source:"iana"},"application/ccmp+xml":{source:"iana",compressible:!0},"application/ccxml+xml":{source:"iana",compressible:!0,extensions:["ccxml"]},"application/cdfx+xml":{source:"iana",compressible:!0,extensions:["cdfx"]},"application/cdmi-capability":{source:"iana",extensions:["cdmia"]},"application/cdmi-container":{source:"iana",extensions:["cdmic"]},"application/cdmi-domain":{source:"iana",extensions:["cdmid"]},"application/cdmi-object":{source:"iana",extensions:["cdmio"]},"application/cdmi-queue":{source:"iana",extensions:["cdmiq"]},"application/cdni":{source:"iana"},"application/cea":{source:"iana"},"application/cea-2018+xml":{source:"iana",compressible:!0},"application/cellml+xml":{source:"iana",compressible:!0},"application/cfw":{source:"iana"},"application/city+json":{source:"iana",compressible:!0},"application/clr":{source:"iana"},"application/clue+xml":{source:"iana",compressible:!0},"application/clue_info+xml":{source:"iana",compressible:!0},"application/cms":{source:"iana"},"application/cnrp+xml":{source:"iana",compressible:!0},"application/coap-group+json":{source:"iana",compressible:!0},"application/coap-payload":{source:"iana"},"application/commonground":{source:"iana"},"application/conference-info+xml":{source:"iana",compressible:!0},"application/cose":{source:"iana"},"application/cose-key":{source:"iana"},"application/cose-key-set":{source:"iana"},"application/cpl+xml":{source:"iana",compressible:!0,extensions:["cpl"]},"application/csrattrs":{source:"iana"},"application/csta+xml":{source:"iana",compressible:!0},"application/cstadata+xml":{source:"iana",compressible:!0},"application/csvm+json":{source:"iana",compressible:!0},"application/cu-seeme":{source:"apache",extensions:["cu"]},"application/cwt":{source:"iana"},"application/cybercash":{source:"iana"},"application/dart":{compressible:!0},"application/dash+xml":{source:"iana",compressible:!0,extensions:["mpd"]},"application/dash-patch+xml":{source:"iana",compressible:!0,extensions:["mpp"]},"application/dashdelta":{source:"iana"},"application/davmount+xml":{source:"iana",compressible:!0,extensions:["davmount"]},"application/dca-rft":{source:"iana"},"application/dcd":{source:"iana"},"application/dec-dx":{source:"iana"},"application/dialog-info+xml":{source:"iana",compressible:!0},"application/dicom":{source:"iana"},"application/dicom+json":{source:"iana",compressible:!0},"application/dicom+xml":{source:"iana",compressible:!0},"application/dii":{source:"iana"},"application/dit":{source:"iana"},"application/dns":{source:"iana"},"application/dns+json":{source:"iana",compressible:!0},"application/dns-message":{source:"iana"},"application/docbook+xml":{source:"apache",compressible:!0,extensions:["dbk"]},"application/dots+cbor":{source:"iana"},"application/dskpp+xml":{source:"iana",compressible:!0},"application/dssc+der":{source:"iana",extensions:["dssc"]},"application/dssc+xml":{source:"iana",compressible:!0,extensions:["xdssc"]},"application/dvcs":{source:"iana"},"application/ecmascript":{source:"iana",compressible:!0,extensions:["es","ecma"]},"application/edi-consent":{source:"iana"},"application/edi-x12":{source:"iana",compressible:!1},"application/edifact":{source:"iana",compressible:!1},"application/efi":{source:"iana"},"application/elm+json":{source:"iana",charset:"UTF-8",compressible:!0},"application/elm+xml":{source:"iana",compressible:!0},"application/emergencycalldata.cap+xml":{source:"iana",charset:"UTF-8",compressible:!0},"application/emergencycalldata.comment+xml":{source:"iana",compressible:!0},"application/emergencycalldata.control+xml":{source:"iana",compressible:!0},"application/emergencycalldata.deviceinfo+xml":{source:"iana",compressible:!0},"application/emergencycalldata.ecall.msd":{source:"iana"},"application/emergencycalldata.providerinfo+xml":{source:"iana",compressible:!0},"application/emergencycalldata.serviceinfo+xml":{source:"iana",compressible:!0},"application/emergencycalldata.subscriberinfo+xml":{source:"iana",compressible:!0},"application/emergencycalldata.veds+xml":{source:"iana",compressible:!0},"application/emma+xml":{source:"iana",compressible:!0,extensions:["emma"]},"application/emotionml+xml":{source:"iana",compressible:!0,extensions:["emotionml"]},"application/encaprtp":{source:"iana"},"application/epp+xml":{source:"iana",compressible:!0},"application/epub+zip":{source:"iana",compressible:!1,extensions:["epub"]},"application/eshop":{source:"iana"},"application/exi":{source:"iana",extensions:["exi"]},"application/expect-ct-report+json":{source:"iana",compressible:!0},"application/express":{source:"iana",extensions:["exp"]},"application/fastinfoset":{source:"iana"},"application/fastsoap":{source:"iana"},"application/fdt+xml":{source:"iana",compressible:!0,extensions:["fdt"]},"application/fhir+json":{source:"iana",charset:"UTF-8",compressible:!0},"application/fhir+xml":{source:"iana",charset:"UTF-8",compressible:!0},"application/fido.trusted-apps+json":{compressible:!0},"application/fits":{source:"iana"},"application/flexfec":{source:"iana"},"application/font-sfnt":{source:"iana"},"application/font-tdpfr":{source:"iana",extensions:["pfr"]},"application/font-woff":{source:"iana",compressible:!1},"application/framework-attributes+xml":{source:"iana",compressible:!0},"application/geo+json":{source:"iana",compressible:!0,extensions:["geojson"]},"application/geo+json-seq":{source:"iana"},"application/geopackage+sqlite3":{source:"iana"},"application/geoxacml+xml":{source:"iana",compressible:!0},"application/gltf-buffer":{source:"iana"},"application/gml+xml":{source:"iana",compressible:!0,extensions:["gml"]},"application/gpx+xml":{source:"apache",compressible:!0,extensions:["gpx"]},"application/gxf":{source:"apache",extensions:["gxf"]},"application/gzip":{source:"iana",compressible:!1,extensions:["gz"]},"application/h224":{source:"iana"},"application/held+xml":{source:"iana",compressible:!0},"application/hjson":{extensions:["hjson"]},"application/http":{source:"iana"},"application/hyperstudio":{source:"iana",extensions:["stk"]},"application/ibe-key-request+xml":{source:"iana",compressible:!0},"application/ibe-pkg-reply+xml":{source:"iana",compressible:!0},"application/ibe-pp-data":{source:"iana"},"application/iges":{source:"iana"},"application/im-iscomposing+xml":{source:"iana",charset:"UTF-8",compressible:!0},"application/index":{source:"iana"},"application/index.cmd":{source:"iana"},"application/index.obj":{source:"iana"},"application/index.response":{source:"iana"},"application/index.vnd":{source:"iana"},"application/inkml+xml":{source:"iana",compressible:!0,extensions:["ink","inkml"]},"application/iotp":{source:"iana"},"application/ipfix":{source:"iana",extensions:["ipfix"]},"application/ipp":{source:"iana"},"application/isup":{source:"iana"},"application/its+xml":{source:"iana",compressible:!0,extensions:["its"]},"application/java-archive":{source:"apache",compressible:!1,extensions:["jar","war","ear"]},"application/java-serialized-object":{source:"apache",compressible:!1,extensions:["ser"]},"application/java-vm":{source:"apache",compressible:!1,extensions:["class"]},"application/javascript":{source:"iana",charset:"UTF-8",compressible:!0,extensions:["js","mjs"]},"application/jf2feed+json":{source:"iana",compressible:!0},"application/jose":{source:"iana"},"application/jose+json":{source:"iana",compressible:!0},"application/jrd+json":{source:"iana",compressible:!0},"application/jscalendar+json":{source:"iana",compressible:!0},"application/json":{source:"iana",charset:"UTF-8",compressible:!0,extensions:["json","map"]},"application/json-patch+json":{source:"iana",compressible:!0},"application/json-seq":{source:"iana"},"application/json5":{extensions:["json5"]},"application/jsonml+json":{source:"apache",compressible:!0,extensions:["jsonml"]},"application/jwk+json":{source:"iana",compressible:!0},"application/jwk-set+json":{source:"iana",compressible:!0},"application/jwt":{source:"iana"},"application/kpml-request+xml":{source:"iana",compressible:!0},"application/kpml-response+xml":{source:"iana",compressible:!0},"application/ld+json":{source:"iana",compressible:!0,extensions:["jsonld"]},"application/lgr+xml":{source:"iana",compressible:!0,extensions:["lgr"]},"application/link-format":{source:"iana"},"application/load-control+xml":{source:"iana",compressible:!0},"application/lost+xml":{source:"iana",compressible:!0,extensions:["lostxml"]},"application/lostsync+xml":{source:"iana",compressible:!0},"application/lpf+zip":{source:"iana",compressible:!1},"application/lxf":{source:"iana"},"application/mac-binhex40":{source:"iana",extensions:["hqx"]},"application/mac-compactpro":{source:"apache",extensions:["cpt"]},"application/macwriteii":{source:"iana"},"application/mads+xml":{source:"iana",compressible:!0,extensions:["mads"]},"application/manifest+json":{source:"iana",charset:"UTF-8",compressible:!0,extensions:["webmanifest"]},"application/marc":{source:"iana",extensions:["mrc"]},"application/marcxml+xml":{source:"iana",compressible:!0,extensions:["mrcx"]},"application/mathematica":{source:"iana",extensions:["ma","nb","mb"]},"application/mathml+xml":{source:"iana",compressible:!0,extensions:["mathml"]},"application/mathml-content+xml":{source:"iana",compressible:!0},"application/mathml-presentation+xml":{source:"iana",compressible:!0},"application/mbms-associated-procedure-description+xml":{source:"iana",compressible:!0},"application/mbms-deregister+xml":{source:"iana",compressible:!0},"application/mbms-envelope+xml":{source:"iana",compressible:!0},"application/mbms-msk+xml":{source:"iana",compressible:!0},"application/mbms-msk-response+xml":{source:"iana",compressible:!0},"application/mbms-protection-description+xml":{source:"iana",compressible:!0},"application/mbms-reception-report+xml":{source:"iana",compressible:!0},"application/mbms-register+xml":{source:"iana",compressible:!0},"application/mbms-register-response+xml":{source:"iana",compressible:!0},"application/mbms-schedule+xml":{source:"iana",compressible:!0},"application/mbms-user-service-description+xml":{source:"iana",compressible:!0},"application/mbox":{source:"iana",extensions:["mbox"]},"application/media-policy-dataset+xml":{source:"iana",compressible:!0,extensions:["mpf"]},"application/media_control+xml":{source:"iana",compressible:!0},"application/mediaservercontrol+xml":{source:"iana",compressible:!0,extensions:["mscml"]},"application/merge-patch+json":{source:"iana",compressible:!0},"application/metalink+xml":{source:"apache",compressible:!0,extensions:["metalink"]},"application/metalink4+xml":{source:"iana",compressible:!0,extensions:["meta4"]},"application/mets+xml":{source:"iana",compressible:!0,extensions:["mets"]},"application/mf4":{source:"iana"},"application/mikey":{source:"iana"},"application/mipc":{source:"iana"},"application/missing-blocks+cbor-seq":{source:"iana"},"application/mmt-aei+xml":{source:"iana",compressible:!0,extensions:["maei"]},"application/mmt-usd+xml":{source:"iana",compressible:!0,extensions:["musd"]},"application/mods+xml":{source:"iana",compressible:!0,extensions:["mods"]},"application/moss-keys":{source:"iana"},"application/moss-signature":{source:"iana"},"application/mosskey-data":{source:"iana"},"application/mosskey-request":{source:"iana"},"application/mp21":{source:"iana",extensions:["m21","mp21"]},"application/mp4":{source:"iana",extensions:["mp4s","m4p"]},"application/mpeg4-generic":{source:"iana"},"application/mpeg4-iod":{source:"iana"},"application/mpeg4-iod-xmt":{source:"iana"},"application/mrb-consumer+xml":{source:"iana",compressible:!0},"application/mrb-publish+xml":{source:"iana",compressible:!0},"application/msc-ivr+xml":{source:"iana",charset:"UTF-8",compressible:!0},"application/msc-mixer+xml":{source:"iana",charset:"UTF-8",compressible:!0},"application/msword":{source:"iana",compressible:!1,extensions:["doc","dot"]},"application/mud+json":{source:"iana",compressible:!0},"application/multipart-core":{source:"iana"},"application/mxf":{source:"iana",extensions:["mxf"]},"application/n-quads":{source:"iana",extensions:["nq"]},"application/n-triples":{source:"iana",extensions:["nt"]},"application/nasdata":{source:"iana"},"application/news-checkgroups":{source:"iana",charset:"US-ASCII"},"application/news-groupinfo":{source:"iana",charset:"US-ASCII"},"application/news-transmission":{source:"iana"},"application/nlsml+xml":{source:"iana",compressible:!0},"application/node":{source:"iana",extensions:["cjs"]},"application/nss":{source:"iana"},"application/oauth-authz-req+jwt":{source:"iana"},"application/oblivious-dns-message":{source:"iana"},"application/ocsp-request":{source:"iana"},"application/ocsp-response":{source:"iana"},"application/octet-stream":{source:"iana",compressible:!1,extensions:["bin","dms","lrf","mar","so","dist","distz","pkg","bpk","dump","elc","deploy","exe","dll","deb","dmg","iso","img","msi","msp","msm","buffer"]},"application/oda":{source:"iana",extensions:["oda"]},"application/odm+xml":{source:"iana",compressible:!0},"application/odx":{source:"iana"},"application/oebps-package+xml":{source:"iana",compressible:!0,extensions:["opf"]},"application/ogg":{source:"iana",compressible:!1,extensions:["ogx"]},"application/omdoc+xml":{source:"apache",compressible:!0,extensions:["omdoc"]},"application/onenote":{source:"apache",extensions:["onetoc","onetoc2","onetmp","onepkg"]},"application/opc-nodeset+xml":{source:"iana",compressible:!0},"application/oscore":{source:"iana"},"application/oxps":{source:"iana",extensions:["oxps"]},"application/p21":{source:"iana"},"application/p21+zip":{source:"iana",compressible:!1},"application/p2p-overlay+xml":{source:"iana",compressible:!0,extensions:["relo"]},"application/parityfec":{source:"iana"},"application/passport":{source:"iana"},"application/patch-ops-error+xml":{source:"iana",compressible:!0,extensions:["xer"]},"application/pdf":{source:"iana",compressible:!1,extensions:["pdf"]},"application/pdx":{source:"iana"},"application/pem-certificate-chain":{source:"iana"},"application/pgp-encrypted":{source:"iana",compressible:!1,extensions:["pgp"]},"application/pgp-keys":{source:"iana",extensions:["asc"]},"application/pgp-signature":{source:"iana",extensions:["asc","sig"]},"application/pics-rules":{source:"apache",extensions:["prf"]},"application/pidf+xml":{source:"iana",charset:"UTF-8",compressible:!0},"application/pidf-diff+xml":{source:"iana",charset:"UTF-8",compressible:!0},"application/pkcs10":{source:"iana",extensions:["p10"]},"application/pkcs12":{source:"iana"},"application/pkcs7-mime":{source:"iana",extensions:["p7m","p7c"]},"application/pkcs7-signature":{source:"iana",extensions:["p7s"]},"application/pkcs8":{source:"iana",extensions:["p8"]},"application/pkcs8-encrypted":{source:"iana"},"application/pkix-attr-cert":{source:"iana",extensions:["ac"]},"application/pkix-cert":{source:"iana",extensions:["cer"]},"application/pkix-crl":{source:"iana",extensions:["crl"]},"application/pkix-pkipath":{source:"iana",extensions:["pkipath"]},"application/pkixcmp":{source:"iana",extensions:["pki"]},"application/pls+xml":{source:"iana",compressible:!0,extensions:["pls"]},"application/poc-settings+xml":{source:"iana",charset:"UTF-8",compressible:!0},"application/postscript":{source:"iana",compressible:!0,extensions:["ai","eps","ps"]},"application/ppsp-tracker+json":{source:"iana",compressible:!0},"application/problem+json":{source:"iana",compressible:!0},"application/problem+xml":{source:"iana",compressible:!0},"application/provenance+xml":{source:"iana",compressible:!0,extensions:["provx"]},"application/prs.alvestrand.titrax-sheet":{source:"iana"},"application/prs.cww":{source:"iana",extensions:["cww"]},"application/prs.cyn":{source:"iana",charset:"7-BIT"},"application/prs.hpub+zip":{source:"iana",compressible:!1},"application/prs.nprend":{source:"iana"},"application/prs.plucker":{source:"iana"},"application/prs.rdf-xml-crypt":{source:"iana"},"application/prs.xsf+xml":{source:"iana",compressible:!0},"application/pskc+xml":{source:"iana",compressible:!0,extensions:["pskcxml"]},"application/pvd+json":{source:"iana",compressible:!0},"application/qsig":{source:"iana"},"application/raml+yaml":{compressible:!0,extensions:["raml"]},"application/raptorfec":{source:"iana"},"application/rdap+json":{source:"iana",compressible:!0},"application/rdf+xml":{source:"iana",compressible:!0,extensions:["rdf","owl"]},"application/reginfo+xml":{source:"iana",compressible:!0,extensions:["rif"]},"application/relax-ng-compact-syntax":{source:"iana",extensions:["rnc"]},"application/remote-printing":{source:"iana"},"application/reputon+json":{source:"iana",compressible:!0},"application/resource-lists+xml":{source:"iana",compressible:!0,extensions:["rl"]},"application/resource-lists-diff+xml":{source:"iana",compressible:!0,extensions:["rld"]},"application/rfc+xml":{source:"iana",compressible:!0},"application/riscos":{source:"iana"},"application/rlmi+xml":{source:"iana",compressible:!0},"application/rls-services+xml":{source:"iana",compressible:!0,extensions:["rs"]},"application/route-apd+xml":{source:"iana",compressible:!0,extensions:["rapd"]},"application/route-s-tsid+xml":{source:"iana",compressible:!0,extensions:["sls"]},"application/route-usd+xml":{source:"iana",compressible:!0,extensions:["rusd"]},"application/rpki-ghostbusters":{source:"iana",extensions:["gbr"]},"application/rpki-manifest":{source:"iana",extensions:["mft"]},"application/rpki-publication":{source:"iana"},"application/rpki-roa":{source:"iana",extensions:["roa"]},"application/rpki-updown":{source:"iana"},"application/rsd+xml":{source:"apache",compressible:!0,extensions:["rsd"]},"application/rss+xml":{source:"apache",compressible:!0,extensions:["rss"]},"application/rtf":{source:"iana",compressible:!0,extensions:["rtf"]},"application/rtploopback":{source:"iana"},"application/rtx":{source:"iana"},"application/samlassertion+xml":{source:"iana",compressible:!0},"application/samlmetadata+xml":{source:"iana",compressible:!0},"application/sarif+json":{source:"iana",compressible:!0},"application/sarif-external-properties+json":{source:"iana",compressible:!0},"application/sbe":{source:"iana"},"application/sbml+xml":{source:"iana",compressible:!0,extensions:["sbml"]},"application/scaip+xml":{source:"iana",compressible:!0},"application/scim+json":{source:"iana",compressible:!0},"application/scvp-cv-request":{source:"iana",extensions:["scq"]},"application/scvp-cv-response":{source:"iana",extensions:["scs"]},"application/scvp-vp-request":{source:"iana",extensions:["spq"]},"application/scvp-vp-response":{source:"iana",extensions:["spp"]},"application/sdp":{source:"iana",extensions:["sdp"]},"application/secevent+jwt":{source:"iana"},"application/senml+cbor":{source:"iana"},"application/senml+json":{source:"iana",compressible:!0},"application/senml+xml":{source:"iana",compressible:!0,extensions:["senmlx"]},"application/senml-etch+cbor":{source:"iana"},"application/senml-etch+json":{source:"iana",compressible:!0},"application/senml-exi":{source:"iana"},"application/sensml+cbor":{source:"iana"},"application/sensml+json":{source:"iana",compressible:!0},"application/sensml+xml":{source:"iana",compressible:!0,extensions:["sensmlx"]},"application/sensml-exi":{source:"iana"},"application/sep+xml":{source:"iana",compressible:!0},"application/sep-exi":{source:"iana"},"application/session-info":{source:"iana"},"application/set-payment":{source:"iana"},"application/set-payment-initiation":{source:"iana",extensions:["setpay"]},"application/set-registration":{source:"iana"},"application/set-registration-initiation":{source:"iana",extensions:["setreg"]},"application/sgml":{source:"iana"},"application/sgml-open-catalog":{source:"iana"},"application/shf+xml":{source:"iana",compressible:!0,extensions:["shf"]},"application/sieve":{source:"iana",extensions:["siv","sieve"]},"application/simple-filter+xml":{source:"iana",compressible:!0},"application/simple-message-summary":{source:"iana"},"application/simplesymbolcontainer":{source:"iana"},"application/sipc":{source:"iana"},"application/slate":{source:"iana"},"application/smil":{source:"iana"},"application/smil+xml":{source:"iana",compressible:!0,extensions:["smi","smil"]},"application/smpte336m":{source:"iana"},"application/soap+fastinfoset":{source:"iana"},"application/soap+xml":{source:"iana",compressible:!0},"application/sparql-query":{source:"iana",extensions:["rq"]},"application/sparql-results+xml":{source:"iana",compressible:!0,extensions:["srx"]},"application/spdx+json":{source:"iana",compressible:!0},"application/spirits-event+xml":{source:"iana",compressible:!0},"application/sql":{source:"iana"},"application/srgs":{source:"iana",extensions:["gram"]},"application/srgs+xml":{source:"iana",compressible:!0,extensions:["grxml"]},"application/sru+xml":{source:"iana",compressible:!0,extensions:["sru"]},"application/ssdl+xml":{source:"apache",compressible:!0,extensions:["ssdl"]},"application/ssml+xml":{source:"iana",compressible:!0,extensions:["ssml"]},"application/stix+json":{source:"iana",compressible:!0},"application/swid+xml":{source:"iana",compressible:!0,extensions:["swidtag"]},"application/tamp-apex-update":{source:"iana"},"application/tamp-apex-update-confirm":{source:"iana"},"application/tamp-community-update":{source:"iana"},"application/tamp-community-update-confirm":{source:"iana"},"application/tamp-error":{source:"iana"},"application/tamp-sequence-adjust":{source:"iana"},"application/tamp-sequence-adjust-confirm":{source:"iana"},"application/tamp-status-query":{source:"iana"},"application/tamp-status-response":{source:"iana"},"application/tamp-update":{source:"iana"},"application/tamp-update-confirm":{source:"iana"},"application/tar":{compressible:!0},"application/taxii+json":{source:"iana",compressible:!0},"application/td+json":{source:"iana",compressible:!0},"application/tei+xml":{source:"iana",compressible:!0,extensions:["tei","teicorpus"]},"application/tetra_isi":{source:"iana"},"application/thraud+xml":{source:"iana",compressible:!0,extensions:["tfi"]},"application/timestamp-query":{source:"iana"},"application/timestamp-reply":{source:"iana"},"application/timestamped-data":{source:"iana",extensions:["tsd"]},"application/tlsrpt+gzip":{source:"iana"},"application/tlsrpt+json":{source:"iana",compressible:!0},"application/tnauthlist":{source:"iana"},"application/token-introspection+jwt":{source:"iana"},"application/toml":{compressible:!0,extensions:["toml"]},"application/trickle-ice-sdpfrag":{source:"iana"},"application/trig":{source:"iana",extensions:["trig"]},"application/ttml+xml":{source:"iana",compressible:!0,extensions:["ttml"]},"application/tve-trigger":{source:"iana"},"application/tzif":{source:"iana"},"application/tzif-leap":{source:"iana"},"application/ubjson":{compressible:!1,extensions:["ubj"]},"application/ulpfec":{source:"iana"},"application/urc-grpsheet+xml":{source:"iana",compressible:!0},"application/urc-ressheet+xml":{source:"iana",compressible:!0,extensions:["rsheet"]},"application/urc-targetdesc+xml":{source:"iana",compressible:!0,extensions:["td"]},"application/urc-uisocketdesc+xml":{source:"iana",compressible:!0},"application/vcard+json":{source:"iana",compressible:!0},"application/vcard+xml":{source:"iana",compressible:!0},"application/vemmi":{source:"iana"},"application/vividence.scriptfile":{source:"apache"},"application/vnd.1000minds.decision-model+xml":{source:"iana",compressible:!0,extensions:["1km"]},"application/vnd.3gpp-prose+xml":{source:"iana",compressible:!0},"application/vnd.3gpp-prose-pc3ch+xml":{source:"iana",compressible:!0},"application/vnd.3gpp-v2x-local-service-information":{source:"iana"},"application/vnd.3gpp.5gnas":{source:"iana"},"application/vnd.3gpp.access-transfer-events+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.bsf+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.gmop+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.gtpc":{source:"iana"},"application/vnd.3gpp.interworking-data":{source:"iana"},"application/vnd.3gpp.lpp":{source:"iana"},"application/vnd.3gpp.mc-signalling-ear":{source:"iana"},"application/vnd.3gpp.mcdata-affiliation-command+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.mcdata-info+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.mcdata-payload":{source:"iana"},"application/vnd.3gpp.mcdata-service-config+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.mcdata-signalling":{source:"iana"},"application/vnd.3gpp.mcdata-ue-config+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.mcdata-user-profile+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.mcptt-affiliation-command+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.mcptt-floor-request+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.mcptt-info+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.mcptt-location-info+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.mcptt-mbms-usage-info+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.mcptt-service-config+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.mcptt-signed+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.mcptt-ue-config+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.mcptt-ue-init-config+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.mcptt-user-profile+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.mcvideo-affiliation-command+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.mcvideo-affiliation-info+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.mcvideo-info+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.mcvideo-location-info+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.mcvideo-mbms-usage-info+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.mcvideo-service-config+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.mcvideo-transmission-request+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.mcvideo-ue-config+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.mcvideo-user-profile+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.mid-call+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.ngap":{source:"iana"},"application/vnd.3gpp.pfcp":{source:"iana"},"application/vnd.3gpp.pic-bw-large":{source:"iana",extensions:["plb"]},"application/vnd.3gpp.pic-bw-small":{source:"iana",extensions:["psb"]},"application/vnd.3gpp.pic-bw-var":{source:"iana",extensions:["pvb"]},"application/vnd.3gpp.s1ap":{source:"iana"},"application/vnd.3gpp.sms":{source:"iana"},"application/vnd.3gpp.sms+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.srvcc-ext+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.srvcc-info+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.state-and-event-info+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.ussd+xml":{source:"iana",compressible:!0},"application/vnd.3gpp2.bcmcsinfo+xml":{source:"iana",compressible:!0},"application/vnd.3gpp2.sms":{source:"iana"},"application/vnd.3gpp2.tcap":{source:"iana",extensions:["tcap"]},"application/vnd.3lightssoftware.imagescal":{source:"iana"},"application/vnd.3m.post-it-notes":{source:"iana",extensions:["pwn"]},"application/vnd.accpac.simply.aso":{source:"iana",extensions:["aso"]},"application/vnd.accpac.simply.imp":{source:"iana",extensions:["imp"]},"application/vnd.acucobol":{source:"iana",extensions:["acu"]},"application/vnd.acucorp":{source:"iana",extensions:["atc","acutc"]},"application/vnd.adobe.air-application-installer-package+zip":{source:"apache",compressible:!1,extensions:["air"]},"application/vnd.adobe.flash.movie":{source:"iana"},"application/vnd.adobe.formscentral.fcdt":{source:"iana",extensions:["fcdt"]},"application/vnd.adobe.fxp":{source:"iana",extensions:["fxp","fxpl"]},"application/vnd.adobe.partial-upload":{source:"iana"},"application/vnd.adobe.xdp+xml":{source:"iana",compressible:!0,extensions:["xdp"]},"application/vnd.adobe.xfdf":{source:"iana",extensions:["xfdf"]},"application/vnd.aether.imp":{source:"iana"},"application/vnd.afpc.afplinedata":{source:"iana"},"application/vnd.afpc.afplinedata-pagedef":{source:"iana"},"application/vnd.afpc.cmoca-cmresource":{source:"iana"},"application/vnd.afpc.foca-charset":{source:"iana"},"application/vnd.afpc.foca-codedfont":{source:"iana"},"application/vnd.afpc.foca-codepage":{source:"iana"},"application/vnd.afpc.modca":{source:"iana"},"application/vnd.afpc.modca-cmtable":{source:"iana"},"application/vnd.afpc.modca-formdef":{source:"iana"},"application/vnd.afpc.modca-mediummap":{source:"iana"},"application/vnd.afpc.modca-objectcontainer":{source:"iana"},"application/vnd.afpc.modca-overlay":{source:"iana"},"application/vnd.afpc.modca-pagesegment":{source:"iana"},"application/vnd.age":{source:"iana",extensions:["age"]},"application/vnd.ah-barcode":{source:"iana"},"application/vnd.ahead.space":{source:"iana",extensions:["ahead"]},"application/vnd.airzip.filesecure.azf":{source:"iana",extensions:["azf"]},"application/vnd.airzip.filesecure.azs":{source:"iana",extensions:["azs"]},"application/vnd.amadeus+json":{source:"iana",compressible:!0},"application/vnd.amazon.ebook":{source:"apache",extensions:["azw"]},"application/vnd.amazon.mobi8-ebook":{source:"iana"},"application/vnd.americandynamics.acc":{source:"iana",extensions:["acc"]},"application/vnd.amiga.ami":{source:"iana",extensions:["ami"]},"application/vnd.amundsen.maze+xml":{source:"iana",compressible:!0},"application/vnd.android.ota":{source:"iana"},"application/vnd.android.package-archive":{source:"apache",compressible:!1,extensions:["apk"]},"application/vnd.anki":{source:"iana"},"application/vnd.anser-web-certificate-issue-initiation":{source:"iana",extensions:["cii"]},"application/vnd.anser-web-funds-transfer-initiation":{source:"apache",extensions:["fti"]},"application/vnd.antix.game-component":{source:"iana",extensions:["atx"]},"application/vnd.apache.arrow.file":{source:"iana"},"application/vnd.apache.arrow.stream":{source:"iana"},"application/vnd.apache.thrift.binary":{source:"iana"},"application/vnd.apache.thrift.compact":{source:"iana"},"application/vnd.apache.thrift.json":{source:"iana"},"application/vnd.api+json":{source:"iana",compressible:!0},"application/vnd.aplextor.warrp+json":{source:"iana",compressible:!0},"application/vnd.apothekende.reservation+json":{source:"iana",compressible:!0},"application/vnd.apple.installer+xml":{source:"iana",compressible:!0,extensions:["mpkg"]},"application/vnd.apple.keynote":{source:"iana",extensions:["key"]},"application/vnd.apple.mpegurl":{source:"iana",extensions:["m3u8"]},"application/vnd.apple.numbers":{source:"iana",extensions:["numbers"]},"application/vnd.apple.pages":{source:"iana",extensions:["pages"]},"application/vnd.apple.pkpass":{compressible:!1,extensions:["pkpass"]},"application/vnd.arastra.swi":{source:"iana"},"application/vnd.aristanetworks.swi":{source:"iana",extensions:["swi"]},"application/vnd.artisan+json":{source:"iana",compressible:!0},"application/vnd.artsquare":{source:"iana"},"application/vnd.astraea-software.iota":{source:"iana",extensions:["iota"]},"application/vnd.audiograph":{source:"iana",extensions:["aep"]},"application/vnd.autopackage":{source:"iana"},"application/vnd.avalon+json":{source:"iana",compressible:!0},"application/vnd.avistar+xml":{source:"iana",compressible:!0},"application/vnd.balsamiq.bmml+xml":{source:"iana",compressible:!0,extensions:["bmml"]},"application/vnd.balsamiq.bmpr":{source:"iana"},"application/vnd.banana-accounting":{source:"iana"},"application/vnd.bbf.usp.error":{source:"iana"},"application/vnd.bbf.usp.msg":{source:"iana"},"application/vnd.bbf.usp.msg+json":{source:"iana",compressible:!0},"application/vnd.bekitzur-stech+json":{source:"iana",compressible:!0},"application/vnd.bint.med-content":{source:"iana"},"application/vnd.biopax.rdf+xml":{source:"iana",compressible:!0},"application/vnd.blink-idb-value-wrapper":{source:"iana"},"application/vnd.blueice.multipass":{source:"iana",extensions:["mpm"]},"application/vnd.bluetooth.ep.oob":{source:"iana"},"application/vnd.bluetooth.le.oob":{source:"iana"},"application/vnd.bmi":{source:"iana",extensions:["bmi"]},"application/vnd.bpf":{source:"iana"},"application/vnd.bpf3":{source:"iana"},"application/vnd.businessobjects":{source:"iana",extensions:["rep"]},"application/vnd.byu.uapi+json":{source:"iana",compressible:!0},"application/vnd.cab-jscript":{source:"iana"},"application/vnd.canon-cpdl":{source:"iana"},"application/vnd.canon-lips":{source:"iana"},"application/vnd.capasystems-pg+json":{source:"iana",compressible:!0},"application/vnd.cendio.thinlinc.clientconf":{source:"iana"},"application/vnd.century-systems.tcp_stream":{source:"iana"},"application/vnd.chemdraw+xml":{source:"iana",compressible:!0,extensions:["cdxml"]},"application/vnd.chess-pgn":{source:"iana"},"application/vnd.chipnuts.karaoke-mmd":{source:"iana",extensions:["mmd"]},"application/vnd.ciedi":{source:"iana"},"application/vnd.cinderella":{source:"iana",extensions:["cdy"]},"application/vnd.cirpack.isdn-ext":{source:"iana"},"application/vnd.citationstyles.style+xml":{source:"iana",compressible:!0,extensions:["csl"]},"application/vnd.claymore":{source:"iana",extensions:["cla"]},"application/vnd.cloanto.rp9":{source:"iana",extensions:["rp9"]},"application/vnd.clonk.c4group":{source:"iana",extensions:["c4g","c4d","c4f","c4p","c4u"]},"application/vnd.cluetrust.cartomobile-config":{source:"iana",extensions:["c11amc"]},"application/vnd.cluetrust.cartomobile-config-pkg":{source:"iana",extensions:["c11amz"]},"application/vnd.coffeescript":{source:"iana"},"application/vnd.collabio.xodocuments.document":{source:"iana"},"application/vnd.collabio.xodocuments.document-template":{source:"iana"},"application/vnd.collabio.xodocuments.presentation":{source:"iana"},"application/vnd.collabio.xodocuments.presentation-template":{source:"iana"},"application/vnd.collabio.xodocuments.spreadsheet":{source:"iana"},"application/vnd.collabio.xodocuments.spreadsheet-template":{source:"iana"},"application/vnd.collection+json":{source:"iana",compressible:!0},"application/vnd.collection.doc+json":{source:"iana",compressible:!0},"application/vnd.collection.next+json":{source:"iana",compressible:!0},"application/vnd.comicbook+zip":{source:"iana",compressible:!1},"application/vnd.comicbook-rar":{source:"iana"},"application/vnd.commerce-battelle":{source:"iana"},"application/vnd.commonspace":{source:"iana",extensions:["csp"]},"application/vnd.contact.cmsg":{source:"iana",extensions:["cdbcmsg"]},"application/vnd.coreos.ignition+json":{source:"iana",compressible:!0},"application/vnd.cosmocaller":{source:"iana",extensions:["cmc"]},"application/vnd.crick.clicker":{source:"iana",extensions:["clkx"]},"application/vnd.crick.clicker.keyboard":{source:"iana",extensions:["clkk"]},"application/vnd.crick.clicker.palette":{source:"iana",extensions:["clkp"]},"application/vnd.crick.clicker.template":{source:"iana",extensions:["clkt"]},"application/vnd.crick.clicker.wordbank":{source:"iana",extensions:["clkw"]},"application/vnd.criticaltools.wbs+xml":{source:"iana",compressible:!0,extensions:["wbs"]},"application/vnd.cryptii.pipe+json":{source:"iana",compressible:!0},"application/vnd.crypto-shade-file":{source:"iana"},"application/vnd.cryptomator.encrypted":{source:"iana"},"application/vnd.cryptomator.vault":{source:"iana"},"application/vnd.ctc-posml":{source:"iana",extensions:["pml"]},"application/vnd.ctct.ws+xml":{source:"iana",compressible:!0},"application/vnd.cups-pdf":{source:"iana"},"application/vnd.cups-postscript":{source:"iana"},"application/vnd.cups-ppd":{source:"iana",extensions:["ppd"]},"application/vnd.cups-raster":{source:"iana"},"application/vnd.cups-raw":{source:"iana"},"application/vnd.curl":{source:"iana"},"application/vnd.curl.car":{source:"apache",extensions:["car"]},"application/vnd.curl.pcurl":{source:"apache",extensions:["pcurl"]},"application/vnd.cyan.dean.root+xml":{source:"iana",compressible:!0},"application/vnd.cybank":{source:"iana"},"application/vnd.cyclonedx+json":{source:"iana",compressible:!0},"application/vnd.cyclonedx+xml":{source:"iana",compressible:!0},"application/vnd.d2l.coursepackage1p0+zip":{source:"iana",compressible:!1},"application/vnd.d3m-dataset":{source:"iana"},"application/vnd.d3m-problem":{source:"iana"},"application/vnd.dart":{source:"iana",compressible:!0,extensions:["dart"]},"application/vnd.data-vision.rdz":{source:"iana",extensions:["rdz"]},"application/vnd.datapackage+json":{source:"iana",compressible:!0},"application/vnd.dataresource+json":{source:"iana",compressible:!0},"application/vnd.dbf":{source:"iana",extensions:["dbf"]},"application/vnd.debian.binary-package":{source:"iana"},"application/vnd.dece.data":{source:"iana",extensions:["uvf","uvvf","uvd","uvvd"]},"application/vnd.dece.ttml+xml":{source:"iana",compressible:!0,extensions:["uvt","uvvt"]},"application/vnd.dece.unspecified":{source:"iana",extensions:["uvx","uvvx"]},"application/vnd.dece.zip":{source:"iana",extensions:["uvz","uvvz"]},"application/vnd.denovo.fcselayout-link":{source:"iana",extensions:["fe_launch"]},"application/vnd.desmume.movie":{source:"iana"},"application/vnd.dir-bi.plate-dl-nosuffix":{source:"iana"},"application/vnd.dm.delegation+xml":{source:"iana",compressible:!0},"application/vnd.dna":{source:"iana",extensions:["dna"]},"application/vnd.document+json":{source:"iana",compressible:!0},"application/vnd.dolby.mlp":{source:"apache",extensions:["mlp"]},"application/vnd.dolby.mobile.1":{source:"iana"},"application/vnd.dolby.mobile.2":{source:"iana"},"application/vnd.doremir.scorecloud-binary-document":{source:"iana"},"application/vnd.dpgraph":{source:"iana",extensions:["dpg"]},"application/vnd.dreamfactory":{source:"iana",extensions:["dfac"]},"application/vnd.drive+json":{source:"iana",compressible:!0},"application/vnd.ds-keypoint":{source:"apache",extensions:["kpxx"]},"application/vnd.dtg.local":{source:"iana"},"application/vnd.dtg.local.flash":{source:"iana"},"application/vnd.dtg.local.html":{source:"iana"},"application/vnd.dvb.ait":{source:"iana",extensions:["ait"]},"application/vnd.dvb.dvbisl+xml":{source:"iana",compressible:!0},"application/vnd.dvb.dvbj":{source:"iana"},"application/vnd.dvb.esgcontainer":{source:"iana"},"application/vnd.dvb.ipdcdftnotifaccess":{source:"iana"},"application/vnd.dvb.ipdcesgaccess":{source:"iana"},"application/vnd.dvb.ipdcesgaccess2":{source:"iana"},"application/vnd.dvb.ipdcesgpdd":{source:"iana"},"application/vnd.dvb.ipdcroaming":{source:"iana"},"application/vnd.dvb.iptv.alfec-base":{source:"iana"},"application/vnd.dvb.iptv.alfec-enhancement":{source:"iana"},"application/vnd.dvb.notif-aggregate-root+xml":{source:"iana",compressible:!0},"application/vnd.dvb.notif-container+xml":{source:"iana",compressible:!0},"application/vnd.dvb.notif-generic+xml":{source:"iana",compressible:!0},"application/vnd.dvb.notif-ia-msglist+xml":{source:"iana",compressible:!0},"application/vnd.dvb.notif-ia-registration-request+xml":{source:"iana",compressible:!0},"application/vnd.dvb.notif-ia-registration-response+xml":{source:"iana",compressible:!0},"application/vnd.dvb.notif-init+xml":{source:"iana",compressible:!0},"application/vnd.dvb.pfr":{source:"iana"},"application/vnd.dvb.service":{source:"iana",extensions:["svc"]},"application/vnd.dxr":{source:"iana"},"application/vnd.dynageo":{source:"iana",extensions:["geo"]},"application/vnd.dzr":{source:"iana"},"application/vnd.easykaraoke.cdgdownload":{source:"iana"},"application/vnd.ecdis-update":{source:"iana"},"application/vnd.ecip.rlp":{source:"iana"},"application/vnd.eclipse.ditto+json":{source:"iana",compressible:!0},"application/vnd.ecowin.chart":{source:"iana",extensions:["mag"]},"application/vnd.ecowin.filerequest":{source:"iana"},"application/vnd.ecowin.fileupdate":{source:"iana"},"application/vnd.ecowin.series":{source:"iana"},"application/vnd.ecowin.seriesrequest":{source:"iana"},"application/vnd.ecowin.seriesupdate":{source:"iana"},"application/vnd.efi.img":{source:"iana"},"application/vnd.efi.iso":{source:"iana"},"application/vnd.emclient.accessrequest+xml":{source:"iana",compressible:!0},"application/vnd.enliven":{source:"iana",extensions:["nml"]},"application/vnd.enphase.envoy":{source:"iana"},"application/vnd.eprints.data+xml":{source:"iana",compressible:!0},"application/vnd.epson.esf":{source:"iana",extensions:["esf"]},"application/vnd.epson.msf":{source:"iana",extensions:["msf"]},"application/vnd.epson.quickanime":{source:"iana",extensions:["qam"]},"application/vnd.epson.salt":{source:"iana",extensions:["slt"]},"application/vnd.epson.ssf":{source:"iana",extensions:["ssf"]},"application/vnd.ericsson.quickcall":{source:"iana"},"application/vnd.espass-espass+zip":{source:"iana",compressible:!1},"application/vnd.eszigno3+xml":{source:"iana",compressible:!0,extensions:["es3","et3"]},"application/vnd.etsi.aoc+xml":{source:"iana",compressible:!0},"application/vnd.etsi.asic-e+zip":{source:"iana",compressible:!1},"application/vnd.etsi.asic-s+zip":{source:"iana",compressible:!1},"application/vnd.etsi.cug+xml":{source:"iana",compressible:!0},"application/vnd.etsi.iptvcommand+xml":{source:"iana",compressible:!0},"application/vnd.etsi.iptvdiscovery+xml":{source:"iana",compressible:!0},"application/vnd.etsi.iptvprofile+xml":{source:"iana",compressible:!0},"application/vnd.etsi.iptvsad-bc+xml":{source:"iana",compressible:!0},"application/vnd.etsi.iptvsad-cod+xml":{source:"iana",compressible:!0},"application/vnd.etsi.iptvsad-npvr+xml":{source:"iana",compressible:!0},"application/vnd.etsi.iptvservice+xml":{source:"iana",compressible:!0},"application/vnd.etsi.iptvsync+xml":{source:"iana",compressible:!0},"application/vnd.etsi.iptvueprofile+xml":{source:"iana",compressible:!0},"application/vnd.etsi.mcid+xml":{source:"iana",compressible:!0},"application/vnd.etsi.mheg5":{source:"iana"},"application/vnd.etsi.overload-control-policy-dataset+xml":{source:"iana",compressible:!0},"application/vnd.etsi.pstn+xml":{source:"iana",compressible:!0},"application/vnd.etsi.sci+xml":{source:"iana",compressible:!0},"application/vnd.etsi.simservs+xml":{source:"iana",compressible:!0},"application/vnd.etsi.timestamp-token":{source:"iana"},"application/vnd.etsi.tsl+xml":{source:"iana",compressible:!0},"application/vnd.etsi.tsl.der":{source:"iana"},"application/vnd.eu.kasparian.car+json":{source:"iana",compressible:!0},"application/vnd.eudora.data":{source:"iana"},"application/vnd.evolv.ecig.profile":{source:"iana"},"application/vnd.evolv.ecig.settings":{source:"iana"},"application/vnd.evolv.ecig.theme":{source:"iana"},"application/vnd.exstream-empower+zip":{source:"iana",compressible:!1},"application/vnd.exstream-package":{source:"iana"},"application/vnd.ezpix-album":{source:"iana",extensions:["ez2"]},"application/vnd.ezpix-package":{source:"iana",extensions:["ez3"]},"application/vnd.f-secure.mobile":{source:"iana"},"application/vnd.familysearch.gedcom+zip":{source:"iana",compressible:!1},"application/vnd.fastcopy-disk-image":{source:"iana"},"application/vnd.fdf":{source:"iana",extensions:["fdf"]},"application/vnd.fdsn.mseed":{source:"iana",extensions:["mseed"]},"application/vnd.fdsn.seed":{source:"iana",extensions:["seed","dataless"]},"application/vnd.ffsns":{source:"iana"},"application/vnd.ficlab.flb+zip":{source:"iana",compressible:!1},"application/vnd.filmit.zfc":{source:"iana"},"application/vnd.fints":{source:"iana"},"application/vnd.firemonkeys.cloudcell":{source:"iana"},"application/vnd.flographit":{source:"iana",extensions:["gph"]},"application/vnd.fluxtime.clip":{source:"iana",extensions:["ftc"]},"application/vnd.font-fontforge-sfd":{source:"iana"},"application/vnd.framemaker":{source:"iana",extensions:["fm","frame","maker","book"]},"application/vnd.frogans.fnc":{source:"iana",extensions:["fnc"]},"application/vnd.frogans.ltf":{source:"iana",extensions:["ltf"]},"application/vnd.fsc.weblaunch":{source:"iana",extensions:["fsc"]},"application/vnd.fujifilm.fb.docuworks":{source:"iana"},"application/vnd.fujifilm.fb.docuworks.binder":{source:"iana"},"application/vnd.fujifilm.fb.docuworks.container":{source:"iana"},"application/vnd.fujifilm.fb.jfi+xml":{source:"iana",compressible:!0},"application/vnd.fujitsu.oasys":{source:"iana",extensions:["oas"]},"application/vnd.fujitsu.oasys2":{source:"iana",extensions:["oa2"]},"application/vnd.fujitsu.oasys3":{source:"iana",extensions:["oa3"]},"application/vnd.fujitsu.oasysgp":{source:"iana",extensions:["fg5"]},"application/vnd.fujitsu.oasysprs":{source:"iana",extensions:["bh2"]},"application/vnd.fujixerox.art-ex":{source:"iana"},"application/vnd.fujixerox.art4":{source:"iana"},"application/vnd.fujixerox.ddd":{source:"iana",extensions:["ddd"]},"application/vnd.fujixerox.docuworks":{source:"iana",extensions:["xdw"]},"application/vnd.fujixerox.docuworks.binder":{source:"iana",extensions:["xbd"]},"application/vnd.fujixerox.docuworks.container":{source:"iana"},"application/vnd.fujixerox.hbpl":{source:"iana"},"application/vnd.fut-misnet":{source:"iana"},"application/vnd.futoin+cbor":{source:"iana"},"application/vnd.futoin+json":{source:"iana",compressible:!0},"application/vnd.fuzzysheet":{source:"iana",extensions:["fzs"]},"application/vnd.genomatix.tuxedo":{source:"iana",extensions:["txd"]},"application/vnd.gentics.grd+json":{source:"iana",compressible:!0},"application/vnd.geo+json":{source:"iana",compressible:!0},"application/vnd.geocube+xml":{source:"iana",compressible:!0},"application/vnd.geogebra.file":{source:"iana",extensions:["ggb"]},"application/vnd.geogebra.slides":{source:"iana"},"application/vnd.geogebra.tool":{source:"iana",extensions:["ggt"]},"application/vnd.geometry-explorer":{source:"iana",extensions:["gex","gre"]},"application/vnd.geonext":{source:"iana",extensions:["gxt"]},"application/vnd.geoplan":{source:"iana",extensions:["g2w"]},"application/vnd.geospace":{source:"iana",extensions:["g3w"]},"application/vnd.gerber":{source:"iana"},"application/vnd.globalplatform.card-content-mgt":{source:"iana"},"application/vnd.globalplatform.card-content-mgt-response":{source:"iana"},"application/vnd.gmx":{source:"iana",extensions:["gmx"]},"application/vnd.google-apps.document":{compressible:!1,extensions:["gdoc"]},"application/vnd.google-apps.presentation":{compressible:!1,extensions:["gslides"]},"application/vnd.google-apps.spreadsheet":{compressible:!1,extensions:["gsheet"]},"application/vnd.google-earth.kml+xml":{source:"iana",compressible:!0,extensions:["kml"]},"application/vnd.google-earth.kmz":{source:"iana",compressible:!1,extensions:["kmz"]},"application/vnd.gov.sk.e-form+xml":{source:"iana",compressible:!0},"application/vnd.gov.sk.e-form+zip":{source:"iana",compressible:!1},"application/vnd.gov.sk.xmldatacontainer+xml":{source:"iana",compressible:!0},"application/vnd.grafeq":{source:"iana",extensions:["gqf","gqs"]},"application/vnd.gridmp":{source:"iana"},"application/vnd.groove-account":{source:"iana",extensions:["gac"]},"application/vnd.groove-help":{source:"iana",extensions:["ghf"]},"application/vnd.groove-identity-message":{source:"iana",extensions:["gim"]},"application/vnd.groove-injector":{source:"iana",extensions:["grv"]},"application/vnd.groove-tool-message":{source:"iana",extensions:["gtm"]},"application/vnd.groove-tool-template":{source:"iana",extensions:["tpl"]},"application/vnd.groove-vcard":{source:"iana",extensions:["vcg"]},"application/vnd.hal+json":{source:"iana",compressible:!0},"application/vnd.hal+xml":{source:"iana",compressible:!0,extensions:["hal"]},"application/vnd.handheld-entertainment+xml":{source:"iana",compressible:!0,extensions:["zmm"]},"application/vnd.hbci":{source:"iana",extensions:["hbci"]},"application/vnd.hc+json":{source:"iana",compressible:!0},"application/vnd.hcl-bireports":{source:"iana"},"application/vnd.hdt":{source:"iana"},"application/vnd.heroku+json":{source:"iana",compressible:!0},"application/vnd.hhe.lesson-player":{source:"iana",extensions:["les"]},"application/vnd.hl7cda+xml":{source:"iana",charset:"UTF-8",compressible:!0},"application/vnd.hl7v2+xml":{source:"iana",charset:"UTF-8",compressible:!0},"application/vnd.hp-hpgl":{source:"iana",extensions:["hpgl"]},"application/vnd.hp-hpid":{source:"iana",extensions:["hpid"]},"application/vnd.hp-hps":{source:"iana",extensions:["hps"]},"application/vnd.hp-jlyt":{source:"iana",extensions:["jlt"]},"application/vnd.hp-pcl":{source:"iana",extensions:["pcl"]},"application/vnd.hp-pclxl":{source:"iana",extensions:["pclxl"]},"application/vnd.httphone":{source:"iana"},"application/vnd.hydrostatix.sof-data":{source:"iana",extensions:["sfd-hdstx"]},"application/vnd.hyper+json":{source:"iana",compressible:!0},"application/vnd.hyper-item+json":{source:"iana",compressible:!0},"application/vnd.hyperdrive+json":{source:"iana",compressible:!0},"application/vnd.hzn-3d-crossword":{source:"iana"},"application/vnd.ibm.afplinedata":{source:"iana"},"application/vnd.ibm.electronic-media":{source:"iana"},"application/vnd.ibm.minipay":{source:"iana",extensions:["mpy"]},"application/vnd.ibm.modcap":{source:"iana",extensions:["afp","listafp","list3820"]},"application/vnd.ibm.rights-management":{source:"iana",extensions:["irm"]},"application/vnd.ibm.secure-container":{source:"iana",extensions:["sc"]},"application/vnd.iccprofile":{source:"iana",extensions:["icc","icm"]},"application/vnd.ieee.1905":{source:"iana"},"application/vnd.igloader":{source:"iana",extensions:["igl"]},"application/vnd.imagemeter.folder+zip":{source:"iana",compressible:!1},"application/vnd.imagemeter.image+zip":{source:"iana",compressible:!1},"application/vnd.immervision-ivp":{source:"iana",extensions:["ivp"]},"application/vnd.immervision-ivu":{source:"iana",extensions:["ivu"]},"application/vnd.ims.imsccv1p1":{source:"iana"},"application/vnd.ims.imsccv1p2":{source:"iana"},"application/vnd.ims.imsccv1p3":{source:"iana"},"application/vnd.ims.lis.v2.result+json":{source:"iana",compressible:!0},"application/vnd.ims.lti.v2.toolconsumerprofile+json":{source:"iana",compressible:!0},"application/vnd.ims.lti.v2.toolproxy+json":{source:"iana",compressible:!0},"application/vnd.ims.lti.v2.toolproxy.id+json":{source:"iana",compressible:!0},"application/vnd.ims.lti.v2.toolsettings+json":{source:"iana",compressible:!0},"application/vnd.ims.lti.v2.toolsettings.simple+json":{source:"iana",compressible:!0},"application/vnd.informedcontrol.rms+xml":{source:"iana",compressible:!0},"application/vnd.informix-visionary":{source:"iana"},"application/vnd.infotech.project":{source:"iana"},"application/vnd.infotech.project+xml":{source:"iana",compressible:!0},"application/vnd.innopath.wamp.notification":{source:"iana"},"application/vnd.insors.igm":{source:"iana",extensions:["igm"]},"application/vnd.intercon.formnet":{source:"iana",extensions:["xpw","xpx"]},"application/vnd.intergeo":{source:"iana",extensions:["i2g"]},"application/vnd.intertrust.digibox":{source:"iana"},"application/vnd.intertrust.nncp":{source:"iana"},"application/vnd.intu.qbo":{source:"iana",extensions:["qbo"]},"application/vnd.intu.qfx":{source:"iana",extensions:["qfx"]},"application/vnd.iptc.g2.catalogitem+xml":{source:"iana",compressible:!0},"application/vnd.iptc.g2.conceptitem+xml":{source:"iana",compressible:!0},"application/vnd.iptc.g2.knowledgeitem+xml":{source:"iana",compressible:!0},"application/vnd.iptc.g2.newsitem+xml":{source:"iana",compressible:!0},"application/vnd.iptc.g2.newsmessage+xml":{source:"iana",compressible:!0},"application/vnd.iptc.g2.packageitem+xml":{source:"iana",compressible:!0},"application/vnd.iptc.g2.planningitem+xml":{source:"iana",compressible:!0},"application/vnd.ipunplugged.rcprofile":{source:"iana",extensions:["rcprofile"]},"application/vnd.irepository.package+xml":{source:"iana",compressible:!0,extensions:["irp"]},"application/vnd.is-xpr":{source:"iana",extensions:["xpr"]},"application/vnd.isac.fcs":{source:"iana",extensions:["fcs"]},"application/vnd.iso11783-10+zip":{source:"iana",compressible:!1},"application/vnd.jam":{source:"iana",extensions:["jam"]},"application/vnd.japannet-directory-service":{source:"iana"},"application/vnd.japannet-jpnstore-wakeup":{source:"iana"},"application/vnd.japannet-payment-wakeup":{source:"iana"},"application/vnd.japannet-registration":{source:"iana"},"application/vnd.japannet-registration-wakeup":{source:"iana"},"application/vnd.japannet-setstore-wakeup":{source:"iana"},"application/vnd.japannet-verification":{source:"iana"},"application/vnd.japannet-verification-wakeup":{source:"iana"},"application/vnd.jcp.javame.midlet-rms":{source:"iana",extensions:["rms"]},"application/vnd.jisp":{source:"iana",extensions:["jisp"]},"application/vnd.joost.joda-archive":{source:"iana",extensions:["joda"]},"application/vnd.jsk.isdn-ngn":{source:"iana"},"application/vnd.kahootz":{source:"iana",extensions:["ktz","ktr"]},"application/vnd.kde.karbon":{source:"iana",extensions:["karbon"]},"application/vnd.kde.kchart":{source:"iana",extensions:["chrt"]},"application/vnd.kde.kformula":{source:"iana",extensions:["kfo"]},"application/vnd.kde.kivio":{source:"iana",extensions:["flw"]},"application/vnd.kde.kontour":{source:"iana",extensions:["kon"]},"application/vnd.kde.kpresenter":{source:"iana",extensions:["kpr","kpt"]},"application/vnd.kde.kspread":{source:"iana",extensions:["ksp"]},"application/vnd.kde.kword":{source:"iana",extensions:["kwd","kwt"]},"application/vnd.kenameaapp":{source:"iana",extensions:["htke"]},"application/vnd.kidspiration":{source:"iana",extensions:["kia"]},"application/vnd.kinar":{source:"iana",extensions:["kne","knp"]},"application/vnd.koan":{source:"iana",extensions:["skp","skd","skt","skm"]},"application/vnd.kodak-descriptor":{source:"iana",extensions:["sse"]},"application/vnd.las":{source:"iana"},"application/vnd.las.las+json":{source:"iana",compressible:!0},"application/vnd.las.las+xml":{source:"iana",compressible:!0,extensions:["lasxml"]},"application/vnd.laszip":{source:"iana"},"application/vnd.leap+json":{source:"iana",compressible:!0},"application/vnd.liberty-request+xml":{source:"iana",compressible:!0},"application/vnd.llamagraphics.life-balance.desktop":{source:"iana",extensions:["lbd"]},"application/vnd.llamagraphics.life-balance.exchange+xml":{source:"iana",compressible:!0,extensions:["lbe"]},"application/vnd.logipipe.circuit+zip":{source:"iana",compressible:!1},"application/vnd.loom":{source:"iana"},"application/vnd.lotus-1-2-3":{source:"iana",extensions:["123"]},"application/vnd.lotus-approach":{source:"iana",extensions:["apr"]},"application/vnd.lotus-freelance":{source:"iana",extensions:["pre"]},"application/vnd.lotus-notes":{source:"iana",extensions:["nsf"]},"application/vnd.lotus-organizer":{source:"iana",extensions:["org"]},"application/vnd.lotus-screencam":{source:"iana",extensions:["scm"]},"application/vnd.lotus-wordpro":{source:"iana",extensions:["lwp"]},"application/vnd.macports.portpkg":{source:"iana",extensions:["portpkg"]},"application/vnd.mapbox-vector-tile":{source:"iana",extensions:["mvt"]},"application/vnd.marlin.drm.actiontoken+xml":{source:"iana",compressible:!0},"application/vnd.marlin.drm.conftoken+xml":{source:"iana",compressible:!0},"application/vnd.marlin.drm.license+xml":{source:"iana",compressible:!0},"application/vnd.marlin.drm.mdcf":{source:"iana"},"application/vnd.mason+json":{source:"iana",compressible:!0},"application/vnd.maxar.archive.3tz+zip":{source:"iana",compressible:!1},"application/vnd.maxmind.maxmind-db":{source:"iana"},"application/vnd.mcd":{source:"iana",extensions:["mcd"]},"application/vnd.medcalcdata":{source:"iana",extensions:["mc1"]},"application/vnd.mediastation.cdkey":{source:"iana",extensions:["cdkey"]},"application/vnd.meridian-slingshot":{source:"iana"},"application/vnd.mfer":{source:"iana",extensions:["mwf"]},"application/vnd.mfmp":{source:"iana",extensions:["mfm"]},"application/vnd.micro+json":{source:"iana",compressible:!0},"application/vnd.micrografx.flo":{source:"iana",extensions:["flo"]},"application/vnd.micrografx.igx":{source:"iana",extensions:["igx"]},"application/vnd.microsoft.portable-executable":{source:"iana"},"application/vnd.microsoft.windows.thumbnail-cache":{source:"iana"},"application/vnd.miele+json":{source:"iana",compressible:!0},"application/vnd.mif":{source:"iana",extensions:["mif"]},"application/vnd.minisoft-hp3000-save":{source:"iana"},"application/vnd.mitsubishi.misty-guard.trustweb":{source:"iana"},"application/vnd.mobius.daf":{source:"iana",extensions:["daf"]},"application/vnd.mobius.dis":{source:"iana",extensions:["dis"]},"application/vnd.mobius.mbk":{source:"iana",extensions:["mbk"]},"application/vnd.mobius.mqy":{source:"iana",extensions:["mqy"]},"application/vnd.mobius.msl":{source:"iana",extensions:["msl"]},"application/vnd.mobius.plc":{source:"iana",extensions:["plc"]},"application/vnd.mobius.txf":{source:"iana",extensions:["txf"]},"application/vnd.mophun.application":{source:"iana",extensions:["mpn"]},"application/vnd.mophun.certificate":{source:"iana",extensions:["mpc"]},"application/vnd.motorola.flexsuite":{source:"iana"},"application/vnd.motorola.flexsuite.adsi":{source:"iana"},"application/vnd.motorola.flexsuite.fis":{source:"iana"},"application/vnd.motorola.flexsuite.gotap":{source:"iana"},"application/vnd.motorola.flexsuite.kmr":{source:"iana"},"application/vnd.motorola.flexsuite.ttc":{source:"iana"},"application/vnd.motorola.flexsuite.wem":{source:"iana"},"application/vnd.motorola.iprm":{source:"iana"},"application/vnd.mozilla.xul+xml":{source:"iana",compressible:!0,extensions:["xul"]},"application/vnd.ms-3mfdocument":{source:"iana"},"application/vnd.ms-artgalry":{source:"iana",extensions:["cil"]},"application/vnd.ms-asf":{source:"iana"},"application/vnd.ms-cab-compressed":{source:"iana",extensions:["cab"]},"application/vnd.ms-color.iccprofile":{source:"apache"},"application/vnd.ms-excel":{source:"iana",compressible:!1,extensions:["xls","xlm","xla","xlc","xlt","xlw"]},"application/vnd.ms-excel.addin.macroenabled.12":{source:"iana",extensions:["xlam"]},"application/vnd.ms-excel.sheet.binary.macroenabled.12":{source:"iana",extensions:["xlsb"]},"application/vnd.ms-excel.sheet.macroenabled.12":{source:"iana",extensions:["xlsm"]},"application/vnd.ms-excel.template.macroenabled.12":{source:"iana",extensions:["xltm"]},"application/vnd.ms-fontobject":{source:"iana",compressible:!0,extensions:["eot"]},"application/vnd.ms-htmlhelp":{source:"iana",extensions:["chm"]},"application/vnd.ms-ims":{source:"iana",extensions:["ims"]},"application/vnd.ms-lrm":{source:"iana",extensions:["lrm"]},"application/vnd.ms-office.activex+xml":{source:"iana",compressible:!0},"application/vnd.ms-officetheme":{source:"iana",extensions:["thmx"]},"application/vnd.ms-opentype":{source:"apache",compressible:!0},"application/vnd.ms-outlook":{compressible:!1,extensions:["msg"]},"application/vnd.ms-package.obfuscated-opentype":{source:"apache"},"application/vnd.ms-pki.seccat":{source:"apache",extensions:["cat"]},"application/vnd.ms-pki.stl":{source:"apache",extensions:["stl"]},"application/vnd.ms-playready.initiator+xml":{source:"iana",compressible:!0},"application/vnd.ms-powerpoint":{source:"iana",compressible:!1,extensions:["ppt","pps","pot"]},"application/vnd.ms-powerpoint.addin.macroenabled.12":{source:"iana",extensions:["ppam"]},"application/vnd.ms-powerpoint.presentation.macroenabled.12":{source:"iana",extensions:["pptm"]},"application/vnd.ms-powerpoint.slide.macroenabled.12":{source:"iana",extensions:["sldm"]},"application/vnd.ms-powerpoint.slideshow.macroenabled.12":{source:"iana",extensions:["ppsm"]},"application/vnd.ms-powerpoint.template.macroenabled.12":{source:"iana",extensions:["potm"]},"application/vnd.ms-printdevicecapabilities+xml":{source:"iana",compressible:!0},"application/vnd.ms-printing.printticket+xml":{source:"apache",compressible:!0},"application/vnd.ms-printschematicket+xml":{source:"iana",compressible:!0},"application/vnd.ms-project":{source:"iana",extensions:["mpp","mpt"]},"application/vnd.ms-tnef":{source:"iana"},"application/vnd.ms-windows.devicepairing":{source:"iana"},"application/vnd.ms-windows.nwprinting.oob":{source:"iana"},"application/vnd.ms-windows.printerpairing":{source:"iana"},"application/vnd.ms-windows.wsd.oob":{source:"iana"},"application/vnd.ms-wmdrm.lic-chlg-req":{source:"iana"},"application/vnd.ms-wmdrm.lic-resp":{source:"iana"},"application/vnd.ms-wmdrm.meter-chlg-req":{source:"iana"},"application/vnd.ms-wmdrm.meter-resp":{source:"iana"},"application/vnd.ms-word.document.macroenabled.12":{source:"iana",extensions:["docm"]},"application/vnd.ms-word.template.macroenabled.12":{source:"iana",extensions:["dotm"]},"application/vnd.ms-works":{source:"iana",extensions:["wps","wks","wcm","wdb"]},"application/vnd.ms-wpl":{source:"iana",extensions:["wpl"]},"application/vnd.ms-xpsdocument":{source:"iana",compressible:!1,extensions:["xps"]},"application/vnd.msa-disk-image":{source:"iana"},"application/vnd.mseq":{source:"iana",extensions:["mseq"]},"application/vnd.msign":{source:"iana"},"application/vnd.multiad.creator":{source:"iana"},"application/vnd.multiad.creator.cif":{source:"iana"},"application/vnd.music-niff":{source:"iana"},"application/vnd.musician":{source:"iana",extensions:["mus"]},"application/vnd.muvee.style":{source:"iana",extensions:["msty"]},"application/vnd.mynfc":{source:"iana",extensions:["taglet"]},"application/vnd.nacamar.ybrid+json":{source:"iana",compressible:!0},"application/vnd.ncd.control":{source:"iana"},"application/vnd.ncd.reference":{source:"iana"},"application/vnd.nearst.inv+json":{source:"iana",compressible:!0},"application/vnd.nebumind.line":{source:"iana"},"application/vnd.nervana":{source:"iana"},"application/vnd.netfpx":{source:"iana"},"application/vnd.neurolanguage.nlu":{source:"iana",extensions:["nlu"]},"application/vnd.nimn":{source:"iana"},"application/vnd.nintendo.nitro.rom":{source:"iana"},"application/vnd.nintendo.snes.rom":{source:"iana"},"application/vnd.nitf":{source:"iana",extensions:["ntf","nitf"]},"application/vnd.noblenet-directory":{source:"iana",extensions:["nnd"]},"application/vnd.noblenet-sealer":{source:"iana",extensions:["nns"]},"application/vnd.noblenet-web":{source:"iana",extensions:["nnw"]},"application/vnd.nokia.catalogs":{source:"iana"},"application/vnd.nokia.conml+wbxml":{source:"iana"},"application/vnd.nokia.conml+xml":{source:"iana",compressible:!0},"application/vnd.nokia.iptv.config+xml":{source:"iana",compressible:!0},"application/vnd.nokia.isds-radio-presets":{source:"iana"},"application/vnd.nokia.landmark+wbxml":{source:"iana"},"application/vnd.nokia.landmark+xml":{source:"iana",compressible:!0},"application/vnd.nokia.landmarkcollection+xml":{source:"iana",compressible:!0},"application/vnd.nokia.n-gage.ac+xml":{source:"iana",compressible:!0,extensions:["ac"]},"application/vnd.nokia.n-gage.data":{source:"iana",extensions:["ngdat"]},"application/vnd.nokia.n-gage.symbian.install":{source:"iana",extensions:["n-gage"]},"application/vnd.nokia.ncd":{source:"iana"},"application/vnd.nokia.pcd+wbxml":{source:"iana"},"application/vnd.nokia.pcd+xml":{source:"iana",compressible:!0},"application/vnd.nokia.radio-preset":{source:"iana",extensions:["rpst"]},"application/vnd.nokia.radio-presets":{source:"iana",extensions:["rpss"]},"application/vnd.novadigm.edm":{source:"iana",extensions:["edm"]},"application/vnd.novadigm.edx":{source:"iana",extensions:["edx"]},"application/vnd.novadigm.ext":{source:"iana",extensions:["ext"]},"application/vnd.ntt-local.content-share":{source:"iana"},"application/vnd.ntt-local.file-transfer":{source:"iana"},"application/vnd.ntt-local.ogw_remote-access":{source:"iana"},"application/vnd.ntt-local.sip-ta_remote":{source:"iana"},"application/vnd.ntt-local.sip-ta_tcp_stream":{source:"iana"},"application/vnd.oasis.opendocument.chart":{source:"iana",extensions:["odc"]},"application/vnd.oasis.opendocument.chart-template":{source:"iana",extensions:["otc"]},"application/vnd.oasis.opendocument.database":{source:"iana",extensions:["odb"]},"application/vnd.oasis.opendocument.formula":{source:"iana",extensions:["odf"]},"application/vnd.oasis.opendocument.formula-template":{source:"iana",extensions:["odft"]},"application/vnd.oasis.opendocument.graphics":{source:"iana",compressible:!1,extensions:["odg"]},"application/vnd.oasis.opendocument.graphics-template":{source:"iana",extensions:["otg"]},"application/vnd.oasis.opendocument.image":{source:"iana",extensions:["odi"]},"application/vnd.oasis.opendocument.image-template":{source:"iana",extensions:["oti"]},"application/vnd.oasis.opendocument.presentation":{source:"iana",compressible:!1,extensions:["odp"]},"application/vnd.oasis.opendocument.presentation-template":{source:"iana",extensions:["otp"]},"application/vnd.oasis.opendocument.spreadsheet":{source:"iana",compressible:!1,extensions:["ods"]},"application/vnd.oasis.opendocument.spreadsheet-template":{source:"iana",extensions:["ots"]},"application/vnd.oasis.opendocument.text":{source:"iana",compressible:!1,extensions:["odt"]},"application/vnd.oasis.opendocument.text-master":{source:"iana",extensions:["odm"]},"application/vnd.oasis.opendocument.text-template":{source:"iana",extensions:["ott"]},"application/vnd.oasis.opendocument.text-web":{source:"iana",extensions:["oth"]},"application/vnd.obn":{source:"iana"},"application/vnd.ocf+cbor":{source:"iana"},"application/vnd.oci.image.manifest.v1+json":{source:"iana",compressible:!0},"application/vnd.oftn.l10n+json":{source:"iana",compressible:!0},"application/vnd.oipf.contentaccessdownload+xml":{source:"iana",compressible:!0},"application/vnd.oipf.contentaccessstreaming+xml":{source:"iana",compressible:!0},"application/vnd.oipf.cspg-hexbinary":{source:"iana"},"application/vnd.oipf.dae.svg+xml":{source:"iana",compressible:!0},"application/vnd.oipf.dae.xhtml+xml":{source:"iana",compressible:!0},"application/vnd.oipf.mippvcontrolmessage+xml":{source:"iana",compressible:!0},"application/vnd.oipf.pae.gem":{source:"iana"},"application/vnd.oipf.spdiscovery+xml":{source:"iana",compressible:!0},"application/vnd.oipf.spdlist+xml":{source:"iana",compressible:!0},"application/vnd.oipf.ueprofile+xml":{source:"iana",compressible:!0},"application/vnd.oipf.userprofile+xml":{source:"iana",compressible:!0},"application/vnd.olpc-sugar":{source:"iana",extensions:["xo"]},"application/vnd.oma-scws-config":{source:"iana"},"application/vnd.oma-scws-http-request":{source:"iana"},"application/vnd.oma-scws-http-response":{source:"iana"},"application/vnd.oma.bcast.associated-procedure-parameter+xml":{source:"iana",compressible:!0},"application/vnd.oma.bcast.drm-trigger+xml":{source:"iana",compressible:!0},"application/vnd.oma.bcast.imd+xml":{source:"iana",compressible:!0},"application/vnd.oma.bcast.ltkm":{source:"iana"},"application/vnd.oma.bcast.notification+xml":{source:"iana",compressible:!0},"application/vnd.oma.bcast.provisioningtrigger":{source:"iana"},"application/vnd.oma.bcast.sgboot":{source:"iana"},"application/vnd.oma.bcast.sgdd+xml":{source:"iana",compressible:!0},"application/vnd.oma.bcast.sgdu":{source:"iana"},"application/vnd.oma.bcast.simple-symbol-container":{source:"iana"},"application/vnd.oma.bcast.smartcard-trigger+xml":{source:"iana",compressible:!0},"application/vnd.oma.bcast.sprov+xml":{source:"iana",compressible:!0},"application/vnd.oma.bcast.stkm":{source:"iana"},"application/vnd.oma.cab-address-book+xml":{source:"iana",compressible:!0},"application/vnd.oma.cab-feature-handler+xml":{source:"iana",compressible:!0},"application/vnd.oma.cab-pcc+xml":{source:"iana",compressible:!0},"application/vnd.oma.cab-subs-invite+xml":{source:"iana",compressible:!0},"application/vnd.oma.cab-user-prefs+xml":{source:"iana",compressible:!0},"application/vnd.oma.dcd":{source:"iana"},"application/vnd.oma.dcdc":{source:"iana"},"application/vnd.oma.dd2+xml":{source:"iana",compressible:!0,extensions:["dd2"]},"application/vnd.oma.drm.risd+xml":{source:"iana",compressible:!0},"application/vnd.oma.group-usage-list+xml":{source:"iana",compressible:!0},"application/vnd.oma.lwm2m+cbor":{source:"iana"},"application/vnd.oma.lwm2m+json":{source:"iana",compressible:!0},"application/vnd.oma.lwm2m+tlv":{source:"iana"},"application/vnd.oma.pal+xml":{source:"iana",compressible:!0},"application/vnd.oma.poc.detailed-progress-report+xml":{source:"iana",compressible:!0},"application/vnd.oma.poc.final-report+xml":{source:"iana",compressible:!0},"application/vnd.oma.poc.groups+xml":{source:"iana",compressible:!0},"application/vnd.oma.poc.invocation-descriptor+xml":{source:"iana",compressible:!0},"application/vnd.oma.poc.optimized-progress-report+xml":{source:"iana",compressible:!0},"application/vnd.oma.push":{source:"iana"},"application/vnd.oma.scidm.messages+xml":{source:"iana",compressible:!0},"application/vnd.oma.xcap-directory+xml":{source:"iana",compressible:!0},"application/vnd.omads-email+xml":{source:"iana",charset:"UTF-8",compressible:!0},"application/vnd.omads-file+xml":{source:"iana",charset:"UTF-8",compressible:!0},"application/vnd.omads-folder+xml":{source:"iana",charset:"UTF-8",compressible:!0},"application/vnd.omaloc-supl-init":{source:"iana"},"application/vnd.onepager":{source:"iana"},"application/vnd.onepagertamp":{source:"iana"},"application/vnd.onepagertamx":{source:"iana"},"application/vnd.onepagertat":{source:"iana"},"application/vnd.onepagertatp":{source:"iana"},"application/vnd.onepagertatx":{source:"iana"},"application/vnd.openblox.game+xml":{source:"iana",compressible:!0,extensions:["obgx"]},"application/vnd.openblox.game-binary":{source:"iana"},"application/vnd.openeye.oeb":{source:"iana"},"application/vnd.openofficeorg.extension":{source:"apache",extensions:["oxt"]},"application/vnd.openstreetmap.data+xml":{source:"iana",compressible:!0,extensions:["osm"]},"application/vnd.opentimestamps.ots":{source:"iana"},"application/vnd.openxmlformats-officedocument.custom-properties+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.customxmlproperties+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.drawing+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.drawingml.chart+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.drawingml.chartshapes+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.drawingml.diagramcolors+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.drawingml.diagramdata+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.drawingml.diagramlayout+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.drawingml.diagramstyle+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.extended-properties+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.presentationml.commentauthors+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.presentationml.comments+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.presentationml.handoutmaster+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.presentationml.notesmaster+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.presentationml.notesslide+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.presentationml.presentation":{source:"iana",compressible:!1,extensions:["pptx"]},"application/vnd.openxmlformats-officedocument.presentationml.presentation.main+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.presentationml.presprops+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.presentationml.slide":{source:"iana",extensions:["sldx"]},"application/vnd.openxmlformats-officedocument.presentationml.slide+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.presentationml.slidelayout+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.presentationml.slidemaster+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.presentationml.slideshow":{source:"iana",extensions:["ppsx"]},"application/vnd.openxmlformats-officedocument.presentationml.slideshow.main+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.presentationml.slideupdateinfo+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.presentationml.tablestyles+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.presentationml.tags+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.presentationml.template":{source:"iana",extensions:["potx"]},"application/vnd.openxmlformats-officedocument.presentationml.template.main+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.presentationml.viewprops+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.spreadsheetml.calcchain+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.spreadsheetml.chartsheet+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.spreadsheetml.comments+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.spreadsheetml.connections+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.spreadsheetml.dialogsheet+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.spreadsheetml.externallink+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.spreadsheetml.pivotcachedefinition+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.spreadsheetml.pivotcacherecords+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.spreadsheetml.pivottable+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.spreadsheetml.querytable+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.spreadsheetml.revisionheaders+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.spreadsheetml.revisionlog+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.spreadsheetml.sharedstrings+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet":{source:"iana",compressible:!1,extensions:["xlsx"]},"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet.main+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.spreadsheetml.sheetmetadata+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.spreadsheetml.styles+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.spreadsheetml.table+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.spreadsheetml.tablesinglecells+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.spreadsheetml.template":{source:"iana",extensions:["xltx"]},"application/vnd.openxmlformats-officedocument.spreadsheetml.template.main+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.spreadsheetml.usernames+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.spreadsheetml.volatiledependencies+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.spreadsheetml.worksheet+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.theme+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.themeoverride+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.vmldrawing":{source:"iana"},"application/vnd.openxmlformats-officedocument.wordprocessingml.comments+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.wordprocessingml.document":{source:"iana",compressible:!1,extensions:["docx"]},"application/vnd.openxmlformats-officedocument.wordprocessingml.document.glossary+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.wordprocessingml.document.main+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.wordprocessingml.endnotes+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.wordprocessingml.fonttable+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.wordprocessingml.footer+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.wordprocessingml.footnotes+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.wordprocessingml.numbering+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.wordprocessingml.settings+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.wordprocessingml.styles+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.wordprocessingml.template":{source:"iana",extensions:["dotx"]},"application/vnd.openxmlformats-officedocument.wordprocessingml.template.main+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.wordprocessingml.websettings+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-package.core-properties+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-package.digital-signature-xmlsignature+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-package.relationships+xml":{source:"iana",compressible:!0},"application/vnd.oracle.resource+json":{source:"iana",compressible:!0},"application/vnd.orange.indata":{source:"iana"},"application/vnd.osa.netdeploy":{source:"iana"},"application/vnd.osgeo.mapguide.package":{source:"iana",extensions:["mgp"]},"application/vnd.osgi.bundle":{source:"iana"},"application/vnd.osgi.dp":{source:"iana",extensions:["dp"]},"application/vnd.osgi.subsystem":{source:"iana",extensions:["esa"]},"application/vnd.otps.ct-kip+xml":{source:"iana",compressible:!0},"application/vnd.oxli.countgraph":{source:"iana"},"application/vnd.pagerduty+json":{source:"iana",compressible:!0},"application/vnd.palm":{source:"iana",extensions:["pdb","pqa","oprc"]},"application/vnd.panoply":{source:"iana"},"application/vnd.paos.xml":{source:"iana"},"application/vnd.patentdive":{source:"iana"},"application/vnd.patientecommsdoc":{source:"iana"},"application/vnd.pawaafile":{source:"iana",extensions:["paw"]},"application/vnd.pcos":{source:"iana"},"application/vnd.pg.format":{source:"iana",extensions:["str"]},"application/vnd.pg.osasli":{source:"iana",extensions:["ei6"]},"application/vnd.piaccess.application-licence":{source:"iana"},"application/vnd.picsel":{source:"iana",extensions:["efif"]},"application/vnd.pmi.widget":{source:"iana",extensions:["wg"]},"application/vnd.poc.group-advertisement+xml":{source:"iana",compressible:!0},"application/vnd.pocketlearn":{source:"iana",extensions:["plf"]},"application/vnd.powerbuilder6":{source:"iana",extensions:["pbd"]},"application/vnd.powerbuilder6-s":{source:"iana"},"application/vnd.powerbuilder7":{source:"iana"},"application/vnd.powerbuilder7-s":{source:"iana"},"application/vnd.powerbuilder75":{source:"iana"},"application/vnd.powerbuilder75-s":{source:"iana"},"application/vnd.preminet":{source:"iana"},"application/vnd.previewsystems.box":{source:"iana",extensions:["box"]},"application/vnd.proteus.magazine":{source:"iana",extensions:["mgz"]},"application/vnd.psfs":{source:"iana"},"application/vnd.publishare-delta-tree":{source:"iana",extensions:["qps"]},"application/vnd.pvi.ptid1":{source:"iana",extensions:["ptid"]},"application/vnd.pwg-multiplexed":{source:"iana"},"application/vnd.pwg-xhtml-print+xml":{source:"iana",compressible:!0},"application/vnd.qualcomm.brew-app-res":{source:"iana"},"application/vnd.quarantainenet":{source:"iana"},"application/vnd.quark.quarkxpress":{source:"iana",extensions:["qxd","qxt","qwd","qwt","qxl","qxb"]},"application/vnd.quobject-quoxdocument":{source:"iana"},"application/vnd.radisys.moml+xml":{source:"iana",compressible:!0},"application/vnd.radisys.msml+xml":{source:"iana",compressible:!0},"application/vnd.radisys.msml-audit+xml":{source:"iana",compressible:!0},"application/vnd.radisys.msml-audit-conf+xml":{source:"iana",compressible:!0},"application/vnd.radisys.msml-audit-conn+xml":{source:"iana",compressible:!0},"application/vnd.radisys.msml-audit-dialog+xml":{source:"iana",compressible:!0},"application/vnd.radisys.msml-audit-stream+xml":{source:"iana",compressible:!0},"application/vnd.radisys.msml-conf+xml":{source:"iana",compressible:!0},"application/vnd.radisys.msml-dialog+xml":{source:"iana",compressible:!0},"application/vnd.radisys.msml-dialog-base+xml":{source:"iana",compressible:!0},"application/vnd.radisys.msml-dialog-fax-detect+xml":{source:"iana",compressible:!0},"application/vnd.radisys.msml-dialog-fax-sendrecv+xml":{source:"iana",compressible:!0},"application/vnd.radisys.msml-dialog-group+xml":{source:"iana",compressible:!0},"application/vnd.radisys.msml-dialog-speech+xml":{source:"iana",compressible:!0},"application/vnd.radisys.msml-dialog-transform+xml":{source:"iana",compressible:!0},"application/vnd.rainstor.data":{source:"iana"},"application/vnd.rapid":{source:"iana"},"application/vnd.rar":{source:"iana",extensions:["rar"]},"application/vnd.realvnc.bed":{source:"iana",extensions:["bed"]},"application/vnd.recordare.musicxml":{source:"iana",extensions:["mxl"]},"application/vnd.recordare.musicxml+xml":{source:"iana",compressible:!0,extensions:["musicxml"]},"application/vnd.renlearn.rlprint":{source:"iana"},"application/vnd.resilient.logic":{source:"iana"},"application/vnd.restful+json":{source:"iana",compressible:!0},"application/vnd.rig.cryptonote":{source:"iana",extensions:["cryptonote"]},"application/vnd.rim.cod":{source:"apache",extensions:["cod"]},"application/vnd.rn-realmedia":{source:"apache",extensions:["rm"]},"application/vnd.rn-realmedia-vbr":{source:"apache",extensions:["rmvb"]},"application/vnd.route66.link66+xml":{source:"iana",compressible:!0,extensions:["link66"]},"application/vnd.rs-274x":{source:"iana"},"application/vnd.ruckus.download":{source:"iana"},"application/vnd.s3sms":{source:"iana"},"application/vnd.sailingtracker.track":{source:"iana",extensions:["st"]},"application/vnd.sar":{source:"iana"},"application/vnd.sbm.cid":{source:"iana"},"application/vnd.sbm.mid2":{source:"iana"},"application/vnd.scribus":{source:"iana"},"application/vnd.sealed.3df":{source:"iana"},"application/vnd.sealed.csf":{source:"iana"},"application/vnd.sealed.doc":{source:"iana"},"application/vnd.sealed.eml":{source:"iana"},"application/vnd.sealed.mht":{source:"iana"},"application/vnd.sealed.net":{source:"iana"},"application/vnd.sealed.ppt":{source:"iana"},"application/vnd.sealed.tiff":{source:"iana"},"application/vnd.sealed.xls":{source:"iana"},"application/vnd.sealedmedia.softseal.html":{source:"iana"},"application/vnd.sealedmedia.softseal.pdf":{source:"iana"},"application/vnd.seemail":{source:"iana",extensions:["see"]},"application/vnd.seis+json":{source:"iana",compressible:!0},"application/vnd.sema":{source:"iana",extensions:["sema"]},"application/vnd.semd":{source:"iana",extensions:["semd"]},"application/vnd.semf":{source:"iana",extensions:["semf"]},"application/vnd.shade-save-file":{source:"iana"},"application/vnd.shana.informed.formdata":{source:"iana",extensions:["ifm"]},"application/vnd.shana.informed.formtemplate":{source:"iana",extensions:["itp"]},"application/vnd.shana.informed.interchange":{source:"iana",extensions:["iif"]},"application/vnd.shana.informed.package":{source:"iana",extensions:["ipk"]},"application/vnd.shootproof+json":{source:"iana",compressible:!0},"application/vnd.shopkick+json":{source:"iana",compressible:!0},"application/vnd.shp":{source:"iana"},"application/vnd.shx":{source:"iana"},"application/vnd.sigrok.session":{source:"iana"},"application/vnd.simtech-mindmapper":{source:"iana",extensions:["twd","twds"]},"application/vnd.siren+json":{source:"iana",compressible:!0},"application/vnd.smaf":{source:"iana",extensions:["mmf"]},"application/vnd.smart.notebook":{source:"iana"},"application/vnd.smart.teacher":{source:"iana",extensions:["teacher"]},"application/vnd.snesdev-page-table":{source:"iana"},"application/vnd.software602.filler.form+xml":{source:"iana",compressible:!0,extensions:["fo"]},"application/vnd.software602.filler.form-xml-zip":{source:"iana"},"application/vnd.solent.sdkm+xml":{source:"iana",compressible:!0,extensions:["sdkm","sdkd"]},"application/vnd.spotfire.dxp":{source:"iana",extensions:["dxp"]},"application/vnd.spotfire.sfs":{source:"iana",extensions:["sfs"]},"application/vnd.sqlite3":{source:"iana"},"application/vnd.sss-cod":{source:"iana"},"application/vnd.sss-dtf":{source:"iana"},"application/vnd.sss-ntf":{source:"iana"},"application/vnd.stardivision.calc":{source:"apache",extensions:["sdc"]},"application/vnd.stardivision.draw":{source:"apache",extensions:["sda"]},"application/vnd.stardivision.impress":{source:"apache",extensions:["sdd"]},"application/vnd.stardivision.math":{source:"apache",extensions:["smf"]},"application/vnd.stardivision.writer":{source:"apache",extensions:["sdw","vor"]},"application/vnd.stardivision.writer-global":{source:"apache",extensions:["sgl"]},"application/vnd.stepmania.package":{source:"iana",extensions:["smzip"]},"application/vnd.stepmania.stepchart":{source:"iana",extensions:["sm"]},"application/vnd.street-stream":{source:"iana"},"application/vnd.sun.wadl+xml":{source:"iana",compressible:!0,extensions:["wadl"]},"application/vnd.sun.xml.calc":{source:"apache",extensions:["sxc"]},"application/vnd.sun.xml.calc.template":{source:"apache",extensions:["stc"]},"application/vnd.sun.xml.draw":{source:"apache",extensions:["sxd"]},"application/vnd.sun.xml.draw.template":{source:"apache",extensions:["std"]},"application/vnd.sun.xml.impress":{source:"apache",extensions:["sxi"]},"application/vnd.sun.xml.impress.template":{source:"apache",extensions:["sti"]},"application/vnd.sun.xml.math":{source:"apache",extensions:["sxm"]},"application/vnd.sun.xml.writer":{source:"apache",extensions:["sxw"]},"application/vnd.sun.xml.writer.global":{source:"apache",extensions:["sxg"]},"application/vnd.sun.xml.writer.template":{source:"apache",extensions:["stw"]},"application/vnd.sus-calendar":{source:"iana",extensions:["sus","susp"]},"application/vnd.svd":{source:"iana",extensions:["svd"]},"application/vnd.swiftview-ics":{source:"iana"},"application/vnd.sycle+xml":{source:"iana",compressible:!0},"application/vnd.syft+json":{source:"iana",compressible:!0},"application/vnd.symbian.install":{source:"apache",extensions:["sis","sisx"]},"application/vnd.syncml+xml":{source:"iana",charset:"UTF-8",compressible:!0,extensions:["xsm"]},"application/vnd.syncml.dm+wbxml":{source:"iana",charset:"UTF-8",extensions:["bdm"]},"application/vnd.syncml.dm+xml":{source:"iana",charset:"UTF-8",compressible:!0,extensions:["xdm"]},"application/vnd.syncml.dm.notification":{source:"iana"},"application/vnd.syncml.dmddf+wbxml":{source:"iana"},"application/vnd.syncml.dmddf+xml":{source:"iana",charset:"UTF-8",compressible:!0,extensions:["ddf"]},"application/vnd.syncml.dmtnds+wbxml":{source:"iana"},"application/vnd.syncml.dmtnds+xml":{source:"iana",charset:"UTF-8",compressible:!0},"application/vnd.syncml.ds.notification":{source:"iana"},"application/vnd.tableschema+json":{source:"iana",compressible:!0},"application/vnd.tao.intent-module-archive":{source:"iana",extensions:["tao"]},"application/vnd.tcpdump.pcap":{source:"iana",extensions:["pcap","cap","dmp"]},"application/vnd.think-cell.ppttc+json":{source:"iana",compressible:!0},"application/vnd.tmd.mediaflex.api+xml":{source:"iana",compressible:!0},"application/vnd.tml":{source:"iana"},"application/vnd.tmobile-livetv":{source:"iana",extensions:["tmo"]},"application/vnd.tri.onesource":{source:"iana"},"application/vnd.trid.tpt":{source:"iana",extensions:["tpt"]},"application/vnd.triscape.mxs":{source:"iana",extensions:["mxs"]},"application/vnd.trueapp":{source:"iana",extensions:["tra"]},"application/vnd.truedoc":{source:"iana"},"application/vnd.ubisoft.webplayer":{source:"iana"},"application/vnd.ufdl":{source:"iana",extensions:["ufd","ufdl"]},"application/vnd.uiq.theme":{source:"iana",extensions:["utz"]},"application/vnd.umajin":{source:"iana",extensions:["umj"]},"application/vnd.unity":{source:"iana",extensions:["unityweb"]},"application/vnd.uoml+xml":{source:"iana",compressible:!0,extensions:["uoml"]},"application/vnd.uplanet.alert":{source:"iana"},"application/vnd.uplanet.alert-wbxml":{source:"iana"},"application/vnd.uplanet.bearer-choice":{source:"iana"},"application/vnd.uplanet.bearer-choice-wbxml":{source:"iana"},"application/vnd.uplanet.cacheop":{source:"iana"},"application/vnd.uplanet.cacheop-wbxml":{source:"iana"},"application/vnd.uplanet.channel":{source:"iana"},"application/vnd.uplanet.channel-wbxml":{source:"iana"},"application/vnd.uplanet.list":{source:"iana"},"application/vnd.uplanet.list-wbxml":{source:"iana"},"application/vnd.uplanet.listcmd":{source:"iana"},"application/vnd.uplanet.listcmd-wbxml":{source:"iana"},"application/vnd.uplanet.signal":{source:"iana"},"application/vnd.uri-map":{source:"iana"},"application/vnd.valve.source.material":{source:"iana"},"application/vnd.vcx":{source:"iana",extensions:["vcx"]},"application/vnd.vd-study":{source:"iana"},"application/vnd.vectorworks":{source:"iana"},"application/vnd.vel+json":{source:"iana",compressible:!0},"application/vnd.verimatrix.vcas":{source:"iana"},"application/vnd.veritone.aion+json":{source:"iana",compressible:!0},"application/vnd.veryant.thin":{source:"iana"},"application/vnd.ves.encrypted":{source:"iana"},"application/vnd.vidsoft.vidconference":{source:"iana"},"application/vnd.visio":{source:"iana",extensions:["vsd","vst","vss","vsw"]},"application/vnd.visionary":{source:"iana",extensions:["vis"]},"application/vnd.vividence.scriptfile":{source:"iana"},"application/vnd.vsf":{source:"iana",extensions:["vsf"]},"application/vnd.wap.sic":{source:"iana"},"application/vnd.wap.slc":{source:"iana"},"application/vnd.wap.wbxml":{source:"iana",charset:"UTF-8",extensions:["wbxml"]},"application/vnd.wap.wmlc":{source:"iana",extensions:["wmlc"]},"application/vnd.wap.wmlscriptc":{source:"iana",extensions:["wmlsc"]},"application/vnd.webturbo":{source:"iana",extensions:["wtb"]},"application/vnd.wfa.dpp":{source:"iana"},"application/vnd.wfa.p2p":{source:"iana"},"application/vnd.wfa.wsc":{source:"iana"},"application/vnd.windows.devicepairing":{source:"iana"},"application/vnd.wmc":{source:"iana"},"application/vnd.wmf.bootstrap":{source:"iana"},"application/vnd.wolfram.mathematica":{source:"iana"},"application/vnd.wolfram.mathematica.package":{source:"iana"},"application/vnd.wolfram.player":{source:"iana",extensions:["nbp"]},"application/vnd.wordperfect":{source:"iana",extensions:["wpd"]},"application/vnd.wqd":{source:"iana",extensions:["wqd"]},"application/vnd.wrq-hp3000-labelled":{source:"iana"},"application/vnd.wt.stf":{source:"iana",extensions:["stf"]},"application/vnd.wv.csp+wbxml":{source:"iana"},"application/vnd.wv.csp+xml":{source:"iana",compressible:!0},"application/vnd.wv.ssp+xml":{source:"iana",compressible:!0},"application/vnd.xacml+json":{source:"iana",compressible:!0},"application/vnd.xara":{source:"iana",extensions:["xar"]},"application/vnd.xfdl":{source:"iana",extensions:["xfdl"]},"application/vnd.xfdl.webform":{source:"iana"},"application/vnd.xmi+xml":{source:"iana",compressible:!0},"application/vnd.xmpie.cpkg":{source:"iana"},"application/vnd.xmpie.dpkg":{source:"iana"},"application/vnd.xmpie.plan":{source:"iana"},"application/vnd.xmpie.ppkg":{source:"iana"},"application/vnd.xmpie.xlim":{source:"iana"},"application/vnd.yamaha.hv-dic":{source:"iana",extensions:["hvd"]},"application/vnd.yamaha.hv-script":{source:"iana",extensions:["hvs"]},"application/vnd.yamaha.hv-voice":{source:"iana",extensions:["hvp"]},"application/vnd.yamaha.openscoreformat":{source:"iana",extensions:["osf"]},"application/vnd.yamaha.openscoreformat.osfpvg+xml":{source:"iana",compressible:!0,extensions:["osfpvg"]},"application/vnd.yamaha.remote-setup":{source:"iana"},"application/vnd.yamaha.smaf-audio":{source:"iana",extensions:["saf"]},"application/vnd.yamaha.smaf-phrase":{source:"iana",extensions:["spf"]},"application/vnd.yamaha.through-ngn":{source:"iana"},"application/vnd.yamaha.tunnel-udpencap":{source:"iana"},"application/vnd.yaoweme":{source:"iana"},"application/vnd.yellowriver-custom-menu":{source:"iana",extensions:["cmp"]},"application/vnd.youtube.yt":{source:"iana"},"application/vnd.zul":{source:"iana",extensions:["zir","zirz"]},"application/vnd.zzazz.deck+xml":{source:"iana",compressible:!0,extensions:["zaz"]},"application/voicexml+xml":{source:"iana",compressible:!0,extensions:["vxml"]},"application/voucher-cms+json":{source:"iana",compressible:!0},"application/vq-rtcpxr":{source:"iana"},"application/wasm":{source:"iana",compressible:!0,extensions:["wasm"]},"application/watcherinfo+xml":{source:"iana",compressible:!0,extensions:["wif"]},"application/webpush-options+json":{source:"iana",compressible:!0},"application/whoispp-query":{source:"iana"},"application/whoispp-response":{source:"iana"},"application/widget":{source:"iana",extensions:["wgt"]},"application/winhlp":{source:"apache",extensions:["hlp"]},"application/wita":{source:"iana"},"application/wordperfect5.1":{source:"iana"},"application/wsdl+xml":{source:"iana",compressible:!0,extensions:["wsdl"]},"application/wspolicy+xml":{source:"iana",compressible:!0,extensions:["wspolicy"]},"application/x-7z-compressed":{source:"apache",compressible:!1,extensions:["7z"]},"application/x-abiword":{source:"apache",extensions:["abw"]},"application/x-ace-compressed":{source:"apache",extensions:["ace"]},"application/x-amf":{source:"apache"},"application/x-apple-diskimage":{source:"apache",extensions:["dmg"]},"application/x-arj":{compressible:!1,extensions:["arj"]},"application/x-authorware-bin":{source:"apache",extensions:["aab","x32","u32","vox"]},"application/x-authorware-map":{source:"apache",extensions:["aam"]},"application/x-authorware-seg":{source:"apache",extensions:["aas"]},"application/x-bcpio":{source:"apache",extensions:["bcpio"]},"application/x-bdoc":{compressible:!1,extensions:["bdoc"]},"application/x-bittorrent":{source:"apache",extensions:["torrent"]},"application/x-blorb":{source:"apache",extensions:["blb","blorb"]},"application/x-bzip":{source:"apache",compressible:!1,extensions:["bz"]},"application/x-bzip2":{source:"apache",compressible:!1,extensions:["bz2","boz"]},"application/x-cbr":{source:"apache",extensions:["cbr","cba","cbt","cbz","cb7"]},"application/x-cdlink":{source:"apache",extensions:["vcd"]},"application/x-cfs-compressed":{source:"apache",extensions:["cfs"]},"application/x-chat":{source:"apache",extensions:["chat"]},"application/x-chess-pgn":{source:"apache",extensions:["pgn"]},"application/x-chrome-extension":{extensions:["crx"]},"application/x-cocoa":{source:"nginx",extensions:["cco"]},"application/x-compress":{source:"apache"},"application/x-conference":{source:"apache",extensions:["nsc"]},"application/x-cpio":{source:"apache",extensions:["cpio"]},"application/x-csh":{source:"apache",extensions:["csh"]},"application/x-deb":{compressible:!1},"application/x-debian-package":{source:"apache",extensions:["deb","udeb"]},"application/x-dgc-compressed":{source:"apache",extensions:["dgc"]},"application/x-director":{source:"apache",extensions:["dir","dcr","dxr","cst","cct","cxt","w3d","fgd","swa"]},"application/x-doom":{source:"apache",extensions:["wad"]},"application/x-dtbncx+xml":{source:"apache",compressible:!0,extensions:["ncx"]},"application/x-dtbook+xml":{source:"apache",compressible:!0,extensions:["dtb"]},"application/x-dtbresource+xml":{source:"apache",compressible:!0,extensions:["res"]},"application/x-dvi":{source:"apache",compressible:!1,extensions:["dvi"]},"application/x-envoy":{source:"apache",extensions:["evy"]},"application/x-eva":{source:"apache",extensions:["eva"]},"application/x-font-bdf":{source:"apache",extensions:["bdf"]},"application/x-font-dos":{source:"apache"},"application/x-font-framemaker":{source:"apache"},"application/x-font-ghostscript":{source:"apache",extensions:["gsf"]},"application/x-font-libgrx":{source:"apache"},"application/x-font-linux-psf":{source:"apache",extensions:["psf"]},"application/x-font-pcf":{source:"apache",extensions:["pcf"]},"application/x-font-snf":{source:"apache",extensions:["snf"]},"application/x-font-speedo":{source:"apache"},"application/x-font-sunos-news":{source:"apache"},"application/x-font-type1":{source:"apache",extensions:["pfa","pfb","pfm","afm"]},"application/x-font-vfont":{source:"apache"},"application/x-freearc":{source:"apache",extensions:["arc"]},"application/x-futuresplash":{source:"apache",extensions:["spl"]},"application/x-gca-compressed":{source:"apache",extensions:["gca"]},"application/x-glulx":{source:"apache",extensions:["ulx"]},"application/x-gnumeric":{source:"apache",extensions:["gnumeric"]},"application/x-gramps-xml":{source:"apache",extensions:["gramps"]},"application/x-gtar":{source:"apache",extensions:["gtar"]},"application/x-gzip":{source:"apache"},"application/x-hdf":{source:"apache",extensions:["hdf"]},"application/x-httpd-php":{compressible:!0,extensions:["php"]},"application/x-install-instructions":{source:"apache",extensions:["install"]},"application/x-iso9660-image":{source:"apache",extensions:["iso"]},"application/x-iwork-keynote-sffkey":{extensions:["key"]},"application/x-iwork-numbers-sffnumbers":{extensions:["numbers"]},"application/x-iwork-pages-sffpages":{extensions:["pages"]},"application/x-java-archive-diff":{source:"nginx",extensions:["jardiff"]},"application/x-java-jnlp-file":{source:"apache",compressible:!1,extensions:["jnlp"]},"application/x-javascript":{compressible:!0},"application/x-keepass2":{extensions:["kdbx"]},"application/x-latex":{source:"apache",compressible:!1,extensions:["latex"]},"application/x-lua-bytecode":{extensions:["luac"]},"application/x-lzh-compressed":{source:"apache",extensions:["lzh","lha"]},"application/x-makeself":{source:"nginx",extensions:["run"]},"application/x-mie":{source:"apache",extensions:["mie"]},"application/x-mobipocket-ebook":{source:"apache",extensions:["prc","mobi"]},"application/x-mpegurl":{compressible:!1},"application/x-ms-application":{source:"apache",extensions:["application"]},"application/x-ms-shortcut":{source:"apache",extensions:["lnk"]},"application/x-ms-wmd":{source:"apache",extensions:["wmd"]},"application/x-ms-wmz":{source:"apache",extensions:["wmz"]},"application/x-ms-xbap":{source:"apache",extensions:["xbap"]},"application/x-msaccess":{source:"apache",extensions:["mdb"]},"application/x-msbinder":{source:"apache",extensions:["obd"]},"application/x-mscardfile":{source:"apache",extensions:["crd"]},"application/x-msclip":{source:"apache",extensions:["clp"]},"application/x-msdos-program":{extensions:["exe"]},"application/x-msdownload":{source:"apache",extensions:["exe","dll","com","bat","msi"]},"application/x-msmediaview":{source:"apache",extensions:["mvb","m13","m14"]},"application/x-msmetafile":{source:"apache",extensions:["wmf","wmz","emf","emz"]},"application/x-msmoney":{source:"apache",extensions:["mny"]},"application/x-mspublisher":{source:"apache",extensions:["pub"]},"application/x-msschedule":{source:"apache",extensions:["scd"]},"application/x-msterminal":{source:"apache",extensions:["trm"]},"application/x-mswrite":{source:"apache",extensions:["wri"]},"application/x-netcdf":{source:"apache",extensions:["nc","cdf"]},"application/x-ns-proxy-autoconfig":{compressible:!0,extensions:["pac"]},"application/x-nzb":{source:"apache",extensions:["nzb"]},"application/x-perl":{source:"nginx",extensions:["pl","pm"]},"application/x-pilot":{source:"nginx",extensions:["prc","pdb"]},"application/x-pkcs12":{source:"apache",compressible:!1,extensions:["p12","pfx"]},"application/x-pkcs7-certificates":{source:"apache",extensions:["p7b","spc"]},"application/x-pkcs7-certreqresp":{source:"apache",extensions:["p7r"]},"application/x-pki-message":{source:"iana"},"application/x-rar-compressed":{source:"apache",compressible:!1,extensions:["rar"]},"application/x-redhat-package-manager":{source:"nginx",extensions:["rpm"]},"application/x-research-info-systems":{source:"apache",extensions:["ris"]},"application/x-sea":{source:"nginx",extensions:["sea"]},"application/x-sh":{source:"apache",compressible:!0,extensions:["sh"]},"application/x-shar":{source:"apache",extensions:["shar"]},"application/x-shockwave-flash":{source:"apache",compressible:!1,extensions:["swf"]},"application/x-silverlight-app":{source:"apache",extensions:["xap"]},"application/x-sql":{source:"apache",extensions:["sql"]},"application/x-stuffit":{source:"apache",compressible:!1,extensions:["sit"]},"application/x-stuffitx":{source:"apache",extensions:["sitx"]},"application/x-subrip":{source:"apache",extensions:["srt"]},"application/x-sv4cpio":{source:"apache",extensions:["sv4cpio"]},"application/x-sv4crc":{source:"apache",extensions:["sv4crc"]},"application/x-t3vm-image":{source:"apache",extensions:["t3"]},"application/x-tads":{source:"apache",extensions:["gam"]},"application/x-tar":{source:"apache",compressible:!0,extensions:["tar"]},"application/x-tcl":{source:"apache",extensions:["tcl","tk"]},"application/x-tex":{source:"apache",extensions:["tex"]},"application/x-tex-tfm":{source:"apache",extensions:["tfm"]},"application/x-texinfo":{source:"apache",extensions:["texinfo","texi"]},"application/x-tgif":{source:"apache",extensions:["obj"]},"application/x-ustar":{source:"apache",extensions:["ustar"]},"application/x-virtualbox-hdd":{compressible:!0,extensions:["hdd"]},"application/x-virtualbox-ova":{compressible:!0,extensions:["ova"]},"application/x-virtualbox-ovf":{compressible:!0,extensions:["ovf"]},"application/x-virtualbox-vbox":{compressible:!0,extensions:["vbox"]},"application/x-virtualbox-vbox-extpack":{compressible:!1,extensions:["vbox-extpack"]},"application/x-virtualbox-vdi":{compressible:!0,extensions:["vdi"]},"application/x-virtualbox-vhd":{compressible:!0,extensions:["vhd"]},"application/x-virtualbox-vmdk":{compressible:!0,extensions:["vmdk"]},"application/x-wais-source":{source:"apache",extensions:["src"]},"application/x-web-app-manifest+json":{compressible:!0,extensions:["webapp"]},"application/x-www-form-urlencoded":{source:"iana",compressible:!0},"application/x-x509-ca-cert":{source:"iana",extensions:["der","crt","pem"]},"application/x-x509-ca-ra-cert":{source:"iana"},"application/x-x509-next-ca-cert":{source:"iana"},"application/x-xfig":{source:"apache",extensions:["fig"]},"application/x-xliff+xml":{source:"apache",compressible:!0,extensions:["xlf"]},"application/x-xpinstall":{source:"apache",compressible:!1,extensions:["xpi"]},"application/x-xz":{source:"apache",extensions:["xz"]},"application/x-zmachine":{source:"apache",extensions:["z1","z2","z3","z4","z5","z6","z7","z8"]},"application/x400-bp":{source:"iana"},"application/xacml+xml":{source:"iana",compressible:!0},"application/xaml+xml":{source:"apache",compressible:!0,extensions:["xaml"]},"application/xcap-att+xml":{source:"iana",compressible:!0,extensions:["xav"]},"application/xcap-caps+xml":{source:"iana",compressible:!0,extensions:["xca"]},"application/xcap-diff+xml":{source:"iana",compressible:!0,extensions:["xdf"]},"application/xcap-el+xml":{source:"iana",compressible:!0,extensions:["xel"]},"application/xcap-error+xml":{source:"iana",compressible:!0},"application/xcap-ns+xml":{source:"iana",compressible:!0,extensions:["xns"]},"application/xcon-conference-info+xml":{source:"iana",compressible:!0},"application/xcon-conference-info-diff+xml":{source:"iana",compressible:!0},"application/xenc+xml":{source:"iana",compressible:!0,extensions:["xenc"]},"application/xhtml+xml":{source:"iana",compressible:!0,extensions:["xhtml","xht"]},"application/xhtml-voice+xml":{source:"apache",compressible:!0},"application/xliff+xml":{source:"iana",compressible:!0,extensions:["xlf"]},"application/xml":{source:"iana",compressible:!0,extensions:["xml","xsl","xsd","rng"]},"application/xml-dtd":{source:"iana",compressible:!0,extensions:["dtd"]},"application/xml-external-parsed-entity":{source:"iana"},"application/xml-patch+xml":{source:"iana",compressible:!0},"application/xmpp+xml":{source:"iana",compressible:!0},"application/xop+xml":{source:"iana",compressible:!0,extensions:["xop"]},"application/xproc+xml":{source:"apache",compressible:!0,extensions:["xpl"]},"application/xslt+xml":{source:"iana",compressible:!0,extensions:["xsl","xslt"]},"application/xspf+xml":{source:"apache",compressible:!0,extensions:["xspf"]},"application/xv+xml":{source:"iana",compressible:!0,extensions:["mxml","xhvml","xvml","xvm"]},"application/yang":{source:"iana",extensions:["yang"]},"application/yang-data+json":{source:"iana",compressible:!0},"application/yang-data+xml":{source:"iana",compressible:!0},"application/yang-patch+json":{source:"iana",compressible:!0},"application/yang-patch+xml":{source:"iana",compressible:!0},"application/yin+xml":{source:"iana",compressible:!0,extensions:["yin"]},"application/zip":{source:"iana",compressible:!1,extensions:["zip"]},"application/zlib":{source:"iana"},"application/zstd":{source:"iana"},"audio/1d-interleaved-parityfec":{source:"iana"},"audio/32kadpcm":{source:"iana"},"audio/3gpp":{source:"iana",compressible:!1,extensions:["3gpp"]},"audio/3gpp2":{source:"iana"},"audio/aac":{source:"iana"},"audio/ac3":{source:"iana"},"audio/adpcm":{source:"apache",extensions:["adp"]},"audio/amr":{source:"iana",extensions:["amr"]},"audio/amr-wb":{source:"iana"},"audio/amr-wb+":{source:"iana"},"audio/aptx":{source:"iana"},"audio/asc":{source:"iana"},"audio/atrac-advanced-lossless":{source:"iana"},"audio/atrac-x":{source:"iana"},"audio/atrac3":{source:"iana"},"audio/basic":{source:"iana",compressible:!1,extensions:["au","snd"]},"audio/bv16":{source:"iana"},"audio/bv32":{source:"iana"},"audio/clearmode":{source:"iana"},"audio/cn":{source:"iana"},"audio/dat12":{source:"iana"},"audio/dls":{source:"iana"},"audio/dsr-es201108":{source:"iana"},"audio/dsr-es202050":{source:"iana"},"audio/dsr-es202211":{source:"iana"},"audio/dsr-es202212":{source:"iana"},"audio/dv":{source:"iana"},"audio/dvi4":{source:"iana"},"audio/eac3":{source:"iana"},"audio/encaprtp":{source:"iana"},"audio/evrc":{source:"iana"},"audio/evrc-qcp":{source:"iana"},"audio/evrc0":{source:"iana"},"audio/evrc1":{source:"iana"},"audio/evrcb":{source:"iana"},"audio/evrcb0":{source:"iana"},"audio/evrcb1":{source:"iana"},"audio/evrcnw":{source:"iana"},"audio/evrcnw0":{source:"iana"},"audio/evrcnw1":{source:"iana"},"audio/evrcwb":{source:"iana"},"audio/evrcwb0":{source:"iana"},"audio/evrcwb1":{source:"iana"},"audio/evs":{source:"iana"},"audio/flexfec":{source:"iana"},"audio/fwdred":{source:"iana"},"audio/g711-0":{source:"iana"},"audio/g719":{source:"iana"},"audio/g722":{source:"iana"},"audio/g7221":{source:"iana"},"audio/g723":{source:"iana"},"audio/g726-16":{source:"iana"},"audio/g726-24":{source:"iana"},"audio/g726-32":{source:"iana"},"audio/g726-40":{source:"iana"},"audio/g728":{source:"iana"},"audio/g729":{source:"iana"},"audio/g7291":{source:"iana"},"audio/g729d":{source:"iana"},"audio/g729e":{source:"iana"},"audio/gsm":{source:"iana"},"audio/gsm-efr":{source:"iana"},"audio/gsm-hr-08":{source:"iana"},"audio/ilbc":{source:"iana"},"audio/ip-mr_v2.5":{source:"iana"},"audio/isac":{source:"apache"},"audio/l16":{source:"iana"},"audio/l20":{source:"iana"},"audio/l24":{source:"iana",compressible:!1},"audio/l8":{source:"iana"},"audio/lpc":{source:"iana"},"audio/melp":{source:"iana"},"audio/melp1200":{source:"iana"},"audio/melp2400":{source:"iana"},"audio/melp600":{source:"iana"},"audio/mhas":{source:"iana"},"audio/midi":{source:"apache",extensions:["mid","midi","kar","rmi"]},"audio/mobile-xmf":{source:"iana",extensions:["mxmf"]},"audio/mp3":{compressible:!1,extensions:["mp3"]},"audio/mp4":{source:"iana",compressible:!1,extensions:["m4a","mp4a"]},"audio/mp4a-latm":{source:"iana"},"audio/mpa":{source:"iana"},"audio/mpa-robust":{source:"iana"},"audio/mpeg":{source:"iana",compressible:!1,extensions:["mpga","mp2","mp2a","mp3","m2a","m3a"]},"audio/mpeg4-generic":{source:"iana"},"audio/musepack":{source:"apache"},"audio/ogg":{source:"iana",compressible:!1,extensions:["oga","ogg","spx","opus"]},"audio/opus":{source:"iana"},"audio/parityfec":{source:"iana"},"audio/pcma":{source:"iana"},"audio/pcma-wb":{source:"iana"},"audio/pcmu":{source:"iana"},"audio/pcmu-wb":{source:"iana"},"audio/prs.sid":{source:"iana"},"audio/qcelp":{source:"iana"},"audio/raptorfec":{source:"iana"},"audio/red":{source:"iana"},"audio/rtp-enc-aescm128":{source:"iana"},"audio/rtp-midi":{source:"iana"},"audio/rtploopback":{source:"iana"},"audio/rtx":{source:"iana"},"audio/s3m":{source:"apache",extensions:["s3m"]},"audio/scip":{source:"iana"},"audio/silk":{source:"apache",extensions:["sil"]},"audio/smv":{source:"iana"},"audio/smv-qcp":{source:"iana"},"audio/smv0":{source:"iana"},"audio/sofa":{source:"iana"},"audio/sp-midi":{source:"iana"},"audio/speex":{source:"iana"},"audio/t140c":{source:"iana"},"audio/t38":{source:"iana"},"audio/telephone-event":{source:"iana"},"audio/tetra_acelp":{source:"iana"},"audio/tetra_acelp_bb":{source:"iana"},"audio/tone":{source:"iana"},"audio/tsvcis":{source:"iana"},"audio/uemclip":{source:"iana"},"audio/ulpfec":{source:"iana"},"audio/usac":{source:"iana"},"audio/vdvi":{source:"iana"},"audio/vmr-wb":{source:"iana"},"audio/vnd.3gpp.iufp":{source:"iana"},"audio/vnd.4sb":{source:"iana"},"audio/vnd.audiokoz":{source:"iana"},"audio/vnd.celp":{source:"iana"},"audio/vnd.cisco.nse":{source:"iana"},"audio/vnd.cmles.radio-events":{source:"iana"},"audio/vnd.cns.anp1":{source:"iana"},"audio/vnd.cns.inf1":{source:"iana"},"audio/vnd.dece.audio":{source:"iana",extensions:["uva","uvva"]},"audio/vnd.digital-winds":{source:"iana",extensions:["eol"]},"audio/vnd.dlna.adts":{source:"iana"},"audio/vnd.dolby.heaac.1":{source:"iana"},"audio/vnd.dolby.heaac.2":{source:"iana"},"audio/vnd.dolby.mlp":{source:"iana"},"audio/vnd.dolby.mps":{source:"iana"},"audio/vnd.dolby.pl2":{source:"iana"},"audio/vnd.dolby.pl2x":{source:"iana"},"audio/vnd.dolby.pl2z":{source:"iana"},"audio/vnd.dolby.pulse.1":{source:"iana"},"audio/vnd.dra":{source:"iana",extensions:["dra"]},"audio/vnd.dts":{source:"iana",extensions:["dts"]},"audio/vnd.dts.hd":{source:"iana",extensions:["dtshd"]},"audio/vnd.dts.uhd":{source:"iana"},"audio/vnd.dvb.file":{source:"iana"},"audio/vnd.everad.plj":{source:"iana"},"audio/vnd.hns.audio":{source:"iana"},"audio/vnd.lucent.voice":{source:"iana",extensions:["lvp"]},"audio/vnd.ms-playready.media.pya":{source:"iana",extensions:["pya"]},"audio/vnd.nokia.mobile-xmf":{source:"iana"},"audio/vnd.nortel.vbk":{source:"iana"},"audio/vnd.nuera.ecelp4800":{source:"iana",extensions:["ecelp4800"]},"audio/vnd.nuera.ecelp7470":{source:"iana",extensions:["ecelp7470"]},"audio/vnd.nuera.ecelp9600":{source:"iana",extensions:["ecelp9600"]},"audio/vnd.octel.sbc":{source:"iana"},"audio/vnd.presonus.multitrack":{source:"iana"},"audio/vnd.qcelp":{source:"iana"},"audio/vnd.rhetorex.32kadpcm":{source:"iana"},"audio/vnd.rip":{source:"iana",extensions:["rip"]},"audio/vnd.rn-realaudio":{compressible:!1},"audio/vnd.sealedmedia.softseal.mpeg":{source:"iana"},"audio/vnd.vmx.cvsd":{source:"iana"},"audio/vnd.wave":{compressible:!1},"audio/vorbis":{source:"iana",compressible:!1},"audio/vorbis-config":{source:"iana"},"audio/wav":{compressible:!1,extensions:["wav"]},"audio/wave":{compressible:!1,extensions:["wav"]},"audio/webm":{source:"apache",compressible:!1,extensions:["weba"]},"audio/x-aac":{source:"apache",compressible:!1,extensions:["aac"]},"audio/x-aiff":{source:"apache",extensions:["aif","aiff","aifc"]},"audio/x-caf":{source:"apache",compressible:!1,extensions:["caf"]},"audio/x-flac":{source:"apache",extensions:["flac"]},"audio/x-m4a":{source:"nginx",extensions:["m4a"]},"audio/x-matroska":{source:"apache",extensions:["mka"]},"audio/x-mpegurl":{source:"apache",extensions:["m3u"]},"audio/x-ms-wax":{source:"apache",extensions:["wax"]},"audio/x-ms-wma":{source:"apache",extensions:["wma"]},"audio/x-pn-realaudio":{source:"apache",extensions:["ram","ra"]},"audio/x-pn-realaudio-plugin":{source:"apache",extensions:["rmp"]},"audio/x-realaudio":{source:"nginx",extensions:["ra"]},"audio/x-tta":{source:"apache"},"audio/x-wav":{source:"apache",extensions:["wav"]},"audio/xm":{source:"apache",extensions:["xm"]},"chemical/x-cdx":{source:"apache",extensions:["cdx"]},"chemical/x-cif":{source:"apache",extensions:["cif"]},"chemical/x-cmdf":{source:"apache",extensions:["cmdf"]},"chemical/x-cml":{source:"apache",extensions:["cml"]},"chemical/x-csml":{source:"apache",extensions:["csml"]},"chemical/x-pdb":{source:"apache"},"chemical/x-xyz":{source:"apache",extensions:["xyz"]},"font/collection":{source:"iana",extensions:["ttc"]},"font/otf":{source:"iana",compressible:!0,extensions:["otf"]},"font/sfnt":{source:"iana"},"font/ttf":{source:"iana",compressible:!0,extensions:["ttf"]},"font/woff":{source:"iana",extensions:["woff"]},"font/woff2":{source:"iana",extensions:["woff2"]},"image/aces":{source:"iana",extensions:["exr"]},"image/apng":{compressible:!1,extensions:["apng"]},"image/avci":{source:"iana",extensions:["avci"]},"image/avcs":{source:"iana",extensions:["avcs"]},"image/avif":{source:"iana",compressible:!1,extensions:["avif"]},"image/bmp":{source:"iana",compressible:!0,extensions:["bmp"]},"image/cgm":{source:"iana",extensions:["cgm"]},"image/dicom-rle":{source:"iana",extensions:["drle"]},"image/emf":{source:"iana",extensions:["emf"]},"image/fits":{source:"iana",extensions:["fits"]},"image/g3fax":{source:"iana",extensions:["g3"]},"image/gif":{source:"iana",compressible:!1,extensions:["gif"]},"image/heic":{source:"iana",extensions:["heic"]},"image/heic-sequence":{source:"iana",extensions:["heics"]},"image/heif":{source:"iana",extensions:["heif"]},"image/heif-sequence":{source:"iana",extensions:["heifs"]},"image/hej2k":{source:"iana",extensions:["hej2"]},"image/hsj2":{source:"iana",extensions:["hsj2"]},"image/ief":{source:"iana",extensions:["ief"]},"image/jls":{source:"iana",extensions:["jls"]},"image/jp2":{source:"iana",compressible:!1,extensions:["jp2","jpg2"]},"image/jpeg":{source:"iana",compressible:!1,extensions:["jpeg","jpg","jpe"]},"image/jph":{source:"iana",extensions:["jph"]},"image/jphc":{source:"iana",extensions:["jhc"]},"image/jpm":{source:"iana",compressible:!1,extensions:["jpm"]},"image/jpx":{source:"iana",compressible:!1,extensions:["jpx","jpf"]},"image/jxr":{source:"iana",extensions:["jxr"]},"image/jxra":{source:"iana",extensions:["jxra"]},"image/jxrs":{source:"iana",extensions:["jxrs"]},"image/jxs":{source:"iana",extensions:["jxs"]},"image/jxsc":{source:"iana",extensions:["jxsc"]},"image/jxsi":{source:"iana",extensions:["jxsi"]},"image/jxss":{source:"iana",extensions:["jxss"]},"image/ktx":{source:"iana",extensions:["ktx"]},"image/ktx2":{source:"iana",extensions:["ktx2"]},"image/naplps":{source:"iana"},"image/pjpeg":{compressible:!1},"image/png":{source:"iana",compressible:!1,extensions:["png"]},"image/prs.btif":{source:"iana",extensions:["btif"]},"image/prs.pti":{source:"iana",extensions:["pti"]},"image/pwg-raster":{source:"iana"},"image/sgi":{source:"apache",extensions:["sgi"]},"image/svg+xml":{source:"iana",compressible:!0,extensions:["svg","svgz"]},"image/t38":{source:"iana",extensions:["t38"]},"image/tiff":{source:"iana",compressible:!1,extensions:["tif","tiff"]},"image/tiff-fx":{source:"iana",extensions:["tfx"]},"image/vnd.adobe.photoshop":{source:"iana",compressible:!0,extensions:["psd"]},"image/vnd.airzip.accelerator.azv":{source:"iana",extensions:["azv"]},"image/vnd.cns.inf2":{source:"iana"},"image/vnd.dece.graphic":{source:"iana",extensions:["uvi","uvvi","uvg","uvvg"]},"image/vnd.djvu":{source:"iana",extensions:["djvu","djv"]},"image/vnd.dvb.subtitle":{source:"iana",extensions:["sub"]},"image/vnd.dwg":{source:"iana",extensions:["dwg"]},"image/vnd.dxf":{source:"iana",extensions:["dxf"]},"image/vnd.fastbidsheet":{source:"iana",extensions:["fbs"]},"image/vnd.fpx":{source:"iana",extensions:["fpx"]},"image/vnd.fst":{source:"iana",extensions:["fst"]},"image/vnd.fujixerox.edmics-mmr":{source:"iana",extensions:["mmr"]},"image/vnd.fujixerox.edmics-rlc":{source:"iana",extensions:["rlc"]},"image/vnd.globalgraphics.pgb":{source:"iana"},"image/vnd.microsoft.icon":{source:"iana",compressible:!0,extensions:["ico"]},"image/vnd.mix":{source:"iana"},"image/vnd.mozilla.apng":{source:"iana"},"image/vnd.ms-dds":{compressible:!0,extensions:["dds"]},"image/vnd.ms-modi":{source:"iana",extensions:["mdi"]},"image/vnd.ms-photo":{source:"apache",extensions:["wdp"]},"image/vnd.net-fpx":{source:"iana",extensions:["npx"]},"image/vnd.pco.b16":{source:"iana",extensions:["b16"]},"image/vnd.radiance":{source:"iana"},"image/vnd.sealed.png":{source:"iana"},"image/vnd.sealedmedia.softseal.gif":{source:"iana"},"image/vnd.sealedmedia.softseal.jpg":{source:"iana"},"image/vnd.svf":{source:"iana"},"image/vnd.tencent.tap":{source:"iana",extensions:["tap"]},"image/vnd.valve.source.texture":{source:"iana",extensions:["vtf"]},"image/vnd.wap.wbmp":{source:"iana",extensions:["wbmp"]},"image/vnd.xiff":{source:"iana",extensions:["xif"]},"image/vnd.zbrush.pcx":{source:"iana",extensions:["pcx"]},"image/webp":{source:"apache",extensions:["webp"]},"image/wmf":{source:"iana",extensions:["wmf"]},"image/x-3ds":{source:"apache",extensions:["3ds"]},"image/x-cmu-raster":{source:"apache",extensions:["ras"]},"image/x-cmx":{source:"apache",extensions:["cmx"]},"image/x-freehand":{source:"apache",extensions:["fh","fhc","fh4","fh5","fh7"]},"image/x-icon":{source:"apache",compressible:!0,extensions:["ico"]},"image/x-jng":{source:"nginx",extensions:["jng"]},"image/x-mrsid-image":{source:"apache",extensions:["sid"]},"image/x-ms-bmp":{source:"nginx",compressible:!0,extensions:["bmp"]},"image/x-pcx":{source:"apache",extensions:["pcx"]},"image/x-pict":{source:"apache",extensions:["pic","pct"]},"image/x-portable-anymap":{source:"apache",extensions:["pnm"]},"image/x-portable-bitmap":{source:"apache",extensions:["pbm"]},"image/x-portable-graymap":{source:"apache",extensions:["pgm"]},"image/x-portable-pixmap":{source:"apache",extensions:["ppm"]},"image/x-rgb":{source:"apache",extensions:["rgb"]},"image/x-tga":{source:"apache",extensions:["tga"]},"image/x-xbitmap":{source:"apache",extensions:["xbm"]},"image/x-xcf":{compressible:!1},"image/x-xpixmap":{source:"apache",extensions:["xpm"]},"image/x-xwindowdump":{source:"apache",extensions:["xwd"]},"message/cpim":{source:"iana"},"message/delivery-status":{source:"iana"},"message/disposition-notification":{source:"iana",extensions:["disposition-notification"]},"message/external-body":{source:"iana"},"message/feedback-report":{source:"iana"},"message/global":{source:"iana",extensions:["u8msg"]},"message/global-delivery-status":{source:"iana",extensions:["u8dsn"]},"message/global-disposition-notification":{source:"iana",extensions:["u8mdn"]},"message/global-headers":{source:"iana",extensions:["u8hdr"]},"message/http":{source:"iana",compressible:!1},"message/imdn+xml":{source:"iana",compressible:!0},"message/news":{source:"iana"},"message/partial":{source:"iana",compressible:!1},"message/rfc822":{source:"iana",compressible:!0,extensions:["eml","mime"]},"message/s-http":{source:"iana"},"message/sip":{source:"iana"},"message/sipfrag":{source:"iana"},"message/tracking-status":{source:"iana"},"message/vnd.si.simp":{source:"iana"},"message/vnd.wfa.wsc":{source:"iana",extensions:["wsc"]},"model/3mf":{source:"iana",extensions:["3mf"]},"model/e57":{source:"iana"},"model/gltf+json":{source:"iana",compressible:!0,extensions:["gltf"]},"model/gltf-binary":{source:"iana",compressible:!0,extensions:["glb"]},"model/iges":{source:"iana",compressible:!1,extensions:["igs","iges"]},"model/mesh":{source:"iana",compressible:!1,extensions:["msh","mesh","silo"]},"model/mtl":{source:"iana",extensions:["mtl"]},"model/obj":{source:"iana",extensions:["obj"]},"model/step":{source:"iana"},"model/step+xml":{source:"iana",compressible:!0,extensions:["stpx"]},"model/step+zip":{source:"iana",compressible:!1,extensions:["stpz"]},"model/step-xml+zip":{source:"iana",compressible:!1,extensions:["stpxz"]},"model/stl":{source:"iana",extensions:["stl"]},"model/vnd.collada+xml":{source:"iana",compressible:!0,extensions:["dae"]},"model/vnd.dwf":{source:"iana",extensions:["dwf"]},"model/vnd.flatland.3dml":{source:"iana"},"model/vnd.gdl":{source:"iana",extensions:["gdl"]},"model/vnd.gs-gdl":{source:"apache"},"model/vnd.gs.gdl":{source:"iana"},"model/vnd.gtw":{source:"iana",extensions:["gtw"]},"model/vnd.moml+xml":{source:"iana",compressible:!0},"model/vnd.mts":{source:"iana",extensions:["mts"]},"model/vnd.opengex":{source:"iana",extensions:["ogex"]},"model/vnd.parasolid.transmit.binary":{source:"iana",extensions:["x_b"]},"model/vnd.parasolid.transmit.text":{source:"iana",extensions:["x_t"]},"model/vnd.pytha.pyox":{source:"iana"},"model/vnd.rosette.annotated-data-model":{source:"iana"},"model/vnd.sap.vds":{source:"iana",extensions:["vds"]},"model/vnd.usdz+zip":{source:"iana",compressible:!1,extensions:["usdz"]},"model/vnd.valve.source.compiled-map":{source:"iana",extensions:["bsp"]},"model/vnd.vtu":{source:"iana",extensions:["vtu"]},"model/vrml":{source:"iana",compressible:!1,extensions:["wrl","vrml"]},"model/x3d+binary":{source:"apache",compressible:!1,extensions:["x3db","x3dbz"]},"model/x3d+fastinfoset":{source:"iana",extensions:["x3db"]},"model/x3d+vrml":{source:"apache",compressible:!1,extensions:["x3dv","x3dvz"]},"model/x3d+xml":{source:"iana",compressible:!0,extensions:["x3d","x3dz"]},"model/x3d-vrml":{source:"iana",extensions:["x3dv"]},"multipart/alternative":{source:"iana",compressible:!1},"multipart/appledouble":{source:"iana"},"multipart/byteranges":{source:"iana"},"multipart/digest":{source:"iana"},"multipart/encrypted":{source:"iana",compressible:!1},"multipart/form-data":{source:"iana",compressible:!1},"multipart/header-set":{source:"iana"},"multipart/mixed":{source:"iana"},"multipart/multilingual":{source:"iana"},"multipart/parallel":{source:"iana"},"multipart/related":{source:"iana",compressible:!1},"multipart/report":{source:"iana"},"multipart/signed":{source:"iana",compressible:!1},"multipart/vnd.bint.med-plus":{source:"iana"},"multipart/voice-message":{source:"iana"},"multipart/x-mixed-replace":{source:"iana"},"text/1d-interleaved-parityfec":{source:"iana"},"text/cache-manifest":{source:"iana",compressible:!0,extensions:["appcache","manifest"]},"text/calendar":{source:"iana",extensions:["ics","ifb"]},"text/calender":{compressible:!0},"text/cmd":{compressible:!0},"text/coffeescript":{extensions:["coffee","litcoffee"]},"text/cql":{source:"iana"},"text/cql-expression":{source:"iana"},"text/cql-identifier":{source:"iana"},"text/css":{source:"iana",charset:"UTF-8",compressible:!0,extensions:["css"]},"text/csv":{source:"iana",compressible:!0,extensions:["csv"]},"text/csv-schema":{source:"iana"},"text/directory":{source:"iana"},"text/dns":{source:"iana"},"text/ecmascript":{source:"iana"},"text/encaprtp":{source:"iana"},"text/enriched":{source:"iana"},"text/fhirpath":{source:"iana"},"text/flexfec":{source:"iana"},"text/fwdred":{source:"iana"},"text/gff3":{source:"iana"},"text/grammar-ref-list":{source:"iana"},"text/html":{source:"iana",compressible:!0,extensions:["html","htm","shtml"]},"text/jade":{extensions:["jade"]},"text/javascript":{source:"iana",compressible:!0},"text/jcr-cnd":{source:"iana"},"text/jsx":{compressible:!0,extensions:["jsx"]},"text/less":{compressible:!0,extensions:["less"]},"text/markdown":{source:"iana",compressible:!0,extensions:["markdown","md"]},"text/mathml":{source:"nginx",extensions:["mml"]},"text/mdx":{compressible:!0,extensions:["mdx"]},"text/mizar":{source:"iana"},"text/n3":{source:"iana",charset:"UTF-8",compressible:!0,extensions:["n3"]},"text/parameters":{source:"iana",charset:"UTF-8"},"text/parityfec":{source:"iana"},"text/plain":{source:"iana",compressible:!0,extensions:["txt","text","conf","def","list","log","in","ini"]},"text/provenance-notation":{source:"iana",charset:"UTF-8"},"text/prs.fallenstein.rst":{source:"iana"},"text/prs.lines.tag":{source:"iana",extensions:["dsc"]},"text/prs.prop.logic":{source:"iana"},"text/raptorfec":{source:"iana"},"text/red":{source:"iana"},"text/rfc822-headers":{source:"iana"},"text/richtext":{source:"iana",compressible:!0,extensions:["rtx"]},"text/rtf":{source:"iana",compressible:!0,extensions:["rtf"]},"text/rtp-enc-aescm128":{source:"iana"},"text/rtploopback":{source:"iana"},"text/rtx":{source:"iana"},"text/sgml":{source:"iana",extensions:["sgml","sgm"]},"text/shaclc":{source:"iana"},"text/shex":{source:"iana",extensions:["shex"]},"text/slim":{extensions:["slim","slm"]},"text/spdx":{source:"iana",extensions:["spdx"]},"text/strings":{source:"iana"},"text/stylus":{extensions:["stylus","styl"]},"text/t140":{source:"iana"},"text/tab-separated-values":{source:"iana",compressible:!0,extensions:["tsv"]},"text/troff":{source:"iana",extensions:["t","tr","roff","man","me","ms"]},"text/turtle":{source:"iana",charset:"UTF-8",extensions:["ttl"]},"text/ulpfec":{source:"iana"},"text/uri-list":{source:"iana",compressible:!0,extensions:["uri","uris","urls"]},"text/vcard":{source:"iana",compressible:!0,extensions:["vcard"]},"text/vnd.a":{source:"iana"},"text/vnd.abc":{source:"iana"},"text/vnd.ascii-art":{source:"iana"},"text/vnd.curl":{source:"iana",extensions:["curl"]},"text/vnd.curl.dcurl":{source:"apache",extensions:["dcurl"]},"text/vnd.curl.mcurl":{source:"apache",extensions:["mcurl"]},"text/vnd.curl.scurl":{source:"apache",extensions:["scurl"]},"text/vnd.debian.copyright":{source:"iana",charset:"UTF-8"},"text/vnd.dmclientscript":{source:"iana"},"text/vnd.dvb.subtitle":{source:"iana",extensions:["sub"]},"text/vnd.esmertec.theme-descriptor":{source:"iana",charset:"UTF-8"},"text/vnd.familysearch.gedcom":{source:"iana",extensions:["ged"]},"text/vnd.ficlab.flt":{source:"iana"},"text/vnd.fly":{source:"iana",extensions:["fly"]},"text/vnd.fmi.flexstor":{source:"iana",extensions:["flx"]},"text/vnd.gml":{source:"iana"},"text/vnd.graphviz":{source:"iana",extensions:["gv"]},"text/vnd.hans":{source:"iana"},"text/vnd.hgl":{source:"iana"},"text/vnd.in3d.3dml":{source:"iana",extensions:["3dml"]},"text/vnd.in3d.spot":{source:"iana",extensions:["spot"]},"text/vnd.iptc.newsml":{source:"iana"},"text/vnd.iptc.nitf":{source:"iana"},"text/vnd.latex-z":{source:"iana"},"text/vnd.motorola.reflex":{source:"iana"},"text/vnd.ms-mediapackage":{source:"iana"},"text/vnd.net2phone.commcenter.command":{source:"iana"},"text/vnd.radisys.msml-basic-layout":{source:"iana"},"text/vnd.senx.warpscript":{source:"iana"},"text/vnd.si.uricatalogue":{source:"iana"},"text/vnd.sosi":{source:"iana"},"text/vnd.sun.j2me.app-descriptor":{source:"iana",charset:"UTF-8",extensions:["jad"]},"text/vnd.trolltech.linguist":{source:"iana",charset:"UTF-8"},"text/vnd.wap.si":{source:"iana"},"text/vnd.wap.sl":{source:"iana"},"text/vnd.wap.wml":{source:"iana",extensions:["wml"]},"text/vnd.wap.wmlscript":{source:"iana",extensions:["wmls"]},"text/vtt":{source:"iana",charset:"UTF-8",compressible:!0,extensions:["vtt"]},"text/x-asm":{source:"apache",extensions:["s","asm"]},"text/x-c":{source:"apache",extensions:["c","cc","cxx","cpp","h","hh","dic"]},"text/x-component":{source:"nginx",extensions:["htc"]},"text/x-fortran":{source:"apache",extensions:["f","for","f77","f90"]},"text/x-gwt-rpc":{compressible:!0},"text/x-handlebars-template":{extensions:["hbs"]},"text/x-java-source":{source:"apache",extensions:["java"]},"text/x-jquery-tmpl":{compressible:!0},"text/x-lua":{extensions:["lua"]},"text/x-markdown":{compressible:!0,extensions:["mkd"]},"text/x-nfo":{source:"apache",extensions:["nfo"]},"text/x-opml":{source:"apache",extensions:["opml"]},"text/x-org":{compressible:!0,extensions:["org"]},"text/x-pascal":{source:"apache",extensions:["p","pas"]},"text/x-processing":{compressible:!0,extensions:["pde"]},"text/x-sass":{extensions:["sass"]},"text/x-scss":{extensions:["scss"]},"text/x-setext":{source:"apache",extensions:["etx"]},"text/x-sfv":{source:"apache",extensions:["sfv"]},"text/x-suse-ymp":{compressible:!0,extensions:["ymp"]},"text/x-uuencode":{source:"apache",extensions:["uu"]},"text/x-vcalendar":{source:"apache",extensions:["vcs"]},"text/x-vcard":{source:"apache",extensions:["vcf"]},"text/xml":{source:"iana",compressible:!0,extensions:["xml"]},"text/xml-external-parsed-entity":{source:"iana"},"text/yaml":{compressible:!0,extensions:["yaml","yml"]},"video/1d-interleaved-parityfec":{source:"iana"},"video/3gpp":{source:"iana",extensions:["3gp","3gpp"]},"video/3gpp-tt":{source:"iana"},"video/3gpp2":{source:"iana",extensions:["3g2"]},"video/av1":{source:"iana"},"video/bmpeg":{source:"iana"},"video/bt656":{source:"iana"},"video/celb":{source:"iana"},"video/dv":{source:"iana"},"video/encaprtp":{source:"iana"},"video/ffv1":{source:"iana"},"video/flexfec":{source:"iana"},"video/h261":{source:"iana",extensions:["h261"]},"video/h263":{source:"iana",extensions:["h263"]},"video/h263-1998":{source:"iana"},"video/h263-2000":{source:"iana"},"video/h264":{source:"iana",extensions:["h264"]},"video/h264-rcdo":{source:"iana"},"video/h264-svc":{source:"iana"},"video/h265":{source:"iana"},"video/iso.segment":{source:"iana",extensions:["m4s"]},"video/jpeg":{source:"iana",extensions:["jpgv"]},"video/jpeg2000":{source:"iana"},"video/jpm":{source:"apache",extensions:["jpm","jpgm"]},"video/jxsv":{source:"iana"},"video/mj2":{source:"iana",extensions:["mj2","mjp2"]},"video/mp1s":{source:"iana"},"video/mp2p":{source:"iana"},"video/mp2t":{source:"iana",extensions:["ts"]},"video/mp4":{source:"iana",compressible:!1,extensions:["mp4","mp4v","mpg4"]},"video/mp4v-es":{source:"iana"},"video/mpeg":{source:"iana",compressible:!1,extensions:["mpeg","mpg","mpe","m1v","m2v"]},"video/mpeg4-generic":{source:"iana"},"video/mpv":{source:"iana"},"video/nv":{source:"iana"},"video/ogg":{source:"iana",compressible:!1,extensions:["ogv"]},"video/parityfec":{source:"iana"},"video/pointer":{source:"iana"},"video/quicktime":{source:"iana",compressible:!1,extensions:["qt","mov"]},"video/raptorfec":{source:"iana"},"video/raw":{source:"iana"},"video/rtp-enc-aescm128":{source:"iana"},"video/rtploopback":{source:"iana"},"video/rtx":{source:"iana"},"video/scip":{source:"iana"},"video/smpte291":{source:"iana"},"video/smpte292m":{source:"iana"},"video/ulpfec":{source:"iana"},"video/vc1":{source:"iana"},"video/vc2":{source:"iana"},"video/vnd.cctv":{source:"iana"},"video/vnd.dece.hd":{source:"iana",extensions:["uvh","uvvh"]},"video/vnd.dece.mobile":{source:"iana",extensions:["uvm","uvvm"]},"video/vnd.dece.mp4":{source:"iana"},"video/vnd.dece.pd":{source:"iana",extensions:["uvp","uvvp"]},"video/vnd.dece.sd":{source:"iana",extensions:["uvs","uvvs"]},"video/vnd.dece.video":{source:"iana",extensions:["uvv","uvvv"]},"video/vnd.directv.mpeg":{source:"iana"},"video/vnd.directv.mpeg-tts":{source:"iana"},"video/vnd.dlna.mpeg-tts":{source:"iana"},"video/vnd.dvb.file":{source:"iana",extensions:["dvb"]},"video/vnd.fvt":{source:"iana",extensions:["fvt"]},"video/vnd.hns.video":{source:"iana"},"video/vnd.iptvforum.1dparityfec-1010":{source:"iana"},"video/vnd.iptvforum.1dparityfec-2005":{source:"iana"},"video/vnd.iptvforum.2dparityfec-1010":{source:"iana"},"video/vnd.iptvforum.2dparityfec-2005":{source:"iana"},"video/vnd.iptvforum.ttsavc":{source:"iana"},"video/vnd.iptvforum.ttsmpeg2":{source:"iana"},"video/vnd.motorola.video":{source:"iana"},"video/vnd.motorola.videop":{source:"iana"},"video/vnd.mpegurl":{source:"iana",extensions:["mxu","m4u"]},"video/vnd.ms-playready.media.pyv":{source:"iana",extensions:["pyv"]},"video/vnd.nokia.interleaved-multimedia":{source:"iana"},"video/vnd.nokia.mp4vr":{source:"iana"},"video/vnd.nokia.videovoip":{source:"iana"},"video/vnd.objectvideo":{source:"iana"},"video/vnd.radgamettools.bink":{source:"iana"},"video/vnd.radgamettools.smacker":{source:"iana"},"video/vnd.sealed.mpeg1":{source:"iana"},"video/vnd.sealed.mpeg4":{source:"iana"},"video/vnd.sealed.swf":{source:"iana"},"video/vnd.sealedmedia.softseal.mov":{source:"iana"},"video/vnd.uvvu.mp4":{source:"iana",extensions:["uvu","uvvu"]},"video/vnd.vivo":{source:"iana",extensions:["viv"]},"video/vnd.youtube.yt":{source:"iana"},"video/vp8":{source:"iana"},"video/vp9":{source:"iana"},"video/webm":{source:"apache",compressible:!1,extensions:["webm"]},"video/x-f4v":{source:"apache",extensions:["f4v"]},"video/x-fli":{source:"apache",extensions:["fli"]},"video/x-flv":{source:"apache",compressible:!1,extensions:["flv"]},"video/x-m4v":{source:"apache",extensions:["m4v"]},"video/x-matroska":{source:"apache",compressible:!1,extensions:["mkv","mk3d","mks"]},"video/x-mng":{source:"apache",extensions:["mng"]},"video/x-ms-asf":{source:"apache",extensions:["asf","asx"]},"video/x-ms-vob":{source:"apache",extensions:["vob"]},"video/x-ms-wm":{source:"apache",extensions:["wm"]},"video/x-ms-wmv":{source:"apache",compressible:!1,extensions:["wmv"]},"video/x-ms-wmx":{source:"apache",extensions:["wmx"]},"video/x-ms-wvx":{source:"apache",extensions:["wvx"]},"video/x-msvideo":{source:"apache",extensions:["avi"]},"video/x-sgi-movie":{source:"apache",extensions:["movie"]},"video/x-smv":{source:"apache",extensions:["smv"]},"x-conference/x-cooltalk":{source:"apache",extensions:["ice"]},"x-shader/x-fragment":{compressible:!0},"x-shader/x-vertex":{compressible:!0}}});var SM=C((eo)=>{/*!
 * mime-types
 * Copyright(c) 2014 Jonathan Ong
 * Copyright(c) 2015 Douglas Christopher Wilson
 * MIT Licensed
 */var h9=vM(),no=Q0("path").extname,DM=/^\s*([^;\s]*)(?:;|\s|$)/,oo=/^text\//i;eo.charset=jM;eo.charsets={lookup:jM};eo.contentType=ao;eo.extension=so;eo.extensions=Object.create(null);eo.lookup=ro;eo.types=Object.create(null);to(eo.extensions,eo.types);function jM(Y){if(!Y||typeof Y!=="string")return!1;var X=DM.exec(Y),J=X&&h9[X[1].toLowerCase()];if(J&&J.charset)return J.charset;if(X&&oo.test(X[1]))return"UTF-8";return!1}function ao(Y){if(!Y||typeof Y!=="string")return!1;var X=Y.indexOf("/")===-1?eo.lookup(Y):Y;if(!X)return!1;if(X.indexOf("charset")===-1){var J=eo.charset(X);if(J)X+="; charset="+J.toLowerCase()}return X}function so(Y){if(!Y||typeof Y!=="string")return!1;var X=DM.exec(Y),J=X&&eo.extensions[X[1].toLowerCase()];if(!J||!J.length)return!1;return J[0]}function ro(Y){if(!Y||typeof Y!=="string")return!1;var X=no("x."+Y).toLowerCase().substr(1);if(!X)return!1;return eo.types[X]||!1}function to(Y,X){var J=["nginx","apache",void 0,"iana"];Object.keys(h9).forEach(function(Q){var G=h9[Q],Z=G.extensions;if(!Z||!Z.length)return;Y[Q]=Z;for(var $=0;$<Z.length;$++){var H=Z[$];if(X[H]){var W=J.indexOf(h9[X[H]].source),K=J.indexOf(G.source);if(X[H]!=="application/octet-stream"&&(W>K||W===K&&X[H].substr(0,12)==="application/"))continue}X[H]=Q}})}});var _M=C((dW0,kM)=>{kM.exports=za;function za(Y){var X=typeof setImmediate=="function"?setImmediate:typeof process=="object"&&typeof process.nextTick=="function"?process.nextTick:null;if(X)X(Y);else setTimeout(Y,0)}});var Fz=C((lW0,RM)=>{var bM=_M();RM.exports=Qa;function Qa(Y){var X=!1;return bM(function(){X=!0}),function(z,Q){if(X)Y(z,Q);else bM(function(){Y(z,Q)})}}});var Pz=C((iW0,fM)=>{fM.exports=Ga;function Ga(Y){Object.keys(Y.jobs).forEach(Za.bind(Y)),Y.jobs={}}function Za(Y){if(typeof this.jobs[Y]=="function")this.jobs[Y]()}});var Az=C((nW0,hM)=>{var yM=Fz(),$a=Pz();hM.exports=Ha;function Ha(Y,X,J,z){var Q=J.keyedList?J.keyedList[J.index]:J.index;J.jobs[Q]=Wa(X,Q,Y[Q],function(G,Z){if(!(Q in J.jobs))return;if(delete J.jobs[Q],G)$a(J);else J.results[Q]=Z;z(G,J.results)})}function Wa(Y,X,J,z){var Q;if(Y.length==2)Q=Y(J,yM(z));else Q=Y(J,X,yM(z));return Q}});var wz=C((oW0,mM)=>{mM.exports=Ka;function Ka(Y,X){var J=!Array.isArray(Y),z={index:0,keyedList:J||X?Object.keys(Y):null,jobs:{},results:J?{}:[],size:J?Object.keys(Y).length:Y.length};if(X)z.keyedList.sort(J?X:function(Q,G){return X(Y[Q],Y[G])});return z}});var Tz=C((aW0,uM)=>{var Ua=Pz(),Ba=Fz();uM.exports=Va;function Va(Y){if(!Object.keys(this.jobs).length)return;this.index=this.size,Ua(this),Ba(Y)(null,this.results)}});var pM=C((sW0,gM)=>{var Oa=Az(),Ma=wz(),La=Tz();gM.exports=Na;function Na(Y,X,J){var z=Ma(Y);while(z.index<(z.keyedList||Y).length)Oa(Y,X,z,function(Q,G){if(Q){J(Q,G);return}if(Object.keys(z.jobs).length===0){J(null,z.results);return}}),z.index++;return La.bind(z,J)}});var Iz=C((rW0,m9)=>{var cM=Az(),qa=wz(),xa=Tz();m9.exports=Fa;m9.exports.ascending=dM;m9.exports.descending=Pa;function Fa(Y,X,J,z){var Q=qa(Y,J);return cM(Y,X,Q,function G(Z,$){if(Z){z(Z,$);return}if(Q.index++,Q.index<(Q.keyedList||Y).length){cM(Y,X,Q,G);return}z(null,Q.results)}),xa.bind(Q,z)}function dM(Y,X){return Y<X?-1:Y>X?1:0}function Pa(Y,X){return-1*dM(Y,X)}});var iM=C((tW0,lM)=>{var Aa=Iz();lM.exports=wa;function wa(Y,X,J){return Aa(Y,X,null,J)}});var oM=C((eW0,nM)=>{nM.exports={parallel:pM(),serial:iM(),serialOrdered:Iz()}});var vz=C((YK0,aM)=>{aM.exports=Object});var rM=C((XK0,sM)=>{sM.exports=Error});var eM=C((JK0,tM)=>{tM.exports=EvalError});var XL=C((zK0,YL)=>{YL.exports=RangeError});var zL=C((QK0,JL)=>{JL.exports=ReferenceError});var GL=C((GK0,QL)=>{QL.exports=SyntaxError});var u9=C((ZK0,ZL)=>{ZL.exports=TypeError});var HL=C(($K0,$L)=>{$L.exports=URIError});var KL=C((HK0,WL)=>{WL.exports=Math.abs});var BL=C((WK0,UL)=>{UL.exports=Math.floor});var OL=C((KK0,VL)=>{VL.exports=Math.max});var LL=C((UK0,ML)=>{ML.exports=Math.min});var qL=C((BK0,NL)=>{NL.exports=Math.pow});var FL=C((VK0,xL)=>{xL.exports=Math.round});var AL=C((OK0,PL)=>{PL.exports=Number.isNaN||function(X){return X!==X}});var TL=C((MK0,wL)=>{var Ta=AL();wL.exports=function(X){if(Ta(X)||X===0)return X;return X<0?-1:1}});var vL=C((LK0,IL)=>{IL.exports=Object.getOwnPropertyDescriptor});var Dz=C((NK0,DL)=>{var g9=vL();if(g9)try{g9([],"length")}catch(Y){g9=null}DL.exports=g9});var CL=C((qK0,jL)=>{var p9=Object.defineProperty||!1;if(p9)try{p9({},"a",{value:1})}catch(Y){p9=!1}jL.exports=p9});var jz=C((xK0,EL)=>{EL.exports=function(){if(typeof Symbol!=="function"||typeof Object.getOwnPropertySymbols!=="function")return!1;if(typeof Symbol.iterator==="symbol")return!0;var X={},J=Symbol("test"),z=Object(J);if(typeof J==="string")return!1;if(Object.prototype.toString.call(J)!=="[object Symbol]")return!1;if(Object.prototype.toString.call(z)!=="[object Symbol]")return!1;var Q=42;X[J]=Q;for(var G in X)return!1;if(typeof Object.keys==="function"&&Object.keys(X).length!==0)return!1;if(typeof Object.getOwnPropertyNames==="function"&&Object.getOwnPropertyNames(X).length!==0)return!1;var Z=Object.getOwnPropertySymbols(X);if(Z.length!==1||Z[0]!==J)return!1;if(!Object.prototype.propertyIsEnumerable.call(X,J))return!1;if(typeof Object.getOwnPropertyDescriptor==="function"){var $=Object.getOwnPropertyDescriptor(X,J);if($.value!==Q||$.enumerable!==!0)return!1}return!0}});var _L=C((FK0,kL)=>{var SL=typeof Symbol<"u"&&Symbol,Ia=jz();kL.exports=function(){if(typeof SL!=="function")return!1;if(typeof Symbol!=="function")return!1;if(typeof SL("foo")!=="symbol")return!1;if(typeof Symbol("bar")!=="symbol")return!1;return Ia()}});var Cz=C((PK0,bL)=>{bL.exports=typeof Reflect<"u"&&Reflect.getPrototypeOf||null});var Ez=C((AK0,RL)=>{var va=vz();RL.exports=va.getPrototypeOf||null});var hL=C((wK0,yL)=>{var Da="Function.prototype.bind called on incompatible ",ja=Object.prototype.toString,Ca=Math.max,Ea="[object Function]",fL=function(X,J){var z=[];for(var Q=0;Q<X.length;Q+=1)z[Q]=X[Q];for(var G=0;G<J.length;G+=1)z[G+X.length]=J[G];return z},Sa=function(X,J){var z=[];for(var Q=J||0,G=0;Q<X.length;Q+=1,G+=1)z[G]=X[Q];return z},ka=function(Y,X){var J="";for(var z=0;z<Y.length;z+=1)if(J+=Y[z],z+1<Y.length)J+=X;return J};yL.exports=function(X){var J=this;if(typeof J!=="function"||ja.apply(J)!==Ea)throw TypeError(Da+J);var z=Sa(arguments,1),Q,G=function(){if(this instanceof Q){var K=J.apply(this,fL(z,arguments));if(Object(K)===K)return K;return this}return J.apply(X,fL(z,arguments))},Z=Ca(0,J.length-z.length),$=[];for(var H=0;H<Z;H++)$[H]="$"+H;if(Q=Function("binder","return function ("+ka($,",")+"){ return binder.apply(this,arguments); }")(G),J.prototype){var W=function(){};W.prototype=J.prototype,Q.prototype=new W,W.prototype=null}return Q}});var B7=C((TK0,mL)=>{var _a=hL();mL.exports=Function.prototype.bind||_a});var c9=C((IK0,uL)=>{uL.exports=Function.prototype.call});var Sz=C((vK0,gL)=>{gL.exports=Function.prototype.apply});var cL=C((DK0,pL)=>{pL.exports=typeof Reflect<"u"&&Reflect&&Reflect.apply});var lL=C((jK0,dL)=>{var ba=B7(),Ra=Sz(),fa=c9(),ya=cL();dL.exports=ya||ba.call(fa,Ra)});var nL=C((CK0,iL)=>{var ha=B7(),ma=u9(),ua=c9(),ga=lL();iL.exports=function(X){if(X.length<1||typeof X[0]!=="function")throw new ma("a function is required");return ga(ha,ua,X)}});var eL=C((EK0,tL)=>{var pa=nL(),oL=Dz(),sL;try{sL=[].__proto__===Array.prototype}catch(Y){if(!Y||typeof Y!=="object"||!("code"in Y)||Y.code!=="ERR_PROTO_ACCESS")throw Y}var kz=!!sL&&oL&&oL(Object.prototype,"__proto__"),rL=Object,aL=rL.getPrototypeOf;tL.exports=kz&&typeof kz.get==="function"?pa([kz.get]):typeof aL==="function"?function(X){return aL(X==null?X:rL(X))}:!1});var QN=C((SK0,zN)=>{var YN=Cz(),XN=Ez(),JN=eL();zN.exports=YN?function(X){return YN(X)}:XN?function(X){if(!X||typeof X!=="object"&&typeof X!=="function")throw TypeError("getProto: not an object");return XN(X)}:JN?function(X){return JN(X)}:null});var d9=C((kK0,GN)=>{var ca=Function.prototype.call,da=Object.prototype.hasOwnProperty,la=B7();GN.exports=la.call(ca,da)});var UN=C((_K0,KN)=>{var w0,ia=vz(),na=rM(),oa=eM(),aa=XL(),sa=zL(),y6=GL(),f6=u9(),ra=HL(),ta=KL(),ea=BL(),Ys=OL(),Xs=LL(),Js=qL(),zs=FL(),Qs=TL(),HN=Function,_z=function(Y){try{return HN('"use strict"; return ('+Y+").constructor;")()}catch(X){}},V7=Dz(),Gs=CL(),bz=function(){throw new f6},Zs=V7?function(){try{return arguments.callee,bz}catch(Y){try{return V7(arguments,"callee").get}catch(X){return bz}}}():bz,b6=_L()(),W1=QN(),$s=Ez(),Hs=Cz(),WN=Sz(),O7=c9(),R6={},Ws=typeof Uint8Array>"u"||!W1?w0:W1(Uint8Array),p8={__proto__:null,"%AggregateError%":typeof AggregateError>"u"?w0:AggregateError,"%Array%":Array,"%ArrayBuffer%":typeof ArrayBuffer>"u"?w0:ArrayBuffer,"%ArrayIteratorPrototype%":b6&&W1?W1([][Symbol.iterator]()):w0,"%AsyncFromSyncIteratorPrototype%":w0,"%AsyncFunction%":R6,"%AsyncGenerator%":R6,"%AsyncGeneratorFunction%":R6,"%AsyncIteratorPrototype%":R6,"%Atomics%":typeof Atomics>"u"?w0:Atomics,"%BigInt%":typeof BigInt>"u"?w0:BigInt,"%BigInt64Array%":typeof BigInt64Array>"u"?w0:BigInt64Array,"%BigUint64Array%":typeof BigUint64Array>"u"?w0:BigUint64Array,"%Boolean%":Boolean,"%DataView%":typeof DataView>"u"?w0:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":na,"%eval%":eval,"%EvalError%":oa,"%Float16Array%":typeof Float16Array>"u"?w0:Float16Array,"%Float32Array%":typeof Float32Array>"u"?w0:Float32Array,"%Float64Array%":typeof Float64Array>"u"?w0:Float64Array,"%FinalizationRegistry%":typeof FinalizationRegistry>"u"?w0:FinalizationRegistry,"%Function%":HN,"%GeneratorFunction%":R6,"%Int8Array%":typeof Int8Array>"u"?w0:Int8Array,"%Int16Array%":typeof Int16Array>"u"?w0:Int16Array,"%Int32Array%":typeof Int32Array>"u"?w0:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":b6&&W1?W1(W1([][Symbol.iterator]())):w0,"%JSON%":typeof JSON==="object"?JSON:w0,"%Map%":typeof Map>"u"?w0:Map,"%MapIteratorPrototype%":typeof Map>"u"||!b6||!W1?w0:W1(new Map()[Symbol.iterator]()),"%Math%":Math,"%Number%":Number,"%Object%":ia,"%Object.getOwnPropertyDescriptor%":V7,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":typeof Promise>"u"?w0:Promise,"%Proxy%":typeof Proxy>"u"?w0:Proxy,"%RangeError%":aa,"%ReferenceError%":sa,"%Reflect%":typeof Reflect>"u"?w0:Reflect,"%RegExp%":RegExp,"%Set%":typeof Set>"u"?w0:Set,"%SetIteratorPrototype%":typeof Set>"u"||!b6||!W1?w0:W1(new Set()[Symbol.iterator]()),"%SharedArrayBuffer%":typeof SharedArrayBuffer>"u"?w0:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":b6&&W1?W1(""[Symbol.iterator]()):w0,"%Symbol%":b6?Symbol:w0,"%SyntaxError%":y6,"%ThrowTypeError%":Zs,"%TypedArray%":Ws,"%TypeError%":f6,"%Uint8Array%":typeof Uint8Array>"u"?w0:Uint8Array,"%Uint8ClampedArray%":typeof Uint8ClampedArray>"u"?w0:Uint8ClampedArray,"%Uint16Array%":typeof Uint16Array>"u"?w0:Uint16Array,"%Uint32Array%":typeof Uint32Array>"u"?w0:Uint32Array,"%URIError%":ra,"%WeakMap%":typeof WeakMap>"u"?w0:WeakMap,"%WeakRef%":typeof WeakRef>"u"?w0:WeakRef,"%WeakSet%":typeof WeakSet>"u"?w0:WeakSet,"%Function.prototype.call%":O7,"%Function.prototype.apply%":WN,"%Object.defineProperty%":Gs,"%Object.getPrototypeOf%":$s,"%Math.abs%":ta,"%Math.floor%":ea,"%Math.max%":Ys,"%Math.min%":Xs,"%Math.pow%":Js,"%Math.round%":zs,"%Math.sign%":Qs,"%Reflect.getPrototypeOf%":Hs};if(W1)try{null.error}catch(Y){Rz=W1(W1(Y)),p8["%Error.prototype%"]=Rz}var Rz,Ks=function Y(X){var J;if(X==="%AsyncFunction%")J=_z("async function () {}");else if(X==="%GeneratorFunction%")J=_z("function* () {}");else if(X==="%AsyncGeneratorFunction%")J=_z("async function* () {}");else if(X==="%AsyncGenerator%"){var z=Y("%AsyncGeneratorFunction%");if(z)J=z.prototype}else if(X==="%AsyncIteratorPrototype%"){var Q=Y("%AsyncGenerator%");if(Q&&W1)J=W1(Q.prototype)}return p8[X]=J,J},ZN={__proto__:null,"%ArrayBufferPrototype%":["ArrayBuffer","prototype"],"%ArrayPrototype%":["Array","prototype"],"%ArrayProto_entries%":["Array","prototype","entries"],"%ArrayProto_forEach%":["Array","prototype","forEach"],"%ArrayProto_keys%":["Array","prototype","keys"],"%ArrayProto_values%":["Array","prototype","values"],"%AsyncFunctionPrototype%":["AsyncFunction","prototype"],"%AsyncGenerator%":["AsyncGeneratorFunction","prototype"],"%AsyncGeneratorPrototype%":["AsyncGeneratorFunction","prototype","prototype"],"%BooleanPrototype%":["Boolean","prototype"],"%DataViewPrototype%":["DataView","prototype"],"%DatePrototype%":["Date","prototype"],"%ErrorPrototype%":["Error","prototype"],"%EvalErrorPrototype%":["EvalError","prototype"],"%Float32ArrayPrototype%":["Float32Array","prototype"],"%Float64ArrayPrototype%":["Float64Array","prototype"],"%FunctionPrototype%":["Function","prototype"],"%Generator%":["GeneratorFunction","prototype"],"%GeneratorPrototype%":["GeneratorFunction","prototype","prototype"],"%Int8ArrayPrototype%":["Int8Array","prototype"],"%Int16ArrayPrototype%":["Int16Array","prototype"],"%Int32ArrayPrototype%":["Int32Array","prototype"],"%JSONParse%":["JSON","parse"],"%JSONStringify%":["JSON","stringify"],"%MapPrototype%":["Map","prototype"],"%NumberPrototype%":["Number","prototype"],"%ObjectPrototype%":["Object","prototype"],"%ObjProto_toString%":["Object","prototype","toString"],"%ObjProto_valueOf%":["Object","prototype","valueOf"],"%PromisePrototype%":["Promise","prototype"],"%PromiseProto_then%":["Promise","prototype","then"],"%Promise_all%":["Promise","all"],"%Promise_reject%":["Promise","reject"],"%Promise_resolve%":["Promise","resolve"],"%RangeErrorPrototype%":["RangeError","prototype"],"%ReferenceErrorPrototype%":["ReferenceError","prototype"],"%RegExpPrototype%":["RegExp","prototype"],"%SetPrototype%":["Set","prototype"],"%SharedArrayBufferPrototype%":["SharedArrayBuffer","prototype"],"%StringPrototype%":["String","prototype"],"%SymbolPrototype%":["Symbol","prototype"],"%SyntaxErrorPrototype%":["SyntaxError","prototype"],"%TypedArrayPrototype%":["TypedArray","prototype"],"%TypeErrorPrototype%":["TypeError","prototype"],"%Uint8ArrayPrototype%":["Uint8Array","prototype"],"%Uint8ClampedArrayPrototype%":["Uint8ClampedArray","prototype"],"%Uint16ArrayPrototype%":["Uint16Array","prototype"],"%Uint32ArrayPrototype%":["Uint32Array","prototype"],"%URIErrorPrototype%":["URIError","prototype"],"%WeakMapPrototype%":["WeakMap","prototype"],"%WeakSetPrototype%":["WeakSet","prototype"]},M7=B7(),l9=d9(),Us=M7.call(O7,Array.prototype.concat),Bs=M7.call(WN,Array.prototype.splice),$N=M7.call(O7,String.prototype.replace),i9=M7.call(O7,String.prototype.slice),Vs=M7.call(O7,RegExp.prototype.exec),Os=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,Ms=/\\(\\)?/g,Ls=function(X){var J=i9(X,0,1),z=i9(X,-1);if(J==="%"&&z!=="%")throw new y6("invalid intrinsic syntax, expected closing `%`");else if(z==="%"&&J!=="%")throw new y6("invalid intrinsic syntax, expected opening `%`");var Q=[];return $N(X,Os,function(G,Z,$,H){Q[Q.length]=$?$N(H,Ms,"$1"):Z||G}),Q},Ns=function(X,J){var z=X,Q;if(l9(ZN,z))Q=ZN[z],z="%"+Q[0]+"%";if(l9(p8,z)){var G=p8[z];if(G===R6)G=Ks(z);if(typeof G>"u"&&!J)throw new f6("intrinsic "+X+" exists, but is not available. Please file an issue!");return{alias:Q,name:z,value:G}}throw new y6("intrinsic "+X+" does not exist!")};KN.exports=function(X,J){if(typeof X!=="string"||X.length===0)throw new f6("intrinsic name must be a non-empty string");if(arguments.length>1&&typeof J!=="boolean")throw new f6('"allowMissing" argument must be a boolean');if(Vs(/^%?[^%]*%?$/,X)===null)throw new y6("`%` may not be present anywhere but at the beginning and end of the intrinsic name");var z=Ls(X),Q=z.length>0?z[0]:"",G=Ns("%"+Q+"%",J),Z=G.name,$=G.value,H=!1,W=G.alias;if(W)Q=W[0],Bs(z,Us([0,1],W));for(var K=1,U=!0;K<z.length;K+=1){var B=z[K],O=i9(B,0,1),V=i9(B,-1);if((O==='"'||O==="'"||O==="`"||(V==='"'||V==="'"||V==="`"))&&O!==V)throw new y6("property names with quotes must have matching quotes");if(B==="constructor"||!U)H=!0;if(Q+="."+B,Z="%"+Q+"%",l9(p8,Z))$=p8[Z];else if($!=null){if(!(B in $)){if(!J)throw new f6("base intrinsic for "+X+" exists, but the property is not available.");return}if(V7&&K+1>=z.length){var L=V7($,B);if(U=!!L,U&&"get"in L&&!("originalValue"in L.get))$=L.get;else $=$[B]}else U=l9($,B),$=$[B];if(U&&!H)p8[Z]=$}}return $}});var VN=C((bK0,BN)=>{var qs=jz();BN.exports=function(){return qs()&&!!Symbol.toStringTag}});var LN=C((RK0,MN)=>{var xs=UN(),ON=xs("%Object.defineProperty%",!0),Fs=VN()(),Ps=d9(),As=u9(),n9=Fs?Symbol.toStringTag:null;MN.exports=function(X,J){var z=arguments.length>2&&!!arguments[2]&&arguments[2].force,Q=arguments.length>2&&!!arguments[2]&&arguments[2].nonConfigurable;if(typeof z<"u"&&typeof z!=="boolean"||typeof Q<"u"&&typeof Q!=="boolean")throw new As("if provided, the `overrideIfSet` and `nonConfigurable` options must be booleans");if(n9&&(z||!Ps(X,n9)))if(ON)ON(X,n9,{configurable:!Q,enumerable:!1,value:J,writable:!1});else X[n9]=J}});var qN=C((fK0,NN)=>{NN.exports=function(Y,X){return Object.keys(X).forEach(function(J){Y[J]=Y[J]||X[J]}),Y}});var uz=C((yK0,xN)=>{var mz=IM(),ws=Q0("util"),fz=Q0("path"),Ts=Q0("http"),Is=Q0("https"),vs=Q0("url").parse,Ds=Q0("fs"),js=Q0("stream").Stream,Cs=Q0("crypto"),yz=SM(),Es=oM(),Ss=LN(),x8=d9(),hz=qN();function C0(Y){if(!(this instanceof C0))return new C0(Y);this._overheadLength=0,this._valueLength=0,this._valuesToMeasure=[],mz.call(this),Y=Y||{};for(var X in Y)this[X]=Y[X]}ws.inherits(C0,mz);C0.LINE_BREAK=`\r
`;C0.DEFAULT_CONTENT_TYPE="application/octet-stream";C0.prototype.append=function(Y,X,J){if(J=J||{},typeof J==="string")J={filename:J};var z=mz.prototype.append.bind(this);if(typeof X==="number"||X==null)X=String(X);if(Array.isArray(X)){this._error(Error("Arrays are not supported."));return}var Q=this._multiPartHeader(Y,X,J),G=this._multiPartFooter();z(Q),z(X),z(G),this._trackLength(Q,X,J)};C0.prototype._trackLength=function(Y,X,J){var z=0;if(J.knownLength!=null)z+=Number(J.knownLength);else if(Buffer.isBuffer(X))z=X.length;else if(typeof X==="string")z=Buffer.byteLength(X);if(this._valueLength+=z,this._overheadLength+=Buffer.byteLength(Y)+C0.LINE_BREAK.length,!X||!X.path&&!(X.readable&&x8(X,"httpVersion"))&&!(X instanceof js))return;if(!J.knownLength)this._valuesToMeasure.push(X)};C0.prototype._lengthRetriever=function(Y,X){if(x8(Y,"fd"))if(Y.end!=null&&Y.end!=1/0&&Y.start!=null)X(null,Y.end+1-(Y.start?Y.start:0));else Ds.stat(Y.path,function(J,z){if(J){X(J);return}var Q=z.size-(Y.start?Y.start:0);X(null,Q)});else if(x8(Y,"httpVersion"))X(null,Number(Y.headers["content-length"]));else if(x8(Y,"httpModule"))Y.on("response",function(J){Y.pause(),X(null,Number(J.headers["content-length"]))}),Y.resume();else X("Unknown stream")};C0.prototype._multiPartHeader=function(Y,X,J){if(typeof J.header==="string")return J.header;var z=this._getContentDisposition(X,J),Q=this._getContentType(X,J),G="",Z={"Content-Disposition":["form-data",'name="'+Y+'"'].concat(z||[]),"Content-Type":[].concat(Q||[])};if(typeof J.header==="object")hz(Z,J.header);var $;for(var H in Z)if(x8(Z,H)){if($=Z[H],$==null)continue;if(!Array.isArray($))$=[$];if($.length)G+=H+": "+$.join("; ")+C0.LINE_BREAK}return"--"+this.getBoundary()+C0.LINE_BREAK+G+C0.LINE_BREAK};C0.prototype._getContentDisposition=function(Y,X){var J;if(typeof X.filepath==="string")J=fz.normalize(X.filepath).replace(/\\/g,"/");else if(X.filename||Y&&(Y.name||Y.path))J=fz.basename(X.filename||Y&&(Y.name||Y.path));else if(Y&&Y.readable&&x8(Y,"httpVersion"))J=fz.basename(Y.client._httpMessage.path||"");if(J)return'filename="'+J+'"'};C0.prototype._getContentType=function(Y,X){var J=X.contentType;if(!J&&Y&&Y.name)J=yz.lookup(Y.name);if(!J&&Y&&Y.path)J=yz.lookup(Y.path);if(!J&&Y&&Y.readable&&x8(Y,"httpVersion"))J=Y.headers["content-type"];if(!J&&(X.filepath||X.filename))J=yz.lookup(X.filepath||X.filename);if(!J&&Y&&typeof Y==="object")J=C0.DEFAULT_CONTENT_TYPE;return J};C0.prototype._multiPartFooter=function(){return function(Y){var X=C0.LINE_BREAK,J=this._streams.length===0;if(J)X+=this._lastBoundary();Y(X)}.bind(this)};C0.prototype._lastBoundary=function(){return"--"+this.getBoundary()+"--"+C0.LINE_BREAK};C0.prototype.getHeaders=function(Y){var X,J={"content-type":"multipart/form-data; boundary="+this.getBoundary()};for(X in Y)if(x8(Y,X))J[X.toLowerCase()]=Y[X];return J};C0.prototype.setBoundary=function(Y){if(typeof Y!=="string")throw TypeError("FormData boundary must be a string");this._boundary=Y};C0.prototype.getBoundary=function(){if(!this._boundary)this._generateBoundary();return this._boundary};C0.prototype.getBuffer=function(){var Y=new Buffer.alloc(0),X=this.getBoundary();for(var J=0,z=this._streams.length;J<z;J++)if(typeof this._streams[J]!=="function"){if(Buffer.isBuffer(this._streams[J]))Y=Buffer.concat([Y,this._streams[J]]);else Y=Buffer.concat([Y,Buffer.from(this._streams[J])]);if(typeof this._streams[J]!=="string"||this._streams[J].substring(2,X.length+2)!==X)Y=Buffer.concat([Y,Buffer.from(C0.LINE_BREAK)])}return Buffer.concat([Y,Buffer.from(this._lastBoundary())])};C0.prototype._generateBoundary=function(){this._boundary="--------------------------"+Cs.randomBytes(12).toString("hex")};C0.prototype.getLengthSync=function(){var Y=this._overheadLength+this._valueLength;if(this._streams.length)Y+=this._lastBoundary().length;if(!this.hasKnownLength())this._error(Error("Cannot calculate proper length in synchronous way."));return Y};C0.prototype.hasKnownLength=function(){var Y=!0;if(this._valuesToMeasure.length)Y=!1;return Y};C0.prototype.getLength=function(Y){var X=this._overheadLength+this._valueLength;if(this._streams.length)X+=this._lastBoundary().length;if(!this._valuesToMeasure.length){process.nextTick(Y.bind(this,null,X));return}Es.parallel(this._valuesToMeasure,this._lengthRetriever,function(J,z){if(J){Y(J);return}z.forEach(function(Q){X+=Q}),Y(null,X)})};C0.prototype.submit=function(Y,X){var J,z,Q={method:"post"};if(typeof Y==="string")Y=vs(Y),z=hz({port:Y.port,path:Y.pathname,host:Y.hostname,protocol:Y.protocol},Q);else if(z=hz(Y,Q),!z.port)z.port=z.protocol==="https:"?443:80;if(z.headers=this.getHeaders(Y.headers),z.protocol==="https:")J=Is.request(z);else J=Ts.request(z);return this.getLength(function(G,Z){if(G&&G!=="Unknown stream"){this._error(G);return}if(Z)J.setHeader("Content-Length",Z);if(this.pipe(J),X){var $,H=function(W,K){return J.removeListener("error",H),J.removeListener("response",$),X.call(this,W,K)};$=H.bind(this,null),J.on("error",H),J.on("response",$)}}.bind(this)),J};C0.prototype._error=function(Y){if(!this.error)this.error=Y,this.pause(),this.emit("error",Y)};C0.prototype.toString=function(){return"[object FormData]"};Ss(C0.prototype,"FormData");xN.exports=C0});var RN=C((Jr)=>{var rs=Q0("url").parse,ts={ftp:21,gopher:70,http:80,https:443,ws:80,wss:443},es=String.prototype.endsWith||function(Y){return Y.length<=this.length&&this.indexOf(Y,this.length-Y.length)!==-1};function Yr(Y){var X=typeof Y==="string"?rs(Y):Y||{},J=X.protocol,z=X.host,Q=X.port;if(typeof z!=="string"||!z||typeof J!=="string")return"";if(J=J.split(":",1)[0],z=z.replace(/:\d*$/,""),Q=parseInt(Q)||ts[J]||0,!Xr(z,Q))return"";var G=u6("npm_config_"+J+"_proxy")||u6(J+"_proxy")||u6("npm_config_proxy")||u6("all_proxy");if(G&&G.indexOf("://")===-1)G=J+"://"+G;return G}function Xr(Y,X){var J=(u6("npm_config_no_proxy")||u6("no_proxy")).toLowerCase();if(!J)return!0;if(J==="*")return!1;return J.split(/[,\s]/).every(function(z){if(!z)return!0;var Q=z.match(/^(.+):(\d+)$/),G=Q?Q[1]:z,Z=Q?parseInt(Q[2]):0;if(Z&&Z!==X)return!0;if(!/^[.*]/.test(G))return Y!==G;if(G.charAt(0)==="*")G=G.slice(1);return!es.call(Y,G)})}function u6(Y){return process.env[Y.toLowerCase()]||process.env[Y.toUpperCase()]||""}Jr.getProxyForUrl=Yr});var tz=C((mU0,fN)=>{var g6=1000,p6=g6*60,c6=p6*60,l8=c6*24,Qr=l8*7,Gr=l8*365.25;fN.exports=function(Y,X){X=X||{};var J=typeof Y;if(J==="string"&&Y.length>0)return Zr(Y);else if(J==="number"&&isFinite(Y))return X.long?Hr(Y):$r(Y);throw Error("val is not a non-empty string or a valid number. val="+JSON.stringify(Y))};function Zr(Y){if(Y=String(Y),Y.length>100)return;var X=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(Y);if(!X)return;var J=parseFloat(X[1]),z=(X[2]||"ms").toLowerCase();switch(z){case"years":case"year":case"yrs":case"yr":case"y":return J*Gr;case"weeks":case"week":case"w":return J*Qr;case"days":case"day":case"d":return J*l8;case"hours":case"hour":case"hrs":case"hr":case"h":return J*c6;case"minutes":case"minute":case"mins":case"min":case"m":return J*p6;case"seconds":case"second":case"secs":case"sec":case"s":return J*g6;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return J;default:return}}function $r(Y){var X=Math.abs(Y);if(X>=l8)return Math.round(Y/l8)+"d";if(X>=c6)return Math.round(Y/c6)+"h";if(X>=p6)return Math.round(Y/p6)+"m";if(X>=g6)return Math.round(Y/g6)+"s";return Y+"ms"}function Hr(Y){var X=Math.abs(Y);if(X>=l8)return r9(Y,X,l8,"day");if(X>=c6)return r9(Y,X,c6,"hour");if(X>=p6)return r9(Y,X,p6,"minute");if(X>=g6)return r9(Y,X,g6,"second");return Y+" ms"}function r9(Y,X,J,z){var Q=X>=J*1.5;return Math.round(Y/J)+" "+z+(Q?"s":"")}});var ez=C((uU0,yN)=>{function Wr(Y){J.debug=J,J.default=J,J.coerce=H,J.disable=Z,J.enable=Q,J.enabled=$,J.humanize=tz(),J.destroy=W,Object.keys(Y).forEach((K)=>{J[K]=Y[K]}),J.names=[],J.skips=[],J.formatters={};function X(K){let U=0;for(let B=0;B<K.length;B++)U=(U<<5)-U+K.charCodeAt(B),U|=0;return J.colors[Math.abs(U)%J.colors.length]}J.selectColor=X;function J(K){let U,B=null,O,V;function L(...q){if(!L.enabled)return;let F=L,P=Number(new Date),A=P-(U||P);if(F.diff=A,F.prev=U,F.curr=P,U=P,q[0]=J.coerce(q[0]),typeof q[0]!=="string")q.unshift("%O");let w=0;q[0]=q[0].replace(/%([a-zA-Z%])/g,(T,D)=>{if(T==="%%")return"%";w++;let j=J.formatters[D];if(typeof j==="function"){let E=q[w];T=j.call(F,E),q.splice(w,1),w--}return T}),J.formatArgs.call(F,q),(F.log||J.log).apply(F,q)}if(L.namespace=K,L.useColors=J.useColors(),L.color=J.selectColor(K),L.extend=z,L.destroy=J.destroy,Object.defineProperty(L,"enabled",{enumerable:!0,configurable:!1,get:()=>{if(B!==null)return B;if(O!==J.namespaces)O=J.namespaces,V=J.enabled(K);return V},set:(q)=>{B=q}}),typeof J.init==="function")J.init(L);return L}function z(K,U){let B=J(this.namespace+(typeof U>"u"?":":U)+K);return B.log=this.log,B}function Q(K){J.save(K),J.namespaces=K,J.names=[],J.skips=[];let U=(typeof K==="string"?K:"").trim().replace(/\s+/g,",").split(",").filter(Boolean);for(let B of U)if(B[0]==="-")J.skips.push(B.slice(1));else J.names.push(B)}function G(K,U){let B=0,O=0,V=-1,L=0;while(B<K.length)if(O<U.length&&(U[O]===K[B]||U[O]==="*"))if(U[O]==="*")V=O,L=B,O++;else B++,O++;else if(V!==-1)O=V+1,L++,B=L;else return!1;while(O<U.length&&U[O]==="*")O++;return O===U.length}function Z(){let K=[...J.names,...J.skips.map((U)=>"-"+U)].join(",");return J.enable(""),K}function $(K){for(let U of J.skips)if(G(K,U))return!1;for(let U of J.names)if(G(K,U))return!0;return!1}function H(K){if(K instanceof Error)return K.stack||K.message;return K}function W(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return J.enable(J.load()),J}yN.exports=Wr});var mN=C((hN,t9)=>{hN.formatArgs=Ur;hN.save=Br;hN.load=Vr;hN.useColors=Kr;hN.storage=Or();hN.destroy=(()=>{let Y=!1;return()=>{if(!Y)Y=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}})();hN.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function Kr(){if(typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs))return!0;if(typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;let Y;return typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&(Y=navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/))&&parseInt(Y[1],10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function Ur(Y){if(Y[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+Y[0]+(this.useColors?"%c ":" ")+"+"+t9.exports.humanize(this.diff),!this.useColors)return;let X="color: "+this.color;Y.splice(1,0,X,"color: inherit");let J=0,z=0;Y[0].replace(/%[a-zA-Z%]/g,(Q)=>{if(Q==="%%")return;if(J++,Q==="%c")z=J}),Y.splice(z,0,X)}hN.log=console.debug||console.log||(()=>{});function Br(Y){try{if(Y)hN.storage.setItem("debug",Y);else hN.storage.removeItem("debug")}catch(X){}}function Vr(){let Y;try{Y=hN.storage.getItem("debug")||hN.storage.getItem("DEBUG")}catch(X){}if(!Y&&typeof process<"u"&&"env"in process)Y=process.env.DEBUG;return Y}function Or(){try{return localStorage}catch(Y){}}t9.exports=ez()(hN);var{formatters:Mr}=t9.exports;Mr.j=function(Y){try{return JSON.stringify(Y)}catch(X){return"[UnexpectedJSONParseError]: "+X.message}}});var gN=C((pU0,uN)=>{uN.exports=(Y,X=process.argv)=>{let J=Y.startsWith("-")?"":Y.length===1?"-":"--",z=X.indexOf(J+Y),Q=X.indexOf("--");return z!==-1&&(Q===-1||z<Q)}});var dN=C((cU0,cN)=>{var wr=Q0("os"),pN=Q0("tty"),e1=gN(),{env:K1}=process,P8;if(e1("no-color")||e1("no-colors")||e1("color=false")||e1("color=never"))P8=0;else if(e1("color")||e1("colors")||e1("color=true")||e1("color=always"))P8=1;if("FORCE_COLOR"in K1)if(K1.FORCE_COLOR==="true")P8=1;else if(K1.FORCE_COLOR==="false")P8=0;else P8=K1.FORCE_COLOR.length===0?1:Math.min(parseInt(K1.FORCE_COLOR,10),3);function YQ(Y){if(Y===0)return!1;return{level:Y,hasBasic:!0,has256:Y>=2,has16m:Y>=3}}function XQ(Y,X){if(P8===0)return 0;if(e1("color=16m")||e1("color=full")||e1("color=truecolor"))return 3;if(e1("color=256"))return 2;if(Y&&!X&&P8===void 0)return 0;let J=P8||0;if(K1.TERM==="dumb")return J;if(process.platform==="win32"){let z=wr.release().split(".");if(Number(z[0])>=10&&Number(z[2])>=10586)return Number(z[2])>=14931?3:2;return 1}if("CI"in K1){if(["TRAVIS","CIRCLECI","APPVEYOR","GITLAB_CI","GITHUB_ACTIONS","BUILDKITE"].some((z)=>(z in K1))||K1.CI_NAME==="codeship")return 1;return J}if("TEAMCITY_VERSION"in K1)return/^(9\.(0*[1-9]\d*)\.|\d{2,}\.)/.test(K1.TEAMCITY_VERSION)?1:0;if(K1.COLORTERM==="truecolor")return 3;if("TERM_PROGRAM"in K1){let z=parseInt((K1.TERM_PROGRAM_VERSION||"").split(".")[0],10);switch(K1.TERM_PROGRAM){case"iTerm.app":return z>=3?3:2;case"Apple_Terminal":return 2}}if(/-256(color)?$/i.test(K1.TERM))return 2;if(/^screen|^xterm|^vt100|^vt220|^rxvt|color|ansi|cygwin|linux/i.test(K1.TERM))return 1;if("COLORTERM"in K1)return 1;return J}function Tr(Y){let X=XQ(Y,Y&&Y.isTTY);return YQ(X)}cN.exports={supportsColor:Tr,stdout:YQ(XQ(!0,pN.isatty(1))),stderr:YQ(XQ(!0,pN.isatty(2)))}});var oN=C((iN,YY)=>{var Ir=Q0("tty"),e9=Q0("util");iN.init=kr;iN.log=Cr;iN.formatArgs=Dr;iN.save=Er;iN.load=Sr;iN.useColors=vr;iN.destroy=e9.deprecate(()=>{},"Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.");iN.colors=[6,2,3,4,5,1];try{let Y=dN();if(Y&&(Y.stderr||Y).level>=2)iN.colors=[20,21,26,27,32,33,38,39,40,41,42,43,44,45,56,57,62,63,68,69,74,75,76,77,78,79,80,81,92,93,98,99,112,113,128,129,134,135,148,149,160,161,162,163,164,165,166,167,168,169,170,171,172,173,178,179,184,185,196,197,198,199,200,201,202,203,204,205,206,207,208,209,214,215,220,221]}catch(Y){}iN.inspectOpts=Object.keys(process.env).filter((Y)=>{return/^debug_/i.test(Y)}).reduce((Y,X)=>{let J=X.substring(6).toLowerCase().replace(/_([a-z])/g,(Q,G)=>{return G.toUpperCase()}),z=process.env[X];if(/^(yes|on|true|enabled)$/i.test(z))z=!0;else if(/^(no|off|false|disabled)$/i.test(z))z=!1;else if(z==="null")z=null;else z=Number(z);return Y[J]=z,Y},{});function vr(){return"colors"in iN.inspectOpts?Boolean(iN.inspectOpts.colors):Ir.isatty(process.stderr.fd)}function Dr(Y){let{namespace:X,useColors:J}=this;if(J){let z=this.color,Q="\x1B[3"+(z<8?z:"8;5;"+z),G=`  ${Q};1m${X} \x1B[0m`;Y[0]=G+Y[0].split(`
`).join(`
`+G),Y.push(Q+"m+"+YY.exports.humanize(this.diff)+"\x1B[0m")}else Y[0]=jr()+X+" "+Y[0]}function jr(){if(iN.inspectOpts.hideDate)return"";return new Date().toISOString()+" "}function Cr(...Y){return process.stderr.write(e9.formatWithOptions(iN.inspectOpts,...Y)+`
`)}function Er(Y){if(Y)process.env.DEBUG=Y;else delete process.env.DEBUG}function Sr(){return process.env.DEBUG}function kr(Y){Y.inspectOpts={};let X=Object.keys(iN.inspectOpts);for(let J=0;J<X.length;J++)Y.inspectOpts[X[J]]=iN.inspectOpts[X[J]]}YY.exports=ez()(iN);var{formatters:lN}=YY.exports;lN.o=function(Y){return this.inspectOpts.colors=this.useColors,e9.inspect(Y,this.inspectOpts).split(`
`).map((X)=>X.trim()).join(" ")};lN.O=function(Y){return this.inspectOpts.colors=this.useColors,e9.inspect(Y,this.inspectOpts)}});var aN=C((lU0,JQ)=>{if(typeof process>"u"||process.type==="renderer"||!1||process.__nwjs)JQ.exports=mN();else JQ.exports=oN()});var rN=C((iU0,sN)=>{var P7;sN.exports=function(){if(!P7){try{P7=aN()("follow-redirects")}catch(Y){}if(typeof P7!=="function")P7=function(){}}P7.apply(null,arguments)}});var Jq=C((nU0,OQ)=>{var w7=Q0("url"),A7=w7.URL,ur=Q0("http"),gr=Q0("https"),$Q=Q0("stream").Writable,HQ=Q0("assert"),tN=rN();(function(){var X=typeof process<"u",J=typeof window<"u"&&typeof document<"u",z=o8(Error.captureStackTrace);if(!X&&(J||!z))console.warn("The follow-redirects package should be excluded from browser builds.")})();var WQ=!1;try{HQ(new A7(""))}catch(Y){WQ=Y.code==="ERR_INVALID_URL"}var pr=["auth","host","hostname","href","path","pathname","port","protocol","query","search","hash"],KQ=["abort","aborted","connect","error","socket","timeout"],UQ=Object.create(null);KQ.forEach(function(Y){UQ[Y]=function(X,J,z){this._redirectable.emit(Y,X,J,z)}});var QQ=T7("ERR_INVALID_URL","Invalid URL",TypeError),GQ=T7("ERR_FR_REDIRECTION_FAILURE","Redirected request failed"),cr=T7("ERR_FR_TOO_MANY_REDIRECTS","Maximum number of redirects exceeded",GQ),dr=T7("ERR_FR_MAX_BODY_LENGTH_EXCEEDED","Request body larger than maxBodyLength limit"),lr=T7("ERR_STREAM_WRITE_AFTER_END","write after end"),ir=$Q.prototype.destroy||Yq;function h1(Y,X){if($Q.call(this),this._sanitizeOptions(Y),this._options=Y,this._ended=!1,this._ending=!1,this._redirectCount=0,this._redirects=[],this._requestBodyLength=0,this._requestBodyBuffers=[],X)this.on("response",X);var J=this;this._onNativeResponse=function(z){try{J._processResponse(z)}catch(Q){J.emit("error",Q instanceof GQ?Q:new GQ({cause:Q}))}},this._performRequest()}h1.prototype=Object.create($Q.prototype);h1.prototype.abort=function(){VQ(this._currentRequest),this._currentRequest.abort(),this.emit("abort")};h1.prototype.destroy=function(Y){return VQ(this._currentRequest,Y),ir.call(this,Y),this};h1.prototype.write=function(Y,X,J){if(this._ending)throw new lr;if(!n8(Y)&&!ar(Y))throw TypeError("data should be a string, Buffer or Uint8Array");if(o8(X))J=X,X=null;if(Y.length===0){if(J)J();return}if(this._requestBodyLength+Y.length<=this._options.maxBodyLength)this._requestBodyLength+=Y.length,this._requestBodyBuffers.push({data:Y,encoding:X}),this._currentRequest.write(Y,X,J);else this.emit("error",new dr),this.abort()};h1.prototype.end=function(Y,X,J){if(o8(Y))J=Y,Y=X=null;else if(o8(X))J=X,X=null;if(!Y)this._ended=this._ending=!0,this._currentRequest.end(null,null,J);else{var z=this,Q=this._currentRequest;this.write(Y,X,function(){z._ended=!0,Q.end(null,null,J)}),this._ending=!0}};h1.prototype.setHeader=function(Y,X){this._options.headers[Y]=X,this._currentRequest.setHeader(Y,X)};h1.prototype.removeHeader=function(Y){delete this._options.headers[Y],this._currentRequest.removeHeader(Y)};h1.prototype.setTimeout=function(Y,X){var J=this;function z(Z){Z.setTimeout(Y),Z.removeListener("timeout",Z.destroy),Z.addListener("timeout",Z.destroy)}function Q(Z){if(J._timeout)clearTimeout(J._timeout);J._timeout=setTimeout(function(){J.emit("timeout"),G()},Y),z(Z)}function G(){if(J._timeout)clearTimeout(J._timeout),J._timeout=null;if(J.removeListener("abort",G),J.removeListener("error",G),J.removeListener("response",G),J.removeListener("close",G),X)J.removeListener("timeout",X);if(!J.socket)J._currentRequest.removeListener("socket",Q)}if(X)this.on("timeout",X);if(this.socket)Q(this.socket);else this._currentRequest.once("socket",Q);return this.on("socket",z),this.on("abort",G),this.on("error",G),this.on("response",G),this.on("close",G),this};["flushHeaders","getHeader","setNoDelay","setSocketKeepAlive"].forEach(function(Y){h1.prototype[Y]=function(X,J){return this._currentRequest[Y](X,J)}});["aborted","connection","socket"].forEach(function(Y){Object.defineProperty(h1.prototype,Y,{get:function(){return this._currentRequest[Y]}})});h1.prototype._sanitizeOptions=function(Y){if(!Y.headers)Y.headers={};if(Y.host){if(!Y.hostname)Y.hostname=Y.host;delete Y.host}if(!Y.pathname&&Y.path){var X=Y.path.indexOf("?");if(X<0)Y.pathname=Y.path;else Y.pathname=Y.path.substring(0,X),Y.search=Y.path.substring(X)}};h1.prototype._performRequest=function(){var Y=this._options.protocol,X=this._options.nativeProtocols[Y];if(!X)throw TypeError("Unsupported protocol "+Y);if(this._options.agents){var J=Y.slice(0,-1);this._options.agent=this._options.agents[J]}var z=this._currentRequest=X.request(this._options,this._onNativeResponse);z._redirectable=this;for(var Q of KQ)z.on(Q,UQ[Q]);if(this._currentUrl=/^\//.test(this._options.path)?w7.format(this._options):this._options.path,this._isRedirect){var G=0,Z=this,$=this._requestBodyBuffers;(function H(W){if(z===Z._currentRequest){if(W)Z.emit("error",W);else if(G<$.length){var K=$[G++];if(!z.finished)z.write(K.data,K.encoding,H)}else if(Z._ended)z.end()}})()}};h1.prototype._processResponse=function(Y){var X=Y.statusCode;if(this._options.trackRedirects)this._redirects.push({url:this._currentUrl,headers:Y.headers,statusCode:X});var J=Y.headers.location;if(!J||this._options.followRedirects===!1||X<300||X>=400){Y.responseUrl=this._currentUrl,Y.redirects=this._redirects,this.emit("response",Y),this._requestBodyBuffers=[];return}if(VQ(this._currentRequest),Y.destroy(),++this._redirectCount>this._options.maxRedirects)throw new cr;var z,Q=this._options.beforeRedirect;if(Q)z=Object.assign({Host:Y.req.getHeader("host")},this._options.headers);var G=this._options.method;if((X===301||X===302)&&this._options.method==="POST"||X===303&&!/^(?:GET|HEAD)$/.test(this._options.method))this._options.method="GET",this._requestBodyBuffers=[],zQ(/^content-/i,this._options.headers);var Z=zQ(/^host$/i,this._options.headers),$=BQ(this._currentUrl),H=Z||$.host,W=/^\w+:/.test(J)?this._currentUrl:w7.format(Object.assign($,{host:H})),K=nr(J,W);if(tN("redirecting to",K.href),this._isRedirect=!0,ZQ(K,this._options),K.protocol!==$.protocol&&K.protocol!=="https:"||K.host!==H&&!or(K.host,H))zQ(/^(?:(?:proxy-)?authorization|cookie)$/i,this._options.headers);if(o8(Q)){var U={headers:Y.headers,statusCode:X},B={url:W,method:G,headers:z};Q(this._options,U,B),this._sanitizeOptions(this._options)}this._performRequest()};function eN(Y){var X={maxRedirects:21,maxBodyLength:10485760},J={};return Object.keys(Y).forEach(function(z){var Q=z+":",G=J[Q]=Y[z],Z=X[z]=Object.create(G);function $(W,K,U){if(sr(W))W=ZQ(W);else if(n8(W))W=ZQ(BQ(W));else U=K,K=Xq(W),W={protocol:Q};if(o8(K))U=K,K=null;if(K=Object.assign({maxRedirects:X.maxRedirects,maxBodyLength:X.maxBodyLength},W,K),K.nativeProtocols=J,!n8(K.host)&&!n8(K.hostname))K.hostname="::1";return HQ.equal(K.protocol,Q,"protocol mismatch"),tN("options",K),new h1(K,U)}function H(W,K,U){var B=Z.request(W,K,U);return B.end(),B}Object.defineProperties(Z,{request:{value:$,configurable:!0,enumerable:!0,writable:!0},get:{value:H,configurable:!0,enumerable:!0,writable:!0}})}),X}function Yq(){}function BQ(Y){var X;if(WQ)X=new A7(Y);else if(X=Xq(w7.parse(Y)),!n8(X.protocol))throw new QQ({input:Y});return X}function nr(Y,X){return WQ?new A7(Y,X):BQ(w7.resolve(X,Y))}function Xq(Y){if(/^\[/.test(Y.hostname)&&!/^\[[:0-9a-f]+\]$/i.test(Y.hostname))throw new QQ({input:Y.href||Y});if(/^\[/.test(Y.host)&&!/^\[[:0-9a-f]+\](:\d+)?$/i.test(Y.host))throw new QQ({input:Y.href||Y});return Y}function ZQ(Y,X){var J=X||{};for(var z of pr)J[z]=Y[z];if(J.hostname.startsWith("["))J.hostname=J.hostname.slice(1,-1);if(J.port!=="")J.port=Number(J.port);return J.path=J.search?J.pathname+J.search:J.pathname,J}function zQ(Y,X){var J;for(var z in X)if(Y.test(z))J=X[z],delete X[z];return J===null||typeof J>"u"?void 0:String(J).trim()}function T7(Y,X,J){function z(Q){if(o8(Error.captureStackTrace))Error.captureStackTrace(this,this.constructor);Object.assign(this,Q||{}),this.code=Y,this.message=this.cause?X+": "+this.cause.message:X}return z.prototype=new(J||Error),Object.defineProperties(z.prototype,{constructor:{value:z,enumerable:!1},name:{value:"Error ["+Y+"]",enumerable:!1}}),z}function VQ(Y,X){for(var J of KQ)Y.removeListener(J,UQ[J]);Y.on("error",Yq),Y.destroy(X)}function or(Y,X){HQ(n8(Y)&&n8(X));var J=Y.length-X.length-1;return J>0&&Y[J]==="."&&Y.endsWith(X)}function n8(Y){return typeof Y==="string"||Y instanceof String}function o8(Y){return typeof Y==="function"}function ar(Y){return typeof Y==="object"&&"length"in Y}function sr(Y){return A7&&Y instanceof A7}OQ.exports=eN({http:ur,https:gr});OQ.exports.wrap=eN});var lx=C((b7,kQ)=>{(function(Y,X){typeof b7=="object"&&typeof kQ=="object"?kQ.exports=X(Q0("child_process"),Q0("crypto")):typeof define=="function"&&define.amd?define(["child_process","crypto"],X):typeof b7=="object"?b7["electron-machine-id"]=X(Q0("child_process"),Q0("crypto")):Y["electron-machine-id"]=X(Y.child_process,Y.crypto)})(b7,function(Y,X){return function(J){function z(G){if(Q[G])return Q[G].exports;var Z=Q[G]={exports:{},id:G,loaded:!1};return J[G].call(Z.exports,Z,Z.exports,z),Z.loaded=!0,Z.exports}var Q={};return z.m=J,z.c=Q,z.p="",z(0)}([function(J,z,Q){J.exports=Q(34)},function(J,z,Q){var G=Q(29)("wks"),Z=Q(33),$=Q(2).Symbol,H=typeof $=="function",W=J.exports=function(K){return G[K]||(G[K]=H&&$[K]||(H?$:Z)("Symbol."+K))};W.store=G},function(J,z){var Q=J.exports=typeof window<"u"&&window.Math==Math?window:typeof self<"u"&&self.Math==Math?self:Function("return this")();typeof __g=="number"&&(__g=Q)},function(J,z,Q){var G=Q(9);J.exports=function(Z){if(!G(Z))throw TypeError(Z+" is not an object!");return Z}},function(J,z,Q){J.exports=!Q(24)(function(){return Object.defineProperty({},"a",{get:function(){return 7}}).a!=7})},function(J,z,Q){var G=Q(12),Z=Q(17);J.exports=Q(4)?function($,H,W){return G.f($,H,Z(1,W))}:function($,H,W){return $[H]=W,$}},function(J,z){var Q=J.exports={version:"2.4.0"};typeof __e=="number"&&(__e=Q)},function(J,z,Q){var G=Q(14);J.exports=function(Z,$,H){if(G(Z),$===void 0)return Z;switch(H){case 1:return function(W){return Z.call($,W)};case 2:return function(W,K){return Z.call($,W,K)};case 3:return function(W,K,U){return Z.call($,W,K,U)}}return function(){return Z.apply($,arguments)}}},function(J,z){var Q={}.hasOwnProperty;J.exports=function(G,Z){return Q.call(G,Z)}},function(J,z){J.exports=function(Q){return typeof Q=="object"?Q!==null:typeof Q=="function"}},function(J,z){J.exports={}},function(J,z){var Q={}.toString;J.exports=function(G){return Q.call(G).slice(8,-1)}},function(J,z,Q){var G=Q(3),Z=Q(26),$=Q(32),H=Object.defineProperty;z.f=Q(4)?Object.defineProperty:function(W,K,U){if(G(W),K=$(K,!0),G(U),Z)try{return H(W,K,U)}catch(B){}if("get"in U||"set"in U)throw TypeError("Accessors not supported!");return"value"in U&&(W[K]=U.value),W}},function(J,z,Q){var G=Q(42),Z=Q(15);J.exports=function($){return G(Z($))}},function(J,z){J.exports=function(Q){if(typeof Q!="function")throw TypeError(Q+" is not a function!");return Q}},function(J,z){J.exports=function(Q){if(Q==null)throw TypeError("Can't call method on  "+Q);return Q}},function(J,z,Q){var G=Q(9),Z=Q(2).document,$=G(Z)&&G(Z.createElement);J.exports=function(H){return $?Z.createElement(H):{}}},function(J,z){J.exports=function(Q,G){return{enumerable:!(1&Q),configurable:!(2&Q),writable:!(4&Q),value:G}}},function(J,z,Q){var G=Q(12).f,Z=Q(8),$=Q(1)("toStringTag");J.exports=function(H,W,K){H&&!Z(H=K?H:H.prototype,$)&&G(H,$,{configurable:!0,value:W})}},function(J,z,Q){var G=Q(29)("keys"),Z=Q(33);J.exports=function($){return G[$]||(G[$]=Z($))}},function(J,z){var{ceil:Q,floor:G}=Math;J.exports=function(Z){return isNaN(Z=+Z)?0:(Z>0?G:Q)(Z)}},function(J,z,Q){var G=Q(11),Z=Q(1)("toStringTag"),$=G(function(){return arguments}())=="Arguments",H=function(W,K){try{return W[K]}catch(U){}};J.exports=function(W){var K,U,B;return W===void 0?"Undefined":W===null?"Null":typeof(U=H(K=Object(W),Z))=="string"?U:$?G(K):(B=G(K))=="Object"&&typeof K.callee=="function"?"Arguments":B}},function(J,z){J.exports="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(",")},function(J,z,Q){var G=Q(2),Z=Q(6),$=Q(7),H=Q(5),W="prototype",K=function(U,B,O){var V,L,q,F=U&K.F,P=U&K.G,A=U&K.S,w=U&K.P,v=U&K.B,T=U&K.W,D=P?Z:Z[B]||(Z[B]={}),j=D[W],E=P?G:A?G[B]:(G[B]||{})[W];P&&(O=B);for(V in O)L=!F&&E&&E[V]!==void 0,L&&V in D||(q=L?E[V]:O[V],D[V]=P&&typeof E[V]!="function"?O[V]:v&&L?$(q,G):T&&E[V]==q?function(f){var i=function(o,y,a){if(this instanceof f){switch(arguments.length){case 0:return new f;case 1:return new f(o);case 2:return new f(o,y)}return new f(o,y,a)}return f.apply(this,arguments)};return i[W]=f[W],i}(q):w&&typeof q=="function"?$(Function.call,q):q,w&&((D.virtual||(D.virtual={}))[V]=q,U&K.R&&j&&!j[V]&&H(j,V,q)))};K.F=1,K.G=2,K.S=4,K.P=8,K.B=16,K.W=32,K.U=64,K.R=128,J.exports=K},function(J,z){J.exports=function(Q){try{return!!Q()}catch(G){return!0}}},function(J,z,Q){J.exports=Q(2).document&&document.documentElement},function(J,z,Q){J.exports=!Q(4)&&!Q(24)(function(){return Object.defineProperty(Q(16)("div"),"a",{get:function(){return 7}}).a!=7})},function(J,z,Q){var G=Q(28),Z=Q(23),$=Q(57),H=Q(5),W=Q(8),K=Q(10),U=Q(45),B=Q(18),O=Q(52),V=Q(1)("iterator"),L=!([].keys&&("next"in[].keys())),q="@@iterator",F="keys",P="values",A=function(){return this};J.exports=function(w,v,T,D,j,E,f){U(T,v,D);var i,o,y,a=function(c){if(!L&&c in l)return l[c];switch(c){case F:return function(){return new T(this,c)};case P:return function(){return new T(this,c)}}return function(){return new T(this,c)}},r=v+" Iterator",b=j==P,R=!1,l=w.prototype,p=l[V]||l[q]||j&&l[j],m=p||a(j),h=j?b?a("entries"):m:void 0,_=v=="Array"?l.entries||p:p;if(_&&(y=O(_.call(new w)),y!==Object.prototype&&(B(y,r,!0),G||W(y,V)||H(y,V,A))),b&&p&&p.name!==P&&(R=!0,m=function(){return p.call(this)}),G&&!f||!L&&!R&&l[V]||H(l,V,m),K[v]=m,K[r]=A,j)if(i={values:b?m:a(P),keys:E?m:a(F),entries:h},f)for(o in i)o in l||$(l,o,i[o]);else Z(Z.P+Z.F*(L||R),v,i);return i}},function(J,z){J.exports=!0},function(J,z,Q){var G=Q(2),Z="__core-js_shared__",$=G[Z]||(G[Z]={});J.exports=function(H){return $[H]||($[H]={})}},function(J,z,Q){var G,Z,$,H=Q(7),W=Q(41),K=Q(25),U=Q(16),B=Q(2),O=B.process,V=B.setImmediate,L=B.clearImmediate,q=B.MessageChannel,F=0,P={},A="onreadystatechange",w=function(){var T=+this;if(P.hasOwnProperty(T)){var D=P[T];delete P[T],D()}},v=function(T){w.call(T.data)};V&&L||(V=function(T){for(var D=[],j=1;arguments.length>j;)D.push(arguments[j++]);return P[++F]=function(){W(typeof T=="function"?T:Function(T),D)},G(F),F},L=function(T){delete P[T]},Q(11)(O)=="process"?G=function(T){O.nextTick(H(w,T,1))}:q?(Z=new q,$=Z.port2,Z.port1.onmessage=v,G=H($.postMessage,$,1)):B.addEventListener&&typeof postMessage=="function"&&!B.importScripts?(G=function(T){B.postMessage(T+"","*")},B.addEventListener("message",v,!1)):G=(A in U("script"))?function(T){K.appendChild(U("script"))[A]=function(){K.removeChild(this),w.call(T)}}:function(T){setTimeout(H(w,T,1),0)}),J.exports={set:V,clear:L}},function(J,z,Q){var G=Q(20),Z=Math.min;J.exports=function($){return $>0?Z(G($),9007199254740991):0}},function(J,z,Q){var G=Q(9);J.exports=function(Z,$){if(!G(Z))return Z;var H,W;if($&&typeof(H=Z.toString)=="function"&&!G(W=H.call(Z)))return W;if(typeof(H=Z.valueOf)=="function"&&!G(W=H.call(Z)))return W;if(!$&&typeof(H=Z.toString)=="function"&&!G(W=H.call(Z)))return W;throw TypeError("Can't convert object to primitive value")}},function(J,z){var Q=0,G=Math.random();J.exports=function(Z){return"Symbol(".concat(Z===void 0?"":Z,")_",(++Q+G).toString(36))}},function(J,z,Q){function G(A){return A&&A.__esModule?A:{default:A}}function Z(){return process.platform!=="win32"?"":process.arch==="ia32"&&process.env.hasOwnProperty("PROCESSOR_ARCHITEW6432")?"mixed":"native"}function $(A){return(0,V.createHash)("sha256").update(A).digest("hex")}function H(A){switch(q){case"darwin":return A.split("IOPlatformUUID")[1].split(`
`)[0].replace(/\=|\s+|\"/gi,"").toLowerCase();case"win32":return A.toString().split("REG_SZ")[1].replace(/\r+|\n+|\s+/gi,"").toLowerCase();case"linux":return A.toString().replace(/\r+|\n+|\s+/gi,"").toLowerCase();case"freebsd":return A.toString().replace(/\r+|\n+|\s+/gi,"").toLowerCase();default:throw Error("Unsupported platform: "+process.platform)}}function W(A){var w=H((0,O.execSync)(P[q]).toString());return A?w:$(w)}function K(A){return new B.default(function(w,v){return(0,O.exec)(P[q],{},function(T,D,j){if(T)return v(Error("Error while obtaining machine id: "+T.stack));var E=H(D.toString());return w(A?E:$(E))})})}Object.defineProperty(z,"__esModule",{value:!0});var U=Q(35),B=G(U);z.machineIdSync=W,z.machineId=K;var O=Q(70),V=Q(71),L=process,q=L.platform,F={native:"%windir%\\System32",mixed:"%windir%\\sysnative\\cmd.exe /c %windir%\\System32"},P={darwin:"ioreg -rd1 -c IOPlatformExpertDevice",win32:F[Z()]+"\\REG.exe QUERY HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Cryptography /v MachineGuid",linux:"( cat /var/lib/dbus/machine-id /etc/machine-id 2> /dev/null || hostname ) | head -n 1 || :",freebsd:"kenv -q smbios.system.uuid || sysctl -n kern.hostuuid"}},function(J,z,Q){J.exports={default:Q(36),__esModule:!0}},function(J,z,Q){Q(66),Q(68),Q(69),Q(67),J.exports=Q(6).Promise},function(J,z){J.exports=function(){}},function(J,z){J.exports=function(Q,G,Z,$){if(!(Q instanceof G)||$!==void 0&&$ in Q)throw TypeError(Z+": incorrect invocation!");return Q}},function(J,z,Q){var G=Q(13),Z=Q(31),$=Q(62);J.exports=function(H){return function(W,K,U){var B,O=G(W),V=Z(O.length),L=$(U,V);if(H&&K!=K){for(;V>L;)if(B=O[L++],B!=B)return!0}else for(;V>L;L++)if((H||(L in O))&&O[L]===K)return H||L||0;return!H&&-1}}},function(J,O,Q){var G=Q(7),Z=Q(44),$=Q(43),H=Q(3),W=Q(31),K=Q(64),U={},B={},O=J.exports=function(V,L,q,F,P){var A,w,v,T,D=P?function(){return V}:K(V),j=G(q,F,L?2:1),E=0;if(typeof D!="function")throw TypeError(V+" is not iterable!");if($(D)){for(A=W(V.length);A>E;E++)if(T=L?j(H(w=V[E])[0],w[1]):j(V[E]),T===U||T===B)return T}else for(v=D.call(V);!(w=v.next()).done;)if(T=Z(v,j,w.value,L),T===U||T===B)return T};O.BREAK=U,O.RETURN=B},function(J,z){J.exports=function(Q,G,Z){var $=Z===void 0;switch(G.length){case 0:return $?Q():Q.call(Z);case 1:return $?Q(G[0]):Q.call(Z,G[0]);case 2:return $?Q(G[0],G[1]):Q.call(Z,G[0],G[1]);case 3:return $?Q(G[0],G[1],G[2]):Q.call(Z,G[0],G[1],G[2]);case 4:return $?Q(G[0],G[1],G[2],G[3]):Q.call(Z,G[0],G[1],G[2],G[3])}return Q.apply(Z,G)}},function(J,z,Q){var G=Q(11);J.exports=Object("z").propertyIsEnumerable(0)?Object:function(Z){return G(Z)=="String"?Z.split(""):Object(Z)}},function(J,z,Q){var G=Q(10),Z=Q(1)("iterator"),$=Array.prototype;J.exports=function(H){return H!==void 0&&(G.Array===H||$[Z]===H)}},function(J,z,Q){var G=Q(3);J.exports=function(Z,$,H,W){try{return W?$(G(H)[0],H[1]):$(H)}catch(U){var K=Z.return;throw K!==void 0&&G(K.call(Z)),U}}},function(J,z,Q){var G=Q(49),Z=Q(17),$=Q(18),H={};Q(5)(H,Q(1)("iterator"),function(){return this}),J.exports=function(W,K,U){W.prototype=G(H,{next:Z(1,U)}),$(W,K+" Iterator")}},function(J,z,Q){var G=Q(1)("iterator"),Z=!1;try{var $=[7][G]();$.return=function(){Z=!0},Array.from($,function(){throw 2})}catch(H){}J.exports=function(H,W){if(!W&&!Z)return!1;var K=!1;try{var U=[7],B=U[G]();B.next=function(){return{done:K=!0}},U[G]=function(){return B},H(U)}catch(O){}return K}},function(J,z){J.exports=function(Q,G){return{value:G,done:!!Q}}},function(J,z,Q){var G=Q(2),Z=Q(30).set,$=G.MutationObserver||G.WebKitMutationObserver,H=G.process,W=G.Promise,K=Q(11)(H)=="process";J.exports=function(){var U,B,O,V=function(){var P,A;for(K&&(P=H.domain)&&P.exit();U;){A=U.fn,U=U.next;try{A()}catch(w){throw U?O():B=void 0,w}}B=void 0,P&&P.enter()};if(K)O=function(){H.nextTick(V)};else if($){var L=!0,q=document.createTextNode("");new $(V).observe(q,{characterData:!0}),O=function(){q.data=L=!L}}else if(W&&W.resolve){var F=W.resolve();O=function(){F.then(V)}}else O=function(){Z.call(G,V)};return function(P){var A={fn:P,next:void 0};B&&(B.next=A),U||(U=A,O()),B=A}}},function(J,z,Q){var G=Q(3),Z=Q(50),$=Q(22),H=Q(19)("IE_PROTO"),W=function(){},K="prototype",U=function(){var B,O=Q(16)("iframe"),V=$.length,L=">";for(O.style.display="none",Q(25).appendChild(O),O.src="javascript:",B=O.contentWindow.document,B.open(),B.write("<script>document.F=Object</script"+L),B.close(),U=B.F;V--;)delete U[K][$[V]];return U()};J.exports=Object.create||function(B,O){var V;return B!==null?(W[K]=G(B),V=new W,W[K]=null,V[H]=B):V=U(),O===void 0?V:Z(V,O)}},function(J,z,Q){var G=Q(12),Z=Q(3),$=Q(54);J.exports=Q(4)?Object.defineProperties:function(H,W){Z(H);for(var K,U=$(W),B=U.length,O=0;B>O;)G.f(H,K=U[O++],W[K]);return H}},function(J,z,Q){var G=Q(55),Z=Q(17),$=Q(13),H=Q(32),W=Q(8),K=Q(26),U=Object.getOwnPropertyDescriptor;z.f=Q(4)?U:function(B,O){if(B=$(B),O=H(O,!0),K)try{return U(B,O)}catch(V){}if(W(B,O))return Z(!G.f.call(B,O),B[O])}},function(J,z,Q){var G=Q(8),Z=Q(63),$=Q(19)("IE_PROTO"),H=Object.prototype;J.exports=Object.getPrototypeOf||function(W){return W=Z(W),G(W,$)?W[$]:typeof W.constructor=="function"&&W instanceof W.constructor?W.constructor.prototype:W instanceof Object?H:null}},function(J,z,Q){var G=Q(8),Z=Q(13),$=Q(39)(!1),H=Q(19)("IE_PROTO");J.exports=function(W,K){var U,B=Z(W),O=0,V=[];for(U in B)U!=H&&G(B,U)&&V.push(U);for(;K.length>O;)G(B,U=K[O++])&&(~$(V,U)||V.push(U));return V}},function(J,z,Q){var G=Q(53),Z=Q(22);J.exports=Object.keys||function($){return G($,Z)}},function(J,z){z.f={}.propertyIsEnumerable},function(J,z,Q){var G=Q(5);J.exports=function(Z,$,H){for(var W in $)H&&Z[W]?Z[W]=$[W]:G(Z,W,$[W]);return Z}},function(J,z,Q){J.exports=Q(5)},function(J,z,Q){var G=Q(9),Z=Q(3),$=function(H,W){if(Z(H),!G(W)&&W!==null)throw TypeError(W+": can't set as prototype!")};J.exports={set:Object.setPrototypeOf||("__proto__"in{}?function(H,W,K){try{K=Q(7)(Function.call,Q(51).f(Object.prototype,"__proto__").set,2),K(H,[]),W=!(H instanceof Array)}catch(U){W=!0}return function(U,B){return $(U,B),W?U.__proto__=B:K(U,B),U}}({},!1):void 0),check:$}},function(J,z,Q){var G=Q(2),Z=Q(6),$=Q(12),H=Q(4),W=Q(1)("species");J.exports=function(K){var U=typeof Z[K]=="function"?Z[K]:G[K];H&&U&&!U[W]&&$.f(U,W,{configurable:!0,get:function(){return this}})}},function(J,z,Q){var G=Q(3),Z=Q(14),$=Q(1)("species");J.exports=function(H,W){var K,U=G(H).constructor;return U===void 0||(K=G(U)[$])==null?W:Z(K)}},function(J,z,Q){var G=Q(20),Z=Q(15);J.exports=function($){return function(H,W){var K,U,B=String(Z(H)),O=G(W),V=B.length;return O<0||O>=V?$?"":void 0:(K=B.charCodeAt(O),K<55296||K>56319||O+1===V||(U=B.charCodeAt(O+1))<56320||U>57343?$?B.charAt(O):K:$?B.slice(O,O+2):(K-55296<<10)+(U-56320)+65536)}}},function(J,z,Q){var G=Q(20),Z=Math.max,$=Math.min;J.exports=function(H,W){return H=G(H),H<0?Z(H+W,0):$(H,W)}},function(J,z,Q){var G=Q(15);J.exports=function(Z){return Object(G(Z))}},function(J,z,Q){var G=Q(21),Z=Q(1)("iterator"),$=Q(10);J.exports=Q(6).getIteratorMethod=function(H){if(H!=null)return H[Z]||H["@@iterator"]||$[G(H)]}},function(J,z,Q){var G=Q(37),Z=Q(47),$=Q(10),H=Q(13);J.exports=Q(27)(Array,"Array",function(W,K){this._t=H(W),this._i=0,this._k=K},function(){var W=this._t,K=this._k,U=this._i++;return!W||U>=W.length?(this._t=void 0,Z(1)):K=="keys"?Z(0,U):K=="values"?Z(0,W[U]):Z(0,[U,W[U]])},"values"),$.Arguments=$.Array,G("keys"),G("values"),G("entries")},function(J,z){},function(J,z,Q){var G,Z,$,H=Q(28),W=Q(2),K=Q(7),U=Q(21),B=Q(23),O=Q(9),V=(Q(3),Q(14)),L=Q(38),q=Q(40),F=(Q(58).set,Q(60)),P=Q(30).set,A=Q(48)(),w="Promise",v=W.TypeError,D=W.process,T=W[w],D=W.process,j=U(D)=="process",E=function(){},f=!!function(){try{var _=T.resolve(1),c=(_.constructor={})[Q(1)("species")]=function(d){d(E,E)};return(j||typeof PromiseRejectionEvent=="function")&&_.then(E)instanceof c}catch(d){}}(),i=function(_,c){return _===c||_===T&&c===$},o=function(_){var c;return!(!O(_)||typeof(c=_.then)!="function")&&c},y=function(_){return i(T,_)?new a(_):new Z(_)},a=Z=function(_){var c,d;this.promise=new _(function(s,W0){if(c!==void 0||d!==void 0)throw v("Bad Promise constructor");c=s,d=W0}),this.resolve=V(c),this.reject=V(d)},r=function(_){try{_()}catch(c){return{error:c}}},b=function(_,c){if(!_._n){_._n=!0;var d=_._c;A(function(){for(var s=_._v,W0=_._s==1,L0=0,X0=function(b0){var J0,P0,n=W0?b0.ok:b0.fail,H0=b0.resolve,O1=b0.reject,p1=b0.domain;try{n?(W0||(_._h==2&&p(_),_._h=1),n===!0?J0=s:(p1&&p1.enter(),J0=n(s),p1&&p1.exit()),J0===b0.promise?O1(v("Promise-chain cycle")):(P0=o(J0))?P0.call(J0,H0,O1):H0(J0)):O1(s)}catch(S1){O1(S1)}};d.length>L0;)X0(d[L0++]);_._c=[],_._n=!1,c&&!_._h&&R(_)})}},R=function(_){P.call(W,function(){var c,d,s,W0=_._v;if(l(_)&&(c=r(function(){j?D.emit("unhandledRejection",W0,_):(d=W.onunhandledrejection)?d({promise:_,reason:W0}):(s=W.console)&&s.error&&s.error("Unhandled promise rejection",W0)}),_._h=j||l(_)?2:1),_._a=void 0,c)throw c.error})},l=function(_){if(_._h==1)return!1;for(var c,d=_._a||_._c,s=0;d.length>s;)if(c=d[s++],c.fail||!l(c.promise))return!1;return!0},p=function(_){P.call(W,function(){var c;j?D.emit("rejectionHandled",_):(c=W.onrejectionhandled)&&c({promise:_,reason:_._v})})},m=function(_){var c=this;c._d||(c._d=!0,c=c._w||c,c._v=_,c._s=2,c._a||(c._a=c._c.slice()),b(c,!0))},h=function(_){var c,d=this;if(!d._d){d._d=!0,d=d._w||d;try{if(d===_)throw v("Promise can't be resolved itself");(c=o(_))?A(function(){var s={_w:d,_d:!1};try{c.call(_,K(h,s,1),K(m,s,1))}catch(W0){m.call(s,W0)}}):(d._v=_,d._s=1,b(d,!1))}catch(s){m.call({_w:d,_d:!1},s)}}};f||(T=function(_){L(this,T,w,"_h"),V(_),G.call(this);try{_(K(h,this,1),K(m,this,1))}catch(c){m.call(this,c)}},G=function(_){this._c=[],this._a=void 0,this._s=0,this._d=!1,this._v=void 0,this._h=0,this._n=!1},G.prototype=Q(56)(T.prototype,{then:function(_,c){var d=y(F(this,T));return d.ok=typeof _!="function"||_,d.fail=typeof c=="function"&&c,d.domain=j?D.domain:void 0,this._c.push(d),this._a&&this._a.push(d),this._s&&b(this,!1),d.promise},catch:function(_){return this.then(void 0,_)}}),a=function(){var _=new G;this.promise=_,this.resolve=K(h,_,1),this.reject=K(m,_,1)}),B(B.G+B.W+B.F*!f,{Promise:T}),Q(18)(T,w),Q(59)(w),$=Q(6)[w],B(B.S+B.F*!f,w,{reject:function(_){var c=y(this),d=c.reject;return d(_),c.promise}}),B(B.S+B.F*(H||!f),w,{resolve:function(_){if(_ instanceof T&&i(_.constructor,this))return _;var c=y(this),d=c.resolve;return d(_),c.promise}}),B(B.S+B.F*!(f&&Q(46)(function(_){T.all(_).catch(E)})),w,{all:function(_){var c=this,d=y(c),s=d.resolve,W0=d.reject,L0=r(function(){var X0=[],b0=0,J0=1;q(_,!1,function(P0){var n=b0++,H0=!1;X0.push(void 0),J0++,c.resolve(P0).then(function(O1){H0||(H0=!0,X0[n]=O1,--J0||s(X0))},W0)}),--J0||s(X0)});return L0&&W0(L0.error),d.promise},race:function(_){var c=this,d=y(c),s=d.reject,W0=r(function(){q(_,!1,function(L0){c.resolve(L0).then(d.resolve,s)})});return W0&&s(W0.error),d.promise}})},function(J,z,Q){var G=Q(61)(!0);Q(27)(String,"String",function(Z){this._t=String(Z),this._i=0},function(){var Z,$=this._t,H=this._i;return H>=$.length?{value:void 0,done:!0}:(Z=G($,H),this._i+=Z.length,{value:Z,done:!1})})},function(J,z,Q){Q(65);for(var G=Q(2),Z=Q(5),$=Q(10),H=Q(1)("toStringTag"),W=["NodeList","DOMTokenList","MediaList","StyleSheetList","CSSRuleList"],K=0;K<5;K++){var U=W[K],B=G[U],O=B&&B.prototype;O&&!O[H]&&Z(O,H,U),$[U]=$.Array}},function(J,z){J.exports=Q0("child_process")},function(J,z){J.exports=Q0("crypto")}])})});var m1=C((Ly0,hS)=>{class gG extends Error{constructor(Y){super(`Format functions must be synchronous taking a two arguments: (info, opts)
Found: ${Y.toString().split(`
`)[0]}
`);Error.captureStackTrace(this,gG)}}hS.exports=(Y)=>{if(Y.length>2)throw new gG(Y);function X(z={}){this.options=z}X.prototype.transform=Y;function J(z){return new X(z)}return J.Format=X,J}});var pS=C((Ny0,gS)=>{var uS={};gS.exports=uS;var mS={reset:[0,0],bold:[1,22],dim:[2,22],italic:[3,23],underline:[4,24],inverse:[7,27],hidden:[8,28],strikethrough:[9,29],black:[30,39],red:[31,39],green:[32,39],yellow:[33,39],blue:[34,39],magenta:[35,39],cyan:[36,39],white:[37,39],gray:[90,39],grey:[90,39],brightRed:[91,39],brightGreen:[92,39],brightYellow:[93,39],brightBlue:[94,39],brightMagenta:[95,39],brightCyan:[96,39],brightWhite:[97,39],bgBlack:[40,49],bgRed:[41,49],bgGreen:[42,49],bgYellow:[43,49],bgBlue:[44,49],bgMagenta:[45,49],bgCyan:[46,49],bgWhite:[47,49],bgGray:[100,49],bgGrey:[100,49],bgBrightRed:[101,49],bgBrightGreen:[102,49],bgBrightYellow:[103,49],bgBrightBlue:[104,49],bgBrightMagenta:[105,49],bgBrightCyan:[106,49],bgBrightWhite:[107,49],blackBG:[40,49],redBG:[41,49],greenBG:[42,49],yellowBG:[43,49],blueBG:[44,49],magentaBG:[45,49],cyanBG:[46,49],whiteBG:[47,49]};Object.keys(mS).forEach(function(Y){var X=mS[Y],J=uS[Y]=[];J.open="\x1B["+X[0]+"m",J.close="\x1B["+X[1]+"m"})});var dS=C((qy0,cS)=>{cS.exports=function(Y,X){X=X||process.argv||[];var J=X.indexOf("--"),z=/^-{1,2}/.test(Y)?"":"--",Q=X.indexOf(z+Y);return Q!==-1&&(J===-1?!0:Q<J)}});var iS=C((xy0,lS)=>{var e40=Q0("os"),F4=dS(),E1=process.env,t6=void 0;if(F4("no-color")||F4("no-colors")||F4("color=false"))t6=!1;else if(F4("color")||F4("colors")||F4("color=true")||F4("color=always"))t6=!0;if("FORCE_COLOR"in E1)t6=E1.FORCE_COLOR.length===0||parseInt(E1.FORCE_COLOR,10)!==0;function Y80(Y){if(Y===0)return!1;return{level:Y,hasBasic:!0,has256:Y>=2,has16m:Y>=3}}function X80(Y){if(t6===!1)return 0;if(F4("color=16m")||F4("color=full")||F4("color=truecolor"))return 3;if(F4("color=256"))return 2;if(Y&&!Y.isTTY&&t6!==!0)return 0;var X=t6?1:0;if(process.platform==="win32"){var J=e40.release().split(".");if(Number(process.versions.node.split(".")[0])>=8&&Number(J[0])>=10&&Number(J[2])>=10586)return Number(J[2])>=14931?3:2;return 1}if("CI"in E1){if(["TRAVIS","CIRCLECI","APPVEYOR","GITLAB_CI"].some(function(Q){return Q in E1})||E1.CI_NAME==="codeship")return 1;return X}if("TEAMCITY_VERSION"in E1)return/^(9\.(0*[1-9]\d*)\.|\d{2,}\.)/.test(E1.TEAMCITY_VERSION)?1:0;if("TERM_PROGRAM"in E1){var z=parseInt((E1.TERM_PROGRAM_VERSION||"").split(".")[0],10);switch(E1.TERM_PROGRAM){case"iTerm.app":return z>=3?3:2;case"Hyper":return 3;case"Apple_Terminal":return 2}}if(/-256(color)?$/i.test(E1.TERM))return 2;if(/^screen|^xterm|^vt100|^rxvt|color|ansi|cygwin|linux/i.test(E1.TERM))return 1;if("COLORTERM"in E1)return 1;if(E1.TERM==="dumb")return X;return X}function pG(Y){var X=X80(Y);return Y80(X)}lS.exports={supportsColor:pG,stdout:pG(process.stdout),stderr:pG(process.stderr)}});var oS=C((Fy0,nS)=>{nS.exports=function(X,J){var z="";X=X||"Run the trap, drop the bass",X=X.split("");var Q={a:["@","","","","","",""],b:["","","","","",""],c:["","",""],d:["","","","","",""],e:["","","","","","","",""],f:[""],g:[""],h:["","","","","",""],i:[""],j:[""],k:["","","",""],l:[""],m:["","","","","",""],n:["","","","","",""],o:["","","","","","","","",""],p:["",""],q:[""],r:["","","","","",""],s:["","","",""],t:["","",""],u:["",""],v:[""],w:["","","",""],x:["","","",""],y:["","",""],z:["",""]};return X.forEach(function(G){G=G.toLowerCase();var Z=Q[G]||[" "],$=Math.floor(Math.random()*Z.length);if(typeof Q[G]<"u")z+=Q[G][$];else z+=G}),z}});var sS=C((Py0,aS)=>{aS.exports=function(X,J){X=X||"   he is here   ";var z={up:["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""],down:["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""],mid:["","","","","","","","","","","","","","","","","","","","",""," "]},Q=[].concat(z.up,z.down,z.mid);function G(H){var W=Math.floor(Math.random()*H);return W}function Z(H){var W=!1;return Q.filter(function(K){W=K===H}),W}function $(H,W){var K="",U,B;W=W||{},W.up=typeof W.up<"u"?W.up:!0,W.mid=typeof W.mid<"u"?W.mid:!0,W.down=typeof W.down<"u"?W.down:!0,W.size=typeof W.size<"u"?W.size:"maxi",H=H.split("");for(B in H){if(Z(B))continue;switch(K=K+H[B],U={up:0,down:0,mid:0},W.size){case"mini":U.up=G(8),U.mid=G(2),U.down=G(8);break;case"maxi":U.up=G(16)+3,U.mid=G(4)+1,U.down=G(64)+3;break;default:U.up=G(8)+1,U.mid=G(6)/2,U.down=G(8)+1;break}var O=["up","mid","down"];for(var V in O){var L=O[V];for(var q=0;q<=U[L];q++)if(W[L])K=K+z[L][G(z[L].length)]}}return K}return $(X,J)}});var tS=C((Ay0,rS)=>{rS.exports=function(Y){return function(X,J,z){if(X===" ")return X;switch(J%3){case 0:return Y.red(X);case 1:return Y.white(X);case 2:return Y.blue(X)}}}});var Yk=C((wy0,eS)=>{eS.exports=function(Y){return function(X,J,z){return J%2===0?X:Y.inverse(X)}}});var Jk=C((Ty0,Xk)=>{Xk.exports=function(Y){var X=["red","yellow","green","blue","magenta"];return function(J,z,Q){if(J===" ")return J;else return Y[X[z++%X.length]](J)}}});var Qk=C((Iy0,zk)=>{zk.exports=function(Y){var X=["underline","inverse","grey","yellow","red","green","blue","white","cyan","magenta","brightYellow","brightRed","brightGreen","brightBlue","brightWhite","brightCyan","brightMagenta"];return function(J,z,Q){return J===" "?J:Y[X[Math.round(Math.random()*(X.length-2))]](J)}}});var Wk=C((Dy0,Hk)=>{var T0={};Hk.exports=T0;T0.themes={};var J80=Q0("util"),Y6=T0.styles=pS(),Gk=Object.defineProperties,z80=new RegExp(/[\r\n]+/g);T0.supportsColor=iS().supportsColor;if(typeof T0.enabled>"u")T0.enabled=T0.supportsColor()!==!1;T0.enable=function(){T0.enabled=!0};T0.disable=function(){T0.enabled=!1};T0.stripColors=T0.strip=function(Y){return(""+Y).replace(/\x1B\[\d+m/g,"")};var vy0=T0.stylize=function(X,J){if(!T0.enabled)return X+"";var z=Y6[J];if(!z&&J in T0)return T0[J](X);return z.open+X+z.close},Q80=/[|\\{}()[\]^$+*?.]/g,G80=function(Y){if(typeof Y!=="string")throw TypeError("Expected a string");return Y.replace(Q80,"\\$&")};function Zk(Y){var X=function J(){return $80.apply(J,arguments)};return X._styles=Y,X.__proto__=Z80,X}var $k=function(){var Y={};return Y6.grey=Y6.gray,Object.keys(Y6).forEach(function(X){Y6[X].closeRe=new RegExp(G80(Y6[X].close),"g"),Y[X]={get:function(){return Zk(this._styles.concat(X))}}}),Y}(),Z80=Gk(function(){},$k);function $80(){var Y=Array.prototype.slice.call(arguments),X=Y.map(function(Z){if(Z!=null&&Z.constructor===String)return Z;else return J80.inspect(Z)}).join(" ");if(!T0.enabled||!X)return X;var J=X.indexOf(`
`)!=-1,z=this._styles,Q=z.length;while(Q--){var G=Y6[z[Q]];if(X=G.open+X.replace(G.closeRe,G.open)+G.close,J)X=X.replace(z80,function(Z){return G.close+Z+G.open})}return X}T0.setTheme=function(Y){if(typeof Y==="string"){console.log("colors.setTheme now only accepts an object, not a string.  If you are trying to set a theme from a file, it is now your (the caller's) responsibility to require the file.  The old syntax looked like colors.setTheme(__dirname + '/../themes/generic-logging.js'); The new syntax looks like colors.setTheme(require(__dirname + '/../themes/generic-logging.js'));");return}for(var X in Y)(function(J){T0[J]=function(z){if(typeof Y[J]==="object"){var Q=z;for(var G in Y[J])Q=T0[Y[J][G]](Q);return Q}return T0[Y[J]](z)}})(X)};function H80(){var Y={};return Object.keys($k).forEach(function(X){Y[X]={get:function(){return Zk([X])}}}),Y}var W80=function(X,J){var z=J.split("");return z=z.map(X),z.join("")};T0.trap=oS();T0.zalgo=sS();T0.maps={};T0.maps.america=tS()(T0);T0.maps.zebra=Yk()(T0);T0.maps.rainbow=Jk()(T0);T0.maps.random=Qk()(T0);for(cG in T0.maps)(function(Y){T0[Y]=function(X){return W80(T0.maps[Y],X)}})(cG);var cG;Gk(T0,H80())});var dG=C((jy0,Kk)=>{var K80=Wk();Kk.exports=K80});var Uk=C((U80)=>{U80.levels={error:0,warn:1,help:2,data:3,info:4,debug:5,prompt:6,verbose:7,input:8,silly:9};U80.colors={error:"red",warn:"yellow",help:"cyan",data:"grey",info:"green",debug:"blue",prompt:"grey",verbose:"cyan",input:"grey",silly:"magenta"}});var Bk=C((O80)=>{O80.levels={error:0,warn:1,info:2,http:3,verbose:4,debug:5,silly:6};O80.colors={error:"red",warn:"yellow",info:"green",http:"green",verbose:"cyan",debug:"blue",silly:"magenta"}});var Vk=C((N80)=>{N80.levels={emerg:0,alert:1,crit:2,error:3,warning:4,notice:5,info:6,debug:7};N80.colors={emerg:"red",alert:"yellow",crit:"red",error:"red",warning:"red",notice:"yellow",info:"green",debug:"blue"}});var Ok=C((NY)=>{Object.defineProperty(NY,"cli",{value:Uk()});Object.defineProperty(NY,"npm",{value:Bk()});Object.defineProperty(NY,"syslog",{value:Vk()})});var J1=C((h7)=>{Object.defineProperty(h7,"LEVEL",{value:Symbol.for("level")});Object.defineProperty(h7,"MESSAGE",{value:Symbol.for("message")});Object.defineProperty(h7,"SPLAT",{value:Symbol.for("splat")});Object.defineProperty(h7,"configs",{value:Ok()})});var xY=C((by0,qY)=>{var nG=dG(),{LEVEL:lG,MESSAGE:iG}=J1();nG.enabled=!0;var Mk=/\s+/;class P4{constructor(Y={}){if(Y.colors)this.addColors(Y.colors);this.options=Y}static addColors(Y){let X=Object.keys(Y).reduce((J,z)=>{return J[z]=Mk.test(Y[z])?Y[z].split(Mk):Y[z],J},{});return P4.allColors=Object.assign({},P4.allColors||{},X),P4.allColors}addColors(Y){return P4.addColors(Y)}colorize(Y,X,J){if(typeof J>"u")J=X;if(!Array.isArray(P4.allColors[Y]))return nG[P4.allColors[Y]](J);for(let z=0,Q=P4.allColors[Y].length;z<Q;z++)J=nG[P4.allColors[Y][z]](J);return J}transform(Y,X){if(X.all&&typeof Y[iG]==="string")Y[iG]=this.colorize(Y[lG],Y.level,Y[iG]);if(X.level||X.all||!X.message)Y.level=this.colorize(Y[lG],Y.level);if(X.all||X.message)Y.message=this.colorize(Y[lG],Y.level,Y.message);return Y}}qY.exports=(Y)=>new P4(Y);qY.exports.Colorizer=qY.exports.Format=P4});var Nk=C((Ry0,Lk)=>{var{Colorizer:F80}=xY();Lk.exports=(Y)=>{return F80.addColors(Y.colors||Y),Y}});var xk=C((fy0,qk)=>{var P80=m1();qk.exports=P80((Y)=>{return Y.message=`	${Y.message}`,Y})});var Ak=C((yy0,Pk)=>{var A80=m1(),{LEVEL:Fk,MESSAGE:oG}=J1();Pk.exports=A80((Y,{stack:X,cause:J})=>{if(Y instanceof Error){let Q=Object.assign({},Y,{level:Y.level,[Fk]:Y[Fk]||Y.level,message:Y.message,[oG]:Y[oG]||Y.message});if(X)Q.stack=Y.stack;if(J)Q.cause=Y.cause;return Q}if(!(Y.message instanceof Error))return Y;let z=Y.message;if(Object.assign(Y,z),Y.message=z.message,Y[oG]=z.message,X)Y.stack=z.stack;if(J)Y.cause=z.cause;return Y})});var sG=C((hy0,FY)=>{var{configs:w80,LEVEL:wk,MESSAGE:aG}=J1();class e6{constructor(Y={levels:w80.npm.levels}){this.paddings=e6.paddingForLevels(Y.levels,Y.filler),this.options=Y}static getLongestLevel(Y){let X=Object.keys(Y).map((J)=>J.length);return Math.max(...X)}static paddingForLevel(Y,X,J){let z=J+1-Y.length,Q=Math.floor(z/X.length);return`${X}${X.repeat(Q)}`.slice(0,z)}static paddingForLevels(Y,X=" "){let J=e6.getLongestLevel(Y);return Object.keys(Y).reduce((z,Q)=>{return z[Q]=e6.paddingForLevel(Q,X,J),z},{})}transform(Y,X){if(Y.message=`${this.paddings[Y[wk]]}${Y.message}`,Y[aG])Y[aG]=`${this.paddings[Y[wk]]}${Y[aG]}`;return Y}}FY.exports=(Y)=>new e6(Y);FY.exports.Padder=FY.exports.Format=e6});var Tk=C((my0,tG)=>{var{Colorizer:T80}=xY(),{Padder:I80}=sG(),{configs:v80,MESSAGE:D80}=J1();class rG{constructor(Y={}){if(!Y.levels)Y.levels=v80.cli.levels;this.colorizer=new T80(Y),this.padder=new I80(Y),this.options=Y}transform(Y,X){return this.colorizer.transform(this.padder.transform(Y,X),X),Y[D80]=`${Y.level}:${Y.message}`,Y}}tG.exports=(Y)=>new rG(Y);tG.exports.Format=rG});var vk=C((uy0,eG)=>{var j80=m1();function Ik(Y){if(!Y.every(C80))return;return(X)=>{let J=X;for(let z=0;z<Y.length;z++)if(J=Y[z].transform(J,Y[z].options),!J)return!1;return J}}function C80(Y){if(typeof Y.transform!=="function")throw Error(["No transform function found on format. Did you create a format instance?","const myFormat = format(formatFn);","const instance = myFormat();"].join(`
`));return!0}eG.exports=(...Y)=>{let X=j80(Ik(Y)),J=X();return J.Format=X.Format,J};eG.exports.cascade=Ik});var u7=C((gy0,Ck)=>{var{hasOwnProperty:m7}=Object.prototype,J6=JZ();J6.configure=JZ;J6.stringify=J6;J6.default=J6;gy0.stringify=J6;gy0.configure=JZ;Ck.exports=J6;var E80=/[\u0000-\u001f\u0022\u005c\ud800-\udfff]/;function I8(Y){if(Y.length<5000&&!E80.test(Y))return`"${Y}"`;return JSON.stringify(Y)}function YZ(Y,X){if(Y.length>200||X)return Y.sort(X);for(let J=1;J<Y.length;J++){let z=Y[J],Q=J;while(Q!==0&&Y[Q-1]>z)Y[Q]=Y[Q-1],Q--;Y[Q]=z}return Y}var S80=Object.getOwnPropertyDescriptor(Object.getPrototypeOf(Object.getPrototypeOf(new Int8Array)),Symbol.toStringTag).get;function XZ(Y){return S80.call(Y)!==void 0&&Y.length!==0}function Dk(Y,X,J){if(Y.length<J)J=Y.length;let z=X===","?"":" ",Q=`"0":${z}${Y[0]}`;for(let G=1;G<J;G++)Q+=`${X}"${G}":${z}${Y[G]}`;return Q}function k80(Y){if(m7.call(Y,"circularValue")){let X=Y.circularValue;if(typeof X==="string")return`"${X}"`;if(X==null)return X;if(X===Error||X===TypeError)return{toString(){throw TypeError("Converting circular structure to JSON")}};throw TypeError('The "circularValue" argument must be of type string or the value null or undefined')}return'"[Circular]"'}function _80(Y){let X;if(m7.call(Y,"deterministic")){if(X=Y.deterministic,typeof X!=="boolean"&&typeof X!=="function")throw TypeError('The "deterministic" argument must be of type boolean or comparator function')}return X===void 0?!0:X}function b80(Y,X){let J;if(m7.call(Y,X)){if(J=Y[X],typeof J!=="boolean")throw TypeError(`The "${X}" argument must be of type boolean`)}return J===void 0?!0:J}function jk(Y,X){let J;if(m7.call(Y,X)){if(J=Y[X],typeof J!=="number")throw TypeError(`The "${X}" argument must be of type number`);if(!Number.isInteger(J))throw TypeError(`The "${X}" argument must be an integer`);if(J<1)throw RangeError(`The "${X}" argument must be >= 1`)}return J===void 0?1/0:J}function X6(Y){if(Y===1)return"1 item";return`${Y} items`}function R80(Y){let X=new Set;for(let J of Y)if(typeof J==="string"||typeof J==="number")X.add(String(J));return X}function f80(Y){if(m7.call(Y,"strict")){let X=Y.strict;if(typeof X!=="boolean")throw TypeError('The "strict" argument must be of type boolean');if(X)return(J)=>{let z=`Object can not safely be stringified. Received type ${typeof J}`;if(typeof J!=="function")z+=` (${J.toString()})`;throw Error(z)}}}function JZ(Y){Y={...Y};let X=f80(Y);if(X){if(Y.bigint===void 0)Y.bigint=!1;if(!("circularValue"in Y))Y.circularValue=Error}let J=k80(Y),z=b80(Y,"bigint"),Q=_80(Y),G=typeof Q==="function"?Q:void 0,Z=jk(Y,"maximumDepth"),$=jk(Y,"maximumBreadth");function H(O,V,L,q,F,P){let A=V[O];if(typeof A==="object"&&A!==null&&typeof A.toJSON==="function")A=A.toJSON(O);switch(A=q.call(V,O,A),typeof A){case"string":return I8(A);case"object":{if(A===null)return"null";if(L.indexOf(A)!==-1)return J;let w="",v=",",T=P;if(Array.isArray(A)){if(A.length===0)return"[]";if(Z<L.length+1)return'"[Array]"';if(L.push(A),F!=="")P+=F,w+=`
${P}`,v=`,
${P}`;let o=Math.min(A.length,$),y=0;for(;y<o-1;y++){let r=H(String(y),A,L,q,F,P);w+=r!==void 0?r:"null",w+=v}let a=H(String(y),A,L,q,F,P);if(w+=a!==void 0?a:"null",A.length-1>$){let r=A.length-$-1;w+=`${v}"... ${X6(r)} not stringified"`}if(F!=="")w+=`
${T}`;return L.pop(),`[${w}]`}let D=Object.keys(A),j=D.length;if(j===0)return"{}";if(Z<L.length+1)return'"[Object]"';let E="",f="";if(F!=="")P+=F,v=`,
${P}`,E=" ";let i=Math.min(j,$);if(Q&&!XZ(A))D=YZ(D,G);L.push(A);for(let o=0;o<i;o++){let y=D[o],a=H(y,A,L,q,F,P);if(a!==void 0)w+=`${f}${I8(y)}:${E}${a}`,f=v}if(j>$){let o=j-$;w+=`${f}"...":${E}"${X6(o)} not stringified"`,f=v}if(F!==""&&f.length>1)w=`
${P}${w}
${T}`;return L.pop(),`{${w}}`}case"number":return isFinite(A)?String(A):X?X(A):"null";case"boolean":return A===!0?"true":"false";case"undefined":return;case"bigint":if(z)return String(A);default:return X?X(A):void 0}}function W(O,V,L,q,F,P){if(typeof V==="object"&&V!==null&&typeof V.toJSON==="function")V=V.toJSON(O);switch(typeof V){case"string":return I8(V);case"object":{if(V===null)return"null";if(L.indexOf(V)!==-1)return J;let A=P,w="",v=",";if(Array.isArray(V)){if(V.length===0)return"[]";if(Z<L.length+1)return'"[Array]"';if(L.push(V),F!=="")P+=F,w+=`
${P}`,v=`,
${P}`;let j=Math.min(V.length,$),E=0;for(;E<j-1;E++){let i=W(String(E),V[E],L,q,F,P);w+=i!==void 0?i:"null",w+=v}let f=W(String(E),V[E],L,q,F,P);if(w+=f!==void 0?f:"null",V.length-1>$){let i=V.length-$-1;w+=`${v}"... ${X6(i)} not stringified"`}if(F!=="")w+=`
${A}`;return L.pop(),`[${w}]`}L.push(V);let T="";if(F!=="")P+=F,v=`,
${P}`,T=" ";let D="";for(let j of q){let E=W(j,V[j],L,q,F,P);if(E!==void 0)w+=`${D}${I8(j)}:${T}${E}`,D=v}if(F!==""&&D.length>1)w=`
${P}${w}
${A}`;return L.pop(),`{${w}}`}case"number":return isFinite(V)?String(V):X?X(V):"null";case"boolean":return V===!0?"true":"false";case"undefined":return;case"bigint":if(z)return String(V);default:return X?X(V):void 0}}function K(O,V,L,q,F){switch(typeof V){case"string":return I8(V);case"object":{if(V===null)return"null";if(typeof V.toJSON==="function"){if(V=V.toJSON(O),typeof V!=="object")return K(O,V,L,q,F);if(V===null)return"null"}if(L.indexOf(V)!==-1)return J;let P=F;if(Array.isArray(V)){if(V.length===0)return"[]";if(Z<L.length+1)return'"[Array]"';L.push(V),F+=q;let E=`
${F}`,f=`,
${F}`,i=Math.min(V.length,$),o=0;for(;o<i-1;o++){let a=K(String(o),V[o],L,q,F);E+=a!==void 0?a:"null",E+=f}let y=K(String(o),V[o],L,q,F);if(E+=y!==void 0?y:"null",V.length-1>$){let a=V.length-$-1;E+=`${f}"... ${X6(a)} not stringified"`}return E+=`
${P}`,L.pop(),`[${E}]`}let A=Object.keys(V),w=A.length;if(w===0)return"{}";if(Z<L.length+1)return'"[Object]"';F+=q;let v=`,
${F}`,T="",D="",j=Math.min(w,$);if(XZ(V))T+=Dk(V,v,$),A=A.slice(V.length),j-=V.length,D=v;if(Q)A=YZ(A,G);L.push(V);for(let E=0;E<j;E++){let f=A[E],i=K(f,V[f],L,q,F);if(i!==void 0)T+=`${D}${I8(f)}: ${i}`,D=v}if(w>$){let E=w-$;T+=`${D}"...": "${X6(E)} not stringified"`,D=v}if(D!=="")T=`
${F}${T}
${P}`;return L.pop(),`{${T}}`}case"number":return isFinite(V)?String(V):X?X(V):"null";case"boolean":return V===!0?"true":"false";case"undefined":return;case"bigint":if(z)return String(V);default:return X?X(V):void 0}}function U(O,V,L){switch(typeof V){case"string":return I8(V);case"object":{if(V===null)return"null";if(typeof V.toJSON==="function"){if(V=V.toJSON(O),typeof V!=="object")return U(O,V,L);if(V===null)return"null"}if(L.indexOf(V)!==-1)return J;let q="",F=V.length!==void 0;if(F&&Array.isArray(V)){if(V.length===0)return"[]";if(Z<L.length+1)return'"[Array]"';L.push(V);let T=Math.min(V.length,$),D=0;for(;D<T-1;D++){let E=U(String(D),V[D],L);q+=E!==void 0?E:"null",q+=","}let j=U(String(D),V[D],L);if(q+=j!==void 0?j:"null",V.length-1>$){let E=V.length-$-1;q+=`,"... ${X6(E)} not stringified"`}return L.pop(),`[${q}]`}let P=Object.keys(V),A=P.length;if(A===0)return"{}";if(Z<L.length+1)return'"[Object]"';let w="",v=Math.min(A,$);if(F&&XZ(V))q+=Dk(V,",",$),P=P.slice(V.length),v-=V.length,w=",";if(Q)P=YZ(P,G);L.push(V);for(let T=0;T<v;T++){let D=P[T],j=U(D,V[D],L);if(j!==void 0)q+=`${w}${I8(D)}:${j}`,w=","}if(A>$){let T=A-$;q+=`${w}"...":"${X6(T)} not stringified"`}return L.pop(),`{${q}}`}case"number":return isFinite(V)?String(V):X?X(V):"null";case"boolean":return V===!0?"true":"false";case"undefined":return;case"bigint":if(z)return String(V);default:return X?X(V):void 0}}function B(O,V,L){if(arguments.length>1){let q="";if(typeof L==="number")q=" ".repeat(Math.min(L,10));else if(typeof L==="string")q=L.slice(0,10);if(V!=null){if(typeof V==="function")return H("",{"":O},[],V,q,"");if(Array.isArray(V))return W("",O,[],R80(V),q,"")}if(q.length!==0)return K("",O,[],q,"")}return U("",O,[])}return B}});var zZ=C((py0,Ek)=>{var m80=m1(),{MESSAGE:u80}=J1(),g80=u7();function p80(Y,X){if(typeof X==="bigint")return X.toString();return X}Ek.exports=m80((Y,X)=>{let J=g80.configure(X);return Y[u80]=J(Y,X.replacer||p80,X.space),Y})});var kk=C((cy0,Sk)=>{var c80=m1();Sk.exports=c80((Y,X)=>{if(X.message)return Y.message=`[${X.label}] ${Y.message}`,Y;return Y.label=X.label,Y})});var bk=C((dy0,_k)=>{var d80=m1(),{MESSAGE:l80}=J1(),i80=u7();_k.exports=d80((Y)=>{let X={};if(Y.message)X["@message"]=Y.message,delete Y.message;if(Y.timestamp)X["@timestamp"]=Y.timestamp,delete Y.timestamp;return X["@fields"]=Y,Y[l80]=i80(X),Y})});var fk=C((ly0,Rk)=>{var n80=m1();function o80(Y,X,J){let z=X.reduce((G,Z)=>{return G[Z]=Y[Z],delete Y[Z],G},{}),Q=Object.keys(Y).reduce((G,Z)=>{return G[Z]=Y[Z],delete Y[Z],G},{});return Object.assign(Y,z,{[J]:Q}),Y}function a80(Y,X,J){return Y[J]=X.reduce((z,Q)=>{return z[Q]=Y[Q],delete Y[Q],z},{}),Y}Rk.exports=n80((Y,X={})=>{let J="metadata";if(X.key)J=X.key;let z=[];if(!X.fillExcept&&!X.fillWith)z.push("level"),z.push("message");if(X.fillExcept)z=X.fillExcept;if(z.length>0)return o80(Y,z,J);if(X.fillWith)return a80(Y,X.fillWith,J);return Y})});var hk=C((g7,yk)=>{var s80=m1(),r80=tz();yk.exports=s80((Y)=>{let X=+new Date;return g7.diff=X-(g7.prevTime||X),g7.prevTime=X,Y.ms=`+${r80(g7.diff)}`,Y})});var gk=C((iy0,uk)=>{var t80=Q0("util").inspect,e80=m1(),{LEVEL:Y60,MESSAGE:mk,SPLAT:X60}=J1();uk.exports=e80((Y,X={})=>{let J=Object.assign({},Y);return delete J[Y60],delete J[mk],delete J[X60],Y[mk]=t80(J,!1,X.depth||null,X.colorize),Y})});var pk=C((ny0,PY)=>{var{MESSAGE:J60}=J1();class QZ{constructor(Y){this.template=Y}transform(Y){return Y[J60]=this.template(Y),Y}}PY.exports=(Y)=>new QZ(Y);PY.exports.Printf=PY.exports.Format=QZ});var lk=C((oy0,dk)=>{var z60=m1(),{MESSAGE:ck}=J1(),Q60=u7();dk.exports=z60((Y)=>{let X=Q60(Object.assign({},Y,{level:void 0,message:void 0,splat:void 0})),J=Y.padding&&Y.padding[Y.level]||"";if(X!=="{}")Y[ck]=`${Y.level}:${J} ${Y.message} ${X}`;else Y[ck]=`${Y.level}:${J} ${Y.message}`;return Y})});var ak=C((ay0,ok)=>{var G60=Q0("util"),{SPLAT:ik}=J1(),Z60=/%[scdjifoO%]/g,$60=/%%/g;class nk{constructor(Y){this.options=Y}_splat(Y,X){let J=Y.message,z=Y[ik]||Y.splat||[],Q=J.match($60),G=Q&&Q.length||0,$=X.length-G-z.length,H=$<0?z.splice($,-1*$):[],W=H.length;if(W)for(let K=0;K<W;K++)Object.assign(Y,H[K]);return Y.message=G60.format(J,...z),Y}transform(Y){let X=Y.message,J=Y[ik]||Y.splat;if(!J||!J.length)return Y;let z=X&&X.match&&X.match(Z60);if(!z&&(J||J.length)){let Q=J.length>1?J.splice(0):J,G=Q.length;if(G)for(let Z=0;Z<G;Z++)Object.assign(Y,Q[Z]);return Y}if(z)return this._splat(Y,z);return Y}}ok.exports=(Y)=>new nk(Y)});var rk=C((AY,sk)=>{(function(Y,X){typeof AY==="object"&&typeof sk<"u"?X(AY):typeof define==="function"&&define.amd?define(["exports"],X):X(Y.fecha={})})(AY,function(Y){var X=/d{1,4}|M{1,4}|YY(?:YY)?|S{1,3}|Do|ZZ|Z|([HhMsDm])\1?|[aA]|"[^"]*"|'[^']*'/g,J="\\d\\d?",z="\\d\\d",Q="\\d{3}",G="\\d{4}",Z="[^\\s]+",$=/\[([^]*?)\]/gm;function H(b,R){var l=[];for(var p=0,m=b.length;p<m;p++)l.push(b[p].substr(0,R));return l}var W=function(b){return function(R,l){var p=l[b].map(function(h){return h.toLowerCase()}),m=p.indexOf(R.toLowerCase());if(m>-1)return m;return null}};function K(b){var R=[];for(var l=1;l<arguments.length;l++)R[l-1]=arguments[l];for(var p=0,m=R;p<m.length;p++){var h=m[p];for(var _ in h)b[_]=h[_]}return b}var U=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],B=["January","February","March","April","May","June","July","August","September","October","November","December"],O=H(B,3),V=H(U,3),L={dayNamesShort:V,dayNames:U,monthNamesShort:O,monthNames:B,amPm:["am","pm"],DoFn:function(b){return b+["th","st","nd","rd"][b%10>3?0:(b-b%10!==10?1:0)*b%10]}},q=K({},L),F=function(b){return q=K(q,b)},P=function(b){return b.replace(/[|\\{()[^$+*?.-]/g,"\\$&")},A=function(b,R){if(R===void 0)R=2;b=String(b);while(b.length<R)b="0"+b;return b},w={D:function(b){return String(b.getDate())},DD:function(b){return A(b.getDate())},Do:function(b,R){return R.DoFn(b.getDate())},d:function(b){return String(b.getDay())},dd:function(b){return A(b.getDay())},ddd:function(b,R){return R.dayNamesShort[b.getDay()]},dddd:function(b,R){return R.dayNames[b.getDay()]},M:function(b){return String(b.getMonth()+1)},MM:function(b){return A(b.getMonth()+1)},MMM:function(b,R){return R.monthNamesShort[b.getMonth()]},MMMM:function(b,R){return R.monthNames[b.getMonth()]},YY:function(b){return A(String(b.getFullYear()),4).substr(2)},YYYY:function(b){return A(b.getFullYear(),4)},h:function(b){return String(b.getHours()%12||12)},hh:function(b){return A(b.getHours()%12||12)},H:function(b){return String(b.getHours())},HH:function(b){return A(b.getHours())},m:function(b){return String(b.getMinutes())},mm:function(b){return A(b.getMinutes())},s:function(b){return String(b.getSeconds())},ss:function(b){return A(b.getSeconds())},S:function(b){return String(Math.round(b.getMilliseconds()/100))},SS:function(b){return A(Math.round(b.getMilliseconds()/10),2)},SSS:function(b){return A(b.getMilliseconds(),3)},a:function(b,R){return b.getHours()<12?R.amPm[0]:R.amPm[1]},A:function(b,R){return b.getHours()<12?R.amPm[0].toUpperCase():R.amPm[1].toUpperCase()},ZZ:function(b){var R=b.getTimezoneOffset();return(R>0?"-":"+")+A(Math.floor(Math.abs(R)/60)*100+Math.abs(R)%60,4)},Z:function(b){var R=b.getTimezoneOffset();return(R>0?"-":"+")+A(Math.floor(Math.abs(R)/60),2)+":"+A(Math.abs(R)%60,2)}},v=function(b){return+b-1},T=[null,J],D=[null,Z],j=["isPm",Z,function(b,R){var l=b.toLowerCase();if(l===R.amPm[0])return 0;else if(l===R.amPm[1])return 1;return null}],E=["timezoneOffset","[^\\s]*?[\\+\\-]\\d\\d:?\\d\\d|[^\\s]*?Z?",function(b){var R=(b+"").match(/([+-]|\d\d)/gi);if(R){var l=+R[1]*60+parseInt(R[2],10);return R[0]==="+"?l:-l}return 0}],f={D:["day",J],DD:["day",z],Do:["day",J+Z,function(b){return parseInt(b,10)}],M:["month",J,v],MM:["month",z,v],YY:["year",z,function(b){var R=new Date,l=+(""+R.getFullYear()).substr(0,2);return+(""+(+b>68?l-1:l)+b)}],h:["hour",J,void 0,"isPm"],hh:["hour",z,void 0,"isPm"],H:["hour",J],HH:["hour",z],m:["minute",J],mm:["minute",z],s:["second",J],ss:["second",z],YYYY:["year",G],S:["millisecond","\\d",function(b){return+b*100}],SS:["millisecond",z,function(b){return+b*10}],SSS:["millisecond",Q],d:T,dd:T,ddd:D,dddd:D,MMM:["month",Z,W("monthNamesShort")],MMMM:["month",Z,W("monthNames")],a:j,A:j,ZZ:E,Z:E},i={default:"ddd MMM DD YYYY HH:mm:ss",shortDate:"M/D/YY",mediumDate:"MMM D, YYYY",longDate:"MMMM D, YYYY",fullDate:"dddd, MMMM D, YYYY",isoDate:"YYYY-MM-DD",isoDateTime:"YYYY-MM-DDTHH:mm:ssZ",shortTime:"HH:mm",mediumTime:"HH:mm:ss",longTime:"HH:mm:ss.SSS"},o=function(b){return K(i,b)},y=function(b,R,l){if(R===void 0)R=i.default;if(l===void 0)l={};if(typeof b==="number")b=new Date(b);if(Object.prototype.toString.call(b)!=="[object Date]"||isNaN(b.getTime()))throw Error("Invalid Date pass to format");R=i[R]||R;var p=[];R=R.replace($,function(h,_){return p.push(_),"@@@"});var m=K(K({},q),l);return R=R.replace(X,function(h){return w[h](b,m)}),R.replace(/@@@/g,function(){return p.shift()})};function a(b,R,l){if(l===void 0)l={};if(typeof R!=="string")throw Error("Invalid format in fecha parse");if(R=i[R]||R,b.length>1000)return null;var p=new Date,m={year:p.getFullYear(),month:0,day:1,hour:0,minute:0,second:0,millisecond:0,isPm:null,timezoneOffset:null},h=[],_=[],c=R.replace($,function(S1,e){return _.push(P(e)),"@@@"}),d={},s={};c=P(c).replace(X,function(S1){var e=f[S1],T1=e[0],J8=e[1],z8=e[3];if(d[T1])throw Error("Invalid format. "+T1+" specified twice in format");if(d[T1]=!0,z8)s[z8]=!0;return h.push(e),"("+J8+")"}),Object.keys(s).forEach(function(S1){if(!d[S1])throw Error("Invalid format. "+S1+" is required in specified format")}),c=c.replace(/@@@/g,function(){return _.shift()});var W0=b.match(new RegExp(c,"i"));if(!W0)return null;var L0=K(K({},q),l);for(var X0=1;X0<W0.length;X0++){var b0=h[X0-1],J0=b0[0],P0=b0[2],n=P0?P0(W0[X0],L0):+W0[X0];if(n==null)return null;m[J0]=n}if(m.isPm===1&&m.hour!=null&&+m.hour!==12)m.hour=+m.hour+12;else if(m.isPm===0&&+m.hour===12)m.hour=0;var H0;if(m.timezoneOffset==null){H0=new Date(m.year,m.month,m.day,m.hour,m.minute,m.second,m.millisecond);var O1=[["month","getMonth"],["day","getDate"],["hour","getHours"],["minute","getMinutes"],["second","getSeconds"]];for(var X0=0,p1=O1.length;X0<p1;X0++)if(d[O1[X0][0]]&&m[O1[X0][0]]!==H0[O1[X0][1]]())return null}else if(H0=new Date(Date.UTC(m.year,m.month,m.day,m.hour,m.minute-m.timezoneOffset,m.second,m.millisecond)),m.month>11||m.month<0||m.day>31||m.day<1||m.hour>23||m.hour<0||m.minute>59||m.minute<0||m.second>59||m.second<0)return null;return H0}var r={format:y,parse:a,defaultI18n:L,setGlobalDateI18n:F,setGlobalDateMasks:o};Y.assign=K,Y.default=r,Y.format=y,Y.parse=a,Y.defaultI18n=L,Y.setGlobalDateI18n=F,Y.setGlobalDateMasks=o,Object.defineProperty(Y,"__esModule",{value:!0})})});var ek=C((sy0,tk)=>{var H60=rk(),W60=m1();tk.exports=W60((Y,X={})=>{if(X.format)Y.timestamp=typeof X.format==="function"?X.format():H60.format(new Date,X.format);if(!Y.timestamp)Y.timestamp=new Date().toISOString();if(X.alias)Y[X.alias]=Y.timestamp;return Y})});var X_=C((ry0,Y_)=>{var GZ=dG(),K60=m1(),{MESSAGE:ZZ}=J1();Y_.exports=K60((Y,X)=>{if(X.level!==!1)Y.level=GZ.strip(Y.level);if(X.message!==!1)Y.message=GZ.strip(String(Y.message));if(X.raw!==!1&&Y[ZZ])Y[ZZ]=GZ.strip(String(Y[ZZ]));return Y})});var $Z=C((B60)=>{var U60=B60.format=m1();B60.levels=Nk();function A1(Y,X){Object.defineProperty(U60,Y,{get(){return X()},configurable:!0})}A1("align",function(){return xk()});A1("errors",function(){return Ak()});A1("cli",function(){return Tk()});A1("combine",function(){return vk()});A1("colorize",function(){return xY()});A1("json",function(){return zZ()});A1("label",function(){return kk()});A1("logstash",function(){return bk()});A1("metadata",function(){return fk()});A1("ms",function(){return hk()});A1("padLevels",function(){return sG()});A1("prettyPrint",function(){return gk()});A1("printf",function(){return pk()});A1("simple",function(){return lk()});A1("splat",function(){return ak()});A1("timestamp",function(){return ek()});A1("uncolorize",function(){return X_()})});var WZ=C((O60)=>{var{format:J_}=Q0("util");O60.warn={deprecated(Y){return()=>{throw Error(J_("{ %s } was removed in winston@3.0.0.",Y))}},useFormat(Y){return()=>{throw Error([J_("{ %s } was removed in winston@3.0.0.",Y),"Use a custom winston.format = winston.format(function) instead."].join(`
`))}},forFunctions(Y,X,J){J.forEach((z)=>{Y[z]=O60.warn[X](z)})},forProperties(Y,X,J){J.forEach((z)=>{let Q=O60.warn[X](z);Object.defineProperty(Y,z,{get:Q,set:Q})})}}});var z_=C((Xh0,M60)=>{M60.exports={name:"winston",description:"A logger for just about everything.",version:"3.19.0",author:"Charlie Robbins <charlie.robbins@gmail.com>",maintainers:["David Hyde <dabh@alumni.stanford.edu>"],repository:{type:"git",url:"https://github.com/winstonjs/winston.git"},keywords:["winston","logger","logging","logs","sysadmin","bunyan","pino","loglevel","tools","json","stream"],dependencies:{"@dabh/diagnostics":"^2.0.8","@colors/colors":"^1.6.0",async:"^3.2.3","is-stream":"^2.0.0",logform:"^2.7.0","one-time":"^1.0.0","readable-stream":"^3.4.0","safe-stable-stringify":"^2.3.1","stack-trace":"0.0.x","triple-beam":"^1.3.0","winston-transport":"^4.9.0"},devDependencies:{"@babel/cli":"^7.23.9","@babel/core":"^7.24.0","@babel/preset-env":"^7.24.0","@dabh/eslint-config-populist":"^4.4.0","@types/node":"^20.11.24","abstract-winston-transport":"^0.5.1",assume:"^2.2.0","cross-spawn-async":"^2.2.5",eslint:"^8.57.0",hock:"^1.4.1",jest:"^29.7.0",rimraf:"5.0.10",split2:"^4.1.0","std-mocks":"^2.0.0",through2:"^4.0.2","winston-compat":"^0.1.5"},main:"./lib/winston.js",browser:"./dist/winston",types:"./index.d.ts",scripts:{lint:"eslint lib/*.js lib/winston/*.js lib/winston/**/*.js --resolve-plugins-relative-to ./node_modules/@dabh/eslint-config-populist",test:"jest","test:unit":"jest -c test/jest.config.unit.js","test:integration":"jest -c test/jest.config.integration.js","test:typescript":"npx --package typescript tsc --project test",build:"babel lib -d dist",prebuild:"rimraf dist",prepublishOnly:"npm run build"},engines:{node:">= 12.0.0"},license:"MIT"}});var G_=C((Jh0,Q_)=>{Q_.exports=Q0("util").deprecate});var UZ=C((zh0,$_)=>{function L60(Y,X){var J=this,z=this._readableState&&this._readableState.destroyed,Q=this._writableState&&this._writableState.destroyed;if(z||Q){if(X)X(Y);else if(Y){if(!this._writableState)process.nextTick(KZ,this,Y);else if(!this._writableState.errorEmitted)this._writableState.errorEmitted=!0,process.nextTick(KZ,this,Y)}return this}if(this._readableState)this._readableState.destroyed=!0;if(this._writableState)this._writableState.destroyed=!0;return this._destroy(Y||null,function(G){if(!X&&G)if(!J._writableState)process.nextTick(Z_,J,G);else if(!J._writableState.errorEmitted)J._writableState.errorEmitted=!0,process.nextTick(Z_,J,G);else process.nextTick(wY,J);else if(X)process.nextTick(wY,J),X(G);else process.nextTick(wY,J)}),this}function Z_(Y,X){KZ(Y,X),wY(Y)}function wY(Y){if(Y._writableState&&!Y._writableState.emitClose)return;if(Y._readableState&&!Y._readableState.emitClose)return;Y.emit("close")}function N60(){if(this._readableState)this._readableState.destroyed=!1,this._readableState.reading=!1,this._readableState.ended=!1,this._readableState.endEmitted=!1;if(this._writableState)this._writableState.destroyed=!1,this._writableState.ended=!1,this._writableState.ending=!1,this._writableState.finalCalled=!1,this._writableState.prefinished=!1,this._writableState.finished=!1,this._writableState.errorEmitted=!1}function KZ(Y,X){Y.emit("error",X)}function q60(Y,X){var{_readableState:J,_writableState:z}=Y;if(J&&J.autoDestroy||z&&z.autoDestroy)Y.destroy(X);else Y.emit("error",X)}$_.exports={destroy:L60,undestroy:N60,errorOrDestroy:q60}});var v8=C((A60,K_)=>{var W_={};function z4(Y,X,J){if(!J)J=Error;function z(G,Z,$){if(typeof X==="string")return X;else return X(G,Z,$)}class Q extends J{constructor(G,Z,$){super(z(G,Z,$))}}Q.prototype.name=J.name,Q.prototype.code=Y,W_[Y]=Q}function H_(Y,X){if(Array.isArray(Y)){let J=Y.length;if(Y=Y.map((z)=>String(z)),J>2)return`one of ${X} ${Y.slice(0,J-1).join(", ")}, or `+Y[J-1];else if(J===2)return`one of ${X} ${Y[0]} or ${Y[1]}`;else return`of ${X} ${Y[0]}`}else return`of ${X} ${String(Y)}`}function x60(Y,X,J){return Y.substr(!J||J<0?0:+J,X.length)===X}function F60(Y,X,J){if(J===void 0||J>Y.length)J=Y.length;return Y.substring(J-X.length,J)===X}function P60(Y,X,J){if(typeof J!=="number")J=0;if(J+X.length>Y.length)return!1;else return Y.indexOf(X,J)!==-1}z4("ERR_INVALID_OPT_VALUE",function(Y,X){return'The value "'+X+'" is invalid for option "'+Y+'"'},TypeError);z4("ERR_INVALID_ARG_TYPE",function(Y,X,J){let z;if(typeof X==="string"&&x60(X,"not "))z="must not be",X=X.replace(/^not /,"");else z="must be";let Q;if(F60(Y," argument"))Q=`The ${Y} ${z} ${H_(X,"type")}`;else{let G=P60(Y,".")?"property":"argument";Q=`The "${Y}" ${G} ${z} ${H_(X,"type")}`}return Q+=`. Received type ${typeof J}`,Q},TypeError);z4("ERR_STREAM_PUSH_AFTER_EOF","stream.push() after EOF");z4("ERR_METHOD_NOT_IMPLEMENTED",function(Y){return"The "+Y+" method is not implemented"});z4("ERR_STREAM_PREMATURE_CLOSE","Premature close");z4("ERR_STREAM_DESTROYED",function(Y){return"Cannot call "+Y+" after a stream was destroyed"});z4("ERR_MULTIPLE_CALLBACK","Callback called multiple times");z4("ERR_STREAM_CANNOT_PIPE","Cannot pipe, not readable");z4("ERR_STREAM_WRITE_AFTER_END","write after end");z4("ERR_STREAM_NULL_VALUES","May not write null values to stream",TypeError);z4("ERR_UNKNOWN_ENCODING",function(Y){return"Unknown encoding: "+Y},TypeError);z4("ERR_STREAM_UNSHIFT_AFTER_END_EVENT","stream.unshift() after end event");A60.codes=W_});var BZ=C((Qh0,U_)=>{var T60=v8().codes.ERR_INVALID_OPT_VALUE;function I60(Y,X,J){return Y.highWaterMark!=null?Y.highWaterMark:X?Y[J]:null}function v60(Y,X,J,z){var Q=I60(X,z,J);if(Q!=null){if(!(isFinite(Q)&&Math.floor(Q)===Q)||Q<0){var G=z?J:"highWaterMark";throw new T60(G,Q)}return Math.floor(Q)}return Y.objectMode?16:16384}U_.exports={getHighWaterMark:v60}});var B_=C((Gh0,VZ)=>{if(typeof Object.create==="function")VZ.exports=function(X,J){if(J)X.super_=J,X.prototype=Object.create(J.prototype,{constructor:{value:X,enumerable:!1,writable:!0,configurable:!0}})};else VZ.exports=function(X,J){if(J){X.super_=J;var z=function(){};z.prototype=J.prototype,X.prototype=new z,X.prototype.constructor=X}}});var Y5=C((Zh0,OZ)=>{try{if(TY=Q0("util"),typeof TY.inherits!=="function")throw"";OZ.exports=TY.inherits}catch(Y){OZ.exports=B_()}var TY});var q_=C(($h0,N_)=>{function V_(Y,X){var J=Object.keys(Y);if(Object.getOwnPropertySymbols){var z=Object.getOwnPropertySymbols(Y);X&&(z=z.filter(function(Q){return Object.getOwnPropertyDescriptor(Y,Q).enumerable})),J.push.apply(J,z)}return J}function O_(Y){for(var X=1;X<arguments.length;X++){var J=arguments[X]!=null?arguments[X]:{};X%2?V_(Object(J),!0).forEach(function(z){D60(Y,z,J[z])}):Object.getOwnPropertyDescriptors?Object.defineProperties(Y,Object.getOwnPropertyDescriptors(J)):V_(Object(J)).forEach(function(z){Object.defineProperty(Y,z,Object.getOwnPropertyDescriptor(J,z))})}return Y}function D60(Y,X,J){if(X=L_(X),X in Y)Object.defineProperty(Y,X,{value:J,enumerable:!0,configurable:!0,writable:!0});else Y[X]=J;return Y}function j60(Y,X){if(!(Y instanceof X))throw TypeError("Cannot call a class as a function")}function M_(Y,X){for(var J=0;J<X.length;J++){var z=X[J];if(z.enumerable=z.enumerable||!1,z.configurable=!0,"value"in z)z.writable=!0;Object.defineProperty(Y,L_(z.key),z)}}function C60(Y,X,J){if(X)M_(Y.prototype,X);if(J)M_(Y,J);return Object.defineProperty(Y,"prototype",{writable:!1}),Y}function L_(Y){var X=E60(Y,"string");return typeof X==="symbol"?X:String(X)}function E60(Y,X){if(typeof Y!=="object"||Y===null)return Y;var J=Y[Symbol.toPrimitive];if(J!==void 0){var z=J.call(Y,X||"default");if(typeof z!=="object")return z;throw TypeError("@@toPrimitive must return a primitive value.")}return(X==="string"?String:Number)(Y)}var S60=Q0("buffer"),IY=S60.Buffer,k60=Q0("util"),MZ=k60.inspect,_60=MZ&&MZ.custom||"inspect";function b60(Y,X,J){IY.prototype.copy.call(Y,X,J)}N_.exports=function(){function Y(){j60(this,Y),this.head=null,this.tail=null,this.length=0}return C60(Y,[{key:"push",value:function(J){var z={data:J,next:null};if(this.length>0)this.tail.next=z;else this.head=z;this.tail=z,++this.length}},{key:"unshift",value:function(J){var z={data:J,next:this.head};if(this.length===0)this.tail=z;this.head=z,++this.length}},{key:"shift",value:function(){if(this.length===0)return;var J=this.head.data;if(this.length===1)this.head=this.tail=null;else this.head=this.head.next;return--this.length,J}},{key:"clear",value:function(){this.head=this.tail=null,this.length=0}},{key:"join",value:function(J){if(this.length===0)return"";var z=this.head,Q=""+z.data;while(z=z.next)Q+=J+z.data;return Q}},{key:"concat",value:function(J){if(this.length===0)return IY.alloc(0);var z=IY.allocUnsafe(J>>>0),Q=this.head,G=0;while(Q)b60(Q.data,z,G),G+=Q.data.length,Q=Q.next;return z}},{key:"consume",value:function(J,z){var Q;if(J<this.head.data.length)Q=this.head.data.slice(0,J),this.head.data=this.head.data.slice(J);else if(J===this.head.data.length)Q=this.shift();else Q=z?this._getString(J):this._getBuffer(J);return Q}},{key:"first",value:function(){return this.head.data}},{key:"_getString",value:function(J){var z=this.head,Q=1,G=z.data;J-=G.length;while(z=z.next){var Z=z.data,$=J>Z.length?Z.length:J;if($===Z.length)G+=Z;else G+=Z.slice(0,J);if(J-=$,J===0){if($===Z.length)if(++Q,z.next)this.head=z.next;else this.head=this.tail=null;else this.head=z,z.data=Z.slice($);break}++Q}return this.length-=Q,G}},{key:"_getBuffer",value:function(J){var z=IY.allocUnsafe(J),Q=this.head,G=1;Q.data.copy(z),J-=Q.data.length;while(Q=Q.next){var Z=Q.data,$=J>Z.length?Z.length:J;if(Z.copy(z,z.length-J,0,$),J-=$,J===0){if($===Z.length)if(++G,Q.next)this.head=Q.next;else this.head=this.tail=null;else this.head=Q,Q.data=Z.slice($);break}++G}return this.length-=G,z}},{key:_60,value:function(J,z){return MZ(this,O_(O_({},z),{},{depth:0,customInspect:!1}))}}]),Y}()});var P_=C((LZ,F_)=>{/*! safe-buffer. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> */var vY=Q0("buffer"),k4=vY.Buffer;function x_(Y,X){for(var J in Y)X[J]=Y[J]}if(k4.from&&k4.alloc&&k4.allocUnsafe&&k4.allocUnsafeSlow)F_.exports=vY;else x_(vY,LZ),LZ.Buffer=z6;function z6(Y,X,J){return k4(Y,X,J)}z6.prototype=Object.create(k4.prototype);x_(k4,z6);z6.from=function(Y,X,J){if(typeof Y==="number")throw TypeError("Argument must not be a number");return k4(Y,X,J)};z6.alloc=function(Y,X,J){if(typeof Y!=="number")throw TypeError("Argument must be a number");var z=k4(Y);if(X!==void 0)if(typeof J==="string")z.fill(X,J);else z.fill(X);else z.fill(0);return z};z6.allocUnsafe=function(Y){if(typeof Y!=="number")throw TypeError("Argument must be a number");return k4(Y)};z6.allocUnsafeSlow=function(Y){if(typeof Y!=="number")throw TypeError("Argument must be a number");return vY.SlowBuffer(Y)}});var xZ=C((o60)=>{var qZ=P_().Buffer,A_=qZ.isEncoding||function(Y){switch(Y=""+Y,Y&&Y.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};function R60(Y){if(!Y)return"utf8";var X;while(!0)switch(Y){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return Y;default:if(X)return;Y=(""+Y).toLowerCase(),X=!0}}function f60(Y){var X=R60(Y);if(typeof X!=="string"&&(qZ.isEncoding===A_||!A_(Y)))throw Error("Unknown encoding: "+Y);return X||Y}o60.StringDecoder=p7;function p7(Y){this.encoding=f60(Y);var X;switch(this.encoding){case"utf16le":this.text=p60,this.end=c60,X=4;break;case"utf8":this.fillLast=m60,X=4;break;case"base64":this.text=d60,this.end=l60,X=3;break;default:this.write=i60,this.end=n60;return}this.lastNeed=0,this.lastTotal=0,this.lastChar=qZ.allocUnsafe(X)}p7.prototype.write=function(Y){if(Y.length===0)return"";var X,J;if(this.lastNeed){if(X=this.fillLast(Y),X===void 0)return"";J=this.lastNeed,this.lastNeed=0}else J=0;if(J<Y.length)return X?X+this.text(Y,J):this.text(Y,J);return X||""};p7.prototype.end=g60;p7.prototype.text=u60;p7.prototype.fillLast=function(Y){if(this.lastNeed<=Y.length)return Y.copy(this.lastChar,this.lastTotal-this.lastNeed,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);Y.copy(this.lastChar,this.lastTotal-this.lastNeed,0,Y.length),this.lastNeed-=Y.length};function NZ(Y){if(Y<=127)return 0;else if(Y>>5===6)return 2;else if(Y>>4===14)return 3;else if(Y>>3===30)return 4;return Y>>6===2?-1:-2}function y60(Y,X,J){var z=X.length-1;if(z<J)return 0;var Q=NZ(X[z]);if(Q>=0){if(Q>0)Y.lastNeed=Q-1;return Q}if(--z<J||Q===-2)return 0;if(Q=NZ(X[z]),Q>=0){if(Q>0)Y.lastNeed=Q-2;return Q}if(--z<J||Q===-2)return 0;if(Q=NZ(X[z]),Q>=0){if(Q>0)if(Q===2)Q=0;else Y.lastNeed=Q-3;return Q}return 0}function h60(Y,X,J){if((X[0]&192)!==128)return Y.lastNeed=0,"";if(Y.lastNeed>1&&X.length>1){if((X[1]&192)!==128)return Y.lastNeed=1,"";if(Y.lastNeed>2&&X.length>2){if((X[2]&192)!==128)return Y.lastNeed=2,""}}}function m60(Y){var X=this.lastTotal-this.lastNeed,J=h60(this,Y,X);if(J!==void 0)return J;if(this.lastNeed<=Y.length)return Y.copy(this.lastChar,X,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);Y.copy(this.lastChar,X,0,Y.length),this.lastNeed-=Y.length}function u60(Y,X){var J=y60(this,Y,X);if(!this.lastNeed)return Y.toString("utf8",X);this.lastTotal=J;var z=Y.length-(J-this.lastNeed);return Y.copy(this.lastChar,0,z),Y.toString("utf8",X,z)}function g60(Y){var X=Y&&Y.length?this.write(Y):"";if(this.lastNeed)return X+"";return X}function p60(Y,X){if((Y.length-X)%2===0){var J=Y.toString("utf16le",X);if(J){var z=J.charCodeAt(J.length-1);if(z>=55296&&z<=56319)return this.lastNeed=2,this.lastTotal=4,this.lastChar[0]=Y[Y.length-2],this.lastChar[1]=Y[Y.length-1],J.slice(0,-1)}return J}return this.lastNeed=1,this.lastTotal=2,this.lastChar[0]=Y[Y.length-1],Y.toString("utf16le",X,Y.length-1)}function c60(Y){var X=Y&&Y.length?this.write(Y):"";if(this.lastNeed){var J=this.lastTotal-this.lastNeed;return X+this.lastChar.toString("utf16le",0,J)}return X}function d60(Y,X){var J=(Y.length-X)%3;if(J===0)return Y.toString("base64",X);if(this.lastNeed=3-J,this.lastTotal=3,J===1)this.lastChar[0]=Y[Y.length-1];else this.lastChar[0]=Y[Y.length-2],this.lastChar[1]=Y[Y.length-1];return Y.toString("base64",X,Y.length-J)}function l60(Y){var X=Y&&Y.length?this.write(Y):"";if(this.lastNeed)return X+this.lastChar.toString("base64",0,3-this.lastNeed);return X}function i60(Y){return Y.toString(this.encoding)}function n60(Y){return Y&&Y.length?this.write(Y):""}});var DY=C((Wh0,I_)=>{var w_=v8().codes.ERR_STREAM_PREMATURE_CLOSE;function s60(Y){var X=!1;return function(){if(X)return;X=!0;for(var J=arguments.length,z=Array(J),Q=0;Q<J;Q++)z[Q]=arguments[Q];Y.apply(this,z)}}function r60(){}function t60(Y){return Y.setHeader&&typeof Y.abort==="function"}function T_(Y,X,J){if(typeof X==="function")return T_(Y,null,X);if(!X)X={};J=s60(J||r60);var z=X.readable||X.readable!==!1&&Y.readable,Q=X.writable||X.writable!==!1&&Y.writable,G=function(){if(!Y.writable)$()},Z=Y._writableState&&Y._writableState.finished,$=function(){if(Q=!1,Z=!0,!z)J.call(Y)},H=Y._readableState&&Y._readableState.endEmitted,W=function(){if(z=!1,H=!0,!Q)J.call(Y)},K=function(V){J.call(Y,V)},U=function(){var V;if(z&&!H){if(!Y._readableState||!Y._readableState.ended)V=new w_;return J.call(Y,V)}if(Q&&!Z){if(!Y._writableState||!Y._writableState.ended)V=new w_;return J.call(Y,V)}},B=function(){Y.req.on("finish",$)};if(t60(Y))if(Y.on("complete",$),Y.on("abort",U),Y.req)B();else Y.on("request",B);else if(Q&&!Y._writableState)Y.on("end",G),Y.on("close",G);if(Y.on("end",W),Y.on("finish",$),X.error!==!1)Y.on("error",K);return Y.on("close",U),function(){if(Y.removeListener("complete",$),Y.removeListener("abort",U),Y.removeListener("request",B),Y.req)Y.req.removeListener("finish",$);Y.removeListener("end",G),Y.removeListener("close",G),Y.removeListener("finish",$),Y.removeListener("end",W),Y.removeListener("error",K),Y.removeListener("close",U)}}I_.exports=T_});var D_=C((Kh0,v_)=>{var jY;function D8(Y,X,J){if(X=e60(X),X in Y)Object.defineProperty(Y,X,{value:J,enumerable:!0,configurable:!0,writable:!0});else Y[X]=J;return Y}function e60(Y){var X=Y50(Y,"string");return typeof X==="symbol"?X:String(X)}function Y50(Y,X){if(typeof Y!=="object"||Y===null)return Y;var J=Y[Symbol.toPrimitive];if(J!==void 0){var z=J.call(Y,X||"default");if(typeof z!=="object")return z;throw TypeError("@@toPrimitive must return a primitive value.")}return(X==="string"?String:Number)(Y)}var X50=DY(),j8=Symbol("lastResolve"),Q6=Symbol("lastReject"),c7=Symbol("error"),CY=Symbol("ended"),G6=Symbol("lastPromise"),FZ=Symbol("handlePromise"),Z6=Symbol("stream");function C8(Y,X){return{value:Y,done:X}}function J50(Y){var X=Y[j8];if(X!==null){var J=Y[Z6].read();if(J!==null)Y[G6]=null,Y[j8]=null,Y[Q6]=null,X(C8(J,!1))}}function z50(Y){process.nextTick(J50,Y)}function Q50(Y,X){return function(J,z){Y.then(function(){if(X[CY]){J(C8(void 0,!0));return}X[FZ](J,z)},z)}}var G50=Object.getPrototypeOf(function(){}),Z50=Object.setPrototypeOf((jY={get stream(){return this[Z6]},next:function(){var X=this,J=this[c7];if(J!==null)return Promise.reject(J);if(this[CY])return Promise.resolve(C8(void 0,!0));if(this[Z6].destroyed)return new Promise(function(Z,$){process.nextTick(function(){if(X[c7])$(X[c7]);else Z(C8(void 0,!0))})});var z=this[G6],Q;if(z)Q=new Promise(Q50(z,this));else{var G=this[Z6].read();if(G!==null)return Promise.resolve(C8(G,!1));Q=new Promise(this[FZ])}return this[G6]=Q,Q}},D8(jY,Symbol.asyncIterator,function(){return this}),D8(jY,"return",function(){var X=this;return new Promise(function(J,z){X[Z6].destroy(null,function(Q){if(Q){z(Q);return}J(C8(void 0,!0))})})}),jY),G50),$50=function(X){var J,z=Object.create(Z50,(J={},D8(J,Z6,{value:X,writable:!0}),D8(J,j8,{value:null,writable:!0}),D8(J,Q6,{value:null,writable:!0}),D8(J,c7,{value:null,writable:!0}),D8(J,CY,{value:X._readableState.endEmitted,writable:!0}),D8(J,FZ,{value:function(G,Z){var $=z[Z6].read();if($)z[G6]=null,z[j8]=null,z[Q6]=null,G(C8($,!1));else z[j8]=G,z[Q6]=Z},writable:!0}),J));return z[G6]=null,X50(X,function(Q){if(Q&&Q.code!=="ERR_STREAM_PREMATURE_CLOSE"){var G=z[Q6];if(G!==null)z[G6]=null,z[j8]=null,z[Q6]=null,G(Q);z[c7]=Q;return}var Z=z[j8];if(Z!==null)z[G6]=null,z[j8]=null,z[Q6]=null,Z(C8(void 0,!0));z[CY]=!0}),X.on("readable",z50.bind(null,z)),z};v_.exports=$50});var S_=C((Uh0,E_)=>{function j_(Y,X,J,z,Q,G,Z){try{var $=Y[G](Z),H=$.value}catch(W){J(W);return}if($.done)X(H);else Promise.resolve(H).then(z,Q)}function H50(Y){return function(){var X=this,J=arguments;return new Promise(function(z,Q){var G=Y.apply(X,J);function Z(H){j_(G,z,Q,Z,$,"next",H)}function $(H){j_(G,z,Q,Z,$,"throw",H)}Z(void 0)})}}function C_(Y,X){var J=Object.keys(Y);if(Object.getOwnPropertySymbols){var z=Object.getOwnPropertySymbols(Y);X&&(z=z.filter(function(Q){return Object.getOwnPropertyDescriptor(Y,Q).enumerable})),J.push.apply(J,z)}return J}function W50(Y){for(var X=1;X<arguments.length;X++){var J=arguments[X]!=null?arguments[X]:{};X%2?C_(Object(J),!0).forEach(function(z){K50(Y,z,J[z])}):Object.getOwnPropertyDescriptors?Object.defineProperties(Y,Object.getOwnPropertyDescriptors(J)):C_(Object(J)).forEach(function(z){Object.defineProperty(Y,z,Object.getOwnPropertyDescriptor(J,z))})}return Y}function K50(Y,X,J){if(X=U50(X),X in Y)Object.defineProperty(Y,X,{value:J,enumerable:!0,configurable:!0,writable:!0});else Y[X]=J;return Y}function U50(Y){var X=B50(Y,"string");return typeof X==="symbol"?X:String(X)}function B50(Y,X){if(typeof Y!=="object"||Y===null)return Y;var J=Y[Symbol.toPrimitive];if(J!==void 0){var z=J.call(Y,X||"default");if(typeof z!=="object")return z;throw TypeError("@@toPrimitive must return a primitive value.")}return(X==="string"?String:Number)(Y)}var V50=v8().codes.ERR_INVALID_ARG_TYPE;function O50(Y,X,J){var z;if(X&&typeof X.next==="function")z=X;else if(X&&X[Symbol.asyncIterator])z=X[Symbol.asyncIterator]();else if(X&&X[Symbol.iterator])z=X[Symbol.iterator]();else throw new V50("iterable",["Iterable"],X);var Q=new Y(W50({objectMode:!0},J)),G=!1;Q._read=function(){if(!G)G=!0,Z()};function Z(){return $.apply(this,arguments)}function $(){return $=H50(function*(){try{var H=yield z.next(),W=H.value,K=H.done;if(K)Q.push(null);else if(Q.push(yield W))Z();else G=!1}catch(U){Q.destroy(U)}}),$.apply(this,arguments)}return Q}E_.exports=O50});var EZ=C((Vh0,g_)=>{g_.exports=S0;var X5;S0.ReadableState=R_;var Bh0=Q0("events").EventEmitter,b_=function(X,J){return X.listeners(J).length},l7=Q0("stream"),EY=Q0("buffer").Buffer,M50=(typeof global<"u"?global:typeof window<"u"?window:typeof self<"u"?self:{}).Uint8Array||function(){};function L50(Y){return EY.from(Y)}function N50(Y){return EY.isBuffer(Y)||Y instanceof M50}var PZ=Q0("util"),A0;if(PZ&&PZ.debuglog)A0=PZ.debuglog("stream");else A0=function(){};var q50=q_(),jZ=UZ(),x50=BZ(),F50=x50.getHighWaterMark,SY=v8().codes,P50=SY.ERR_INVALID_ARG_TYPE,A50=SY.ERR_STREAM_PUSH_AFTER_EOF,w50=SY.ERR_METHOD_NOT_IMPLEMENTED,T50=SY.ERR_STREAM_UNSHIFT_AFTER_END_EVENT,J5,AZ,wZ;Y5()(S0,l7);var d7=jZ.errorOrDestroy,TZ=["error","close","destroy","pause","resume"];function I50(Y,X,J){if(typeof Y.prependListener==="function")return Y.prependListener(X,J);if(!Y._events||!Y._events[X])Y.on(X,J);else if(Array.isArray(Y._events[X]))Y._events[X].unshift(J);else Y._events[X]=[J,Y._events[X]]}function R_(Y,X,J){if(X5=X5||$6(),Y=Y||{},typeof J!=="boolean")J=X instanceof X5;if(this.objectMode=!!Y.objectMode,J)this.objectMode=this.objectMode||!!Y.readableObjectMode;if(this.highWaterMark=F50(this,Y,"readableHighWaterMark",J),this.buffer=new q50,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.paused=!0,this.emitClose=Y.emitClose!==!1,this.autoDestroy=!!Y.autoDestroy,this.destroyed=!1,this.defaultEncoding=Y.defaultEncoding||"utf8",this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,Y.encoding){if(!J5)J5=xZ().StringDecoder;this.decoder=new J5(Y.encoding),this.encoding=Y.encoding}}function S0(Y){if(X5=X5||$6(),!(this instanceof S0))return new S0(Y);var X=this instanceof X5;if(this._readableState=new R_(Y,this,X),this.readable=!0,Y){if(typeof Y.read==="function")this._read=Y.read;if(typeof Y.destroy==="function")this._destroy=Y.destroy}l7.call(this)}Object.defineProperty(S0.prototype,"destroyed",{enumerable:!1,get:function(){if(this._readableState===void 0)return!1;return this._readableState.destroyed},set:function(X){if(!this._readableState)return;this._readableState.destroyed=X}});S0.prototype.destroy=jZ.destroy;S0.prototype._undestroy=jZ.undestroy;S0.prototype._destroy=function(Y,X){X(Y)};S0.prototype.push=function(Y,X){var J=this._readableState,z;if(!J.objectMode){if(typeof Y==="string"){if(X=X||J.defaultEncoding,X!==J.encoding)Y=EY.from(Y,X),X="";z=!0}}else z=!0;return f_(this,Y,X,!1,z)};S0.prototype.unshift=function(Y){return f_(this,Y,null,!0,!1)};function f_(Y,X,J,z,Q){A0("readableAddChunk",X);var G=Y._readableState;if(X===null)G.reading=!1,j50(Y,G);else{var Z;if(!Q)Z=v50(G,X);if(Z)d7(Y,Z);else if(G.objectMode||X&&X.length>0){if(typeof X!=="string"&&!G.objectMode&&Object.getPrototypeOf(X)!==EY.prototype)X=L50(X);if(z)if(G.endEmitted)d7(Y,new T50);else IZ(Y,G,X,!0);else if(G.ended)d7(Y,new A50);else if(G.destroyed)return!1;else if(G.reading=!1,G.decoder&&!J)if(X=G.decoder.write(X),G.objectMode||X.length!==0)IZ(Y,G,X,!1);else DZ(Y,G);else IZ(Y,G,X,!1)}else if(!z)G.reading=!1,DZ(Y,G)}return!G.ended&&(G.length<G.highWaterMark||G.length===0)}function IZ(Y,X,J,z){if(X.flowing&&X.length===0&&!X.sync)X.awaitDrain=0,Y.emit("data",J);else{if(X.length+=X.objectMode?1:J.length,z)X.buffer.unshift(J);else X.buffer.push(J);if(X.needReadable)kY(Y)}DZ(Y,X)}function v50(Y,X){var J;if(!N50(X)&&typeof X!=="string"&&X!==void 0&&!Y.objectMode)J=new P50("chunk",["string","Buffer","Uint8Array"],X);return J}S0.prototype.isPaused=function(){return this._readableState.flowing===!1};S0.prototype.setEncoding=function(Y){if(!J5)J5=xZ().StringDecoder;var X=new J5(Y);this._readableState.decoder=X,this._readableState.encoding=this._readableState.decoder.encoding;var J=this._readableState.buffer.head,z="";while(J!==null)z+=X.write(J.data),J=J.next;if(this._readableState.buffer.clear(),z!=="")this._readableState.buffer.push(z);return this._readableState.length=z.length,this};var k_=1073741824;function D50(Y){if(Y>=k_)Y=k_;else Y--,Y|=Y>>>1,Y|=Y>>>2,Y|=Y>>>4,Y|=Y>>>8,Y|=Y>>>16,Y++;return Y}function __(Y,X){if(Y<=0||X.length===0&&X.ended)return 0;if(X.objectMode)return 1;if(Y!==Y)if(X.flowing&&X.length)return X.buffer.head.data.length;else return X.length;if(Y>X.highWaterMark)X.highWaterMark=D50(Y);if(Y<=X.length)return Y;if(!X.ended)return X.needReadable=!0,0;return X.length}S0.prototype.read=function(Y){A0("read",Y),Y=parseInt(Y,10);var X=this._readableState,J=Y;if(Y!==0)X.emittedReadable=!1;if(Y===0&&X.needReadable&&((X.highWaterMark!==0?X.length>=X.highWaterMark:X.length>0)||X.ended)){if(A0("read: emitReadable",X.length,X.ended),X.length===0&&X.ended)vZ(this);else kY(this);return null}if(Y=__(Y,X),Y===0&&X.ended){if(X.length===0)vZ(this);return null}var z=X.needReadable;if(A0("need readable",z),X.length===0||X.length-Y<X.highWaterMark)z=!0,A0("length less than watermark",z);if(X.ended||X.reading)z=!1,A0("reading or ended",z);else if(z){if(A0("do read"),X.reading=!0,X.sync=!0,X.length===0)X.needReadable=!0;if(this._read(X.highWaterMark),X.sync=!1,!X.reading)Y=__(J,X)}var Q;if(Y>0)Q=m_(Y,X);else Q=null;if(Q===null)X.needReadable=X.length<=X.highWaterMark,Y=0;else X.length-=Y,X.awaitDrain=0;if(X.length===0){if(!X.ended)X.needReadable=!0;if(J!==Y&&X.ended)vZ(this)}if(Q!==null)this.emit("data",Q);return Q};function j50(Y,X){if(A0("onEofChunk"),X.ended)return;if(X.decoder){var J=X.decoder.end();if(J&&J.length)X.buffer.push(J),X.length+=X.objectMode?1:J.length}if(X.ended=!0,X.sync)kY(Y);else if(X.needReadable=!1,!X.emittedReadable)X.emittedReadable=!0,y_(Y)}function kY(Y){var X=Y._readableState;if(A0("emitReadable",X.needReadable,X.emittedReadable),X.needReadable=!1,!X.emittedReadable)A0("emitReadable",X.flowing),X.emittedReadable=!0,process.nextTick(y_,Y)}function y_(Y){var X=Y._readableState;if(A0("emitReadable_",X.destroyed,X.length,X.ended),!X.destroyed&&(X.length||X.ended))Y.emit("readable"),X.emittedReadable=!1;X.needReadable=!X.flowing&&!X.ended&&X.length<=X.highWaterMark,CZ(Y)}function DZ(Y,X){if(!X.readingMore)X.readingMore=!0,process.nextTick(C50,Y,X)}function C50(Y,X){while(!X.reading&&!X.ended&&(X.length<X.highWaterMark||X.flowing&&X.length===0)){var J=X.length;if(A0("maybeReadMore read 0"),Y.read(0),J===X.length)break}X.readingMore=!1}S0.prototype._read=function(Y){d7(this,new w50("_read()"))};S0.prototype.pipe=function(Y,X){var J=this,z=this._readableState;switch(z.pipesCount){case 0:z.pipes=Y;break;case 1:z.pipes=[z.pipes,Y];break;default:z.pipes.push(Y);break}z.pipesCount+=1,A0("pipe count=%d opts=%j",z.pipesCount,X);var Q=(!X||X.end!==!1)&&Y!==process.stdout&&Y!==process.stderr,G=Q?$:L;if(z.endEmitted)process.nextTick(G);else J.once("end",G);Y.on("unpipe",Z);function Z(q,F){if(A0("onunpipe"),q===J){if(F&&F.hasUnpiped===!1)F.hasUnpiped=!0,K()}}function $(){A0("onend"),Y.end()}var H=E50(J);Y.on("drain",H);var W=!1;function K(){if(A0("cleanup"),Y.removeListener("close",O),Y.removeListener("finish",V),Y.removeListener("drain",H),Y.removeListener("error",B),Y.removeListener("unpipe",Z),J.removeListener("end",$),J.removeListener("end",L),J.removeListener("data",U),W=!0,z.awaitDrain&&(!Y._writableState||Y._writableState.needDrain))H()}J.on("data",U);function U(q){A0("ondata");var F=Y.write(q);if(A0("dest.write",F),F===!1){if((z.pipesCount===1&&z.pipes===Y||z.pipesCount>1&&u_(z.pipes,Y)!==-1)&&!W)A0("false write response, pause",z.awaitDrain),z.awaitDrain++;J.pause()}}function B(q){if(A0("onerror",q),L(),Y.removeListener("error",B),b_(Y,"error")===0)d7(Y,q)}I50(Y,"error",B);function O(){Y.removeListener("finish",V),L()}Y.once("close",O);function V(){A0("onfinish"),Y.removeListener("close",O),L()}Y.once("finish",V);function L(){A0("unpipe"),J.unpipe(Y)}if(Y.emit("pipe",J),!z.flowing)A0("pipe resume"),J.resume();return Y};function E50(Y){return function(){var J=Y._readableState;if(A0("pipeOnDrain",J.awaitDrain),J.awaitDrain)J.awaitDrain--;if(J.awaitDrain===0&&b_(Y,"data"))J.flowing=!0,CZ(Y)}}S0.prototype.unpipe=function(Y){var X=this._readableState,J={hasUnpiped:!1};if(X.pipesCount===0)return this;if(X.pipesCount===1){if(Y&&Y!==X.pipes)return this;if(!Y)Y=X.pipes;if(X.pipes=null,X.pipesCount=0,X.flowing=!1,Y)Y.emit("unpipe",this,J);return this}if(!Y){var{pipes:z,pipesCount:Q}=X;X.pipes=null,X.pipesCount=0,X.flowing=!1;for(var G=0;G<Q;G++)z[G].emit("unpipe",this,{hasUnpiped:!1});return this}var Z=u_(X.pipes,Y);if(Z===-1)return this;if(X.pipes.splice(Z,1),X.pipesCount-=1,X.pipesCount===1)X.pipes=X.pipes[0];return Y.emit("unpipe",this,J),this};S0.prototype.on=function(Y,X){var J=l7.prototype.on.call(this,Y,X),z=this._readableState;if(Y==="data"){if(z.readableListening=this.listenerCount("readable")>0,z.flowing!==!1)this.resume()}else if(Y==="readable"){if(!z.endEmitted&&!z.readableListening){if(z.readableListening=z.needReadable=!0,z.flowing=!1,z.emittedReadable=!1,A0("on readable",z.length,z.reading),z.length)kY(this);else if(!z.reading)process.nextTick(S50,this)}}return J};S0.prototype.addListener=S0.prototype.on;S0.prototype.removeListener=function(Y,X){var J=l7.prototype.removeListener.call(this,Y,X);if(Y==="readable")process.nextTick(h_,this);return J};S0.prototype.removeAllListeners=function(Y){var X=l7.prototype.removeAllListeners.apply(this,arguments);if(Y==="readable"||Y===void 0)process.nextTick(h_,this);return X};function h_(Y){var X=Y._readableState;if(X.readableListening=Y.listenerCount("readable")>0,X.resumeScheduled&&!X.paused)X.flowing=!0;else if(Y.listenerCount("data")>0)Y.resume()}function S50(Y){A0("readable nexttick read 0"),Y.read(0)}S0.prototype.resume=function(){var Y=this._readableState;if(!Y.flowing)A0("resume"),Y.flowing=!Y.readableListening,k50(this,Y);return Y.paused=!1,this};function k50(Y,X){if(!X.resumeScheduled)X.resumeScheduled=!0,process.nextTick(_50,Y,X)}function _50(Y,X){if(A0("resume",X.reading),!X.reading)Y.read(0);if(X.resumeScheduled=!1,Y.emit("resume"),CZ(Y),X.flowing&&!X.reading)Y.read(0)}S0.prototype.pause=function(){if(A0("call pause flowing=%j",this._readableState.flowing),this._readableState.flowing!==!1)A0("pause"),this._readableState.flowing=!1,this.emit("pause");return this._readableState.paused=!0,this};function CZ(Y){var X=Y._readableState;A0("flow",X.flowing);while(X.flowing&&Y.read()!==null);}S0.prototype.wrap=function(Y){var X=this,J=this._readableState,z=!1;Y.on("end",function(){if(A0("wrapped end"),J.decoder&&!J.ended){var Z=J.decoder.end();if(Z&&Z.length)X.push(Z)}X.push(null)}),Y.on("data",function(Z){if(A0("wrapped data"),J.decoder)Z=J.decoder.write(Z);if(J.objectMode&&(Z===null||Z===void 0))return;else if(!J.objectMode&&(!Z||!Z.length))return;var $=X.push(Z);if(!$)z=!0,Y.pause()});for(var Q in Y)if(this[Q]===void 0&&typeof Y[Q]==="function")this[Q]=function($){return function(){return Y[$].apply(Y,arguments)}}(Q);for(var G=0;G<TZ.length;G++)Y.on(TZ[G],this.emit.bind(this,TZ[G]));return this._read=function(Z){if(A0("wrapped _read",Z),z)z=!1,Y.resume()},this};if(typeof Symbol==="function")S0.prototype[Symbol.asyncIterator]=function(){if(AZ===void 0)AZ=D_();return AZ(this)};Object.defineProperty(S0.prototype,"readableHighWaterMark",{enumerable:!1,get:function(){return this._readableState.highWaterMark}});Object.defineProperty(S0.prototype,"readableBuffer",{enumerable:!1,get:function(){return this._readableState&&this._readableState.buffer}});Object.defineProperty(S0.prototype,"readableFlowing",{enumerable:!1,get:function(){return this._readableState.flowing},set:function(X){if(this._readableState)this._readableState.flowing=X}});S0._fromList=m_;Object.defineProperty(S0.prototype,"readableLength",{enumerable:!1,get:function(){return this._readableState.length}});function m_(Y,X){if(X.length===0)return null;var J;if(X.objectMode)J=X.buffer.shift();else if(!Y||Y>=X.length){if(X.decoder)J=X.buffer.join("");else if(X.buffer.length===1)J=X.buffer.first();else J=X.buffer.concat(X.length);X.buffer.clear()}else J=X.buffer.consume(Y,X.decoder);return J}function vZ(Y){var X=Y._readableState;if(A0("endReadable",X.endEmitted),!X.endEmitted)X.ended=!0,process.nextTick(b50,X,Y)}function b50(Y,X){if(A0("endReadableNT",Y.endEmitted,Y.length),!Y.endEmitted&&Y.length===0){if(Y.endEmitted=!0,X.readable=!1,X.emit("end"),Y.autoDestroy){var J=X._writableState;if(!J||J.autoDestroy&&J.finished)X.destroy()}}}if(typeof Symbol==="function")S0.from=function(Y,X){if(wZ===void 0)wZ=S_();return wZ(S0,Y,X)};function u_(Y,X){for(var J=0,z=Y.length;J<z;J++)if(Y[J]===X)return J;return-1}});var $6=C((Oh0,c_)=>{var R50=Object.keys||function(Y){var X=[];for(var J in Y)X.push(J);return X};c_.exports=_4;var p_=EZ(),SZ=bY();Y5()(_4,p_);{_Y=R50(SZ.prototype);for(i7=0;i7<_Y.length;i7++)if(n7=_Y[i7],!_4.prototype[n7])_4.prototype[n7]=SZ.prototype[n7]}var _Y,n7,i7;function _4(Y){if(!(this instanceof _4))return new _4(Y);if(p_.call(this,Y),SZ.call(this,Y),this.allowHalfOpen=!0,Y){if(Y.readable===!1)this.readable=!1;if(Y.writable===!1)this.writable=!1;if(Y.allowHalfOpen===!1)this.allowHalfOpen=!1,this.once("end",f50)}}Object.defineProperty(_4.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}});Object.defineProperty(_4.prototype,"writableBuffer",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}});Object.defineProperty(_4.prototype,"writableLength",{enumerable:!1,get:function(){return this._writableState.length}});function f50(){if(this._writableState.ended)return;process.nextTick(y50,this)}function y50(Y){Y.end()}Object.defineProperty(_4.prototype,"destroyed",{enumerable:!1,get:function(){if(this._readableState===void 0||this._writableState===void 0)return!1;return this._readableState.destroyed&&this._writableState.destroyed},set:function(X){if(this._readableState===void 0||this._writableState===void 0)return;this._readableState.destroyed=X,this._writableState.destroyed=X}})});var bY=C((Mh0,a_)=>{a_.exports=t0;function l_(Y){var X=this;this.next=null,this.entry=null,this.finish=function(){K70(X,Y)}}var z5;t0.WritableState=a7;var h50={deprecate:G_()},i_=Q0("stream"),fY=Q0("buffer").Buffer,m50=(typeof global<"u"?global:typeof window<"u"?window:typeof self<"u"?self:{}).Uint8Array||function(){};function u50(Y){return fY.from(Y)}function g50(Y){return fY.isBuffer(Y)||Y instanceof m50}var _Z=UZ(),p50=BZ(),c50=p50.getHighWaterMark,E8=v8().codes,d50=E8.ERR_INVALID_ARG_TYPE,l50=E8.ERR_METHOD_NOT_IMPLEMENTED,i50=E8.ERR_MULTIPLE_CALLBACK,n50=E8.ERR_STREAM_CANNOT_PIPE,o50=E8.ERR_STREAM_DESTROYED,a50=E8.ERR_STREAM_NULL_VALUES,s50=E8.ERR_STREAM_WRITE_AFTER_END,r50=E8.ERR_UNKNOWN_ENCODING,Q5=_Z.errorOrDestroy;Y5()(t0,i_);function t50(){}function a7(Y,X,J){if(z5=z5||$6(),Y=Y||{},typeof J!=="boolean")J=X instanceof z5;if(this.objectMode=!!Y.objectMode,J)this.objectMode=this.objectMode||!!Y.writableObjectMode;this.highWaterMark=c50(this,Y,"writableHighWaterMark",J),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1,this.destroyed=!1;var z=Y.decodeStrings===!1;this.decodeStrings=!z,this.defaultEncoding=Y.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(Q){G70(X,Q)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.emitClose=Y.emitClose!==!1,this.autoDestroy=!!Y.autoDestroy,this.bufferedRequestCount=0,this.corkedRequestsFree=new l_(this)}a7.prototype.getBuffer=function(){var X=this.bufferedRequest,J=[];while(X)J.push(X),X=X.next;return J};(function(){try{Object.defineProperty(a7.prototype,"buffer",{get:h50.deprecate(function(){return this.getBuffer()},"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.","DEP0003")})}catch(Y){}})();var RY;if(typeof Symbol==="function"&&Symbol.hasInstance&&typeof Function.prototype[Symbol.hasInstance]==="function")RY=Function.prototype[Symbol.hasInstance],Object.defineProperty(t0,Symbol.hasInstance,{value:function(X){if(RY.call(this,X))return!0;if(this!==t0)return!1;return X&&X._writableState instanceof a7}});else RY=function(X){return X instanceof this};function t0(Y){z5=z5||$6();var X=this instanceof z5;if(!X&&!RY.call(t0,this))return new t0(Y);if(this._writableState=new a7(Y,this,X),this.writable=!0,Y){if(typeof Y.write==="function")this._write=Y.write;if(typeof Y.writev==="function")this._writev=Y.writev;if(typeof Y.destroy==="function")this._destroy=Y.destroy;if(typeof Y.final==="function")this._final=Y.final}i_.call(this)}t0.prototype.pipe=function(){Q5(this,new n50)};function e50(Y,X){var J=new s50;Q5(Y,J),process.nextTick(X,J)}function Y70(Y,X,J,z){var Q;if(J===null)Q=new a50;else if(typeof J!=="string"&&!X.objectMode)Q=new d50("chunk",["string","Buffer"],J);if(Q)return Q5(Y,Q),process.nextTick(z,Q),!1;return!0}t0.prototype.write=function(Y,X,J){var z=this._writableState,Q=!1,G=!z.objectMode&&g50(Y);if(G&&!fY.isBuffer(Y))Y=u50(Y);if(typeof X==="function")J=X,X=null;if(G)X="buffer";else if(!X)X=z.defaultEncoding;if(typeof J!=="function")J=t50;if(z.ending)e50(this,J);else if(G||Y70(this,z,Y,J))z.pendingcb++,Q=J70(this,z,G,Y,X,J);return Q};t0.prototype.cork=function(){this._writableState.corked++};t0.prototype.uncork=function(){var Y=this._writableState;if(Y.corked){if(Y.corked--,!Y.writing&&!Y.corked&&!Y.bufferProcessing&&Y.bufferedRequest)n_(this,Y)}};t0.prototype.setDefaultEncoding=function(X){if(typeof X==="string")X=X.toLowerCase();if(!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((X+"").toLowerCase())>-1))throw new r50(X);return this._writableState.defaultEncoding=X,this};Object.defineProperty(t0.prototype,"writableBuffer",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}});function X70(Y,X,J){if(!Y.objectMode&&Y.decodeStrings!==!1&&typeof X==="string")X=fY.from(X,J);return X}Object.defineProperty(t0.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}});function J70(Y,X,J,z,Q,G){if(!J){var Z=X70(X,z,Q);if(z!==Z)J=!0,Q="buffer",z=Z}var $=X.objectMode?1:z.length;X.length+=$;var H=X.length<X.highWaterMark;if(!H)X.needDrain=!0;if(X.writing||X.corked){var W=X.lastBufferedRequest;if(X.lastBufferedRequest={chunk:z,encoding:Q,isBuf:J,callback:G,next:null},W)W.next=X.lastBufferedRequest;else X.bufferedRequest=X.lastBufferedRequest;X.bufferedRequestCount+=1}else kZ(Y,X,!1,$,z,Q,G);return H}function kZ(Y,X,J,z,Q,G,Z){if(X.writelen=z,X.writecb=Z,X.writing=!0,X.sync=!0,X.destroyed)X.onwrite(new o50("write"));else if(J)Y._writev(Q,X.onwrite);else Y._write(Q,G,X.onwrite);X.sync=!1}function z70(Y,X,J,z,Q){if(--X.pendingcb,J)process.nextTick(Q,z),process.nextTick(o7,Y,X),Y._writableState.errorEmitted=!0,Q5(Y,z);else Q(z),Y._writableState.errorEmitted=!0,Q5(Y,z),o7(Y,X)}function Q70(Y){Y.writing=!1,Y.writecb=null,Y.length-=Y.writelen,Y.writelen=0}function G70(Y,X){var J=Y._writableState,z=J.sync,Q=J.writecb;if(typeof Q!=="function")throw new i50;if(Q70(J),X)z70(Y,J,z,X,Q);else{var G=o_(J)||Y.destroyed;if(!G&&!J.corked&&!J.bufferProcessing&&J.bufferedRequest)n_(Y,J);if(z)process.nextTick(d_,Y,J,G,Q);else d_(Y,J,G,Q)}}function d_(Y,X,J,z){if(!J)Z70(Y,X);X.pendingcb--,z(),o7(Y,X)}function Z70(Y,X){if(X.length===0&&X.needDrain)X.needDrain=!1,Y.emit("drain")}function n_(Y,X){X.bufferProcessing=!0;var J=X.bufferedRequest;if(Y._writev&&J&&J.next){var z=X.bufferedRequestCount,Q=Array(z),G=X.corkedRequestsFree;G.entry=J;var Z=0,$=!0;while(J){if(Q[Z]=J,!J.isBuf)$=!1;J=J.next,Z+=1}if(Q.allBuffers=$,kZ(Y,X,!0,X.length,Q,"",G.finish),X.pendingcb++,X.lastBufferedRequest=null,G.next)X.corkedRequestsFree=G.next,G.next=null;else X.corkedRequestsFree=new l_(X);X.bufferedRequestCount=0}else{while(J){var{chunk:H,encoding:W,callback:K}=J,U=X.objectMode?1:H.length;if(kZ(Y,X,!1,U,H,W,K),J=J.next,X.bufferedRequestCount--,X.writing)break}if(J===null)X.lastBufferedRequest=null}X.bufferedRequest=J,X.bufferProcessing=!1}t0.prototype._write=function(Y,X,J){J(new l50("_write()"))};t0.prototype._writev=null;t0.prototype.end=function(Y,X,J){var z=this._writableState;if(typeof Y==="function")J=Y,Y=null,X=null;else if(typeof X==="function")J=X,X=null;if(Y!==null&&Y!==void 0)this.write(Y,X);if(z.corked)z.corked=1,this.uncork();if(!z.ending)W70(this,z,J);return this};Object.defineProperty(t0.prototype,"writableLength",{enumerable:!1,get:function(){return this._writableState.length}});function o_(Y){return Y.ending&&Y.length===0&&Y.bufferedRequest===null&&!Y.finished&&!Y.writing}function $70(Y,X){Y._final(function(J){if(X.pendingcb--,J)Q5(Y,J);X.prefinished=!0,Y.emit("prefinish"),o7(Y,X)})}function H70(Y,X){if(!X.prefinished&&!X.finalCalled)if(typeof Y._final==="function"&&!X.destroyed)X.pendingcb++,X.finalCalled=!0,process.nextTick($70,Y,X);else X.prefinished=!0,Y.emit("prefinish")}function o7(Y,X){var J=o_(X);if(J){if(H70(Y,X),X.pendingcb===0){if(X.finished=!0,Y.emit("finish"),X.autoDestroy){var z=Y._readableState;if(!z||z.autoDestroy&&z.endEmitted)Y.destroy()}}}return J}function W70(Y,X,J){if(X.ending=!0,o7(Y,X),J)if(X.finished)process.nextTick(J);else Y.once("finish",J);X.ended=!0,Y.writable=!1}function K70(Y,X,J){var z=Y.entry;Y.entry=null;while(z){var Q=z.callback;X.pendingcb--,Q(J),z=z.next}X.corkedRequestsFree.next=Y}Object.defineProperty(t0.prototype,"destroyed",{enumerable:!1,get:function(){if(this._writableState===void 0)return!1;return this._writableState.destroyed},set:function(X){if(!this._writableState)return;this._writableState.destroyed=X}});t0.prototype.destroy=_Z.destroy;t0.prototype._undestroy=_Z.undestroy;t0.prototype._destroy=function(Y,X){X(Y)}});var bZ=C((Lh0,t_)=>{var U70=Q0("util"),s_=bY(),{LEVEL:r_}=J1(),s7=t_.exports=function(X={}){if(s_.call(this,{objectMode:!0,highWaterMark:X.highWaterMark}),this.format=X.format,this.level=X.level,this.handleExceptions=X.handleExceptions,this.handleRejections=X.handleRejections,this.silent=X.silent,X.log)this.log=X.log;if(X.logv)this.logv=X.logv;if(X.close)this.close=X.close;this.once("pipe",(J)=>{this.levels=J.levels,this.parent=J}),this.once("unpipe",(J)=>{if(J===this.parent){if(this.parent=null,this.close)this.close()}})};U70.inherits(s7,s_);s7.prototype._write=function(X,J,z){if(this.silent||X.exception===!0&&!this.handleExceptions)return z(null);let Q=this.level||this.parent&&this.parent.level;if(!Q||this.levels[Q]>=this.levels[X[r_]]){if(X&&!this.format)return this.log(X,z);let G,Z;try{Z=this.format.transform(Object.assign({},X),this.format.options)}catch($){G=$}if(G||!Z){if(z(),G)throw G;return}return this.log(Z,z)}return this._writableState.sync=!1,z(null)};s7.prototype._writev=function(X,J){if(this.logv){let z=X.filter(this._accept,this);if(!z.length)return J(null);return this.logv(z,J)}for(let z=0;z<X.length;z++){if(!this._accept(X[z]))continue;if(X[z].chunk&&!this.format){this.log(X[z].chunk,X[z].callback);continue}let Q,G;try{G=this.format.transform(Object.assign({},X[z].chunk),this.format.options)}catch(Z){Q=Z}if(Q||!G){if(X[z].callback(),Q)throw J(null),Q}else this.log(G,X[z].callback)}return J(null)};s7.prototype._accept=function(X){let J=X.chunk;if(this.silent)return!1;let z=this.level||this.parent&&this.parent.level;if(J.exception===!0||!z||this.levels[z]>=this.levels[J[r_]]){if(this.handleExceptions||J.exception!==!0)return!0}return!1};s7.prototype._nop=function(){return}});var fZ=C((Nh0,Yb)=>{var B70=Q0("util"),{LEVEL:RZ}=J1(),e_=bZ(),r7=Yb.exports=function(X={}){if(e_.call(this,X),!X.transport||typeof X.transport.log!=="function")throw Error("Invalid transport, must be an object with a log method.");this.transport=X.transport,this.level=this.level||X.transport.level,this.handleExceptions=this.handleExceptions||X.transport.handleExceptions,this._deprecated();function J(z){this.emit("error",z,this.transport)}if(!this.transport.__winstonError)this.transport.__winstonError=J.bind(this),this.transport.on("error",this.transport.__winstonError)};B70.inherits(r7,e_);r7.prototype._write=function(X,J,z){if(this.silent||X.exception===!0&&!this.handleExceptions)return z(null);if(!this.level||this.levels[this.level]>=this.levels[X[RZ]])this.transport.log(X[RZ],X.message,X,this._nop);z(null)};r7.prototype._writev=function(X,J){for(let z=0;z<X.length;z++)if(this._accept(X[z]))this.transport.log(X[z].chunk[RZ],X[z].chunk.message,X[z].chunk,this._nop),X[z].callback();return J(null)};r7.prototype._deprecated=function(){console.error([`${this.transport.name} is a legacy winston transport. Consider upgrading: `,"- Upgrade docs: https://github.com/winstonjs/winston/blob/master/UPGRADE-3.0.md"].join(`
`))};r7.prototype.close=function(){if(this.transport.close)this.transport.close();if(this.transport.__winstonError)this.transport.removeListener("error",this.transport.__winstonError),this.transport.__winstonError=null}});var G5=C((qh0,yZ)=>{yZ.exports=bZ();yZ.exports.LegacyTransportStream=fZ()});var zb=C((xh0,Jb)=>{var V70=Q0("os"),{LEVEL:Xb,MESSAGE:Z5}=J1(),O70=G5();Jb.exports=class extends O70{constructor(X={}){super(X);this.name=X.name||"console",this.stderrLevels=this._stringArrayToSet(X.stderrLevels),this.consoleWarnLevels=this._stringArrayToSet(X.consoleWarnLevels),this.eol=typeof X.eol==="string"?X.eol:V70.EOL,this.forceConsole=X.forceConsole||!1,this._consoleLog=console.log.bind(console),this._consoleWarn=console.warn.bind(console),this._consoleError=console.error.bind(console),this.setMaxListeners(30)}log(X,J){if(setImmediate(()=>this.emit("logged",X)),this.stderrLevels[X[Xb]]){if(console._stderr&&!this.forceConsole)console._stderr.write(`${X[Z5]}${this.eol}`);else this._consoleError(X[Z5]);if(J)J();return}else if(this.consoleWarnLevels[X[Xb]]){if(console._stderr&&!this.forceConsole)console._stderr.write(`${X[Z5]}${this.eol}`);else this._consoleWarn(X[Z5]);if(J)J();return}if(console._stdout&&!this.forceConsole)console._stdout.write(`${X[Z5]}${this.eol}`);else this._consoleLog(X[Z5]);if(J)J()}_stringArrayToSet(X,J){if(!X)return{};if(J=J||"Cannot make set from type other than Array of string elements",!Array.isArray(X))throw Error(J);return X.reduce((z,Q)=>{if(typeof Q!=="string")throw Error(J);return z[Q]=!0,z},{})}}});var yY=C((hZ,Qb)=>{Object.defineProperty(hZ,"__esModule",{value:!0});hZ.default=M70;function M70(Y){return Y&&typeof Y.length==="number"&&Y.length>=0&&Y.length%1===0}Qb.exports=hZ.default});var Zb=C((mZ,Gb)=>{Object.defineProperty(mZ,"__esModule",{value:!0});mZ.default=function(Y){return function(...X){var J=X.pop();return Y.call(this,X,J)}};Gb.exports=mZ.default});var Kb=C((Wb)=>{Object.defineProperty(Wb,"__esModule",{value:!0});Wb.fallback=$b;Wb.wrap=Hb;var q70=Wb.hasQueueMicrotask=typeof queueMicrotask==="function"&&queueMicrotask,x70=Wb.hasSetImmediate=typeof setImmediate==="function"&&setImmediate,F70=Wb.hasNextTick=typeof process==="object"&&typeof process.nextTick==="function";function $b(Y){setTimeout(Y,0)}function Hb(Y){return(X,...J)=>Y(()=>X(...J))}var t7;if(q70)t7=queueMicrotask;else if(x70)t7=setImmediate;else if(F70)t7=process.nextTick;else t7=$b;Wb.default=Hb(t7)});var Mb=C((uZ,Ob)=>{Object.defineProperty(uZ,"__esModule",{value:!0});uZ.default=C70;var T70=Zb(),I70=Vb(T70),v70=Kb(),D70=Vb(v70),j70=H6();function Vb(Y){return Y&&Y.__esModule?Y:{default:Y}}function C70(Y){if((0,j70.isAsync)(Y))return function(...X){let J=X.pop(),z=Y.apply(this,X);return Ub(z,J)};return(0,I70.default)(function(X,J){var z;try{z=Y.apply(this,X)}catch(Q){return J(Q)}if(z&&typeof z.then==="function")return Ub(z,J);else J(null,z)})}function Ub(Y,X){return Y.then((J)=>{Bb(X,null,J)},(J)=>{Bb(X,J&&(J instanceof Error||J.message)?J:Error(J))})}function Bb(Y,X,J){try{Y(X,J)}catch(z){(0,D70.default)((Q)=>{throw Q},z)}}Ob.exports=uZ.default});var H6=C((Nb)=>{Object.defineProperty(Nb,"__esModule",{value:!0});Nb.isAsyncIterable=Nb.isAsyncGenerator=Nb.isAsync=void 0;var S70=Mb(),k70=_70(S70);function _70(Y){return Y&&Y.__esModule?Y:{default:Y}}function Lb(Y){return Y[Symbol.toStringTag]==="AsyncFunction"}function b70(Y){return Y[Symbol.toStringTag]==="AsyncGenerator"}function R70(Y){return typeof Y[Symbol.asyncIterator]==="function"}function f70(Y){if(typeof Y!=="function")throw Error("expected a function");return Lb(Y)?(0,k70.default)(Y):Y}Nb.default=f70;Nb.isAsync=Lb;Nb.isAsyncGenerator=b70;Nb.isAsyncIterable=R70});var $5=C((gZ,xb)=>{Object.defineProperty(gZ,"__esModule",{value:!0});gZ.default=u70;function u70(Y,X){if(!X)X=Y.length;if(!X)throw Error("arity is undefined");function J(...z){if(typeof z[X-1]==="function")return Y.apply(this,z);return new Promise((Q,G)=>{z[X-1]=(Z,...$)=>{if(Z)return G(Z);Q($.length>1?$:$[0])},Y.apply(this,z)})}return J}xb.exports=gZ.default});var Pb=C((cZ,Fb)=>{Object.defineProperty(cZ,"__esModule",{value:!0});var p70=yY(),c70=pZ(p70),d70=H6(),l70=pZ(d70),i70=$5(),n70=pZ(i70);function pZ(Y){return Y&&Y.__esModule?Y:{default:Y}}cZ.default=(0,n70.default)((Y,X,J)=>{var z=(0,c70.default)(X)?[]:{};Y(X,(Q,G,Z)=>{(0,l70.default)(Q)(($,...H)=>{if(H.length<2)[H]=H;z[G]=H,Z($)})},(Q)=>J(Q,z))},3);Fb.exports=cZ.default});var lZ=C((dZ,Ab)=>{Object.defineProperty(dZ,"__esModule",{value:!0});dZ.default=a70;function a70(Y){function X(...J){if(Y===null)return;var z=Y;Y=null,z.apply(this,J)}return Object.assign(X,Y),X}Ab.exports=dZ.default});var Tb=C((iZ,wb)=>{Object.defineProperty(iZ,"__esModule",{value:!0});iZ.default=function(Y){return Y[Symbol.iterator]&&Y[Symbol.iterator]()};wb.exports=iZ.default});var Db=C((nZ,vb)=>{Object.defineProperty(nZ,"__esModule",{value:!0});nZ.default=G30;var t70=yY(),e70=Ib(t70),Y30=Tb(),X30=Ib(Y30);function Ib(Y){return Y&&Y.__esModule?Y:{default:Y}}function J30(Y){var X=-1,J=Y.length;return function(){return++X<J?{value:Y[X],key:X}:null}}function z30(Y){var X=-1;return function(){var z=Y.next();if(z.done)return null;return X++,{value:z.value,key:X}}}function Q30(Y){var X=Y?Object.keys(Y):[],J=-1,z=X.length;return function Q(){var G=X[++J];if(G==="__proto__")return Q();return J<z?{value:Y[G],key:G}:null}}function G30(Y){if((0,e70.default)(Y))return J30(Y);var X=(0,X30.default)(Y);return X?z30(X):Q30(Y)}vb.exports=nZ.default});var aZ=C((oZ,jb)=>{Object.defineProperty(oZ,"__esModule",{value:!0});oZ.default=$30;function $30(Y){return function(...X){if(Y===null)throw Error("Callback was already called.");var J=Y;Y=null,J.apply(this,X)}}jb.exports=oZ.default});var hY=C((sZ,Cb)=>{Object.defineProperty(sZ,"__esModule",{value:!0});var W30={};sZ.default=W30;Cb.exports=sZ.default});var Sb=C((rZ,Eb)=>{Object.defineProperty(rZ,"__esModule",{value:!0});rZ.default=O30;var U30=hY(),B30=V30(U30);function V30(Y){return Y&&Y.__esModule?Y:{default:Y}}function O30(Y,X,J,z){let Q=!1,G=!1,Z=!1,$=0,H=0;function W(){if($>=X||Z||Q)return;Z=!0,Y.next().then(({value:B,done:O})=>{if(G||Q)return;if(Z=!1,O){if(Q=!0,$<=0)z(null);return}$++,J(B,H,K),H++,W()}).catch(U)}function K(B,O){if($-=1,G)return;if(B)return U(B);if(B===!1){Q=!0,G=!0;return}if(O===B30.default||Q&&$<=0)return Q=!0,z(null);W()}function U(B){if(G)return;Z=!1,Q=!0,z(B)}W()}Eb.exports=rZ.default});var Rb=C((tZ,bb)=>{Object.defineProperty(tZ,"__esModule",{value:!0});var L30=lZ(),N30=e7(L30),q30=Db(),x30=e7(q30),F30=aZ(),P30=e7(F30),kb=H6(),A30=Sb(),_b=e7(A30),w30=hY(),T30=e7(w30);function e7(Y){return Y&&Y.__esModule?Y:{default:Y}}tZ.default=(Y)=>{return(X,J,z)=>{if(z=(0,N30.default)(z),Y<=0)throw RangeError("concurrency limit cannot be less than 1");if(!X)return z(null);if((0,kb.isAsyncGenerator)(X))return(0,_b.default)(X,Y,J,z);if((0,kb.isAsyncIterable)(X))return(0,_b.default)(X[Symbol.asyncIterator](),Y,J,z);var Q=(0,x30.default)(X),G=!1,Z=!1,$=0,H=!1;function W(U,B){if(Z)return;if($-=1,U)G=!0,z(U);else if(U===!1)G=!0,Z=!0;else if(B===T30.default||G&&$<=0)return G=!0,z(null);else if(!H)K()}function K(){H=!0;while($<Y&&!G){var U=Q();if(U===null){if(G=!0,$<=0)z(null);return}$+=1,J(U.value,U.key,(0,P30.default)(W))}H=!1}K()}};bb.exports=tZ.default});var X$=C((Y$,fb)=>{Object.defineProperty(Y$,"__esModule",{value:!0});var v30=Rb(),D30=eZ(v30),j30=H6(),C30=eZ(j30),E30=$5(),S30=eZ(E30);function eZ(Y){return Y&&Y.__esModule?Y:{default:Y}}function k30(Y,X,J,z){return(0,D30.default)(X)(Y,(0,C30.default)(J),z)}Y$.default=(0,S30.default)(k30,4);fb.exports=Y$.default});var mb=C((J$,hb)=>{Object.defineProperty(J$,"__esModule",{value:!0});var b30=X$(),R30=yb(b30),f30=$5(),y30=yb(f30);function yb(Y){return Y&&Y.__esModule?Y:{default:Y}}function h30(Y,X,J){return(0,R30.default)(Y,1,X,J)}J$.default=(0,y30.default)(h30,3);hb.exports=J$.default});var pb=C((z$,gb)=>{Object.defineProperty(z$,"__esModule",{value:!0});z$.default=d30;var u30=Pb(),g30=ub(u30),p30=mb(),c30=ub(p30);function ub(Y){return Y&&Y.__esModule?Y:{default:Y}}function d30(Y,X){return(0,g30.default)(c30.default,Y,X)}gb.exports=z$.default});var Q$=C((Ih0,db)=>{db.exports=t4;var mY=v8().codes,i30=mY.ERR_METHOD_NOT_IMPLEMENTED,n30=mY.ERR_MULTIPLE_CALLBACK,o30=mY.ERR_TRANSFORM_ALREADY_TRANSFORMING,a30=mY.ERR_TRANSFORM_WITH_LENGTH_0,uY=$6();Y5()(t4,uY);function s30(Y,X){var J=this._transformState;J.transforming=!1;var z=J.writecb;if(z===null)return this.emit("error",new n30);if(J.writechunk=null,J.writecb=null,X!=null)this.push(X);z(Y);var Q=this._readableState;if(Q.reading=!1,Q.needReadable||Q.length<Q.highWaterMark)this._read(Q.highWaterMark)}function t4(Y){if(!(this instanceof t4))return new t4(Y);if(uY.call(this,Y),this._transformState={afterTransform:s30.bind(this),needTransform:!1,transforming:!1,writecb:null,writechunk:null,writeencoding:null},this._readableState.needReadable=!0,this._readableState.sync=!1,Y){if(typeof Y.transform==="function")this._transform=Y.transform;if(typeof Y.flush==="function")this._flush=Y.flush}this.on("prefinish",r30)}function r30(){var Y=this;if(typeof this._flush==="function"&&!this._readableState.destroyed)this._flush(function(X,J){cb(Y,X,J)});else cb(this,null,null)}t4.prototype.push=function(Y,X){return this._transformState.needTransform=!1,uY.prototype.push.call(this,Y,X)};t4.prototype._transform=function(Y,X,J){J(new i30("_transform()"))};t4.prototype._write=function(Y,X,J){var z=this._transformState;if(z.writecb=J,z.writechunk=Y,z.writeencoding=X,!z.transforming){var Q=this._readableState;if(z.needTransform||Q.needReadable||Q.length<Q.highWaterMark)this._read(Q.highWaterMark)}};t4.prototype._read=function(Y){var X=this._transformState;if(X.writechunk!==null&&!X.transforming)X.transforming=!0,this._transform(X.writechunk,X.writeencoding,X.afterTransform);else X.needTransform=!0};t4.prototype._destroy=function(Y,X){uY.prototype._destroy.call(this,Y,function(J){X(J)})};function cb(Y,X,J){if(X)return Y.emit("error",X);if(J!=null)Y.push(J);if(Y._writableState.length)throw new a30;if(Y._transformState.transforming)throw new o30;return Y.push(null)}});var nb=C((vh0,ib)=>{ib.exports=Y3;var lb=Q$();Y5()(Y3,lb);function Y3(Y){if(!(this instanceof Y3))return new Y3(Y);lb.call(this,Y)}Y3.prototype._transform=function(Y,X,J){J(null,Y)}});var tb=C((Dh0,rb)=>{var G$;function t30(Y){var X=!1;return function(){if(X)return;X=!0,Y.apply(void 0,arguments)}}var sb=v8().codes,e30=sb.ERR_MISSING_ARGS,Y90=sb.ERR_STREAM_DESTROYED;function ob(Y){if(Y)throw Y}function X90(Y){return Y.setHeader&&typeof Y.abort==="function"}function J90(Y,X,J,z){z=t30(z);var Q=!1;if(Y.on("close",function(){Q=!0}),G$===void 0)G$=DY();G$(Y,{readable:X,writable:J},function(Z){if(Z)return z(Z);Q=!0,z()});var G=!1;return function(Z){if(Q)return;if(G)return;if(G=!0,X90(Y))return Y.abort();if(typeof Y.destroy==="function")return Y.destroy();z(Z||new Y90("pipe"))}}function ab(Y){Y()}function z90(Y,X){return Y.pipe(X)}function Q90(Y){if(!Y.length)return ob;if(typeof Y[Y.length-1]!=="function")return ob;return Y.pop()}function G90(){for(var Y=arguments.length,X=Array(Y),J=0;J<Y;J++)X[J]=arguments[J];var z=Q90(X);if(Array.isArray(X[0]))X=X[0];if(X.length<2)throw new e30("streams");var Q,G=X.map(function(Z,$){var H=$<X.length-1,W=$>0;return J90(Z,H,W,function(K){if(!Q)Q=K;if(K)G.forEach(ab);if(H)return;G.forEach(ab),z(Q)})});return X.reduce(z90)}rb.exports=G90});var W6=C((Q4,J3)=>{var X3=Q0("stream");if(process.env.READABLE_STREAM==="disable"&&X3)J3.exports=X3.Readable,Object.assign(J3.exports,X3),J3.exports.Stream=X3;else Q4=J3.exports=EZ(),Q4.Stream=X3||Q4,Q4.Readable=Q4,Q4.Writable=bY(),Q4.Duplex=$6(),Q4.Transform=Q$(),Q4.PassThrough=nb(),Q4.finished=DY(),Q4.pipeline=tb()});var XR=C((jh0,YR)=>{var H5=[],z3=[],Z$=function(){};function H$(Y){if(~H5.indexOf(Y))return!1;return H5.push(Y),!0}function W$(Y){Z$=Y}function Z90(Y){var X=[];for(var J=0;J<H5.length;J++){if(H5[J].async){X.push(H5[J]);continue}if(H5[J](Y))return!0}if(!X.length)return!1;return new Promise(function(Q){Promise.all(X.map(function(Z){return Z(Y)})).then(function(Z){Q(Z.some(Boolean))})})}function K$(Y){if(~z3.indexOf(Y))return!1;return z3.push(Y),!0}function $$(){Z$.apply(Z$,arguments)}function eb(Y){for(var X=0;X<z3.length;X++)Y=z3[X].apply(z3[X],arguments);return Y}function U$(Y,X){var J=Object.prototype.hasOwnProperty;for(var z in X)if(J.call(X,z))Y[z]=X[z];return Y}function $90(Y){return Y.enabled=!1,Y.modify=K$,Y.set=W$,Y.use=H$,U$(function(){return!1},Y)}function H90(Y){function X(){var J=Array.prototype.slice.call(arguments,0);return $$.call($$,Y,eb(J,Y)),!0}return Y.enabled=!0,Y.modify=K$,Y.set=W$,Y.use=H$,U$(X,Y)}YR.exports=function(X){return X.introduce=U$,X.enabled=Z90,X.process=eb,X.modify=K$,X.write=$$,X.nope=$90,X.yep=H90,X.set=W$,X.use=H$,X}});var $R=C((Ch0,ZR)=>{var b4={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]},zR=Object.create(null);for(let Y in b4)if(Object.hasOwn(b4,Y))zR[b4[Y]]=Y;var Z1={to:{},get:{}};Z1.get=function(Y){let X=Y.slice(0,3).toLowerCase(),J,z;switch(X){case"hsl":{J=Z1.get.hsl(Y),z="hsl";break}case"hwb":{J=Z1.get.hwb(Y),z="hwb";break}default:{J=Z1.get.rgb(Y),z="rgb";break}}if(!J)return null;return{model:z,value:J}};Z1.get.rgb=function(Y){if(!Y)return null;let X=/^#([a-f\d]{3,4})$/i,J=/^#([a-f\d]{6})([a-f\d]{2})?$/i,z=/^rgba?\(\s*([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)\s*(?:[\s,|/]\s*([+-]?[\d.]+)(%?)\s*)?\)$/,Q=/^rgba?\(\s*([+-]?[\d.]+)%\s*,?\s*([+-]?[\d.]+)%\s*,?\s*([+-]?[\d.]+)%\s*(?:[\s,|/]\s*([+-]?[\d.]+)(%?)\s*)?\)$/,G=/^(\w+)$/,Z=[0,0,0,1],$,H,W;if($=Y.match(J)){W=$[2],$=$[1];for(H=0;H<3;H++){let K=H*2;Z[H]=Number.parseInt($.slice(K,K+2),16)}if(W)Z[3]=Number.parseInt(W,16)/255}else if($=Y.match(X)){$=$[1],W=$[3];for(H=0;H<3;H++)Z[H]=Number.parseInt($[H]+$[H],16);if(W)Z[3]=Number.parseInt(W+W,16)/255}else if($=Y.match(z)){for(H=0;H<3;H++)Z[H]=Number.parseInt($[H+1],10);if($[4])Z[3]=$[5]?Number.parseFloat($[4])*0.01:Number.parseFloat($[4])}else if($=Y.match(Q)){for(H=0;H<3;H++)Z[H]=Math.round(Number.parseFloat($[H+1])*2.55);if($[4])Z[3]=$[5]?Number.parseFloat($[4])*0.01:Number.parseFloat($[4])}else if($=Y.match(G)){if($[1]==="transparent")return[0,0,0,0];if(!Object.hasOwn(b4,$[1]))return null;return Z=b4[$[1]],Z[3]=1,Z}else return null;for(H=0;H<3;H++)Z[H]=S8(Z[H],0,255);return Z[3]=S8(Z[3],0,1),Z};Z1.get.hsl=function(Y){if(!Y)return null;let X=/^hsla?\(\s*([+-]?(?:\d{0,3}\.)?\d+)(?:deg)?\s*,?\s*([+-]?[\d.]+)%\s*,?\s*([+-]?[\d.]+)%\s*(?:[,|/]\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/,J=Y.match(X);if(J){let z=Number.parseFloat(J[4]),Q=(Number.parseFloat(J[1])%360+360)%360,G=S8(Number.parseFloat(J[2]),0,100),Z=S8(Number.parseFloat(J[3]),0,100),$=S8(Number.isNaN(z)?1:z,0,1);return[Q,G,Z,$]}return null};Z1.get.hwb=function(Y){if(!Y)return null;let X=/^hwb\(\s*([+-]?\d{0,3}(?:\.\d+)?)(?:deg)?\s*[\s,]\s*([+-]?[\d.]+)%\s*[\s,]\s*([+-]?[\d.]+)%\s*(?:[\s,]\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/,J=Y.match(X);if(J){let z=Number.parseFloat(J[4]),Q=(Number.parseFloat(J[1])%360+360)%360,G=S8(Number.parseFloat(J[2]),0,100),Z=S8(Number.parseFloat(J[3]),0,100),$=S8(Number.isNaN(z)?1:z,0,1);return[Q,G,Z,$]}return null};Z1.to.hex=function(...Y){return"#"+gY(Y[0])+gY(Y[1])+gY(Y[2])+(Y[3]<1?gY(Math.round(Y[3]*255)):"")};Z1.to.rgb=function(...Y){return Y.length<4||Y[3]===1?"rgb("+Math.round(Y[0])+", "+Math.round(Y[1])+", "+Math.round(Y[2])+")":"rgba("+Math.round(Y[0])+", "+Math.round(Y[1])+", "+Math.round(Y[2])+", "+Y[3]+")"};Z1.to.rgb.percent=function(...Y){let X=Math.round(Y[0]/255*100),J=Math.round(Y[1]/255*100),z=Math.round(Y[2]/255*100);return Y.length<4||Y[3]===1?"rgb("+X+"%, "+J+"%, "+z+"%)":"rgba("+X+"%, "+J+"%, "+z+"%, "+Y[3]+")"};Z1.to.hsl=function(...Y){return Y.length<4||Y[3]===1?"hsl("+Y[0]+", "+Y[1]+"%, "+Y[2]+"%)":"hsla("+Y[0]+", "+Y[1]+"%, "+Y[2]+"%, "+Y[3]+")"};Z1.to.hwb=function(...Y){let X="";if(Y.length>=4&&Y[3]!==1)X=", "+Y[3];return"hwb("+Y[0]+", "+Y[1]+"%, "+Y[2]+"%"+X+")"};Z1.to.keyword=function(...Y){return zR[Y.slice(0,3)]};function S8(Y,X,J){return Math.min(Math.max(X,Y),J)}function gY(Y){let X=Math.round(Y).toString(16).toUpperCase();return X.length<2?"0"+X:X}var QR={};for(let Y of Object.keys(b4))QR[b4[Y]]=Y;var Y0={rgb:{channels:3,labels:"rgb"},hsl:{channels:3,labels:"hsl"},hsv:{channels:3,labels:"hsv"},hwb:{channels:3,labels:"hwb"},cmyk:{channels:4,labels:"cmyk"},xyz:{channels:3,labels:"xyz"},lab:{channels:3,labels:"lab"},oklab:{channels:3,labels:["okl","oka","okb"]},lch:{channels:3,labels:"lch"},oklch:{channels:3,labels:["okl","okc","okh"]},hex:{channels:1,labels:["hex"]},keyword:{channels:1,labels:["keyword"]},ansi16:{channels:1,labels:["ansi16"]},ansi256:{channels:1,labels:["ansi256"]},hcg:{channels:3,labels:["h","c","g"]},apple:{channels:3,labels:["r16","g16","b16"]},gray:{channels:1,labels:["gray"]}},e4=0.008856451679035631;function W5(Y){let X=Y>0.0031308?1.055*Y**0.4166666666666667-0.055:Y*12.92;return Math.min(Math.max(0,X),1)}function K5(Y){return Y>0.04045?((Y+0.055)/1.055)**2.4:Y/12.92}for(let Y of Object.keys(Y0)){if(!("channels"in Y0[Y]))throw Error("missing channels property: "+Y);if(!("labels"in Y0[Y]))throw Error("missing channel labels property: "+Y);if(Y0[Y].labels.length!==Y0[Y].channels)throw Error("channel and label counts mismatch: "+Y);let{channels:X,labels:J}=Y0[Y];delete Y0[Y].channels,delete Y0[Y].labels,Object.defineProperty(Y0[Y],"channels",{value:X}),Object.defineProperty(Y0[Y],"labels",{value:J})}Y0.rgb.hsl=function(Y){let X=Y[0]/255,J=Y[1]/255,z=Y[2]/255,Q=Math.min(X,J,z),G=Math.max(X,J,z),Z=G-Q,$,H;switch(G){case Q:{$=0;break}case X:{$=(J-z)/Z;break}case J:{$=2+(z-X)/Z;break}case z:{$=4+(X-J)/Z;break}}if($=Math.min($*60,360),$<0)$+=360;let W=(Q+G)/2;if(G===Q)H=0;else if(W<=0.5)H=Z/(G+Q);else H=Z/(2-G-Q);return[$,H*100,W*100]};Y0.rgb.hsv=function(Y){let X,J,z,Q,G,Z=Y[0]/255,$=Y[1]/255,H=Y[2]/255,W=Math.max(Z,$,H),K=W-Math.min(Z,$,H),U=function(B){return(W-B)/6/K+0.5};if(K===0)Q=0,G=0;else{switch(G=K/W,X=U(Z),J=U($),z=U(H),W){case Z:{Q=z-J;break}case $:{Q=0.3333333333333333+X-z;break}case H:{Q=0.6666666666666666+J-X;break}}if(Q<0)Q+=1;else if(Q>1)Q-=1}return[Q*360,G*100,W*100]};Y0.rgb.hwb=function(Y){let X=Y[0],J=Y[1],z=Y[2],Q=Y0.rgb.hsl(Y)[0],G=0.00392156862745098*Math.min(X,Math.min(J,z));return z=1-0.00392156862745098*Math.max(X,Math.max(J,z)),[Q,G*100,z*100]};Y0.rgb.oklab=function(Y){let X=K5(Y[0]/255),J=K5(Y[1]/255),z=K5(Y[2]/255),Q=Math.cbrt(0.4122214708*X+0.5363325363*J+0.0514459929*z),G=Math.cbrt(0.2119034982*X+0.6806995451*J+0.1073969566*z),Z=Math.cbrt(0.0883024619*X+0.2817188376*J+0.6299787005*z),$=0.2104542553*Q+0.793617785*G-0.0040720468*Z,H=1.9779984951*Q-2.428592205*G+0.4505937099*Z,W=0.0259040371*Q+0.7827717662*G-0.808675766*Z;return[$*100,H*100,W*100]};Y0.rgb.cmyk=function(Y){let X=Y[0]/255,J=Y[1]/255,z=Y[2]/255,Q=Math.min(1-X,1-J,1-z),G=(1-X-Q)/(1-Q)||0,Z=(1-J-Q)/(1-Q)||0,$=(1-z-Q)/(1-Q)||0;return[G*100,Z*100,$*100,Q*100]};function W90(Y,X){return(Y[0]-X[0])**2+(Y[1]-X[1])**2+(Y[2]-X[2])**2}Y0.rgb.keyword=function(Y){let X=QR[Y];if(X)return X;let J=Number.POSITIVE_INFINITY,z;for(let Q of Object.keys(b4)){let G=b4[Q],Z=W90(Y,G);if(Z<J)J=Z,z=Q}return z};Y0.keyword.rgb=function(Y){return b4[Y]};Y0.rgb.xyz=function(Y){let X=K5(Y[0]/255),J=K5(Y[1]/255),z=K5(Y[2]/255),Q=X*0.4124564+J*0.3575761+z*0.1804375,G=X*0.2126729+J*0.7151522+z*0.072175,Z=X*0.0193339+J*0.119192+z*0.9503041;return[Q*100,G*100,Z*100]};Y0.rgb.lab=function(Y){let X=Y0.rgb.xyz(Y),J=X[0],z=X[1],Q=X[2];J/=95.047,z/=100,Q/=108.883,J=J>e4?J**0.3333333333333333:7.787*J+0.13793103448275862,z=z>e4?z**0.3333333333333333:7.787*z+0.13793103448275862,Q=Q>e4?Q**0.3333333333333333:7.787*Q+0.13793103448275862;let G=116*z-16,Z=500*(J-z),$=200*(z-Q);return[G,Z,$]};Y0.hsl.rgb=function(Y){let X=Y[0]/360,J=Y[1]/100,z=Y[2]/100,Q,G;if(J===0)return G=z*255,[G,G,G];let Z=z<0.5?z*(1+J):z+J-z*J,$=2*z-Z,H=[0,0,0];for(let W=0;W<3;W++){if(Q=X+0.3333333333333333*-(W-1),Q<0)Q++;if(Q>1)Q--;if(6*Q<1)G=$+(Z-$)*6*Q;else if(2*Q<1)G=Z;else if(3*Q<2)G=$+(Z-$)*(0.6666666666666666-Q)*6;else G=$;H[W]=G*255}return H};Y0.hsl.hsv=function(Y){let X=Y[0],J=Y[1]/100,z=Y[2]/100,Q=J,G=Math.max(z,0.01);z*=2,J*=z<=1?z:2-z,Q*=G<=1?G:2-G;let Z=(z+J)/2,$=z===0?2*Q/(G+Q):2*J/(z+J);return[X,$*100,Z*100]};Y0.hsv.rgb=function(Y){let X=Y[0]/60,J=Y[1]/100,z=Y[2]/100,Q=Math.floor(X)%6,G=X-Math.floor(X),Z=255*z*(1-J),$=255*z*(1-J*G),H=255*z*(1-J*(1-G));switch(z*=255,Q){case 0:return[z,H,Z];case 1:return[$,z,Z];case 2:return[Z,z,H];case 3:return[Z,$,z];case 4:return[H,Z,z];case 5:return[z,Z,$]}};Y0.hsv.hsl=function(Y){let X=Y[0],J=Y[1]/100,z=Y[2]/100,Q=Math.max(z,0.01),G,Z;Z=(2-J)*z;let $=(2-J)*Q;return G=J*Q,G/=$<=1?$:2-$,G=G||0,Z/=2,[X,G*100,Z*100]};Y0.hwb.rgb=function(Y){let X=Y[0]/360,J=Y[1]/100,z=Y[2]/100,Q=J+z,G;if(Q>1)J/=Q,z/=Q;let Z=Math.floor(6*X),$=1-z;if(G=6*X-Z,(Z&1)!==0)G=1-G;let H=J+G*($-J),W,K,U;switch(Z){default:case 6:case 0:{W=$,K=H,U=J;break}case 1:{W=H,K=$,U=J;break}case 2:{W=J,K=$,U=H;break}case 3:{W=J,K=H,U=$;break}case 4:{W=H,K=J,U=$;break}case 5:{W=$,K=J,U=H;break}}return[W*255,K*255,U*255]};Y0.cmyk.rgb=function(Y){let X=Y[0]/100,J=Y[1]/100,z=Y[2]/100,Q=Y[3]/100,G=1-Math.min(1,X*(1-Q)+Q),Z=1-Math.min(1,J*(1-Q)+Q),$=1-Math.min(1,z*(1-Q)+Q);return[G*255,Z*255,$*255]};Y0.xyz.rgb=function(Y){let X=Y[0]/100,J=Y[1]/100,z=Y[2]/100,Q,G,Z;return Q=X*3.2404542+J*-1.5371385+z*-0.4985314,G=X*-0.969266+J*1.8760108+z*0.041556,Z=X*0.0556434+J*-0.2040259+z*1.0572252,Q=W5(Q),G=W5(G),Z=W5(Z),[Q*255,G*255,Z*255]};Y0.xyz.lab=function(Y){let X=Y[0],J=Y[1],z=Y[2];X/=95.047,J/=100,z/=108.883,X=X>e4?X**0.3333333333333333:7.787*X+0.13793103448275862,J=J>e4?J**0.3333333333333333:7.787*J+0.13793103448275862,z=z>e4?z**0.3333333333333333:7.787*z+0.13793103448275862;let Q=116*J-16,G=500*(X-J),Z=200*(J-z);return[Q,G,Z]};Y0.xyz.oklab=function(Y){let X=Y[0]/100,J=Y[1]/100,z=Y[2]/100,Q=Math.cbrt(0.8189330101*X+0.3618667424*J-0.1288597137*z),G=Math.cbrt(0.0329845436*X+0.9293118715*J+0.0361456387*z),Z=Math.cbrt(0.0482003018*X+0.2643662691*J+0.633851707*z),$=0.2104542553*Q+0.793617785*G-0.0040720468*Z,H=1.9779984951*Q-2.428592205*G+0.4505937099*Z,W=0.0259040371*Q+0.7827717662*G-0.808675766*Z;return[$*100,H*100,W*100]};Y0.oklab.oklch=function(Y){return Y0.lab.lch(Y)};Y0.oklab.xyz=function(Y){let X=Y[0]/100,J=Y[1]/100,z=Y[2]/100,Q=(0.999999998*X+0.396337792*J+0.215803758*z)**3,G=(1.000000008*X-0.105561342*J-0.063854175*z)**3,Z=(1.000000055*X-0.089484182*J-1.291485538*z)**3,$=1.227013851*Q-0.55779998*G+0.281256149*Z,H=-0.040580178*Q+1.11225687*G-0.071676679*Z,W=-0.076381285*Q-0.421481978*G+1.58616322*Z;return[$*100,H*100,W*100]};Y0.oklab.rgb=function(Y){let X=Y[0]/100,J=Y[1]/100,z=Y[2]/100,Q=(X+0.3963377774*J+0.2158037573*z)**3,G=(X-0.1055613458*J-0.0638541728*z)**3,Z=(X-0.0894841775*J-1.291485548*z)**3,$=W5(4.0767416621*Q-3.3077115913*G+0.2309699292*Z),H=W5(-1.2684380046*Q+2.6097574011*G-0.3413193965*Z),W=W5(-0.0041960863*Q-0.7034186147*G+1.707614701*Z);return[$*255,H*255,W*255]};Y0.oklch.oklab=function(Y){return Y0.lch.lab(Y)};Y0.lab.xyz=function(Y){let X=Y[0],J=Y[1],z=Y[2],Q,G,Z;G=(X+16)/116,Q=J/500+G,Z=G-z/200;let $=G**3,H=Q**3,W=Z**3;return G=$>e4?$:(G-0.13793103448275862)/7.787,Q=H>e4?H:(Q-0.13793103448275862)/7.787,Z=W>e4?W:(Z-0.13793103448275862)/7.787,Q*=95.047,G*=100,Z*=108.883,[Q,G,Z]};Y0.lab.lch=function(Y){let X=Y[0],J=Y[1],z=Y[2],Q;if(Q=Math.atan2(z,J)*360/2/Math.PI,Q<0)Q+=360;let Z=Math.sqrt(J*J+z*z);return[X,Z,Q]};Y0.lch.lab=function(Y){let X=Y[0],J=Y[1],Q=Y[2]/360*2*Math.PI,G=J*Math.cos(Q),Z=J*Math.sin(Q);return[X,G,Z]};Y0.rgb.ansi16=function(Y,X=null){let[J,z,Q]=Y,G=X===null?Y0.rgb.hsv(Y)[2]:X;if(G=Math.round(G/50),G===0)return 30;let Z=30+(Math.round(Q/255)<<2|Math.round(z/255)<<1|Math.round(J/255));if(G===2)Z+=60;return Z};Y0.hsv.ansi16=function(Y){return Y0.rgb.ansi16(Y0.hsv.rgb(Y),Y[2])};Y0.rgb.ansi256=function(Y){let X=Y[0],J=Y[1],z=Y[2];if(X>>4===J>>4&&J>>4===z>>4){if(X<8)return 16;if(X>248)return 231;return Math.round((X-8)/247*24)+232}return 16+36*Math.round(X/255*5)+6*Math.round(J/255*5)+Math.round(z/255*5)};Y0.ansi16.rgb=function(Y){Y=Y[0];let X=Y%10;if(X===0||X===7){if(Y>50)X+=3.5;return X=X/10.5*255,[X,X,X]}let J=(Math.trunc(Y>50)+1)*0.5,z=(X&1)*J*255,Q=(X>>1&1)*J*255,G=(X>>2&1)*J*255;return[z,Q,G]};Y0.ansi256.rgb=function(Y){if(Y=Y[0],Y>=232){let G=(Y-232)*10+8;return[G,G,G]}Y-=16;let X,J=Math.floor(Y/36)/5*255,z=Math.floor((X=Y%36)/6)/5*255,Q=X%6/5*255;return[J,z,Q]};Y0.rgb.hex=function(Y){let J=(((Math.round(Y[0])&255)<<16)+((Math.round(Y[1])&255)<<8)+(Math.round(Y[2])&255)).toString(16).toUpperCase();return"000000".slice(J.length)+J};Y0.hex.rgb=function(Y){let X=Y.toString(16).match(/[a-f\d]{6}|[a-f\d]{3}/i);if(!X)return[0,0,0];let J=X[0];if(X[0].length===3)J=[...J].map(($)=>$+$).join("");let z=Number.parseInt(J,16),Q=z>>16&255,G=z>>8&255,Z=z&255;return[Q,G,Z]};Y0.rgb.hcg=function(Y){let X=Y[0]/255,J=Y[1]/255,z=Y[2]/255,Q=Math.max(Math.max(X,J),z),G=Math.min(Math.min(X,J),z),Z=Q-G,$,H=Z<1?G/(1-Z):0;if(Z<=0)$=0;else if(Q===X)$=(J-z)/Z%6;else if(Q===J)$=2+(z-X)/Z;else $=4+(X-J)/Z;return $/=6,$%=1,[$*360,Z*100,H*100]};Y0.hsl.hcg=function(Y){let X=Y[1]/100,J=Y[2]/100,z=J<0.5?2*X*J:2*X*(1-J),Q=0;if(z<1)Q=(J-0.5*z)/(1-z);return[Y[0],z*100,Q*100]};Y0.hsv.hcg=function(Y){let X=Y[1]/100,J=Y[2]/100,z=X*J,Q=0;if(z<1)Q=(J-z)/(1-z);return[Y[0],z*100,Q*100]};Y0.hcg.rgb=function(Y){let X=Y[0]/360,J=Y[1]/100,z=Y[2]/100;if(J===0)return[z*255,z*255,z*255];let Q=[0,0,0],G=X%1*6,Z=G%1,$=1-Z,H=0;switch(Math.floor(G)){case 0:{Q[0]=1,Q[1]=Z,Q[2]=0;break}case 1:{Q[0]=$,Q[1]=1,Q[2]=0;break}case 2:{Q[0]=0,Q[1]=1,Q[2]=Z;break}case 3:{Q[0]=0,Q[1]=$,Q[2]=1;break}case 4:{Q[0]=Z,Q[1]=0,Q[2]=1;break}default:Q[0]=1,Q[1]=0,Q[2]=$}return H=(1-J)*z,[(J*Q[0]+H)*255,(J*Q[1]+H)*255,(J*Q[2]+H)*255]};Y0.hcg.hsv=function(Y){let X=Y[1]/100,J=Y[2]/100,z=X+J*(1-X),Q=0;if(z>0)Q=X/z;return[Y[0],Q*100,z*100]};Y0.hcg.hsl=function(Y){let X=Y[1]/100,z=Y[2]/100*(1-X)+0.5*X,Q=0;if(z>0&&z<0.5)Q=X/(2*z);else if(z>=0.5&&z<1)Q=X/(2*(1-z));return[Y[0],Q*100,z*100]};Y0.hcg.hwb=function(Y){let X=Y[1]/100,J=Y[2]/100,z=X+J*(1-X);return[Y[0],(z-X)*100,(1-z)*100]};Y0.hwb.hcg=function(Y){let X=Y[1]/100,z=1-Y[2]/100,Q=z-X,G=0;if(Q<1)G=(z-Q)/(1-Q);return[Y[0],Q*100,G*100]};Y0.apple.rgb=function(Y){return[Y[0]/65535*255,Y[1]/65535*255,Y[2]/65535*255]};Y0.rgb.apple=function(Y){return[Y[0]/255*65535,Y[1]/255*65535,Y[2]/255*65535]};Y0.gray.rgb=function(Y){return[Y[0]/100*255,Y[0]/100*255,Y[0]/100*255]};Y0.gray.hsl=function(Y){return[0,0,Y[0]]};Y0.gray.hsv=Y0.gray.hsl;Y0.gray.hwb=function(Y){return[0,100,Y[0]]};Y0.gray.cmyk=function(Y){return[0,0,0,Y[0]]};Y0.gray.lab=function(Y){return[Y[0],0,0]};Y0.gray.hex=function(Y){let X=Math.round(Y[0]/100*255)&255,z=((X<<16)+(X<<8)+X).toString(16).toUpperCase();return"000000".slice(z.length)+z};Y0.rgb.gray=function(Y){return[(Y[0]+Y[1]+Y[2])/3/255*100]};function K90(){let Y={},X=Object.keys(Y0);for(let{length:J}=X,z=0;z<J;z++)Y[X[z]]={distance:-1,parent:null};return Y}function U90(Y){let X=K90(),J=[Y];X[Y].distance=0;while(J.length>0){let z=J.pop(),Q=Object.keys(Y0[z]);for(let{length:G}=Q,Z=0;Z<G;Z++){let $=Q[Z],H=X[$];if(H.distance===-1)H.distance=X[z].distance+1,H.parent=z,J.unshift($)}}return X}function B90(Y,X){return function(J){return X(Y(J))}}function V90(Y,X){let J=[X[Y].parent,Y],z=Y0[X[Y].parent][Y],Q=X[Y].parent;while(X[Q].parent)J.unshift(X[Q].parent),z=B90(Y0[X[Q].parent][Q],z),Q=X[Q].parent;return z.conversion=J,z}function O90(Y){let X=U90(Y),J={},z=Object.keys(X);for(let{length:Q}=z,G=0;G<Q;G++){let Z=z[G];if(X[Z].parent===null)continue;J[Z]=V90(Z,X)}return J}var B1={},M90=Object.keys(Y0);function L90(Y){let X=function(...J){let z=J[0];if(z===void 0||z===null)return z;if(z.length>1)J=z;return Y(J)};if("conversion"in Y)X.conversion=Y.conversion;return X}function N90(Y){let X=function(...J){let z=J[0];if(z===void 0||z===null)return z;if(z.length>1)J=z;let Q=Y(J);if(typeof Q==="object")for(let{length:G}=Q,Z=0;Z<G;Z++)Q[Z]=Math.round(Q[Z]);return Q};if("conversion"in Y)X.conversion=Y.conversion;return X}for(let Y of M90){B1[Y]={},Object.defineProperty(B1[Y],"channels",{value:Y0[Y].channels}),Object.defineProperty(B1[Y],"labels",{value:Y0[Y].labels});let X=O90(Y),J=Object.keys(X);for(let z of J){let Q=X[z];B1[Y][z]=N90(Q),B1[Y][z].raw=L90(Q)}}var GR=["keyword","gray","hex"],B$={};for(let Y of Object.keys(B1))B$[[...B1[Y].labels].sort().join("")]=Y;var V$={};function G1(Y,X){if(!(this instanceof G1))return new G1(Y,X);if(X&&X in GR)X=null;if(X&&!(X in B1))throw Error("Unknown model: "+X);let J,z;if(Y==null)this.model="rgb",this.color=[0,0,0],this.valpha=1;else if(Y instanceof G1)this.model=Y.model,this.color=[...Y.color],this.valpha=Y.valpha;else if(typeof Y==="string"){let Q=Z1.get(Y);if(Q===null)throw Error("Unable to parse color from string: "+Y);this.model=Q.model,z=B1[this.model].channels,this.color=Q.value.slice(0,z),this.valpha=typeof Q.value[z]==="number"?Q.value[z]:1}else if(Y.length>0){this.model=X||"rgb",z=B1[this.model].channels;let Q=Array.prototype.slice.call(Y,0,z);this.color=O$(Q,z),this.valpha=typeof Y[z]==="number"?Y[z]:1}else if(typeof Y==="number")this.model="rgb",this.color=[Y>>16&255,Y>>8&255,Y&255],this.valpha=1;else{this.valpha=1;let Q=Object.keys(Y);if("alpha"in Y)Q.splice(Q.indexOf("alpha"),1),this.valpha=typeof Y.alpha==="number"?Y.alpha:0;let G=Q.sort().join("");if(!(G in B$))throw Error("Unable to parse color from object: "+JSON.stringify(Y));this.model=B$[G];let{labels:Z}=B1[this.model],$=[];for(J=0;J<Z.length;J++)$.push(Y[Z[J]]);this.color=O$($)}if(V$[this.model]){z=B1[this.model].channels;for(J=0;J<z;J++){let Q=V$[this.model][J];if(Q)this.color[J]=Q(this.color[J])}}if(this.valpha=Math.max(0,Math.min(1,this.valpha)),Object.freeze)Object.freeze(this)}G1.prototype={toString(){return this.string()},toJSON(){return this[this.model]()},string(Y){let X=this.model in Z1.to?this:this.rgb();X=X.round(typeof Y==="number"?Y:1);let J=X.valpha===1?X.color:[...X.color,this.valpha];return Z1.to[X.model](...J)},percentString(Y){let X=this.rgb().round(typeof Y==="number"?Y:1),J=X.valpha===1?X.color:[...X.color,this.valpha];return Z1.to.rgb.percent(...J)},array(){return this.valpha===1?[...this.color]:[...this.color,this.valpha]},object(){let Y={},{channels:X}=B1[this.model],{labels:J}=B1[this.model];for(let z=0;z<X;z++)Y[J[z]]=this.color[z];if(this.valpha!==1)Y.alpha=this.valpha;return Y},unitArray(){let Y=this.rgb().color;if(Y[0]/=255,Y[1]/=255,Y[2]/=255,this.valpha!==1)Y.push(this.valpha);return Y},unitObject(){let Y=this.rgb().object();if(Y.r/=255,Y.g/=255,Y.b/=255,this.valpha!==1)Y.alpha=this.valpha;return Y},round(Y){return Y=Math.max(Y||0,0),new G1([...this.color.map(x90(Y)),this.valpha],this.model)},alpha(Y){if(Y!==void 0)return new G1([...this.color,Math.max(0,Math.min(1,Y))],this.model);return this.valpha},red:e0("rgb",0,Q1(255)),green:e0("rgb",1,Q1(255)),blue:e0("rgb",2,Q1(255)),hue:e0(["hsl","hsv","hsl","hwb","hcg"],0,(Y)=>(Y%360+360)%360),saturationl:e0("hsl",1,Q1(100)),lightness:e0("hsl",2,Q1(100)),saturationv:e0("hsv",1,Q1(100)),value:e0("hsv",2,Q1(100)),chroma:e0("hcg",1,Q1(100)),gray:e0("hcg",2,Q1(100)),white:e0("hwb",1,Q1(100)),wblack:e0("hwb",2,Q1(100)),cyan:e0("cmyk",0,Q1(100)),magenta:e0("cmyk",1,Q1(100)),yellow:e0("cmyk",2,Q1(100)),black:e0("cmyk",3,Q1(100)),x:e0("xyz",0,Q1(95.047)),y:e0("xyz",1,Q1(100)),z:e0("xyz",2,Q1(108.833)),l:e0("lab",0,Q1(100)),a:e0("lab",1),b:e0("lab",2),keyword(Y){if(Y!==void 0)return new G1(Y);return B1[this.model].keyword(this.color)},hex(Y){if(Y!==void 0)return new G1(Y);return Z1.to.hex(...this.rgb().round().color)},hexa(Y){if(Y!==void 0)return new G1(Y);let X=this.rgb().round().color,J=Math.round(this.valpha*255).toString(16).toUpperCase();if(J.length===1)J="0"+J;return Z1.to.hex(...X)+J},rgbNumber(){let Y=this.rgb().color;return(Y[0]&255)<<16|(Y[1]&255)<<8|Y[2]&255},luminosity(){let Y=this.rgb().color,X=[];for(let[J,z]of Y.entries()){let Q=z/255;X[J]=Q<=0.04045?Q/12.92:((Q+0.055)/1.055)**2.4}return 0.2126*X[0]+0.7152*X[1]+0.0722*X[2]},contrast(Y){let X=this.luminosity(),J=Y.luminosity();if(X>J)return(X+0.05)/(J+0.05);return(J+0.05)/(X+0.05)},level(Y){let X=this.contrast(Y);if(X>=7)return"AAA";return X>=4.5?"AA":""},isDark(){let Y=this.rgb().color;return(Y[0]*2126+Y[1]*7152+Y[2]*722)/1e4<128},isLight(){return!this.isDark()},negate(){let Y=this.rgb();for(let X=0;X<3;X++)Y.color[X]=255-Y.color[X];return Y},lighten(Y){let X=this.hsl();return X.color[2]+=X.color[2]*Y,X},darken(Y){let X=this.hsl();return X.color[2]-=X.color[2]*Y,X},saturate(Y){let X=this.hsl();return X.color[1]+=X.color[1]*Y,X},desaturate(Y){let X=this.hsl();return X.color[1]-=X.color[1]*Y,X},whiten(Y){let X=this.hwb();return X.color[1]+=X.color[1]*Y,X},blacken(Y){let X=this.hwb();return X.color[2]+=X.color[2]*Y,X},grayscale(){let Y=this.rgb().color,X=Y[0]*0.3+Y[1]*0.59+Y[2]*0.11;return G1.rgb(X,X,X)},fade(Y){return this.alpha(this.valpha-this.valpha*Y)},opaquer(Y){return this.alpha(this.valpha+this.valpha*Y)},rotate(Y){let X=this.hsl(),J=X.color[0];return J=(J+Y)%360,J=J<0?360+J:J,X.color[0]=J,X},mix(Y,X){if(!Y||!Y.rgb)throw Error('Argument to "mix" was not a Color instance, but rather an instance of '+typeof Y);let J=Y.rgb(),z=this.rgb(),Q=X===void 0?0.5:X,G=2*Q-1,Z=J.alpha()-z.alpha(),$=((G*Z===-1?G:(G+Z)/(1+G*Z))+1)/2,H=1-$;return G1.rgb($*J.red()+H*z.red(),$*J.green()+H*z.green(),$*J.blue()+H*z.blue(),J.alpha()*Q+z.alpha()*(1-Q))}};for(let Y of Object.keys(B1)){if(GR.includes(Y))continue;let{channels:X}=B1[Y];G1.prototype[Y]=function(...J){if(this.model===Y)return new G1(this);if(J.length>0)return new G1(J,Y);return new G1([...F90(B1[this.model][Y].raw(this.color)),this.valpha],Y)},G1[Y]=function(...J){let z=J[0];if(typeof z==="number")z=O$(J,X);return new G1(z,Y)}}function q90(Y,X){return Number(Y.toFixed(X))}function x90(Y){return function(X){return q90(X,Y)}}function e0(Y,X,J){Y=Array.isArray(Y)?Y:[Y];for(let z of Y)(V$[z]||=[])[X]=J;return Y=Y[0],function(z){let Q;if(z!==void 0){if(J)z=J(z);return Q=this[Y](),Q.color[X]=z,Q}if(Q=this[Y]().color[X],J)Q=J(Q);return Q}}function Q1(Y){return function(X){return Math.max(0,Math.min(Y,X))}}function F90(Y){return Array.isArray(Y)?Y:[Y]}function O$(Y,X){for(let J=0;J<X;J++)if(typeof Y[J]!=="number")Y[J]=0;return Y}function P90(Y){return Y&&Y.__esModule&&Object.prototype.hasOwnProperty.call(Y,"default")?Y.default:Y}var A90=function(X){for(var J=0,z=0;J<X.length;z=X.charCodeAt(J++)+((z<<5)-z));var Q=Math.floor(Math.abs(Math.sin(z)*1e4%1*16777216)).toString(16);return"#"+Array(6-Q.length+1).join("0")+Q},JR=P90(A90);function w90(Y,X){let J=Y.split(X||":"),z=JR(J[0]);if(!J.length)return z;for(let Q=0,G=J.length-1;Q<G;Q++)z=G1(z).mix(G1(JR(J[Q+1]))).saturate(1).hex();return z}ZR.exports=w90});var WR=C((Eh0,HR)=>{function A4(Y,X){if(X)return new A4(Y).style(X);if(!(this instanceof A4))return new A4(Y);this.text=Y}A4.prototype.prefix="\x1B[";A4.prototype.suffix="m";A4.prototype.hex=function(X){if(X=X[0]==="#"?X.substring(1):X,X.length===3)X=X.split(""),X[5]=X[2],X[4]=X[2],X[3]=X[1],X[2]=X[1],X[1]=X[0],X=X.join("");var J=X.substring(0,2),z=X.substring(2,4),Q=X.substring(4,6);return[parseInt(J,16),parseInt(z,16),parseInt(Q,16)]};A4.prototype.rgb=function(X,J,z){var Q=X/255*5,G=J/255*5,Z=z/255*5;return this.ansi(Q,G,Z)};A4.prototype.ansi=function(X,J,z){var Q=Math.round(X),G=Math.round(J),Z=Math.round(z);return 16+Q*36+G*6+Z};A4.prototype.reset=function(){return this.prefix+"39;49"+this.suffix};A4.prototype.style=function(X){return this.prefix+"38;5;"+this.rgb.apply(this,this.hex(X))+this.suffix+this.text+this.reset()};HR.exports=A4});var UR=C((Sh0,KR)=>{var T90=$R(),I90=WR();KR.exports=function(X,J){var z=J.namespace,Q=J.colors!==!1?I90(z+":",T90(z)):z+":";return X[0]=Q+" "+X[0],X}});var VR=C((kh0,BR)=>{BR.exports=function(X,J){if(!J)return!1;var z=J.split(/[\s,]+/),Q=0;for(;Q<z.length;Q++){if(J=z[Q].replace("*",".*?"),J.charAt(0)==="-"){if(new RegExp("^"+J.substr(1)+"$").test(X))return!1;continue}if(new RegExp("^"+J+"$").test(X))return!0}return!1}});var MR=C((_h0,OR)=>{var v90=VR();OR.exports=function(X){return function(z){try{return v90(z,X())}catch(Q){}return!1}}});var NR=C((bh0,LR)=>{var D90=MR();LR.exports=D90(function(){return process.env.DEBUG||process.env.DIAGNOSTICS})});var xR=C((Rh0,qR)=>{qR.exports=function(Y,X){try{Function.prototype.apply.call(console.log,console,X)}catch(J){}}});var Q3=C((fh0,FR)=>{var j90=XR(),C90=Q0("tty").isatty(1),pY=j90(function Y(X,J){if(J=J||{},J.colors="colors"in J?J.colors:C90,J.namespace=X,J.prod=!1,J.dev=!0,!Y.enabled(X)&&!(J.force||Y.force))return Y.nope(J);return Y.yep(J)});pY.modify(UR());pY.use(NR());pY.set(xR());FR.exports=pY});var AR=C((yh0,PR)=>{var M$=Q0("fs"),{StringDecoder:E90}=Q0("string_decoder"),{Stream:S90}=W6();function k90(){}PR.exports=(Y,X)=>{let J=Buffer.alloc(65536),z=new E90("utf8"),Q=new S90,G="",Z=0,$=0;if(Y.start===-1)delete Y.start;if(Q.readable=!0,Q.destroy=()=>{Q.destroyed=!0,Q.emit("end"),Q.emit("close")},M$.open(Y.file,"a+","0644",(H,W)=>{if(H){if(!X)Q.emit("error",H);else X(H);Q.destroy();return}(function K(){if(Q.destroyed){M$.close(W,k90);return}return M$.read(W,J,0,J.length,Z,(U,B)=>{if(U){if(!X)Q.emit("error",U);else X(U);Q.destroy();return}if(!B){if(G){if(Y.start==null||$>Y.start)if(!X)Q.emit("line",G);else X(null,G);$++,G=""}return setTimeout(K,1000)}let O=z.write(J.slice(0,B));if(!X)Q.emit("data",O);O=(G+O).split(/\n+/);let V=O.length-1,L=0;for(;L<V;L++){if(Y.start==null||$>Y.start)if(!X)Q.emit("line",O[L]);else X(null,O[L]);$++}return G=O[V],Z+=B,K()})})()}),!X)return Q;return Q.destroy}});var vR=C((hh0,IR)=>{var u1=Q0("fs"),V1=Q0("path"),wR=pb(),_90=Q0("zlib"),{MESSAGE:b90}=J1(),{Stream:R90,PassThrough:TR}=W6(),f90=G5(),w4=Q3()("winston:file"),y90=Q0("os"),h90=AR();IR.exports=class extends f90{constructor(X={}){super(X);this.name=X.name||"file";function J(z,...Q){Q.slice(1).forEach((G)=>{if(X[G])throw Error(`Cannot set ${G} and ${z} together`)})}if(this._stream=new TR,this._stream.setMaxListeners(30),this._onError=this._onError.bind(this),X.filename||X.dirname)J("filename or dirname","stream"),this._basename=this.filename=X.filename?V1.basename(X.filename):"winston.log",this.dirname=X.dirname||V1.dirname(X.filename),this.options=X.options||{flags:"a"};else if(X.stream)console.warn("options.stream will be removed in winston@4. Use winston.transports.Stream"),J("stream","filename","maxsize"),this._dest=this._stream.pipe(this._setupStream(X.stream)),this.dirname=V1.dirname(this._dest.path);else throw Error("Cannot log to file without filename or stream.");if(this.maxsize=X.maxsize||null,this.rotationFormat=X.rotationFormat||!1,this.zippedArchive=X.zippedArchive||!1,this.maxFiles=X.maxFiles||null,this.eol=typeof X.eol==="string"?X.eol:y90.EOL,this.tailable=X.tailable||!1,this.lazy=X.lazy||!1,this._size=0,this._pendingSize=0,this._created=0,this._drain=!1,this._opening=!1,this._ending=!1,this._fileExist=!1,this.dirname)this._createLogDirIfNotExist(this.dirname);if(!this.lazy)this.open()}finishIfEnding(){if(this._ending)if(this._opening)this.once("open",()=>{this._stream.once("finish",()=>this.emit("finish")),setImmediate(()=>this._stream.end())});else this._stream.once("finish",()=>this.emit("finish")),setImmediate(()=>this._stream.end())}_final(X){if(this._opening){this.once("open",()=>this._final(X));return}if(this._stream.end(),!this._dest)return X();if(this._dest.writableFinished)return X();this._dest.once("finish",X),this._dest.once("error",X)}log(X,J=()=>{}){if(this.silent)return J(),!0;if(this._drain){this._stream.once("drain",()=>{this._drain=!1,this.log(X,J)});return}if(this._rotate){this._stream.once("rotate",()=>{this._rotate=!1,this.log(X,J)});return}if(this.lazy){if(!this._fileExist){if(!this._opening)this.open();this.once("open",()=>{this._fileExist=!0,this.log(X,J);return});return}if(this._needsNewFile(this._pendingSize)){this._dest.once("close",()=>{if(!this._opening)this.open();this.once("open",()=>{this.log(X,J);return});return});return}}let z=`${X[b90]}${this.eol}`,Q=Buffer.byteLength(z);function G(){if(this._size+=Q,this._pendingSize-=Q,w4("logged %s %s",this._size,z),this.emit("logged",X),this._rotate)return;if(this._opening)return;if(!this._needsNewFile())return;if(this.lazy){this._endStream(()=>{this.emit("fileclosed")});return}this._rotate=!0,this._endStream(()=>this._rotateFile())}if(this._pendingSize+=Q,this._opening&&!this.rotatedWhileOpening&&this._needsNewFile(this._size+this._pendingSize))this.rotatedWhileOpening=!0;let Z=this._stream.write(z,G.bind(this));if(!Z)this._drain=!0,this._stream.once("drain",()=>{this._drain=!1,J()});else J();return w4("written",Z,this._drain),this.finishIfEnding(),Z}query(X,J){if(typeof X==="function")J=X,X={};X=U(X);let z=V1.join(this.dirname,this.filename),Q="",G=[],Z=0,$=u1.createReadStream(z,{encoding:"utf8"});$.on("error",(B)=>{if($.readable)$.destroy();if(!J)return;return B.code!=="ENOENT"?J(B):J(null,G)}),$.on("data",(B)=>{B=(Q+B).split(/\n+/);let O=B.length-1,V=0;for(;V<O;V++){if(!X.start||Z>=X.start)H(B[V]);Z++}Q=B[O]}),$.on("close",()=>{if(Q)H(Q,!0);if(X.order==="desc")G=G.reverse();if(J)J(null,G)});function H(B,O){try{let V=JSON.parse(B);if(K(V))W(V)}catch(V){if(!O)$.emit("error",V)}}function W(B){if(X.rows&&G.length>=X.rows&&X.order!=="desc"){if($.readable)$.destroy();return}if(X.fields)B=X.fields.reduce((O,V)=>{return O[V]=B[V],O},{});if(X.order==="desc"){if(G.length>=X.rows)G.shift()}G.push(B)}function K(B){if(!B)return;if(typeof B!=="object")return;let O=new Date(B.timestamp);if(X.from&&O<X.from||X.until&&O>X.until||X.level&&X.level!==B.level)return;return!0}function U(B){if(B=B||{},B.rows=B.rows||B.limit||10,B.start=B.start||0,B.until=B.until||new Date,typeof B.until!=="object")B.until=new Date(B.until);if(B.from=B.from||B.until-86400000,typeof B.from!=="object")B.from=new Date(B.from);return B.order=B.order||"desc",B}}stream(X={}){let J=V1.join(this.dirname,this.filename),z=new R90,Q={file:J,start:X.start};return z.destroy=h90(Q,(G,Z)=>{if(G)return z.emit("error",G);try{z.emit("data",Z),Z=JSON.parse(Z),z.emit("log",Z)}catch($){z.emit("error",$)}}),z}open(){if(!this.filename)return;if(this._opening)return;this._opening=!0,this.stat((X,J)=>{if(X)return this.emit("error",X);w4("stat done: %s { size: %s }",this.filename,J),this._size=J,this._dest=this._createStream(this._stream),this._opening=!1,this.once("open",()=>{if(!this._stream.emit("rotate"))this._rotate=!1})})}stat(X){let J=this._getFile(),z=V1.join(this.dirname,J);u1.stat(z,(Q,G)=>{if(Q&&Q.code==="ENOENT")return w4("ENOENTok",z),this.filename=J,X(null,0);if(Q)return w4(`err ${Q.code} ${z}`),X(Q);if(!G||this._needsNewFile(G.size))return this._incFile(()=>this.stat(X));this.filename=J,X(null,G.size)})}close(X){if(!this._stream)return;this._stream.end(()=>{if(X)X();this.emit("flush"),this.emit("closed")})}_needsNewFile(X){return X=X||this._size,this.maxsize&&X>=this.maxsize}_onError(X){this.emit("error",X)}_setupStream(X){return X.on("error",this._onError),X}_cleanupStream(X){return X.removeListener("error",this._onError),X.destroy(),X}_rotateFile(){this._incFile(()=>this.open())}_endStream(X=()=>{}){if(this._dest)this._stream.unpipe(this._dest),this._dest.end(()=>{this._cleanupStream(this._dest),X()});else X()}_createStream(X){let J=V1.join(this.dirname,this.filename);w4("create stream start",J,this.options);let z=u1.createWriteStream(J,this.options).on("error",(Q)=>w4(Q)).on("close",()=>w4("close",z.path,z.bytesWritten)).on("open",()=>{if(w4("file open ok",J),this.emit("open",J),X.pipe(z),this.rotatedWhileOpening)this._stream=new TR,this._stream.setMaxListeners(30),this._rotateFile(),this.rotatedWhileOpening=!1,this._cleanupStream(z),X.end()});return w4("create stream ok",J),z}_incFile(X){w4("_incFile",this.filename);let J=V1.extname(this._basename),z=V1.basename(this._basename,J),Q=[];if(this.zippedArchive)Q.push(function(G){let Z=this._created>0&&!this.tailable?this._created:"";this._compressFile(V1.join(this.dirname,`${z}${Z}${J}`),V1.join(this.dirname,`${z}${Z}${J}.gz`),G)}.bind(this));Q.push(function(G){if(!this.tailable)this._created+=1,this._checkMaxFilesIncrementing(J,z,G);else this._checkMaxFilesTailable(J,z,G)}.bind(this)),wR(Q,X)}_getFile(){let X=V1.extname(this._basename),J=V1.basename(this._basename,X),z=this.rotationFormat?this.rotationFormat():this._created;return!this.tailable&&this._created?`${J}${z}${X}`:`${J}${X}`}_checkMaxFilesIncrementing(X,J,z){if(!this.maxFiles||this._created<this.maxFiles)return setImmediate(z);let Q=this._created-this.maxFiles,G=Q!==0?Q:"",Z=this.zippedArchive?".gz":"",$=`${J}${G}${X}${Z}`,H=V1.join(this.dirname,$);u1.unlink(H,z)}_checkMaxFilesTailable(X,J,z){let Q=[];if(!this.maxFiles)return;let G=this.zippedArchive?".gz":"";for(let Z=this.maxFiles-1;Z>1;Z--)Q.push(function($,H){let W=`${J}${$-1}${X}${G}`,K=V1.join(this.dirname,W);u1.exists(K,(U)=>{if(!U)return H(null);W=`${J}${$}${X}${G}`,u1.rename(K,V1.join(this.dirname,W),H)})}.bind(this,Z));wR(Q,()=>{u1.rename(V1.join(this.dirname,`${J}${X}${G}`),V1.join(this.dirname,`${J}1${X}${G}`),z)})}_compressFile(X,J,z){u1.access(X,u1.F_OK,(Q)=>{if(Q)return z();var G=_90.createGzip(),Z=u1.createReadStream(X),$=u1.createWriteStream(J);$.on("finish",()=>{u1.unlink(X,z)}),Z.pipe(G).pipe($)})}_createLogDirIfNotExist(X){if(!u1.existsSync(X))u1.mkdirSync(X,{recursive:!0})}}});var jR=C((mh0,DR)=>{var m90=Q0("http"),u90=Q0("https"),{Stream:g90}=W6(),p90=G5(),{configure:c90}=u7();DR.exports=class extends p90{constructor(X={}){super(X);if(this.options=X,this.name=X.name||"http",this.ssl=!!X.ssl,this.host=X.host||"localhost",this.port=X.port,this.auth=X.auth,this.path=X.path||"",this.maximumDepth=X.maximumDepth,this.agent=X.agent,this.headers=X.headers||{},this.headers["content-type"]="application/json",this.batch=X.batch||!1,this.batchInterval=X.batchInterval||5000,this.batchCount=X.batchCount||10,this.batchOptions=[],this.batchTimeoutID=-1,this.batchCallback={},!this.port)this.port=this.ssl?443:80}log(X,J){if(this._request(X,null,null,(z,Q)=>{if(Q&&Q.statusCode!==200)z=Error(`Invalid HTTP Status Code: ${Q.statusCode}`);if(z)this.emit("warn",z);else this.emit("logged",X)}),J)setImmediate(J)}query(X,J){if(typeof X==="function")J=X,X={};X={method:"query",params:this.normalizeQuery(X)};let z=X.params.auth||null;delete X.params.auth;let Q=X.params.path||null;delete X.params.path,this._request(X,z,Q,(G,Z,$)=>{if(Z&&Z.statusCode!==200)G=Error(`Invalid HTTP Status Code: ${Z.statusCode}`);if(G)return J(G);if(typeof $==="string")try{$=JSON.parse($)}catch(H){return J(H)}J(null,$)})}stream(X={}){let J=new g90;X={method:"stream",params:X};let z=X.params.path||null;delete X.params.path;let Q=X.params.auth||null;delete X.params.auth;let G="",Z=this._request(X,Q,z);return J.destroy=()=>Z.destroy(),Z.on("data",($)=>{$=(G+$).split(/\n+/);let H=$.length-1,W=0;for(;W<H;W++)try{J.emit("log",JSON.parse($[W]))}catch(K){J.emit("error",K)}G=$[H]}),Z.on("error",($)=>J.emit("error",$)),J}_request(X,J,z,Q){if(X=X||{},J=J||this.auth,z=z||this.path||"",this.batch)this._doBatch(X,Q,J,z);else this._doRequest(X,Q,J,z)}_doBatch(X,J,z,Q){if(this.batchOptions.push(X),this.batchOptions.length===1){let G=this;this.batchCallback=J,this.batchTimeoutID=setTimeout(function(){G.batchTimeoutID=-1,G._doBatchRequest(G.batchCallback,z,Q)},this.batchInterval)}if(this.batchOptions.length===this.batchCount)this._doBatchRequest(this.batchCallback,z,Q)}_doBatchRequest(X,J,z){if(this.batchTimeoutID>0)clearTimeout(this.batchTimeoutID),this.batchTimeoutID=-1;let Q=this.batchOptions.slice();this.batchOptions=[],this._doRequest(Q,X,J,z)}_doRequest(X,J,z,Q){let G=Object.assign({},this.headers);if(z&&z.bearer)G.Authorization=`Bearer ${z.bearer}`;let Z=(this.ssl?u90:m90).request({...this.options,method:"POST",host:this.host,port:this.port,path:`/${Q.replace(/^\//,"")}`,headers:G,auth:z&&z.username&&z.password?`${z.username}:${z.password}`:"",agent:this.agent});Z.on("error",J),Z.on("response",(H)=>H.on("end",()=>J(null,H)).resume());let $=c90({...this.maximumDepth&&{maximumDepth:this.maximumDepth}});Z.end(Buffer.from($(X,this.options.replacer),"utf8"))}}});var L$=C((uh0,CR)=>{var R4=(Y)=>Y!==null&&typeof Y==="object"&&typeof Y.pipe==="function";R4.writable=(Y)=>R4(Y)&&Y.writable!==!1&&typeof Y._write==="function"&&typeof Y._writableState==="object";R4.readable=(Y)=>R4(Y)&&Y.readable!==!1&&typeof Y._read==="function"&&typeof Y._readableState==="object";R4.duplex=(Y)=>R4.writable(Y)&&R4.readable(Y);R4.transform=(Y)=>R4.duplex(Y)&&typeof Y._transform==="function";CR.exports=R4});var SR=C((gh0,ER)=>{var d90=L$(),{MESSAGE:l90}=J1(),i90=Q0("os"),n90=G5();ER.exports=class extends n90{constructor(X={}){super(X);if(!X.stream||!d90(X.stream))throw Error("options.stream is required.");this._stream=X.stream,this._stream.setMaxListeners(1/0),this.isObjectMode=X.stream._writableState.objectMode,this.eol=typeof X.eol==="string"?X.eol:i90.EOL}log(X,J){if(setImmediate(()=>this.emit("logged",X)),this.isObjectMode){if(this._stream.write(X),J)J();return}if(this._stream.write(`${X[l90]}${this.eol}`),J)J();return}}});var kR=C((G3)=>{Object.defineProperty(G3,"Console",{configurable:!0,enumerable:!0,get(){return zb()}});Object.defineProperty(G3,"File",{configurable:!0,enumerable:!0,get(){return vR()}});Object.defineProperty(G3,"Http",{configurable:!0,enumerable:!0,get(){return jR()}});Object.defineProperty(G3,"Stream",{configurable:!0,enumerable:!0,get(){return SR()}})});var dY=C((o90)=>{var cY=$Z(),{configs:N$}=J1();o90.cli=cY.levels(N$.cli);o90.npm=cY.levels(N$.npm);o90.syslog=cY.levels(N$.syslog);o90.addColors=cY.levels});var bR=C((q$,_R)=>{Object.defineProperty(q$,"__esModule",{value:!0});var e90=yY(),YY0=K6(e90),XY0=hY(),JY0=K6(XY0),zY0=X$(),QY0=K6(zY0),GY0=lZ(),ZY0=K6(GY0),$Y0=aZ(),HY0=K6($Y0),WY0=H6(),KY0=K6(WY0),UY0=$5(),BY0=K6(UY0);function K6(Y){return Y&&Y.__esModule?Y:{default:Y}}function VY0(Y,X,J){J=(0,ZY0.default)(J);var z=0,Q=0,{length:G}=Y,Z=!1;if(G===0)J(null);function $(H,W){if(H===!1)Z=!0;if(Z===!0)return;if(H)J(H);else if(++Q===G||W===JY0.default)J(null)}for(;z<G;z++)X(Y[z],z,(0,HY0.default)($))}function OY0(Y,X,J){return(0,QY0.default)(Y,1/0,X,J)}function MY0(Y,X,J){var z=(0,YY0.default)(Y)?VY0:OY0;return z(Y,(0,KY0.default)(X),J)}q$.default=(0,BY0.default)(MY0,3);_R.exports=q$.default});var fR=C((x$,RR)=>{Object.defineProperty(x$,"__esModule",{value:!0});x$.default=NY0;function NY0(Y){return(X,J,z)=>Y(X,z)}RR.exports=x$.default});var iY=C((F$,yR)=>{Object.defineProperty(F$,"__esModule",{value:!0});var xY0=bR(),FY0=lY(xY0),PY0=fR(),AY0=lY(PY0),wY0=H6(),TY0=lY(wY0),IY0=$5(),vY0=lY(IY0);function lY(Y){return Y&&Y.__esModule?Y:{default:Y}}function DY0(Y,X,J){return(0,FY0.default)(Y,(0,AY0.default)((0,TY0.default)(X)),J)}F$.default=(0,vY0.default)(DY0,3);yR.exports=F$.default});var mR=C((dh0,hR)=>{var CY0=Object.prototype.toString;hR.exports=function(X){if(typeof X.displayName==="string"&&X.constructor.name)return X.displayName;else if(typeof X.name==="string"&&X.name)return X.name;if(typeof X==="object"&&X.constructor&&typeof X.constructor.name==="string")return X.constructor.name;var J=X.toString(),z=CY0.call(X).slice(8,-1);if(z==="Function")J=J.substring(J.indexOf("(")+1,J.indexOf(")"));else J=z;return J||"anonymous"}});var P$=C((lh0,uR)=>{var EY0=mR();uR.exports=function(X){var J=0,z;function Q(){if(J)return z;return J=1,z=X.apply(this,arguments),X=null,z}return Q.displayName=EY0(X),Q}});var A$=C((_Y0)=>{_Y0.get=function(Y){var X=Error.stackTraceLimit;Error.stackTraceLimit=1/0;var J={},z=Error.prepareStackTrace;Error.prepareStackTrace=function(G,Z){return Z},Error.captureStackTrace(J,Y||_Y0.get);var Q=J.stack;return Error.prepareStackTrace=z,Error.stackTraceLimit=X,Q};_Y0.parse=function(Y){if(!Y.stack)return[];var X=this,J=Y.stack.split(`
`).slice(1);return J.map(function(z){if(z.match(/^\s*[-]{4,}$/))return X._createParsedCallSite({fileName:z,lineNumber:null,functionName:null,typeName:null,methodName:null,columnNumber:null,native:null});var Q=z.match(/at (?:(.+)\s+\()?(?:(.+?):(\d+)(?::(\d+))?|([^)]+))\)?/);if(!Q)return;var G=null,Z=null,$=null,H=null,W=null,K=Q[5]==="native";if(Q[1]){$=Q[1];var U=$.lastIndexOf(".");if($[U-1]==".")U--;if(U>0){G=$.substr(0,U),Z=$.substr(U+1);var B=G.indexOf(".Module");if(B>0)$=$.substr(B+1),G=G.substr(0,B)}H=null}if(Z)H=G,W=Z;if(Z==="<anonymous>")W=null,$=null;var O={fileName:Q[2]||null,lineNumber:parseInt(Q[3],10)||null,functionName:$,typeName:H,methodName:W,columnNumber:parseInt(Q[4],10)||null,native:K};return X._createParsedCallSite(O)}).filter(function(z){return!!z})};function Z3(Y){for(var X in Y)this[X]=Y[X]}var SY0=["this","typeName","functionName","methodName","fileName","lineNumber","columnNumber","function","evalOrigin"],kY0=["topLevel","eval","native","constructor"];SY0.forEach(function(Y){Z3.prototype[Y]=null,Z3.prototype["get"+Y[0].toUpperCase()+Y.substr(1)]=function(){return this[Y]}});kY0.forEach(function(Y){Z3.prototype[Y]=!1,Z3.prototype["is"+Y[0].toUpperCase()+Y.substr(1)]=function(){return this[Y]}});_Y0._createParsedCallSite=function(Y){return new Z3(Y)}});var cR=C((nh0,pR)=>{var{Writable:fY0}=W6();pR.exports=class extends fY0{constructor(X){super({objectMode:!0});if(!X)throw Error("ExceptionStream requires a TransportStream instance.");this.handleExceptions=!0,this.transport=X}_write(X,J,z){if(X.exception)return this.transport.log(X,z);return z(),!0}}});var T$=C((oh0,iR)=>{var dR=Q0("os"),yY0=iY(),w$=Q3()("winston:exception"),hY0=P$(),lR=A$(),mY0=cR();iR.exports=class{constructor(X){if(!X)throw Error("Logger is required to handle exceptions");this.logger=X,this.handlers=new Map}handle(...X){if(X.forEach((J)=>{if(Array.isArray(J))return J.forEach((z)=>this._addHandler(z));this._addHandler(J)}),!this.catcher)this.catcher=this._uncaughtException.bind(this),process.on("uncaughtException",this.catcher)}unhandle(){if(this.catcher)process.removeListener("uncaughtException",this.catcher),this.catcher=!1,Array.from(this.handlers.values()).forEach((X)=>this.logger.unpipe(X))}getAllInfo(X){let J=null;if(X)J=typeof X==="string"?X:X.message;return{error:X,level:"error",message:[`uncaughtException: ${J||"(no error message)"}`,X&&X.stack||"  No stack trace"].join(`
`),stack:X&&X.stack,exception:!0,date:new Date().toString(),process:this.getProcessInfo(),os:this.getOsInfo(),trace:this.getTrace(X)}}getProcessInfo(){return{pid:process.pid,uid:process.getuid?process.getuid():null,gid:process.getgid?process.getgid():null,cwd:process.cwd(),execPath:process.execPath,version:process.version,argv:process.argv,memoryUsage:process.memoryUsage()}}getOsInfo(){return{loadavg:dR.loadavg(),uptime:dR.uptime()}}getTrace(X){return(X?lR.parse(X):lR.get()).map((z)=>{return{column:z.getColumnNumber(),file:z.getFileName(),function:z.getFunctionName(),line:z.getLineNumber(),method:z.getMethodName(),native:z.isNative()}})}_addHandler(X){if(!this.handlers.has(X)){X.handleExceptions=!0;let J=new mY0(X);this.handlers.set(X,J),this.logger.pipe(J)}}_uncaughtException(X){let J=this.getAllInfo(X),z=this._getExceptionHandlers(),Q=typeof this.logger.exitOnError==="function"?this.logger.exitOnError(X):this.logger.exitOnError,G;if(!z.length&&Q)console.warn("winston: exitOnError cannot be true with no exception handlers."),console.warn("winston: not exiting process."),Q=!1;function Z(){if(w$("doExit",Q),w$("process._exiting",process._exiting),Q&&!process._exiting){if(G)clearTimeout(G);process.exit(1)}}if(!z||z.length===0)return process.nextTick(Z);if(yY0(z,($,H)=>{let W=hY0(H),K=$.transport||$;function U(B){return()=>{w$(B),W()}}K._ending=!0,K.once("finish",U("finished")),K.once("error",U("error"))},()=>Q&&Z()),this.logger.log(J),Q)G=setTimeout(Z,3000)}_getExceptionHandlers(){return this.logger.transports.filter((X)=>{return(X.transport||X).handleExceptions})}}});var oR=C((ah0,nR)=>{var{Writable:uY0}=W6();nR.exports=class extends uY0{constructor(X){super({objectMode:!0});if(!X)throw Error("RejectionStream requires a TransportStream instance.");this.handleRejections=!0,this.transport=X}_write(X,J,z){if(X.rejection)return this.transport.log(X,z);return z(),!0}}});var v$=C((sh0,rR)=>{var aR=Q0("os"),gY0=iY(),I$=Q3()("winston:rejection"),pY0=P$(),sR=A$(),cY0=oR();rR.exports=class{constructor(X){if(!X)throw Error("Logger is required to handle rejections");this.logger=X,this.handlers=new Map}handle(...X){if(X.forEach((J)=>{if(Array.isArray(J))return J.forEach((z)=>this._addHandler(z));this._addHandler(J)}),!this.catcher)this.catcher=this._unhandledRejection.bind(this),process.on("unhandledRejection",this.catcher)}unhandle(){if(this.catcher)process.removeListener("unhandledRejection",this.catcher),this.catcher=!1,Array.from(this.handlers.values()).forEach((X)=>this.logger.unpipe(X))}getAllInfo(X){let J=null;if(X)J=typeof X==="string"?X:X.message;return{error:X,level:"error",message:[`unhandledRejection: ${J||"(no error message)"}`,X&&X.stack||"  No stack trace"].join(`
`),stack:X&&X.stack,rejection:!0,date:new Date().toString(),process:this.getProcessInfo(),os:this.getOsInfo(),trace:this.getTrace(X)}}getProcessInfo(){return{pid:process.pid,uid:process.getuid?process.getuid():null,gid:process.getgid?process.getgid():null,cwd:process.cwd(),execPath:process.execPath,version:process.version,argv:process.argv,memoryUsage:process.memoryUsage()}}getOsInfo(){return{loadavg:aR.loadavg(),uptime:aR.uptime()}}getTrace(X){return(X?sR.parse(X):sR.get()).map((z)=>{return{column:z.getColumnNumber(),file:z.getFileName(),function:z.getFunctionName(),line:z.getLineNumber(),method:z.getMethodName(),native:z.isNative()}})}_addHandler(X){if(!this.handlers.has(X)){X.handleRejections=!0;let J=new cY0(X);this.handlers.set(X,J),this.logger.pipe(J)}}_unhandledRejection(X){let J=this.getAllInfo(X),z=this._getRejectionHandlers(),Q=typeof this.logger.exitOnError==="function"?this.logger.exitOnError(X):this.logger.exitOnError,G;if(!z.length&&Q)console.warn("winston: exitOnError cannot be true with no rejection handlers."),console.warn("winston: not exiting process."),Q=!1;function Z(){if(I$("doExit",Q),I$("process._exiting",process._exiting),Q&&!process._exiting){if(G)clearTimeout(G);process.exit(1)}}if(!z||z.length===0)return process.nextTick(Z);if(gY0(z,($,H)=>{let W=pY0(H),K=$.transport||$;function U(B){return()=>{I$(B),W()}}K._ending=!0,K.once("finish",U("finished")),K.once("error",U("error"))},()=>Q&&Z()),this.logger.log(J),Q)G=setTimeout(Z,3000)}_getRejectionHandlers(){return this.logger.transports.filter((X)=>{return(X.transport||X).handleRejections})}}});var Yf=C((rh0,eR)=>{class tR{constructor(Y){let X=nY();if(typeof Y!=="object"||Array.isArray(Y)||!(Y instanceof X))throw Error("Logger is required for profiling");else this.logger=Y,this.start=Date.now()}done(...Y){if(typeof Y[Y.length-1]==="function")console.warn("Callback function no longer supported as of winston@3.0.0"),Y.pop();let X=typeof Y[Y.length-1]==="object"?Y.pop():{};return X.level=X.level||"info",X.durationMs=Date.now()-this.start,this.logger.write(X)}}eR.exports=tR});var nY=C((th0,Qf)=>{var{Stream:dY0,Transform:lY0}=W6(),Xf=iY(),{LEVEL:f4,SPLAT:Jf}=J1(),zf=L$(),iY0=T$(),nY0=v$(),oY0=fZ(),aY0=Yf(),{warn:sY0}=WZ(),rY0=dY(),tY0=/%[scdjifoO%]/g;class D$ extends lY0{constructor(Y){super({objectMode:!0});this.configure(Y)}child(Y){let X=this;return Object.create(X,{write:{value:function(J){let z=Object.assign({},Y,J);if(J instanceof Error)z.stack=J.stack,z.message=J.message,z.cause=J.cause;X.write(z)}}})}configure({silent:Y,format:X,defaultMeta:J,levels:z,level:Q="info",exitOnError:G=!0,transports:Z,colors:$,emitErrs:H,formatters:W,padLevels:K,rewriters:U,stripColors:B,exceptionHandlers:O,rejectionHandlers:V}={}){if(this.transports.length)this.clear();if(this.silent=Y,this.format=X||this.format||zZ()(),this.defaultMeta=J||null,this.levels=z||this.levels||rY0.npm.levels,this.level=Q,this.exceptions)this.exceptions.unhandle();if(this.rejections)this.rejections.unhandle();if(this.exceptions=new iY0(this),this.rejections=new nY0(this),this.profilers={},this.exitOnError=G,Z)Z=Array.isArray(Z)?Z:[Z],Z.forEach((L)=>this.add(L));if($||H||W||K||U||B)throw Error(["{ colors, emitErrs, formatters, padLevels, rewriters, stripColors } were removed in winston@3.0.0.","Use a custom winston.format(function) instead.","See: https://github.com/winstonjs/winston/tree/master/UPGRADE-3.0.md"].join(`
`));if(O)this.exceptions.handle(O);if(V)this.rejections.handle(V)}getHighestLogLevel(){let Y=$3(this.levels,this.level);if(!this.transports||this.transports.length===0)return Y;return this.transports.reduce((X,J)=>{let z=$3(this.levels,J.level);return z!==null&&z>X?z:X},Y)}isLevelEnabled(Y){let X=$3(this.levels,Y);if(X===null)return!1;let J=$3(this.levels,this.level);if(J===null)return!1;if(!this.transports||this.transports.length===0)return J>=X;return this.transports.findIndex((Q)=>{let G=$3(this.levels,Q.level);if(G===null)G=J;return G>=X})!==-1}log(Y,X,...J){if(arguments.length===1)return Y[f4]=Y.level,this._addDefaultMeta(Y),this.write(Y),this;if(arguments.length===2){if(X&&typeof X==="object")return X[f4]=X.level=Y,this._addDefaultMeta(X),this.write(X),this;return X={[f4]:Y,level:Y,message:X},this._addDefaultMeta(X),this.write(X),this}let[z]=J;if(typeof z==="object"&&z!==null){if(!(X&&X.match&&X.match(tY0))){let G=Object.assign({},this.defaultMeta,z,{[f4]:Y,[Jf]:J,level:Y,message:X});if(z.message)G.message=`${G.message} ${z.message}`;if(z.stack)G.stack=z.stack;if(z.cause)G.cause=z.cause;return this.write(G),this}}return this.write(Object.assign({},this.defaultMeta,{[f4]:Y,[Jf]:J,level:Y,message:X})),this}_transform(Y,X,J){if(this.silent)return J();if(!Y[f4])Y[f4]=Y.level;if(!this.levels[Y[f4]]&&this.levels[Y[f4]]!==0)console.error("[winston] Unknown logger level: %s",Y[f4]);if(!this._readableState.pipes)console.error("[winston] Attempt to write logs with no transports, which can increase memory usage: %j",Y);try{this.push(this.format.transform(Y,this.format.options))}finally{this._writableState.sync=!1,J()}}_final(Y){let X=this.transports.slice();Xf(X,(J,z)=>{if(!J||J.finished)return setImmediate(z);J.once("finish",z),J.end()},Y)}add(Y){let X=!zf(Y)||Y.log.length>2?new oY0({transport:Y}):Y;if(!X._writableState||!X._writableState.objectMode)throw Error("Transports must WritableStreams in objectMode. Set { objectMode: true }.");if(this._onEvent("error",X),this._onEvent("warn",X),this.pipe(X),Y.handleExceptions)this.exceptions.handle();if(Y.handleRejections)this.rejections.handle();return this}remove(Y){if(!Y)return this;let X=Y;if(!zf(Y)||Y.log.length>2)X=this.transports.filter((J)=>J.transport===Y)[0];if(X)this.unpipe(X);return this}clear(){return this.unpipe(),this}close(){return this.exceptions.unhandle(),this.rejections.unhandle(),this.clear(),this.emit("close"),this}setLevels(){sY0.deprecated("setLevels")}query(Y,X){if(typeof Y==="function")X=Y,Y={};Y=Y||{};let J={},z=Object.assign({},Y.query||{});function Q(Z,$){if(Y.query&&typeof Z.formatQuery==="function")Y.query=Z.formatQuery(z);Z.query(Y,(H,W)=>{if(H)return $(H);if(typeof Z.formatResults==="function")W=Z.formatResults(W,Y.format);$(null,W)})}function G(Z,$){Q(Z,(H,W)=>{if($){if(W=H||W,W)J[Z.name]=W;$()}$=null})}Xf(this.transports.filter((Z)=>!!Z.query),G,()=>X(null,J))}stream(Y={}){let X=new dY0,J=[];return X._streams=J,X.destroy=()=>{let z=J.length;while(z--)J[z].destroy()},this.transports.filter((z)=>!!z.stream).forEach((z)=>{let Q=z.stream(Y);if(!Q)return;J.push(Q),Q.on("log",(G)=>{G.transport=G.transport||[],G.transport.push(z.name),X.emit("log",G)}),Q.on("error",(G)=>{G.transport=G.transport||[],G.transport.push(z.name),X.emit("error",G)})}),X}startTimer(){return new aY0(this)}profile(Y,...X){let J=Date.now();if(this.profilers[Y]){let z=this.profilers[Y];if(delete this.profilers[Y],typeof X[X.length-2]==="function")console.warn("Callback function no longer supported as of winston@3.0.0"),X.pop();let Q=typeof X[X.length-1]==="object"?X.pop():{};return Q.level=Q.level||"info",Q.durationMs=J-z,Q.message=Q.message||Y,this.write(Q)}return this.profilers[Y]=J,this}handleExceptions(...Y){console.warn("Deprecated: .handleExceptions() will be removed in winston@4. Use .exceptions.handle()"),this.exceptions.handle(...Y)}unhandleExceptions(...Y){console.warn("Deprecated: .unhandleExceptions() will be removed in winston@4. Use .exceptions.unhandle()"),this.exceptions.unhandle(...Y)}cli(){throw Error(["Logger.cli() was removed in winston@3.0.0","Use a custom winston.formats.cli() instead.","See: https://github.com/winstonjs/winston/tree/master/UPGRADE-3.0.md"].join(`
`))}_onEvent(Y,X){function J(z){if(Y==="error"&&!this.transports.includes(X))this.add(X);this.emit(Y,z,X)}if(!X["__winston"+Y])X["__winston"+Y]=J.bind(this),X.on(Y,X["__winston"+Y])}_addDefaultMeta(Y){if(this.defaultMeta)Object.assign(Y,this.defaultMeta)}}function $3(Y,X){let J=Y[X];if(!J&&J!==0)return null;return J}Object.defineProperty(D$.prototype,"transports",{configurable:!1,enumerable:!0,get(){let{pipes:Y}=this._readableState;return!Array.isArray(Y)?[Y].filter(Boolean):Y}});Qf.exports=D$});var j$=C((eh0,Gf)=>{var{LEVEL:eY0}=J1(),YX0=dY(),XX0=nY(),JX0=Q3()("winston:create-logger");function zX0(Y){return"is"+Y.charAt(0).toUpperCase()+Y.slice(1)+"Enabled"}Gf.exports=function(Y={}){Y.levels=Y.levels||YX0.npm.levels;class X extends XX0{constructor(z){super(z)}}let J=new X(Y);return Object.keys(Y.levels).forEach(function(z){if(JX0('Define prototype method for "%s"',z),z==="log"){console.warn('Level "log" not defined: conflicts with the method "log". Use a different level name.');return}X.prototype[z]=function(...Q){let G=this||J;if(Q.length===1){let[Z]=Q,$=Z&&Z.message&&Z||{message:Z};return $.level=$[eY0]=z,G._addDefaultMeta($),G.write($),this||J}if(Q.length===0)return G.log(z,""),G;return G.log(z,...Q)},X.prototype[zX0(z)]=function(){return(this||J).isLevelEnabled(z)}}),J}});var $f=C((Ym0,Zf)=>{var QX0=j$();Zf.exports=class{constructor(X={}){this.loggers=new Map,this.options=X}add(X,J){if(!this.loggers.has(X)){J=Object.assign({},J||this.options);let z=J.transports||this.options.transports;if(z)J.transports=Array.isArray(z)?z.slice():[z];else J.transports=[];let Q=QX0(J);Q.on("close",()=>this._delete(X)),this.loggers.set(X,Q)}return this.loggers.get(X)}get(X,J){return this.add(X,J)}has(X){return!!this.loggers.has(X)}close(X){if(X)return this._removeLogger(X);this.loggers.forEach((J,z)=>this._removeLogger(z))}_removeLogger(X){if(!this.loggers.has(X))return;this.loggers.get(X).close(),this._delete(X)}_delete(X){this.loggers.delete(X)}}});var Bf=C((G4)=>{var Hf=$Z(),{warn:H3}=WZ();G4.version=z_().version;G4.transports=kR();G4.config=dY();G4.addColors=Hf.levels;G4.format=Hf.format;G4.createLogger=j$();G4.Logger=nY();G4.ExceptionHandler=T$();G4.RejectionHandler=v$();G4.Container=$f();G4.Transport=G5();G4.loggers=new G4.Container;var y4=G4.createLogger();Object.keys(G4.config.npm.levels).concat(["log","query","stream","add","remove","clear","profile","startTimer","handleExceptions","unhandleExceptions","handleRejections","unhandleRejections","configure","child"]).forEach((Y)=>G4[Y]=(...X)=>y4[Y](...X));Object.defineProperty(G4,"level",{get(){return y4.level},set(Y){y4.level=Y}});Object.defineProperty(G4,"exceptions",{get(){return y4.exceptions}});Object.defineProperty(G4,"rejections",{get(){return y4.rejections}});["exitOnError"].forEach((Y)=>{Object.defineProperty(G4,Y,{get(){return y4[Y]},set(X){y4[Y]=X}})});Object.defineProperty(G4,"default",{get(){return{exceptionHandlers:y4.exceptionHandlers,rejectionHandlers:y4.rejectionHandlers,transports:y4.transports}}});H3.deprecated(G4,"setLevels");H3.forFunctions(G4,"useFormat",["cli"]);H3.forProperties(G4,"useFormat",["padLevels","stripColors"]);H3.forFunctions(G4,"deprecated",["addRewriter","addFilter","clone","extend"]);H3.forProperties(G4,"deprecated",["emitErrs","levelLength"])});var Lf=C((jm0,AX0)=>{AX0.exports={name:"dotenv",version:"17.2.3",description:"Loads environment variables from .env file",main:"lib/main.js",types:"lib/main.d.ts",exports:{".":{types:"./lib/main.d.ts",require:"./lib/main.js",default:"./lib/main.js"},"./config":"./config.js","./config.js":"./config.js","./lib/env-options":"./lib/env-options.js","./lib/env-options.js":"./lib/env-options.js","./lib/cli-options":"./lib/cli-options.js","./lib/cli-options.js":"./lib/cli-options.js","./package.json":"./package.json"},scripts:{"dts-check":"tsc --project tests/types/tsconfig.json",lint:"standard",pretest:"npm run lint && npm run dts-check",test:"tap run tests/**/*.js --allow-empty-coverage --disable-coverage --timeout=60000","test:coverage":"tap run tests/**/*.js --show-full-coverage --timeout=60000 --coverage-report=text --coverage-report=lcov",prerelease:"npm test",release:"standard-version"},repository:{type:"git",url:"git://github.com/motdotla/dotenv.git"},homepage:"https://github.com/motdotla/dotenv#readme",funding:"https://dotenvx.com",keywords:["dotenv","env",".env","environment","variables","config","settings"],readmeFilename:"README.md",license:"BSD-2-Clause",devDependencies:{"@types/node":"^18.11.3",decache:"^4.6.2",sinon:"^14.0.1",standard:"^17.0.0","standard-version":"^9.5.0",tap:"^19.2.0",typescript:"^4.8.4"},engines:{node:">=12"},browser:{fs:!1}}});var Af=C((Cm0,X8)=>{var R$=Q0("fs"),eY=Q0("path"),wX0=Q0("os"),TX0=Q0("crypto"),IX0=Lf(),f$=IX0.version,Nf=["\uD83D\uDD10 encrypt with Dotenvx: https://dotenvx.com","\uD83D\uDD10 prevent committing .env to code: https://dotenvx.com/precommit","\uD83D\uDD10 prevent building .env in docker: https://dotenvx.com/prebuild","\uD83D\uDCE1 add observability to secrets: https://dotenvx.com/ops","\uD83D\uDC65 sync secrets across teammates & machines: https://dotenvx.com/ops","\uD83D\uDDC2 backup and recover secrets: https://dotenvx.com/ops"," audit secrets and track compliance: https://dotenvx.com/ops","\uD83D\uDD04 add secrets lifecycle management: https://dotenvx.com/ops","\uD83D\uDD11 add access controls to secrets: https://dotenvx.com/ops","\uD83D\uDEE0  run anywhere with `dotenvx run -- yourcommand`","  specify custom .env file path with { path: '/custom/path/.env' }","  enable debug logging with { debug: true }","  override existing env vars with { override: true }","  suppress all logs with { quiet: true }","  write to custom object with { processEnv: myObject }","  load multiple .env files with { path: ['.env.local', '.env'] }"];function vX0(){return Nf[Math.floor(Math.random()*Nf.length)]}function B5(Y){if(typeof Y==="string")return!["false","0","no","off",""].includes(Y.toLowerCase());return Boolean(Y)}function DX0(){return process.stdout.isTTY}function jX0(Y){return DX0()?`\x1B[2m${Y}\x1B[0m`:Y}var CX0=/(?:^|^)\s*(?:export\s+)?([\w.-]+)(?:\s*=\s*?|:\s+?)(\s*'(?:\\'|[^'])*'|\s*"(?:\\"|[^"])*"|\s*`(?:\\`|[^`])*`|[^#\r\n]+)?\s*(?:#.*)?(?:$|$)/mg;function EX0(Y){let X={},J=Y.toString();J=J.replace(/\r\n?/mg,`
`);let z;while((z=CX0.exec(J))!=null){let Q=z[1],G=z[2]||"";G=G.trim();let Z=G[0];if(G=G.replace(/^(['"`])([\s\S]*)\1$/mg,"$2"),Z==='"')G=G.replace(/\\n/g,`
`),G=G.replace(/\\r/g,"\r");X[Q]=G}return X}function SX0(Y){Y=Y||{};let X=Pf(Y);Y.path=X;let J=$1.configDotenv(Y);if(!J.parsed){let Z=Error(`MISSING_DATA: Cannot parse ${X} for an unknown reason`);throw Z.code="MISSING_DATA",Z}let z=Ff(Y).split(","),Q=z.length,G;for(let Z=0;Z<Q;Z++)try{let $=z[Z].trim(),H=_X0(J,$);G=$1.decrypt(H.ciphertext,H.key);break}catch($){if(Z+1>=Q)throw $}return $1.parse(G)}function kX0(Y){console.error(`[dotenv@${f$}][WARN] ${Y}`)}function K3(Y){console.log(`[dotenv@${f$}][DEBUG] ${Y}`)}function xf(Y){console.log(`[dotenv@${f$}] ${Y}`)}function Ff(Y){if(Y&&Y.DOTENV_KEY&&Y.DOTENV_KEY.length>0)return Y.DOTENV_KEY;if(process.env.DOTENV_KEY&&process.env.DOTENV_KEY.length>0)return process.env.DOTENV_KEY;return""}function _X0(Y,X){let J;try{J=new URL(X)}catch($){if($.code==="ERR_INVALID_URL"){let H=Error("INVALID_DOTENV_KEY: Wrong format. Must be in valid uri format like dotenv://:key_1234@dotenvx.com/vault/.env.vault?environment=development");throw H.code="INVALID_DOTENV_KEY",H}throw $}let z=J.password;if(!z){let $=Error("INVALID_DOTENV_KEY: Missing key part");throw $.code="INVALID_DOTENV_KEY",$}let Q=J.searchParams.get("environment");if(!Q){let $=Error("INVALID_DOTENV_KEY: Missing environment part");throw $.code="INVALID_DOTENV_KEY",$}let G=`DOTENV_VAULT_${Q.toUpperCase()}`,Z=Y.parsed[G];if(!Z){let $=Error(`NOT_FOUND_DOTENV_ENVIRONMENT: Cannot locate environment ${G} in your .env.vault file.`);throw $.code="NOT_FOUND_DOTENV_ENVIRONMENT",$}return{ciphertext:Z,key:z}}function Pf(Y){let X=null;if(Y&&Y.path&&Y.path.length>0)if(Array.isArray(Y.path)){for(let J of Y.path)if(R$.existsSync(J))X=J.endsWith(".vault")?J:`${J}.vault`}else X=Y.path.endsWith(".vault")?Y.path:`${Y.path}.vault`;else X=eY.resolve(process.cwd(),".env.vault");if(R$.existsSync(X))return X;return null}function qf(Y){return Y[0]==="~"?eY.join(wX0.homedir(),Y.slice(1)):Y}function bX0(Y){let X=B5(process.env.DOTENV_CONFIG_DEBUG||Y&&Y.debug),J=B5(process.env.DOTENV_CONFIG_QUIET||Y&&Y.quiet);if(X||!J)xf("Loading env from encrypted .env.vault");let z=$1._parseVault(Y),Q=process.env;if(Y&&Y.processEnv!=null)Q=Y.processEnv;return $1.populate(Q,z,Y),{parsed:z}}function RX0(Y){let X=eY.resolve(process.cwd(),".env"),J="utf8",z=process.env;if(Y&&Y.processEnv!=null)z=Y.processEnv;let Q=B5(z.DOTENV_CONFIG_DEBUG||Y&&Y.debug),G=B5(z.DOTENV_CONFIG_QUIET||Y&&Y.quiet);if(Y&&Y.encoding)J=Y.encoding;else if(Q)K3("No encoding is specified. UTF-8 is used by default");let Z=[X];if(Y&&Y.path)if(!Array.isArray(Y.path))Z=[qf(Y.path)];else{Z=[];for(let K of Y.path)Z.push(qf(K))}let $,H={};for(let K of Z)try{let U=$1.parse(R$.readFileSync(K,{encoding:J}));$1.populate(H,U,Y)}catch(U){if(Q)K3(`Failed to load ${K} ${U.message}`);$=U}let W=$1.populate(z,H,Y);if(Q=B5(z.DOTENV_CONFIG_DEBUG||Q),G=B5(z.DOTENV_CONFIG_QUIET||G),Q||!G){let K=Object.keys(W).length,U=[];for(let B of Z)try{let O=eY.relative(process.cwd(),B);U.push(O)}catch(O){if(Q)K3(`Failed to load ${B} ${O.message}`);$=O}xf(`injecting env (${K}) from ${U.join(",")} ${jX0(`-- tip: ${vX0()}`)}`)}if($)return{parsed:H,error:$};else return{parsed:H}}function fX0(Y){if(Ff(Y).length===0)return $1.configDotenv(Y);let X=Pf(Y);if(!X)return kX0(`You set DOTENV_KEY but you are missing a .env.vault file at ${X}. Did you forget to build it?`),$1.configDotenv(Y);return $1._configVault(Y)}function yX0(Y,X){let J=Buffer.from(X.slice(-64),"hex"),z=Buffer.from(Y,"base64"),Q=z.subarray(0,12),G=z.subarray(-16);z=z.subarray(12,-16);try{let Z=TX0.createDecipheriv("aes-256-gcm",J,Q);return Z.setAuthTag(G),`${Z.update(z)}${Z.final()}`}catch(Z){let $=Z instanceof RangeError,H=Z.message==="Invalid key length",W=Z.message==="Unsupported state or unable to authenticate data";if($||H){let K=Error("INVALID_DOTENV_KEY: It must be 64 characters long (or more)");throw K.code="INVALID_DOTENV_KEY",K}else if(W){let K=Error("DECRYPTION_FAILED: Please check your DOTENV_KEY");throw K.code="DECRYPTION_FAILED",K}else throw Z}}function hX0(Y,X,J={}){let z=Boolean(J&&J.debug),Q=Boolean(J&&J.override),G={};if(typeof X!=="object"){let Z=Error("OBJECT_REQUIRED: Please check the processEnv argument being passed to populate");throw Z.code="OBJECT_REQUIRED",Z}for(let Z of Object.keys(X))if(Object.prototype.hasOwnProperty.call(Y,Z)){if(Q===!0)Y[Z]=X[Z],G[Z]=X[Z];if(z)if(Q===!0)K3(`"${Z}" is already defined and WAS overwritten`);else K3(`"${Z}" is already defined and was NOT overwritten`)}else Y[Z]=X[Z],G[Z]=X[Z];return G}var $1={configDotenv:RX0,_configVault:bX0,_parseVault:SX0,config:fX0,decrypt:yX0,parse:EX0,populate:hX0};Cm0.configDotenv=$1.configDotenv;Cm0._configVault=$1._configVault;Cm0._parseVault=$1._parseVault;Cm0.config=$1.config;Cm0.decrypt=$1.decrypt;Cm0.parse=$1.parse;Cm0.populate=$1.populate;X8.exports=$1});var aX0=Object.freeze({status:"aborted"});function g(Y,X,J){function z($,H){var W;Object.defineProperty($,"_zod",{value:$._zod??{},enumerable:!1}),(W=$._zod).traits??(W.traits=new Set),$._zod.traits.add(Y),X($,H);for(let K in Z.prototype)if(!(K in $))Object.defineProperty($,K,{value:Z.prototype[K].bind($)});$._zod.constr=Z,$._zod.def=H}let Q=J?.Parent??Object;class G extends Q{}Object.defineProperty(G,"name",{value:Y});function Z($){var H;let W=J?.Parent?new G:this;z(W,$),(H=W._zod).deferred??(H.deferred=[]);for(let K of W._zod.deferred)K();return W}return Object.defineProperty(Z,"init",{value:z}),Object.defineProperty(Z,Symbol.hasInstance,{value:($)=>{if(J?.Parent&&$ instanceof J.Parent)return!0;return $?._zod?.traits?.has(Y)}}),Object.defineProperty(Z,"name",{value:Y}),Z}var sX0=Symbol("zod_brand");class g4 extends Error{constructor(){super("Encountered Promise during synchronous parse. Use .parseAsync() instead.")}}class O5 extends Error{constructor(Y){super(`Encountered unidirectional transform during encode: ${Y}`);this.name="ZodEncodeError"}}var O3={};function o1(Y){if(Y)Object.assign(O3,Y);return O3}var I0={};G0(I0,{unwrapMessage:()=>M5,uint8ArrayToHex:()=>Jy,uint8ArrayToBase64url:()=>Yy,uint8ArrayToBase64:()=>d$,stringifyPrimitive:()=>q3,shallowClone:()=>m$,safeExtend:()=>of,required:()=>rf,randomString:()=>uf,propertyKeyTypes:()=>ZX,promiseAllObject:()=>mf,primitiveTypes:()=>u$,prefixIssues:()=>c4,pick:()=>df,partial:()=>sf,optionalKeys:()=>$X,omit:()=>lf,objectClone:()=>ff,numKeys:()=>gf,nullish:()=>L5,normalizeParams:()=>U0,mergeDefs:()=>Z8,merge:()=>af,jsonStringifyReplacer:()=>V6,joinValues:()=>M3,issue:()=>M6,isPlainObject:()=>$8,isObject:()=>_8,hexToUint8Array:()=>Xy,getSizableOrigin:()=>p$,getParsedType:()=>pf,getLengthableOrigin:()=>q5,getEnumValues:()=>zX,getElementAtPath:()=>hf,floatSafeRemainder:()=>QX,finalizeIssue:()=>H4,extend:()=>nf,escapeRegex:()=>p4,esc:()=>L3,defineLazy:()=>f0,createTransparentProxy:()=>cf,cloneDef:()=>yf,clone:()=>$4,cleanRegex:()=>N5,cleanEnum:()=>tf,captureStackTrace:()=>N3,cached:()=>O6,base64urlToUint8Array:()=>ef,base64ToUint8Array:()=>c$,assignProp:()=>G8,assertNotEqual:()=>kf,assertNever:()=>bf,assertIs:()=>_f,assertEqual:()=>Sf,assert:()=>Rf,allowsEval:()=>GX,aborted:()=>H8,NUMBER_FORMAT_RANGES:()=>HX,Class:()=>l$,BIGINT_FORMAT_RANGES:()=>g$});function Sf(Y){return Y}function kf(Y){return Y}function _f(Y){}function bf(Y){throw Error()}function Rf(Y){}function zX(Y){let X=Object.values(Y).filter((z)=>typeof z==="number");return Object.entries(Y).filter(([z,Q])=>X.indexOf(+z)===-1).map(([z,Q])=>Q)}function M3(Y,X="|"){return Y.map((J)=>q3(J)).join(X)}function V6(Y,X){if(typeof X==="bigint")return X.toString();return X}function O6(Y){return{get value(){{let J=Y();return Object.defineProperty(this,"value",{value:J}),J}throw Error("cached value already set")}}}function L5(Y){return Y===null||Y===void 0}function N5(Y){let X=Y.startsWith("^")?1:0,J=Y.endsWith("$")?Y.length-1:Y.length;return Y.slice(X,J)}function QX(Y,X){let J=(Y.toString().split(".")[1]||"").length,z=X.toString(),Q=(z.split(".")[1]||"").length;if(Q===0&&/\d?e-\d?/.test(z)){let H=z.match(/\d?e-(\d?)/);if(H?.[1])Q=Number.parseInt(H[1])}let G=J>Q?J:Q,Z=Number.parseInt(Y.toFixed(G).replace(".","")),$=Number.parseInt(X.toFixed(G).replace(".",""));return Z%$/10**G}var h$=Symbol("evaluating");function f0(Y,X,J){let z=void 0;Object.defineProperty(Y,X,{get(){if(z===h$)return;if(z===void 0)z=h$,z=J();return z},set(Q){Object.defineProperty(Y,X,{value:Q})},configurable:!0})}function ff(Y){return Object.create(Object.getPrototypeOf(Y),Object.getOwnPropertyDescriptors(Y))}function G8(Y,X,J){Object.defineProperty(Y,X,{value:J,writable:!0,enumerable:!0,configurable:!0})}function Z8(...Y){let X={};for(let J of Y){let z=Object.getOwnPropertyDescriptors(J);Object.assign(X,z)}return Object.defineProperties({},X)}function yf(Y){return Z8(Y._zod.def)}function hf(Y,X){if(!X)return Y;return X.reduce((J,z)=>J?.[z],Y)}function mf(Y){let X=Object.keys(Y),J=X.map((z)=>Y[z]);return Promise.all(J).then((z)=>{let Q={};for(let G=0;G<X.length;G++)Q[X[G]]=z[G];return Q})}function uf(Y=10){let J="";for(let z=0;z<Y;z++)J+="abcdefghijklmnopqrstuvwxyz"[Math.floor(Math.random()*26)];return J}function L3(Y){return JSON.stringify(Y)}var N3="captureStackTrace"in Error?Error.captureStackTrace:(...Y)=>{};function _8(Y){return typeof Y==="object"&&Y!==null&&!Array.isArray(Y)}var GX=O6(()=>{if(typeof navigator<"u"&&navigator?.userAgent?.includes("Cloudflare"))return!1;try{return new Function(""),!0}catch(Y){return!1}});function $8(Y){if(_8(Y)===!1)return!1;let X=Y.constructor;if(X===void 0)return!0;let J=X.prototype;if(_8(J)===!1)return!1;if(Object.prototype.hasOwnProperty.call(J,"isPrototypeOf")===!1)return!1;return!0}function m$(Y){if($8(Y))return{...Y};if(Array.isArray(Y))return[...Y];return Y}function gf(Y){let X=0;for(let J in Y)if(Object.prototype.hasOwnProperty.call(Y,J))X++;return X}var pf=(Y)=>{let X=typeof Y;switch(X){case"undefined":return"undefined";case"string":return"string";case"number":return Number.isNaN(Y)?"nan":"number";case"boolean":return"boolean";case"function":return"function";case"bigint":return"bigint";case"symbol":return"symbol";case"object":if(Array.isArray(Y))return"array";if(Y===null)return"null";if(Y.then&&typeof Y.then==="function"&&Y.catch&&typeof Y.catch==="function")return"promise";if(typeof Map<"u"&&Y instanceof Map)return"map";if(typeof Set<"u"&&Y instanceof Set)return"set";if(typeof Date<"u"&&Y instanceof Date)return"date";if(typeof File<"u"&&Y instanceof File)return"file";return"object";default:throw Error(`Unknown data type: ${X}`)}},ZX=new Set(["string","number","symbol"]),u$=new Set(["string","number","bigint","boolean","symbol","undefined"]);function p4(Y){return Y.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function $4(Y,X,J){let z=new Y._zod.constr(X??Y._zod.def);if(!X||J?.parent)z._zod.parent=Y;return z}function U0(Y){let X=Y;if(!X)return{};if(typeof X==="string")return{error:()=>X};if(X?.message!==void 0){if(X?.error!==void 0)throw Error("Cannot specify both `message` and `error` params");X.error=X.message}if(delete X.message,typeof X.error==="string")return{...X,error:()=>X.error};return X}function cf(Y){let X;return new Proxy({},{get(J,z,Q){return X??(X=Y()),Reflect.get(X,z,Q)},set(J,z,Q,G){return X??(X=Y()),Reflect.set(X,z,Q,G)},has(J,z){return X??(X=Y()),Reflect.has(X,z)},deleteProperty(J,z){return X??(X=Y()),Reflect.deleteProperty(X,z)},ownKeys(J){return X??(X=Y()),Reflect.ownKeys(X)},getOwnPropertyDescriptor(J,z){return X??(X=Y()),Reflect.getOwnPropertyDescriptor(X,z)},defineProperty(J,z,Q){return X??(X=Y()),Reflect.defineProperty(X,z,Q)}})}function q3(Y){if(typeof Y==="bigint")return Y.toString()+"n";if(typeof Y==="string")return`"${Y}"`;return`${Y}`}function $X(Y){return Object.keys(Y).filter((X)=>{return Y[X]._zod.optin==="optional"&&Y[X]._zod.optout==="optional"})}var HX={safeint:[Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],int32:[-2147483648,2147483647],uint32:[0,4294967295],float32:[-340282346638528860000000000000000000000,340282346638528860000000000000000000000],float64:[-Number.MAX_VALUE,Number.MAX_VALUE]},g$={int64:[BigInt("-9223372036854775808"),BigInt("9223372036854775807")],uint64:[BigInt(0),BigInt("18446744073709551615")]};function df(Y,X){let J=Y._zod.def,z=Z8(Y._zod.def,{get shape(){let Q={};for(let G in X){if(!(G in J.shape))throw Error(`Unrecognized key: "${G}"`);if(!X[G])continue;Q[G]=J.shape[G]}return G8(this,"shape",Q),Q},checks:[]});return $4(Y,z)}function lf(Y,X){let J=Y._zod.def,z=Z8(Y._zod.def,{get shape(){let Q={...Y._zod.def.shape};for(let G in X){if(!(G in J.shape))throw Error(`Unrecognized key: "${G}"`);if(!X[G])continue;delete Q[G]}return G8(this,"shape",Q),Q},checks:[]});return $4(Y,z)}function nf(Y,X){if(!$8(X))throw Error("Invalid input to extend: expected a plain object");let J=Y._zod.def.checks;if(J&&J.length>0)throw Error("Object schemas containing refinements cannot be extended. Use `.safeExtend()` instead.");let Q=Z8(Y._zod.def,{get shape(){let G={...Y._zod.def.shape,...X};return G8(this,"shape",G),G},checks:[]});return $4(Y,Q)}function of(Y,X){if(!$8(X))throw Error("Invalid input to safeExtend: expected a plain object");let J={...Y._zod.def,get shape(){let z={...Y._zod.def.shape,...X};return G8(this,"shape",z),z},checks:Y._zod.def.checks};return $4(Y,J)}function af(Y,X){let J=Z8(Y._zod.def,{get shape(){let z={...Y._zod.def.shape,...X._zod.def.shape};return G8(this,"shape",z),z},get catchall(){return X._zod.def.catchall},checks:[]});return $4(Y,J)}function sf(Y,X,J){let z=Z8(X._zod.def,{get shape(){let Q=X._zod.def.shape,G={...Q};if(J)for(let Z in J){if(!(Z in Q))throw Error(`Unrecognized key: "${Z}"`);if(!J[Z])continue;G[Z]=Y?new Y({type:"optional",innerType:Q[Z]}):Q[Z]}else for(let Z in Q)G[Z]=Y?new Y({type:"optional",innerType:Q[Z]}):Q[Z];return G8(this,"shape",G),G},checks:[]});return $4(X,z)}function rf(Y,X,J){let z=Z8(X._zod.def,{get shape(){let Q=X._zod.def.shape,G={...Q};if(J)for(let Z in J){if(!(Z in G))throw Error(`Unrecognized key: "${Z}"`);if(!J[Z])continue;G[Z]=new Y({type:"nonoptional",innerType:Q[Z]})}else for(let Z in Q)G[Z]=new Y({type:"nonoptional",innerType:Q[Z]});return G8(this,"shape",G),G},checks:[]});return $4(X,z)}function H8(Y,X=0){if(Y.aborted===!0)return!0;for(let J=X;J<Y.issues.length;J++)if(Y.issues[J]?.continue!==!0)return!0;return!1}function c4(Y,X){return X.map((J)=>{var z;return(z=J).path??(z.path=[]),J.path.unshift(Y),J})}function M5(Y){return typeof Y==="string"?Y:Y?.message}function H4(Y,X,J){let z={...Y,path:Y.path??[]};if(!Y.message){let Q=M5(Y.inst?._zod.def?.error?.(Y))??M5(X?.error?.(Y))??M5(J.customError?.(Y))??M5(J.localeError?.(Y))??"Invalid input";z.message=Q}if(delete z.inst,delete z.continue,!X?.reportInput)delete z.input;return z}function p$(Y){if(Y instanceof Set)return"set";if(Y instanceof Map)return"map";if(Y instanceof File)return"file";return"unknown"}function q5(Y){if(Array.isArray(Y))return"array";if(typeof Y==="string")return"string";return"unknown"}function M6(...Y){let[X,J,z]=Y;if(typeof X==="string")return{message:X,code:"custom",input:J,inst:z};return{...X}}function tf(Y){return Object.entries(Y).filter(([X,J])=>{return Number.isNaN(Number.parseInt(X,10))}).map((X)=>X[1])}function c$(Y){let X=atob(Y),J=new Uint8Array(X.length);for(let z=0;z<X.length;z++)J[z]=X.charCodeAt(z);return J}function d$(Y){let X="";for(let J=0;J<Y.length;J++)X+=String.fromCharCode(Y[J]);return btoa(X)}function ef(Y){let X=Y.replace(/-/g,"+").replace(/_/g,"/"),J="=".repeat((4-X.length%4)%4);return c$(X+J)}function Yy(Y){return d$(Y).replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")}function Xy(Y){let X=Y.replace(/^0x/,"");if(X.length%2!==0)throw Error("Invalid hex string length");let J=new Uint8Array(X.length/2);for(let z=0;z<X.length;z+=2)J[z/2]=Number.parseInt(X.slice(z,z+2),16);return J}function Jy(Y){return Array.from(Y).map((X)=>X.toString(16).padStart(2,"0")).join("")}class l${constructor(...Y){}}var i$=(Y,X)=>{Y.name="$ZodError",Object.defineProperty(Y,"_zod",{value:Y._zod,enumerable:!1}),Object.defineProperty(Y,"issues",{value:X,enumerable:!1}),Y.message=JSON.stringify(X,V6,2),Object.defineProperty(Y,"toString",{value:()=>Y.message,enumerable:!1})},x3=g("$ZodError",i$),WX=g("$ZodError",i$,{Parent:Error});function n$(Y,X=(J)=>J.message){let J={},z=[];for(let Q of Y.issues)if(Q.path.length>0)J[Q.path[0]]=J[Q.path[0]]||[],J[Q.path[0]].push(X(Q));else z.push(X(Q));return{formErrors:z,fieldErrors:J}}function o$(Y,X){let J=X||function(G){return G.message},z={_errors:[]},Q=(G)=>{for(let Z of G.issues)if(Z.code==="invalid_union"&&Z.errors.length)Z.errors.map(($)=>Q({issues:$}));else if(Z.code==="invalid_key")Q({issues:Z.issues});else if(Z.code==="invalid_element")Q({issues:Z.issues});else if(Z.path.length===0)z._errors.push(J(Z));else{let $=z,H=0;while(H<Z.path.length){let W=Z.path[H];if(H!==Z.path.length-1)$[W]=$[W]||{_errors:[]};else $[W]=$[W]||{_errors:[]},$[W]._errors.push(J(Z));$=$[W],H++}}};return Q(Y),z}var F3=(Y)=>(X,J,z,Q)=>{let G=z?Object.assign(z,{async:!1}):{async:!1},Z=X._zod.run({value:J,issues:[]},G);if(Z instanceof Promise)throw new g4;if(Z.issues.length){let $=new(Q?.Err??Y)(Z.issues.map((H)=>H4(H,G,o1())));throw N3($,Q?.callee),$}return Z.value};var P3=(Y)=>async(X,J,z,Q)=>{let G=z?Object.assign(z,{async:!0}):{async:!0},Z=X._zod.run({value:J,issues:[]},G);if(Z instanceof Promise)Z=await Z;if(Z.issues.length){let $=new(Q?.Err??Y)(Z.issues.map((H)=>H4(H,G,o1())));throw N3($,Q?.callee),$}return Z.value};var x5=(Y)=>(X,J,z)=>{let Q=z?{...z,async:!1}:{async:!1},G=X._zod.run({value:J,issues:[]},Q);if(G instanceof Promise)throw new g4;return G.issues.length?{success:!1,error:new(Y??x3)(G.issues.map((Z)=>H4(Z,Q,o1())))}:{success:!0,data:G.value}},F5=x5(WX),P5=(Y)=>async(X,J,z)=>{let Q=z?Object.assign(z,{async:!0}):{async:!0},G=X._zod.run({value:J,issues:[]},Q);if(G instanceof Promise)G=await G;return G.issues.length?{success:!1,error:new Y(G.issues.map((Z)=>H4(Z,Q,o1())))}:{success:!0,data:G.value}},A3=P5(WX),a$=(Y)=>(X,J,z)=>{let Q=z?Object.assign(z,{direction:"backward"}):{direction:"backward"};return F3(Y)(X,J,Q)};var s$=(Y)=>(X,J,z)=>{return F3(Y)(X,J,z)};var r$=(Y)=>async(X,J,z)=>{let Q=z?Object.assign(z,{direction:"backward"}):{direction:"backward"};return P3(Y)(X,J,Q)};var t$=(Y)=>async(X,J,z)=>{return P3(Y)(X,J,z)};var e$=(Y)=>(X,J,z)=>{let Q=z?Object.assign(z,{direction:"backward"}):{direction:"backward"};return x5(Y)(X,J,Q)};var YH=(Y)=>(X,J,z)=>{return x5(Y)(X,J,z)};var XH=(Y)=>async(X,J,z)=>{let Q=z?Object.assign(z,{direction:"backward"}):{direction:"backward"};return P5(Y)(X,J,Q)};var JH=(Y)=>async(X,J,z)=>{return P5(Y)(X,J,z)};var zH=/^[cC][^\s-]{8,}$/,QH=/^[0-9a-z]+$/,GH=/^[0-9A-HJKMNP-TV-Za-hjkmnp-tv-z]{26}$/,ZH=/^[0-9a-vA-V]{20}$/,$H=/^[A-Za-z0-9]{27}$/,HH=/^[a-zA-Z0-9_-]{21}$/,WH=/^P(?:(\d+W)|(?!.*W)(?=\d|T\d)(\d+Y)?(\d+M)?(\d+D)?(T(?=\d)(\d+H)?(\d+M)?(\d+([.,]\d+)?S)?)?)$/;var KH=/^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12})$/,KX=(Y)=>{if(!Y)return/^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[1-8][0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12}|00000000-0000-0000-0000-000000000000|ffffffff-ffff-ffff-ffff-ffffffffffff)$/;return new RegExp(`^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-${Y}[0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12})$`)};var UH=/^(?!\.)(?!.*\.\.)([A-Za-z0-9_'+\-\.]*)[A-Za-z0-9_+-]@([A-Za-z0-9][A-Za-z0-9\-]*\.)+[A-Za-z]{2,}$/;function BH(){return new RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")}var VH=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,OH=/^(([0-9a-fA-F]{1,4}:){7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:))$/,MH=/^((25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/([0-9]|[1-2][0-9]|3[0-2])$/,LH=/^(([0-9a-fA-F]{1,4}:){7}[0-9a-fA-F]{1,4}|::|([0-9a-fA-F]{1,4})?::([0-9a-fA-F]{1,4}:?){0,6})\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,NH=/^$|^(?:[0-9a-zA-Z+/]{4})*(?:(?:[0-9a-zA-Z+/]{2}==)|(?:[0-9a-zA-Z+/]{3}=))?$/,UX=/^[A-Za-z0-9_-]*$/,qH=/^(?=.{1,253}\.?$)[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[-0-9a-zA-Z]{0,61}[0-9a-zA-Z])?)*\.?$/;var xH=/^\+(?:[0-9]){6,14}[0-9]$/,FH="(?:(?:\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-(?:(?:0[13578]|1[02])-(?:0[1-9]|[12]\\d|3[01])|(?:0[469]|11)-(?:0[1-9]|[12]\\d|30)|(?:02)-(?:0[1-9]|1\\d|2[0-8])))",PH=new RegExp(`^${FH}$`);function AH(Y){return typeof Y.precision==="number"?Y.precision===-1?"(?:[01]\\d|2[0-3]):[0-5]\\d":Y.precision===0?"(?:[01]\\d|2[0-3]):[0-5]\\d:[0-5]\\d":`(?:[01]\\d|2[0-3]):[0-5]\\d:[0-5]\\d\\.\\d{${Y.precision}}`:"(?:[01]\\d|2[0-3]):[0-5]\\d(?::[0-5]\\d(?:\\.\\d+)?)?"}function wH(Y){return new RegExp(`^${AH(Y)}$`)}function TH(Y){let X=AH({precision:Y.precision}),J=["Z"];if(Y.local)J.push("");if(Y.offset)J.push("([+-](?:[01]\\d|2[0-3]):[0-5]\\d)");let z=`${X}(?:${J.join("|")})`;return new RegExp(`^${FH}T(?:${z})$`)}var IH=(Y)=>{let X=Y?`[\\s\\S]{${Y?.minimum??0},${Y?.maximum??""}}`:"[\\s\\S]*";return new RegExp(`^${X}$`)};var vH=/^-?\d+$/,DH=/^-?\d+(?:\.\d+)?/,jH=/^(?:true|false)$/i,CH=/^null$/i;var EH=/^[^A-Z]*$/,SH=/^[^a-z]*$/;var M1=g("$ZodCheck",(Y,X)=>{var J;Y._zod??(Y._zod={}),Y._zod.def=X,(J=Y._zod).onattach??(J.onattach=[])}),kH={number:"number",bigint:"bigint",object:"date"},BX=g("$ZodCheckLessThan",(Y,X)=>{M1.init(Y,X);let J=kH[typeof X.value];Y._zod.onattach.push((z)=>{let Q=z._zod.bag,G=(X.inclusive?Q.maximum:Q.exclusiveMaximum)??Number.POSITIVE_INFINITY;if(X.value<G)if(X.inclusive)Q.maximum=X.value;else Q.exclusiveMaximum=X.value}),Y._zod.check=(z)=>{if(X.inclusive?z.value<=X.value:z.value<X.value)return;z.issues.push({origin:J,code:"too_big",maximum:X.value,input:z.value,inclusive:X.inclusive,inst:Y,continue:!X.abort})}}),VX=g("$ZodCheckGreaterThan",(Y,X)=>{M1.init(Y,X);let J=kH[typeof X.value];Y._zod.onattach.push((z)=>{let Q=z._zod.bag,G=(X.inclusive?Q.minimum:Q.exclusiveMinimum)??Number.NEGATIVE_INFINITY;if(X.value>G)if(X.inclusive)Q.minimum=X.value;else Q.exclusiveMinimum=X.value}),Y._zod.check=(z)=>{if(X.inclusive?z.value>=X.value:z.value>X.value)return;z.issues.push({origin:J,code:"too_small",minimum:X.value,input:z.value,inclusive:X.inclusive,inst:Y,continue:!X.abort})}}),_H=g("$ZodCheckMultipleOf",(Y,X)=>{M1.init(Y,X),Y._zod.onattach.push((J)=>{var z;(z=J._zod.bag).multipleOf??(z.multipleOf=X.value)}),Y._zod.check=(J)=>{if(typeof J.value!==typeof X.value)throw Error("Cannot mix number and bigint in multiple_of check.");if(typeof J.value==="bigint"?J.value%X.value===BigInt(0):QX(J.value,X.value)===0)return;J.issues.push({origin:typeof J.value,code:"not_multiple_of",divisor:X.value,input:J.value,inst:Y,continue:!X.abort})}}),bH=g("$ZodCheckNumberFormat",(Y,X)=>{M1.init(Y,X),X.format=X.format||"float64";let J=X.format?.includes("int"),z=J?"int":"number",[Q,G]=HX[X.format];Y._zod.onattach.push((Z)=>{let $=Z._zod.bag;if($.format=X.format,$.minimum=Q,$.maximum=G,J)$.pattern=vH}),Y._zod.check=(Z)=>{let $=Z.value;if(J){if(!Number.isInteger($)){Z.issues.push({expected:z,format:X.format,code:"invalid_type",continue:!1,input:$,inst:Y});return}if(!Number.isSafeInteger($)){if($>0)Z.issues.push({input:$,code:"too_big",maximum:Number.MAX_SAFE_INTEGER,note:"Integers must be within the safe integer range.",inst:Y,origin:z,continue:!X.abort});else Z.issues.push({input:$,code:"too_small",minimum:Number.MIN_SAFE_INTEGER,note:"Integers must be within the safe integer range.",inst:Y,origin:z,continue:!X.abort});return}}if($<Q)Z.issues.push({origin:"number",input:$,code:"too_small",minimum:Q,inclusive:!0,inst:Y,continue:!X.abort});if($>G)Z.issues.push({origin:"number",input:$,code:"too_big",maximum:G,inst:Y})}});var RH=g("$ZodCheckMaxLength",(Y,X)=>{var J;M1.init(Y,X),(J=Y._zod.def).when??(J.when=(z)=>{let Q=z.value;return!L5(Q)&&Q.length!==void 0}),Y._zod.onattach.push((z)=>{let Q=z._zod.bag.maximum??Number.POSITIVE_INFINITY;if(X.maximum<Q)z._zod.bag.maximum=X.maximum}),Y._zod.check=(z)=>{let Q=z.value;if(Q.length<=X.maximum)return;let Z=q5(Q);z.issues.push({origin:Z,code:"too_big",maximum:X.maximum,inclusive:!0,input:Q,inst:Y,continue:!X.abort})}}),fH=g("$ZodCheckMinLength",(Y,X)=>{var J;M1.init(Y,X),(J=Y._zod.def).when??(J.when=(z)=>{let Q=z.value;return!L5(Q)&&Q.length!==void 0}),Y._zod.onattach.push((z)=>{let Q=z._zod.bag.minimum??Number.NEGATIVE_INFINITY;if(X.minimum>Q)z._zod.bag.minimum=X.minimum}),Y._zod.check=(z)=>{let Q=z.value;if(Q.length>=X.minimum)return;let Z=q5(Q);z.issues.push({origin:Z,code:"too_small",minimum:X.minimum,inclusive:!0,input:Q,inst:Y,continue:!X.abort})}}),yH=g("$ZodCheckLengthEquals",(Y,X)=>{var J;M1.init(Y,X),(J=Y._zod.def).when??(J.when=(z)=>{let Q=z.value;return!L5(Q)&&Q.length!==void 0}),Y._zod.onattach.push((z)=>{let Q=z._zod.bag;Q.minimum=X.length,Q.maximum=X.length,Q.length=X.length}),Y._zod.check=(z)=>{let Q=z.value,G=Q.length;if(G===X.length)return;let Z=q5(Q),$=G>X.length;z.issues.push({origin:Z,...$?{code:"too_big",maximum:X.length}:{code:"too_small",minimum:X.length},inclusive:!0,exact:!0,input:z.value,inst:Y,continue:!X.abort})}}),A5=g("$ZodCheckStringFormat",(Y,X)=>{var J,z;if(M1.init(Y,X),Y._zod.onattach.push((Q)=>{let G=Q._zod.bag;if(G.format=X.format,X.pattern)G.patterns??(G.patterns=new Set),G.patterns.add(X.pattern)}),X.pattern)(J=Y._zod).check??(J.check=(Q)=>{if(X.pattern.lastIndex=0,X.pattern.test(Q.value))return;Q.issues.push({origin:"string",code:"invalid_format",format:X.format,input:Q.value,...X.pattern?{pattern:X.pattern.toString()}:{},inst:Y,continue:!X.abort})});else(z=Y._zod).check??(z.check=()=>{})}),hH=g("$ZodCheckRegex",(Y,X)=>{A5.init(Y,X),Y._zod.check=(J)=>{if(X.pattern.lastIndex=0,X.pattern.test(J.value))return;J.issues.push({origin:"string",code:"invalid_format",format:"regex",input:J.value,pattern:X.pattern.toString(),inst:Y,continue:!X.abort})}}),mH=g("$ZodCheckLowerCase",(Y,X)=>{X.pattern??(X.pattern=EH),A5.init(Y,X)}),uH=g("$ZodCheckUpperCase",(Y,X)=>{X.pattern??(X.pattern=SH),A5.init(Y,X)}),gH=g("$ZodCheckIncludes",(Y,X)=>{M1.init(Y,X);let J=p4(X.includes),z=new RegExp(typeof X.position==="number"?`^.{${X.position}}${J}`:J);X.pattern=z,Y._zod.onattach.push((Q)=>{let G=Q._zod.bag;G.patterns??(G.patterns=new Set),G.patterns.add(z)}),Y._zod.check=(Q)=>{if(Q.value.includes(X.includes,X.position))return;Q.issues.push({origin:"string",code:"invalid_format",format:"includes",includes:X.includes,input:Q.value,inst:Y,continue:!X.abort})}}),pH=g("$ZodCheckStartsWith",(Y,X)=>{M1.init(Y,X);let J=new RegExp(`^${p4(X.prefix)}.*`);X.pattern??(X.pattern=J),Y._zod.onattach.push((z)=>{let Q=z._zod.bag;Q.patterns??(Q.patterns=new Set),Q.patterns.add(J)}),Y._zod.check=(z)=>{if(z.value.startsWith(X.prefix))return;z.issues.push({origin:"string",code:"invalid_format",format:"starts_with",prefix:X.prefix,input:z.value,inst:Y,continue:!X.abort})}}),cH=g("$ZodCheckEndsWith",(Y,X)=>{M1.init(Y,X);let J=new RegExp(`.*${p4(X.suffix)}$`);X.pattern??(X.pattern=J),Y._zod.onattach.push((z)=>{let Q=z._zod.bag;Q.patterns??(Q.patterns=new Set),Q.patterns.add(J)}),Y._zod.check=(z)=>{if(z.value.endsWith(X.suffix))return;z.issues.push({origin:"string",code:"invalid_format",format:"ends_with",suffix:X.suffix,input:z.value,inst:Y,continue:!X.abort})}});var dH=g("$ZodCheckOverwrite",(Y,X)=>{M1.init(Y,X),Y._zod.check=(J)=>{J.value=X.tx(J.value)}});class OX{constructor(Y=[]){if(this.content=[],this.indent=0,this)this.args=Y}indented(Y){this.indent+=1,Y(this),this.indent-=1}write(Y){if(typeof Y==="function"){Y(this,{execution:"sync"}),Y(this,{execution:"async"});return}let J=Y.split(`
`).filter((G)=>G),z=Math.min(...J.map((G)=>G.length-G.trimStart().length)),Q=J.map((G)=>G.slice(z)).map((G)=>" ".repeat(this.indent*2)+G);for(let G of Q)this.content.push(G)}compile(){let Y=Function,X=this?.args,z=[...(this?.content??[""]).map((Q)=>`  ${Q}`)];return new Y(...X,z.join(`
`))}}var iH={major:4,minor:1,patch:8};var m0=g("$ZodType",(Y,X)=>{var J;Y??(Y={}),Y._zod.def=X,Y._zod.bag=Y._zod.bag||{},Y._zod.version=iH;let z=[...Y._zod.def.checks??[]];if(Y._zod.traits.has("$ZodCheck"))z.unshift(Y);for(let Q of z)for(let G of Q._zod.onattach)G(Y);if(z.length===0)(J=Y._zod).deferred??(J.deferred=[]),Y._zod.deferred?.push(()=>{Y._zod.run=Y._zod.parse});else{let Q=(Z,$,H)=>{let W=H8(Z),K;for(let U of $){if(U._zod.def.when){if(!U._zod.def.when(Z))continue}else if(W)continue;let B=Z.issues.length,O=U._zod.check(Z);if(O instanceof Promise&&H?.async===!1)throw new g4;if(K||O instanceof Promise)K=(K??Promise.resolve()).then(async()=>{if(await O,Z.issues.length===B)return;if(!W)W=H8(Z,B)});else{if(Z.issues.length===B)continue;if(!W)W=H8(Z,B)}}if(K)return K.then(()=>{return Z});return Z},G=(Z,$,H)=>{if(H8(Z))return Z.aborted=!0,Z;let W=Q($,z,H);if(W instanceof Promise){if(H.async===!1)throw new g4;return W.then((K)=>Y._zod.parse(K,H))}return Y._zod.parse(W,H)};Y._zod.run=(Z,$)=>{if($.skipChecks)return Y._zod.parse(Z,$);if($.direction==="backward"){let W=Y._zod.parse({value:Z.value,issues:[]},{...$,skipChecks:!0});if(W instanceof Promise)return W.then((K)=>{return G(K,Z,$)});return G(W,Z,$)}let H=Y._zod.parse(Z,$);if(H instanceof Promise){if($.async===!1)throw new g4;return H.then((W)=>Q(W,z,$))}return Q(H,z,$)}}Y["~standard"]={validate:(Q)=>{try{let G=F5(Y,Q);return G.success?{value:G.data}:{issues:G.error?.issues}}catch(G){return A3(Y,Q).then((Z)=>Z.success?{value:Z.data}:{issues:Z.error?.issues})}},vendor:"zod",version:1}}),v3=g("$ZodString",(Y,X)=>{m0.init(Y,X),Y._zod.pattern=[...Y?._zod.bag?.patterns??[]].pop()??IH(Y._zod.bag),Y._zod.parse=(J,z)=>{if(X.coerce)try{J.value=String(J.value)}catch(Q){}if(typeof J.value==="string")return J;return J.issues.push({expected:"string",code:"invalid_type",input:J.value,inst:Y}),J}}),u0=g("$ZodStringFormat",(Y,X)=>{A5.init(Y,X),v3.init(Y,X)}),XW=g("$ZodGUID",(Y,X)=>{X.pattern??(X.pattern=KH),u0.init(Y,X)}),JW=g("$ZodUUID",(Y,X)=>{if(X.version){let z={v1:1,v2:2,v3:3,v4:4,v5:5,v6:6,v7:7,v8:8}[X.version];if(z===void 0)throw Error(`Invalid UUID version: "${X.version}"`);X.pattern??(X.pattern=KX(z))}else X.pattern??(X.pattern=KX());u0.init(Y,X)}),zW=g("$ZodEmail",(Y,X)=>{X.pattern??(X.pattern=UH),u0.init(Y,X)}),QW=g("$ZodURL",(Y,X)=>{u0.init(Y,X),Y._zod.check=(J)=>{try{let z=J.value.trim(),Q=new URL(z);if(X.hostname){if(X.hostname.lastIndex=0,!X.hostname.test(Q.hostname))J.issues.push({code:"invalid_format",format:"url",note:"Invalid hostname",pattern:qH.source,input:J.value,inst:Y,continue:!X.abort})}if(X.protocol){if(X.protocol.lastIndex=0,!X.protocol.test(Q.protocol.endsWith(":")?Q.protocol.slice(0,-1):Q.protocol))J.issues.push({code:"invalid_format",format:"url",note:"Invalid protocol",pattern:X.protocol.source,input:J.value,inst:Y,continue:!X.abort})}if(X.normalize)J.value=Q.href;else J.value=z;return}catch(z){J.issues.push({code:"invalid_format",format:"url",input:J.value,inst:Y,continue:!X.abort})}}}),GW=g("$ZodEmoji",(Y,X)=>{X.pattern??(X.pattern=BH()),u0.init(Y,X)}),ZW=g("$ZodNanoID",(Y,X)=>{X.pattern??(X.pattern=HH),u0.init(Y,X)}),$W=g("$ZodCUID",(Y,X)=>{X.pattern??(X.pattern=zH),u0.init(Y,X)}),HW=g("$ZodCUID2",(Y,X)=>{X.pattern??(X.pattern=QH),u0.init(Y,X)}),WW=g("$ZodULID",(Y,X)=>{X.pattern??(X.pattern=GH),u0.init(Y,X)}),KW=g("$ZodXID",(Y,X)=>{X.pattern??(X.pattern=ZH),u0.init(Y,X)}),UW=g("$ZodKSUID",(Y,X)=>{X.pattern??(X.pattern=$H),u0.init(Y,X)}),BW=g("$ZodISODateTime",(Y,X)=>{X.pattern??(X.pattern=TH(X)),u0.init(Y,X)}),VW=g("$ZodISODate",(Y,X)=>{X.pattern??(X.pattern=PH),u0.init(Y,X)}),OW=g("$ZodISOTime",(Y,X)=>{X.pattern??(X.pattern=wH(X)),u0.init(Y,X)}),MW=g("$ZodISODuration",(Y,X)=>{X.pattern??(X.pattern=WH),u0.init(Y,X)}),LW=g("$ZodIPv4",(Y,X)=>{X.pattern??(X.pattern=VH),u0.init(Y,X),Y._zod.onattach.push((J)=>{let z=J._zod.bag;z.format="ipv4"})}),NW=g("$ZodIPv6",(Y,X)=>{X.pattern??(X.pattern=OH),u0.init(Y,X),Y._zod.onattach.push((J)=>{let z=J._zod.bag;z.format="ipv6"}),Y._zod.check=(J)=>{try{new URL(`http://[${J.value}]`)}catch{J.issues.push({code:"invalid_format",format:"ipv6",input:J.value,inst:Y,continue:!X.abort})}}}),qW=g("$ZodCIDRv4",(Y,X)=>{X.pattern??(X.pattern=MH),u0.init(Y,X)}),xW=g("$ZodCIDRv6",(Y,X)=>{X.pattern??(X.pattern=LH),u0.init(Y,X),Y._zod.check=(J)=>{let z=J.value.split("/");try{if(z.length!==2)throw Error();let[Q,G]=z;if(!G)throw Error();let Z=Number(G);if(`${Z}`!==G)throw Error();if(Z<0||Z>128)throw Error();new URL(`http://[${Q}]`)}catch{J.issues.push({code:"invalid_format",format:"cidrv6",input:J.value,inst:Y,continue:!X.abort})}}});function FW(Y){if(Y==="")return!0;if(Y.length%4!==0)return!1;try{return atob(Y),!0}catch{return!1}}var PW=g("$ZodBase64",(Y,X)=>{X.pattern??(X.pattern=NH),u0.init(Y,X),Y._zod.onattach.push((J)=>{J._zod.bag.contentEncoding="base64"}),Y._zod.check=(J)=>{if(FW(J.value))return;J.issues.push({code:"invalid_format",format:"base64",input:J.value,inst:Y,continue:!X.abort})}});function Zy(Y){if(!UX.test(Y))return!1;let X=Y.replace(/[-_]/g,(z)=>z==="-"?"+":"/"),J=X.padEnd(Math.ceil(X.length/4)*4,"=");return FW(J)}var AW=g("$ZodBase64URL",(Y,X)=>{X.pattern??(X.pattern=UX),u0.init(Y,X),Y._zod.onattach.push((J)=>{J._zod.bag.contentEncoding="base64url"}),Y._zod.check=(J)=>{if(Zy(J.value))return;J.issues.push({code:"invalid_format",format:"base64url",input:J.value,inst:Y,continue:!X.abort})}}),wW=g("$ZodE164",(Y,X)=>{X.pattern??(X.pattern=xH),u0.init(Y,X)});function $y(Y,X=null){try{let J=Y.split(".");if(J.length!==3)return!1;let[z]=J;if(!z)return!1;let Q=JSON.parse(atob(z));if("typ"in Q&&Q?.typ!=="JWT")return!1;if(!Q.alg)return!1;if(X&&(!("alg"in Q)||Q.alg!==X))return!1;return!0}catch{return!1}}var TW=g("$ZodJWT",(Y,X)=>{u0.init(Y,X),Y._zod.check=(J)=>{if($y(J.value,X.alg))return;J.issues.push({code:"invalid_format",format:"jwt",input:J.value,inst:Y,continue:!X.abort})}});var LX=g("$ZodNumber",(Y,X)=>{m0.init(Y,X),Y._zod.pattern=Y._zod.bag.pattern??DH,Y._zod.parse=(J,z)=>{if(X.coerce)try{J.value=Number(J.value)}catch(Z){}let Q=J.value;if(typeof Q==="number"&&!Number.isNaN(Q)&&Number.isFinite(Q))return J;let G=typeof Q==="number"?Number.isNaN(Q)?"NaN":!Number.isFinite(Q)?"Infinity":void 0:void 0;return J.issues.push({expected:"number",code:"invalid_type",input:Q,inst:Y,...G?{received:G}:{}}),J}}),IW=g("$ZodNumber",(Y,X)=>{bH.init(Y,X),LX.init(Y,X)}),vW=g("$ZodBoolean",(Y,X)=>{m0.init(Y,X),Y._zod.pattern=jH,Y._zod.parse=(J,z)=>{if(X.coerce)try{J.value=Boolean(J.value)}catch(G){}let Q=J.value;if(typeof Q==="boolean")return J;return J.issues.push({expected:"boolean",code:"invalid_type",input:Q,inst:Y}),J}});var DW=g("$ZodNull",(Y,X)=>{m0.init(Y,X),Y._zod.pattern=CH,Y._zod.values=new Set([null]),Y._zod.parse=(J,z)=>{let Q=J.value;if(Q===null)return J;return J.issues.push({expected:"null",code:"invalid_type",input:Q,inst:Y}),J}});var jW=g("$ZodUnknown",(Y,X)=>{m0.init(Y,X),Y._zod.parse=(J)=>J}),CW=g("$ZodNever",(Y,X)=>{m0.init(Y,X),Y._zod.parse=(J,z)=>{return J.issues.push({expected:"never",code:"invalid_type",input:J.value,inst:Y}),J}});function nH(Y,X,J){if(Y.issues.length)X.issues.push(...c4(J,Y.issues));X.value[J]=Y.value}var EW=g("$ZodArray",(Y,X)=>{m0.init(Y,X),Y._zod.parse=(J,z)=>{let Q=J.value;if(!Array.isArray(Q))return J.issues.push({expected:"array",code:"invalid_type",input:Q,inst:Y}),J;J.value=Array(Q.length);let G=[];for(let Z=0;Z<Q.length;Z++){let $=Q[Z],H=X.element._zod.run({value:$,issues:[]},z);if(H instanceof Promise)G.push(H.then((W)=>nH(W,J,Z)));else nH(H,J,Z)}if(G.length)return Promise.all(G).then(()=>J);return J}});function I3(Y,X,J,z){if(Y.issues.length)X.issues.push(...c4(J,Y.issues));if(Y.value===void 0){if(J in z)X.value[J]=void 0}else X.value[J]=Y.value}function SW(Y){let X=Object.keys(Y.shape);for(let z of X)if(!Y.shape?.[z]?._zod?.traits?.has("$ZodType"))throw Error(`Invalid element at key "${z}": expected a Zod schema`);let J=$X(Y.shape);return{...Y,keys:X,keySet:new Set(X),numKeys:X.length,optionalKeys:new Set(J)}}function kW(Y,X,J,z,Q,G){let Z=[],$=Q.keySet,H=Q.catchall._zod,W=H.def.type;for(let K of Object.keys(X)){if($.has(K))continue;if(W==="never"){Z.push(K);continue}let U=H.run({value:X[K],issues:[]},z);if(U instanceof Promise)Y.push(U.then((B)=>I3(B,J,K,X)));else I3(U,J,K,X)}if(Z.length)J.issues.push({code:"unrecognized_keys",keys:Z,input:X,inst:G});if(!Y.length)return J;return Promise.all(Y).then(()=>{return J})}var Hy=g("$ZodObject",(Y,X)=>{m0.init(Y,X);let J=O6(()=>SW(X));f0(Y._zod,"propValues",()=>{let Z=X.shape,$={};for(let H in Z){let W=Z[H]._zod;if(W.values){$[H]??($[H]=new Set);for(let K of W.values)$[H].add(K)}}return $});let z=_8,Q=X.catchall,G;Y._zod.parse=(Z,$)=>{G??(G=J.value);let H=Z.value;if(!z(H))return Z.issues.push({expected:"object",code:"invalid_type",input:H,inst:Y}),Z;Z.value={};let W=[],K=G.shape;for(let U of G.keys){let O=K[U]._zod.run({value:H[U],issues:[]},$);if(O instanceof Promise)W.push(O.then((V)=>I3(V,Z,U,H)));else I3(O,Z,U,H)}if(!Q)return W.length?Promise.all(W).then(()=>Z):Z;return kW(W,H,Z,$,J.value,Y)}}),_W=g("$ZodObjectJIT",(Y,X)=>{Hy.init(Y,X);let J=Y._zod.parse,z=O6(()=>SW(X)),Q=(B)=>{let O=new OX(["shape","payload","ctx"]),V=z.value,L=(A)=>{let w=L3(A);return`shape[${w}]._zod.run({ value: input[${w}], issues: [] }, ctx)`};O.write("const input = payload.value;");let q=Object.create(null),F=0;for(let A of V.keys)q[A]=`key_${F++}`;O.write("const newResult = {};");for(let A of V.keys){let w=q[A],v=L3(A);O.write(`const ${w} = ${L(A)};`),O.write(`
        if (${w}.issues.length) {
          payload.issues = payload.issues.concat(${w}.issues.map(iss => ({
            ...iss,
            path: iss.path ? [${v}, ...iss.path] : [${v}]
          })));
        }
        
        
        if (${w}.value === undefined) {
          if (${v} in input) {
            newResult[${v}] = undefined;
          }
        } else {
          newResult[${v}] = ${w}.value;
        }
        
      `)}O.write("payload.value = newResult;"),O.write("return payload;");let P=O.compile();return(A,w)=>P(B,A,w)},G,Z=_8,$=!O3.jitless,W=$&&GX.value,K=X.catchall,U;Y._zod.parse=(B,O)=>{U??(U=z.value);let V=B.value;if(!Z(V))return B.issues.push({expected:"object",code:"invalid_type",input:V,inst:Y}),B;if($&&W&&O?.async===!1&&O.jitless!==!0){if(!G)G=Q(X.shape);if(B=G(B,O),!K)return B;return kW([],V,B,O,U,Y)}return J(B,O)}});function oH(Y,X,J,z){for(let G of Y)if(G.issues.length===0)return X.value=G.value,X;let Q=Y.filter((G)=>!H8(G));if(Q.length===1)return X.value=Q[0].value,Q[0];return X.issues.push({code:"invalid_union",input:X.value,inst:J,errors:Y.map((G)=>G.issues.map((Z)=>H4(Z,z,o1())))}),X}var NX=g("$ZodUnion",(Y,X)=>{m0.init(Y,X),f0(Y._zod,"optin",()=>X.options.some((Q)=>Q._zod.optin==="optional")?"optional":void 0),f0(Y._zod,"optout",()=>X.options.some((Q)=>Q._zod.optout==="optional")?"optional":void 0),f0(Y._zod,"values",()=>{if(X.options.every((Q)=>Q._zod.values))return new Set(X.options.flatMap((Q)=>Array.from(Q._zod.values)));return}),f0(Y._zod,"pattern",()=>{if(X.options.every((Q)=>Q._zod.pattern)){let Q=X.options.map((G)=>G._zod.pattern);return new RegExp(`^(${Q.map((G)=>N5(G.source)).join("|")})$`)}return});let J=X.options.length===1,z=X.options[0]._zod.run;Y._zod.parse=(Q,G)=>{if(J)return z(Q,G);let Z=!1,$=[];for(let H of X.options){let W=H._zod.run({value:Q.value,issues:[]},G);if(W instanceof Promise)$.push(W),Z=!0;else{if(W.issues.length===0)return W;$.push(W)}}if(!Z)return oH($,Q,Y,G);return Promise.all($).then((H)=>{return oH(H,Q,Y,G)})}}),bW=g("$ZodDiscriminatedUnion",(Y,X)=>{NX.init(Y,X);let J=Y._zod.parse;f0(Y._zod,"propValues",()=>{let Q={};for(let G of X.options){let Z=G._zod.propValues;if(!Z||Object.keys(Z).length===0)throw Error(`Invalid discriminated union option at index "${X.options.indexOf(G)}"`);for(let[$,H]of Object.entries(Z)){if(!Q[$])Q[$]=new Set;for(let W of H)Q[$].add(W)}}return Q});let z=O6(()=>{let Q=X.options,G=new Map;for(let Z of Q){let $=Z._zod.propValues?.[X.discriminator];if(!$||$.size===0)throw Error(`Invalid discriminated union option at index "${X.options.indexOf(Z)}"`);for(let H of $){if(G.has(H))throw Error(`Duplicate discriminator value "${String(H)}"`);G.set(H,Z)}}return G});Y._zod.parse=(Q,G)=>{let Z=Q.value;if(!_8(Z))return Q.issues.push({code:"invalid_type",expected:"object",input:Z,inst:Y}),Q;let $=z.value.get(Z?.[X.discriminator]);if($)return $._zod.run(Q,G);if(X.unionFallback)return J(Q,G);return Q.issues.push({code:"invalid_union",errors:[],note:"No matching discriminator",discriminator:X.discriminator,input:Z,path:[X.discriminator],inst:Y}),Q}}),RW=g("$ZodIntersection",(Y,X)=>{m0.init(Y,X),Y._zod.parse=(J,z)=>{let Q=J.value,G=X.left._zod.run({value:Q,issues:[]},z),Z=X.right._zod.run({value:Q,issues:[]},z);if(G instanceof Promise||Z instanceof Promise)return Promise.all([G,Z]).then(([H,W])=>{return aH(J,H,W)});return aH(J,G,Z)}});function MX(Y,X){if(Y===X)return{valid:!0,data:Y};if(Y instanceof Date&&X instanceof Date&&+Y===+X)return{valid:!0,data:Y};if($8(Y)&&$8(X)){let J=Object.keys(X),z=Object.keys(Y).filter((G)=>J.indexOf(G)!==-1),Q={...Y,...X};for(let G of z){let Z=MX(Y[G],X[G]);if(!Z.valid)return{valid:!1,mergeErrorPath:[G,...Z.mergeErrorPath]};Q[G]=Z.data}return{valid:!0,data:Q}}if(Array.isArray(Y)&&Array.isArray(X)){if(Y.length!==X.length)return{valid:!1,mergeErrorPath:[]};let J=[];for(let z=0;z<Y.length;z++){let Q=Y[z],G=X[z],Z=MX(Q,G);if(!Z.valid)return{valid:!1,mergeErrorPath:[z,...Z.mergeErrorPath]};J.push(Z.data)}return{valid:!0,data:J}}return{valid:!1,mergeErrorPath:[]}}function aH(Y,X,J){if(X.issues.length)Y.issues.push(...X.issues);if(J.issues.length)Y.issues.push(...J.issues);if(H8(Y))return Y;let z=MX(X.value,J.value);if(!z.valid)throw Error(`Unmergable intersection. Error path: ${JSON.stringify(z.mergeErrorPath)}`);return Y.value=z.data,Y}var fW=g("$ZodRecord",(Y,X)=>{m0.init(Y,X),Y._zod.parse=(J,z)=>{let Q=J.value;if(!$8(Q))return J.issues.push({expected:"record",code:"invalid_type",input:Q,inst:Y}),J;let G=[];if(X.keyType._zod.values){let Z=X.keyType._zod.values;J.value={};for(let H of Z)if(typeof H==="string"||typeof H==="number"||typeof H==="symbol"){let W=X.valueType._zod.run({value:Q[H],issues:[]},z);if(W instanceof Promise)G.push(W.then((K)=>{if(K.issues.length)J.issues.push(...c4(H,K.issues));J.value[H]=K.value}));else{if(W.issues.length)J.issues.push(...c4(H,W.issues));J.value[H]=W.value}}let $;for(let H in Q)if(!Z.has(H))$=$??[],$.push(H);if($&&$.length>0)J.issues.push({code:"unrecognized_keys",input:Q,inst:Y,keys:$})}else{J.value={};for(let Z of Reflect.ownKeys(Q)){if(Z==="__proto__")continue;let $=X.keyType._zod.run({value:Z,issues:[]},z);if($ instanceof Promise)throw Error("Async schemas not supported in object keys currently");if($.issues.length){J.issues.push({code:"invalid_key",origin:"record",issues:$.issues.map((W)=>H4(W,z,o1())),input:Z,path:[Z],inst:Y}),J.value[$.value]=$.value;continue}let H=X.valueType._zod.run({value:Q[Z],issues:[]},z);if(H instanceof Promise)G.push(H.then((W)=>{if(W.issues.length)J.issues.push(...c4(Z,W.issues));J.value[$.value]=W.value}));else{if(H.issues.length)J.issues.push(...c4(Z,H.issues));J.value[$.value]=H.value}}}if(G.length)return Promise.all(G).then(()=>J);return J}});var yW=g("$ZodEnum",(Y,X)=>{m0.init(Y,X);let J=zX(X.entries),z=new Set(J);Y._zod.values=z,Y._zod.pattern=new RegExp(`^(${J.filter((Q)=>ZX.has(typeof Q)).map((Q)=>typeof Q==="string"?p4(Q):Q.toString()).join("|")})$`),Y._zod.parse=(Q,G)=>{let Z=Q.value;if(z.has(Z))return Q;return Q.issues.push({code:"invalid_value",values:J,input:Z,inst:Y}),Q}}),hW=g("$ZodLiteral",(Y,X)=>{if(m0.init(Y,X),X.values.length===0)throw Error("Cannot create literal schema with no valid values");Y._zod.values=new Set(X.values),Y._zod.pattern=new RegExp(`^(${X.values.map((J)=>typeof J==="string"?p4(J):J?p4(J.toString()):String(J)).join("|")})$`),Y._zod.parse=(J,z)=>{let Q=J.value;if(Y._zod.values.has(Q))return J;return J.issues.push({code:"invalid_value",values:X.values,input:Q,inst:Y}),J}});var mW=g("$ZodTransform",(Y,X)=>{m0.init(Y,X),Y._zod.parse=(J,z)=>{if(z.direction==="backward")throw new O5(Y.constructor.name);let Q=X.transform(J.value,J);if(z.async)return(Q instanceof Promise?Q:Promise.resolve(Q)).then((Z)=>{return J.value=Z,J});if(Q instanceof Promise)throw new g4;return J.value=Q,J}});function sH(Y,X){if(Y.issues.length&&X===void 0)return{issues:[],value:void 0};return Y}var uW=g("$ZodOptional",(Y,X)=>{m0.init(Y,X),Y._zod.optin="optional",Y._zod.optout="optional",f0(Y._zod,"values",()=>{return X.innerType._zod.values?new Set([...X.innerType._zod.values,void 0]):void 0}),f0(Y._zod,"pattern",()=>{let J=X.innerType._zod.pattern;return J?new RegExp(`^(${N5(J.source)})?$`):void 0}),Y._zod.parse=(J,z)=>{if(X.innerType._zod.optin==="optional"){let Q=X.innerType._zod.run(J,z);if(Q instanceof Promise)return Q.then((G)=>sH(G,J.value));return sH(Q,J.value)}if(J.value===void 0)return J;return X.innerType._zod.run(J,z)}}),gW=g("$ZodNullable",(Y,X)=>{m0.init(Y,X),f0(Y._zod,"optin",()=>X.innerType._zod.optin),f0(Y._zod,"optout",()=>X.innerType._zod.optout),f0(Y._zod,"pattern",()=>{let J=X.innerType._zod.pattern;return J?new RegExp(`^(${N5(J.source)}|null)$`):void 0}),f0(Y._zod,"values",()=>{return X.innerType._zod.values?new Set([...X.innerType._zod.values,null]):void 0}),Y._zod.parse=(J,z)=>{if(J.value===null)return J;return X.innerType._zod.run(J,z)}}),pW=g("$ZodDefault",(Y,X)=>{m0.init(Y,X),Y._zod.optin="optional",f0(Y._zod,"values",()=>X.innerType._zod.values),Y._zod.parse=(J,z)=>{if(z.direction==="backward")return X.innerType._zod.run(J,z);if(J.value===void 0)return J.value=X.defaultValue,J;let Q=X.innerType._zod.run(J,z);if(Q instanceof Promise)return Q.then((G)=>rH(G,X));return rH(Q,X)}});function rH(Y,X){if(Y.value===void 0)Y.value=X.defaultValue;return Y}var cW=g("$ZodPrefault",(Y,X)=>{m0.init(Y,X),Y._zod.optin="optional",f0(Y._zod,"values",()=>X.innerType._zod.values),Y._zod.parse=(J,z)=>{if(z.direction==="backward")return X.innerType._zod.run(J,z);if(J.value===void 0)J.value=X.defaultValue;return X.innerType._zod.run(J,z)}}),dW=g("$ZodNonOptional",(Y,X)=>{m0.init(Y,X),f0(Y._zod,"values",()=>{let J=X.innerType._zod.values;return J?new Set([...J].filter((z)=>z!==void 0)):void 0}),Y._zod.parse=(J,z)=>{let Q=X.innerType._zod.run(J,z);if(Q instanceof Promise)return Q.then((G)=>tH(G,Y));return tH(Q,Y)}});function tH(Y,X){if(!Y.issues.length&&Y.value===void 0)Y.issues.push({code:"invalid_type",expected:"nonoptional",input:Y.value,inst:X});return Y}var lW=g("$ZodCatch",(Y,X)=>{m0.init(Y,X),f0(Y._zod,"optin",()=>X.innerType._zod.optin),f0(Y._zod,"optout",()=>X.innerType._zod.optout),f0(Y._zod,"values",()=>X.innerType._zod.values),Y._zod.parse=(J,z)=>{if(z.direction==="backward")return X.innerType._zod.run(J,z);let Q=X.innerType._zod.run(J,z);if(Q instanceof Promise)return Q.then((G)=>{if(J.value=G.value,G.issues.length)J.value=X.catchValue({...J,error:{issues:G.issues.map((Z)=>H4(Z,z,o1()))},input:J.value}),J.issues=[];return J});if(J.value=Q.value,Q.issues.length)J.value=X.catchValue({...J,error:{issues:Q.issues.map((G)=>H4(G,z,o1()))},input:J.value}),J.issues=[];return J}});var iW=g("$ZodPipe",(Y,X)=>{m0.init(Y,X),f0(Y._zod,"values",()=>X.in._zod.values),f0(Y._zod,"optin",()=>X.in._zod.optin),f0(Y._zod,"optout",()=>X.out._zod.optout),f0(Y._zod,"propValues",()=>X.in._zod.propValues),Y._zod.parse=(J,z)=>{if(z.direction==="backward"){let G=X.out._zod.run(J,z);if(G instanceof Promise)return G.then((Z)=>T3(Z,X.in,z));return T3(G,X.in,z)}let Q=X.in._zod.run(J,z);if(Q instanceof Promise)return Q.then((G)=>T3(G,X.out,z));return T3(Q,X.out,z)}});function T3(Y,X,J){if(Y.issues.length)return Y.aborted=!0,Y;return X._zod.run({value:Y.value,issues:Y.issues},J)}var nW=g("$ZodReadonly",(Y,X)=>{m0.init(Y,X),f0(Y._zod,"propValues",()=>X.innerType._zod.propValues),f0(Y._zod,"values",()=>X.innerType._zod.values),f0(Y._zod,"optin",()=>X.innerType._zod.optin),f0(Y._zod,"optout",()=>X.innerType._zod.optout),Y._zod.parse=(J,z)=>{if(z.direction==="backward")return X.innerType._zod.run(J,z);let Q=X.innerType._zod.run(J,z);if(Q instanceof Promise)return Q.then(eH);return eH(Q)}});function eH(Y){return Y.value=Object.freeze(Y.value),Y}var oW=g("$ZodCustom",(Y,X)=>{M1.init(Y,X),m0.init(Y,X),Y._zod.parse=(J,z)=>{return J},Y._zod.check=(J)=>{let z=J.value,Q=X.fn(z);if(Q instanceof Promise)return Q.then((G)=>YW(G,J,z,Y));YW(Q,J,z,Y);return}});function YW(Y,X,J,z){if(!Y){let Q={code:"custom",input:J,inst:z,path:[...z._zod.def.path??[]],continue:!z._zod.def.abort};if(z._zod.def.params)Q.params=z._zod.def.params;X.issues.push(M6(Q))}}var Wy=(Y)=>{let X=typeof Y;switch(X){case"number":return Number.isNaN(Y)?"NaN":"number";case"object":{if(Array.isArray(Y))return"array";if(Y===null)return"null";if(Object.getPrototypeOf(Y)!==Object.prototype&&Y.constructor)return Y.constructor.name}}return X},Ky=()=>{let Y={string:{unit:"characters",verb:"to have"},file:{unit:"bytes",verb:"to have"},array:{unit:"items",verb:"to have"},set:{unit:"items",verb:"to have"}};function X(z){return Y[z]??null}let J={regex:"input",email:"email address",url:"URL",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"ISO datetime",date:"ISO date",time:"ISO time",duration:"ISO duration",ipv4:"IPv4 address",ipv6:"IPv6 address",cidrv4:"IPv4 range",cidrv6:"IPv6 range",base64:"base64-encoded string",base64url:"base64url-encoded string",json_string:"JSON string",e164:"E.164 number",jwt:"JWT",template_literal:"input"};return(z)=>{switch(z.code){case"invalid_type":return`Invalid input: expected ${z.expected}, received ${Wy(z.input)}`;case"invalid_value":if(z.values.length===1)return`Invalid input: expected ${q3(z.values[0])}`;return`Invalid option: expected one of ${M3(z.values,"|")}`;case"too_big":{let Q=z.inclusive?"<=":"<",G=X(z.origin);if(G)return`Too big: expected ${z.origin??"value"} to have ${Q}${z.maximum.toString()} ${G.unit??"elements"}`;return`Too big: expected ${z.origin??"value"} to be ${Q}${z.maximum.toString()}`}case"too_small":{let Q=z.inclusive?">=":">",G=X(z.origin);if(G)return`Too small: expected ${z.origin} to have ${Q}${z.minimum.toString()} ${G.unit}`;return`Too small: expected ${z.origin} to be ${Q}${z.minimum.toString()}`}case"invalid_format":{let Q=z;if(Q.format==="starts_with")return`Invalid string: must start with "${Q.prefix}"`;if(Q.format==="ends_with")return`Invalid string: must end with "${Q.suffix}"`;if(Q.format==="includes")return`Invalid string: must include "${Q.includes}"`;if(Q.format==="regex")return`Invalid string: must match pattern ${Q.pattern}`;return`Invalid ${J[Q.format]??z.format}`}case"not_multiple_of":return`Invalid number: must be a multiple of ${z.divisor}`;case"unrecognized_keys":return`Unrecognized key${z.keys.length>1?"s":""}: ${M3(z.keys,", ")}`;case"invalid_key":return`Invalid key in ${z.origin}`;case"invalid_union":return"Invalid input";case"invalid_element":return`Invalid value in ${z.origin}`;default:return"Invalid input"}}};function qX(){return{localeError:Ky()}}var KJ0=Symbol("ZodOutput"),UJ0=Symbol("ZodInput");class aW{constructor(){this._map=new WeakMap,this._idmap=new Map}add(Y,...X){let J=X[0];if(this._map.set(Y,J),J&&typeof J==="object"&&"id"in J){if(this._idmap.has(J.id))throw Error(`ID ${J.id} already exists in the registry`);this._idmap.set(J.id,Y)}return this}clear(){return this._map=new WeakMap,this._idmap=new Map,this}remove(Y){let X=this._map.get(Y);if(X&&typeof X==="object"&&"id"in X)this._idmap.delete(X.id);return this._map.delete(Y),this}get(Y){let X=Y._zod.parent;if(X){let J={...this.get(X)??{}};delete J.id;let z={...J,...this._map.get(Y)};return Object.keys(z).length?z:void 0}return this._map.get(Y)}has(Y){return this._map.has(Y)}}function Uy(){return new aW}var w5=Uy();function sW(Y,X){return new Y({type:"string",...U0(X)})}function rW(Y,X){return new Y({type:"string",format:"email",check:"string_format",abort:!1,...U0(X)})}function xX(Y,X){return new Y({type:"string",format:"guid",check:"string_format",abort:!1,...U0(X)})}function tW(Y,X){return new Y({type:"string",format:"uuid",check:"string_format",abort:!1,...U0(X)})}function eW(Y,X){return new Y({type:"string",format:"uuid",check:"string_format",abort:!1,version:"v4",...U0(X)})}function YK(Y,X){return new Y({type:"string",format:"uuid",check:"string_format",abort:!1,version:"v6",...U0(X)})}function XK(Y,X){return new Y({type:"string",format:"uuid",check:"string_format",abort:!1,version:"v7",...U0(X)})}function JK(Y,X){return new Y({type:"string",format:"url",check:"string_format",abort:!1,...U0(X)})}function zK(Y,X){return new Y({type:"string",format:"emoji",check:"string_format",abort:!1,...U0(X)})}function QK(Y,X){return new Y({type:"string",format:"nanoid",check:"string_format",abort:!1,...U0(X)})}function GK(Y,X){return new Y({type:"string",format:"cuid",check:"string_format",abort:!1,...U0(X)})}function ZK(Y,X){return new Y({type:"string",format:"cuid2",check:"string_format",abort:!1,...U0(X)})}function $K(Y,X){return new Y({type:"string",format:"ulid",check:"string_format",abort:!1,...U0(X)})}function HK(Y,X){return new Y({type:"string",format:"xid",check:"string_format",abort:!1,...U0(X)})}function WK(Y,X){return new Y({type:"string",format:"ksuid",check:"string_format",abort:!1,...U0(X)})}function KK(Y,X){return new Y({type:"string",format:"ipv4",check:"string_format",abort:!1,...U0(X)})}function UK(Y,X){return new Y({type:"string",format:"ipv6",check:"string_format",abort:!1,...U0(X)})}function BK(Y,X){return new Y({type:"string",format:"cidrv4",check:"string_format",abort:!1,...U0(X)})}function VK(Y,X){return new Y({type:"string",format:"cidrv6",check:"string_format",abort:!1,...U0(X)})}function OK(Y,X){return new Y({type:"string",format:"base64",check:"string_format",abort:!1,...U0(X)})}function MK(Y,X){return new Y({type:"string",format:"base64url",check:"string_format",abort:!1,...U0(X)})}function LK(Y,X){return new Y({type:"string",format:"e164",check:"string_format",abort:!1,...U0(X)})}function NK(Y,X){return new Y({type:"string",format:"jwt",check:"string_format",abort:!1,...U0(X)})}function qK(Y,X){return new Y({type:"string",format:"datetime",check:"string_format",offset:!1,local:!1,precision:null,...U0(X)})}function xK(Y,X){return new Y({type:"string",format:"date",check:"string_format",...U0(X)})}function FK(Y,X){return new Y({type:"string",format:"time",check:"string_format",precision:null,...U0(X)})}function PK(Y,X){return new Y({type:"string",format:"duration",check:"string_format",...U0(X)})}function AK(Y,X){return new Y({type:"number",checks:[],...U0(X)})}function wK(Y,X){return new Y({type:"number",check:"number_format",abort:!1,format:"safeint",...U0(X)})}function TK(Y,X){return new Y({type:"boolean",...U0(X)})}function IK(Y,X){return new Y({type:"null",...U0(X)})}function vK(Y){return new Y({type:"unknown"})}function DK(Y,X){return new Y({type:"never",...U0(X)})}function D3(Y,X){return new BX({check:"less_than",...U0(X),value:Y,inclusive:!1})}function T5(Y,X){return new BX({check:"less_than",...U0(X),value:Y,inclusive:!0})}function j3(Y,X){return new VX({check:"greater_than",...U0(X),value:Y,inclusive:!1})}function I5(Y,X){return new VX({check:"greater_than",...U0(X),value:Y,inclusive:!0})}function C3(Y,X){return new _H({check:"multiple_of",...U0(X),value:Y})}function E3(Y,X){return new RH({check:"max_length",...U0(X),maximum:Y})}function L6(Y,X){return new fH({check:"min_length",...U0(X),minimum:Y})}function S3(Y,X){return new yH({check:"length_equals",...U0(X),length:Y})}function FX(Y,X){return new hH({check:"string_format",format:"regex",...U0(X),pattern:Y})}function PX(Y){return new mH({check:"string_format",format:"lowercase",...U0(Y)})}function AX(Y){return new uH({check:"string_format",format:"uppercase",...U0(Y)})}function wX(Y,X){return new gH({check:"string_format",format:"includes",...U0(X),includes:Y})}function TX(Y,X){return new pH({check:"string_format",format:"starts_with",...U0(X),prefix:Y})}function IX(Y,X){return new cH({check:"string_format",format:"ends_with",...U0(X),suffix:Y})}function b8(Y){return new dH({check:"overwrite",tx:Y})}function vX(Y){return b8((X)=>X.normalize(Y))}function DX(){return b8((Y)=>Y.trim())}function jX(){return b8((Y)=>Y.toLowerCase())}function CX(){return b8((Y)=>Y.toUpperCase())}function jK(Y,X,J){return new Y({type:"array",element:X,...U0(J)})}function CK(Y,X,J){let z=U0(J);return z.abort??(z.abort=!0),new Y({type:"custom",check:"custom",fn:X,...z})}function EK(Y,X,J){return new Y({type:"custom",check:"custom",fn:X,...U0(J)})}function SK(Y){let X=By((J)=>{return J.addIssue=(z)=>{if(typeof z==="string")J.issues.push(M6(z,J.value,X._zod.def));else{let Q=z;if(Q.fatal)Q.continue=!1;Q.code??(Q.code="custom"),Q.input??(Q.input=J.value),Q.inst??(Q.inst=X),Q.continue??(Q.continue=!X._zod.def.abort),J.issues.push(M6(Q))}},Y(J.value,J)});return X}function By(Y,X){let J=new M1({check:"custom",...U0(X)});return J._zod.check=Y,J}function N6(Y){return!!Y._zod}function W8(Y,X){if(N6(Y))return F5(Y,X);return Y.safeParse(X)}function k3(Y){if(!Y)return;let X;if(N6(Y))X=Y._zod?.def?.shape;else X=Y.shape;if(!X)return;if(typeof X==="function")try{return X()}catch{return}return X}function kK(Y){if(N6(Y)){let G=Y._zod?.def;if(G){if(G.value!==void 0)return G.value;if(Array.isArray(G.values)&&G.values.length>0)return G.values[0]}}let J=Y._def;if(J){if(J.value!==void 0)return J.value;if(Array.isArray(J.values)&&J.values.length>0)return J.values[0]}let z=Y.value;if(z!==void 0)return z;return}var D5={};G0(D5,{time:()=>kX,duration:()=>_X,datetime:()=>EX,date:()=>SX,ZodISOTime:()=>RK,ZodISODuration:()=>fK,ZodISODateTime:()=>_K,ZodISODate:()=>bK});var _K=g("ZodISODateTime",(Y,X)=>{BW.init(Y,X),p0.init(Y,X)});function EX(Y){return qK(_K,Y)}var bK=g("ZodISODate",(Y,X)=>{VW.init(Y,X),p0.init(Y,X)});function SX(Y){return xK(bK,Y)}var RK=g("ZodISOTime",(Y,X)=>{OW.init(Y,X),p0.init(Y,X)});function kX(Y){return FK(RK,Y)}var fK=g("ZodISODuration",(Y,X)=>{MW.init(Y,X),p0.init(Y,X)});function _X(Y){return PK(fK,Y)}var yK=(Y,X)=>{x3.init(Y,X),Y.name="ZodError",Object.defineProperties(Y,{format:{value:(J)=>o$(Y,J)},flatten:{value:(J)=>n$(Y,J)},addIssue:{value:(J)=>{Y.issues.push(J),Y.message=JSON.stringify(Y.issues,V6,2)}},addIssues:{value:(J)=>{Y.issues.push(...J),Y.message=JSON.stringify(Y.issues,V6,2)}},isEmpty:{get(){return Y.issues.length===0}}})},sJ0=g("ZodError",yK),c1=g("ZodError",yK,{Parent:Error});var hK=F3(c1),mK=P3(c1),uK=x5(c1),gK=P5(c1),pK=a$(c1),cK=s$(c1),dK=r$(c1),lK=t$(c1),iK=e$(c1),nK=YH(c1),oK=XH(c1),aK=JH(c1);var o0=g("ZodType",(Y,X)=>{return m0.init(Y,X),Y.def=X,Y.type=X.type,Object.defineProperty(Y,"_def",{value:X}),Y.check=(...J)=>{return Y.clone({...X,checks:[...X.checks??[],...J.map((z)=>typeof z==="function"?{_zod:{check:z,def:{check:"custom"},onattach:[]}}:z)]})},Y.clone=(J,z)=>$4(Y,J,z),Y.brand=()=>Y,Y.register=(J,z)=>{return J.add(Y,z),Y},Y.parse=(J,z)=>hK(Y,J,z,{callee:Y.parse}),Y.safeParse=(J,z)=>uK(Y,J,z),Y.parseAsync=async(J,z)=>mK(Y,J,z,{callee:Y.parseAsync}),Y.safeParseAsync=async(J,z)=>gK(Y,J,z),Y.spa=Y.safeParseAsync,Y.encode=(J,z)=>pK(Y,J,z),Y.decode=(J,z)=>cK(Y,J,z),Y.encodeAsync=async(J,z)=>dK(Y,J,z),Y.decodeAsync=async(J,z)=>lK(Y,J,z),Y.safeEncode=(J,z)=>iK(Y,J,z),Y.safeDecode=(J,z)=>nK(Y,J,z),Y.safeEncodeAsync=async(J,z)=>oK(Y,J,z),Y.safeDecodeAsync=async(J,z)=>aK(Y,J,z),Y.refine=(J,z)=>Y.check(Hh(J,z)),Y.superRefine=(J)=>Y.check(Wh(J)),Y.overwrite=(J)=>Y.check(b8(J)),Y.optional=()=>n0(Y),Y.nullable=()=>tK(Y),Y.nullish=()=>n0(tK(Y)),Y.nonoptional=(J)=>Jh(Y,J),Y.array=()=>v0(Y),Y.or=(J)=>h0([Y,J]),Y.and=(J)=>b3(Y,J),Y.transform=(J)=>RX(Y,zU(J)),Y.default=(J)=>ey(Y,J),Y.prefault=(J)=>Xh(Y,J),Y.catch=(J)=>Qh(Y,J),Y.pipe=(J)=>RX(Y,J),Y.readonly=()=>$h(Y),Y.describe=(J)=>{let z=Y.clone();return w5.add(z,{description:J}),z},Object.defineProperty(Y,"description",{get(){return w5.get(Y)?.description},configurable:!0}),Y.meta=(...J)=>{if(J.length===0)return w5.get(Y);let z=Y.clone();return w5.add(z,J[0]),z},Y.isOptional=()=>Y.safeParse(void 0).success,Y.isNullable=()=>Y.safeParse(null).success,Y}),eK=g("_ZodString",(Y,X)=>{v3.init(Y,X),o0.init(Y,X);let J=Y._zod.bag;Y.format=J.format??null,Y.minLength=J.minimum??null,Y.maxLength=J.maximum??null,Y.regex=(...z)=>Y.check(FX(...z)),Y.includes=(...z)=>Y.check(wX(...z)),Y.startsWith=(...z)=>Y.check(TX(...z)),Y.endsWith=(...z)=>Y.check(IX(...z)),Y.min=(...z)=>Y.check(L6(...z)),Y.max=(...z)=>Y.check(E3(...z)),Y.length=(...z)=>Y.check(S3(...z)),Y.nonempty=(...z)=>Y.check(L6(1,...z)),Y.lowercase=(z)=>Y.check(PX(z)),Y.uppercase=(z)=>Y.check(AX(z)),Y.trim=()=>Y.check(DX()),Y.normalize=(...z)=>Y.check(vX(...z)),Y.toLowerCase=()=>Y.check(jX()),Y.toUpperCase=()=>Y.check(CX())}),Py=g("ZodString",(Y,X)=>{v3.init(Y,X),eK.init(Y,X),Y.email=(J)=>Y.check(rW(Ay,J)),Y.url=(J)=>Y.check(JK(wy,J)),Y.jwt=(J)=>Y.check(NK(hy,J)),Y.emoji=(J)=>Y.check(zK(Ty,J)),Y.guid=(J)=>Y.check(xX(sK,J)),Y.uuid=(J)=>Y.check(tW(_3,J)),Y.uuidv4=(J)=>Y.check(eW(_3,J)),Y.uuidv6=(J)=>Y.check(YK(_3,J)),Y.uuidv7=(J)=>Y.check(XK(_3,J)),Y.nanoid=(J)=>Y.check(QK(Iy,J)),Y.guid=(J)=>Y.check(xX(sK,J)),Y.cuid=(J)=>Y.check(GK(vy,J)),Y.cuid2=(J)=>Y.check(ZK(Dy,J)),Y.ulid=(J)=>Y.check($K(jy,J)),Y.base64=(J)=>Y.check(OK(Ry,J)),Y.base64url=(J)=>Y.check(MK(fy,J)),Y.xid=(J)=>Y.check(HK(Cy,J)),Y.ksuid=(J)=>Y.check(WK(Ey,J)),Y.ipv4=(J)=>Y.check(KK(Sy,J)),Y.ipv6=(J)=>Y.check(UK(ky,J)),Y.cidrv4=(J)=>Y.check(BK(_y,J)),Y.cidrv6=(J)=>Y.check(VK(by,J)),Y.e164=(J)=>Y.check(LK(yy,J)),Y.datetime=(J)=>Y.check(EX(J)),Y.date=(J)=>Y.check(SX(J)),Y.time=(J)=>Y.check(kX(J)),Y.duration=(J)=>Y.check(_X(J))});function u(Y){return sW(Py,Y)}var p0=g("ZodStringFormat",(Y,X)=>{u0.init(Y,X),eK.init(Y,X)}),Ay=g("ZodEmail",(Y,X)=>{zW.init(Y,X),p0.init(Y,X)});var sK=g("ZodGUID",(Y,X)=>{XW.init(Y,X),p0.init(Y,X)});var _3=g("ZodUUID",(Y,X)=>{JW.init(Y,X),p0.init(Y,X)});var wy=g("ZodURL",(Y,X)=>{QW.init(Y,X),p0.init(Y,X)});var Ty=g("ZodEmoji",(Y,X)=>{GW.init(Y,X),p0.init(Y,X)});var Iy=g("ZodNanoID",(Y,X)=>{ZW.init(Y,X),p0.init(Y,X)});var vy=g("ZodCUID",(Y,X)=>{$W.init(Y,X),p0.init(Y,X)});var Dy=g("ZodCUID2",(Y,X)=>{HW.init(Y,X),p0.init(Y,X)});var jy=g("ZodULID",(Y,X)=>{WW.init(Y,X),p0.init(Y,X)});var Cy=g("ZodXID",(Y,X)=>{KW.init(Y,X),p0.init(Y,X)});var Ey=g("ZodKSUID",(Y,X)=>{UW.init(Y,X),p0.init(Y,X)});var Sy=g("ZodIPv4",(Y,X)=>{LW.init(Y,X),p0.init(Y,X)});var ky=g("ZodIPv6",(Y,X)=>{NW.init(Y,X),p0.init(Y,X)});var _y=g("ZodCIDRv4",(Y,X)=>{qW.init(Y,X),p0.init(Y,X)});var by=g("ZodCIDRv6",(Y,X)=>{xW.init(Y,X),p0.init(Y,X)});var Ry=g("ZodBase64",(Y,X)=>{PW.init(Y,X),p0.init(Y,X)});var fy=g("ZodBase64URL",(Y,X)=>{AW.init(Y,X),p0.init(Y,X)});var yy=g("ZodE164",(Y,X)=>{wW.init(Y,X),p0.init(Y,X)});var hy=g("ZodJWT",(Y,X)=>{TW.init(Y,X),p0.init(Y,X)});var YU=g("ZodNumber",(Y,X)=>{LX.init(Y,X),o0.init(Y,X),Y.gt=(z,Q)=>Y.check(j3(z,Q)),Y.gte=(z,Q)=>Y.check(I5(z,Q)),Y.min=(z,Q)=>Y.check(I5(z,Q)),Y.lt=(z,Q)=>Y.check(D3(z,Q)),Y.lte=(z,Q)=>Y.check(T5(z,Q)),Y.max=(z,Q)=>Y.check(T5(z,Q)),Y.int=(z)=>Y.check(rK(z)),Y.safe=(z)=>Y.check(rK(z)),Y.positive=(z)=>Y.check(j3(0,z)),Y.nonnegative=(z)=>Y.check(I5(0,z)),Y.negative=(z)=>Y.check(D3(0,z)),Y.nonpositive=(z)=>Y.check(T5(0,z)),Y.multipleOf=(z,Q)=>Y.check(C3(z,Q)),Y.step=(z,Q)=>Y.check(C3(z,Q)),Y.finite=()=>Y;let J=Y._zod.bag;Y.minValue=Math.max(J.minimum??Number.NEGATIVE_INFINITY,J.exclusiveMinimum??Number.NEGATIVE_INFINITY)??null,Y.maxValue=Math.min(J.maximum??Number.POSITIVE_INFINITY,J.exclusiveMaximum??Number.POSITIVE_INFINITY)??null,Y.isInt=(J.format??"").includes("int")||Number.isSafeInteger(J.multipleOf??0.5),Y.isFinite=!0,Y.format=J.format??null});function R0(Y){return AK(YU,Y)}var my=g("ZodNumberFormat",(Y,X)=>{IW.init(Y,X),YU.init(Y,X)});function rK(Y){return wK(my,Y)}var uy=g("ZodBoolean",(Y,X)=>{vW.init(Y,X),o0.init(Y,X)});function H1(Y){return TK(uy,Y)}var gy=g("ZodNull",(Y,X)=>{DW.init(Y,X),o0.init(Y,X)});function fX(Y){return IK(gy,Y)}var py=g("ZodUnknown",(Y,X)=>{jW.init(Y,X),o0.init(Y,X)});function c0(){return vK(py)}var cy=g("ZodNever",(Y,X)=>{CW.init(Y,X),o0.init(Y,X)});function dy(Y){return DK(cy,Y)}var ly=g("ZodArray",(Y,X)=>{EW.init(Y,X),o0.init(Y,X),Y.element=X.element,Y.min=(J,z)=>Y.check(L6(J,z)),Y.nonempty=(J)=>Y.check(L6(1,J)),Y.max=(J,z)=>Y.check(E3(J,z)),Y.length=(J,z)=>Y.check(S3(J,z)),Y.unwrap=()=>Y.element});function v0(Y,X){return jK(ly,Y,X)}var XU=g("ZodObject",(Y,X)=>{_W.init(Y,X),o0.init(Y,X),I0.defineLazy(Y,"shape",()=>X.shape),Y.keyof=()=>k1(Object.keys(Y._zod.def.shape)),Y.catchall=(J)=>Y.clone({...Y._zod.def,catchall:J}),Y.passthrough=()=>Y.clone({...Y._zod.def,catchall:c0()}),Y.loose=()=>Y.clone({...Y._zod.def,catchall:c0()}),Y.strict=()=>Y.clone({...Y._zod.def,catchall:dy()}),Y.strip=()=>Y.clone({...Y._zod.def,catchall:void 0}),Y.extend=(J)=>{return I0.extend(Y,J)},Y.safeExtend=(J)=>{return I0.safeExtend(Y,J)},Y.merge=(J)=>I0.merge(Y,J),Y.pick=(J)=>I0.pick(Y,J),Y.omit=(J)=>I0.omit(Y,J),Y.partial=(...J)=>I0.partial(QU,Y,J[0]),Y.required=(...J)=>I0.required(GU,Y,J[0])});function z0(Y,X){let J={type:"object",get shape(){return I0.assignProp(this,"shape",Y?I0.objectClone(Y):{}),this.shape},...I0.normalizeParams(X)};return new XU(J)}function v1(Y,X){return new XU({type:"object",get shape(){return I0.assignProp(this,"shape",I0.objectClone(Y)),this.shape},catchall:c0(),...I0.normalizeParams(X)})}var JU=g("ZodUnion",(Y,X)=>{NX.init(Y,X),o0.init(Y,X),Y.options=X.options});function h0(Y,X){return new JU({type:"union",options:Y,...I0.normalizeParams(X)})}var iy=g("ZodDiscriminatedUnion",(Y,X)=>{JU.init(Y,X),bW.init(Y,X)});function yX(Y,X,J){return new iy({type:"union",options:X,discriminator:Y,...I0.normalizeParams(J)})}var ny=g("ZodIntersection",(Y,X)=>{RW.init(Y,X),o0.init(Y,X)});function b3(Y,X){return new ny({type:"intersection",left:Y,right:X})}var oy=g("ZodRecord",(Y,X)=>{fW.init(Y,X),o0.init(Y,X),Y.keyType=X.keyType,Y.valueType=X.valueType});function d0(Y,X,J){return new oy({type:"record",keyType:Y,valueType:X,...I0.normalizeParams(J)})}var bX=g("ZodEnum",(Y,X)=>{yW.init(Y,X),o0.init(Y,X),Y.enum=X.entries,Y.options=Object.values(X.entries);let J=new Set(Object.keys(X.entries));Y.extract=(z,Q)=>{let G={};for(let Z of z)if(J.has(Z))G[Z]=X.entries[Z];else throw Error(`Key ${Z} not found in enum`);return new bX({...X,checks:[],...I0.normalizeParams(Q),entries:G})},Y.exclude=(z,Q)=>{let G={...X.entries};for(let Z of z)if(J.has(Z))delete G[Z];else throw Error(`Key ${Z} not found in enum`);return new bX({...X,checks:[],...I0.normalizeParams(Q),entries:G})}});function k1(Y,X){let J=Array.isArray(Y)?Object.fromEntries(Y.map((z)=>[z,z])):Y;return new bX({type:"enum",entries:J,...I0.normalizeParams(X)})}var ay=g("ZodLiteral",(Y,X)=>{hW.init(Y,X),o0.init(Y,X),Y.values=new Set(X.values),Object.defineProperty(Y,"value",{get(){if(X.values.length>1)throw Error("This schema contains multiple valid literal values. Use `.values` instead.");return X.values[0]}})});function Z0(Y,X){return new ay({type:"literal",values:Array.isArray(Y)?Y:[Y],...I0.normalizeParams(X)})}var sy=g("ZodTransform",(Y,X)=>{mW.init(Y,X),o0.init(Y,X),Y._zod.parse=(J,z)=>{if(z.direction==="backward")throw new O5(Y.constructor.name);J.addIssue=(G)=>{if(typeof G==="string")J.issues.push(I0.issue(G,J.value,X));else{let Z=G;if(Z.fatal)Z.continue=!1;Z.code??(Z.code="custom"),Z.input??(Z.input=J.value),Z.inst??(Z.inst=Y),J.issues.push(I0.issue(Z))}};let Q=X.transform(J.value,J);if(Q instanceof Promise)return Q.then((G)=>{return J.value=G,J});return J.value=Q,J}});function zU(Y){return new sy({type:"transform",transform:Y})}var QU=g("ZodOptional",(Y,X)=>{uW.init(Y,X),o0.init(Y,X),Y.unwrap=()=>Y._zod.def.innerType});function n0(Y){return new QU({type:"optional",innerType:Y})}var ry=g("ZodNullable",(Y,X)=>{gW.init(Y,X),o0.init(Y,X),Y.unwrap=()=>Y._zod.def.innerType});function tK(Y){return new ry({type:"nullable",innerType:Y})}var ty=g("ZodDefault",(Y,X)=>{pW.init(Y,X),o0.init(Y,X),Y.unwrap=()=>Y._zod.def.innerType,Y.removeDefault=Y.unwrap});function ey(Y,X){return new ty({type:"default",innerType:Y,get defaultValue(){return typeof X==="function"?X():I0.shallowClone(X)}})}var Yh=g("ZodPrefault",(Y,X)=>{cW.init(Y,X),o0.init(Y,X),Y.unwrap=()=>Y._zod.def.innerType});function Xh(Y,X){return new Yh({type:"prefault",innerType:Y,get defaultValue(){return typeof X==="function"?X():I0.shallowClone(X)}})}var GU=g("ZodNonOptional",(Y,X)=>{dW.init(Y,X),o0.init(Y,X),Y.unwrap=()=>Y._zod.def.innerType});function Jh(Y,X){return new GU({type:"nonoptional",innerType:Y,...I0.normalizeParams(X)})}var zh=g("ZodCatch",(Y,X)=>{lW.init(Y,X),o0.init(Y,X),Y.unwrap=()=>Y._zod.def.innerType,Y.removeCatch=Y.unwrap});function Qh(Y,X){return new zh({type:"catch",innerType:Y,catchValue:typeof X==="function"?X:()=>X})}var Gh=g("ZodPipe",(Y,X)=>{iW.init(Y,X),o0.init(Y,X),Y.in=X.in,Y.out=X.out});function RX(Y,X){return new Gh({type:"pipe",in:Y,out:X})}var Zh=g("ZodReadonly",(Y,X)=>{nW.init(Y,X),o0.init(Y,X),Y.unwrap=()=>Y._zod.def.innerType});function $h(Y){return new Zh({type:"readonly",innerType:Y})}var ZU=g("ZodCustom",(Y,X)=>{oW.init(Y,X),o0.init(Y,X)});function $U(Y,X){return CK(ZU,Y??(()=>!0),X)}function Hh(Y,X={}){return EK(ZU,Y,X)}function Wh(Y){return SK(Y)}function hX(Y,X){return RX(zU(Y),X)}o1(qX());var mX="2025-11-25";var HU=[mX,"2025-06-18","2025-03-26","2024-11-05","2024-10-07"],K8="io.modelcontextprotocol/related-task",f3="2.0",L1=$U((Y)=>Y!==null&&(typeof Y==="object"||typeof Y==="function")),WU=h0([u(),R0().int()]),KU=u(),lz0=v1({ttl:h0([R0(),fX()]).optional(),pollInterval:R0().optional()}),Kh=z0({ttl:R0().optional()}),Uh=z0({taskId:u()}),uX=v1({progressToken:WU.optional(),[K8]:Uh.optional()}),d1=z0({_meta:uX.optional()}),j5=d1.extend({task:Kh.optional()}),UU=(Y)=>j5.safeParse(Y).success,N1=z0({method:u(),params:d1.loose().optional()}),a1=z0({_meta:uX.optional()}),s1=z0({method:u(),params:a1.loose().optional()}),q1=v1({_meta:uX.optional()}),y3=h0([u(),R0().int()]),BU=z0({jsonrpc:Z0(f3),id:y3,...N1.shape}).strict(),gX=(Y)=>BU.safeParse(Y).success,VU=z0({jsonrpc:Z0(f3),...s1.shape}).strict(),OU=(Y)=>VU.safeParse(Y).success,pX=z0({jsonrpc:Z0(f3),id:y3,result:q1}).strict(),C5=(Y)=>pX.safeParse(Y).success;var B0;(function(Y){Y[Y.ConnectionClosed=-32000]="ConnectionClosed",Y[Y.RequestTimeout=-32001]="RequestTimeout",Y[Y.ParseError=-32700]="ParseError",Y[Y.InvalidRequest=-32600]="InvalidRequest",Y[Y.MethodNotFound=-32601]="MethodNotFound",Y[Y.InvalidParams=-32602]="InvalidParams",Y[Y.InternalError=-32603]="InternalError",Y[Y.UrlElicitationRequired=-32042]="UrlElicitationRequired"})(B0||(B0={}));var cX=z0({jsonrpc:Z0(f3),id:y3.optional(),error:z0({code:R0().int(),message:u(),data:c0().optional()})}).strict();var MU=(Y)=>cX.safeParse(Y).success;var LU=h0([BU,VU,pX,cX]),iz0=h0([pX,cX]),h3=q1.strict(),Bh=a1.extend({requestId:y3.optional(),reason:u().optional()}),m3=s1.extend({method:Z0("notifications/cancelled"),params:Bh}),Vh=z0({src:u(),mimeType:u().optional(),sizes:v0(u()).optional(),theme:k1(["light","dark"]).optional()}),E5=z0({icons:v0(Vh).optional()}),q6=z0({name:u(),title:u().optional()}),NU=q6.extend({...q6.shape,...E5.shape,version:u(),websiteUrl:u().optional(),description:u().optional()}),Oh=b3(z0({applyDefaults:H1().optional()}),d0(u(),c0())),Mh=hX((Y)=>{if(Y&&typeof Y==="object"&&!Array.isArray(Y)){if(Object.keys(Y).length===0)return{form:{}}}return Y},b3(z0({form:Oh.optional(),url:L1.optional()}),d0(u(),c0()).optional())),Lh=v1({list:L1.optional(),cancel:L1.optional(),requests:v1({sampling:v1({createMessage:L1.optional()}).optional(),elicitation:v1({create:L1.optional()}).optional()}).optional()}),Nh=v1({list:L1.optional(),cancel:L1.optional(),requests:v1({tools:v1({call:L1.optional()}).optional()}).optional()}),qh=z0({experimental:d0(u(),L1).optional(),sampling:z0({context:L1.optional(),tools:L1.optional()}).optional(),elicitation:Mh.optional(),roots:z0({listChanged:H1().optional()}).optional(),tasks:Lh.optional()}),xh=d1.extend({protocolVersion:u(),capabilities:qh,clientInfo:NU}),dX=N1.extend({method:Z0("initialize"),params:xh});var Fh=z0({experimental:d0(u(),L1).optional(),logging:L1.optional(),completions:L1.optional(),prompts:z0({listChanged:H1().optional()}).optional(),resources:z0({subscribe:H1().optional(),listChanged:H1().optional()}).optional(),tools:z0({listChanged:H1().optional()}).optional(),tasks:Nh.optional()}),Ph=q1.extend({protocolVersion:u(),capabilities:Fh,serverInfo:NU,instructions:u().optional()}),lX=s1.extend({method:Z0("notifications/initialized"),params:a1.optional()});var u3=N1.extend({method:Z0("ping"),params:d1.optional()}),Ah=z0({progress:R0(),total:n0(R0()),message:n0(u())}),wh=z0({...a1.shape,...Ah.shape,progressToken:WU}),g3=s1.extend({method:Z0("notifications/progress"),params:wh}),Th=d1.extend({cursor:KU.optional()}),S5=N1.extend({params:Th.optional()}),k5=q1.extend({nextCursor:KU.optional()}),Ih=k1(["working","input_required","completed","failed","cancelled"]),_5=z0({taskId:u(),status:Ih,ttl:h0([R0(),fX()]),createdAt:u(),lastUpdatedAt:u(),pollInterval:n0(R0()),statusMessage:n0(u())}),x6=q1.extend({task:_5}),vh=a1.merge(_5),b5=s1.extend({method:Z0("notifications/tasks/status"),params:vh}),p3=N1.extend({method:Z0("tasks/get"),params:d1.extend({taskId:u()})}),c3=q1.merge(_5),d3=N1.extend({method:Z0("tasks/result"),params:d1.extend({taskId:u()})}),nz0=q1.loose(),l3=S5.extend({method:Z0("tasks/list")}),i3=k5.extend({tasks:v0(_5)}),n3=N1.extend({method:Z0("tasks/cancel"),params:d1.extend({taskId:u()})}),qU=q1.merge(_5),xU=z0({uri:u(),mimeType:n0(u()),_meta:d0(u(),c0()).optional()}),FU=xU.extend({text:u()}),iX=u().refine((Y)=>{try{return atob(Y),!0}catch{return!1}},{message:"Invalid Base64 string"}),PU=xU.extend({blob:iX}),R5=k1(["user","assistant"]),F6=z0({audience:v0(R5).optional(),priority:R0().min(0).max(1).optional(),lastModified:D5.datetime({offset:!0}).optional()}),AU=z0({...q6.shape,...E5.shape,uri:u(),description:n0(u()),mimeType:n0(u()),annotations:F6.optional(),_meta:n0(v1({}))}),Dh=z0({...q6.shape,...E5.shape,uriTemplate:u(),description:n0(u()),mimeType:n0(u()),annotations:F6.optional(),_meta:n0(v1({}))}),jh=S5.extend({method:Z0("resources/list")}),Ch=k5.extend({resources:v0(AU)}),Eh=S5.extend({method:Z0("resources/templates/list")}),Sh=k5.extend({resourceTemplates:v0(Dh)}),nX=d1.extend({uri:u()}),kh=nX,_h=N1.extend({method:Z0("resources/read"),params:kh}),bh=q1.extend({contents:v0(h0([FU,PU]))}),Rh=s1.extend({method:Z0("notifications/resources/list_changed"),params:a1.optional()}),fh=nX,yh=N1.extend({method:Z0("resources/subscribe"),params:fh}),hh=nX,mh=N1.extend({method:Z0("resources/unsubscribe"),params:hh}),uh=a1.extend({uri:u()}),gh=s1.extend({method:Z0("notifications/resources/updated"),params:uh}),ph=z0({name:u(),description:n0(u()),required:n0(H1())}),ch=z0({...q6.shape,...E5.shape,description:n0(u()),arguments:n0(v0(ph)),_meta:n0(v1({}))}),oX=S5.extend({method:Z0("prompts/list")}),dh=k5.extend({prompts:v0(ch)}),lh=d1.extend({name:u(),arguments:d0(u(),u()).optional()}),aX=N1.extend({method:Z0("prompts/get"),params:lh}),sX=z0({type:Z0("text"),text:u(),annotations:F6.optional(),_meta:d0(u(),c0()).optional()}),rX=z0({type:Z0("image"),data:iX,mimeType:u(),annotations:F6.optional(),_meta:d0(u(),c0()).optional()}),tX=z0({type:Z0("audio"),data:iX,mimeType:u(),annotations:F6.optional(),_meta:d0(u(),c0()).optional()}),ih=z0({type:Z0("tool_use"),name:u(),id:u(),input:d0(u(),c0()),_meta:d0(u(),c0()).optional()}),nh=z0({type:Z0("resource"),resource:h0([FU,PU]),annotations:F6.optional(),_meta:d0(u(),c0()).optional()}),oh=AU.extend({type:Z0("resource_link")}),eX=h0([sX,rX,tX,oh,nh]),ah=z0({role:R5,content:eX}),sh=q1.extend({description:u().optional(),messages:v0(ah)}),rh=s1.extend({method:Z0("notifications/prompts/list_changed"),params:a1.optional()}),th=z0({title:u().optional(),readOnlyHint:H1().optional(),destructiveHint:H1().optional(),idempotentHint:H1().optional(),openWorldHint:H1().optional()}),eh=z0({taskSupport:k1(["required","optional","forbidden"]).optional()}),wU=z0({...q6.shape,...E5.shape,description:u().optional(),inputSchema:z0({type:Z0("object"),properties:d0(u(),L1).optional(),required:v0(u()).optional()}).catchall(c0()),outputSchema:z0({type:Z0("object"),properties:d0(u(),L1).optional(),required:v0(u()).optional()}).catchall(c0()).optional(),annotations:th.optional(),execution:eh.optional(),_meta:d0(u(),c0()).optional()}),YJ=S5.extend({method:Z0("tools/list")}),Ym=k5.extend({tools:v0(wU)}),o3=q1.extend({content:v0(eX).default([]),structuredContent:d0(u(),c0()).optional(),isError:H1().optional()}),oz0=o3.or(q1.extend({toolResult:c0()})),Xm=j5.extend({name:u(),arguments:d0(u(),c0()).optional()}),f5=N1.extend({method:Z0("tools/call"),params:Xm}),Jm=s1.extend({method:Z0("notifications/tools/list_changed"),params:a1.optional()}),az0=z0({autoRefresh:H1().default(!0),debounceMs:R0().int().nonnegative().default(300)}),y5=k1(["debug","info","notice","warning","error","critical","alert","emergency"]),zm=d1.extend({level:y5}),XJ=N1.extend({method:Z0("logging/setLevel"),params:zm}),Qm=a1.extend({level:y5,logger:u().optional(),data:c0()}),Gm=s1.extend({method:Z0("notifications/message"),params:Qm}),Zm=z0({name:u().optional()}),$m=z0({hints:v0(Zm).optional(),costPriority:R0().min(0).max(1).optional(),speedPriority:R0().min(0).max(1).optional(),intelligencePriority:R0().min(0).max(1).optional()}),Hm=z0({mode:k1(["auto","required","none"]).optional()}),Wm=z0({type:Z0("tool_result"),toolUseId:u().describe("The unique identifier for the corresponding tool call."),content:v0(eX).default([]),structuredContent:z0({}).loose().optional(),isError:H1().optional(),_meta:d0(u(),c0()).optional()}),Km=yX("type",[sX,rX,tX]),R3=yX("type",[sX,rX,tX,ih,Wm]),Um=z0({role:R5,content:h0([R3,v0(R3)]),_meta:d0(u(),c0()).optional()}),Bm=j5.extend({messages:v0(Um),modelPreferences:$m.optional(),systemPrompt:u().optional(),includeContext:k1(["none","thisServer","allServers"]).optional(),temperature:R0().optional(),maxTokens:R0().int(),stopSequences:v0(u()).optional(),metadata:L1.optional(),tools:v0(wU).optional(),toolChoice:Hm.optional()}),Vm=N1.extend({method:Z0("sampling/createMessage"),params:Bm}),JJ=q1.extend({model:u(),stopReason:n0(k1(["endTurn","stopSequence","maxTokens"]).or(u())),role:R5,content:Km}),zJ=q1.extend({model:u(),stopReason:n0(k1(["endTurn","stopSequence","maxTokens","toolUse"]).or(u())),role:R5,content:h0([R3,v0(R3)])}),Om=z0({type:Z0("boolean"),title:u().optional(),description:u().optional(),default:H1().optional()}),Mm=z0({type:Z0("string"),title:u().optional(),description:u().optional(),minLength:R0().optional(),maxLength:R0().optional(),format:k1(["email","uri","date","date-time"]).optional(),default:u().optional()}),Lm=z0({type:k1(["number","integer"]),title:u().optional(),description:u().optional(),minimum:R0().optional(),maximum:R0().optional(),default:R0().optional()}),Nm=z0({type:Z0("string"),title:u().optional(),description:u().optional(),enum:v0(u()),default:u().optional()}),qm=z0({type:Z0("string"),title:u().optional(),description:u().optional(),oneOf:v0(z0({const:u(),title:u()})),default:u().optional()}),xm=z0({type:Z0("string"),title:u().optional(),description:u().optional(),enum:v0(u()),enumNames:v0(u()).optional(),default:u().optional()}),Fm=h0([Nm,qm]),Pm=z0({type:Z0("array"),title:u().optional(),description:u().optional(),minItems:R0().optional(),maxItems:R0().optional(),items:z0({type:Z0("string"),enum:v0(u())}),default:v0(u()).optional()}),Am=z0({type:Z0("array"),title:u().optional(),description:u().optional(),minItems:R0().optional(),maxItems:R0().optional(),items:z0({anyOf:v0(z0({const:u(),title:u()}))}),default:v0(u()).optional()}),wm=h0([Pm,Am]),Tm=h0([xm,Fm,wm]),Im=h0([Tm,Om,Mm,Lm]),vm=j5.extend({mode:Z0("form").optional(),message:u(),requestedSchema:z0({type:Z0("object"),properties:d0(u(),Im),required:v0(u()).optional()})}),Dm=j5.extend({mode:Z0("url"),message:u(),elicitationId:u(),url:u().url()}),jm=h0([vm,Dm]),Cm=N1.extend({method:Z0("elicitation/create"),params:jm}),Em=a1.extend({elicitationId:u()}),Sm=s1.extend({method:Z0("notifications/elicitation/complete"),params:Em}),a3=q1.extend({action:k1(["accept","decline","cancel"]),content:hX((Y)=>Y===null?void 0:Y,d0(u(),h0([u(),R0(),H1(),v0(u())])).optional())}),km=z0({type:Z0("ref/resource"),uri:u()});var _m=z0({type:Z0("ref/prompt"),name:u()}),bm=d1.extend({ref:h0([_m,km]),argument:z0({name:u(),value:u()}),context:z0({arguments:d0(u(),u()).optional()}).optional()}),Rm=N1.extend({method:Z0("completion/complete"),params:bm});var fm=q1.extend({completion:v1({values:v0(u()).max(100),total:n0(R0().int()),hasMore:n0(H1())})}),ym=z0({uri:u().startsWith("file://"),name:u().optional(),_meta:d0(u(),c0()).optional()}),hm=N1.extend({method:Z0("roots/list"),params:d1.optional()}),QJ=q1.extend({roots:v0(ym)}),mm=s1.extend({method:Z0("notifications/roots/list_changed"),params:a1.optional()}),sz0=h0([u3,dX,Rm,XJ,aX,oX,jh,Eh,_h,yh,mh,f5,YJ,p3,d3,l3,n3]),rz0=h0([m3,g3,lX,mm,b5]),tz0=h0([h3,JJ,zJ,a3,QJ,c3,i3,x6]),ez0=h0([u3,Vm,Cm,hm,p3,d3,l3,n3]),YQ0=h0([m3,g3,Gm,gh,Rh,Jm,rh,b5,Sm]),XQ0=h0([h3,Ph,fm,sh,dh,Ch,Sh,bh,o3,Ym,c3,i3,x6]);class K0 extends Error{constructor(Y,X,J){super(`MCP error ${Y}: ${X}`);this.code=Y,this.data=J,this.name="McpError"}static fromError(Y,X,J){if(Y===B0.UrlElicitationRequired&&J){let z=J;if(z.elicitations)return new TU(z.elicitations,X)}return new K0(Y,X,J)}}class TU extends K0{constructor(Y,X=`URL elicitation${Y.length>1?"s":""} required`){super(B0.UrlElicitationRequired,X,{elicitations:Y})}get elicitations(){return this.data?.elicitations??[]}}function U8(Y){return Y==="completed"||Y==="failed"||Y==="cancelled"}var um=Symbol("Let zodToJsonSchema decide on which parser to use");var bQ0=new Set("ABCDEFGHIJKLMNOPQRSTUVXYZabcdefghijklmnopqrstuvxyz0123456789");function GJ(Y){let J=k3(Y)?.method;if(!J)throw Error("Schema is missing a method literal");let z=kK(J);if(typeof z!=="string")throw Error("Schema method literal must be a string");return z}function ZJ(Y,X){let J=W8(Y,X);if(!J.success)throw J.error;return J.data}var im=60000;class $J{constructor(Y){if(this._options=Y,this._requestMessageId=0,this._requestHandlers=new Map,this._requestHandlerAbortControllers=new Map,this._notificationHandlers=new Map,this._responseHandlers=new Map,this._progressHandlers=new Map,this._timeoutInfo=new Map,this._pendingDebouncedNotifications=new Set,this._taskProgressTokens=new Map,this._requestResolvers=new Map,this.setNotificationHandler(m3,(X)=>{this._oncancel(X)}),this.setNotificationHandler(g3,(X)=>{this._onprogress(X)}),this.setRequestHandler(u3,(X)=>({})),this._taskStore=Y?.taskStore,this._taskMessageQueue=Y?.taskMessageQueue,this._taskStore)this.setRequestHandler(p3,async(X,J)=>{let z=await this._taskStore.getTask(X.params.taskId,J.sessionId);if(!z)throw new K0(B0.InvalidParams,"Failed to retrieve task: Task not found");return{...z}}),this.setRequestHandler(d3,async(X,J)=>{let z=async()=>{let Q=X.params.taskId;if(this._taskMessageQueue){let Z;while(Z=await this._taskMessageQueue.dequeue(Q,J.sessionId)){if(Z.type==="response"||Z.type==="error"){let $=Z.message,H=$.id,W=this._requestResolvers.get(H);if(W)if(this._requestResolvers.delete(H),Z.type==="response")W($);else{let K=$,U=new K0(K.error.code,K.error.message,K.error.data);W(U)}else{let K=Z.type==="response"?"Response":"Error";this._onerror(Error(`${K} handler missing for request ${H}`))}continue}await this._transport?.send(Z.message,{relatedRequestId:J.requestId})}}let G=await this._taskStore.getTask(Q,J.sessionId);if(!G)throw new K0(B0.InvalidParams,`Task not found: ${Q}`);if(!U8(G.status))return await this._waitForTaskUpdate(Q,J.signal),await z();if(U8(G.status)){let Z=await this._taskStore.getTaskResult(Q,J.sessionId);return this._clearTaskQueue(Q),{...Z,_meta:{...Z._meta,[K8]:{taskId:Q}}}}return await z()};return await z()}),this.setRequestHandler(l3,async(X,J)=>{try{let{tasks:z,nextCursor:Q}=await this._taskStore.listTasks(X.params?.cursor,J.sessionId);return{tasks:z,nextCursor:Q,_meta:{}}}catch(z){throw new K0(B0.InvalidParams,`Failed to list tasks: ${z instanceof Error?z.message:String(z)}`)}}),this.setRequestHandler(n3,async(X,J)=>{try{let z=await this._taskStore.getTask(X.params.taskId,J.sessionId);if(!z)throw new K0(B0.InvalidParams,`Task not found: ${X.params.taskId}`);if(U8(z.status))throw new K0(B0.InvalidParams,`Cannot cancel task in terminal status: ${z.status}`);await this._taskStore.updateTaskStatus(X.params.taskId,"cancelled","Client cancelled task execution.",J.sessionId),this._clearTaskQueue(X.params.taskId);let Q=await this._taskStore.getTask(X.params.taskId,J.sessionId);if(!Q)throw new K0(B0.InvalidParams,`Task not found after cancellation: ${X.params.taskId}`);return{_meta:{},...Q}}catch(z){if(z instanceof K0)throw z;throw new K0(B0.InvalidRequest,`Failed to cancel task: ${z instanceof Error?z.message:String(z)}`)}})}async _oncancel(Y){if(!Y.params.requestId)return;this._requestHandlerAbortControllers.get(Y.params.requestId)?.abort(Y.params.reason)}_setupTimeout(Y,X,J,z,Q=!1){this._timeoutInfo.set(Y,{timeoutId:setTimeout(z,X),startTime:Date.now(),timeout:X,maxTotalTimeout:J,resetTimeoutOnProgress:Q,onTimeout:z})}_resetTimeout(Y){let X=this._timeoutInfo.get(Y);if(!X)return!1;let J=Date.now()-X.startTime;if(X.maxTotalTimeout&&J>=X.maxTotalTimeout)throw this._timeoutInfo.delete(Y),K0.fromError(B0.RequestTimeout,"Maximum total timeout exceeded",{maxTotalTimeout:X.maxTotalTimeout,totalElapsed:J});return clearTimeout(X.timeoutId),X.timeoutId=setTimeout(X.onTimeout,X.timeout),!0}_cleanupTimeout(Y){let X=this._timeoutInfo.get(Y);if(X)clearTimeout(X.timeoutId),this._timeoutInfo.delete(Y)}async connect(Y){this._transport=Y;let X=this.transport?.onclose;this._transport.onclose=()=>{X?.(),this._onclose()};let J=this.transport?.onerror;this._transport.onerror=(Q)=>{J?.(Q),this._onerror(Q)};let z=this._transport?.onmessage;this._transport.onmessage=(Q,G)=>{if(z?.(Q,G),C5(Q)||MU(Q))this._onresponse(Q);else if(gX(Q))this._onrequest(Q,G);else if(OU(Q))this._onnotification(Q);else this._onerror(Error(`Unknown message type: ${JSON.stringify(Q)}`))},await this._transport.start()}_onclose(){let Y=this._responseHandlers;this._responseHandlers=new Map,this._progressHandlers.clear(),this._taskProgressTokens.clear(),this._pendingDebouncedNotifications.clear();let X=K0.fromError(B0.ConnectionClosed,"Connection closed");this._transport=void 0,this.onclose?.();for(let J of Y.values())J(X)}_onerror(Y){this.onerror?.(Y)}_onnotification(Y){let X=this._notificationHandlers.get(Y.method)??this.fallbackNotificationHandler;if(X===void 0)return;Promise.resolve().then(()=>X(Y)).catch((J)=>this._onerror(Error(`Uncaught error in notification handler: ${J}`)))}_onrequest(Y,X){let J=this._requestHandlers.get(Y.method)??this.fallbackRequestHandler,z=this._transport,Q=Y.params?._meta?.[K8]?.taskId;if(J===void 0){let W={jsonrpc:"2.0",id:Y.id,error:{code:B0.MethodNotFound,message:"Method not found"}};if(Q&&this._taskMessageQueue)this._enqueueTaskMessage(Q,{type:"error",message:W,timestamp:Date.now()},z?.sessionId).catch((K)=>this._onerror(Error(`Failed to enqueue error response: ${K}`)));else z?.send(W).catch((K)=>this._onerror(Error(`Failed to send an error response: ${K}`)));return}let G=new AbortController;this._requestHandlerAbortControllers.set(Y.id,G);let Z=UU(Y.params)?Y.params.task:void 0,$=this._taskStore?this.requestTaskStore(Y,z?.sessionId):void 0,H={signal:G.signal,sessionId:z?.sessionId,_meta:Y.params?._meta,sendNotification:async(W)=>{let K={relatedRequestId:Y.id};if(Q)K.relatedTask={taskId:Q};await this.notification(W,K)},sendRequest:async(W,K,U)=>{let B={...U,relatedRequestId:Y.id};if(Q&&!B.relatedTask)B.relatedTask={taskId:Q};let O=B.relatedTask?.taskId??Q;if(O&&$)await $.updateTaskStatus(O,"input_required");return await this.request(W,K,B)},authInfo:X?.authInfo,requestId:Y.id,requestInfo:X?.requestInfo,taskId:Q,taskStore:$,taskRequestedTtl:Z?.ttl,closeSSEStream:X?.closeSSEStream,closeStandaloneSSEStream:X?.closeStandaloneSSEStream};Promise.resolve().then(()=>{if(Z)this.assertTaskHandlerCapability(Y.method)}).then(()=>J(Y,H)).then(async(W)=>{if(G.signal.aborted)return;let K={result:W,jsonrpc:"2.0",id:Y.id};if(Q&&this._taskMessageQueue)await this._enqueueTaskMessage(Q,{type:"response",message:K,timestamp:Date.now()},z?.sessionId);else await z?.send(K)},async(W)=>{if(G.signal.aborted)return;let K={jsonrpc:"2.0",id:Y.id,error:{code:Number.isSafeInteger(W.code)?W.code:B0.InternalError,message:W.message??"Internal error",...W.data!==void 0&&{data:W.data}}};if(Q&&this._taskMessageQueue)await this._enqueueTaskMessage(Q,{type:"error",message:K,timestamp:Date.now()},z?.sessionId);else await z?.send(K)}).catch((W)=>this._onerror(Error(`Failed to send response: ${W}`))).finally(()=>{this._requestHandlerAbortControllers.delete(Y.id)})}_onprogress(Y){let{progressToken:X,...J}=Y.params,z=Number(X),Q=this._progressHandlers.get(z);if(!Q){this._onerror(Error(`Received a progress notification for an unknown token: ${JSON.stringify(Y)}`));return}let G=this._responseHandlers.get(z),Z=this._timeoutInfo.get(z);if(Z&&G&&Z.resetTimeoutOnProgress)try{this._resetTimeout(z)}catch($){this._responseHandlers.delete(z),this._progressHandlers.delete(z),this._cleanupTimeout(z),G($);return}Q(J)}_onresponse(Y){let X=Number(Y.id),J=this._requestResolvers.get(X);if(J){if(this._requestResolvers.delete(X),C5(Y))J(Y);else{let G=new K0(Y.error.code,Y.error.message,Y.error.data);J(G)}return}let z=this._responseHandlers.get(X);if(z===void 0){this._onerror(Error(`Received a response for an unknown message ID: ${JSON.stringify(Y)}`));return}this._responseHandlers.delete(X),this._cleanupTimeout(X);let Q=!1;if(C5(Y)&&Y.result&&typeof Y.result==="object"){let G=Y.result;if(G.task&&typeof G.task==="object"){let Z=G.task;if(typeof Z.taskId==="string")Q=!0,this._taskProgressTokens.set(Z.taskId,X)}}if(!Q)this._progressHandlers.delete(X);if(C5(Y))z(Y);else{let G=K0.fromError(Y.error.code,Y.error.message,Y.error.data);z(G)}}get transport(){return this._transport}async close(){await this._transport?.close()}async*requestStream(Y,X,J){let{task:z}=J??{};if(!z){try{yield{type:"result",result:await this.request(Y,X,J)}}catch(G){yield{type:"error",error:G instanceof K0?G:new K0(B0.InternalError,String(G))}}return}let Q;try{let G=await this.request(Y,x6,J);if(G.task)Q=G.task.taskId,yield{type:"taskCreated",task:G.task};else throw new K0(B0.InternalError,"Task creation did not return a task");while(!0){let Z=await this.getTask({taskId:Q},J);if(yield{type:"taskStatus",task:Z},U8(Z.status)){if(Z.status==="completed")yield{type:"result",result:await this.getTaskResult({taskId:Q},X,J)};else if(Z.status==="failed")yield{type:"error",error:new K0(B0.InternalError,`Task ${Q} failed`)};else if(Z.status==="cancelled")yield{type:"error",error:new K0(B0.InternalError,`Task ${Q} was cancelled`)};return}if(Z.status==="input_required"){yield{type:"result",result:await this.getTaskResult({taskId:Q},X,J)};return}let $=Z.pollInterval??this._options?.defaultTaskPollInterval??1000;await new Promise((H)=>setTimeout(H,$)),J?.signal?.throwIfAborted()}}catch(G){yield{type:"error",error:G instanceof K0?G:new K0(B0.InternalError,String(G))}}}request(Y,X,J){let{relatedRequestId:z,resumptionToken:Q,onresumptiontoken:G,task:Z,relatedTask:$}=J??{};return new Promise((H,W)=>{let K=(F)=>{W(F)};if(!this._transport){K(Error("Not connected"));return}if(this._options?.enforceStrictCapabilities===!0)try{if(this.assertCapabilityForMethod(Y.method),Z)this.assertTaskCapability(Y.method)}catch(F){K(F);return}J?.signal?.throwIfAborted();let U=this._requestMessageId++,B={...Y,jsonrpc:"2.0",id:U};if(J?.onprogress)this._progressHandlers.set(U,J.onprogress),B.params={...Y.params,_meta:{...Y.params?._meta||{},progressToken:U}};if(Z)B.params={...B.params,task:Z};if($)B.params={...B.params,_meta:{...B.params?._meta||{},[K8]:$}};let O=(F)=>{this._responseHandlers.delete(U),this._progressHandlers.delete(U),this._cleanupTimeout(U),this._transport?.send({jsonrpc:"2.0",method:"notifications/cancelled",params:{requestId:U,reason:String(F)}},{relatedRequestId:z,resumptionToken:Q,onresumptiontoken:G}).catch((A)=>this._onerror(Error(`Failed to send cancellation: ${A}`)));let P=F instanceof K0?F:new K0(B0.RequestTimeout,String(F));W(P)};this._responseHandlers.set(U,(F)=>{if(J?.signal?.aborted)return;if(F instanceof Error)return W(F);try{let P=W8(X,F.result);if(!P.success)W(P.error);else H(P.data)}catch(P){W(P)}}),J?.signal?.addEventListener("abort",()=>{O(J?.signal?.reason)});let V=J?.timeout??im,L=()=>O(K0.fromError(B0.RequestTimeout,"Request timed out",{timeout:V}));this._setupTimeout(U,V,J?.maxTotalTimeout,L,J?.resetTimeoutOnProgress??!1);let q=$?.taskId;if(q){let F=(P)=>{let A=this._responseHandlers.get(U);if(A)A(P);else this._onerror(Error(`Response handler missing for side-channeled request ${U}`))};this._requestResolvers.set(U,F),this._enqueueTaskMessage(q,{type:"request",message:B,timestamp:Date.now()}).catch((P)=>{this._cleanupTimeout(U),W(P)})}else this._transport.send(B,{relatedRequestId:z,resumptionToken:Q,onresumptiontoken:G}).catch((F)=>{this._cleanupTimeout(U),W(F)})})}async getTask(Y,X){return this.request({method:"tasks/get",params:Y},c3,X)}async getTaskResult(Y,X,J){return this.request({method:"tasks/result",params:Y},X,J)}async listTasks(Y,X){return this.request({method:"tasks/list",params:Y},i3,X)}async cancelTask(Y,X){return this.request({method:"tasks/cancel",params:Y},qU,X)}async notification(Y,X){if(!this._transport)throw Error("Not connected");this.assertNotificationCapability(Y.method);let J=X?.relatedTask?.taskId;if(J){let Z={...Y,jsonrpc:"2.0",params:{...Y.params,_meta:{...Y.params?._meta||{},[K8]:X.relatedTask}}};await this._enqueueTaskMessage(J,{type:"notification",message:Z,timestamp:Date.now()});return}if((this._options?.debouncedNotificationMethods??[]).includes(Y.method)&&!Y.params&&!X?.relatedRequestId&&!X?.relatedTask){if(this._pendingDebouncedNotifications.has(Y.method))return;this._pendingDebouncedNotifications.add(Y.method),Promise.resolve().then(()=>{if(this._pendingDebouncedNotifications.delete(Y.method),!this._transport)return;let Z={...Y,jsonrpc:"2.0"};if(X?.relatedTask)Z={...Z,params:{...Z.params,_meta:{...Z.params?._meta||{},[K8]:X.relatedTask}}};this._transport?.send(Z,X).catch(($)=>this._onerror($))});return}let G={...Y,jsonrpc:"2.0"};if(X?.relatedTask)G={...G,params:{...G.params,_meta:{...G.params?._meta||{},[K8]:X.relatedTask}}};await this._transport.send(G,X)}setRequestHandler(Y,X){let J=GJ(Y);this.assertRequestHandlerCapability(J),this._requestHandlers.set(J,(z,Q)=>{let G=ZJ(Y,z);return Promise.resolve(X(G,Q))})}removeRequestHandler(Y){this._requestHandlers.delete(Y)}assertCanSetRequestHandler(Y){if(this._requestHandlers.has(Y))throw Error(`A request handler for ${Y} already exists, which would be overridden`)}setNotificationHandler(Y,X){let J=GJ(Y);this._notificationHandlers.set(J,(z)=>{let Q=ZJ(Y,z);return Promise.resolve(X(Q))})}removeNotificationHandler(Y){this._notificationHandlers.delete(Y)}_cleanupTaskProgressHandler(Y){let X=this._taskProgressTokens.get(Y);if(X!==void 0)this._progressHandlers.delete(X),this._taskProgressTokens.delete(Y)}async _enqueueTaskMessage(Y,X,J){if(!this._taskStore||!this._taskMessageQueue)throw Error("Cannot enqueue task message: taskStore and taskMessageQueue are not configured");let z=this._options?.maxTaskQueueSize;await this._taskMessageQueue.enqueue(Y,X,J,z)}async _clearTaskQueue(Y,X){if(this._taskMessageQueue){let J=await this._taskMessageQueue.dequeueAll(Y,X);for(let z of J)if(z.type==="request"&&gX(z.message)){let Q=z.message.id,G=this._requestResolvers.get(Q);if(G)G(new K0(B0.InternalError,"Task cancelled or completed")),this._requestResolvers.delete(Q);else this._onerror(Error(`Resolver missing for request ${Q} during task ${Y} cleanup`))}}}async _waitForTaskUpdate(Y,X){let J=this._options?.defaultTaskPollInterval??1000;try{let z=await this._taskStore?.getTask(Y);if(z?.pollInterval)J=z.pollInterval}catch{}return new Promise((z,Q)=>{if(X.aborted){Q(new K0(B0.InvalidRequest,"Request cancelled"));return}let G=setTimeout(z,J);X.addEventListener("abort",()=>{clearTimeout(G),Q(new K0(B0.InvalidRequest,"Request cancelled"))},{once:!0})})}requestTaskStore(Y,X){let J=this._taskStore;if(!J)throw Error("No task store configured");return{createTask:async(z)=>{if(!Y)throw Error("No request provided");return await J.createTask(z,Y.id,{method:Y.method,params:Y.params},X)},getTask:async(z)=>{let Q=await J.getTask(z,X);if(!Q)throw new K0(B0.InvalidParams,"Failed to retrieve task: Task not found");return Q},storeTaskResult:async(z,Q,G)=>{await J.storeTaskResult(z,Q,G,X);let Z=await J.getTask(z,X);if(Z){let $=b5.parse({method:"notifications/tasks/status",params:Z});if(await this.notification($),U8(Z.status))this._cleanupTaskProgressHandler(z)}},getTaskResult:(z)=>{return J.getTaskResult(z,X)},updateTaskStatus:async(z,Q,G)=>{let Z=await J.getTask(z,X);if(!Z)throw new K0(B0.InvalidParams,`Task "${z}" not found - it may have been cleaned up`);if(U8(Z.status))throw new K0(B0.InvalidParams,`Cannot update task "${z}" from terminal status "${Z.status}" to "${Q}". Terminal states (completed, failed, cancelled) cannot transition to other states.`);await J.updateTaskStatus(z,Q,G,X);let $=await J.getTask(z,X);if($){let H=b5.parse({method:"notifications/tasks/status",params:$});if(await this.notification(H),U8($.status))this._cleanupTaskProgressHandler(z)}},listTasks:(z)=>{return J.listTasks(z,X)}}}}function IU(Y){return Y!==null&&typeof Y==="object"&&!Array.isArray(Y)}function vU(Y,X){let J={...Y};for(let z in X){let Q=z,G=X[Q];if(G===void 0)continue;let Z=J[Q];if(IU(Z)&&IU(G))J[Q]={...Z,...G};else J[Q]=G}return J}var zM=u4(Xz(),1),QM=u4(JM(),1);function Jo(){let Y=new zM.default({strict:!1,validateFormats:!0,validateSchema:!1,allErrors:!0});return QM.default(Y),Y}class Uz{constructor(Y){this._ajv=Y??Jo()}getValidator(Y){let X="$id"in Y&&typeof Y.$id==="string"?this._ajv.getSchema(Y.$id)??this._ajv.compile(Y):this._ajv.compile(Y);return(J)=>{if(X(J))return{valid:!0,data:J,errorMessage:void 0};else return{valid:!1,data:void 0,errorMessage:this._ajv.errorsText(X.errors)}}}}class Bz{constructor(Y){this._server=Y}requestStream(Y,X,J){return this._server.requestStream(Y,X,J)}async getTask(Y,X){return this._server.getTask({taskId:Y},X)}async getTaskResult(Y,X,J){return this._server.getTaskResult({taskId:Y},X,J)}async listTasks(Y,X){return this._server.listTasks(Y?{cursor:Y}:void 0,X)}async cancelTask(Y,X){return this._server.cancelTask({taskId:Y},X)}}function GM(Y,X,J){if(!Y)throw Error(`${J} does not support task creation (required for ${X})`);switch(X){case"tools/call":if(!Y.tools?.call)throw Error(`${J} does not support task creation for tools/call (required for ${X})`);break;default:break}}function ZM(Y,X,J){if(!Y)throw Error(`${J} does not support task creation (required for ${X})`);switch(X){case"sampling/createMessage":if(!Y.sampling?.createMessage)throw Error(`${J} does not support task creation for sampling/createMessage (required for ${X})`);break;case"elicitation/create":if(!Y.elicitation?.create)throw Error(`${J} does not support task creation for elicitation/create (required for ${X})`);break;default:break}}class Vz extends $J{constructor(Y,X){super(X);if(this._serverInfo=Y,this._loggingLevels=new Map,this.LOG_LEVEL_SEVERITY=new Map(y5.options.map((J,z)=>[J,z])),this.isMessageIgnored=(J,z)=>{let Q=this._loggingLevels.get(z);return Q?this.LOG_LEVEL_SEVERITY.get(J)<this.LOG_LEVEL_SEVERITY.get(Q):!1},this._capabilities=X?.capabilities??{},this._instructions=X?.instructions,this._jsonSchemaValidator=X?.jsonSchemaValidator??new Uz,this.setRequestHandler(dX,(J)=>this._oninitialize(J)),this.setNotificationHandler(lX,()=>this.oninitialized?.()),this._capabilities.logging)this.setRequestHandler(XJ,async(J,z)=>{let Q=z.sessionId||z.requestInfo?.headers["mcp-session-id"]||void 0,{level:G}=J.params,Z=y5.safeParse(G);if(Z.success)this._loggingLevels.set(Q,Z.data);return{}})}get experimental(){if(!this._experimental)this._experimental={tasks:new Bz(this)};return this._experimental}registerCapabilities(Y){if(this.transport)throw Error("Cannot register capabilities after connecting to transport");this._capabilities=vU(this._capabilities,Y)}setRequestHandler(Y,X){let z=k3(Y)?.method;if(!z)throw Error("Schema is missing a method literal");let Q;if(N6(z)){let Z=z;Q=Z._zod?.def?.value??Z.value}else{let Z=z;Q=Z._def?.value??Z.value}if(typeof Q!=="string")throw Error("Schema method literal must be a string");if(Q==="tools/call"){let Z=async($,H)=>{let W=W8(f5,$);if(!W.success){let O=W.error instanceof Error?W.error.message:String(W.error);throw new K0(B0.InvalidParams,`Invalid tools/call request: ${O}`)}let{params:K}=W.data,U=await Promise.resolve(X($,H));if(K.task){let O=W8(x6,U);if(!O.success){let V=O.error instanceof Error?O.error.message:String(O.error);throw new K0(B0.InvalidParams,`Invalid task creation result: ${V}`)}return O.data}let B=W8(o3,U);if(!B.success){let O=B.error instanceof Error?B.error.message:String(B.error);throw new K0(B0.InvalidParams,`Invalid tools/call result: ${O}`)}return B.data};return super.setRequestHandler(Y,Z)}return super.setRequestHandler(Y,X)}assertCapabilityForMethod(Y){switch(Y){case"sampling/createMessage":if(!this._clientCapabilities?.sampling)throw Error(`Client does not support sampling (required for ${Y})`);break;case"elicitation/create":if(!this._clientCapabilities?.elicitation)throw Error(`Client does not support elicitation (required for ${Y})`);break;case"roots/list":if(!this._clientCapabilities?.roots)throw Error(`Client does not support listing roots (required for ${Y})`);break;case"ping":break}}assertNotificationCapability(Y){switch(Y){case"notifications/message":if(!this._capabilities.logging)throw Error(`Server does not support logging (required for ${Y})`);break;case"notifications/resources/updated":case"notifications/resources/list_changed":if(!this._capabilities.resources)throw Error(`Server does not support notifying about resources (required for ${Y})`);break;case"notifications/tools/list_changed":if(!this._capabilities.tools)throw Error(`Server does not support notifying of tool list changes (required for ${Y})`);break;case"notifications/prompts/list_changed":if(!this._capabilities.prompts)throw Error(`Server does not support notifying of prompt list changes (required for ${Y})`);break;case"notifications/elicitation/complete":if(!this._clientCapabilities?.elicitation?.url)throw Error(`Client does not support URL elicitation (required for ${Y})`);break;case"notifications/cancelled":break;case"notifications/progress":break}}assertRequestHandlerCapability(Y){if(!this._capabilities)return;switch(Y){case"completion/complete":if(!this._capabilities.completions)throw Error(`Server does not support completions (required for ${Y})`);break;case"logging/setLevel":if(!this._capabilities.logging)throw Error(`Server does not support logging (required for ${Y})`);break;case"prompts/get":case"prompts/list":if(!this._capabilities.prompts)throw Error(`Server does not support prompts (required for ${Y})`);break;case"resources/list":case"resources/templates/list":case"resources/read":if(!this._capabilities.resources)throw Error(`Server does not support resources (required for ${Y})`);break;case"tools/call":case"tools/list":if(!this._capabilities.tools)throw Error(`Server does not support tools (required for ${Y})`);break;case"tasks/get":case"tasks/list":case"tasks/result":case"tasks/cancel":if(!this._capabilities.tasks)throw Error(`Server does not support tasks capability (required for ${Y})`);break;case"ping":case"initialize":break}}assertTaskCapability(Y){ZM(this._clientCapabilities?.tasks?.requests,Y,"Client")}assertTaskHandlerCapability(Y){if(!this._capabilities)return;GM(this._capabilities.tasks?.requests,Y,"Server")}async _oninitialize(Y){let X=Y.params.protocolVersion;return this._clientCapabilities=Y.params.capabilities,this._clientVersion=Y.params.clientInfo,{protocolVersion:HU.includes(X)?X:mX,capabilities:this.getCapabilities(),serverInfo:this._serverInfo,...this._instructions&&{instructions:this._instructions}}}getClientCapabilities(){return this._clientCapabilities}getClientVersion(){return this._clientVersion}getCapabilities(){return this._capabilities}async ping(){return this.request({method:"ping"},h3)}async createMessage(Y,X){if(Y.tools||Y.toolChoice){if(!this._clientCapabilities?.sampling?.tools)throw Error("Client does not support sampling tools capability.")}if(Y.messages.length>0){let J=Y.messages[Y.messages.length-1],z=Array.isArray(J.content)?J.content:[J.content],Q=z.some((H)=>H.type==="tool_result"),G=Y.messages.length>1?Y.messages[Y.messages.length-2]:void 0,Z=G?Array.isArray(G.content)?G.content:[G.content]:[],$=Z.some((H)=>H.type==="tool_use");if(Q){if(z.some((H)=>H.type!=="tool_result"))throw Error("The last message must contain only tool_result content if any is present");if(!$)throw Error("tool_result blocks are not matching any tool_use from the previous message")}if($){let H=new Set(Z.filter((K)=>K.type==="tool_use").map((K)=>K.id)),W=new Set(z.filter((K)=>K.type==="tool_result").map((K)=>K.toolUseId));if(H.size!==W.size||![...H].every((K)=>W.has(K)))throw Error("ids of tool_result blocks and tool_use blocks from previous message do not match")}}if(Y.tools)return this.request({method:"sampling/createMessage",params:Y},zJ,X);return this.request({method:"sampling/createMessage",params:Y},JJ,X)}async elicitInput(Y,X){switch(Y.mode??"form"){case"url":{if(!this._clientCapabilities?.elicitation?.url)throw Error("Client does not support url elicitation.");let z=Y;return this.request({method:"elicitation/create",params:z},a3,X)}case"form":{if(!this._clientCapabilities?.elicitation?.form)throw Error("Client does not support form elicitation.");let z=Y.mode==="form"?Y:{...Y,mode:"form"},Q=await this.request({method:"elicitation/create",params:z},a3,X);if(Q.action==="accept"&&Q.content&&z.requestedSchema)try{let Z=this._jsonSchemaValidator.getValidator(z.requestedSchema)(Q.content);if(!Z.valid)throw new K0(B0.InvalidParams,`Elicitation response content does not match requested schema: ${Z.errorMessage}`)}catch(G){if(G instanceof K0)throw G;throw new K0(B0.InternalError,`Error validating elicitation response: ${G instanceof Error?G.message:String(G)}`)}return Q}}}createElicitationCompletionNotifier(Y,X){if(!this._clientCapabilities?.elicitation?.url)throw Error("Client does not support URL elicitation (required for notifications/elicitation/complete)");return()=>this.notification({method:"notifications/elicitation/complete",params:{elicitationId:Y}},X)}async listRoots(Y,X){return this.request({method:"roots/list",params:Y},QJ,X)}async sendLoggingMessage(Y,X){if(this._capabilities.logging){if(!this.isMessageIgnored(Y.level,X))return this.notification({method:"notifications/message",params:Y})}}async sendResourceUpdated(Y){return this.notification({method:"notifications/resources/updated",params:Y})}async sendResourceListChanged(){return this.notification({method:"notifications/resources/list_changed"})}async sendToolListChanged(){return this.notification({method:"notifications/tools/list_changed"})}async sendPromptListChanged(){return this.notification({method:"notifications/prompts/list_changed"})}}import HM from"node:process";class Oz{append(Y){this._buffer=this._buffer?Buffer.concat([this._buffer,Y]):Y}readMessage(){if(!this._buffer)return null;let Y=this._buffer.indexOf(`
`);if(Y===-1)return null;let X=this._buffer.toString("utf8",0,Y).replace(/\r$/,"");return this._buffer=this._buffer.subarray(Y+1),zo(X)}clear(){this._buffer=void 0}}function zo(Y){return LU.parse(JSON.parse(Y))}function $M(Y){return JSON.stringify(Y)+`
`}class Mz{constructor(Y=HM.stdin,X=HM.stdout){this._stdin=Y,this._stdout=X,this._readBuffer=new Oz,this._started=!1,this._ondata=(J)=>{this._readBuffer.append(J),this.processReadBuffer()},this._onerror=(J)=>{this.onerror?.(J)}}async start(){if(this._started)throw Error("StdioServerTransport already started! If using Server class, note that connect() calls start() automatically.");this._started=!0,this._stdin.on("data",this._ondata),this._stdin.on("error",this._onerror)}processReadBuffer(){while(!0)try{let Y=this._readBuffer.readMessage();if(Y===null)break;this.onmessage?.(Y)}catch(Y){this.onerror?.(Y)}}async close(){if(this._stdin.off("data",this._ondata),this._stdin.off("error",this._onerror),this._stdin.listenerCount("data")===0)this._stdin.pause();this._readBuffer.clear(),this.onclose?.()}send(Y){return new Promise((X)=>{let J=$M(Y);if(this._stdout.write(J))X();else this._stdout.once("drain",X)})}}import*as U5 from"fs";import*as k8 from"path";import*as U6 from"os";import FX0 from"https";import PX0 from"http";import*as e8 from"fs/promises";import*as r6 from"path";import{fileURLToPath as o40}from"url";import{dirname as a40}from"path";var WM=process.env.SNOW_MCP_DEBUG==="true";function S(...Y){if(WM)console.error(...Y)}function KM(...Y){if(WM)console.warn(...Y)}var EQ={};G0(EQ,{snow_search_artifacts_exec:()=>CQ,snow_search_artifacts_def:()=>KY,snow_record_manage_exec:()=>dq,snow_record_manage_def:()=>cq,snow_query_table_exec:()=>oq,snow_query_table_def:()=>nq,snow_predictive_analysis_exec:()=>Bx,snow_predictive_analysis_def:()=>Ux,snow_pattern_analysis_exec:()=>Kx,snow_pattern_analysis_def:()=>Wx,snow_operational_metrics_exec:()=>Hx,snow_operational_metrics_def:()=>$x,snow_manage_group_membership_exec:()=>Ix,snow_manage_group_membership_def:()=>Tx,snow_get_by_sysid_exec:()=>tq,snow_get_by_sysid_def:()=>rq,snow_discover_table_fields_exec:()=>sq,snow_discover_table_fields_def:()=>aq,snow_comprehensive_search_exec:()=>CQ,snow_comprehensive_search_def:()=>eq,snow_cmdb_search_exec:()=>Ox,snow_cmdb_search_def:()=>Vx,snow_cleanup_test_artifacts_exec:()=>Fx,snow_cleanup_test_artifacts_def:()=>xx,snow_catalog_item_search_exec:()=>qx,snow_catalog_item_search_def:()=>Nx,snow_catalog_item_manager_exec:()=>Lx,snow_catalog_item_manager_def:()=>Mx,snow_auto_resolve_incident_exec:()=>Zx,snow_auto_resolve_incident_def:()=>Gx,snow_attach_file_exec:()=>Jx,snow_attach_file_def:()=>Xx,snow_assign_task_exec:()=>Ax,snow_assign_task_def:()=>Px,snow_analyze_incident_exec:()=>Qx,snow_analyze_incident_def:()=>zx});function H7(Y,X){return function(){return Y.apply(X,arguments)}}var{toString:Qo}=Object.prototype,{getPrototypeOf:Nz}=Object,{iterator:R9,toStringTag:BM}=Symbol,f9=((Y)=>(X)=>{let J=Qo.call(X);return Y[J]||(Y[J]=J.slice(8,-1).toLowerCase())})(Object.create(null)),M4=(Y)=>{return Y=Y.toLowerCase(),(X)=>f9(X)===Y},y9=(Y)=>(X)=>typeof X===Y,{isArray:_6}=Array,k6=y9("undefined");function W7(Y){return Y!==null&&!k6(Y)&&Y.constructor!==null&&!k6(Y.constructor)&&y1(Y.constructor.isBuffer)&&Y.constructor.isBuffer(Y)}var VM=M4("ArrayBuffer");function Go(Y){let X;if(typeof ArrayBuffer<"u"&&ArrayBuffer.isView)X=ArrayBuffer.isView(Y);else X=Y&&Y.buffer&&VM(Y.buffer);return X}var Zo=y9("string"),y1=y9("function"),OM=y9("number"),K7=(Y)=>Y!==null&&typeof Y==="object",$o=(Y)=>Y===!0||Y===!1,b9=(Y)=>{if(f9(Y)!=="object")return!1;let X=Nz(Y);return(X===null||X===Object.prototype||Object.getPrototypeOf(X)===null)&&!(BM in Y)&&!(R9 in Y)},Ho=(Y)=>{if(!K7(Y)||W7(Y))return!1;try{return Object.keys(Y).length===0&&Object.getPrototypeOf(Y)===Object.prototype}catch(X){return!1}},Wo=M4("Date"),Ko=M4("File"),Uo=M4("Blob"),Bo=M4("FileList"),Vo=(Y)=>K7(Y)&&y1(Y.pipe),Oo=(Y)=>{let X;return Y&&(typeof FormData==="function"&&Y instanceof FormData||y1(Y.append)&&((X=f9(Y))==="formdata"||X==="object"&&y1(Y.toString)&&Y.toString()==="[object FormData]"))},Mo=M4("URLSearchParams"),[Lo,No,qo,xo]=["ReadableStream","Request","Response","Headers"].map(M4),Fo=(Y)=>Y.trim?Y.trim():Y.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function U7(Y,X,{allOwnKeys:J=!1}={}){if(Y===null||typeof Y>"u")return;let z,Q;if(typeof Y!=="object")Y=[Y];if(_6(Y))for(z=0,Q=Y.length;z<Q;z++)X.call(null,Y[z],z,Y);else{if(W7(Y))return;let G=J?Object.getOwnPropertyNames(Y):Object.keys(Y),Z=G.length,$;for(z=0;z<Z;z++)$=G[z],X.call(null,Y[$],$,Y)}}function MM(Y,X){if(W7(Y))return null;X=X.toLowerCase();let J=Object.keys(Y),z=J.length,Q;while(z-- >0)if(Q=J[z],X===Q.toLowerCase())return Q;return null}var g8=(()=>{if(typeof globalThis<"u")return globalThis;return typeof self<"u"?self:typeof window<"u"?window:global})(),LM=(Y)=>!k6(Y)&&Y!==g8;function Lz(){let{caseless:Y,skipUndefined:X}=LM(this)&&this||{},J={},z=(Q,G)=>{let Z=Y&&MM(J,G)||G;if(b9(J[Z])&&b9(Q))J[Z]=Lz(J[Z],Q);else if(b9(Q))J[Z]=Lz({},Q);else if(_6(Q))J[Z]=Q.slice();else if(!X||!k6(Q))J[Z]=Q};for(let Q=0,G=arguments.length;Q<G;Q++)arguments[Q]&&U7(arguments[Q],z);return J}var Po=(Y,X,J,{allOwnKeys:z}={})=>{return U7(X,(Q,G)=>{if(J&&y1(Q))Object.defineProperty(Y,G,{value:H7(Q,J),writable:!0,enumerable:!0,configurable:!0});else Object.defineProperty(Y,G,{value:Q,writable:!0,enumerable:!0,configurable:!0})},{allOwnKeys:z}),Y},Ao=(Y)=>{if(Y.charCodeAt(0)===65279)Y=Y.slice(1);return Y},wo=(Y,X,J,z)=>{Y.prototype=Object.create(X.prototype,z),Object.defineProperty(Y.prototype,"constructor",{value:Y,writable:!0,enumerable:!1,configurable:!0}),Object.defineProperty(Y,"super",{value:X.prototype}),J&&Object.assign(Y.prototype,J)},To=(Y,X,J,z)=>{let Q,G,Z,$={};if(X=X||{},Y==null)return X;do{Q=Object.getOwnPropertyNames(Y),G=Q.length;while(G-- >0)if(Z=Q[G],(!z||z(Z,Y,X))&&!$[Z])X[Z]=Y[Z],$[Z]=!0;Y=J!==!1&&Nz(Y)}while(Y&&(!J||J(Y,X))&&Y!==Object.prototype);return X},Io=(Y,X,J)=>{if(Y=String(Y),J===void 0||J>Y.length)J=Y.length;J-=X.length;let z=Y.indexOf(X,J);return z!==-1&&z===J},vo=(Y)=>{if(!Y)return null;if(_6(Y))return Y;let X=Y.length;if(!OM(X))return null;let J=Array(X);while(X-- >0)J[X]=Y[X];return J},Do=((Y)=>{return(X)=>{return Y&&X instanceof Y}})(typeof Uint8Array<"u"&&Nz(Uint8Array)),jo=(Y,X)=>{let z=(Y&&Y[R9]).call(Y),Q;while((Q=z.next())&&!Q.done){let G=Q.value;X.call(Y,G[0],G[1])}},Co=(Y,X)=>{let J,z=[];while((J=Y.exec(X))!==null)z.push(J);return z},Eo=M4("HTMLFormElement"),So=(Y)=>{return Y.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(J,z,Q){return z.toUpperCase()+Q})},UM=(({hasOwnProperty:Y})=>(X,J)=>Y.call(X,J))(Object.prototype),ko=M4("RegExp"),NM=(Y,X)=>{let J=Object.getOwnPropertyDescriptors(Y),z={};U7(J,(Q,G)=>{let Z;if((Z=X(Q,G,Y))!==!1)z[G]=Z||Q}),Object.defineProperties(Y,z)},_o=(Y)=>{NM(Y,(X,J)=>{if(y1(Y)&&["arguments","caller","callee"].indexOf(J)!==-1)return!1;let z=Y[J];if(!y1(z))return;if(X.enumerable=!1,"writable"in X){X.writable=!1;return}if(!X.set)X.set=()=>{throw Error("Can not rewrite read-only method '"+J+"'")}})},bo=(Y,X)=>{let J={},z=(Q)=>{Q.forEach((G)=>{J[G]=!0})};return _6(Y)?z(Y):z(String(Y).split(X)),J},Ro=()=>{},fo=(Y,X)=>{return Y!=null&&Number.isFinite(Y=+Y)?Y:X};function yo(Y){return!!(Y&&y1(Y.append)&&Y[BM]==="FormData"&&Y[R9])}var ho=(Y)=>{let X=[,,,,,,,,,,],J=(z,Q)=>{if(K7(z)){if(X.indexOf(z)>=0)return;if(W7(z))return z;if(!("toJSON"in z)){X[Q]=z;let G=_6(z)?[]:{};return U7(z,(Z,$)=>{let H=J(Z,Q+1);!k6(H)&&(G[$]=H)}),X[Q]=void 0,G}}return z};return J(Y,0)},mo=M4("AsyncFunction"),uo=(Y)=>Y&&(K7(Y)||y1(Y))&&y1(Y.then)&&y1(Y.catch),qM=((Y,X)=>{if(Y)return setImmediate;return X?((J,z)=>{return g8.addEventListener("message",({source:Q,data:G})=>{if(Q===g8&&G===J)z.length&&z.shift()()},!1),(Q)=>{z.push(Q),g8.postMessage(J,"*")}})(`axios@${Math.random()}`,[]):(J)=>setTimeout(J)})(typeof setImmediate==="function",y1(g8.postMessage)),go=typeof queueMicrotask<"u"?queueMicrotask.bind(g8):typeof process<"u"&&process.nextTick||qM,po=(Y)=>Y!=null&&y1(Y[R9]),k={isArray:_6,isArrayBuffer:VM,isBuffer:W7,isFormData:Oo,isArrayBufferView:Go,isString:Zo,isNumber:OM,isBoolean:$o,isObject:K7,isPlainObject:b9,isEmptyObject:Ho,isReadableStream:Lo,isRequest:No,isResponse:qo,isHeaders:xo,isUndefined:k6,isDate:Wo,isFile:Ko,isBlob:Uo,isRegExp:ko,isFunction:y1,isStream:Vo,isURLSearchParams:Mo,isTypedArray:Do,isFileList:Bo,forEach:U7,merge:Lz,extend:Po,trim:Fo,stripBOM:Ao,inherits:wo,toFlatObject:To,kindOf:f9,kindOfTest:M4,endsWith:Io,toArray:vo,forEachEntry:jo,matchAll:Co,isHTMLForm:Eo,hasOwnProperty:UM,hasOwnProp:UM,reduceDescriptors:NM,freezeMethods:_o,toObjectSet:bo,toCamelCase:So,noop:Ro,toFiniteNumber:fo,findKey:MM,global:g8,isContextDefined:LM,isSpecCompliantForm:yo,toJSONObject:ho,isAsyncFn:mo,isThenable:uo,setImmediate:qM,asap:go,isIterable:po};class C1 extends Error{static from(Y,X,J,z,Q,G){let Z=new C1(Y.message,X||Y.code,J,z,Q);return Z.cause=Y,Z.name=Y.name,G&&Object.assign(Z,G),Z}constructor(Y,X,J,z,Q){super(Y);if(this.name="AxiosError",this.isAxiosError=!0,X&&(this.code=X),J&&(this.config=J),z&&(this.request=z),Q)this.response=Q,this.status=Q.status}toJSON(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:k.toJSONObject(this.config),code:this.code,status:this.status}}}C1.ERR_BAD_OPTION_VALUE="ERR_BAD_OPTION_VALUE";C1.ERR_BAD_OPTION="ERR_BAD_OPTION";C1.ECONNABORTED="ECONNABORTED";C1.ETIMEDOUT="ETIMEDOUT";C1.ERR_NETWORK="ERR_NETWORK";C1.ERR_FR_TOO_MANY_REDIRECTS="ERR_FR_TOO_MANY_REDIRECTS";C1.ERR_DEPRECATED="ERR_DEPRECATED";C1.ERR_BAD_RESPONSE="ERR_BAD_RESPONSE";C1.ERR_BAD_REQUEST="ERR_BAD_REQUEST";C1.ERR_CANCELED="ERR_CANCELED";C1.ERR_NOT_SUPPORT="ERR_NOT_SUPPORT";C1.ERR_INVALID_URL="ERR_INVALID_URL";var t=C1;var FN=u4(uz(),1),o9=FN.default;function gz(Y){return k.isPlainObject(Y)||k.isArray(Y)}function AN(Y){return k.endsWith(Y,"[]")?Y.slice(0,-2):Y}function PN(Y,X,J){if(!Y)return X;return Y.concat(X).map(function(Q,G){return Q=AN(Q),!J&&G?"["+Q+"]":Q}).join(J?".":"")}function ks(Y){return k.isArray(Y)&&!Y.some(gz)}var _s=k.toFlatObject(k,{},null,function(X){return/^is[A-Z]/.test(X)});function bs(Y,X,J){if(!k.isObject(Y))throw TypeError("target must be an object");X=X||new(o9||FormData),J=k.toFlatObject(J,{metaTokens:!0,dots:!1,indexes:!1},!1,function(L,q){return!k.isUndefined(q[L])});let z=J.metaTokens,Q=J.visitor||K,G=J.dots,Z=J.indexes,H=(J.Blob||typeof Blob<"u"&&Blob)&&k.isSpecCompliantForm(X);if(!k.isFunction(Q))throw TypeError("visitor must be a function");function W(V){if(V===null)return"";if(k.isDate(V))return V.toISOString();if(k.isBoolean(V))return V.toString();if(!H&&k.isBlob(V))throw new t("Blob is not supported. Use a Buffer instead.");if(k.isArrayBuffer(V)||k.isTypedArray(V))return H&&typeof Blob==="function"?new Blob([V]):Buffer.from(V);return V}function K(V,L,q){let F=V;if(V&&!q&&typeof V==="object"){if(k.endsWith(L,"{}"))L=z?L:L.slice(0,-2),V=JSON.stringify(V);else if(k.isArray(V)&&ks(V)||(k.isFileList(V)||k.endsWith(L,"[]"))&&(F=k.toArray(V)))return L=AN(L),F.forEach(function(A,w){!(k.isUndefined(A)||A===null)&&X.append(Z===!0?PN([L],w,G):Z===null?L:L+"[]",W(A))}),!1}if(gz(V))return!0;return X.append(PN(q,L,G),W(V)),!1}let U=[],B=Object.assign(_s,{defaultVisitor:K,convertValue:W,isVisitable:gz});function O(V,L){if(k.isUndefined(V))return;if(U.indexOf(V)!==-1)throw Error("Circular reference detected in "+L.join("."));U.push(V),k.forEach(V,function(F,P){if((!(k.isUndefined(F)||F===null)&&Q.call(X,F,k.isString(P)?P.trim():P,L,B))===!0)O(F,L?L.concat(P):[P])}),U.pop()}if(!k.isObject(Y))throw TypeError("data must be an object");return O(Y),X}var F8=bs;function wN(Y){let X={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\x00"};return encodeURIComponent(Y).replace(/[!'()~]|%20|%00/g,function(z){return X[z]})}function TN(Y,X){this._pairs=[],Y&&F8(Y,this,X)}var IN=TN.prototype;IN.append=function(X,J){this._pairs.push([X,J])};IN.toString=function(X){let J=X?function(z){return X.call(this,z,wN)}:wN;return this._pairs.map(function(Q){return J(Q[0])+"="+J(Q[1])},"").join("&")};var vN=TN;function Rs(Y){return encodeURIComponent(Y).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+")}function c8(Y,X,J){if(!X)return Y;let z=J&&J.encode||Rs,Q=k.isFunction(J)?{serialize:J}:J,G=Q&&Q.serialize,Z;if(G)Z=G(X,Q);else Z=k.isURLSearchParams(X)?X.toString():new vN(X,Q).toString(z);if(Z){let $=Y.indexOf("#");if($!==-1)Y=Y.slice(0,$);Y+=(Y.indexOf("?")===-1?"?":"&")+Z}return Y}class DN{constructor(){this.handlers=[]}use(Y,X,J){return this.handlers.push({fulfilled:Y,rejected:X,synchronous:J?J.synchronous:!1,runWhen:J?J.runWhen:null}),this.handlers.length-1}eject(Y){if(this.handlers[Y])this.handlers[Y]=null}clear(){if(this.handlers)this.handlers=[]}forEach(Y){k.forEach(this.handlers,function(J){if(J!==null)Y(J)})}}var pz=DN;var h6={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1};import ys from"crypto";import fs from"url";var jN=fs.URLSearchParams;var cz="abcdefghijklmnopqrstuvwxyz",CN="0123456789",EN={DIGIT:CN,ALPHA:cz,ALPHA_DIGIT:cz+cz.toUpperCase()+CN},hs=(Y=16,X=EN.ALPHA_DIGIT)=>{let J="",{length:z}=X,Q=new Uint32Array(Y);ys.randomFillSync(Q);for(let G=0;G<Y;G++)J+=X[Q[G]%z];return J},SN={isNode:!0,classes:{URLSearchParams:jN,FormData:o9,Blob:typeof Blob<"u"&&Blob||null},ALPHABET:EN,generateString:hs,protocols:["http","https","file","data"]};var iz={};G0(iz,{origin:()=>gs,navigator:()=>dz,hasStandardBrowserWebWorkerEnv:()=>us,hasStandardBrowserEnv:()=>ms,hasBrowserEnv:()=>lz});var lz=typeof window<"u"&&typeof document<"u",dz=typeof navigator==="object"&&navigator||void 0,ms=lz&&(!dz||["ReactNative","NativeScript","NS"].indexOf(dz.product)<0),us=(()=>{return typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts==="function"})(),gs=lz&&window.location.href||"http://localhost";var _0={...iz,...SN};function nz(Y,X){return F8(Y,new _0.classes.URLSearchParams,{visitor:function(J,z,Q,G){if(_0.isNode&&k.isBuffer(J))return this.append(z,J.toString("base64")),!1;return G.defaultVisitor.apply(this,arguments)},...X})}function ps(Y){return k.matchAll(/\w+|\[(\w*)]/g,Y).map((X)=>{return X[0]==="[]"?"":X[1]||X[0]})}function cs(Y){let X={},J=Object.keys(Y),z,Q=J.length,G;for(z=0;z<Q;z++)G=J[z],X[G]=Y[G];return X}function ds(Y){function X(J,z,Q,G){let Z=J[G++];if(Z==="__proto__")return!0;let $=Number.isFinite(+Z),H=G>=J.length;if(Z=!Z&&k.isArray(Q)?Q.length:Z,H){if(k.hasOwnProp(Q,Z))Q[Z]=[Q[Z],z];else Q[Z]=z;return!$}if(!Q[Z]||!k.isObject(Q[Z]))Q[Z]=[];if(X(J,z,Q[Z],G)&&k.isArray(Q[Z]))Q[Z]=cs(Q[Z]);return!$}if(k.isFormData(Y)&&k.isFunction(Y.entries)){let J={};return k.forEachEntry(Y,(z,Q)=>{X(ps(z),Q,J,0)}),J}return null}var a9=ds;function ls(Y,X,J){if(k.isString(Y))try{return(X||JSON.parse)(Y),k.trim(Y)}catch(z){if(z.name!=="SyntaxError")throw z}return(J||JSON.stringify)(Y)}var oz={transitional:h6,adapter:["xhr","http","fetch"],transformRequest:[function(X,J){let z=J.getContentType()||"",Q=z.indexOf("application/json")>-1,G=k.isObject(X);if(G&&k.isHTMLForm(X))X=new FormData(X);if(k.isFormData(X))return Q?JSON.stringify(a9(X)):X;if(k.isArrayBuffer(X)||k.isBuffer(X)||k.isStream(X)||k.isFile(X)||k.isBlob(X)||k.isReadableStream(X))return X;if(k.isArrayBufferView(X))return X.buffer;if(k.isURLSearchParams(X))return J.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),X.toString();let $;if(G){if(z.indexOf("application/x-www-form-urlencoded")>-1)return nz(X,this.formSerializer).toString();if(($=k.isFileList(X))||z.indexOf("multipart/form-data")>-1){let H=this.env&&this.env.FormData;return F8($?{"files[]":X}:X,H&&new H,this.formSerializer)}}if(G||Q)return J.setContentType("application/json",!1),ls(X);return X}],transformResponse:[function(X){let J=this.transitional||oz.transitional,z=J&&J.forcedJSONParsing,Q=this.responseType==="json";if(k.isResponse(X)||k.isReadableStream(X))return X;if(X&&k.isString(X)&&(z&&!this.responseType||Q)){let Z=!(J&&J.silentJSONParsing)&&Q;try{return JSON.parse(X,this.parseReviver)}catch($){if(Z){if($.name==="SyntaxError")throw t.from($,t.ERR_BAD_RESPONSE,this,null,this.response);throw $}}}return X}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:_0.classes.FormData,Blob:_0.classes.Blob},validateStatus:function(X){return X>=200&&X<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};k.forEach(["delete","get","head","post","put","patch"],(Y)=>{oz.headers[Y]={}});var m6=oz;var is=k.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),kN=(Y)=>{let X={},J,z,Q;return Y&&Y.split(`
`).forEach(function(Z){if(Q=Z.indexOf(":"),J=Z.substring(0,Q).trim().toLowerCase(),z=Z.substring(Q+1).trim(),!J||X[J]&&is[J])return;if(J==="set-cookie")if(X[J])X[J].push(z);else X[J]=[z];else X[J]=X[J]?X[J]+", "+z:z}),X};var _N=Symbol("internals");function L7(Y){return Y&&String(Y).trim().toLowerCase()}function s9(Y){if(Y===!1||Y==null)return Y;return k.isArray(Y)?Y.map(s9):String(Y)}function ns(Y){let X=Object.create(null),J=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g,z;while(z=J.exec(Y))X[z[1]]=z[2];return X}var os=(Y)=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(Y.trim());function az(Y,X,J,z,Q){if(k.isFunction(z))return z.call(this,X,J);if(Q)X=J;if(!k.isString(X))return;if(k.isString(z))return X.indexOf(z)!==-1;if(k.isRegExp(z))return z.test(X)}function as(Y){return Y.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(X,J,z)=>{return J.toUpperCase()+z})}function ss(Y,X){let J=k.toCamelCase(" "+X);["get","set","has"].forEach((z)=>{Object.defineProperty(Y,z+J,{value:function(Q,G,Z){return this[z].call(this,X,Q,G,Z)},configurable:!0})})}class N7{constructor(Y){Y&&this.set(Y)}set(Y,X,J){let z=this;function Q(Z,$,H){let W=L7($);if(!W)throw Error("header name must be a non-empty string");let K=k.findKey(z,W);if(!K||z[K]===void 0||H===!0||H===void 0&&z[K]!==!1)z[K||$]=s9(Z)}let G=(Z,$)=>k.forEach(Z,(H,W)=>Q(H,W,$));if(k.isPlainObject(Y)||Y instanceof this.constructor)G(Y,X);else if(k.isString(Y)&&(Y=Y.trim())&&!os(Y))G(kN(Y),X);else if(k.isObject(Y)&&k.isIterable(Y)){let Z={},$,H;for(let W of Y){if(!k.isArray(W))throw TypeError("Object iterator must return a key-value pair");Z[H=W[0]]=($=Z[H])?k.isArray($)?[...$,W[1]]:[$,W[1]]:W[1]}G(Z,X)}else Y!=null&&Q(X,Y,J);return this}get(Y,X){if(Y=L7(Y),Y){let J=k.findKey(this,Y);if(J){let z=this[J];if(!X)return z;if(X===!0)return ns(z);if(k.isFunction(X))return X.call(this,z,J);if(k.isRegExp(X))return X.exec(z);throw TypeError("parser must be boolean|regexp|function")}}}has(Y,X){if(Y=L7(Y),Y){let J=k.findKey(this,Y);return!!(J&&this[J]!==void 0&&(!X||az(this,this[J],J,X)))}return!1}delete(Y,X){let J=this,z=!1;function Q(G){if(G=L7(G),G){let Z=k.findKey(J,G);if(Z&&(!X||az(J,J[Z],Z,X)))delete J[Z],z=!0}}if(k.isArray(Y))Y.forEach(Q);else Q(Y);return z}clear(Y){let X=Object.keys(this),J=X.length,z=!1;while(J--){let Q=X[J];if(!Y||az(this,this[Q],Q,Y,!0))delete this[Q],z=!0}return z}normalize(Y){let X=this,J={};return k.forEach(this,(z,Q)=>{let G=k.findKey(J,Q);if(G){X[G]=s9(z),delete X[Q];return}let Z=Y?as(Q):String(Q).trim();if(Z!==Q)delete X[Q];X[Z]=s9(z),J[Z]=!0}),this}concat(...Y){return this.constructor.concat(this,...Y)}toJSON(Y){let X=Object.create(null);return k.forEach(this,(J,z)=>{J!=null&&J!==!1&&(X[z]=Y&&k.isArray(J)?J.join(", "):J)}),X}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([Y,X])=>Y+": "+X).join(`
`)}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(Y){return Y instanceof this?Y:new this(Y)}static concat(Y,...X){let J=new this(Y);return X.forEach((z)=>J.set(z)),J}static accessor(Y){let J=(this[_N]=this[_N]={accessors:{}}).accessors,z=this.prototype;function Q(G){let Z=L7(G);if(!J[Z])ss(z,G),J[Z]=!0}return k.isArray(Y)?Y.forEach(Q):Q(Y),this}}N7.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);k.reduceDescriptors(N7.prototype,({value:Y},X)=>{let J=X[0].toUpperCase()+X.slice(1);return{get:()=>Y,set(z){this[J]=z}}});k.freezeMethods(N7);var a0=N7;function q7(Y,X){let J=this||m6,z=X||J,Q=a0.from(z.headers),G=z.data;return k.forEach(Y,function($){G=$.call(J,G,Q.normalize(),X?X.status:void 0)}),Q.normalize(),G}function x7(Y){return!!(Y&&Y.__CANCEL__)}class bN extends t{constructor(Y,X,J){super(Y==null?"canceled":Y,t.ERR_CANCELED,X,J);this.name="CanceledError",this.__CANCEL__=!0}}var l1=bN;function C4(Y,X,J){let z=J.config.validateStatus;if(!J.status||!z||z(J.status))Y(J);else X(new t("Request failed with status code "+J.status,[t.ERR_BAD_REQUEST,t.ERR_BAD_RESPONSE][Math.floor(J.status/100)-4],J.config,J.request,J))}function sz(Y){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(Y)}function rz(Y,X){return X?Y.replace(/\/?\/$/,"")+"/"+X.replace(/^\/+/,""):Y}function d8(Y,X,J){let z=!sz(X);if(Y&&(z||J==!1))return rz(Y,X);return X}var Nq=u4(RN(),1),Fq=u4(Jq(),1);import Kt from"http";import Ut from"https";import qq from"http2";import xq from"util";import w8 from"zlib";var a8="1.13.4";function I7(Y){let X=/^([-+\w]{1,25})(:?\/\/|:)/.exec(Y);return X&&X[1]||""}var rr=/^(?:([^;]+);)?(?:[^;]+;)?(base64|),([\s\S]*)$/;function MQ(Y,X,J){let z=J&&J.Blob||_0.classes.Blob,Q=I7(Y);if(X===void 0&&z)X=!0;if(Q==="data"){Y=Q.length?Y.slice(Q.length+1):Y;let G=rr.exec(Y);if(!G)throw new t("Invalid URL",t.ERR_INVALID_URL);let Z=G[1],$=G[2],H=G[3],W=Buffer.from(decodeURIComponent(H),$?"base64":"utf8");if(X){if(!z)throw new t("Blob is not supported",t.ERR_NOT_SUPPORT);return new z([W],{type:Z})}return W}throw new t("Unsupported protocol "+Q,t.ERR_NOT_SUPPORT)}import A8 from"stream";import tr from"stream";var LQ=Symbol("internals");class zq extends tr.Transform{constructor(Y){Y=k.toFlatObject(Y,{maxRate:0,chunkSize:65536,minChunkSize:100,timeWindow:500,ticksRate:2,samplesCount:15},null,(J,z)=>{return!k.isUndefined(z[J])});super({readableHighWaterMark:Y.chunkSize});let X=this[LQ]={timeWindow:Y.timeWindow,chunkSize:Y.chunkSize,maxRate:Y.maxRate,minChunkSize:Y.minChunkSize,bytesSeen:0,isCaptured:!1,notifiedBytesLoaded:0,ts:Date.now(),bytes:0,onReadCallback:null};this.on("newListener",(J)=>{if(J==="progress"){if(!X.isCaptured)X.isCaptured=!0}})}_read(Y){let X=this[LQ];if(X.onReadCallback)X.onReadCallback();return super._read(Y)}_transform(Y,X,J){let z=this[LQ],Q=z.maxRate,G=this.readableHighWaterMark,Z=z.timeWindow,$=1000/Z,H=Q/$,W=z.minChunkSize!==!1?Math.max(z.minChunkSize,H*0.01):0,K=(B,O)=>{let V=Buffer.byteLength(B);if(z.bytesSeen+=V,z.bytes+=V,z.isCaptured&&this.emit("progress",z.bytesSeen),this.push(B))process.nextTick(O);else z.onReadCallback=()=>{z.onReadCallback=null,process.nextTick(O)}},U=(B,O)=>{let V=Buffer.byteLength(B),L=null,q=G,F,P=0;if(Q){let A=Date.now();if(!z.ts||(P=A-z.ts)>=Z)z.ts=A,F=H-z.bytes,z.bytes=F<0?-F:0,P=0;F=H-z.bytes}if(Q){if(F<=0)return setTimeout(()=>{O(null,B)},Z-P);if(F<q)q=F}if(q&&V>q&&V-q>W)L=B.subarray(q),B=B.subarray(0,q);K(B,L?()=>{process.nextTick(O,null,L)}:O)};U(Y,function B(O,V){if(O)return J(O);if(V)U(V,B);else J(null)})}}var NQ=zq;import{EventEmitter as Bt}from"events";import Yt from"util";import{Readable as Xt}from"stream";var{asyncIterator:Qq}=Symbol,er=async function*(Y){if(Y.stream)yield*Y.stream();else if(Y.arrayBuffer)yield await Y.arrayBuffer();else if(Y[Qq])yield*Y[Qq]();else yield Y},XY=er;var Jt=_0.ALPHABET.ALPHA_DIGIT+"-_",v7=typeof TextEncoder==="function"?new TextEncoder:new Yt.TextEncoder,s8=`\r
`,zt=v7.encode(s8),Qt=2;class Gq{constructor(Y,X){let{escapeName:J}=this.constructor,z=k.isString(X),Q=`Content-Disposition: form-data; name="${J(Y)}"${!z&&X.name?`; filename="${J(X.name)}"`:""}${s8}`;if(z)X=v7.encode(String(X).replace(/\r?\n|\r\n?/g,s8));else Q+=`Content-Type: ${X.type||"application/octet-stream"}${s8}`;this.headers=v7.encode(Q+s8),this.contentLength=z?X.byteLength:X.size,this.size=this.headers.byteLength+this.contentLength+Qt,this.name=Y,this.value=X}async*encode(){yield this.headers;let{value:Y}=this;if(k.isTypedArray(Y))yield Y;else yield*XY(Y);yield zt}static escapeName(Y){return String(Y).replace(/[\r\n"]/g,(X)=>({"\r":"%0D","\n":"%0A",'"':"%22"})[X])}}var Gt=(Y,X,J)=>{let{tag:z="form-data-boundary",size:Q=25,boundary:G=z+"-"+_0.generateString(Q,Jt)}=J||{};if(!k.isFormData(Y))throw TypeError("FormData instance required");if(G.length<1||G.length>70)throw Error("boundary must be 10-70 characters long");let Z=v7.encode("--"+G+s8),$=v7.encode("--"+G+"--"+s8),H=$.byteLength,W=Array.from(Y.entries()).map(([U,B])=>{let O=new Gq(U,B);return H+=O.size,O});H+=Z.byteLength*W.length,H=k.toFiniteNumber(H);let K={"Content-Type":`multipart/form-data; boundary=${G}`};if(Number.isFinite(H))K["Content-Length"]=H;return X&&X(K),Xt.from(async function*(){for(let U of W)yield Z,yield*U.encode();yield $}())},Zq=Gt;import Zt from"stream";class $q extends Zt.Transform{__transform(Y,X,J){this.push(Y),J()}_transform(Y,X,J){if(Y.length!==0){if(this._transform=this.__transform,Y[0]!==120){let z=Buffer.alloc(2);z[0]=120,z[1]=156,this.push(z,X)}}this.__transform(Y,X,J)}}var Hq=$q;var $t=(Y,X)=>{return k.isAsyncFn(Y)?function(...J){let z=J.pop();Y.apply(this,J).then((Q)=>{try{X?z(null,...X(Q)):z(null,Q)}catch(G){z(G)}},z)}:Y},Wq=$t;function Ht(Y,X){Y=Y||10;let J=Array(Y),z=Array(Y),Q=0,G=0,Z;return X=X!==void 0?X:1000,function(H){let W=Date.now(),K=z[G];if(!Z)Z=W;J[Q]=H,z[Q]=W;let U=G,B=0;while(U!==Q)B+=J[U++],U=U%Y;if(Q=(Q+1)%Y,Q===G)G=(G+1)%Y;if(W-Z<X)return;let O=K&&W-K;return O?Math.round(B*1000/O):void 0}}var Kq=Ht;function Wt(Y,X){let J=0,z=1000/X,Q,G,Z=(W,K=Date.now())=>{if(J=K,Q=null,G)clearTimeout(G),G=null;Y(...W)};return[(...W)=>{let K=Date.now(),U=K-J;if(U>=z)Z(W,K);else if(Q=W,!G)G=setTimeout(()=>{G=null,Z(Q)},z-U)},()=>Q&&Z(Q)]}var Uq=Wt;var s4=(Y,X,J=3)=>{let z=0,Q=Kq(50,250);return Uq((G)=>{let Z=G.loaded,$=G.lengthComputable?G.total:void 0,H=Z-z,W=Q(H),K=Z<=$;z=Z;let U={loaded:Z,total:$,progress:$?Z/$:void 0,bytes:H,rate:W?W:void 0,estimated:W&&$&&K?($-Z)/W:void 0,event:G,lengthComputable:$!=null,[X?"download":"upload"]:!0};Y(U)},J)},d6=(Y,X)=>{let J=Y!=null;return[(z)=>X[0]({lengthComputable:J,total:Y,loaded:z}),X[1]]},l6=(Y)=>(...X)=>k.asap(()=>Y(...X));function qQ(Y){if(!Y||typeof Y!=="string")return 0;if(!Y.startsWith("data:"))return 0;let X=Y.indexOf(",");if(X<0)return 0;let J=Y.slice(5,X),z=Y.slice(X+1);if(/;base64/i.test(J)){let{length:G,length:Z}=z;for(let B=0;B<Z;B++)if(z.charCodeAt(B)===37&&B+2<Z){let O=z.charCodeAt(B+1),V=z.charCodeAt(B+2);if((O>=48&&O<=57||O>=65&&O<=70||O>=97&&O<=102)&&(V>=48&&V<=57||V>=65&&V<=70||V>=97&&V<=102))G-=2,B+=2}let $=0,H=Z-1,W=(B)=>B>=2&&z.charCodeAt(B-2)===37&&z.charCodeAt(B-1)===51&&(z.charCodeAt(B)===68||z.charCodeAt(B)===100);if(H>=0){if(z.charCodeAt(H)===61)$++,H--;else if(W(H))$++,H-=3}if($===1&&H>=0){if(z.charCodeAt(H)===61)$++;else if(W(H))$++}let U=Math.floor(G/4)*3-($||0);return U>0?U:0}return Buffer.byteLength(z,"utf8")}var Bq={flush:w8.constants.Z_SYNC_FLUSH,finishFlush:w8.constants.Z_SYNC_FLUSH},Vt={flush:w8.constants.BROTLI_OPERATION_FLUSH,finishFlush:w8.constants.BROTLI_OPERATION_FLUSH},Vq=k.isFunction(w8.createBrotliDecompress),{http:Ot,https:Mt}=Fq.default,Lt=/https:?/,Oq=_0.protocols.map((Y)=>{return Y+":"}),Mq=(Y,[X,J])=>{return Y.on("end",J).on("error",J),X};class Pq{constructor(){this.sessions=Object.create(null)}getSession(Y,X){X=Object.assign({sessionTimeout:1000},X);let J=this.sessions[Y];if(J){let W=J.length;for(let K=0;K<W;K++){let[U,B]=J[K];if(!U.destroyed&&!U.closed&&xq.isDeepStrictEqual(B,X))return U}}let z=qq.connect(Y,X),Q,G=()=>{if(Q)return;Q=!0;let W=J,K=W.length,U=K;while(U--)if(W[U][0]===z){if(K===1)delete this.sessions[Y];else W.splice(U,1);return}},Z=z.request,{sessionTimeout:$}=X;if($!=null){let W,K=0;z.request=function(){let U=Z.apply(this,arguments);if(K++,W)clearTimeout(W),W=null;return U.once("close",()=>{if(!--K)W=setTimeout(()=>{W=null,G()},$)}),U}}z.once("close",G);let H=[z,X];return J?J.push(H):J=this.sessions[Y]=[H],z}}var Nt=new Pq;function qt(Y,X){if(Y.beforeRedirects.proxy)Y.beforeRedirects.proxy(Y);if(Y.beforeRedirects.config)Y.beforeRedirects.config(Y,X)}function Aq(Y,X,J){let z=X;if(!z&&z!==!1){let Q=Nq.default.getProxyForUrl(J);if(Q)z=new URL(Q)}if(z){if(z.username)z.auth=(z.username||"")+":"+(z.password||"");if(z.auth){if(Boolean(z.auth.username||z.auth.password))z.auth=(z.auth.username||"")+":"+(z.auth.password||"");else if(typeof z.auth==="object")throw new t("Invalid proxy authorization",t.ERR_BAD_OPTION,{proxy:z});let Z=Buffer.from(z.auth,"utf8").toString("base64");Y.headers["Proxy-Authorization"]="Basic "+Z}Y.headers.host=Y.hostname+(Y.port?":"+Y.port:"");let Q=z.hostname||z.host;if(Y.hostname=Q,Y.host=Q,Y.port=z.port,Y.path=J,z.protocol)Y.protocol=z.protocol.includes(":")?z.protocol:`${z.protocol}:`}Y.beforeRedirects.proxy=function(G){Aq(G,X,G.href)}}var xt=typeof process<"u"&&k.kindOf(process)==="process",Ft=(Y)=>{return new Promise((X,J)=>{let z,Q,G=(H,W)=>{if(Q)return;Q=!0,z&&z(H,W)},Z=(H)=>{G(H),X(H)},$=(H)=>{G(H,!0),J(H)};Y(Z,$,(H)=>z=H).catch($)})},Pt=({address:Y,family:X})=>{if(!k.isString(Y))throw TypeError("address must be a string");return{address:Y,family:X||(Y.indexOf(".")<0?6:4)}},Lq=(Y,X)=>Pt(k.isObject(Y)?Y:{address:Y,family:X}),At={request(Y,X){let J=Y.protocol+"//"+Y.hostname+":"+(Y.port||(Y.protocol==="https:"?443:80)),{http2Options:z,headers:Q}=Y,G=Nt.getSession(J,z),{HTTP2_HEADER_SCHEME:Z,HTTP2_HEADER_METHOD:$,HTTP2_HEADER_PATH:H,HTTP2_HEADER_STATUS:W}=qq.constants,K={[Z]:Y.protocol.replace(":",""),[$]:Y.method,[H]:Y.path};k.forEach(Q,(B,O)=>{O.charAt(0)!==":"&&(K[O]=B)});let U=G.request(K);return U.once("response",(B)=>{let O=U;B=Object.assign({},B);let V=B[W];delete B[W],O.headers=B,O.statusCode=+V,X(O)}),U}},wq=xt&&function(X){return Ft(async function(z,Q,G){let{data:Z,lookup:$,family:H,httpVersion:W=1,http2Options:K}=X,{responseType:U,responseEncoding:B}=X,O=X.method.toUpperCase(),V,L=!1,q;if(W=+W,Number.isNaN(W))throw TypeError(`Invalid protocol version: '${X.httpVersion}' is not a number`);if(W!==1&&W!==2)throw TypeError(`Unsupported protocol version '${W}'`);let F=W===2;if($){let m=Wq($,(h)=>k.isArray(h)?h:[h]);$=(h,_,c)=>{m(h,_,(d,s,W0)=>{if(d)return c(d);let L0=k.isArray(s)?s.map((X0)=>Lq(X0)):[Lq(s,W0)];_.all?c(d,L0):c(d,L0[0].address,L0[0].family)})}}let P=new Bt;function A(m){try{P.emit("abort",!m||m.type?new l1(null,X,q):m)}catch(h){console.warn("emit error",h)}}P.once("abort",Q);let w=()=>{if(X.cancelToken)X.cancelToken.unsubscribe(A);if(X.signal)X.signal.removeEventListener("abort",A);P.removeAllListeners()};if(X.cancelToken||X.signal){if(X.cancelToken&&X.cancelToken.subscribe(A),X.signal)X.signal.aborted?A():X.signal.addEventListener("abort",A)}G((m,h)=>{if(V=!0,h){L=!0,w();return}let{data:_}=m;if(_ instanceof A8.Readable||_ instanceof A8.Duplex){let c=A8.finished(_,()=>{c(),w()})}else w()});let v=d8(X.baseURL,X.url,X.allowAbsoluteUrls),T=new URL(v,_0.hasBrowserEnv?_0.origin:void 0),D=T.protocol||Oq[0];if(D==="data:"){if(X.maxContentLength>-1){let h=String(X.url||v||"");if(qQ(h)>X.maxContentLength)return Q(new t("maxContentLength size of "+X.maxContentLength+" exceeded",t.ERR_BAD_RESPONSE,X))}let m;if(O!=="GET")return C4(z,Q,{status:405,statusText:"method not allowed",headers:{},config:X});try{m=MQ(X.url,U==="blob",{Blob:X.env&&X.env.Blob})}catch(h){throw t.from(h,t.ERR_BAD_REQUEST,X)}if(U==="text"){if(m=m.toString(B),!B||B==="utf8")m=k.stripBOM(m)}else if(U==="stream")m=A8.Readable.from(m);return C4(z,Q,{data:m,status:200,statusText:"OK",headers:new a0,config:X})}if(Oq.indexOf(D)===-1)return Q(new t("Unsupported protocol "+D,t.ERR_BAD_REQUEST,X));let j=a0.from(X.headers).normalize();j.set("User-Agent","axios/"+a8,!1);let{onUploadProgress:E,onDownloadProgress:f}=X,i=X.maxRate,o=void 0,y=void 0;if(k.isSpecCompliantForm(Z)){let m=j.getContentType(/boundary=([-_\w\d]{10,70})/i);Z=Zq(Z,(h)=>{j.set(h)},{tag:`axios-${a8}-boundary`,boundary:m&&m[1]||void 0})}else if(k.isFormData(Z)&&k.isFunction(Z.getHeaders)){if(j.set(Z.getHeaders()),!j.hasContentLength())try{let m=await xq.promisify(Z.getLength).call(Z);Number.isFinite(m)&&m>=0&&j.setContentLength(m)}catch(m){}}else if(k.isBlob(Z)||k.isFile(Z))Z.size&&j.setContentType(Z.type||"application/octet-stream"),j.setContentLength(Z.size||0),Z=A8.Readable.from(XY(Z));else if(Z&&!k.isStream(Z)){if(Buffer.isBuffer(Z));else if(k.isArrayBuffer(Z))Z=Buffer.from(new Uint8Array(Z));else if(k.isString(Z))Z=Buffer.from(Z,"utf-8");else return Q(new t("Data after transformation must be a string, an ArrayBuffer, a Buffer, or a Stream",t.ERR_BAD_REQUEST,X));if(j.setContentLength(Z.length,!1),X.maxBodyLength>-1&&Z.length>X.maxBodyLength)return Q(new t("Request body larger than maxBodyLength limit",t.ERR_BAD_REQUEST,X))}let a=k.toFiniteNumber(j.getContentLength());if(k.isArray(i))o=i[0],y=i[1];else o=y=i;if(Z&&(E||o)){if(!k.isStream(Z))Z=A8.Readable.from(Z,{objectMode:!1});Z=A8.pipeline([Z,new NQ({maxRate:k.toFiniteNumber(o)})],k.noop),E&&Z.on("progress",Mq(Z,d6(a,s4(l6(E),!1,3))))}let r=void 0;if(X.auth){let m=X.auth.username||"",h=X.auth.password||"";r=m+":"+h}if(!r&&T.username){let{username:m,password:h}=T;r=m+":"+h}r&&j.delete("authorization");let b;try{b=c8(T.pathname+T.search,X.params,X.paramsSerializer).replace(/^\?/,"")}catch(m){let h=Error(m.message);return h.config=X,h.url=X.url,h.exists=!0,Q(h)}j.set("Accept-Encoding","gzip, compress, deflate"+(Vq?", br":""),!1);let R={path:b,method:O,headers:j.toJSON(),agents:{http:X.httpAgent,https:X.httpsAgent},auth:r,protocol:D,family:H,beforeRedirect:qt,beforeRedirects:{},http2Options:K};if(!k.isUndefined($)&&(R.lookup=$),X.socketPath)R.socketPath=X.socketPath;else R.hostname=T.hostname.startsWith("[")?T.hostname.slice(1,-1):T.hostname,R.port=T.port,Aq(R,X.proxy,D+"//"+T.hostname+(T.port?":"+T.port:"")+R.path);let l,p=Lt.test(R.protocol);if(R.agent=p?X.httpsAgent:X.httpAgent,F)l=At;else if(X.transport)l=X.transport;else if(X.maxRedirects===0)l=p?Ut:Kt;else{if(X.maxRedirects)R.maxRedirects=X.maxRedirects;if(X.beforeRedirect)R.beforeRedirects.config=X.beforeRedirect;l=p?Mt:Ot}if(X.maxBodyLength>-1)R.maxBodyLength=X.maxBodyLength;else R.maxBodyLength=1/0;if(X.insecureHTTPParser)R.insecureHTTPParser=X.insecureHTTPParser;if(q=l.request(R,function(h){if(q.destroyed)return;let _=[h],c=k.toFiniteNumber(h.headers["content-length"]);if(f||y){let L0=new NQ({maxRate:k.toFiniteNumber(y)});f&&L0.on("progress",Mq(L0,d6(c,s4(l6(f),!0,3)))),_.push(L0)}let d=h,s=h.req||q;if(X.decompress!==!1&&h.headers["content-encoding"]){if(O==="HEAD"||h.statusCode===204)delete h.headers["content-encoding"];switch((h.headers["content-encoding"]||"").toLowerCase()){case"gzip":case"x-gzip":case"compress":case"x-compress":_.push(w8.createUnzip(Bq)),delete h.headers["content-encoding"];break;case"deflate":_.push(new Hq),_.push(w8.createUnzip(Bq)),delete h.headers["content-encoding"];break;case"br":if(Vq)_.push(w8.createBrotliDecompress(Vt)),delete h.headers["content-encoding"]}}d=_.length>1?A8.pipeline(_,k.noop):_[0];let W0={status:h.statusCode,statusText:h.statusMessage,headers:new a0(h.headers),config:X,request:s};if(U==="stream")W0.data=d,C4(z,Q,W0);else{let L0=[],X0=0;d.on("data",function(J0){if(L0.push(J0),X0+=J0.length,X.maxContentLength>-1&&X0>X.maxContentLength)L=!0,d.destroy(),A(new t("maxContentLength size of "+X.maxContentLength+" exceeded",t.ERR_BAD_RESPONSE,X,s))}),d.on("aborted",function(){if(L)return;let J0=new t("stream has been aborted",t.ERR_BAD_RESPONSE,X,s);d.destroy(J0),Q(J0)}),d.on("error",function(J0){if(q.destroyed)return;Q(t.from(J0,null,X,s))}),d.on("end",function(){try{let J0=L0.length===1?L0[0]:Buffer.concat(L0);if(U!=="arraybuffer"){if(J0=J0.toString(B),!B||B==="utf8")J0=k.stripBOM(J0)}W0.data=J0}catch(J0){return Q(t.from(J0,null,X,W0.request,W0))}C4(z,Q,W0)})}P.once("abort",(L0)=>{if(!d.destroyed)d.emit("error",L0),d.destroy()})}),P.once("abort",(m)=>{if(q.close)q.close();else q.destroy(m)}),q.on("error",function(h){Q(t.from(h,null,X,q))}),q.on("socket",function(h){h.setKeepAlive(!0,60000)}),X.timeout){let m=parseInt(X.timeout,10);if(Number.isNaN(m)){A(new t("error trying to parse `config.timeout` to int",t.ERR_BAD_OPTION_VALUE,X,q));return}q.setTimeout(m,function(){if(V)return;let _=X.timeout?"timeout of "+X.timeout+"ms exceeded":"timeout exceeded",c=X.transitional||h6;if(X.timeoutErrorMessage)_=X.timeoutErrorMessage;A(new t(_,c.clarifyTimeoutError?t.ETIMEDOUT:t.ECONNABORTED,X,q))})}else q.setTimeout(0);if(k.isStream(Z)){let m=!1,h=!1;Z.on("end",()=>{m=!0}),Z.once("error",(_)=>{h=!0,q.destroy(_)}),Z.on("close",()=>{if(!m&&!h)A(new l1("Request stream has been aborted",X,q))}),Z.pipe(q)}else Z&&q.write(Z),q.end()})};var Tq=_0.hasStandardBrowserEnv?((Y,X)=>(J)=>{return J=new URL(J,_0.origin),Y.protocol===J.protocol&&Y.host===J.host&&(X||Y.port===J.port)})(new URL(_0.origin),_0.navigator&&/(msie|trident)/i.test(_0.navigator.userAgent)):()=>!0;var Iq=_0.hasStandardBrowserEnv?{write(Y,X,J,z,Q,G,Z){if(typeof document>"u")return;let $=[`${Y}=${encodeURIComponent(X)}`];if(k.isNumber(J))$.push(`expires=${new Date(J).toUTCString()}`);if(k.isString(z))$.push(`path=${z}`);if(k.isString(Q))$.push(`domain=${Q}`);if(G===!0)$.push("secure");if(k.isString(Z))$.push(`SameSite=${Z}`);document.cookie=$.join("; ")},read(Y){if(typeof document>"u")return null;let X=document.cookie.match(new RegExp("(?:^|; )"+Y+"=([^;]*)"));return X?decodeURIComponent(X[1]):null},remove(Y){this.write(Y,"",Date.now()-86400000,"/")}}:{write(){},read(){return null},remove(){}};var vq=(Y)=>Y instanceof a0?{...Y}:Y;function N4(Y,X){X=X||{};let J={};function z(W,K,U,B){if(k.isPlainObject(W)&&k.isPlainObject(K))return k.merge.call({caseless:B},W,K);else if(k.isPlainObject(K))return k.merge({},K);else if(k.isArray(K))return K.slice();return K}function Q(W,K,U,B){if(!k.isUndefined(K))return z(W,K,U,B);else if(!k.isUndefined(W))return z(void 0,W,U,B)}function G(W,K){if(!k.isUndefined(K))return z(void 0,K)}function Z(W,K){if(!k.isUndefined(K))return z(void 0,K);else if(!k.isUndefined(W))return z(void 0,W)}function $(W,K,U){if(U in X)return z(W,K);else if(U in Y)return z(void 0,W)}let H={url:G,method:G,data:G,baseURL:Z,transformRequest:Z,transformResponse:Z,paramsSerializer:Z,timeout:Z,timeoutMessage:Z,withCredentials:Z,withXSRFToken:Z,adapter:Z,responseType:Z,xsrfCookieName:Z,xsrfHeaderName:Z,onUploadProgress:Z,onDownloadProgress:Z,decompress:Z,maxContentLength:Z,maxBodyLength:Z,beforeRedirect:Z,transport:Z,httpAgent:Z,httpsAgent:Z,cancelToken:Z,socketPath:Z,responseEncoding:Z,validateStatus:$,headers:(W,K,U)=>Q(vq(W),vq(K),U,!0)};return k.forEach(Object.keys({...Y,...X}),function(K){let U=H[K]||Q,B=U(Y[K],X[K],K);k.isUndefined(B)&&U!==$||(J[K]=B)}),J}var JY=(Y)=>{let X=N4({},Y),{data:J,withXSRFToken:z,xsrfHeaderName:Q,xsrfCookieName:G,headers:Z,auth:$}=X;if(X.headers=Z=a0.from(Z),X.url=c8(d8(X.baseURL,X.url,X.allowAbsoluteUrls),Y.params,Y.paramsSerializer),$)Z.set("Authorization","Basic "+btoa(($.username||"")+":"+($.password?unescape(encodeURIComponent($.password)):"")));if(k.isFormData(J)){if(_0.hasStandardBrowserEnv||_0.hasStandardBrowserWebWorkerEnv)Z.setContentType(void 0);else if(k.isFunction(J.getHeaders)){let H=J.getHeaders(),W=["content-type","content-length"];Object.entries(H).forEach(([K,U])=>{if(W.includes(K.toLowerCase()))Z.set(K,U)})}}if(_0.hasStandardBrowserEnv){if(z&&k.isFunction(z)&&(z=z(X)),z||z!==!1&&Tq(X.url)){let H=Q&&G&&Iq.read(G);if(H)Z.set(Q,H)}}return X};var wt=typeof XMLHttpRequest<"u",Dq=wt&&function(Y){return new Promise(function(J,z){let Q=JY(Y),G=Q.data,Z=a0.from(Q.headers).normalize(),{responseType:$,onUploadProgress:H,onDownloadProgress:W}=Q,K,U,B,O,V;function L(){O&&O(),V&&V(),Q.cancelToken&&Q.cancelToken.unsubscribe(K),Q.signal&&Q.signal.removeEventListener("abort",K)}let q=new XMLHttpRequest;q.open(Q.method.toUpperCase(),Q.url,!0),q.timeout=Q.timeout;function F(){if(!q)return;let A=a0.from("getAllResponseHeaders"in q&&q.getAllResponseHeaders()),v={data:!$||$==="text"||$==="json"?q.responseText:q.response,status:q.status,statusText:q.statusText,headers:A,config:Y,request:q};C4(function(D){J(D),L()},function(D){z(D),L()},v),q=null}if("onloadend"in q)q.onloadend=F;else q.onreadystatechange=function(){if(!q||q.readyState!==4)return;if(q.status===0&&!(q.responseURL&&q.responseURL.indexOf("file:")===0))return;setTimeout(F)};if(q.onabort=function(){if(!q)return;z(new t("Request aborted",t.ECONNABORTED,Y,q)),q=null},q.onerror=function(w){let v=w&&w.message?w.message:"Network Error",T=new t(v,t.ERR_NETWORK,Y,q);T.event=w||null,z(T),q=null},q.ontimeout=function(){let w=Q.timeout?"timeout of "+Q.timeout+"ms exceeded":"timeout exceeded",v=Q.transitional||h6;if(Q.timeoutErrorMessage)w=Q.timeoutErrorMessage;z(new t(w,v.clarifyTimeoutError?t.ETIMEDOUT:t.ECONNABORTED,Y,q)),q=null},G===void 0&&Z.setContentType(null),"setRequestHeader"in q)k.forEach(Z.toJSON(),function(w,v){q.setRequestHeader(v,w)});if(!k.isUndefined(Q.withCredentials))q.withCredentials=!!Q.withCredentials;if($&&$!=="json")q.responseType=Q.responseType;if(W)[B,V]=s4(W,!0),q.addEventListener("progress",B);if(H&&q.upload)[U,O]=s4(H),q.upload.addEventListener("progress",U),q.upload.addEventListener("loadend",O);if(Q.cancelToken||Q.signal){if(K=(A)=>{if(!q)return;z(!A||A.type?new l1(null,Y,q):A),q.abort(),q=null},Q.cancelToken&&Q.cancelToken.subscribe(K),Q.signal)Q.signal.aborted?K():Q.signal.addEventListener("abort",K)}let P=I7(Q.url);if(P&&_0.protocols.indexOf(P)===-1){z(new t("Unsupported protocol "+P+":",t.ERR_BAD_REQUEST,Y));return}q.send(G||null)})};var Tt=(Y,X)=>{let{length:J}=Y=Y?Y.filter(Boolean):[];if(X||J){let z=new AbortController,Q,G=function(W){if(!Q){Q=!0,$();let K=W instanceof Error?W:this.reason;z.abort(K instanceof t?K:new l1(K instanceof Error?K.message:K))}},Z=X&&setTimeout(()=>{Z=null,G(new t(`timeout of ${X}ms exceeded`,t.ETIMEDOUT))},X),$=()=>{if(Y)Z&&clearTimeout(Z),Z=null,Y.forEach((W)=>{W.unsubscribe?W.unsubscribe(G):W.removeEventListener("abort",G)}),Y=null};Y.forEach((W)=>W.addEventListener("abort",G));let{signal:H}=z;return H.unsubscribe=()=>k.asap($),H}},jq=Tt;var It=function*(Y,X){let J=Y.byteLength;if(!X||J<X){yield Y;return}let z=0,Q;while(z<J)Q=z+X,yield Y.slice(z,Q),z=Q},vt=async function*(Y,X){for await(let J of Dt(Y))yield*It(J,X)},Dt=async function*(Y){if(Y[Symbol.asyncIterator]){yield*Y;return}let X=Y.getReader();try{for(;;){let{done:J,value:z}=await X.read();if(J)break;yield z}}finally{await X.cancel()}},xQ=(Y,X,J,z)=>{let Q=vt(Y,X),G=0,Z,$=(H)=>{if(!Z)Z=!0,z&&z(H)};return new ReadableStream({async pull(H){try{let{done:W,value:K}=await Q.next();if(W){$(),H.close();return}let U=K.byteLength;if(J){let B=G+=U;J(B)}H.enqueue(new Uint8Array(K))}catch(W){throw $(W),W}},cancel(H){return $(H),Q.return()}},{highWaterMark:2})};var Cq=65536,{isFunction:zY}=k,jt=(({Request:Y,Response:X})=>({Request:Y,Response:X}))(k.global),{ReadableStream:Eq,TextEncoder:Sq}=k.global,kq=(Y,...X)=>{try{return!!Y(...X)}catch(J){return!1}},Ct=(Y)=>{Y=k.merge.call({skipUndefined:!0},jt,Y);let{fetch:X,Request:J,Response:z}=Y,Q=X?zY(X):typeof fetch==="function",G=zY(J),Z=zY(z);if(!Q)return!1;let $=Q&&zY(Eq),H=Q&&(typeof Sq==="function"?((V)=>(L)=>V.encode(L))(new Sq):async(V)=>new Uint8Array(await new J(V).arrayBuffer())),W=G&&$&&kq(()=>{let V=!1,L=new J(_0.origin,{body:new Eq,method:"POST",get duplex(){return V=!0,"half"}}).headers.has("Content-Type");return V&&!L}),K=Z&&$&&kq(()=>k.isReadableStream(new z("").body)),U={stream:K&&((V)=>V.body)};Q&&(()=>{["text","arrayBuffer","blob","formData","stream"].forEach((V)=>{!U[V]&&(U[V]=(L,q)=>{let F=L&&L[V];if(F)return F.call(L);throw new t(`Response type '${V}' is not supported`,t.ERR_NOT_SUPPORT,q)})})})();let B=async(V)=>{if(V==null)return 0;if(k.isBlob(V))return V.size;if(k.isSpecCompliantForm(V))return(await new J(_0.origin,{method:"POST",body:V}).arrayBuffer()).byteLength;if(k.isArrayBufferView(V)||k.isArrayBuffer(V))return V.byteLength;if(k.isURLSearchParams(V))V=V+"";if(k.isString(V))return(await H(V)).byteLength},O=async(V,L)=>{let q=k.toFiniteNumber(V.getContentLength());return q==null?B(L):q};return async(V)=>{let{url:L,method:q,data:F,signal:P,cancelToken:A,timeout:w,onDownloadProgress:v,onUploadProgress:T,responseType:D,headers:j,withCredentials:E="same-origin",fetchOptions:f}=JY(V),i=X||fetch;D=D?(D+"").toLowerCase():"text";let o=jq([P,A&&A.toAbortSignal()],w),y=null,a=o&&o.unsubscribe&&(()=>{o.unsubscribe()}),r;try{if(T&&W&&q!=="get"&&q!=="head"&&(r=await O(j,F))!==0){let h=new J(L,{method:"POST",body:F,duplex:"half"}),_;if(k.isFormData(F)&&(_=h.headers.get("content-type")))j.setContentType(_);if(h.body){let[c,d]=d6(r,s4(l6(T)));F=xQ(h.body,Cq,c,d)}}if(!k.isString(E))E=E?"include":"omit";let b=G&&"credentials"in J.prototype,R={...f,signal:o,method:q.toUpperCase(),headers:j.normalize().toJSON(),body:F,duplex:"half",credentials:b?E:void 0};y=G&&new J(L,R);let l=await(G?i(y,f):i(L,R)),p=K&&(D==="stream"||D==="response");if(K&&(v||p&&a)){let h={};["status","statusText","headers"].forEach((s)=>{h[s]=l[s]});let _=k.toFiniteNumber(l.headers.get("content-length")),[c,d]=v&&d6(_,s4(l6(v),!0))||[];l=new z(xQ(l.body,Cq,c,()=>{d&&d(),a&&a()}),h)}D=D||"text";let m=await U[k.findKey(U,D)||"text"](l,V);return!p&&a&&a(),await new Promise((h,_)=>{C4(h,_,{data:m,headers:a0.from(l.headers),status:l.status,statusText:l.statusText,config:V,request:y})})}catch(b){if(a&&a(),b&&b.name==="TypeError"&&/Load failed|fetch/i.test(b.message))throw Object.assign(new t("Network Error",t.ERR_NETWORK,V,y),{cause:b.cause||b});throw t.from(b,b&&b.code,V,y)}}},Et=new Map,FQ=(Y)=>{let X=Y&&Y.env||{},{fetch:J,Request:z,Response:Q}=X,G=[z,Q,J],Z=G.length,$=Z,H,W,K=Et;while($--)H=G[$],W=K.get(H),W===void 0&&K.set(H,W=$?new Map:Ct(X)),K=W;return W},RV0=FQ();var PQ={http:wq,xhr:Dq,fetch:{get:FQ}};k.forEach(PQ,(Y,X)=>{if(Y){try{Object.defineProperty(Y,"name",{value:X})}catch(J){}Object.defineProperty(Y,"adapterName",{value:X})}});var _q=(Y)=>`- ${Y}`,kt=(Y)=>k.isFunction(Y)||Y===null||Y===!1;function _t(Y,X){Y=k.isArray(Y)?Y:[Y];let{length:J}=Y,z,Q,G={};for(let Z=0;Z<J;Z++){z=Y[Z];let $;if(Q=z,!kt(z)){if(Q=PQ[($=String(z)).toLowerCase()],Q===void 0)throw new t(`Unknown adapter '${$}'`)}if(Q&&(k.isFunction(Q)||(Q=Q.get(X))))break;G[$||"#"+Z]=Q}if(!Q){let Z=Object.entries(G).map(([H,W])=>`adapter ${H} `+(W===!1?"is not supported by the environment":"is not available in the build")),$=J?Z.length>1?`since :
`+Z.map(_q).join(`
`):" "+_q(Z[0]):"as no adapter specified";throw new t("There is no suitable adapter to dispatch the request "+$,"ERR_NOT_SUPPORT")}return Q}var QY={getAdapter:_t,adapters:PQ};function AQ(Y){if(Y.cancelToken)Y.cancelToken.throwIfRequested();if(Y.signal&&Y.signal.aborted)throw new l1(null,Y)}function GY(Y){if(AQ(Y),Y.headers=a0.from(Y.headers),Y.data=q7.call(Y,Y.transformRequest),["post","put","patch"].indexOf(Y.method)!==-1)Y.headers.setContentType("application/x-www-form-urlencoded",!1);return QY.getAdapter(Y.adapter||m6.adapter,Y)(Y).then(function(z){return AQ(Y),z.data=q7.call(Y,Y.transformResponse,z),z.headers=a0.from(z.headers),z},function(z){if(!x7(z)){if(AQ(Y),z&&z.response)z.response.data=q7.call(Y,Y.transformResponse,z.response),z.response.headers=a0.from(z.response.headers)}return Promise.reject(z)})}var ZY={};["object","boolean","number","function","string","symbol"].forEach((Y,X)=>{ZY[Y]=function(z){return typeof z===Y||"a"+(X<1?"n ":" ")+Y}});var bq={};ZY.transitional=function(X,J,z){function Q(G,Z){return"[Axios v"+a8+"] Transitional option '"+G+"'"+Z+(z?". "+z:"")}return(G,Z,$)=>{if(X===!1)throw new t(Q(Z," has been removed"+(J?" in "+J:"")),t.ERR_DEPRECATED);if(J&&!bq[Z])bq[Z]=!0,console.warn(Q(Z," has been deprecated since v"+J+" and will be removed in the near future"));return X?X(G,Z,$):!0}};ZY.spelling=function(X){return(J,z)=>{return console.warn(`${z} is likely a misspelling of ${X}`),!0}};function bt(Y,X,J){if(typeof Y!=="object")throw new t("options must be an object",t.ERR_BAD_OPTION_VALUE);let z=Object.keys(Y),Q=z.length;while(Q-- >0){let G=z[Q],Z=X[G];if(Z){let $=Y[G],H=$===void 0||Z($,G,Y);if(H!==!0)throw new t("option "+G+" must be "+H,t.ERR_BAD_OPTION_VALUE);continue}if(J!==!0)throw new t("Unknown option "+G,t.ERR_BAD_OPTION)}}var D7={assertOptions:bt,validators:ZY};var E4=D7.validators;class j7{constructor(Y){this.defaults=Y||{},this.interceptors={request:new pz,response:new pz}}async request(Y,X){try{return await this._request(Y,X)}catch(J){if(J instanceof Error){let z={};Error.captureStackTrace?Error.captureStackTrace(z):z=Error();let Q=z.stack?z.stack.replace(/^.+\n/,""):"";try{if(!J.stack)J.stack=Q;else if(Q&&!String(J.stack).endsWith(Q.replace(/^.+\n.+\n/,"")))J.stack+=`
`+Q}catch(G){}}throw J}}_request(Y,X){if(typeof Y==="string")X=X||{},X.url=Y;else X=Y||{};X=N4(this.defaults,X);let{transitional:J,paramsSerializer:z,headers:Q}=X;if(J!==void 0)D7.assertOptions(J,{silentJSONParsing:E4.transitional(E4.boolean),forcedJSONParsing:E4.transitional(E4.boolean),clarifyTimeoutError:E4.transitional(E4.boolean)},!1);if(z!=null)if(k.isFunction(z))X.paramsSerializer={serialize:z};else D7.assertOptions(z,{encode:E4.function,serialize:E4.function},!0);if(X.allowAbsoluteUrls!==void 0);else if(this.defaults.allowAbsoluteUrls!==void 0)X.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls;else X.allowAbsoluteUrls=!0;D7.assertOptions(X,{baseUrl:E4.spelling("baseURL"),withXsrfToken:E4.spelling("withXSRFToken")},!0),X.method=(X.method||this.defaults.method||"get").toLowerCase();let G=Q&&k.merge(Q.common,Q[X.method]);Q&&k.forEach(["delete","get","head","post","put","patch","common"],(O)=>{delete Q[O]}),X.headers=a0.concat(G,Q);let Z=[],$=!0;this.interceptors.request.forEach(function(V){if(typeof V.runWhen==="function"&&V.runWhen(X)===!1)return;$=$&&V.synchronous,Z.unshift(V.fulfilled,V.rejected)});let H=[];this.interceptors.response.forEach(function(V){H.push(V.fulfilled,V.rejected)});let W,K=0,U;if(!$){let O=[GY.bind(this),void 0];O.unshift(...Z),O.push(...H),U=O.length,W=Promise.resolve(X);while(K<U)W=W.then(O[K++],O[K++]);return W}U=Z.length;let B=X;while(K<U){let O=Z[K++],V=Z[K++];try{B=O(B)}catch(L){V.call(this,L);break}}try{W=GY.call(this,B)}catch(O){return Promise.reject(O)}K=0,U=H.length;while(K<U)W=W.then(H[K++],H[K++]);return W}getUri(Y){Y=N4(this.defaults,Y);let X=d8(Y.baseURL,Y.url,Y.allowAbsoluteUrls);return c8(X,Y.params,Y.paramsSerializer)}}k.forEach(["delete","get","head","options"],function(X){j7.prototype[X]=function(J,z){return this.request(N4(z||{},{method:X,url:J,data:(z||{}).data}))}});k.forEach(["post","put","patch"],function(X){function J(z){return function(G,Z,$){return this.request(N4($||{},{method:X,headers:z?{"Content-Type":"multipart/form-data"}:{},url:G,data:Z}))}}j7.prototype[X]=J(),j7.prototype[X+"Form"]=J(!0)});var C7=j7;class wQ{constructor(Y){if(typeof Y!=="function")throw TypeError("executor must be a function.");let X;this.promise=new Promise(function(Q){X=Q});let J=this;this.promise.then((z)=>{if(!J._listeners)return;let Q=J._listeners.length;while(Q-- >0)J._listeners[Q](z);J._listeners=null}),this.promise.then=(z)=>{let Q,G=new Promise((Z)=>{J.subscribe(Z),Q=Z}).then(z);return G.cancel=function(){J.unsubscribe(Q)},G},Y(function(Q,G,Z){if(J.reason)return;J.reason=new l1(Q,G,Z),X(J.reason)})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(Y){if(this.reason){Y(this.reason);return}if(this._listeners)this._listeners.push(Y);else this._listeners=[Y]}unsubscribe(Y){if(!this._listeners)return;let X=this._listeners.indexOf(Y);if(X!==-1)this._listeners.splice(X,1)}toAbortSignal(){let Y=new AbortController,X=(J)=>{Y.abort(J)};return this.subscribe(X),Y.signal.unsubscribe=()=>this.unsubscribe(X),Y.signal}static source(){let Y;return{token:new wQ(function(z){Y=z}),cancel:Y}}}var Rq=wQ;function TQ(Y){return function(J){return Y.apply(null,J)}}function IQ(Y){return k.isObject(Y)&&Y.isAxiosError===!0}var vQ={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511,WebServerIsDown:521,ConnectionTimedOut:522,OriginIsUnreachable:523,TimeoutOccurred:524,SslHandshakeFailed:525,InvalidSslCertificate:526};Object.entries(vQ).forEach(([Y,X])=>{vQ[X]=Y});var fq=vQ;function yq(Y){let X=new C7(Y),J=H7(C7.prototype.request,X);return k.extend(J,C7.prototype,X,{allOwnKeys:!0}),k.extend(J,X,null,{allOwnKeys:!0}),J.create=function(Q){return yq(N4(Y,Q))},J}var X1=yq(m6);X1.Axios=C7;X1.CanceledError=l1;X1.CancelToken=Rq;X1.isCancel=x7;X1.VERSION=a8;X1.toFormData=F8;X1.AxiosError=t;X1.Cancel=X1.CanceledError;X1.all=function(X){return Promise.all(X)};X1.spread=TQ;X1.isAxiosError=IQ;X1.mergeConfig=N4;X1.AxiosHeaders=a0;X1.formToJSON=(Y)=>a9(k.isHTMLForm(Y)?new FormData(Y):Y);X1.getAdapter=QY.getAdapter;X1.HttpStatusCode=fq;X1.default=X1;var Y4=X1;import*as i6 from"fs/promises";import*as $Y from"path";class hq{tokenCache=new Map;clients=new Map;tokenRefreshPromises=new Map;constructor(){this.loadTokenCache().catch((Y)=>{S("[Auth] Failed to load token cache:",Y.message)}),this.loadEnterpriseLicense()}loadEnterpriseLicense(){try{let Y;try{Y=(()=>{throw new Error("Cannot require module "+"../../../../enterprise/src/auth/enterprise-validator");})().loadLicenseFromEnv}catch(J){S("[Auth] Enterprise features not available, using community tier"),this._enterpriseLicense=this.getCommunityLicense();return}let X=Y();S("[Auth] Enterprise License:",{tier:X.tier,company:X.companyName||"N/A",theme:X.theme,features:X.features.length,expiresAt:X.expiresAt?.toISOString()||"N/A"}),this._enterpriseLicense=X}catch(Y){S("[Auth] Failed to load enterprise license:",Y.message),this._enterpriseLicense=this.getCommunityLicense()}}getCommunityLicense(){return{tier:"community",features:[],theme:"servicenow"}}async getAuthenticatedClient(Y){if(!Y.enterprise&&this._enterpriseLicense)Y.enterprise=this._enterpriseLicense;let X=this.getCacheKey(Y.instanceUrl);if(this.clients.has(X)&&this.isTokenValid(X))return this.clients.get(X);let J=await this.getAccessToken(Y),z=J.startsWith("Basic ")?J:`Bearer ${J}`,Q=Y4.create({baseURL:Y.instanceUrl,headers:{Authorization:z,"Content-Type":"application/json",Accept:"application/json"},timeout:60000});return Q.interceptors.response.use((G)=>{if(G.data?.error){let Z=G.data.error.message||G.data.error.detail||"ServiceNow API error";S("[Auth] ServiceNow returned error in response body:",Z);let $=Error(Z);throw $.response=G,$.isServiceNowError=!0,$}if(G.data&&G.data.result===void 0)if(G.data.sys_id||Array.isArray(G.data))G.data={result:G.data};else G.data.result=[];return G},async(G)=>{if(G.response?.data?.error){let Z=G.response.data.error,$=Z.message||Z.detail||"ServiceNow API error";S("[Auth] ServiceNow API error:",$);let H=Error(`ServiceNow: ${$}`);throw H.response=G.response,H.originalError=G,H}throw G}),Q.interceptors.response.use((G)=>G,async(G)=>{let Z=G.config;if(G.response?.status===401&&!Z._retry){Z._retry=!0;try{this.invalidateToken(X);let $=Y.accessToken;Y.accessToken=void 0,S("[Auth] 401 received, clearing invalid accessToken and forcing refresh...");let H=await this.getAccessToken(Y);if(H.startsWith("Basic "))Z.headers.Authorization=H;else Z.headers.Authorization=`Bearer ${H}`;return Q(Z)}catch($){throw S("[Auth] Token refresh failed:",$),$}}throw G}),Q.getRecord=async(G,Z)=>{return await Q.get(`/api/now/table/${G}/${Z}`)},Q.query=async(G,Z)=>{return await Q.get(`/api/now/table/${G}`,{params:Z})},Q.updateRecord=async(G,Z,$)=>{return await Q.put(`/api/now/table/${G}/${Z}`,$)},this.clients.set(X,Q),Q}async getAccessToken(Y){let X=this.getCacheKey(Y.instanceUrl);if(this.isTokenValid(X))return this.tokenCache.get(X).accessToken;if(this.tokenRefreshPromises.has(X))return S("[Auth] Token refresh already in progress, awaiting..."),await this.tokenRefreshPromises.get(X);let J=this.refreshAccessToken(Y);this.tokenRefreshPromises.set(X,J);try{return await J}finally{this.tokenRefreshPromises.delete(X)}}async refreshAccessToken(Y){let X=this.getCacheKey(Y.instanceUrl);if(S("[Auth] Refreshing access token for:",Y.instanceUrl),!Y.instanceUrl||Y.instanceUrl===""||Y.instanceUrl.includes("your-instance"))throw Error("ServiceNow credentials not configured. Please run: snow-flow auth login");let J=Y.clientId&&Y.clientSecret&&Y.clientId!==""&&Y.clientSecret!==""&&!Y.clientId.includes("your-")&&!Y.clientSecret.includes("your-"),z=Y.username&&Y.password&&Y.username.trim()!==""&&Y.password.trim()!=="";if(!J&&!z)throw Error("ServiceNow credentials not configured. Please run: snow-flow auth login");if(!J&&z)return S("[Auth] Using Basic auth (no OAuth credentials configured)"),this.authenticateWithBasicAuth(Y);if(Y.accessToken){let Z=Y.tokenExpiry||0;if(Z>0&&Z<Date.now())S("[Auth] Pre-loaded access token from context has EXPIRED, skipping to refresh flow..."),Y.accessToken=void 0;else{S("[Auth] Using pre-loaded access token from context");let H=Z||Date.now()+3600000;return this.tokenCache.set(X,{accessToken:Y.accessToken,refreshToken:Y.refreshToken||"",expiresAt:H,instanceUrl:Y.instanceUrl}),await this.saveTokenCache(),Y.accessToken}}let Q=Y.refreshToken,G=this.tokenCache.get(X);if(!Q&&G)Q=G.refreshToken;if(Q)try{S("[Auth] Attempting OAuth refresh token flow...");let Z=`${Y.instanceUrl}/oauth_token.do`,H=(await Y4.post(Z,new URLSearchParams({grant_type:"refresh_token",client_id:Y.clientId,client_secret:Y.clientSecret,refresh_token:Q}),{headers:{"Content-Type":"application/x-www-form-urlencoded"},timeout:1e4})).data,W=Date.now()+H.expires_in*1000-60000;return this.tokenCache.set(X,{accessToken:H.access_token,refreshToken:H.refresh_token||Q,expiresAt:W,instanceUrl:Y.instanceUrl}),await this.saveTokenCache(),S("[Auth] Access token refreshed successfully (OAuth Refresh Token)"),H.access_token}catch(Z){S("[Auth] OAuth refresh token flow failed:",Z.message),S("[Auth] Will try OAuth client credentials flow...")}try{S("[Auth] Attempting OAuth client credentials flow...");let Z=`${Y.instanceUrl}/oauth_token.do`,H=(await Y4.post(Z,new URLSearchParams({grant_type:"client_credentials",client_id:Y.clientId,client_secret:Y.clientSecret}),{headers:{"Content-Type":"application/x-www-form-urlencoded"},timeout:1e4})).data,W=Date.now()+H.expires_in*1000-60000;return this.tokenCache.set(X,{accessToken:H.access_token,refreshToken:H.refresh_token||"",expiresAt:W,instanceUrl:Y.instanceUrl}),await this.saveTokenCache(),S("[Auth] Access token acquired successfully (OAuth Client Credentials)"),H.access_token}catch(Z){if(S("[Auth] OAuth client credentials flow failed:",Z.message),Y.username&&Y.password&&Y.username.trim()!==""&&Y.password.trim()!=="")return S("[Auth] Will try username/password fallback..."),await this.authenticateWithPassword(Y);else throw S("[Auth] No username/password credentials available for fallback"),Error(`OAuth authentication failed: ${Z.message}. Please verify ServiceNow OAuth configuration.`)}throw Error("Authentication failed: All methods exhausted")}async authenticateWithBasicAuth(Y){let X=this.getCacheKey(Y.instanceUrl);try{let{username:J,password:z}=Y;if(!J||!z||J.trim()===""||z.trim()==="")throw Error("No username/password available in context for basic authentication");S("[Auth] Using Basic auth from auth.json credentials");let G=`Basic ${Buffer.from(`${J}:${z}`).toString("base64")}`,Z=Date.now()+86400000;this.tokenCache.set(X,{accessToken:G,refreshToken:"",expiresAt:Z,instanceUrl:Y.instanceUrl});try{return await Y4.get(`${Y.instanceUrl}/api/now/table/sys_user?sysparm_limit=1`,{headers:{Authorization:G,"Content-Type":"application/json"},timeout:1e4}),S("[Auth] Basic auth successful"),G}catch($){throw Error("Basic auth failed: Invalid credentials")}}catch(J){throw S("[Auth] Basic auth failed:",J.message),Error(`Authentication failed: ${J.message}`)}}async authenticateWithPassword(Y){let X=this.getCacheKey(Y.instanceUrl);try{let{username:J,password:z}=Y;if(!J||!z||J.trim()===""||z.trim()==="")J=process.env.SERVICENOW_USERNAME,z=process.env.SERVICENOW_PASSWORD;if(!J||!z||J.trim()===""||z.trim()==="")throw Error("No username/password available for basic authentication");S("[Auth] Using username/password authentication");let G=`Basic ${Buffer.from(`${J}:${z}`).toString("base64")}`,Z=Date.now()+86400000;this.tokenCache.set(X,{accessToken:G,refreshToken:"",expiresAt:Z,instanceUrl:Y.instanceUrl});try{return await Y4.get(`${Y.instanceUrl}/api/now/table/sys_user?sysparm_limit=1`,{headers:{Authorization:G,"Content-Type":"application/json"},timeout:1e4}),S("[Auth] Username/password authentication successful"),G}catch($){throw Error("Username/password authentication failed: Invalid credentials")}}catch(J){throw S("[Auth] Username/password authentication failed:",J.message),Error(`Authentication failed: ${J.message}`)}}isTokenValid(Y){let X=this.tokenCache.get(Y);if(!X)return!1;return Date.now()<X.expiresAt}invalidateToken(Y){this.tokenCache.delete(Y),this.clients.delete(Y),S("[Auth] Invalidated token for:",Y)}getCacheKey(Y){return Y.replace(/^https?:\/\//,"").replace(/\/$/,"").toLowerCase()}async loadTokenCache(){try{let Y=this.getTokenCachePath(),X=await i6.readFile(Y,"utf-8"),J=JSON.parse(X);Object.entries(J).forEach(([z,Q])=>{if(Q.expiresAt>Date.now())this.tokenCache.set(z,Q)}),S("[Auth] Loaded",this.tokenCache.size,"cached tokens")}catch(Y){if(Y.code!=="ENOENT")S("[Auth] Failed to load cache:",Y.message)}}async saveTokenCache(){try{let Y=this.getTokenCachePath(),X={};this.tokenCache.forEach((J,z)=>{X[z]=J}),await i6.mkdir($Y.dirname(Y),{recursive:!0}),await i6.writeFile(Y,JSON.stringify(X,null,2),"utf-8"),S("[Auth] Token cache saved")}catch(Y){S("[Auth] Failed to save cache:",Y.message)}}getTokenCachePath(){let Y=process.env.HOME||process.env.USERPROFILE||"/tmp";return $Y.join(Y,".snow-flow","token-cache.json")}clearCache(){this.tokenCache.clear(),this.clients.clear(),S("[Auth] Cache cleared")}getCacheStats(){let Y={cachedInstances:this.tokenCache.size,activeClients:this.clients.size,tokens:[]};return this.tokenCache.forEach((X,J)=>{let z=Math.max(0,X.expiresAt-Date.now());Y.tokens.push({instanceUrl:X.instanceUrl,expiresIn:z,valid:this.isTokenValid(J)})}),Y}}var E7=new hq;async function x(Y){return await E7.getAuthenticatedClient(Y)}class I extends Error{type;retryable;details;originalError;timestamp;context;constructor(Y,X,J={}){super(X);this.name="SnowFlowError",this.type=Y,this.retryable=J.retryable??this.isRetryableByType(Y),this.details=J.details,this.originalError=J.originalError,this.context=J.context,this.timestamp=new Date,Error.captureStackTrace(this,I)}isRetryableByType(Y){return["NETWORK_ERROR","TIMEOUT","CONNECTION_RESET","RATE_LIMIT_EXCEEDED"].includes(Y)}toToolResult(){return{success:!1,error:this.message,metadata:{errorType:this.type,retryable:this.retryable,details:this.details,timestamp:this.timestamp.toISOString(),...this.context}}}}var Rt={maxAttempts:3,backoff:"exponential",initialDelay:1000,maxDelay:1e4,retryableErrors:["ECONNRESET","ETIMEDOUT","ECONNREFUSED","RATE_LIMIT_EXCEEDED","NETWORK_ERROR","TIMEOUT"]};async function ft(Y,X={}){let J={...Rt,...X},z;for(let Q=1;Q<=J.maxAttempts;Q++)try{return S(`[ErrorHandler] Attempt ${Q}/${J.maxAttempts}`),await Y()}catch(G){z=G;let Z=HY(G);if(!Z.retryable)throw S("[ErrorHandler] Non-retryable error:",Z.type),Z;if(Q===J.maxAttempts)throw S("[ErrorHandler] All retry attempts exhausted"),Z;let $=yt(Q,J);S(`[ErrorHandler] Retrying in ${$}ms (attempt ${Q}/${J.maxAttempts})`),await ht($)}throw z||Error("Retry failed")}function yt(Y,X){let J;if(X.backoff==="exponential")J=X.initialDelay*Math.pow(2,Y-1);else J=X.initialDelay*Y;return Math.min(J,X.maxDelay)}function ht(Y){return new Promise((X)=>setTimeout(X,Y))}function HY(Y){if(Y instanceof I)return Y;if(Y.isAxiosError)return mt(Y);if(Y.response?.data?.error)return ut(Y);return new I("UNKNOWN_ERROR",Y.message||"Unknown error occurred",{retryable:!1,details:{name:Y.name,stack:Y.stack},originalError:Y})}function mt(Y){let X=Y.code,J=Y.response?.status;if(X==="ECONNRESET")return new I("CONNECTION_RESET","Connection reset by ServiceNow instance",{retryable:!0,details:{code:X,url:Y.config?.url},originalError:Y});if(X==="ETIMEDOUT"||X==="ECONNABORTED")return new I("TIMEOUT","Request timed out",{retryable:!0,details:{code:X,timeout:Y.config?.timeout},originalError:Y});if(X==="ENOTFOUND"||X==="ECONNREFUSED")return new I("NETWORK_ERROR","Network error: Cannot reach ServiceNow instance",{retryable:!0,details:{code:X,url:Y.config?.url},originalError:Y});if(J===401)return new I("UNAUTHORIZED","Authentication failed - token may be expired",{retryable:!0,details:{status:J,url:Y.config?.url},originalError:Y});if(J===403)return new I("FORBIDDEN","Access forbidden - insufficient permissions",{retryable:!1,details:{status:J,url:Y.config?.url},originalError:Y});if(J===404)return new I("RESOURCE_NOT_FOUND","Resource not found in ServiceNow",{retryable:!1,details:{status:J,url:Y.config?.url},originalError:Y});if(J===429)return new I("RATE_LIMIT_EXCEEDED","ServiceNow API rate limit exceeded",{retryable:!0,details:{status:J,retryAfter:Y.response?.headers["retry-after"]},originalError:Y});return new I("INVALID_REQUEST",`HTTP ${J}: ${Y.message}`,{retryable:!1,details:{status:J,url:Y.config?.url,data:Y.response?.data},originalError:Y})}function ut(Y){let X=Y.response?.data,J=X?.error?.message||"ServiceNow API error",z=X?.error?.detail;if(z?.includes("ES5")||z?.includes("const")||z?.includes("let"))return new I("ES5_SYNTAX_ERROR","ES5 syntax violation detected",{retryable:!1,details:{message:J,detail:z},originalError:Y});if(z?.includes("coherence")||z?.includes("data."))return new I("WIDGET_COHERENCE_ERROR","Widget coherence validation failed",{retryable:!1,details:{message:J,detail:z},originalError:Y});if(z?.includes("update set")||z?.includes("conflict"))return new I("UPDATE_SET_CONFLICT","Update Set conflict detected",{retryable:!1,details:{message:J,detail:z},originalError:Y});return new I("INVALID_REQUEST",J,{retryable:!1,details:{message:J,detail:z,status:X?.status},originalError:Y})}function gt(Y,X,J={}){let z=HY(Y);return z.context={tool:X,...J},S(`[ErrorHandler] Error in ${X}:`,{type:z.type,message:z.message,retryable:z.retryable,details:z.details}),z}function N(Y,X={},J){var z={success:!0,data:Y,metadata:X};if(J)z.summary=J;return z}function M(Y,X={}){if(typeof Y==="string")return{success:!1,error:Y,metadata:X};return Y.toToolResult()}async function mq(Y,X,J={}){try{let z;if(J.retry)z=await ft(X,J.retryConfig);else z=await X();if(z&&typeof z==="object"&&(("success"in z)||("error"in z))){let Q=z;return{...Q,metadata:{tool:Y,timestamp:new Date().toISOString(),...Q.metadata||{}}}}return N(z,{tool:Y,timestamp:new Date().toISOString()})}catch(z){let Q=gt(z,Y,J.context);return M(Q)}}var i1={success:"",error:"",warning:"",info:"",bullet:"",arrow:"",indent:"  "};class uq{lines=[];success(Y){return this.lines.push(`${i1.success} ${Y}`),this}error(Y){return this.lines.push(`${i1.error} ${Y}`),this}warning(Y){return this.lines.push(`${i1.warning} ${Y}`),this}info(Y){return this.lines.push(`${i1.info} ${Y}`),this}field(Y,X,J=1){if(X===null||X===void 0||X==="")return this;var z=i1.indent.repeat(J);return this.lines.push(`${z}${Y}: ${X}`),this}fields(Y,X=1){for(var J in Y)if(Y.hasOwnProperty(J))this.field(J,Y[J],X);return this}bullet(Y,X=1){var J=i1.indent.repeat(X);return this.lines.push(`${J}${i1.bullet} ${Y}`),this}bullets(Y,X=1){for(var J=0;J<Y.length;J++)this.bullet(Y[J],X);return this}url(Y,X,J=1){var z=i1.indent.repeat(J);return this.lines.push(`${z}${Y}: ${X}`),this}arrow(Y,X,J=1){var z=i1.indent.repeat(J);return this.lines.push(`${z}${Y} ${i1.arrow} ${X}`),this}blank(){return this.lines.push(""),this}divider(Y="",X=40){return this.lines.push(Y.repeat(X)),this}section(Y){return this.blank(),this.lines.push(Y),this}line(Y){return this.lines.push(Y),this}indented(Y,X=1){var J=i1.indent.repeat(X);return this.lines.push(`${J}${Y}`),this}tableRow(Y,X){var J=Y.map(function(z,Q){if(X&&X[Q])return z.toString().padEnd(X[Q]);return z.toString()}).join("  ");return this.lines.push(i1.indent+J),this}count(Y,X,J){var z=Y===1?X:J||X+"s";return this.lines.push(`${i1.indent}Found ${Y} ${z}`),this}build(){return this.lines.join(`
`)}isEmpty(){return this.lines.length===0}}function WY(){return new uq}function l0(Y){if(Y===null||Y===void 0)return"";if(typeof Y==="string")return Y;if(typeof Y==="number")return String(Y);if(typeof Y==="boolean")return String(Y);if(typeof Y==="object"){if("display_value"in Y&&Y.display_value!==null&&Y.display_value!==void 0)return String(Y.display_value);if("value"in Y&&Y.value!==null&&Y.value!==void 0)return String(Y.value);if(Array.isArray(Y)&&Y.length>0)return l0(Y[0]);if("name"in Y)return String(Y.name);if("label"in Y)return String(Y.label);if("sys_id"in Y)return String(Y.sys_id);try{var X=JSON.stringify(Y);return X.length>100?X.substring(0,97)+"...":X}catch(J){return"[complex object]"}}return String(Y)}var pq={incident:{table:"incident",label:"Incident",defaultFields:["number","short_description","description","state","priority","urgency","impact","assigned_to","assignment_group","caller_id","category","subcategory","opened_at","resolved_at","closed_at"],numberField:"number"},problem:{table:"problem",label:"Problem",defaultFields:["number","short_description","description","state","priority","assigned_to","assignment_group","opened_at","resolved_at"],numberField:"number"},change:{table:"change_request",label:"Change Request",defaultFields:["number","short_description","description","state","type","priority","risk","impact","assigned_to","assignment_group","start_date","end_date","cab_required"],numberField:"number"},change_request:{table:"change_request",label:"Change Request",defaultFields:["number","short_description","description","state","type","priority","risk","impact","assigned_to","assignment_group","start_date","end_date"],numberField:"number"},change_task:{table:"change_task",label:"Change Task",defaultFields:["number","short_description","state","assigned_to","change_request"],numberField:"number"},request:{table:"sc_request",label:"Request",defaultFields:["number","short_description","state","requested_for","opened_by","opened_at","price"],numberField:"number"},sc_request:{table:"sc_request",label:"Request",defaultFields:["number","short_description","state","requested_for","opened_by"],numberField:"number"},request_item:{table:"sc_req_item",label:"Requested Item",defaultFields:["number","short_description","state","cat_item","request","quantity","price"],numberField:"number"},task:{table:"sc_task",label:"Catalog Task",defaultFields:["number","short_description","state","assigned_to","request_item"],numberField:"number"},ci:{table:"cmdb_ci",label:"Configuration Item",defaultFields:["name","sys_class_name","operational_status","install_status","location","assigned_to","support_group","manufacturer","model_id"],numberField:"name"},cmdb_ci:{table:"cmdb_ci",label:"Configuration Item",defaultFields:["name","sys_class_name","operational_status","install_status","location"],numberField:"name"},server:{table:"cmdb_ci_server",label:"Server",defaultFields:["name","ip_address","os","os_version","cpu_count","ram","disk_space","operational_status"],numberField:"name"},computer:{table:"cmdb_ci_computer",label:"Computer",defaultFields:["name","ip_address","os","os_version","cpu_type","ram","operational_status"],numberField:"name"},ci_relationship:{table:"cmdb_rel_ci",label:"CI Relationship",defaultFields:["parent","child","type"],numberField:"sys_id"},user:{table:"sys_user",label:"User",defaultFields:["user_name","first_name","last_name","email","active","department","location","manager","title"],numberField:"user_name"},sys_user:{table:"sys_user",label:"User",defaultFields:["user_name","first_name","last_name","email","active","department"],numberField:"user_name"},group:{table:"sys_user_group",label:"Group",defaultFields:["name","description","manager","email","active","type"],numberField:"name"},sys_user_group:{table:"sys_user_group",label:"Group",defaultFields:["name","description","manager","email","active"],numberField:"name"},group_member:{table:"sys_user_grmember",label:"Group Member",defaultFields:["user","group"],numberField:"sys_id"},asset:{table:"alm_asset",label:"Asset",defaultFields:["display_name","asset_tag","model","serial_number","install_status","assigned_to","location","cost","acquisition_method"],numberField:"asset_tag"},alm_asset:{table:"alm_asset",label:"Asset",defaultFields:["display_name","asset_tag","model","serial_number","install_status"],numberField:"asset_tag"},hardware_asset:{table:"alm_hardware",label:"Hardware Asset",defaultFields:["display_name","asset_tag","model","serial_number","install_status","ci"],numberField:"asset_tag"},software_license:{table:"alm_license",label:"Software License",defaultFields:["display_name","product","license_type","quantity","rights","start_date","end_date"],numberField:"display_name"},hr_case:{table:"sn_hr_core_case",label:"HR Case",defaultFields:["number","short_description","state","hr_service","opened_for","assigned_to","opened_at"],numberField:"number"},hr_task:{table:"sn_hr_core_task",label:"HR Task",defaultFields:["number","short_description","state","assigned_to","parent"],numberField:"number"},customer_case:{table:"sn_customerservice_case",label:"Customer Case",defaultFields:["number","short_description","state","account","contact","assigned_to","priority"],numberField:"number"},customer_account:{table:"customer_account",label:"Customer Account",defaultFields:["name","account_code","primary_contact","phone","city","country"],numberField:"name"},customer_contact:{table:"customer_contact",label:"Customer Contact",defaultFields:["name","email","phone","account","active"],numberField:"name"},project:{table:"pm_project",label:"Project",defaultFields:["number","short_description","state","project_manager","start_date","end_date","percent_complete"],numberField:"number"},project_task:{table:"pm_project_task",label:"Project Task",defaultFields:["number","short_description","state","assigned_to","parent","percent_complete"],numberField:"number"},purchase_order:{table:"proc_po",label:"Purchase Order",defaultFields:["number","short_description","state","vendor","ordered_by","total_cost"],numberField:"number"},knowledge_article:{table:"kb_knowledge",label:"Knowledge Article",defaultFields:["number","short_description","text","workflow_state","author","kb_knowledge_base","category"],numberField:"number"},kb_knowledge:{table:"kb_knowledge",label:"Knowledge Article",defaultFields:["number","short_description","text","workflow_state","author"],numberField:"number"},security_incident:{table:"sn_si_incident",label:"Security Incident",defaultFields:["number","short_description","state","priority","assigned_to","category"],numberField:"number"},devops_change:{table:"sn_devops_change",label:"DevOps Change",defaultFields:["number","short_description","state","pipeline","artifact"],numberField:"number"}},pt=Object.keys(pq),gq={incident:["short_description","description","caller_id","urgency","impact","priority","category","subcategory","assignment_group","assigned_to","configuration_item","state","work_notes","comments"],problem:["short_description","description","priority","assignment_group","assigned_to","category","subcategory","state","work_notes","related_incidents"],change_request:["short_description","description","type","priority","risk","impact","assignment_group","assigned_to","start_date","end_date","justification","implementation_plan","backout_plan","test_plan","state","cab_required"],change:["short_description","description","type","priority","risk","impact","assignment_group","assigned_to","start_date","end_date","justification","implementation_plan","backout_plan","test_plan","state","cab_required"],change_task:["short_description","description","change_request","assignment_group","assigned_to","state","planned_start_date","planned_end_date"],request:["short_description","description","requested_for","price","state"],request_item:["short_description","cat_item","request","requested_for","quantity","state"],task:["short_description","description","request_item","assignment_group","assigned_to","state"],ci:["name","sys_class_name","operational_status","install_status","location","assigned_to","support_group","manufacturer","model_id","serial_number","ip_address","mac_address"],cmdb_ci:["name","sys_class_name","operational_status","install_status","location","assigned_to","support_group"],server:["name","ip_address","os","os_version","cpu_count","cpu_type","ram","disk_space","operational_status","install_status","location","assigned_to","support_group"],computer:["name","ip_address","os","os_version","cpu_type","ram","operational_status","install_status","location","assigned_to"],ci_relationship:["parent","child","type"],user:["user_name","first_name","last_name","email","active","department","location","manager","title","phone","mobile_phone","employee_number"],sys_user:["user_name","first_name","last_name","email","active","department","location","manager","title"],group:["name","description","manager","email","active","type","parent"],sys_user_group:["name","description","manager","email","active","type"],group_member:["user","group"],asset:["display_name","asset_tag","model","serial_number","install_status","assigned_to","location","cost","acquisition_method","vendor","warranty_expiration"],hr_case:["short_description","description","hr_service","opened_for","assigned_to","priority","state"],hr_task:["short_description","description","parent","assigned_to","state"],customer_case:["short_description","description","account","contact","assigned_to","priority","state","product"],customer_account:["name","account_code","primary_contact","phone","city","state","country","website"],customer_contact:["name","first_name","last_name","email","phone","account","active","title"],project:["short_description","description","project_manager","start_date","end_date","state","percent_complete","primary_goal"],project_task:["short_description","description","parent","assigned_to","start_date","end_date","state","percent_complete"],purchase_order:["short_description","description","vendor","ordered_by","total_cost","state","ship_to"],knowledge_article:["short_description","text","kb_knowledge_base","category","author","workflow_state","valid_to"]},cq={name:"snow_record_manage",description:`\uD83D\uDD25 PRIMARY TOOL for ALL ServiceNow record operations. USE THIS for: create incident, update incident, get incident, delete incident, query incidents, create change, update change, create problem, update problem, create user, update user, create asset, update asset, create CI, and ANY other record operation.

 ACTIONS: create | get | update | delete | query

\uD83D\uDCCB SUPPORTED TABLES (use friendly names):
 ITSM: incident, problem, change, change_request, change_task, request, task
 CMDB: ci, server, computer, ci_relationship
 Users: user, group, group_member
 Assets: asset, hardware_asset, software_license
 HR/CSM: hr_case, hr_task, customer_case, customer_account
 Projects: project, project_task
 Other: purchase_order, knowledge_article

\uD83D\uDCA1 EXAMPLES:
 Update incident: { action: 'update', table: 'incident', sys_id: '...', state: 6 }
 Create incident: { action: 'create', table: 'incident', short_description: '...', urgency: 2 }
 Query incidents: { action: 'query', table: 'incident', query: 'state=1' }
 Get by number: { action: 'get', table: 'incident', number: 'INC0010001' }`,category:"core-operations",subcategory:"crud",use_cases:["create incident","update incident","get incident","delete incident","query incidents","create change","update change","get change","delete change","query changes","create problem","update problem","get problem","delete problem","query problems","create user","update user","get user","delete user","query users","create asset","update asset","get asset","delete asset","query assets","create ci","update ci","get ci","delete ci","query ci","create record","update record","get record","delete record","query records","incident management","change management","problem management","user management","modify incident","edit incident","change incident state","assign incident","modify change","edit change","modify problem","edit problem"],complexity:"intermediate",frequency:"high",permission:"write",allowedRoles:["developer","admin"],inputSchema:{type:"object",properties:{action:{type:"string",description:"Operation to perform",enum:["create","get","update","delete","query"]},table:{type:"string",description:"Table name or preset (incident, change, user, asset, etc.)"},sys_id:{type:"string",description:"[get/update/delete] Record sys_id"},number:{type:"string",description:"[get] Record number (e.g., INC0010001, CHG0001234)"},data:{type:"object",description:"[create/update] Field values for the record (alternative to helper shortcuts)"},short_description:{type:"string",description:"[create/update] Brief description (incident, problem, change, etc.)"},description:{type:"string",description:"[create/update] Detailed description"},caller_id:{type:"string",description:"[incident] User sys_id or username of caller"},urgency:{type:"number",description:"[incident/problem] 1=High, 2=Medium, 3=Low",enum:[1,2,3],default:3},impact:{type:"number",description:"[incident/change] 1=High, 2=Medium, 3=Low",enum:[1,2,3],default:3},priority:{type:"number",description:"[incident/problem/change] 1=Critical, 2=High, 3=Moderate, 4=Low, 5=Planning",enum:[1,2,3,4,5]},category:{type:"string",description:'[incident/problem] Category (e.g., "software", "hardware", "network")'},subcategory:{type:"string",description:"[incident/problem] Subcategory"},assignment_group:{type:"string",description:"[incident/change/problem] Assignment group sys_id or name"},assigned_to:{type:"string",description:"[incident/change/problem] Assigned user sys_id or username"},configuration_item:{type:"string",description:"[incident] Configuration Item sys_id or name"},work_notes:{type:"string",description:"[incident/change/problem] Work notes (internal)"},comments:{type:"string",description:"[incident/change/problem] Additional comments (customer visible)"},state:{type:"number",description:"[incident] State: 1=New, 2=InProgress, 3=OnHold, 6=Resolved, 7=Closed"},type:{type:"string",description:"[change] Change type",enum:["normal","standard","emergency"]},risk:{type:"number",description:"[change] Risk level: 1=Very High, 2=High, 3=Moderate, 4=Low",enum:[1,2,3,4]},start_date:{type:"string",description:"[change/project] Planned start date (YYYY-MM-DD HH:mm:ss)"},end_date:{type:"string",description:"[change/project] Planned end date (YYYY-MM-DD HH:mm:ss)"},justification:{type:"string",description:"[change] Business justification"},implementation_plan:{type:"string",description:"[change] Implementation plan"},backout_plan:{type:"string",description:"[change] Backout/rollback plan"},test_plan:{type:"string",description:"[change] Test plan"},cab_required:{type:"boolean",description:"[change] Requires CAB approval",default:!1},user_name:{type:"string",description:"[user] Username (login ID)"},first_name:{type:"string",description:"[user/contact] First name"},last_name:{type:"string",description:"[user/contact] Last name"},email:{type:"string",description:"[user/contact/group] Email address"},active:{type:"boolean",description:"[user/group/contact] Active status",default:!0},department:{type:"string",description:"[user] Department sys_id or name"},location:{type:"string",description:"[user/ci/asset] Location sys_id or name"},manager:{type:"string",description:"[user/group] Manager sys_id or username"},title:{type:"string",description:"[user/contact] Job title"},phone:{type:"string",description:"[user/contact/account] Phone number"},name:{type:"string",description:"[group/ci/asset/account] Name"},ip_address:{type:"string",description:"[ci/server/computer] IP address"},mac_address:{type:"string",description:"[ci] MAC address"},os:{type:"string",description:"[server/computer] Operating system"},os_version:{type:"string",description:"[server/computer] OS version"},operational_status:{type:"number",description:"[ci] 1=Operational, 2=Non-Operational, 3=Repair, 4=Retired",enum:[1,2,3,4]},install_status:{type:"number",description:"[ci/asset] 1=Installed, 2=In Stock, 3=On Order, 6=In Maintenance, 7=Retired",enum:[1,2,3,6,7]},support_group:{type:"string",description:"[ci] Support group sys_id or name"},manufacturer:{type:"string",description:"[ci] Manufacturer sys_id or name"},model_id:{type:"string",description:"[ci] Model sys_id or name"},serial_number:{type:"string",description:"[ci/asset] Serial number"},cpu_count:{type:"number",description:"[server] Number of CPUs"},cpu_type:{type:"string",description:"[server/computer] CPU type"},ram:{type:"number",description:"[server/computer] RAM in MB"},disk_space:{type:"number",description:"[server] Disk space in GB"},parent:{type:"string",description:"[ci_relationship/project_task/hr_task] Parent CI/record sys_id"},child:{type:"string",description:"[ci_relationship] Child CI sys_id"},relationship_type:{type:"string",description:"[ci_relationship] Relationship type sys_id or name"},display_name:{type:"string",description:"[asset] Display name"},asset_tag:{type:"string",description:"[asset] Asset tag"},model:{type:"string",description:"[asset] Model sys_id or name"},cost:{type:"number",description:"[asset] Cost"},acquisition_method:{type:"string",description:"[asset] Acquisition method"},vendor:{type:"string",description:"[asset/purchase_order] Vendor sys_id or name"},warranty_expiration:{type:"string",description:"[asset] Warranty expiration date (YYYY-MM-DD)"},hr_service:{type:"string",description:"[hr_case] HR Service sys_id or name"},opened_for:{type:"string",description:"[hr_case] Opened for user sys_id or username"},account:{type:"string",description:"[customer_case/contact] Customer account sys_id or name"},contact:{type:"string",description:"[customer_case] Customer contact sys_id or name"},product:{type:"string",description:"[customer_case] Product sys_id or name"},account_code:{type:"string",description:"[customer_account] Account code"},primary_contact:{type:"string",description:"[customer_account] Primary contact sys_id or name"},city:{type:"string",description:"[customer_account] City"},country:{type:"string",description:"[customer_account] Country"},website:{type:"string",description:"[customer_account] Website URL"},project_manager:{type:"string",description:"[project] Project manager sys_id or username"},percent_complete:{type:"number",description:"[project/project_task] Percent complete (0-100)"},primary_goal:{type:"string",description:"[project] Primary goal"},text:{type:"string",description:"[knowledge_article] Article body/content"},kb_knowledge_base:{type:"string",description:"[knowledge_article] Knowledge base sys_id or name"},author:{type:"string",description:"[knowledge_article] Author sys_id or username"},workflow_state:{type:"string",description:"[knowledge_article] Workflow state",enum:["draft","review","published","retired"]},valid_to:{type:"string",description:"[knowledge_article] Valid until date (YYYY-MM-DD)"},auto_assign:{type:"boolean",description:"[incident/change/problem] Auto-assign based on category and assignment rules",default:!1},query:{type:"string",description:'[query] Encoded query string (e.g., "state=1^priority<=2^active=true")'},limit:{type:"number",description:"[query] Maximum records to return (default: 20, max: 1000)",default:20},offset:{type:"number",description:"[query] Number of records to skip for pagination",default:0},order_by:{type:"string",description:"[query] Field to order by (prefix with - for descending)"},fields:{type:"string",description:"[get/query] Comma-separated fields to return"},display_value:{type:"boolean",description:"Return display values instead of sys_ids",default:!0},validate_references:{type:"boolean",description:"[create] Validate reference fields exist",default:!0},check_version:{type:"boolean",description:"[update] Perform optimistic locking check",default:!1},expected_version:{type:"string",description:"[update] Expected sys_mod_count for optimistic locking"},check_references:{type:"boolean",description:"[delete] Check for dependent records",default:!0},soft_delete:{type:"boolean",description:"[delete] Mark as inactive instead of hard delete",default:!1},force:{type:"boolean",description:"[delete] Force deletion even with dependencies",default:!1}},required:["action","table"]}};async function dq(Y,X){var{action:J,table:z}=Y,Q=ct(z);try{switch(J){case"create":return await dt(Y,X,Q);case"get":return await lt(Y,X,Q);case"update":return await it(Y,X,Q);case"delete":return await nt(Y,X,Q);case"query":return await ot(Y,X,Q);default:return M("Unknown action: "+J+". Valid actions: create, get, update, delete, query")}}catch(G){return M(G instanceof I?G:new I("SERVICENOW_API_ERROR","Record "+J+" failed: "+G.message,{originalError:G,details:{table:Q.table}}))}}function ct(Y){var X=pq[Y.toLowerCase()];if(X)return{table:X.table,label:X.label,defaultFields:X.defaultFields,numberField:X.numberField||"number",isPreset:!0};return{table:Y,label:Y,defaultFields:["sys_id","sys_created_on","sys_updated_on"],numberField:"number",isPreset:!1}}function lq(Y,X){var J=Y.data?{...Y.data}:{},z=gq[X]||gq[X.toLowerCase()]||[],Q=["short_description","description","assignment_group","assigned_to","state","active","work_notes","comments"],G=[...new Set([...z,...Q])];for(var Z=0;Z<G.length;Z++){var $=G[Z];if(Y[$]!==void 0&&Y[$]!==null)J[$]=Y[$]}if(Y.configuration_item!==void 0)J.cmdb_ci=Y.configuration_item;if(Y.relationship_type!==void 0)J.type=Y.relationship_type;return J}async function dt(Y,X,J){var z=J.table,Q=Y.table.toLowerCase(),G=Y.display_value!==!1,Z=Y.validate_references!==!1,$=Y.auto_assign===!0,H=lq(Y,Q);if(Object.keys(H).length===0)return M("No data provided. Use helper shortcuts (short_description, priority, etc.) or data object.");var W=await x(X);if(Q==="incident"){if(H.urgency===void 0)H.urgency=3;if(H.impact===void 0)H.impact=3}if(Q==="change"||Q==="change_request"){if(H.type===void 0)H.type="normal";if(H.risk===void 0)H.risk=4}if($&&(Q==="incident"||Q==="change"||Q==="problem")){var K=await Ye(W,z,H);if(K.assignment_group)H.assignment_group=K.assignment_group;if(K.assigned_to)H.assigned_to=K.assigned_to}H=await iq(W,z,H);var U=await W.get("/api/now/table/sys_db_object",{params:{sysparm_query:"name="+z,sysparm_fields:"name,label",sysparm_limit:1}});if(!U.data.result||U.data.result.length===0)throw new I("VALIDATION_ERROR","Table '"+z+"' does not exist.",{details:{table:z,available_presets:pt.slice(0,20)}});if(Z){var B=await W.get("/api/now/table/sys_dictionary",{params:{sysparm_query:"name="+z+"^internal_type=reference",sysparm_fields:"element,reference",sysparm_limit:1000}});for(var O=0;O<(B.data.result||[]).length;O++){var V=B.data.result[O],L=V.element,q=V.reference;if(H[L])try{var F=await W.get("/api/now/table/"+q+"/"+H[L],{params:{sysparm_fields:"sys_id"}});if(!F.data.result)throw new I("VALIDATION_ERROR","Reference validation failed: Field '"+L+"' points to non-existent record.",{details:{field:L,value:H[L],reference_table:q}})}catch(j){if(j instanceof I)throw j}}}try{var P=await W.post("/api/now/table/"+z,H,{params:{sysparm_display_value:G?"all":"false",sysparm_exclude_reference_link:"true"}}),A=P.data.result,w=A[J.numberField]||A.number||A.name||A.sys_id,v={action:"create",created:!0,sys_id:l0(A.sys_id),table:z,table_label:J.label,record:A,url:X.instanceUrl+"/nav_to.do?uri="+z+".do?sys_id="+l0(A.sys_id)};if(v[J.numberField]=l0(w),$){if(v.auto_assigned=!0,H.assignment_group)v.assigned_group=H.assignment_group;if(H.assigned_to)v.assigned_user=H.assigned_to}return N(v)}catch(j){var T=j.response?.data?.error||{},D=T.message||j.message;throw new I("VALIDATION_ERROR","Failed to create record in '"+J.label+"': "+D,{details:{table:z,data:H,snow_error:T}})}}async function lt(Y,X,J){var z=J.table,Q=Y.sys_id,G=Y.number,Z=Y.fields,$=Y.display_value!==!1;if(!Q&&!G)return M("sys_id or number is required for get action");var H=await x(X),W=null,K=Z||J.defaultFields.join(",");if(Q)try{var U=await H.get("/api/now/table/"+z+"/"+Q,{params:{sysparm_fields:K,sysparm_display_value:$?"all":"false"}});W=U.data.result}catch(L){}if(!W&&G){var B=J.numberField||"number",O=await H.get("/api/now/table/"+z,{params:{sysparm_query:B+"="+G,sysparm_fields:K,sysparm_display_value:$?"all":"false",sysparm_limit:1}});if(O.data.result&&O.data.result.length>0)W=O.data.result[0]}if(!W)return M(J.label+" not found: "+(Q||G));var V={action:"get",found:!0,sys_id:l0(W.sys_id),table:z,table_label:J.label,record:W,url:X.instanceUrl+"/nav_to.do?uri="+z+".do?sys_id="+W.sys_id};return V[J.numberField]=l0(W[J.numberField]||W.number||W.name),N(V)}async function it(Y,X,J){var z=J.table,Q=Y.table.toLowerCase(),G=Y.sys_id,Z=Y.display_value!==!1,$=Y.check_version===!0,H=Y.expected_version;if(!G)return M("sys_id is required for update action");var W=lq(Y,Q);if(Object.keys(W).length===0)return M("No data provided for update.");var K=await x(X);W=await iq(K,z,W);var U=await K.get("/api/now/table/"+z+"/"+G,{params:{sysparm_fields:$?"sys_id,sys_mod_count":"sys_id"}});if(!U.data.result)throw new I("NOT_FOUND_ERROR",J.label+" not found with sys_id '"+G+"'",{details:{table:z,sys_id:G}});if($&&H){var B=U.data.result.sys_mod_count;if(B!==H)throw new I("VALIDATION_ERROR","Record has been modified by another user (optimistic lock conflict)",{details:{expected_version:H,current_version:B}})}var O=await K.patch("/api/now/table/"+z+"/"+G,W,{params:{sysparm_display_value:Z?"all":"false",sysparm_exclude_reference_link:"true"}}),V=O.data.result,L=Object.keys(W),q={action:"update",updated:!0,sys_id:l0(V.sys_id),table:z,table_label:J.label,changed_fields:L,record:V,new_version:l0(V.sys_mod_count),url:X.instanceUrl+"/nav_to.do?uri="+z+".do?sys_id="+l0(V.sys_id)};return q[J.numberField]=l0(V[J.numberField]||V.number||V.name),N(q)}async function nt(Y,X,J){var z=J.table,Q=Y.sys_id,G=Y.check_references!==!1,Z=Y.soft_delete===!0,$=Y.force===!0;if(!Q)return M("sys_id is required for delete action");var H=await x(X),W=await H.get("/api/now/table/"+z+"/"+Q,{params:{sysparm_fields:"sys_id,"+J.numberField}});if(!W.data.result)throw new I("NOT_FOUND_ERROR",J.label+" not found with sys_id '"+Q+"'",{details:{table:z,sys_id:Q}});var K=W.data.result,U=[];if(G&&!$){var B=await H.get("/api/now/table/sys_dictionary",{params:{sysparm_query:"reference="+z+"^internal_type=reference",sysparm_fields:"name,element",sysparm_limit:100}});for(var O=0;O<(B.data.result||[]).length;O++){var V=B.data.result[O];try{var L=await H.get("/api/now/table/"+V.name,{params:{sysparm_query:V.element+"="+Q,sysparm_fields:"sys_id,number",sysparm_limit:5}});if(L.data.result&&L.data.result.length>0)U.push({table:V.name,field:V.element,count:L.data.result.length})}catch(A){}}if(U.length>0)throw new I("VALIDATION_ERROR","Cannot delete "+J.label+" with dependencies. Use force=true to override.",{details:{dependencies:U}})}if(Z){var q=await H.get("/api/now/table/sys_dictionary",{params:{sysparm_query:"name="+z+"^element=active",sysparm_fields:"element",sysparm_limit:1}});if(q.data.result&&q.data.result.length>0){await H.patch("/api/now/table/"+z+"/"+Q,{active:"false"});var F={action:"delete",deleted:!0,soft_delete:!0,sys_id:Q,table:z,table_label:J.label,message:J.label+" marked as inactive (soft delete)"};return F[J.numberField]=l0(K[J.numberField]||K.number),N(F)}else throw new I("VALIDATION_ERROR","Table '"+z+"' does not support soft delete (no 'active' field)",{details:{table:z}})}await H.delete("/api/now/table/"+z+"/"+Q);var P={action:"delete",deleted:!0,soft_delete:!1,sys_id:Q,table:z,table_label:J.label,message:J.label+" permanently deleted",forced:$&&U.length>0};return P[J.numberField]=l0(K[J.numberField]||K.number),N(P)}async function ot(Y,X,J){var z=J.table,Q=Y.query||"",G=Y.limit||20,Z=Y.offset||0,$=Y.order_by,H=Y.fields,W=Y.display_value!==!1,K=await x(X),U=H||J.defaultFields.join(","),B={sysparm_limit:Math.min(G,1000),sysparm_offset:Z,sysparm_fields:U,sysparm_display_value:W?"all":"false",sysparm_exclude_reference_link:"true"};if(Q)B.sysparm_query=Q;if($)if($.charAt(0)==="-")B.sysparm_query=(B.sysparm_query?B.sysparm_query+"^":"")+"ORDERBYDESC"+$.substring(1);else B.sysparm_query=(B.sysparm_query?B.sysparm_query+"^":"")+"ORDERBY"+$;var O=await K.get("/api/now/table/"+z,{params:B}),V=O.data.result||[],L={sysparm_count:!0};if(Q)L.sysparm_query=Q;var q=await K.get("/api/now/table/"+z,{params:L}),F=parseInt(q.headers["x-total-count"]||"0",10),P=[];P.push(" Query completed"),P.push("  table: "+z),P.push("  Records: "+V.length+(F>V.length?" of "+F:""));var A=Math.min(V.length,10);for(var w=0;w<A;w++){var v=V[w],T=l0(v[J.numberField])||l0(v.number)||l0(v.name)||l0(v.sys_id),D=l0(v.short_description)||l0(v.description)||l0(v.title)||l0(v.label)||"",j="   "+T;if(D){var E=D.length>50?D.substring(0,47)+"...":D;j+=" - "+E}P.push(j)}if(V.length>A)P.push("  ... and "+(V.length-A)+" more");if(F>V.length)P.push("  (Use offset="+(Z+V.length)+" to get next page)");return N({action:"query",table:z,table_label:J.label,count:V.length,total_count:F,offset:Z,limit:G,has_more:Z+V.length<F,query:Q||"(all records)",records:V.map(function(f){var i={sys_id:l0(f.sys_id),...f,_url:X.instanceUrl+"/nav_to.do?uri="+z+".do?sys_id="+l0(f.sys_id)};return i[J.numberField]=l0(f[J.numberField]||f.number||f.name),i})},{},P.join(`
`))}async function iq(Y,X,J){var z={...J},Q=["caller_id","assigned_to","opened_for","manager","project_manager","author","contact","primary_contact","requested_for"];for(var G=0;G<Q.length;G++){var Z=Q[G];if(z[Z]&&!S7(z[Z])){var $=await at(Y,z[Z]);if($)z[Z]=$}}var H=["assignment_group","support_group"];for(var W=0;W<H.length;W++){var K=H[W];if(z[K]&&!S7(z[K])){var U=await st(Y,z[K]);if(U)z[K]=U}}if(z.cmdb_ci&&!S7(z.cmdb_ci)){var B=await rt(Y,z.cmdb_ci);if(B)z.cmdb_ci=B}if(z.department&&!S7(z.department)){var O=await tt(Y,z.department);if(O)z.department=O}if(z.location&&!S7(z.location)){var V=await et(Y,z.location);if(V)z.location=V}return z}function S7(Y){return/^[a-f0-9]{32}$/i.test(Y)}async function at(Y,X){try{var J=await Y.get("/api/now/table/sys_user",{params:{sysparm_query:"user_name="+X+"^ORemail="+X+"^ORname="+X,sysparm_fields:"sys_id",sysparm_limit:1}});if(J.data.result&&J.data.result.length>0)return J.data.result[0].sys_id}catch(z){}return null}async function st(Y,X){try{var J=await Y.get("/api/now/table/sys_user_group",{params:{sysparm_query:"name="+X,sysparm_fields:"sys_id",sysparm_limit:1}});if(J.data.result&&J.data.result.length>0)return J.data.result[0].sys_id}catch(z){}return null}async function rt(Y,X){try{var J=await Y.get("/api/now/table/cmdb_ci",{params:{sysparm_query:"name="+X,sysparm_fields:"sys_id",sysparm_limit:1}});if(J.data.result&&J.data.result.length>0)return J.data.result[0].sys_id}catch(z){}return null}async function tt(Y,X){try{var J=await Y.get("/api/now/table/cmn_department",{params:{sysparm_query:"name="+X,sysparm_fields:"sys_id",sysparm_limit:1}});if(J.data.result&&J.data.result.length>0)return J.data.result[0].sys_id}catch(z){}return null}async function et(Y,X){try{var J=await Y.get("/api/now/table/cmn_location",{params:{sysparm_query:"name="+X,sysparm_fields:"sys_id",sysparm_limit:1}});if(J.data.result&&J.data.result.length>0)return J.data.result[0].sys_id}catch(z){}return null}async function Ye(Y,X,J){var z={};if(J.category)try{var Q=await Y.get("/api/now/table/sysrule_assignment",{params:{sysparm_query:"table="+X+"^active=true^conditionLIKEcategory="+J.category,sysparm_fields:"group,user",sysparm_limit:1}});if(Q.data.result&&Q.data.result.length>0){var G=Q.data.result[0];if(G.group)z.assignment_group=typeof G.group==="object"?G.group.value:G.group;if(G.user)z.assigned_to=typeof G.user==="object"?G.user.value:G.user;return z}}catch($){}try{var Z=await Y.get("/api/now/table/sys_user_group",{params:{sysparm_query:"nameLIKE"+X+"^active=true",sysparm_fields:"sys_id,name",sysparm_limit:1}});if(Z.data.result&&Z.data.result.length>0)z.assignment_group=Z.data.result[0].sys_id}catch($){}return z}var Xe=["template","script","server_script","client_script","css","html","xml","json","payload","body","content","description","comments","work_notes","additional_comments","close_notes","resolution_notes","instructions","short_description","long_description"],DQ=200;function Je(Y,X){if(!X)return Y;return Y.map((J)=>{let z={};for(let[Q,G]of Object.entries(J))if(typeof G==="string"&&G.length>DQ)if(Xe.some(($)=>Q.toLowerCase().includes($))||G.length>DQ*2)z[Q]=G.substring(0,DQ)+`... [truncated, ${G.length} chars total]`;else z[Q]=G;else z[Q]=G;return z})}var nq={name:"snow_query_table",description:"Query any ServiceNow table with filtering, pagination, and field selection. Always returns sys_id for each record.",category:"core-operations",subcategory:"crud",use_cases:["query","read","records"],complexity:"beginner",frequency:"high",permission:"read",allowedRoles:["developer","stakeholder","admin"],inputSchema:{type:"object",properties:{table:{type:"string",description:"Table name to query (e.g., incident, task, sys_user)"},query:{type:"string",description:"Encoded query string (e.g., active=true^priority=1)"},fields:{type:"array",items:{type:"string"},description:"Fields to return (default: all fields)",default:[]},limit:{type:"number",description:"Maximum number of records to return",default:100,minimum:1,maximum:1e4},offset:{type:"number",description:"Number of records to skip (for pagination)",default:0,minimum:0},order_by:{type:"string",description:"Field to order by (prefix with - for descending, e.g., -sys_created_on)"},display_value:{type:"boolean",description:"Return display values instead of sys_ids for reference fields",default:!1},truncate_output:{type:"boolean",description:"Truncate large field values (scripts, templates, etc.) for cleaner output",default:!0}},required:["table"]}};async function oq(Y,X){let{table:J,query:z="",fields:Q=[],limit:G=100,offset:Z=0,order_by:$,display_value:H=!1,truncate_output:W=!0}=Y;try{let K=await x(X),U={sysparm_limit:G,sysparm_offset:Z};if(z)U.sysparm_query=z;if(Q.length>0){let q=Q.includes("sys_id")?Q:["sys_id",...Q];U.sysparm_fields=q.join(",")}if($){let q=$.startsWith("-")?"DESC":"ASC",F=$.replace(/^-/,"");U.sysparm_query=(U.sysparm_query||"")+`^ORDERBY${q}${F}`}if(H)U.sysparm_display_value="true";let O=(await K.get(`/api/now/table/${J}`,{params:U})).data.result,V=Je(O,W),L=[];if(L.push(`Found ${V.length} record(s) in ${J}`),V.length>0){L.push(""),L.push("Record Preview:");let q=Math.min(V.length,5);for(let F=0;F<q;F++){let P=V[F],A=P.sys_id||"unknown",w=P.number||P.name||P.short_description||P.title||A,v=[`sys_id: ${A}`];if(P.number)v.push(`number: ${P.number}`);if(P.name&&P.name!==P.number)v.push(`name: ${P.name}`);if(P.short_description)v.push(`short_description: ${P.short_description.substring(0,50)}${P.short_description.length>50?"...":""}`);if(P.state)v.push(`state: ${P.state}`);if(P.active!==void 0)v.push(`active: ${P.active}`);L.push(`  ${F+1}. ${w}`),L.push(`     ${v.join(" | ")}`)}if(V.length>5)L.push(`  ... and ${V.length-5} more records`)}if(V.length===G)L.push(""),L.push("Note: Results may be limited. Use offset parameter to paginate.");return N({records:V,count:V.length,total:V.length<G?V.length:"100+",has_more:V.length===G,truncated:W},{table:J,query:z,limit:G,offset:Z},L.join(`
`))}catch(K){return M(K.message)}}var aq={name:"snow_discover_table_fields",description:"Discover table schema with fields, types, relationships, and metadata",category:"development",subcategory:"schema",use_cases:["discovery","schema"],complexity:"intermediate",frequency:"medium",permission:"read",allowedRoles:["developer","stakeholder","admin"],inputSchema:{type:"object",properties:{table_name:{type:"string",description:"Table name to discover schema for"},include_relationships:{type:"boolean",description:"Include field relationships (reference fields)",default:!0},include_acls:{type:"boolean",description:"Include ACL information",default:!1},include_indexes:{type:"boolean",description:"Include index information",default:!1}},required:["table_name"]}};async function sq(Y,X){let{table_name:J,include_relationships:z=!0,include_acls:Q=!1,include_indexes:G=!1}=Y;try{let Z=await x(X),$=await Z.get("/api/now/table/sys_db_object",{params:{sysparm_query:`name=${J}`,sysparm_limit:1}});if($.data.result.length===0)return M(`Table not found: ${J}`);let H=$.data.result[0],K=(await Z.get("/api/now/table/sys_dictionary",{params:{sysparm_query:`name=${J}^element!=NULL^ORDERBYelement`,sysparm_limit:1000}})).data.result.map((V)=>({name:V.element,label:V.column_label,type:V.internal_type?.display_value||V.internal_type,max_length:V.max_length,mandatory:V.mandatory==="true",read_only:V.read_only==="true",default_value:V.default_value,reference:V.reference?.display_value||V.reference,help_text:V.help})),U=[];if(z)U=K.filter((L)=>L.type==="reference").map((L)=>({field:L.name,references_table:L.reference,type:"many-to-one"}));let B=[];if(Q)B=(await Z.get("/api/now/table/sys_security_acl",{params:{sysparm_query:`name=${J}`,sysparm_limit:100}})).data.result.map((L)=>({operation:L.operation,roles:L.roles,condition:L.condition,script:L.script?"Present":"None"}));let O=[];if(G)O=(await Z.get("/api/now/table/sys_db_index",{params:{sysparm_query:`table=${J}`,sysparm_limit:100}})).data.result.map((L)=>({name:L.name,fields:L.field_list,unique:L.unique==="true"}));return N({table:{name:J,label:H.label,extends:H.super_class?.display_value||null,sys_id:H.sys_id},fields:K,field_count:K.length,relationships:U,acls:Q?B:void 0,indexes:G?O:void 0})}catch(Z){return M(Z.message)}}var rq={name:"snow_get_by_sysid",description:"Get any ServiceNow record by sys_id with optional field selection",category:"core-operations",subcategory:"crud",use_cases:["read","records"],complexity:"beginner",frequency:"high",permission:"read",allowedRoles:["developer","stakeholder","admin"],inputSchema:{type:"object",properties:{table:{type:"string",description:"Table name (e.g., sp_widget, sys_ux_page, incident)"},sys_id:{type:"string",description:"sys_id of the record to retrieve"},fields:{type:"array",items:{type:"string"},description:"Specific fields to return (default: all)",default:[]},display_value:{type:"boolean",description:"Return display values for reference fields",default:!1}},required:["table","sys_id"]}};async function tq(Y,X){let{table:J,sys_id:z,fields:Q=[],display_value:G=!1}=Y;try{let Z=await x(X),$={};if(Q.length>0)$.sysparm_fields=Q.join(",");if(G)$.sysparm_display_value="true";let H=await Z.get(`/api/now/table/${J}/${z}`,{params:$});if(!H.data||!H.data.result)return M(`Record not found: ${J}/${z}`);let W=H.data.result;return N({found:!0,record:W,table:J,sys_id:z})}catch(Z){if(Z.response?.status===404)return N({found:!1,table:J,sys_id:z,error:"Record not found"});return M(Z.message)}}var KY={name:"snow_search_artifacts",description:"Search ServiceNow development artifacts (widgets, pages, scripts, flows, UI actions, client scripts). For data/table searches, use snow_query_table or snow_fuzzy_search instead.",category:"core-operations",subcategory:"search",use_cases:["artifact-search","development-search","find-widget","find-script"],complexity:"intermediate",frequency:"high",permission:"read",allowedRoles:["developer","stakeholder","admin"],inputSchema:{type:"object",properties:{query:{type:"string",description:"Search query - matches against name, title, and description fields"},types:{type:"array",items:{type:"string",enum:["widget","page","flow","script_include","business_rule","client_script","ui_action","ui_policy","ui_page","scheduled_job","all"]},description:"Artifact types to search (default: all)",default:["all"]},limit:{type:"number",description:"Maximum results per artifact type (default: 10)",default:10,minimum:1,maximum:50},include_inactive:{type:"boolean",description:"Include inactive/disabled artifacts",default:!1},search_tables:{type:"boolean",description:"Also search sys_db_object for matching table definitions (slower)",default:!1}},required:["query"]}},jQ={widget:{table:"sp_widget",name_field:"id",title_field:"name",active_field:"active",description:"Service Portal widgets",extra_fields:["template","css"]},page:{table:"sp_page",name_field:"id",title_field:"title",active_field:"active",description:"Service Portal pages"},flow:{table:"sys_hub_flow",name_field:"name",active_field:"active",description:"Flow Designer flows"},script_include:{table:"sys_script_include",name_field:"name",active_field:"active",description:"Script Includes (reusable server scripts)"},business_rule:{table:"sys_script",name_field:"name",active_field:"active",description:"Business Rules",extra_fields:["collection","when"]},client_script:{table:"sys_script_client",name_field:"name",active_field:"active",description:"Client Scripts",extra_fields:["table","type"]},ui_action:{table:"sys_ui_action",name_field:"name",active_field:"active",description:"UI Actions (buttons, links, context menus)",extra_fields:["table","action_name"]},ui_policy:{table:"sys_ui_policy",name_field:"short_description",active_field:"active",description:"UI Policies",extra_fields:["table","conditions"]},ui_page:{table:"sys_ui_page",name_field:"name",active_field:"active",description:"UI Pages (classic UI)",extra_fields:["category"]},scheduled_job:{table:"sysauto_script",name_field:"name",active_field:"active",description:"Scheduled Jobs"}};async function ze(Y,X,J,z,Q,G){try{let Z=[J.name_field];if(J.title_field)Z.push(J.title_field);Z.push("description");let $=Z.map((B)=>`${B}LIKE${z}`).join("^NQ"),H=!G&&J.active_field?`^${J.active_field}=true`:"",W=$+H,K=["sys_id",...Z,"sys_created_on","sys_updated_on"];if(J.active_field)K.push(J.active_field);if(J.extra_fields)K.push(...J.extra_fields);let U=await Y.get(`/api/now/table/${J.table}`,{params:{sysparm_query:W,sysparm_limit:Q,sysparm_fields:[...new Set(K)].join(",")},timeout:1e4});if(!U.data.result||U.data.result.length===0)return{type:X,table:J.table,description:J.description,count:0,artifacts:[]};return{type:X,table:J.table,description:J.description,count:U.data.result.length,artifacts:U.data.result.map((B)=>({sys_id:B.sys_id,name:B[J.name_field],title:J.title_field?B[J.title_field]:void 0,description:B.description,active:J.active_field?B[J.active_field]==="true":void 0,created:B.sys_created_on,updated:B.sys_updated_on,...J.extra_fields?.reduce((O,V)=>{if(B[V])O[V]=B[V];return O},{})||{}}))}}catch(Z){return{type:X,table:J.table,description:J.description,count:0,artifacts:[],error:Z.message}}}async function Qe(Y,X,J){try{let z=await Y.get("/api/now/table/sys_db_object",{params:{sysparm_query:`nameLIKE${X}^ORlabelLIKE${X}`,sysparm_limit:J,sysparm_fields:"sys_id,name,label,super_class,is_extendable"},timeout:15000});if(!z.data.result||z.data.result.length===0)return{type:"table",table:"sys_db_object",description:"Table definitions",count:0,artifacts:[]};return{type:"table",table:"sys_db_object",description:"Table definitions",count:z.data.result.length,artifacts:z.data.result.map((Q)=>({sys_id:Q.sys_id,name:Q.name,label:Q.label,super_class:Q.super_class?.display_value||Q.super_class,is_extendable:Q.is_extendable==="true"}))}}catch(z){return{type:"table",table:"sys_db_object",description:"Table definitions",count:0,artifacts:[],error:z.message}}}async function CQ(Y,X){let{query:J,types:z=["all"],limit:Q=10,include_inactive:G=!1,search_tables:Z=!1}=Y;if(!J||J.trim().length===0)return M("Search query cannot be empty");try{let $=await x(X),H=z.includes("all")?Object.keys(jQ):z.filter((L)=>L!=="all"&&jQ[L]),W=H.map((L)=>ze($,L,jQ[L],J,Q,G));if(Z)W.push(Qe($,J,Q));let K=await Promise.all(W),U=K.filter((L)=>L.count>0),B=K.filter((L)=>L.error),O=U.reduce((L,q)=>L+q.count,0),V={query:J,summary:{total_found:O,artifact_types_searched:H.length+(Z?1:0),artifact_types_with_results:U.length,include_inactive:G},found:U.map((L)=>({type:L.type,table:L.table,description:L.description,count:L.count,artifacts:L.artifacts})),message:O>0?`Found ${O} artifacts matching "${J}" across ${U.length} type(s)`:`No artifacts found matching "${J}"`};if(B.length>0)V.errors=B.map((L)=>({type:L.type,table:L.table,error:L.error}));if(!Z&&O===0)V.suggestion="No artifacts found. Try search_tables=true to also search table definitions, or use snow_query_table for data searches.";return N(V)}catch($){return M(`Artifact search failed: ${$.message}`)}}var eq={...KY,name:"snow_comprehensive_search",description:"[DEPRECATED - use snow_search_artifacts] "+KY.description};var Yx=u4(uz(),1);import*as n6 from"fs/promises";import*as UY from"path";var Xx={name:"snow_attach_file",description:"Attach files to ServiceNow records with validation and content type detection",category:"core-operations",subcategory:"attachments",use_cases:["attachments","files"],complexity:"beginner",frequency:"medium",permission:"write",allowedRoles:["developer","admin"],inputSchema:{type:"object",properties:{table:{type:"string",description:"Table name"},sys_id:{type:"string",description:"Record sys_id to attach file to"},file_path:{type:"string",description:"Local file path to attach"},file_name:{type:"string",description:"Name for the attached file (defaults to original filename)"},content_type:{type:"string",description:"MIME type (auto-detected if not provided)"},max_size_mb:{type:"number",description:"Maximum file size in MB",default:25}},required:["table","sys_id","file_path"]}};async function Jx(Y,X){let{table:J,sys_id:z,file_path:Q,file_name:G,content_type:Z,max_size_mb:$=25}=Y;try{let H=await x(X);try{await n6.access(Q)}catch{throw new I("VALIDATION_ERROR",`File not found: ${Q}`,{details:{file_path:Q}})}let K=(await n6.stat(Q)).size/1048576;if(K>$)throw new I("VALIDATION_ERROR",`File size ${K.toFixed(2)}MB exceeds maximum ${$}MB`,{details:{file_size_mb:K,max_size_mb:$}});if(!(await H.get(`/api/now/table/${J}/${z}`,{params:{sysparm_fields:"sys_id"}})).data.result)throw new I("NOT_FOUND_ERROR",`Record not found in table '${J}' with sys_id '${z}'`,{details:{table:J,sys_id:z}});let B=G||UY.basename(Q),O=Z||Ge(B),V=await n6.readFile(Q),L=new Yx.default;L.append("file",V,{filename:B,contentType:O});let F=(await H.post("/api/now/attachment/file",L,{params:{table_name:J,table_sys_id:z,file_name:B},headers:{...L.getHeaders()}})).data.result;return N({attached:!0,attachment:{sys_id:F.sys_id,file_name:F.file_name,size_bytes:F.size_bytes,content_type:F.content_type,table_name:F.table_name,table_sys_id:F.table_sys_id},download_url:`${X.instanceUrl}/api/now/attachment/${F.sys_id}/file`})}catch(H){return M(H instanceof I?H:H.message)}}function Ge(Y){let X=UY.extname(Y).toLowerCase();return{".txt":"text/plain",".pdf":"application/pdf",".doc":"application/msword",".docx":"application/vnd.openxmlformats-officedocument.wordprocessingml.document",".xls":"application/vnd.ms-excel",".xlsx":"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",".ppt":"application/vnd.ms-powerpoint",".pptx":"application/vnd.openxmlformats-officedocument.presentationml.presentation",".jpg":"image/jpeg",".jpeg":"image/jpeg",".png":"image/png",".gif":"image/gif",".zip":"application/zip",".json":"application/json",".xml":"application/xml",".csv":"text/csv"}[X]||"application/octet-stream"}var zx={name:"snow_analyze_incident",description:"Analyzes specific incidents with pattern recognition, similar incident matching, and automated resolution suggestions",category:"itsm",subcategory:"operations",use_cases:["incidents","analysis"],complexity:"intermediate",frequency:"medium",permission:"read",allowedRoles:["developer","stakeholder","admin"],inputSchema:{type:"object",properties:{incident_id:{type:"string",description:"Incident number or sys_id to analyze"},include_similar:{type:"boolean",description:"Include similar incidents in analysis",default:!0},suggest_resolution:{type:"boolean",description:"Generate automated resolution suggestions",default:!0}},required:["incident_id"]}},Ze={network_issues:{keywords:["network","connectivity","ping","dns","timeout","unreachable"],solutions:["Check network connectivity","Verify DNS resolution","Test ping to server","Review firewall rules"]},database_issues:{keywords:["database","connection","sql","timeout","deadlock","performance"],solutions:["Check database connection","Review connection pool settings","Analyze query performance","Check for blocking processes"]},application_errors:{keywords:["application","error","exception","crash","memory","cpu"],solutions:["Check application logs","Review memory usage","Analyze CPU utilization","Restart application service"]},auth_issues:{keywords:["authentication","login","password","ldap","sso","unauthorized"],solutions:["Reset user password","Check LDAP connectivity","Verify SSO configuration","Review user permissions"]}};async function Qx(Y,X){let{incident_id:J,include_similar:z=!0,suggest_resolution:Q=!0}=Y;try{let G=await x(X),Z=`number=${J}`,$=await G.get("/api/now/table/incident",{params:{sysparm_query:Z,sysparm_limit:1}});if(!$.data.result||$.data.result.length===0)Z=`sys_id=${J}`,$=await G.get("/api/now/table/incident",{params:{sysparm_query:Z,sysparm_limit:1}});if(!$.data.result||$.data.result.length===0)return M(`Incident ${J} not found`);let H=$.data.result[0],W=[],K=[],U=0,B=(H.short_description||"").toLowerCase();for(let[P,A]of Object.entries(Ze))if(A.keywords.some((w)=>B.includes(w)))W.push(P),K.push(...A.solutions),U+=0.2;let O=$e(W),V=He(W),L=[];if(z&&W.length>0){let P=`short_descriptionLIKE${H.short_description}^sys_id!=${H.sys_id}^state=6`;L=(await G.get("/api/now/table/incident",{params:{sysparm_query:P,sysparm_limit:5}})).data.result||[]}let q=[];if(Q){let P=`textLIKE${H.short_description}^workflow_state=published`;q=(await G.get("/api/now/table/kb_knowledge",{params:{sysparm_query:P,sysparm_limit:3}})).data.result||[]}let F={incident_id:H.number,incident_sys_id:H.sys_id,patterns_found:W,root_cause_analysis:O,suggested_resolution:K,confidence_score:Math.min(U,1),similar_incidents:L.map((P)=>({number:P.number,short_description:P.short_description,state:P.state})),knowledge_articles:q.map((P)=>({number:P.number,short_description:P.short_description,text:P.text?P.text.substring(0,200)+"...":""})),automated_actions:V};return N({analysis:F},{incident_id:J,patterns_found:W.length})}catch(G){return M(G.message)}}function $e(Y){if(Y.length===0)return"No specific patterns detected. Manual investigation required.";let X=[];if(Y.includes("network_issues"))X.push("Network connectivity issue detected. Check network infrastructure, DNS, and firewall rules.");if(Y.includes("database_issues"))X.push("Database connectivity or performance issue detected. Check database server, connection pools, and query performance.");if(Y.includes("application_errors"))X.push("Application error detected. Check application logs, resource utilization, and service status.");if(Y.includes("auth_issues"))X.push("Authentication issue detected. Check user credentials, LDAP/SSO configuration, and permissions.");return X.join(" ")}function He(Y){let X=[];if(Y.includes("network_issues"))X.push("Execute network connectivity test","Check DNS resolution","Verify firewall rules");if(Y.includes("database_issues"))X.push("Test database connectivity","Check database performance metrics","Review connection pool status");if(Y.includes("application_errors"))X.push("Restart application service","Check application logs","Monitor resource utilization");if(Y.includes("auth_issues"))X.push("Reset user session","Verify user permissions","Check authentication service status");return X}var Gx={name:"snow_auto_resolve_incident",description:"Attempts automated resolution of technical incidents based on known patterns and previous solutions. Includes dry-run mode for safety.",category:"itsm",subcategory:"operations",use_cases:["incidents","automation"],complexity:"advanced",frequency:"medium",permission:"write",allowedRoles:["developer","admin"],inputSchema:{type:"object",properties:{incident_id:{type:"string",description:"Incident number or sys_id to auto-resolve"},dry_run:{type:"boolean",description:"Preview actions without executing (default: true for safety)",default:!0}},required:["incident_id"]}},We={password_reset:{keywords:["password","reset","forgot","locked"],actions:["Send password reset email","Unlock user account","Update password policy"]},network_restart:{keywords:["network","connectivity","unreachable"],actions:["Restart network service","Clear DNS cache","Reset network adapter"]},service_restart:{keywords:["service","down","not responding","crash"],actions:["Restart service","Check service logs","Verify service configuration"]},cache_clear:{keywords:["cache","stale","outdated","refresh"],actions:["Clear cache","Restart caching service","Verify cache configuration"]}};async function Zx(Y,X){let{incident_id:J,dry_run:z=!0}=Y;try{let Q=await x(X),G=`number=${J}`,Z=await Q.get("/api/now/table/incident",{params:{sysparm_query:G,sysparm_limit:1}});if(!Z.data.result||Z.data.result.length===0)G=`sys_id=${J}`,Z=await Q.get("/api/now/table/incident",{params:{sysparm_query:G,sysparm_limit:1}});if(!Z.data.result||Z.data.result.length===0)return M(`Incident ${J} not found`);let $=Z.data.result[0],H=($.short_description||"").toLowerCase(),W=[],K=[],U=0;for(let[P,A]of Object.entries(We))if(A.keywords.some((w)=>H.includes(w)))W.push(P),K.push(...A.actions),U+=0.25;let B=`short_descriptionLIKE${$.short_description}^state=6^close_code!=Cancelled`,V=(await Q.get("/api/now/table/incident",{params:{sysparm_query:B,sysparm_limit:3}})).data.result||[],L=V.filter((P)=>P.close_notes).map((P)=>P.close_notes),q=[];if(!z&&U>=0.5){let P=`Auto-resolution attempted based on patterns: ${W.join(", ")}\\n\\nActions: ${K.join(", ")}`;await Q.put(`/api/now/table/incident/${$.sys_id}`,{work_notes:P,state:6,close_code:"Solved (Permanently)",close_notes:`Auto-resolved using pattern recognition. Actions executed: ${K.join(", ")}`}),q.push("Updated incident to Resolved state"),q.push("Added work notes with resolution details"),q.push("Set close code to Solved (Permanently)")}let F={incident_id:$.number,incident_sys_id:$.sys_id,dry_run:z,patterns_found:W,confidence_score:Math.min(U,1),resolution_actions:K,similar_resolved_incidents:V.length,resolution_notes_from_similar:L,actions_executed:q,can_auto_resolve:U>=0.5,recommendation:U>=0.5?"High confidence - safe to auto-resolve":"Low confidence - manual review recommended"};return N({result:F},{incident_id:J,dry_run:z,confidence:U})}catch(Q){return M(Q.message)}}var $x={name:"snow_operational_metrics",description:"Provides operational metrics and analytics including incident trends, resolution times, and performance indicators",category:"ml-analytics",subcategory:"metrics",use_cases:["analytics","metrics"],complexity:"intermediate",frequency:"medium",permission:"read",allowedRoles:["developer","stakeholder","admin"],inputSchema:{type:"object",properties:{timeframe:{type:"string",description:"Time period for metrics",enum:["today","week","month","quarter"],default:"week"},metric_types:{type:"array",items:{type:"string"},description:"Types of metrics to include (leave empty for all)",examples:[["incidents","requests","problems"]]}}}};function Ke(Y){switch(Y){case"today":return"ONToday@javascript:gs.daysAgoStart(0)@javascript:gs.daysAgoEnd(0)";case"week":return"ONLast 7 days@javascript:gs.daysAgoStart(7)@javascript:gs.daysAgoEnd(0)";case"month":return"ONLast 30 days@javascript:gs.daysAgoStart(30)@javascript:gs.daysAgoEnd(0)";case"quarter":return"ONLast 90 days@javascript:gs.daysAgoStart(90)@javascript:gs.daysAgoEnd(0)";default:return"ONLast 7 days@javascript:gs.daysAgoStart(7)@javascript:gs.daysAgoEnd(0)"}}async function Hx(Y,X){let{timeframe:J="week",metric_types:z=[]}=Y;try{let Q=await x(X),G=Ke(J),Z={timeframe:J,generated_at:new Date().toISOString()},$=z.length===0;if($||z.includes("incidents")){let W=(await Q.get("/api/now/table/incident",{params:{sysparm_query:`sys_created_on${G}`,sysparm_limit:1000,sysparm_fields:"number,state,priority,category"}})).data.result||[],K=W.filter((O)=>O.state!=="6"&&O.state!=="7"),U=W.filter((O)=>O.priority==="1"),B=new Map;W.forEach((O)=>{let V=O.category||"uncategorized";B.set(V,(B.get(V)||0)+1)}),Z.incidents={total:W.length,open:K.length,high_priority:U.length,common_categories:Array.from(B.entries()).sort((O,V)=>V[1]-O[1]).slice(0,5).map(([O,V])=>({category:O,count:V}))}}if($||z.includes("requests")){let W=(await Q.get("/api/now/table/sc_request",{params:{sysparm_query:`sys_created_on${G}`,sysparm_limit:1000,sysparm_fields:"number,request_state,approval"}})).data.result||[],K=W.filter((B)=>B.request_state!=="closed"),U=W.filter((B)=>B.approval==="requested");Z.requests={total:W.length,open:K.length,pending_approval:U.length}}if($||z.includes("problems")){let W=(await Q.get("/api/now/table/problem",{params:{sysparm_query:`sys_created_on${G}`,sysparm_limit:100,sysparm_fields:"number,state,priority"}})).data.result||[],K=W.filter((U)=>U.state!=="4");Z.problems={total:W.length,open:K.length}}return N({metrics:Z},{timeframe:J,metric_types:$?"all":z.join(",")})}catch(Q){return M(Q.message)}}var Wx={name:"snow_pattern_analysis",description:"Analyzes patterns across incidents, requests, and problems to identify trends, common issues, and improvement opportunities",category:"reporting",subcategory:"analytics",use_cases:["pattern-analysis","trends","data-analysis"],complexity:"advanced",frequency:"medium",permission:"read",allowedRoles:["developer","stakeholder","admin"],inputSchema:{type:"object",properties:{analysis_type:{type:"string",description:"Type of pattern analysis",enum:["incident_patterns","request_trends","problem_root_causes","user_behavior"]},timeframe:{type:"string",description:"Time period for analysis",enum:["day","week","month","quarter"],default:"week"}},required:["analysis_type"]}};function Ue(Y){let X={day:"ONToday@javascript:gs.daysAgoStart(0)@javascript:gs.daysAgoEnd(0)",week:"ONLast 7 days@javascript:gs.daysAgoStart(7)@javascript:gs.daysAgoEnd(0)",month:"ONLast 30 days@javascript:gs.daysAgoStart(30)@javascript:gs.daysAgoEnd(0)",quarter:"ONLast 90 days@javascript:gs.daysAgoStart(90)@javascript:gs.daysAgoEnd(0)"};return X[Y]||X.week}async function Kx(Y,X){let{analysis_type:J,timeframe:z="week"}=Y;try{let Q=await x(X),G=Ue(z),Z={analysis_type:J,timeframe:z,generated_at:new Date().toISOString()};switch(J){case"incident_patterns":Z={...Z,...await Be(Q,G)};break;case"request_trends":Z={...Z,...await Ve(Q,G)};break;case"problem_root_causes":Z={...Z,...await Oe(Q,G)};break;case"user_behavior":Z={...Z,...await Me(Q,G)};break;default:return M(`Unknown analysis type: ${J}`)}return N({patterns:Z},{analysis_type:J,timeframe:z})}catch(Q){return M(Q.message)}}async function Be(Y,X){let z=(await Y.get("/api/now/table/incident",{params:{sysparm_query:`sys_created_on${X}`,sysparm_limit:1000}})).data.result||[],Q={by_category:new Map,by_priority:new Map,by_state:new Map,by_hour:new Map,common_keywords:new Map};return z.forEach((G)=>{let Z=G.category||"uncategorized";Q.by_category.set(Z,(Q.by_category.get(Z)||0)+1);let $=G.priority||"unknown";Q.by_priority.set($,(Q.by_priority.get($)||0)+1);let H=G.state||"unknown";if(Q.by_state.set(H,(Q.by_state.get(H)||0)+1),G.sys_created_on){let U=new Date(G.sys_created_on).getHours();Q.by_hour.set(U,(Q.by_hour.get(U)||0)+1)}(G.short_description||"").toLowerCase().split(/\s+/).filter((U)=>U.length>3).slice(0,5).forEach((U)=>{Q.common_keywords.set(U,(Q.common_keywords.get(U)||0)+1)})}),{total_incidents:z.length,patterns:{by_category:Object.fromEntries(Q.by_category),by_priority:Object.fromEntries(Q.by_priority),by_state:Object.fromEntries(Q.by_state),peak_hours:Array.from(Q.by_hour.entries()).sort((G,Z)=>Z[1]-G[1]).slice(0,5).map(([G,Z])=>({hour:G,count:Z})),top_keywords:Array.from(Q.common_keywords.entries()).sort((G,Z)=>Z[1]-G[1]).slice(0,10).map(([G,Z])=>({keyword:G,count:Z}))}}}async function Ve(Y,X){let z=(await Y.get("/api/now/table/sc_request",{params:{sysparm_query:`sys_created_on${X}`,sysparm_limit:1000}})).data.result||[],Q={by_state:new Map,by_approval:new Map};return z.forEach((G)=>{let Z=G.request_state||"unknown";Q.by_state.set(Z,(Q.by_state.get(Z)||0)+1);let $=G.approval||"unknown";Q.by_approval.set($,(Q.by_approval.get($)||0)+1)}),{total_requests:z.length,trends:{by_state:Object.fromEntries(Q.by_state),by_approval_status:Object.fromEntries(Q.by_approval)}}}async function Oe(Y,X){let z=(await Y.get("/api/now/table/problem",{params:{sysparm_query:`sys_created_on${X}`,sysparm_limit:100}})).data.result||[],Q={by_category:new Map,by_state:new Map};return z.forEach((G)=>{let Z=G.category||"uncategorized";Q.by_category.set(Z,(Q.by_category.get(Z)||0)+1);let $=G.state||"unknown";Q.by_state.set($,(Q.by_state.get($)||0)+1)}),{total_problems:z.length,root_causes:{by_category:Object.fromEntries(Q.by_category),by_state:Object.fromEntries(Q.by_state)}}}async function Me(Y,X){let z=(await Y.get("/api/now/table/incident",{params:{sysparm_query:`sys_created_on${X}`,sysparm_limit:500,sysparm_fields:"caller_id"}})).data.result||[],Q=new Map;return z.forEach((G)=>{let Z=G.caller_id?.value||G.caller_id;if(Z)Q.set(Z,(Q.get(Z)||0)+1)}),{user_activities:{total_incidents:z.length,unique_users:Q.size,avg_incidents_per_user:Q.size>0?Math.round(z.length/Q.size*10)/10:0}}}var Ux={name:"snow_predictive_analysis",description:"Provides predictive analysis for incident volumes, system failures, and resource issues based on historical patterns",category:"ml-analytics",subcategory:"prediction",use_cases:["prediction","analytics"],complexity:"advanced",frequency:"low",permission:"read",allowedRoles:["developer","stakeholder","admin"],inputSchema:{type:"object",properties:{prediction_type:{type:"string",description:"Type of prediction",enum:["incident_volume","system_failure","resource_exhaustion","user_impact"]},timeframe:{type:"string",description:"Prediction timeframe",enum:["day","week","month"],default:"week"}},required:["prediction_type"]}};function Le(Y){let X={day:"ONLast 7 days@javascript:gs.daysAgoStart(7)@javascript:gs.daysAgoEnd(0)",week:"ONLast 30 days@javascript:gs.daysAgoStart(30)@javascript:gs.daysAgoEnd(0)",month:"ONLast 90 days@javascript:gs.daysAgoStart(90)@javascript:gs.daysAgoEnd(0)"};return X[Y]||X.week}async function Bx(Y,X){let{prediction_type:J,timeframe:z="week"}=Y;try{let Q=await x(X),G=Le(z),Z={prediction_type:J,timeframe:z,generated_at:new Date().toISOString(),analysis_method:"trend_analysis"};switch(J){case"incident_volume":Z={...Z,...await Ne(Q,G,z)};break;case"system_failure":Z={...Z,...await qe(Q,G,z)};break;case"resource_exhaustion":Z={...Z,...await xe(Q,G,z)};break;case"user_impact":Z={...Z,...await Fe(Q,G,z)};break;default:return M(`Unknown prediction type: ${J}`)}return N({predictions:Z},{prediction_type:J,timeframe:z})}catch(Q){return M(Q.message)}}async function Ne(Y,X,J){let Q=(await Y.get("/api/now/table/incident",{params:{sysparm_query:`sys_created_on${X}`,sysparm_limit:1000,sysparm_fields:"sys_created_on,priority"}})).data.result||[],G=new Map;Q.forEach((H)=>{if(H.sys_created_on){let W=H.sys_created_on.split(" ")[0];G.set(W,(G.get(W)||0)+1)}});let Z=Array.from(G.values()),$=Z.length>0?Z.reduce((H,W)=>H+W,0)/Z.length:0;return{historical_data:{total_incidents:Q.length,average_daily_volume:Math.round($),peak_volume:Math.max(...Z,0),low_volume:Math.min(...Z,0)},prediction:{expected_volume:Math.round($),confidence:Z.length>=7?"high":"low",interpretation:`Based on ${Z.length} days of data, expecting approximately ${Math.round($)} incidents per ${J}`}}}async function qe(Y,X,J){let Q=(await Y.get("/api/now/table/incident",{params:{sysparm_query:`sys_created_on${X}^priority=1`,sysparm_limit:500}})).data.result||[];return{historical_data:{critical_incidents:Q.length},prediction:{risk_level:Q.length>10?"high":"low",interpretation:`Based on ${Q.length} critical incidents, system failure risk is ${Q.length>10?"elevated":"normal"}`}}}async function xe(Y,X,J){let Q=(await Y.get("/api/now/table/sc_request",{params:{sysparm_query:`sys_created_on${X}`,sysparm_limit:1000}})).data.result||[];return{historical_data:{total_requests:Q.length},prediction:{risk_level:Q.length>500?"medium":"low",interpretation:`Based on ${Q.length} service requests, resource demand is ${Q.length>500?"increasing":"stable"}`}}}async function Fe(Y,X,J){let Q=(await Y.get("/api/now/table/incident",{params:{sysparm_query:`sys_created_on${X}`,sysparm_limit:1000,sysparm_fields:"caller_id,state"}})).data.result||[],G=new Set(Q.map((Z)=>Z.caller_id?.value||Z.caller_id).filter(Boolean));return{historical_data:{total_incidents:Q.length,affected_users:G.size},prediction:{impact_level:G.size>50?"high":"medium",interpretation:`${G.size} unique users affected. User impact is ${G.size>50?"widespread":"localized"}`}}}var Vx={name:"snow_cmdb_search",description:"Searches Configuration Management Database (CMDB) for configuration items with relationship mapping",category:"cmdb",subcategory:"discovery",use_cases:["cmdb","configuration-items"],complexity:"intermediate",frequency:"high",permission:"read",allowedRoles:["developer","stakeholder","admin"],inputSchema:{type:"object",properties:{query:{type:"string",description:'Search query for configuration items (e.g., "server name", "application")'},ci_type:{type:"string",description:"Type of CI to search",enum:["server","application","database","network_device","service","any"],default:"any"},limit:{type:"number",description:"Maximum number of results",default:10,minimum:1,maximum:100},include_relationships:{type:"boolean",description:"Include CI relationships",default:!1}},required:["query"]}},Pe={server:"cmdb_ci_server",application:"cmdb_ci_application",database:"cmdb_ci_database",network_device:"cmdb_ci_network_device",service:"cmdb_ci_service",any:"cmdb_ci"};function Ae(Y){if(Y.includes("=")||Y.includes("!=")||Y.includes("^")||Y.includes("LIKE"))return Y;return`nameLIKE${Y}^ORshort_descriptionLIKE${Y}`}async function Ox(Y,X){let{query:J,ci_type:z="any",limit:Q=10,include_relationships:G=!1}=Y;if(!J||typeof J!=="string"||J.trim()==="")return M('Parameter "query" is required and must be a non-empty string');try{let $=await x(X),H=Pe[z]||"cmdb_ci",W=Ae(J.trim());var Z;try{Z=await $.get(`/api/now/table/${H}`,{params:{sysparm_query:W,sysparm_limit:Q,sysparm_fields:"sys_id,name,short_description,operational_status,support_group,sys_class_name"}})}catch(B){if(H!=="cmdb_ci"&&B.response?.status===400)Z=await $.get("/api/now/table/cmdb_ci",{params:{sysparm_query:W,sysparm_limit:Q,sysparm_fields:"sys_id,name,short_description,operational_status,support_group,sys_class_name"}});else throw B}let K=Z.data.result||[],U={total_results:K.length,ci_type:z,table_searched:H,query_used:W,configuration_items:K.map((B)=>({sys_id:B.sys_id,name:B.name,short_description:B.short_description,operational_status:B.operational_status,support_group:B.support_group,sys_class_name:B.sys_class_name}))};if(G&&K.length>0){let B=[];for(let O of K)try{let V=await $.get("/api/now/table/cmdb_rel_ci",{params:{sysparm_query:`parent=${O.sys_id}^ORchild=${O.sys_id}`,sysparm_limit:20}});if(V.data.result&&V.data.result.length>0)B.push({ci_sys_id:O.sys_id,ci_name:O.name,relationship_count:V.data.result.length,relationships:V.data.result.map((L)=>({type:L.type,parent:L.parent?.name||L.parent,child:L.child?.name||L.child}))})}catch(V){console.warn(`Failed to get relationships for CI ${O.sys_id}:`,V)}U.relationships=B}return N(U,{query:W,ci_type:z,limit:Q,count:K.length})}catch($){return M($.message)}}var Mx={name:"snow_catalog_item_manager",description:"Create, update, or manage service catalog items",category:"itsm",subcategory:"catalog",use_cases:["catalog-management","service-catalog","crud"],complexity:"intermediate",frequency:"medium",permission:"write",allowedRoles:["developer","admin"],inputSchema:{type:"object",properties:{action:{type:"string",description:"Action to perform",enum:["create","update","activate","deactivate","delete"]},sys_id:{type:"string",description:"Catalog item sys_id (required for update/activate/deactivate/delete)"},name:{type:"string",description:"Catalog item name (required for create)"},short_description:{type:"string",description:"Short description"},category:{type:"string",description:"Category sys_id"},price:{type:"string",description:"Item price"}},required:["action"]}};async function Lx(Y,X){let{action:J,sys_id:z,name:Q,short_description:G,category:Z,price:$}=Y;try{let H=await x(X);switch(J){case"create":if(!Q)return M("name is required for create action");let W={name:Q,short_description:G||"",active:!0};if(Z)W.category=Z;if($)W.price=$;let U=(await H.post("/api/now/table/sc_cat_item",W)).data.result;return N({message:`Catalog item "${Q}" created successfully`,catalog_item:{sys_id:U.sys_id,name:U.name,short_description:U.short_description,active:U.active}},{action:J,sys_id:U.sys_id});case"update":if(!z)return M("sys_id is required for update action");let B={};if(Q)B.name=Q;if(G)B.short_description=G;if(Z)B.category=Z;if($)B.price=$;let V=(await H.put(`/api/now/table/sc_cat_item/${z}`,B)).data.result;return N({message:"Catalog item updated successfully",catalog_item:V},{action:J,sys_id:z});case"activate":case"deactivate":if(!z)return M(`sys_id is required for ${J} action`);let L=J==="activate",q=await H.put(`/api/now/table/sc_cat_item/${z}`,{active:L});return N({message:`Catalog item ${J}d successfully`,sys_id:z,active:L},{action:J,sys_id:z});case"delete":if(!z)return M("sys_id is required for delete action");return await H.delete(`/api/now/table/sc_cat_item/${z}`),N({message:"Catalog item deleted successfully",sys_id:z},{action:J,sys_id:z});default:return M(`Unknown action: ${J}`)}}catch(H){return M(H.message)}}var Nx={name:"snow_catalog_item_search",description:"Search service catalog items with filtering options",category:"itsm",subcategory:"catalog",use_cases:["catalog-search","service-catalog","discovery"],complexity:"beginner",frequency:"medium",permission:"read",allowedRoles:["developer","stakeholder","admin"],inputSchema:{type:"object",properties:{query:{type:"string",description:"Search query (searches name and short_description)"},active_only:{type:"boolean",description:"Only return active catalog items",default:!0},category:{type:"string",description:"Filter by category sys_id"},limit:{type:"number",description:"Maximum number of results",default:20,minimum:1,maximum:100}}}};async function qx(Y,X){let{query:J,active_only:z=!0,category:Q,limit:G=20}=Y;try{let Z=await x(X),$="";if(J)$=`nameLIKE${J}^ORshort_descriptionLIKE${J}`;if(z)$+=$?"^active=true":"active=true";if(Q)$+=$?`^category=${Q}`:`category=${Q}`;let W=(await Z.get("/api/now/table/sc_cat_item",{params:{sysparm_query:$||void 0,sysparm_limit:G}})).data.result||[];return N({total_results:W.length,catalog_items:W.map((K)=>({sys_id:K.sys_id,name:K.name,short_description:K.short_description,active:K.active,category:K.category,price:K.price}))},{query:J||"all",limit:G,count:W.length})}catch(Z){return M(Z.message)}}var xx={name:"snow_cleanup_test_artifacts",description:"Safely cleanup test artifacts from ServiceNow (dry-run enabled by default for safety)",category:"development",subcategory:"testing",use_cases:["testing","cleanup"],complexity:"intermediate",frequency:"low",permission:"write",allowedRoles:["developer","admin"],inputSchema:{type:"object",properties:{artifact_type:{type:"string",description:"Type of artifacts to clean up",enum:["incidents","requests","test_data","all"]},name_pattern:{type:"string",description:'Pattern to match artifact names (e.g., "TEST", "DEMO")',default:"TEST"},dry_run:{type:"boolean",description:"Preview cleanup without executing (default: true for safety)",default:!0},limit:{type:"number",description:"Maximum number of records to clean up",default:10,maximum:100}},required:["artifact_type"]}};async function Fx(Y,X){let{artifact_type:J,name_pattern:z="TEST",dry_run:Q=!0,limit:G=10}=Y;try{let Z=await x(X),$={artifact_type:J,name_pattern:z,dry_run:Q,items_found:0,items_deleted:0,artifacts:[]},H=[];if(J==="incidents"||J==="all")H.push("incident");if(J==="requests"||J==="all")H.push("sc_request");for(let K of H){let U=`short_descriptionLIKE${z}`,O=(await Z.get(`/api/now/table/${K}`,{params:{sysparm_query:U,sysparm_limit:G}})).data.result||[];$.items_found+=O.length;for(let V of O)if($.artifacts.push({table:K,sys_id:V.sys_id,number:V.number,short_description:V.short_description}),!Q)await Z.delete(`/api/now/table/${K}/${V.sys_id}`),$.items_deleted++}let W=Q?`Found ${$.items_found} test artifacts. Run with dry_run=false to delete.`:`Deleted ${$.items_deleted} test artifacts successfully.`;return N({message:W,...$},{artifact_type:J,dry_run:Q,items_found:$.items_found})}catch(Z){return M(Z.message)}}var Px={name:"snow_assign_task",description:"Assign task to user or group with workload balancing and skill matching",category:"core-operations",subcategory:"task-management",use_cases:["task-assignment","workload"],complexity:"intermediate",frequency:"high",permission:"write",allowedRoles:["developer","admin"],inputSchema:{type:"object",properties:{table:{type:"string",description:"Task table (incident, change_request, sc_task, etc.)",default:"task"},sys_id:{type:"string",description:"Task sys_id or number"},assigned_to:{type:"string",description:"User sys_id or username to assign to"},assignment_group:{type:"string",description:"Group sys_id or name to assign to"},auto_assign:{type:"boolean",description:"Auto-assign to available group member with lowest workload",default:!1},check_availability:{type:"boolean",description:"Check user availability before assignment",default:!1},work_notes:{type:"string",description:"Work notes to add with assignment"}},required:["sys_id"]}};async function Ax(Y,X){let{table:J="task",sys_id:z,assigned_to:Q,assignment_group:G,auto_assign:Z=!1,check_availability:$=!1,work_notes:H}=Y;try{let W=await x(X),K;if(z.length===32)K=(await W.get(`/api/now/table/${J}/${z}`,{params:{sysparm_fields:"sys_id,number,assigned_to,assignment_group"}})).data.result;else{let L=await W.get(`/api/now/table/${J}`,{params:{sysparm_query:`number=${z}`,sysparm_fields:"sys_id,number,assigned_to,assignment_group",sysparm_limit:1}});if(L.data.result&&L.data.result.length>0)K=L.data.result[0]}if(!K)throw new I("NOT_FOUND_ERROR",`Task not found: ${z}`,{details:{table:J,sys_id:z}});let U={},B;if(G){if(G.length===32)B=G;else{let L=await W.get("/api/now/table/sys_user_group",{params:{sysparm_query:`name=${G}`,sysparm_fields:"sys_id,name",sysparm_limit:1}});if(L.data.result&&L.data.result.length>0)B=L.data.result[0].sys_id}U.assignment_group=B}if(Q){if(Q.length===32)U.assigned_to=Q;else{let L=await W.get("/api/now/table/sys_user",{params:{sysparm_query:`user_name=${Q}`,sysparm_fields:"sys_id,user_name,active",sysparm_limit:1}});if(L.data.result&&L.data.result.length>0){let q=L.data.result[0];if(!q.active)throw new I("VALIDATION_ERROR",`User '${Q}' is inactive and cannot be assigned tasks`,{details:{user:Q}});U.assigned_to=q.sys_id}}if($&&U.assigned_to){let L=await W.get("/api/now/table/cmn_schedule",{params:{sysparm_query:`type=user^user=${U.assigned_to}`,sysparm_fields:"sys_id",sysparm_limit:1}})}}else if(Z&&B){let L=await W.get("/api/now/table/sys_user_grmember",{params:{sysparm_query:`group=${B}^user.active=true`,sysparm_fields:"user",sysparm_limit:100}});if(L.data.result&&L.data.result.length>0){let q=L.data.result.map((A)=>A.user.value),P=(await Promise.all(q.map(async(A)=>{let w=await W.get(`/api/now/table/${J}`,{params:{sysparm_query:`assigned_to=${A}^active=true`,sysparm_fields:"sys_id",sysparm_limit:1000}});return{user_id:A,count:w.data.result?.length||0}}))).reduce((A,w)=>w.count<A.count?w:A);U.assigned_to=P.user_id}}if(H)U.work_notes=H;let V=(await W.put(`/api/now/table/${J}/${K.sys_id}`,U,{params:{sysparm_display_value:"all",sysparm_exclude_reference_link:"true"}})).data.result;return N({assigned:!0,number:V.number,sys_id:V.sys_id,previous_assigned_to:K.assigned_to,current_assigned_to:V.assigned_to,previous_assignment_group:K.assignment_group,current_assignment_group:V.assignment_group,auto_assigned:Z&&!Q,task:{number:V.number,sys_id:V.sys_id,assigned_to:V.assigned_to,assignment_group:V.assignment_group},url:`${X.instanceUrl}/${J}.do?sys_id=${V.sys_id}`})}catch(W){return M(W instanceof I?W:W.message)}}var Tx={name:"snow_manage_group_membership",description:"Manage group memberships: add/remove users, list members",category:"core-operations",subcategory:"user-management",use_cases:["user-management","access-control","group-administration"],complexity:"beginner",frequency:"high",permission:"write",allowedRoles:["developer","admin"],inputSchema:{type:"object",properties:{action:{type:"string",description:"Operation: add, remove, or list",enum:["add","remove","list"]},user_identifier:{type:"string",description:"User sys_id, username, or email"},group_identifier:{type:"string",description:"Group sys_id or name"},include_details:{type:"boolean",description:"Include user details (list only)",default:!0}},required:["action","group_identifier"]}};async function wx(Y,X){let J=X.includes("@")?`email=${X}`:X.length===32?`sys_id=${X}`:`user_name=${X}`,z=await Y.get("/api/now/table/sys_user",{params:{sysparm_query:J,sysparm_limit:1}});if(!z.data.result||z.data.result.length===0)throw Error(`User "${X}" not found`);return z.data.result[0]}async function we(Y,X){let J=X.length===32?`sys_id=${X}`:`name=${X}`,z=await Y.get("/api/now/table/sys_user_group",{params:{sysparm_query:J,sysparm_limit:1}});if(!z.data.result||z.data.result.length===0)throw Error(`Group "${X}" not found`);return z.data.result[0]}async function Te(Y,X,J){var z=await Y.get("/api/now/table/sys_user_grmember",{params:{sysparm_query:`user=${X.sys_id}^group=${J.sys_id}`,sysparm_limit:1}});if(z.data.result&&z.data.result.length>0)return{message:`User "${X.user_name}" is already a member of group "${J.name}"`,membership_sys_id:z.data.result[0].sys_id,already_exists:!0};var Q={user:X.sys_id,group:J.sys_id},G=await Y.post("/api/now/table/sys_user_grmember",Q),Z=G.data.result;return{message:`User "${X.user_name}" assigned to group "${J.name}" successfully`,membership:{sys_id:Z.sys_id,user:{sys_id:X.sys_id,user_name:X.user_name,name:X.name},group:{sys_id:J.sys_id,name:J.name}},already_exists:!1}}async function Ie(Y,X,J){var z=await Y.get("/api/now/table/sys_user_grmember",{params:{sysparm_query:`user=${X.sys_id}^group=${J.sys_id}`,sysparm_limit:1}});if(!z.data.result||z.data.result.length===0)throw Error(`User "${X.user_name}" is not a member of group "${J.name}"`);var Q=z.data.result[0];return await Y.delete(`/api/now/table/sys_user_grmember/${Q.sys_id}`),{message:`User "${X.user_name}" removed from group "${J.name}" successfully`,removed_membership:{sys_id:Q.sys_id,user:{sys_id:X.sys_id,user_name:X.user_name,name:X.name},group:{sys_id:J.sys_id,name:J.name}}}}async function ve(Y,X,J){var z=await Y.get("/api/now/table/sys_user_grmember",{params:{sysparm_query:`group=${X.sys_id}`,sysparm_limit:500}}),Q=z.data.result||[],G=[];if(J&&Q.length>0){var Z=Q.map(function(F){return F.user.value||F.user}),$=`sys_idIN${Z.join(",")}`,H=await Y.get("/api/now/table/sys_user",{params:{sysparm_query:$,sysparm_limit:500}}),W=H.data.result||[],K={};for(var U=0;U<W.length;U++)K[W[U].sys_id]=W[U];for(var B=0;B<Q.length;B++){var O=Q[B],V=O.user.value||O.user,L=K[V];G.push({membership_sys_id:O.sys_id,user_sys_id:V,user_name:L?L.user_name:"Unknown",name:L?L.name:"Unknown",email:L?L.email:void 0,title:L?L.title:void 0,department:L?L.department:void 0,active:L?L.active:void 0})}}else for(var q=0;q<Q.length;q++)G.push({membership_sys_id:Q[q].sys_id,user_sys_id:Q[q].user.value||Q[q].user});return{group:{sys_id:X.sys_id,name:X.name,description:X.description,type:X.type},member_count:G.length,members:G}}async function Ix(Y,X){var{action:J,user_identifier:z,group_identifier:Q}=Y,G=Y.include_details!==void 0?Y.include_details:!0;try{var Z=await x(X),$=await we(Z,Q);if(J==="add"){if(!z)return M("user_identifier is required for add action");var H=await wx(Z,z),W=await Te(Z,H,$);return N(W,{user_name:H.user_name,group_name:$.name})}if(J==="remove"){if(!z)return M("user_identifier is required for remove action");var K=await wx(Z,z),U=await Ie(Z,K,$);return N(U,{user_name:K.user_name,group_name:$.name})}if(J==="list"){var B=await ve(Z,$,G);return N(B,{group_name:$.name,member_count:B.member_count})}return M(`Invalid action: ${J}. Must be add, remove, or list`)}catch(O){return M(O.message)}}var bQ={};G0(bQ,{snow_validate_deployment_exec:()=>dx,snow_validate_deployment_def:()=>cx,snow_rollback_deployment_exec:()=>px,snow_rollback_deployment_def:()=>gx,snow_github_tree_exec:()=>tx,snow_github_tree_def:()=>rx,snow_github_deploy_exec:()=>XF,snow_github_deploy_def:()=>YF,snow_deployment_status_exec:()=>ux,snow_deployment_status_def:()=>mx,snow_deployment_debug_exec:()=>yx,snow_deployment_debug_def:()=>fx,snow_create_solution_package_exec:()=>Rx,snow_create_solution_package_def:()=>bx,snow_clone_instance_artifact_exec:()=>_x,snow_clone_instance_artifact_def:()=>kx,snow_auth_diagnostics_exec:()=>Sx,snow_auth_diagnostics_def:()=>Ex,snow_artifact_manage_exec:()=>VY,snow_artifact_manage_def:()=>Cx});import*as q4 from"fs/promises";import*as a6 from"path";import{existsSync as jx}from"fs";var o6={sp_widget:"sp_widget",widget:"sp_widget",sp_page:"sp_page",page:"sp_page",sys_ux_page:"sys_ux_page",uib_page:"sys_ux_page",script_include:"sys_script_include",business_rule:"sys_script",client_script:"sys_script_client",ui_policy:"sys_ui_policy",ui_action:"sys_ui_action",rest_message:"sys_rest_message",scheduled_job:"sysauto_script",transform_map:"sys_transform_map",fix_script:"sys_script_fix",table:"sys_db_object",field:"sys_dictionary",flow:"sys_hub_flow",application:"sys_app"},r8={sp_widget:"id",sp_page:"id",sys_ux_page:"name",sys_script_include:"name",sys_script:"name",sys_script_client:"name",sys_ui_policy:"short_description",sys_ui_action:"name",sys_rest_message:"name",sysauto_script:"name",sys_transform_map:"name",sys_script_fix:"name",sys_db_object:"name",sys_dictionary:"element",sys_hub_flow:"name",sys_app:"name"},k7={sp_widget:{template:["template.html","index.html","widget.html"],script:["server.js","server-script.js","script.js"],client_script:["client.js","client-script.js","controller.js"],css:["style.css","styles.css","widget.css"],option_schema:["options.json","option_schema.json","schema.json"]},sys_script:{script:["script.js","index.js","main.js"],condition:["condition.js","condition.txt"]},sys_script_include:{script:["script.js","index.js","main.js","{name}.js"]},sys_script_client:{script:["script.js","client.js","index.js"]},sp_page:{},sys_ux_page:{},sys_ui_action:{script:["script.js","action.js","index.js"],condition:["condition.js"]},sysauto_script:{script:["script.js","job.js","index.js"]},sys_script_fix:{script:["script.js","fix.js","index.js"]}},vx={sp_widget:{template:"template.html",script:"server.js",client_script:"client.js",css:"style.css",option_schema:"options.json"},sys_script:{script:"script.js",condition:"condition.js"},sys_script_include:{script:"script.js"},sys_script_client:{script:"script.js"},sys_ui_action:{script:"script.js",condition:"condition.js"},sysauto_script:{script:"script.js"},sys_script_fix:{script:"script.js"}},Dx={sys_script_include:".js",sys_script:".js",sys_script_client:".js",sys_ui_action:".js",sysauto_script:".js",sys_script_fix:".js",sp_widget:"",sp_page:"",sys_ux_page:""};var Cx={name:"snow_artifact_manage",description:`Unified tool for ServiceNow artifact management (create, get, update, delete, find, list, analyze, export, import)

 ACTIONS:
- create: Create new artifact (widget, page, script, table, field, etc.)
- get: Retrieve artifact by sys_id or identifier
- update: Update existing artifact fields (supports _file parameters for file-based updates)
- delete: Delete artifact (supports soft delete)
- find: Search artifacts by query
- list: List all artifacts of a type
- analyze: Analyze artifact dependencies
- export: Export artifact to JSON/XML
- import: Import artifact from JSON/XML file
- verify: Compare local files against deployed artifact content

\uD83D\uDDC3 SUPPORTED ARTIFACT TYPES:
- sp_widget / widget: Service Portal widgets
- sp_page / page: Service Portal pages
- sys_ux_page / uib_page: UI Builder pages
- script_include: Script Includes
- business_rule: Business Rules
- client_script: Client Scripts
- ui_policy: UI Policies
- ui_action: UI Actions
- rest_message: REST Messages
- scheduled_job: Scheduled Jobs
- transform_map: Transform Maps
- fix_script: Fix Scripts
- table: Custom tables (sys_db_object)
- field: Custom fields (sys_dictionary)
- flow: Flows (sys_hub_flow)
- application: Applications (sys_app)

 ES5 REQUIREMENT: Server-side scripts must use ES5 syntax (var, function, string concatenation)

\uD83D\uDCE6 APPLICATION SCOPE:
- Use application_scope parameter to specify scope
- Use "global" for global scope artifacts`,category:"development",subcategory:"deployment",use_cases:["deployment","artifacts","widgets","scripts","tables","crud"],complexity:"intermediate",frequency:"high",permission:"write",allowedRoles:["developer","admin"],inputSchema:{type:"object",properties:{action:{type:"string",description:"Management action to perform",enum:["create","get","update","delete","find","list","analyze","export","import","verify"]},type:{type:"string",description:"Artifact type (sp_widget, script_include, business_rule, table, field, etc.)",enum:["sp_widget","widget","sp_page","page","sys_ux_page","uib_page","script_include","business_rule","client_script","ui_policy","ui_action","rest_message","scheduled_job","transform_map","fix_script","table","field","flow","application"]},sys_id:{type:"string",description:"[get/update/delete/analyze/export] Artifact sys_id"},identifier:{type:"string",description:"[get/update/delete] Artifact identifier (name/id) - alternative to sys_id"},name:{type:"string",description:"[create] Artifact name/ID (required for create)"},title:{type:"string",description:"[create] Display title (for widgets/pages)"},description:{type:"string",description:"[create/update] Artifact description"},template:{type:"string",description:"[create/update] HTML template (for widgets/pages)"},server_script:{type:"string",description:"[create/update] Server-side script (ES5 only!)"},client_script:{type:"string",description:"[create/update] Client-side script"},css:{type:"string",description:"[create/update] CSS stylesheet (for widgets)"},option_schema:{type:"string",description:"[create/update] Option schema JSON (for widgets)"},script:{type:"string",description:"[create/update] Script content (for script includes, business rules, etc.)"},api_name:{type:"string",description:"[create] API name (for script includes)"},table:{type:"string",description:"[create/find] Table name (for business rules, client scripts, fields, etc.)"},when:{type:"string",enum:["before","after","async","display"],description:"[create] When to execute (business rules)"},insert:{type:"boolean",description:"[create] Run on insert (business rules)"},update_trigger:{type:"boolean",description:"[create] Run on update (business rules)"},delete_trigger:{type:"boolean",description:"[create] Run on delete (business rules)"},query_trigger:{type:"boolean",description:"[create] Run on query (business rules)"},active:{type:"boolean",description:"[create/update] Activate immediately",default:!0},label:{type:"string",description:"[create] Table label (for tables) or field label (for fields)"},extends_table:{type:"string",description:"[create] Parent table to extend (for tables)"},is_extendable:{type:"boolean",description:"[create] Whether the table can be extended",default:!0},create_module:{type:"boolean",description:"[create] Create navigation module for the table",default:!0},create_access_controls:{type:"boolean",description:"[create] Create default ACLs for the table",default:!1},column_name:{type:"string",description:"[create] Column/field name (for fields)"},column_label:{type:"string",description:"[create] Column/field display label (for fields)"},internal_type:{type:"string",description:"[create] Field type (for fields)",enum:["string","integer","boolean","reference","glide_date","glide_date_time","decimal","float","choice","journal","journal_input","html","url","email","phone_number_e164","currency","price"]},reference_table:{type:"string",description:"[create] Reference table name (for reference fields)"},max_length:{type:"number",description:"[create] Maximum length for string fields",default:255},mandatory:{type:"boolean",description:"[create] Whether the field is mandatory",default:!1},default_value:{type:"string",description:"[create] Default value for the field"},choice_options:{type:"array",items:{type:"object",properties:{label:{type:"string"},value:{type:"string"}}},description:"[create] Choice options for choice fields"},config:{type:"object",description:"[update] Fields to update (only specified fields will be changed)"},validate:{type:"boolean",description:"[update] Validate before update",default:!0},create_backup:{type:"boolean",description:"[update] Create backup before update",default:!1},soft_delete:{type:"boolean",description:"[delete] Mark as inactive instead of hard delete",default:!1},force:{type:"boolean",description:"[delete] Force deletion even with dependencies",default:!1},query:{type:"string",description:"[find] Search query (natural language or encoded query)"},limit:{type:"number",description:"[find/list] Maximum results to return",default:10},fields:{type:"string",description:"[get/find/list] Comma-separated list of fields to return"},format:{type:"string",enum:["json","xml","files"],description:'[export] Export format. Use "files" to export to separate files per field (template.html, server.js, etc.)',default:"json"},export_path:{type:"string",description:'[export] Directory path to export files to (required for format="files")'},file_path:{type:"string",description:"[import] Path to the artifact file"},data:{type:"object",description:"[import] Artifact data object (alternative to file_path)"},artifact_directory:{type:"string",description:"[create/update/verify] Directory containing artifact files. Auto-maps files like template.htmltemplate, server.jsscript, etc."},template_file:{type:"string",description:"[create/update/verify] Path to HTML template file (widgets)"},server_script_file:{type:"string",description:"[create/update/verify] Path to server-side script file"},client_script_file:{type:"string",description:"[create/update/verify] Path to client-side script file"},css_file:{type:"string",description:"[create/update/verify] Path to CSS stylesheet file (widgets)"},option_schema_file:{type:"string",description:"[create/update/verify] Path to option schema JSON file (widgets)"},script_file:{type:"string",description:"[create/update/verify] Path to script file (for script includes, business rules, etc.)"},condition_file:{type:"string",description:"[create/update/verify] Path to condition script file (business rules, UI actions)"},application_scope:{type:"string",description:'Application scope for the artifact. Use "global" for global scope.'},validate_es5:{type:"boolean",description:"Validate ES5 syntax for server scripts",default:!0}},required:["action","type"]}};async function VY(Y,X){let{action:J,type:z}=Y,Q=o6[z];if(!Q)return M(`Unsupported artifact type: ${z}. Valid types: ${Object.keys(o6).join(", ")}`);try{switch(J){case"create":return await De(Y,X,Q);case"get":return await je(Y,X,Q);case"update":return await Ce(Y,X,Q);case"delete":return await Ee(Y,X,Q);case"find":return await Se(Y,X,Q);case"list":return await ke(Y,X,Q);case"analyze":return await _e(Y,X,Q);case"export":return await be(Y,X,Q);case"import":return await Re(Y,X,Q);case"verify":return await fe(Y,X,Q);default:return M(`Unknown action: ${J}. Valid actions: create, get, update, delete, find, list, analyze, export, import`)}}catch(G){return M(G instanceof I?G:new I("SERVICENOW_API_ERROR",`Artifact ${J} failed: ${G.message}`,{originalError:G}))}}async function SQ(Y,X){let{artifact_directory:J,template_file:z,server_script_file:Q,client_script_file:G,css_file:Z,option_schema_file:$,script_file:H,condition_file:W,name:K}=Y,U={},B=[];if(J){let V=k7[X];if(V)for(let[L,q]of Object.entries(V))for(let F of q){let P=F.replace("{name}",K||""),A=a6.join(J,P);if(jx(A)){try{U[L]=await q4.readFile(A,"utf-8"),B.push(`${L}  ${P}`)}catch(w){}break}}}let O={template:z,script:H,client_script:G,css:Z,option_schema:$,condition:W,server_script:Q};for(let[V,L]of Object.entries(O))if(L&&typeof L==="string")if(jx(L))try{U[V]=await q4.readFile(L,"utf-8"),B.push(`${V}  ${a6.basename(L)} (explicit)`)}catch(q){return{resolvedFields:U,fileSourceInfo:B,error:`Failed to read file '${L}': ${q.message}`}}else return{resolvedFields:U,fileSourceInfo:B,error:`File not found: ${L}`};return{resolvedFields:U,fileSourceInfo:B}}async function De(Y,X,J){let{type:z,name:Q,title:G,description:Z="",template:$,server_script:H,client_script:W,css:K,option_schema:U,script:B,api_name:O,table:V,when:L,insert:q,update_trigger:F,delete_trigger:P,query_trigger:A,active:w=!0,validate_es5:v=!0,application_scope:T,label:D,extends_table:j,is_extendable:E=!0,create_module:f=!0,create_access_controls:i=!1,column_name:o,column_label:y,internal_type:a,reference_table:r,max_length:b=255,mandatory:R=!1,default_value:l,choice_options:p,artifact_directory:m,template_file:h,server_script_file:_,client_script_file:c,css_file:d,option_schema_file:s,script_file:W0,condition_file:L0}=Y;if(!Q)return M("name is required for create action");let X0=await x(X),b0=await SQ(Y,J);if(b0.error)return M(b0.error);let{resolvedFields:J0,fileSourceInfo:P0}=b0,n=[];if(v){if(H){let Z4=BY(H);if(!Z4.valid)n.push(`Server script contains ES6+ syntax (${Z4.violations.map((YX)=>YX.type).join(", ")}). Consider using ES5 for compatibility.`)}if(B){let Z4=BY(B);if(!Z4.valid)n.push(`Script contains ES6+ syntax (${Z4.violations.map((YX)=>YX.type).join(", ")}). Consider using ES5 for compatibility.`)}}var H0=null,O1="Current Scope";if(T)if(T==="global")H0="global",O1="Global";else{var p1=await X0.get("/api/now/table/sys_app",{params:{sysparm_query:`sys_id=${T}^ORscope=${T}^ORname=${T}`,sysparm_fields:"sys_id,name,scope",sysparm_limit:1}});if(p1.data.result&&p1.data.result.length>0){var S1=p1.data.result[0];H0=S1.sys_id,O1=S1.name}else return M(`Application not found: "${T}"`)}var e={},T1;switch(z){case"sp_widget":case"widget":e={id:O0(Q),name:O0(G||Q),description:O0(Z),template:O0($||J0.template||""),script:O0(H||J0.script||J0.server_script||""),client_script:O0(W||J0.client_script||""),css:O0(K||J0.css||""),option_schema:O0(U||J0.option_schema||""),data_table:!0};break;case"sp_page":case"page":e={id:O0(Q),title:O0(G||Q),description:O0(Z)};break;case"sys_ux_page":case"uib_page":e={name:O0(Q),title:O0(G||Q),description:O0(Z)};break;case"script_include":e={name:O0(Q),api_name:O0(O||Q),script:O0(B||J0.script||""),description:O0(Z),active:w};break;case"business_rule":if(!V)return M("table parameter required for business rules");if(e={name:O0(Q),collection:V,script:O0(B||J0.script||""),description:O0(Z),when:L||"before",insert:q||!1,update:F||!1,delete:P||!1,query:A||!1,active:w},J0.condition)e.condition=O0(J0.condition);break;case"client_script":if(!V)return M("table parameter required for client scripts");e={name:O0(Q),table:V,script:O0(B||J0.script||""),description:O0(Z),active:w};break;case"ui_policy":if(!V)return M("table parameter required for UI policies");e={short_description:O0(Q),table:V,script_true:O0(B||J0.script||""),description:O0(Z),active:w,on_load:!0,reverse_if_false:!1};break;case"ui_action":if(!V)return M("table parameter required for UI actions");if(e={name:O0(Q),table:V,script:O0(B||J0.script||""),comments:O0(Z),active:w,form_action:!0},J0.condition)e.condition=O0(J0.condition);break;case"rest_message":e={name:O0(Q),description:O0(Z),rest_endpoint:"",authentication_type:"no_authentication"};break;case"scheduled_job":e={name:O0(Q),script:O0(B||J0.script||""),comments:O0(Z),active:w};break;case"transform_map":e={name:O0(Q),description:O0(Z),active:w};break;case"fix_script":e={name:O0(Q),script:O0(B||J0.script||""),description:O0(Z)};break;case"table":if(!D)return M("label parameter required for table creation");if(Q.startsWith("x_")&&(!H0||H0==="global"))return M(`Table name "${Q}" uses 'x_' prefix which requires a scoped application. Use 'u_' prefix for global tables or specify application_scope.`);if(e={name:O0(Q),label:O0(D),is_extendable:E},j){var J8=await X0.get("/api/now/table/sys_db_object",{params:{sysparm_query:`name=${j}`,sysparm_fields:"sys_id",sysparm_limit:1}});if(J8.data.result&&J8.data.result.length>0)e.super_class=J8.data.result[0].sys_id;else return M(`Parent table '${j}' not found`)}break;case"field":if(!V)return M("table parameter required for field creation");if(!a)return M("internal_type parameter required for field creation");if(e={name:V,element:O0(o||Q),column_label:O0(y||D||Q),internal_type:a,mandatory:R},a==="reference"&&r)e.reference=r;if(["string","url","email"].includes(a))e.max_length=b;if(l!==void 0)e.default_value=l;break;default:e={name:O0(Q),description:O0(Z)}}if(H0&&H0!=="global")e.sys_scope=H0;var z8=r8[J]||"name",B6=e[z8]||e.name||e.id,Q8=await X0.get(`/api/now/table/${J}`,{params:{sysparm_query:`${z8}=${B6}`,sysparm_limit:1}});if(Q8.data.result&&Q8.data.result.length>0)return M(`${z} '${B6}' already exists. Use action='update' to modify it.`);var U3=await X0.post(`/api/now/table/${J}`,e);if(T1=U3.data.result,z==="table"&&T1){var N0={};if(f)try{var T4={title:D,name:Q,table_name:Q,order:100,active:!0},B3=await X0.post("/api/now/table/sys_app_module",T4);N0.module={sys_id:B3.data.result.sys_id}}catch(Z4){N0.module_error=Z4.message}if(i)try{var z1=[];for(var m4 of["read","write","create","delete"]){var V3=await X0.post("/api/now/table/sys_security_acl",{name:Q,operation:m4,type:"record",admin_overrides:!0,active:!0});z1.push({type:m4,sys_id:V3.data.result.sys_id})}N0.access_controls=z1}catch(Z4){N0.acl_error=Z4.message}T1={...T1,...N0}}if(z==="field"&&a==="choice"&&p&&p.length>0){var k0=[];for(var q0=0;q0<p.length;q0++){var I4=p[q0];try{var Tf={name:V,element:o||Q,label:I4.label,value:I4.value,sequence:(q0+1)*10,inactive:!1},If=await X0.post("/api/now/table/sys_choice",Tf);k0.push({sys_id:If.data.result.sys_id,label:I4.label,value:I4.value})}catch(Z4){k0.push({error:`Failed to create choice '${I4.label}': ${Z4.message}`})}}T1.choices=k0}var V5={action:"create",created:!0,sys_id:T1.sys_id,name:T1.name||T1.id||Q,type:z,table:J,artifact:T1,url:`${X.instanceUrl}/nav_to.do?uri=${J}.do?sys_id=${T1.sys_id}`};if(H0)V5.application_scope={sys_id:H0,name:O1};if(n.length>0)V5.warnings=n;if(P0.length>0)V5.file_sources=P0,V5.artifact_directory=m;return N(V5)}async function je(Y,X,J){let{type:z,sys_id:Q,identifier:G,fields:Z}=Y;if(!Q&&!G)return M("sys_id or identifier is required for get action");let $=await x(X);var H=null;if(Q)try{var W=await $.get(`/api/now/table/${J}/${Q}`,{params:Z?{sysparm_fields:Z}:{}});H=W.data.result}catch(O){}if(!H&&G){var K=r8[J]||"name",U=[`${K}=${G}`];if(J==="sp_widget")U.push(`id=${G}`);U.push(`name=${G}`);var B=await $.get(`/api/now/table/${J}`,{params:{sysparm_query:U.join("^OR"),sysparm_limit:1,...Z?{sysparm_fields:Z}:{}}});if(B.data.result&&B.data.result.length>0)H=B.data.result[0]}if(!H)return M(`${z} not found: ${Q||G}`);return N({action:"get",found:!0,sys_id:H.sys_id,name:H.name||H.id||H.title,type:z,table:J,artifact:H,url:`${X.instanceUrl}/nav_to.do?uri=${J}.do?sys_id=${H.sys_id}`})}async function Ce(Y,X,J){let{type:z,sys_id:Q,identifier:G,config:Z={},validate:$=!0,create_backup:H=!1,validate_es5:W=!0}=Y;if(!Q&&!G)return M("sys_id or identifier is required for update action");let K=await SQ(Y,J);if(K.error)return M(K.error);let U={},B=["script","template","server_script","client_script","css","option_schema","description","active"];for(let o of B)if(Y[o]!==void 0)U[o]=Y[o];let O={...K.resolvedFields,...U,...Z};if(Object.keys(O).length===0)return M("No update content provided. Use config object and/or file parameters (script_file, template_file, artifact_directory, etc.)");let V=await x(X);var L=await _7(V,J,Q,G);if(!L)return M(`${z} '${Q||G}' not found`);var q=L.sys_id,F=[];if(W){if(O.script){var P=BY(O.script);if(!P.valid)F.push("Script contains ES6+ syntax. Consider using ES5 for compatibility.")}if(O.server_script){var A=BY(O.server_script);if(!A.valid)F.push("Server script contains ES6+ syntax. Consider using ES5 for compatibility.")}}if($&&J==="sp_widget"){if(O.template!==void 0&&!O.template.trim())return M("Widget template cannot be empty")}var w=null;if(H)try{var v={table:J,record_sys_id:q,backup_data:JSON.stringify(L),created:new Date().toISOString()},T=await V.post("/api/now/table/sys_update_xml_backup",v);w=T.data.result.sys_id}catch(o){F.push(`Backup creation failed: ${o.message}`)}var D={};for(var j of Object.keys(O))if(typeof O[j]==="string")D[j]=O0(O[j]);else D[j]=O[j];var E=await V.patch(`/api/now/table/${J}/${q}`,D),f=E.data.result,i={action:"update",updated:!0,sys_id:q,name:f.name||f.id||G,type:z,table:J,updated_fields:Object.keys(O),backup_id:w,artifact:f,url:`${X.instanceUrl}/nav_to.do?uri=${J}.do?sys_id=${q}`};if(K.fileSourceInfo.length>0)i.file_sources=K.fileSourceInfo;if(F.length>0)i.warnings=F;return N(i)}async function Ee(Y,X,J){let{type:z,sys_id:Q,identifier:G,soft_delete:Z=!1,force:$=!1}=Y;if(!Q&&!G)return M("sys_id or identifier is required for delete action");let H=await x(X);var W=await _7(H,J,Q,G);if(!W)return M(`${z} '${Q||G}' not found`);var K=W.sys_id,U=[];if(!$){var B=await H.get("/api/now/table/sys_dictionary",{params:{sysparm_query:`reference=${J}^internal_type=reference`,sysparm_fields:"name,element",sysparm_limit:100}});for(var O of B.data.result||[])try{var V=await H.get(`/api/now/table/${O.name}`,{params:{sysparm_query:`${O.element}=${K}`,sysparm_fields:"sys_id",sysparm_limit:5}});if(V.data.result&&V.data.result.length>0)U.push({table:O.name,field:O.element,count:V.data.result.length})}catch(q){}if(U.length>0)return M(`Cannot delete ${z} with dependencies. Use force=true to override.`,{details:{dependencies:U}})}if(Z){var L=await H.get("/api/now/table/sys_dictionary",{params:{sysparm_query:`name=${J}^element=active`,sysparm_fields:"element",sysparm_limit:1}});if(L.data.result&&L.data.result.length>0)return await H.patch(`/api/now/table/${J}/${K}`,{active:"false"}),N({action:"delete",deleted:!0,soft_delete:!0,sys_id:K,name:W.name||W.id,type:z,table:J,message:"Artifact marked as inactive (soft delete)"});else return M(`Table '${J}' does not support soft delete (no 'active' field)`)}else return await H.delete(`/api/now/table/${J}/${K}`),N({action:"delete",deleted:!0,soft_delete:!1,sys_id:K,name:W.name||W.id,type:z,table:J,message:"Artifact permanently deleted",forced:$&&U.length>0})}async function Se(Y,X,J){let{type:z,query:Q,table:G,limit:Z=10,fields:$}=Y;if(!Q)return M("query is required for find action");let H=await x(X);var W=`nameLIKE${Q}^ORshort_descriptionLIKE${Q}`;if(J==="sp_widget")W=`nameLIKE${Q}^ORidLIKE${Q}`;if(G&&(z==="business_rule"||z==="client_script"||z==="ui_policy"))W+=`^collection=${G}`;var K=await H.get(`/api/now/table/${J}`,{params:{sysparm_query:W,sysparm_limit:Z,...$?{sysparm_fields:$}:{sysparm_fields:"sys_id,name,id,title,short_description,active"}}}),U=K.data.result||[];return N({action:"find",found:U.length>0,count:U.length,type:z,table:J,query:Q,results:U.map((B)=>({sys_id:B.sys_id,name:B.name||B.id||B.title,description:B.short_description||B.description,active:B.active,url:`${X.instanceUrl}/nav_to.do?uri=${J}.do?sys_id=${B.sys_id}`}))})}async function ke(Y,X,J){let{type:z,limit:Q=20,fields:G}=Y;var $=await(await x(X)).get(`/api/now/table/${J}`,{params:{sysparm_limit:Q,sysparm_orderby:"sys_updated_on",sysparm_order:"desc",...G?{sysparm_fields:G}:{sysparm_fields:"sys_id,name,id,title,short_description,active,sys_updated_on"}}}),H=$.data.result||[];return N({action:"list",count:H.length,type:z,table:J,artifacts:H.map((W)=>({sys_id:W.sys_id,name:W.name||W.id||W.title,description:W.short_description||W.description,active:W.active,updated_at:W.sys_updated_on,url:`${X.instanceUrl}/nav_to.do?uri=${J}.do?sys_id=${W.sys_id}`}))})}async function _e(Y,X,J){let{type:z,sys_id:Q,identifier:G}=Y;if(!Q&&!G)return M("sys_id or identifier is required for analyze action");let Z=await x(X);var $=await _7(Z,J,Q,G);if(!$)return M(`${z} '${Q||G}' not found`);var H={meta:{sys_id:$.sys_id,name:$.name||$.id||$.title,type:z,table:J,active:$.active,last_updated:$.sys_updated_on},structure:{fields:Object.keys($).filter((V)=>!V.startsWith("sys_")),hasScript:!!($.script||$.server_script),hasClientScript:!!$.client_script,hasTemplate:!!$.template,hasCSS:!!$.css},dependencies:[],modificationPoints:[]},W=$.script||$.server_script||"";if(W){var K=W.match(/new GlideRecord\(['"]([^'"]+)['"]\)/g);if(K){var U=[...new Set(K.map((V)=>{var L=V.match(/['"]([^'"]+)['"]/);return L?L[1]:null}).filter(Boolean))];H.dependencies.push({type:"table",references:U})}var B=W.match(/new ([A-Z][a-zA-Z0-9_]+)\(/g);if(B){var O=[...new Set(B.map((V)=>{var L=V.match(/new ([A-Z][a-zA-Z0-9_]+)/);return L?L[1]:null}).filter(Boolean))];H.dependencies.push({type:"script_include",references:O})}}if(J==="sp_widget")H.modificationPoints=[{field:"template",description:"HTML template structure"},{field:"script",description:"Server-side data processing"},{field:"client_script",description:"Client-side behavior"},{field:"css",description:"Widget styling"}];return N({action:"analyze",analyzed:!0,sys_id:$.sys_id,name:$.name||$.id,type:z,table:J,analysis:H})}async function be(Y,X,J){let{type:z,sys_id:Q,identifier:G,format:Z="json",export_path:$}=Y;if(!Q&&!G)return M("sys_id or identifier is required for export action");if(Z==="files"&&!$)return M('export_path is required when using format="files"');let H=await x(X);var W=await _7(H,J,Q,G);if(!W)return M(`${z} '${Q||G}' not found`);var K;if(Z==="files"){let V=[];try{await q4.mkdir($,{recursive:!0});let L=vx[J];if(L){for(let[A,w]of Object.entries(L))if(W[A]&&W[A].trim()){let v=a6.join($,w);await q4.writeFile(v,W[A],"utf-8"),V.push(w)}}let q={sys_id:W.sys_id,name:W.name||W.id,type:z,table:J,exported_at:new Date().toISOString()},F=new Set(["template","script","client_script","css","option_schema","condition","script_true"]);for(let[A,w]of Object.entries(W))if(!A.startsWith("sys_")&&!F.has(A)&&w!==null&&w!==void 0)q[A]=w;let P=a6.join($,"metadata.json");return await q4.writeFile(P,JSON.stringify(q,null,2),"utf-8"),V.push("metadata.json"),N({action:"export",exported:!0,sys_id:W.sys_id,name:W.name||W.id,type:z,table:J,format:Z,export_path:$,files:V})}catch(L){return M(`Failed to export files: ${L.message}`)}}else if(Z==="json"){if(K={type:z,table:J,sys_id:W.sys_id,name:W.name||W.id,exported_at:new Date().toISOString(),data:W},$)try{let V=$.endsWith(".json")?$:$+".json";return await q4.writeFile(V,JSON.stringify(K,null,2),"utf-8"),N({action:"export",exported:!0,sys_id:W.sys_id,name:W.name||W.id,type:z,table:J,format:Z,export_path:V,data:K})}catch(V){return M(`Failed to write JSON file: ${V.message}`)}}else if(Z==="xml"){var U=['<?xml version="1.0" encoding="UTF-8"?>'];U.push(`<${z}>`);for(var B of Object.keys(W))if(W[B]!==null&&W[B]!==void 0){var O=String(W[B]).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;");U.push(`  <${B}>${O}</${B}>`)}if(U.push(`</${z}>`),K=U.join(`
`),$)try{let V=$.endsWith(".xml")?$:$+".xml";return await q4.writeFile(V,K,"utf-8"),N({action:"export",exported:!0,sys_id:W.sys_id,name:W.name||W.id,type:z,table:J,format:Z,export_path:V,data:K})}catch(V){return M(`Failed to write XML file: ${V.message}`)}}else return M(`Unsupported format: ${Z}. Valid formats: json, xml, files`);return N({action:"export",exported:!0,sys_id:W.sys_id,name:W.name||W.id,type:z,table:J,format:Z,data:K})}async function Re(Y,X,J){let{type:z,file_path:Q,data:G,format:Z="json"}=Y;if(!Q&&!G)return M("file_path or data is required for import action");let $=await x(X);var H;if(Q){var W=await q4.readFile(Q,"utf-8");if(Z==="json"){if(H=JSON.parse(W),H.data)H=H.data}else if(Z==="xml"){var K={},U=/<(\w+)>([^<]*)<\/\1>/g,B;while((B=U.exec(W))!==null)K[B[1]]=B[2].replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&");H=K}else return M(`Unsupported format: ${Z}`)}else H=G;var O={...H};delete O.sys_id,delete O.sys_created_on,delete O.sys_created_by,delete O.sys_updated_on,delete O.sys_updated_by,delete O.sys_mod_count;var V=r8[J]||"name",L=O[V]||O.name||O.id,q=await $.get(`/api/now/table/${J}`,{params:{sysparm_query:`${V}=${L}`,sysparm_limit:1}}),F;if(q.data.result&&q.data.result.length>0){var P=q.data.result[0].sys_id,A=await $.put(`/api/now/table/${J}/${P}`,O);F={sys_id:P,action:"updated",artifact:A.data.result}}else{var w=await $.post(`/api/now/table/${J}`,O);F={sys_id:w.data.result.sys_id,action:"created",artifact:w.data.result}}return N({action:"import",imported:!0,import_action:F.action,sys_id:F.sys_id,name:O.name||O.id,type:z,table:J,url:`${X.instanceUrl}/nav_to.do?uri=${J}.do?sys_id=${F.sys_id}`})}async function fe(Y,X,J){let{type:z,sys_id:Q,identifier:G}=Y;if(!Q&&!G)return M("sys_id or identifier is required for verify action");let Z=await SQ(Y,J);if(Z.error)return M(Z.error);if(Object.keys(Z.resolvedFields).length===0)return M("No local files to verify against. Provide file parameters (script_file, template_file, etc.) or artifact_directory.");let $=await x(X);var H=await _7($,J,Q,G);if(!H)return M(`${z} '${Q||G}' not found`);let W=[],K=!0;for(let[U,B]of Object.entries(Z.resolvedFields)){let O=H[U]||"",V=B.replace(/\r\n/g,`
`).trim(),L=O.replace(/\r\n/g,`
`).trim(),q=V===L;if(!q)K=!1;let F={field:U,matches:q,local:{lines:V.split(`
`).length,characters:V.length},deployed:{lines:L.split(`
`).length,characters:L.length}};if(!q){F.difference={line_diff:V.split(`
`).length-L.split(`
`).length,char_diff:V.length-L.length};let P=V.split(`
`),A=L.split(`
`);for(let w=0;w<Math.max(P.length,A.length);w++)if(P[w]!==A[w]){F.first_diff_line=w+1,F.first_diff_local=(P[w]||"(missing)").substring(0,200),F.first_diff_deployed=(A[w]||"(missing)").substring(0,200);break}}W.push(F)}return N({action:"verify",verified:K,sys_id:H.sys_id,name:H.name||H.id||G,type:z,table:J,comparisons:W,file_sources:Z.fileSourceInfo,url:`${X.instanceUrl}/nav_to.do?uri=${J}.do?sys_id=${H.sys_id}`})}async function _7(Y,X,J,z){if(J)try{var Q=await Y.get(`/api/now/table/${X}/${J}`);if(Q.data.result)return Q.data.result}catch(H){}if(z){var G=r8[X]||"name",Z=[`${G}=${z}`];if(X==="sp_widget")Z.push(`id=${z}`);Z.push(`name=${z}`);var $=await Y.get(`/api/now/table/${X}`,{params:{sysparm_query:Z.join("^OR"),sysparm_limit:1}});if($.data.result&&$.data.result.length>0)return $.data.result[0]}return null}function O0(Y){if(!Y)return"";return Y.replace(/\r\n/g,`
`).replace(/\r/g,`
`).replace(/[\x00-\x08\x0B\x0C\x0E-\x1F\x7F\x80-\x9F]/g,"").replace(/[\u200B-\u200D\uFEFF]/g,"")}function BY(Y){var X=[],J=/\b(const|let)\s+/g,z;while((z=J.exec(Y))!==null)X.push({type:z[1],line:Y.substring(0,z.index).split(`
`).length,fix:`Use 'var' instead of '${z[1]}'`});var Q=/\([^)]*\)\s*=>/g;while((z=Q.exec(Y))!==null)X.push({type:"arrow_function",line:Y.substring(0,z.index).split(`
`).length,fix:"Use function() {} instead of arrow function"});var G=/`[^`]*`/g;while((z=G.exec(Y))!==null)X.push({type:"template_literal",line:Y.substring(0,z.index).split(`
`).length,fix:"Use string concatenation instead of template literals"});return{valid:X.length===0,violations:X}}var Ex={name:"snow_auth_diagnostics",description:"Performs comprehensive authentication and permission diagnostics. Tests OAuth tokens, API access, table permissions, and provides specific remediation steps.",category:"development",subcategory:"deployment",use_cases:["deployment","diagnostics","authentication"],complexity:"advanced",frequency:"medium",permission:"read",allowedRoles:["developer","stakeholder","admin"],inputSchema:{type:"object",properties:{run_write_test:{type:"boolean",description:"Test widget write permissions (creates and deletes test widget)",default:!0},include_recommendations:{type:"boolean",description:"Include troubleshooting recommendations",default:!0}}}};async function Sx(Y,X){let{run_write_test:J=!0,include_recommendations:z=!0}=Y;try{let Q=await x(X),G={};try{let W=await Q.get("/api/now/table/sys_properties",{params:{sysparm_query:"name=glide.servlet.uri",sysparm_limit:1}});G.systemPropertiesAccess={status:" Success",description:"Can read system properties",details:W.data.result?"System API accessible":"No results returned"}}catch(W){G.systemPropertiesAccess={status:" Failed",description:"Cannot access system properties",error:W.message}}try{let W=await Q.get("/api/now/table/sys_user",{params:{sysparm_limit:1,sysparm_fields:"sys_id,user_name"}});G.userTableAccess={status:" Success",description:"Can access user table",details:W.data.result?.length>0?`Found ${W.data.result.length} user records`:"No users found"}}catch(W){G.userTableAccess={status:" Failed",description:"Cannot access user table",error:W.message}}try{let W=await Q.get("/api/now/table/sys_update_set",{params:{sysparm_limit:1,sysparm_fields:"name,state"}});G.updateSetAccess={status:" Success",description:"Can access Update Sets (deployment ready)",details:W.data.result?.length>0?`Found ${W.data.result.length} update sets`:"No update sets found"}}catch(W){G.updateSetAccess={status:" Critical",description:"Cannot access Update Sets - deployments will fail!",error:W.message}}try{let W=await Q.get("/api/now/table/sp_widget",{params:{sysparm_limit:1,sysparm_fields:"name,title"}});G.widgetTableAccess={status:" Success",description:"Can access Service Portal widgets",details:W.data.result?.length>0?`Found ${W.data.result.length} widgets`:"No widgets found"}}catch(W){G.widgetTableAccess={status:" Limited",description:"Cannot access Service Portal - widget deployments may fail",error:W.message}}if(J)try{let W={name:"snow_flow_connectivity_test",title:"Snow-Flow Connectivity Test",template:"<div>Test widget - safe to delete</div>",description:"Temporary test widget created by Snow-Flow MCP diagnostics"},K=await Q.post("/api/now/table/sp_widget",W);if(K.data.result?.sys_id){let U=K.data.result.sys_id;try{await Q.delete(`/api/now/table/sp_widget/${U}`),G.writePermissions={status:" Full Access",description:"Can create and delete artifacts - full deployment capability",details:`Successfully created and cleaned up test widget ${U}`}}catch(B){G.writePermissions={status:" Partial",description:"Can create but cannot delete - cleanup may be needed",details:`Created test widget ${U} but failed to delete: ${B.message}`}}}}catch(W){G.writePermissions={status:" Read-Only",description:"Cannot create artifacts - deployments will fail",error:W.message}}let Z=Object.values(G).filter((W)=>W.status.includes("")).length,$=Object.keys(G).length,H=[];if(z){if(G.updateSetAccess?.status?.includes(""))H.push("Critical: Fix Update Set access for deployment capability");if(G.writePermissions?.status?.includes(""))H.push("Request write permissions for artifact creation");if(G.systemPropertiesAccess?.status?.includes(""))H.push("Basic API access failed - check authentication and network")}return N({tests:G,summary:{successCount:Z,totalTests:$,successRate:Math.round(Z/$*100)},recommendations:H,timestamp:new Date().toISOString(),instance_url:X.instanceUrl},{message:`\uD83D\uDD10 Authentication Diagnostics Complete

Tests Passed: ${Z}/${$} (${Math.round(Z/$*100)}%)

${Object.entries(G).map(([W,K])=>`${K.status} ${W}: ${K.description}`).join(`
`)}

${H.length>0?`\uD83D\uDCA1 Recommendations:
`+H.map((W,K)=>`${K+1}. ${W}`).join(`
`):" All checks passed!"}`})}catch(Q){return M(Q instanceof I?Q:new I("UNAUTHORIZED",`Auth diagnostics failed: ${Q.message}`,{originalError:Q}))}}var kx={name:"snow_clone_instance_artifact",description:"Clones artifacts directly between ServiceNow instances (devtestprod). Handles authentication, dependency resolution, and data migration.",category:"development",subcategory:"deployment",use_cases:["deployment","migration","clone"],complexity:"advanced",frequency:"low",permission:"write",allowedRoles:["developer","admin"],inputSchema:{type:"object",properties:{source_instance:{type:"string",description:"Source instance URL"},target_instance:{type:"string",description:"Target instance URL"},type:{type:"string",enum:["widget","application"],description:"Artifact type"},sys_id:{type:"string",description:"Sys ID of the artifact to clone"}},required:["source_instance","target_instance","type","sys_id"]}};async function _x(Y,X){let{source_instance:J,target_instance:z,type:Q,sys_id:G}=Y;try{let $={widget:"sp_widget",application:"sys_app"}[Q];if(!$)throw new I("INVALID_REQUEST",`Unsupported artifact type: ${Q}`,{retryable:!1});let H=`https://${J}/api/now/table/${$}/${G}`;return N({message:"Cross-instance cloning requires additional authentication setup",steps:["1. Export artifact from source using snow_export_artifact","2. Save exported JSON/XML file","3. Import to target using snow_import_artifact with target instance credentials"],alternative:"Use Update Sets for proper instance-to-instance migration"},{message:` Cross-Instance Cloning

Direct cross-instance cloning requires additional authentication configuration.

Recommended workflow:
1. Export from source: snow_export_artifact({ type: "${Q}", sys_id: "${G}" })
2. Import to target: snow_import_artifact({ type: "${Q}", file_path: "exported.json" })

Or use Update Sets for complete change management.`})}catch(Z){return M(Z instanceof I?Z:new I("NETWORK_ERROR",`Clone failed: ${Z.message}`,{originalError:Z}))}}var bx={name:"snow_create_solution_package",description:`Creates a MULTI-ARTIFACT solution package with Update Set tracking.

 WHEN TO USE THIS TOOL:
- Creating 3+ related artifacts that form a complete solution
- Need automatic Update Set creation for the entire package
- Deploying a "feature bundle" (e.g., widget + script includes + business rules)

 DO NOT USE FOR:
- Creating a SINGLE widget  use snow_artifact_manage instead
- Creating a SINGLE script include  use snow_artifact_manage instead
- Creating individual artifacts  use snow_artifact_manage instead

 GOOD USE CASE:
"Create HR Portal solution with: widget, 2 script includes, 1 business rule"

 BAD USE CASE:
"Create a widget for displaying incidents"  Use snow_artifact_manage!`,category:"development",subcategory:"deployment",use_cases:["multi-artifact","solution-bundle","feature-package"],complexity:"advanced",frequency:"low",permission:"write",allowedRoles:["developer","admin"],inputSchema:{type:"object",properties:{name:{type:"string",description:"Solution package name"},description:{type:"string",description:"Package description"},artifacts:{type:"array",description:"Artifacts to include in the package",items:{type:"object",properties:{type:{type:"string",enum:["widget","script_include","business_rule","table"]},create:{type:"object",description:"Artifact creation configuration"}}}},new_update_set:{type:"boolean",description:"Force new update set",default:!0}},required:["name","artifacts"]}};async function Rx(Y,X){let{name:J,description:z,artifacts:Q,new_update_set:G=!0}=Y;try{let Z=await x(X),$={package_name:J,created_artifacts:[],update_set_id:null,errors:[]};if(G){let K=await Z.post("/api/now/table/sys_update_set",{name:`${J} - Solution Package`,description:z||`Solution package: ${J}`,state:"in progress"});$.update_set_id=K.data.result.sys_id,await Z.put(`/api/now/table/sys_update_set/${$.update_set_id}`,{is_current:!0})}for(let K of Q)try{let U=await VY({action:"create",type:K.type,...K.create},X);if(!U.success){$.errors.push({type:K.type,error:U.error||"Unknown error"});continue}let B=U.data||{};$.created_artifacts.push({type:K.type,sys_id:B.sys_id,name:B.name,table:B.table,url:B.url})}catch(U){$.errors.push({type:K.type,error:U.message})}let H={package:J,description:z,created_at:new Date().toISOString(),update_set:$.update_set_id,artifacts:$.created_artifacts,total_artifacts:$.created_artifacts.length,total_errors:$.errors.length},W=` Solution Package Created

`+`Package: ${J}
Update Set: ${$.update_set_id}
Artifacts Created: ${$.created_artifacts.length}
Errors: ${$.errors.length}

Artifacts:
${$.created_artifacts.map((K)=>`- ${K.type}: ${K.name} (${K.sys_id})`).join(`
`)}`+($.errors.length>0?`

Errors:
${$.errors.map((K)=>`- ${typeof K==="string"?K:K.error}`).join(`
`)}`:"");return N({...$,documentation:H},{message:W})}catch(Z){return M(Z instanceof I?Z:new I("NETWORK_ERROR",`Solution package creation failed: ${Z.message}`,{originalError:Z}))}}var fx={name:"snow_deployment_debug",description:"Provides detailed debugging information including authentication status, permissions, active sessions, and recent deployment logs for troubleshooting.",category:"development",subcategory:"deployment",use_cases:["deployment","debugging","diagnostics"],complexity:"intermediate",frequency:"medium",permission:"write",allowedRoles:["developer","admin"],inputSchema:{type:"object",properties:{}}};async function yx(Y,X){try{let J=await x(X),z={timestamp:new Date().toISOString(),instance:X.instanceUrl,checks:{}};try{let $=await J.get("/api/now/table/sys_user/me");z.checks.authentication={status:" Authenticated",user:$.data.result?.user_name||"Unknown",roles:$.data.result?.roles||"Not retrieved"}}catch($){z.checks.authentication={status:" Authentication Failed",error:$.message}}try{let $=await J.get("/api/now/table/sys_update_set",{params:{sysparm_query:"state=in progress",sysparm_limit:5,sysparm_fields:"name,state,sys_id"}});z.checks.updateSets={status:" Accessible",active:$.data.result||[]}}catch($){z.checks.updateSets={status:" Not Accessible",error:$.message}}try{let $=await J.get("/api/now/table/syslog",{params:{sysparm_query:"level=error^sys_created_on>=javascript:gs.daysAgoStart(1)^ORDERBYDESCsys_created_on",sysparm_limit:5,sysparm_fields:"message,source,sys_created_on"}});z.checks.recentErrors={status:$.data.result?.length>0?" Errors Found":" No Recent Errors",errors:$.data.result||[]}}catch($){z.checks.recentErrors={status:" Cannot Access Logs",error:$.message}}try{let $=await J.get("/api/now/table/sp_portal",{params:{sysparm_limit:1,sysparm_fields:"title"}});z.checks.servicePortal={status:" Accessible",portals:$.data.result?.length||0}}catch($){z.checks.servicePortal={status:" Not Accessible",error:$.message}}z.checks.apiLimits={status:" No Limits Detected",note:"ServiceNow typically allows 5000 API calls per hour"};let Q=Object.values(z.checks).filter(($)=>$.status?.includes("")).length,G=Object.keys(z.checks).length,Z=`\uD83D\uDD0D Deployment Debug Information

`+`Instance: ${z.instance}
Timestamp: ${z.timestamp}
Health: ${Q}/${G} checks passed

`+Object.entries(z.checks).map(([$,H])=>`${H.status} ${$}: ${H.error||H.note||"OK"}`).join(`
`);return N(z,{message:Z})}catch(J){return M(J instanceof I?J:new I("NETWORK_ERROR",`Debug info failed: ${J.message}`,{originalError:J}))}}var mx={name:"snow_deployment_status",description:"Retrieves comprehensive deployment status including active deployments, recent history, success rates, and performance metrics.",category:"development",subcategory:"deployment",use_cases:["deployment","monitoring","history"],complexity:"beginner",frequency:"medium",permission:"read",allowedRoles:["developer","stakeholder","admin"],inputSchema:{type:"object",properties:{limit:{type:"number",description:"Number of recent deployments to show",default:10}}}};async function ux(Y,X){let{limit:J=10}=Y;try{let z=await x(X),Q=await z.get("/api/now/table/sys_update_set",{params:{sysparm_query:"sys_created_on>=javascript:gs.daysAgoStart(7)^ORDERBYDESCsys_created_on",sysparm_limit:J,sysparm_fields:"name,description,state,sys_created_on,sys_updated_on,sys_created_by,sys_updated_by"}}),G=await z.get("/api/now/table/sp_widget",{params:{sysparm_query:"sys_created_on>=javascript:gs.daysAgoStart(7)^ORDERBYDESCsys_created_on",sysparm_limit:5,sysparm_fields:"name,title,sys_created_on,sys_created_by"}}),Z=[];if(Q.data.result)for(let L of Q.data.result){let q=L.state==="complete"?"":L.state==="ignore"?"":"",F=hx(L.sys_created_on);Z.push({type:"Update Set",name:L.name,status:q,time:F,details:`State: ${L.state}${L.description?` - ${L.description}`:""}`})}if(G.data.result)for(let L of G.data.result){let q=hx(L.sys_created_on);Z.push({type:"Widget",name:L.name,status:"",time:q,details:L.title||"Service Portal Widget"})}Z.sort((L,q)=>{let F=new Date(L.time.includes("ago")?Date.now():L.time);return new Date(q.time.includes("ago")?Date.now():q.time).getTime()-F.getTime()});let $=Z.slice(0,J),H=Z.filter((L)=>L.time.includes("hour")||L.time.includes("minute")).length,W=Z.filter((L)=>L.status==="").length,K=Z.length,U=K>0?Math.round(W/K*100):0,B=$.map((L,q)=>`${q+1}. ${L.status} ${L.type}: ${L.name} - ${L.time}
   ${L.details}`).join(`
`),O=await z.get("/api/now/table/sys_update_set",{params:{sysparm_query:"state!=complete^state!=ignore",sysparm_fields:"name,state",sysparm_limit:5}}),V="";if(O.data.result?.length>0)V=`
\uD83D\uDD04 Active Update Sets:
`+O.data.result.map((L)=>`   - ${L.name} (${L.state})`).join(`
`);return N({deployments:$,statistics:{successRate:U,successful:W,total:K,totalToday:H},activeUpdateSets:O.data.result||[]},{message:`\uD83D\uDCCA Recent Deployment History (Last ${J}):

${B||"No recent deployments found in the last 7 days"}

\uD83D\uDCC8 Deployment Statistics:
- Success Rate: ${U}% (${W}/${K} deployments)
- Total Deployments Today: ${H}
- Total Deployments (7 days): ${K}${V}

\uD83D\uDD17 View complete history in ServiceNow: System Update Sets > Local Update Sets`})}catch(z){return M(z instanceof I?z:new I("NETWORK_ERROR",`Failed to get deployment status: ${z.message}`,{originalError:z}))}}function hx(Y){try{let X=new Date(Y),z=new Date().getTime()-X.getTime(),Q=Math.floor(z/60000),G=Math.floor(z/3600000),Z=Math.floor(z/86400000);if(Q<60)return`${Q} minutes ago`;else if(G<24)return`${G} hours ago`;else return`${Z} days ago`}catch(X){return Y}}var gx={name:"snow_rollback_deployment",description:"Rollback failed deployment by reverting to previous version or deleting artifact",category:"development",subcategory:"deployment",use_cases:["deployment","rollback","recovery"],complexity:"advanced",frequency:"low",permission:"write",allowedRoles:["developer","admin"],inputSchema:{type:"object",properties:{sys_id:{type:"string",description:"sys_id of artifact to rollback"},table:{type:"string",description:"Table name (sp_widget, sys_ux_page, etc.)",enum:["sp_widget","sys_ux_page","sys_hub_flow","sys_script_include"]},action:{type:"string",enum:["revert","delete"],description:"Rollback action: revert to previous version or delete artifact",default:"revert"},update_set_id:{type:"string",description:"Update Set sys_id to rollback (optional)"},reason:{type:"string",description:"Reason for rollback (for audit trail)"}},required:["sys_id","table"]}};async function px(Y,X){let{sys_id:J,table:z,action:Q="revert",update_set_id:G,reason:Z}=Y;try{let $=await x(X),H=await $.get(`/api/now/table/${z}/${J}`);if(!H.data||!H.data.result)throw new I("RESOURCE_NOT_FOUND",`Artifact not found: ${z}/${J}`,{retryable:!1});let W=H.data.result,K;if(Q==="delete")await $.delete(`/api/now/table/${z}/${J}`),K={action:"deleted",artifact:{sys_id:J,table:z,name:W.name||W.id}};else{let U=await ye($,z,J);if(!U)throw new I("RESOURCE_NOT_FOUND","No previous version found to revert to",{retryable:!1,details:{artifact:J,table:z}});let B=await $.put(`/api/now/table/${z}/${J}`,U);K={action:"reverted",artifact:{sys_id:J,table:z,name:W.name||W.id},previous_version:U.sys_updated_on}}if(G)try{await $.delete(`/api/now/table/sys_update_set/${G}`),K.update_set_rolled_back=!0}catch(U){K.update_set_rollback_failed=!0,K.update_set_error=U.message}if(Z)await me($,{artifact_sys_id:J,table:z,action:Q,reason:Z,rollback_result:K});return N(K,{timestamp:new Date().toISOString(),reason:Z||"No reason provided"})}catch($){return M($ instanceof I?$:new I("ROLLBACK_FAILED",`Rollback failed: ${$.message}`,{originalError:$}))}}async function ye(Y,X,J){try{let Q=(await Y.get("/api/now/table/sys_update_version",{params:{sysparm_query:`name=${X}_${J}^ORDERBYDESCsys_created_on`,sysparm_limit:2}})).data.result;if(Q.length<2)return null;let G=Q[1].payload;return he(G)}catch(z){return console.error("[Rollback] Failed to get previous version:",z),null}}function he(Y){let X={},J=/<(\w+)>([^<]*)<\/\1>/g,z;while((z=J.exec(Y))!==null)X[z[1]]=z[2];return X}async function me(Y,X){try{await Y.post("/api/now/table/sys_audit",{tablename:X.table,documentkey:X.artifact_sys_id,fieldname:"rollback",oldvalue:JSON.stringify(X.rollback_result),newvalue:X.action,reason:X.reason,user:"snow-flow"})}catch(J){console.warn("[Rollback] Failed to create audit log:",J)}}var cx={name:"snow_validate_deployment",description:"Validate artifact before deployment (ES5, coherence, dependencies, security)",category:"development",subcategory:"deployment",use_cases:["deployment","validation","quality"],complexity:"advanced",frequency:"high",permission:"read",allowedRoles:["developer","stakeholder","admin"],inputSchema:{type:"object",properties:{type:{type:"string",enum:["widget","page","flow","script_include","business_rule"],description:"Artifact type to validate"},artifact:{type:"object",description:"Artifact configuration to validate"},checks:{type:"array",items:{type:"string",enum:["es5","coherence","dependencies","security","performance"]},description:"Validation checks to perform",default:["es5","coherence","dependencies"]}},required:["type","artifact"]}};async function dx(Y,X){let{type:J,artifact:z,checks:Q=["es5","coherence","dependencies"]}=Y;try{let G=await x(X),Z={valid:!0,critical_failures:0,warnings:0,checks:[]};if(Q.includes("es5")&&z.script){let $=await ue(z.script);if(Z.checks.push({name:"ES5 Syntax",status:$.valid?"PASS":"FAIL",critical:!0,violations:$.violations}),!$.valid)Z.valid=!1,Z.critical_failures++}if(Q.includes("coherence")&&J==="widget"){let $=await ge(z),H=$.issues.filter((W)=>W.severity==="critical");if(Z.checks.push({name:"Widget Coherence",status:H.length===0?"PASS":"FAIL",critical:!0,issues:$.issues,analysis:$.analysis}),H.length>0)Z.valid=!1,Z.critical_failures+=H.length;Z.warnings+=$.issues.filter((W)=>W.severity==="warning").length}if(Q.includes("dependencies")){let $=await pe(G,z);if(Z.checks.push({name:"Dependencies",status:$.allExist?"PASS":"FAIL",critical:!0,missing:$.missing}),!$.allExist)Z.valid=!1,Z.critical_failures+=$.missing.length}if(Q.includes("security")){let $=await ce(z);Z.checks.push({name:"Security",status:$.critical.length===0?"PASS":"WARNING",critical:!1,issues:$}),Z.warnings+=$.warnings.length}if(Q.includes("performance")){let $=await de(z);Z.checks.push({name:"Performance",status:$.issues.length===0?"PASS":"WARNING",critical:!1,issues:$.issues}),Z.warnings+=$.issues.length}return Z.recommendation=Z.critical_failures>0?"FIX_ERRORS_BEFORE_DEPLOY":Z.warnings>0?"PROCEED_WITH_CAUTION":"PROCEED",N(Z)}catch(G){return M(G.message)}}async function ue(Y){let X=[];return[{regex:/\b(const|let)\s+/g,type:"const/let",fix:"Use 'var'"},{regex:/\([^)]*\)\s*=>/g,type:"arrow_function",fix:"Use function() {}"},{regex:/`[^`]*`/g,type:"template_literal",fix:"Use string concatenation"},{regex:/\{[^}]*\}\s*=\s*/g,type:"destructuring",fix:"Use explicit properties"},{regex:/for\s*\([^)]*\s+of\s+/g,type:"for_of",fix:"Use traditional for loop"}].forEach(({regex:z,type:Q,fix:G})=>{let Z;while((Z=z.exec(Y))!==null)X.push({type:Q,line:Y.substring(0,Z.index).split(`
`).length,code:Z[0],fix:G})}),{valid:X.length===0,violations:X}}async function ge(Y){let X=[],J=[],z=[],Q=[],G=[];if(Y.script){let Z=/data\.(\w+)\s*=/g,$;while(($=Z.exec(Y.script))!==null)J.push($[1]);let H=/input\.action\s*===?\s*['"](\w+)['"]/g;while(($=H.exec(Y.script))!==null)G.push($[1])}if(Y.template){let Z=/\{\{data\.(\w+)\}\}/g,$;while(($=Z.exec(Y.template))!==null)if(z.push($[1]),!J.includes($[1]))X.push({type:"missing_data",severity:"critical",description:`HTML references data.${$[1]} but server doesn't initialize it`,fix:`Add 'data.${$[1]} = ...;' to server script`})}if(Y.client_script){let Z=/(?:c|$scope)\.(\w+)\s*=\s*function/g,$;while(($=Z.exec(Y.client_script))!==null)Q.push($[1])}return{coherent:X.filter((Z)=>Z.severity==="critical").length===0,issues:X,analysis:{serverData:J,htmlRefs:z,clientMethods:Q,inputActions:G}}}async function pe(Y,X){let J=[],z=/new GlideRecord\(['"](\w+)['"]\)/g,Q=new Set;if(X.script){let G;while((G=z.exec(X.script))!==null)Q.add(G[1])}for(let G of Q)try{if((await Y.get("/api/now/table/sys_db_object",{params:{sysparm_query:`name=${G}`,sysparm_limit:1}})).data.result.length===0)J.push({type:"table",name:G})}catch(Z){J.push({type:"table",name:G,error:"Check failed"})}return{allExist:J.length===0,missing:J}}async function ce(Y){let X=[],J=[];if(Y.script||Y.client_script){let z=(Y.script||"")+(Y.client_script||"");if(/password\s*=\s*['"][^'"]+['"]|api[_-]?key\s*=\s*['"][^'"]+['"]/i.test(z))X.push({issue:"Hardcoded credentials detected",severity:"critical",fix:"Use system properties or encrypted credentials"});if(/\beval\s*\(/g.test(z))X.push({issue:"eval() usage detected",severity:"critical",fix:"Avoid eval() - use safer alternatives"});if(/\.innerHTML\s*=/g.test(z))J.push({issue:"innerHTML usage (XSS risk)",severity:"warning",fix:"Use textContent or sanitize input"})}return{critical:X,warnings:J}}async function de(Y){let X=[];if(Y.script){if(/new GlideRecord\([^)]+\)[^;]*query\(\)/.test(Y.script)&&!/setLimit\(/.test(Y.script))X.push({issue:"Unlimited query detected",severity:"warning",fix:"Add .setLimit(100) before .query()"});if(/getRowCount\(\)/.test(Y.script))X.push({issue:"getRowCount() usage (slow)",severity:"warning",fix:"Use GlideAggregate for counts"})}return{issues:X}}var ox=u4(lx(),1);import ix from"fs";import le from"path";import ie from"os";var OY=process.env.SNOW_ENTERPRISE_URL||"https://enterprise.snow-flow.dev",nx=process.env.SNOW_PORTAL_URL||"https://portal.snow-flow.dev",ax=process.env.SNOW_FLOW_VERSION||"8.30.31";function sx(){let Y=le.join(ie.homedir(),".snow-code","enterprise.json");try{if(ix.existsSync(Y)){let J=ix.readFileSync(Y,"utf-8"),z=JSON.parse(J);if(z.token)return S("[Enterprise Proxy] Using token from ~/.snow-code/enterprise.json (device auth)",{tokenLength:z.token.length,subdomain:z.subdomain||"unknown"}),z.token.trim()}}catch(J){S("[Enterprise Proxy] Could not read enterprise.json, falling back to env var",{error:J instanceof Error?J.message:String(J)})}let X=process.env.SNOW_LICENSE_KEY||process.env.SNOW_ENTERPRISE_LICENSE_KEY;if(X)return S("[Enterprise Proxy] Using token from SNOW_LICENSE_KEY environment variable",{tokenLength:X.length}),X.trim();return}var R7;try{R7=ox.machineIdSync()}catch{R7=`fallback-${Date.now()}-${Math.random().toString(36).substring(7)}`}var r4=null,t8=0;function ne(Y){if(!Y.startsWith("eyJ"))return!1;return Y.split(".").length===3}async function oe(){let Y=sx();if(r4&&Y&&r4!==Y)S("[Enterprise Proxy] Token in enterprise.json has changed, invalidating cache"),r4=null,t8=0;let X=Date.now();if(r4&&t8>X+300000)return S("[Enterprise Proxy] Using cached JWT token",{expiresIn:Math.floor((t8-X)/1000/60)+" minutes"}),r4;if(!Y)throw Error("SNOW_LICENSE_KEY or SNOW_ENTERPRISE_LICENSE_KEY not configured. Run: snow-flow auth login");if(ne(Y))return S("[Enterprise Proxy] Using JWT token directly from enterprise.json (device auth mode)",{tokenLength:Y.length,tokenPreview:Y.substring(0,20)+"..."}),r4=Y,t8=X+518400000,Y;S("[Enterprise Proxy] Exchanging license key for JWT token",{licenseKeyLength:Y.length,licenseKeyPreview:Y.substring(0,20)+"...",portalUrl:nx,enterpriseUrl:OY});try{let J=await Y4.post(`${nx}/api/auth/mcp/login`,{licenseKey:Y,machineId:R7,role:"developer"},{headers:{"Content-Type":"application/json","X-Instance-ID":R7,"X-Snow-Flow-Version":ax},timeout:1e4});if(!J.data.success||!J.data.token)throw Error("Failed to obtain JWT token from enterprise server");let z=J.data.token;return r4=z,t8=X+604800000,S("[Enterprise Proxy] Successfully obtained JWT token",{tokenLength:z.length,customer:J.data.customer?.name,role:J.data.customer?.role}),z}catch(J){if(r4=null,t8=0,Y4.isAxiosError(J)){let z=J;if(S("[Enterprise Proxy] Failed to obtain JWT token",{status:z.response?.status,statusText:z.response?.statusText,responseData:z.response?.data,code:z.code,message:z.message}),z.response?.status===401)throw Error(`License key invalid or expired.

Fix this by running: snow-flow auth login`);if(z.response?.status===429){let Q=z.response?.data;throw Error(`Seat limit reached: ${Q.message||"All seats are currently in use"}

Please wait for an available seat or contact support to purchase additional seats.`)}if(z.code==="ECONNREFUSED")throw Error(`Cannot connect to enterprise server at ${OY}`)}throw Error(`Failed to obtain JWT token: ${J instanceof Error?J.message:String(J)}`)}}async function T8(Y,X){if(!sx())throw Error("SNOW_LICENSE_KEY or SNOW_ENTERPRISE_LICENSE_KEY not configured. Run: snow-flow auth login");let z=await oe(),Q={tool:Y,arguments:X};try{let G=await Y4.post(`${OY}/mcp/tools/call`,Q,{headers:{Authorization:`Bearer ${z}`,"Content-Type":"application/json","X-Instance-ID":R7,"X-Snow-Flow-Version":ax},timeout:120000});if(!G.data.success)throw Error(G.data.error||"Tool execution failed");return G.data.result}catch(G){if(G instanceof Error&&G.message.includes("JWT token"))throw G;if(Y4.isAxiosError(G)){let Z=G;if(Z.response?.status===401)throw r4=null,t8=0,Error("License key invalid or expired. Run: snow-flow auth login");if(Z.response?.status===403)throw Error("Access denied. Please check your enterprise license.");if(Z.response?.status===429){let $=Z.response.headers["retry-after"]||"300";throw Error(`Rate limit exceeded. Try again in ${$} seconds.`)}if(Z.response?.status===404)throw Error(`Tool '${Y}' not found in enterprise catalog.`);if(Z.response?.data){let $=Z.response.data;if($.error)throw Error(`Enterprise server error: ${$.error}`)}if(Z.code==="ECONNREFUSED")throw Error(`Cannot connect to enterprise server at ${OY}`);if(Z.code==="ETIMEDOUT")throw Error("Request to enterprise server timed out. Tool execution may still be in progress.")}throw Error(`Tool execution failed: ${G instanceof Error?G.message:String(G)}`)}}var rx={name:"snow_github_tree",description:`Browse GitHub repository structure via enterprise proxy. Returns metadata only (paths, types, sizes)  no file content in LLM context.

Use this to explore a repo before deploying files with snow_github_deploy.

Requires: Enterprise license with 'github' feature. GitHub PAT is managed server-side.`,category:"development",subcategory:"deployment",use_cases:["github","deployment","browse","repository"],complexity:"beginner",frequency:"medium",permission:"read",allowedRoles:["developer","stakeholder","admin"],inputSchema:{type:"object",properties:{owner:{type:"string",description:'GitHub owner or organization (e.g. "groeimetai")'},repo:{type:"string",description:'Repository name (e.g. "snow-flow")'},path:{type:"string",description:'Subdirectory path to browse (default: root "/")'},branch:{type:"string",description:'Branch name (default: "main")'}},required:["owner","repo"]}};async function tx(Y,X){let{owner:J,repo:z,path:Q,branch:G}=Y;if(!X.enterprise?.features?.includes("github"))return M(`GitHub integration requires an enterprise license with the "github" feature enabled.

Upgrade at https://portal.snow-flow.dev or contact support.`);try{let Z=await T8("github_get_content",{owner:J,repo:z,path:Q||"/",ref:G||"main"}),$=Array.isArray(Z)?Z:[Z],H=0,W=0,K=0,U=$.map((B)=>{let O={path:B.path||B.name,type:B.type,size:B.size||0};if(B.type==="file")W++,H+=B.size||0;else if(B.type==="dir")K++;return O});return N({owner:J,repo:z,path:Q||"/",branch:G||"main",entries:U,summary:{files:W,directories:K,total_size_bytes:H}})}catch(Z){return M(`Failed to browse GitHub repository ${J}/${z}: ${Z.message}`)}}var YF={name:"snow_github_deploy",description:`Deploy files directly from GitHub to ServiceNow  content never passes through LLM context.

Three modes:
1. Single file: source_path  one artifact field
2. Directory  Widget: source_directory auto-maps files (template.htmltemplate, server.jsscript, etc.)
3. Bulk: source_directory + bulk=true  each file becomes a separate artifact

Requires: Enterprise license with 'github' feature. GitHub PAT is managed server-side.

Supported target types: widget, script_include, business_rule, client_script, ui_action, scheduled_job, fix_script, etc.`,category:"development",subcategory:"deployment",use_cases:["github","deployment","pipeline","widgets","scripts"],complexity:"intermediate",frequency:"high",permission:"write",allowedRoles:["developer","admin"],inputSchema:{type:"object",properties:{owner:{type:"string",description:"GitHub owner or organization"},repo:{type:"string",description:"Repository name"},branch:{type:"string",description:'Branch name (default: "main")'},source_path:{type:"string",description:'[Mode 1] Path to a single file in the repo (e.g. "scripts/MyScript.js")'},source_directory:{type:"string",description:'[Mode 2/3] Path to a directory in the repo (e.g. "widgets/my_widget/")'},target_type:{type:"string",description:"ServiceNow artifact type",enum:["sp_widget","widget","sp_page","page","sys_ux_page","uib_page","script_include","business_rule","client_script","ui_policy","ui_action","rest_message","scheduled_job","transform_map","fix_script","flow","application"]},target_identifier:{type:"string",description:"[Mode 1/2] Name or ID of the target artifact in ServiceNow"},target_sys_id:{type:"string",description:"Alternative: sys_id of the target artifact"},target_field:{type:"string",description:'[Mode 1] Which field to update (auto-detected if omitted, e.g. "script", "template")'},upsert:{type:"boolean",description:"Create artifact if it does not exist (default: true)"},bulk:{type:"boolean",description:"[Mode 3] Deploy each file in directory as a separate artifact (default: false)"},file_extension_filter:{type:"string",description:'[Mode 3] Filter files by extension in bulk mode (e.g. ".js")'},field_mapping:{type:"object",description:'[Mode 2] Custom filenamefield mapping override (e.g. {"my-template.html": "template"})'},dry_run:{type:"boolean",description:"Preview what would be deployed without actually deploying (default: false)"}},required:["owner","repo","target_type"]}};async function XF(Y,X){let{owner:J,repo:z,branch:Q="main",source_path:G,source_directory:Z,target_type:$,target_identifier:H,target_sys_id:W,target_field:K,upsert:U=!0,bulk:B=!1,file_extension_filter:O,field_mapping:V,dry_run:L=!1}=Y;if(!X.enterprise?.features?.includes("github"))return M(`GitHub integration requires an enterprise license with the "github" feature enabled.

Upgrade at https://portal.snow-flow.dev or contact support.`);let q=o6[$];if(!q)return M(`Unsupported target_type: ${$}. Valid types: ${Object.keys(o6).join(", ")}`);if(G)return await ae(Y,X,q);else if(Z&&B)return await re(Y,X,q);else if(Z)return await se(Y,X,q);else return M("Provide either source_path (single file) or source_directory (directory/bulk mode).")}async function ae(Y,X,J){let{owner:z,repo:Q,branch:G="main",source_path:Z,target_type:$,target_identifier:H,target_sys_id:W,target_field:K,upsert:U=!0,dry_run:B=!1}=Y;if(!H&&!W)return M("target_identifier or target_sys_id is required for single-file mode.");let O;try{let F=await T8("github_get_content",{owner:z,repo:Q,path:Z,ref:G});if(F.content&&F.encoding==="base64")O=Buffer.from(F.content,"base64").toString("utf-8");else if(typeof F.content==="string")O=F.content;else if(typeof F==="string")O=F;else return M(`Unexpected response format from GitHub for ${Z}. Expected file content.`)}catch(F){return M(`Failed to fetch ${Z} from ${z}/${Q}: ${F.message}`)}let V=K||te(Z,J);if(!V)return M(`Cannot auto-detect target field for "${Z}" on ${$}. Specify target_field explicitly.`);if(B)return N({mode:"single_file",dry_run:!0,source:{owner:z,repo:Q,branch:G,path:Z,size:O.length},target:{type:$,table:J,identifier:H||W,field:V},message:"Dry run  no changes made."});let L=await x(X),q=await _Q(L,X,J,$,W,H,{[V]:O},U);return N({mode:"single_file",deployed:!0,source:{owner:z,repo:Q,branch:G,path:Z,size:O.length},target:{type:$,table:J,sys_id:q.sys_id,name:q.name,field:V,action:q.action},url:`${X.instanceUrl}/nav_to.do?uri=${J}.do?sys_id=${q.sys_id}`})}async function se(Y,X,J){let{owner:z,repo:Q,branch:G="main",source_directory:Z,target_type:$,target_identifier:H,target_sys_id:W,field_mapping:K,upsert:U=!0,dry_run:B=!1}=Y;if(!H&&!W)return M("target_identifier or target_sys_id is required for directory mode.");let O;try{let w=await T8("github_get_content",{owner:z,repo:Q,path:Z,ref:G});O=Array.isArray(w)?w:[]}catch(w){return M(`Failed to list ${Z} in ${z}/${Q}: ${w.message}`)}let V=k7[J]||{},L={};for(let w of O){if(w.type!=="file")continue;let v=w.name||w.path?.split("/").pop();if(!v)continue;if(K&&K[v]){L[v]=K[v];continue}for(let[T,D]of Object.entries(V))if(D.includes(v)){L[v]=T;break}}if(Object.keys(L).length===0)return M(`No files in ${Z} matched field mappings for ${$}. Expected files: ${JSON.stringify(V)}. Found: ${O.filter((w)=>w.type==="file").map((w)=>w.name).join(", ")}`);if(B)return N({mode:"directory",dry_run:!0,source:{owner:z,repo:Q,branch:G,directory:Z},mapping:L,target:{type:$,table:J,identifier:H||W},message:"Dry run  no changes made."});let q={},F=[];for(let[w,v]of Object.entries(L)){let T=Z.replace(/\/$/,"")+"/"+w;try{let D=await T8("github_get_content",{owner:z,repo:Q,path:T,ref:G}),j;if(D.content&&D.encoding==="base64")j=Buffer.from(D.content,"base64").toString("utf-8");else if(typeof D.content==="string")j=D.content;else if(typeof D==="string")j=D;else continue;q[v]=j,F.push(`${w}  ${v} (${j.length} chars)`)}catch(D){F.push(`${w}  ${v} (FAILED: ${D.message})`)}}if(Object.keys(q).length===0)return M("Failed to fetch any matched files from GitHub.");let P=await x(X),A=await _Q(P,X,J,$,W,H,q,U);return N({mode:"directory",deployed:!0,source:{owner:z,repo:Q,branch:G,directory:Z},files:F,fields_updated:Object.keys(q),target:{type:$,table:J,sys_id:A.sys_id,name:A.name,action:A.action},url:`${X.instanceUrl}/nav_to.do?uri=${J}.do?sys_id=${A.sys_id}`})}async function re(Y,X,J){let{owner:z,repo:Q,branch:G="main",source_directory:Z,target_type:$,file_extension_filter:H,upsert:W=!0,dry_run:K=!1}=Y,U=H||Dx[J]||".js",B;try{let A=await T8("github_get_content",{owner:z,repo:Q,path:Z,ref:G});B=Array.isArray(A)?A:[]}catch(A){return M(`Failed to list ${Z} in ${z}/${Q}: ${A.message}`)}let O=B.filter((A)=>{if(A.type!=="file")return!1;return(A.name||A.path?.split("/").pop()||"").endsWith(U)});if(O.length===0)return M(`No files matching "${U}" found in ${Z}. Found: ${B.filter((A)=>A.type==="file").map((A)=>A.name).join(", ")||"(empty)"}`);if(K)return N({mode:"bulk",dry_run:!0,source:{owner:z,repo:Q,branch:G,directory:Z},files:O.map((A)=>({filename:A.name,artifact_name:ex(A.name),size:A.size})),filter:U,target:{type:$,table:J},message:`Dry run  would deploy ${O.length} files.`});let V=await x(X),L=[],q=0,F=0,P=JF(J);for(let A of O){let w=A.name||A.path?.split("/").pop(),v=ex(w),T=Z.replace(/\/$/,"")+"/"+w;try{let D=await T8("github_get_content",{owner:z,repo:Q,path:T,ref:G}),j;if(D.content&&D.encoding==="base64")j=Buffer.from(D.content,"base64").toString("utf-8");else if(typeof D.content==="string")j=D.content;else if(typeof D==="string")j=D;else{L.push({filename:w,artifact_name:v,success:!1,error:"Unexpected response format"}),F++;continue}let E=await _Q(V,X,J,$,void 0,v,{[P]:j,name:v},W);L.push({filename:w,artifact_name:v,success:!0,sys_id:E.sys_id,action:E.action,size:j.length}),q++}catch(D){L.push({filename:w,artifact_name:v,success:!1,error:D.message}),F++}}return N({mode:"bulk",deployed:!0,source:{owner:z,repo:Q,branch:G,directory:Z,filter:U},target:{type:$,table:J},summary:{total:O.length,success:q,failed:F},results:L})}function te(Y,X){let J=Y.split(".").pop()?.toLowerCase(),z=Y.split("/").pop()?.toLowerCase()||"",Q=k7[X];if(Q){for(let[G,Z]of Object.entries(Q))if(Z.some(($)=>z===$||z.endsWith($)))return G}if(J==="html")return"template";if(J==="css")return"css";if(J==="json"&&z.includes("option"))return"option_schema";if(J==="js")return JF(X);return null}function JF(Y){if(Y==="sp_widget")return"script";return"script"}function ex(Y){let X=Y.lastIndexOf(".");return X>0?Y.substring(0,X):Y}async function _Q(Y,X,J,z,Q,G,Z,$){let H=r8[J]||"name",W=null;if(Q)try{W=(await Y.get(`/api/now/table/${J}/${Q}`,{params:{sysparm_fields:"sys_id,name,id"}})).data.result}catch(O){}if(!W&&G){let O=[`${H}=${G}`];if(J==="sp_widget")O.push(`id=${G}`);O.push(`name=${G}`);try{let V=await Y.get(`/api/now/table/${J}`,{params:{sysparm_query:O.join("^OR"),sysparm_fields:"sys_id,name,id",sysparm_limit:1}});if(V.data.result&&V.data.result.length>0)W=V.data.result[0]}catch(V){}}if(W){let O=await Y.patch(`/api/now/table/${J}/${W.sys_id}`,Z);return{sys_id:W.sys_id,name:O.data.result?.name||W.name||W.id||G||"",action:"updated"}}if(!$)throw Error(`Artifact '${G||Q}' not found and upsert=false.`);let K={...Z};if(G)if(H==="id"){if(K.id=G,!K.name)K.name=G}else K[H]=G;let B=(await Y.post(`/api/now/table/${J}`,K)).data.result;return{sys_id:B.sys_id,name:B.name||B.id||G||"",action:"created"}}var RQ={};G0(RQ,{snow_update_ci_exec:()=>ZF,snow_update_ci_def:()=>GF,snow_search_cmdb_exec:()=>TF,snow_search_cmdb_def:()=>wF,snow_run_discovery_exec:()=>BF,snow_run_discovery_def:()=>UF,snow_reconcile_ci_exec:()=>LF,snow_reconcile_ci_def:()=>MF,snow_impact_analysis_exec:()=>DF,snow_impact_analysis_def:()=>IF,snow_get_event_correlation_exec:()=>CF,snow_get_event_correlation_def:()=>jF,snow_get_ci_relationships_exec:()=>KF,snow_get_ci_relationships_def:()=>WF,snow_get_ci_impact_exec:()=>OF,snow_get_ci_impact_def:()=>VF,snow_get_ci_history_exec:()=>FF,snow_get_ci_history_def:()=>xF,snow_get_ci_details_exec:()=>AF,snow_get_ci_details_def:()=>PF,snow_create_ci_relationship_exec:()=>HF,snow_create_ci_relationship_def:()=>$F,snow_create_ci_exec:()=>QF,snow_create_ci_def:()=>zF,snow_ci_health_check_exec:()=>qF,snow_ci_health_check_def:()=>NF});var zF={name:"snow_create_ci",description:"Create Configuration Item in CMDB",category:"cmdb",subcategory:"crud",use_cases:["cmdb","create","configuration-item"],complexity:"beginner",frequency:"high",permission:"write",allowedRoles:["developer","admin"],inputSchema:{type:"object",properties:{ci_class:{type:"string",description:"CI class (cmdb_ci_server, cmdb_ci_app, etc.)"},name:{type:"string",description:"CI name"},attributes:{type:"object",description:"CI attributes"},operational_status:{type:"string",description:"Operational status"},asset_tag:{type:"string",description:"Asset tag"}},required:["ci_class","name"]}};async function QF(Y,X){let{ci_class:J,name:z,attributes:Q={},operational_status:G,asset_tag:Z}=Y;try{let $=await x(X),H={name:z,...Q};if(G)H.operational_status=G;if(Z)H.asset_tag=Z;let W=await $.post(`/api/now/table/${J}`,H);return N({created:!0,ci:W.data.result})}catch($){return M($.message)}}var GF={name:"snow_update_ci",description:"Update Configuration Item attributes",category:"cmdb",subcategory:"crud",use_cases:["cmdb","update","configuration-item"],complexity:"beginner",frequency:"high",permission:"write",allowedRoles:["developer","admin"],inputSchema:{type:"object",properties:{sys_id:{type:"string",description:"CI sys_id"},ci_class:{type:"string",description:"CI class table"},attributes:{type:"object",description:"Attributes to update"}},required:["sys_id","ci_class","attributes"]}};async function ZF(Y,X){let{sys_id:J,ci_class:z,attributes:Q}=Y;try{let Z=await(await x(X)).put(`/api/now/table/${z}/${J}`,Q);return N({updated:!0,ci:Z.data.result})}catch(G){return M(G.message)}}var $F={name:"snow_create_ci_relationship",description:"Create relationship between Configuration Items",category:"cmdb",subcategory:"relationships",use_cases:["cmdb","relationships","dependencies"],complexity:"intermediate",frequency:"medium",permission:"write",allowedRoles:["developer","admin"],inputSchema:{type:"object",properties:{parent_ci:{type:"string",description:"Parent CI sys_id"},child_ci:{type:"string",description:"Child CI sys_id"},relationship_type:{type:"string",description:"Relationship type sys_id"}},required:["parent_ci","child_ci","relationship_type"]}};async function HF(Y,X){let{parent_ci:J,child_ci:z,relationship_type:Q}=Y;try{let G=await x(X),Z={parent:J,child:z,type:Q},$=await G.post("/api/now/table/cmdb_rel_ci",Z);return N({created:!0,relationship:$.data.result})}catch(G){return M(G.message)}}var WF={name:"snow_get_ci_relationships",description:"Get all relationships for a Configuration Item",category:"cmdb",subcategory:"relationships",use_cases:["cmdb","relationships","mapping"],complexity:"beginner",frequency:"high",permission:"read",allowedRoles:["developer","stakeholder","admin"],inputSchema:{type:"object",properties:{ci_sys_id:{type:"string",description:"CI sys_id"},depth:{type:"number",description:"Relationship depth",default:1}},required:["ci_sys_id"]}};async function KF(Y,X){let{ci_sys_id:J,depth:z=1}=Y;try{let G=await(await x(X)).get("/api/now/table/cmdb_rel_ci",{params:{sysparm_query:`parent=${J}^ORchild=${J}`,sysparm_display_value:"all",sysparm_limit:1000}});return N({relationships:G.data.result,depth:z})}catch(Q){return M(Q.message)}}var UF={name:"snow_run_discovery",description:"Trigger CMDB discovery scan",category:"cmdb",subcategory:"discovery",use_cases:["cmdb","discovery","scanning"],complexity:"intermediate",frequency:"medium",permission:"read",allowedRoles:["developer","stakeholder","admin"],inputSchema:{type:"object",properties:{discovery_schedule:{type:"string",description:"Discovery schedule sys_id"},target_ip:{type:"string",description:"Target IP or range"},mid_server:{type:"string",description:"MID Server to use"}},required:["discovery_schedule"]}};async function BF(Y,X){let{discovery_schedule:J,target_ip:z,mid_server:Q}=Y;try{let G=await x(X),Z={schedule:J};if(z)Z.ip_address=z;if(Q)Z.mid_server=Q;let $=await G.post("/api/now/table/discovery_schedule_item",Z);return N({triggered:!0,discovery:$.data.result})}catch(G){return M(G.message)}}var VF={name:"snow_get_ci_impact",description:"Calculate impact analysis for CI outage",category:"cmdb",subcategory:"impact-analysis",use_cases:["cmdb","impact","analysis"],complexity:"intermediate",frequency:"medium",permission:"read",allowedRoles:["developer","stakeholder","admin"],inputSchema:{type:"object",properties:{ci_sys_id:{type:"string",description:"CI sys_id"},include_services:{type:"boolean",description:"Include business services",default:!0}},required:["ci_sys_id"]}};async function OF(Y,X){let{ci_sys_id:J,include_services:z=!0}=Y;try{let Z=(await(await x(X)).get("/api/now/table/cmdb_rel_ci",{params:{sysparm_query:`child=${J}`,sysparm_limit:100}})).data.result;return N({ci_sys_id:J,impacted_count:Z.length,impacted_cis:Z})}catch(Q){return M(Q.message)}}var MF={name:"snow_reconcile_ci",description:"Reconcile CI data from multiple sources",category:"cmdb",subcategory:"reconciliation",use_cases:["cmdb","reconciliation","data-quality"],complexity:"advanced",frequency:"low",permission:"write",allowedRoles:["developer","admin"],inputSchema:{type:"object",properties:{ci_sys_id:{type:"string",description:"CI to reconcile"},source_data:{type:"object",description:"Source data to reconcile"},reconciliation_rule:{type:"string",description:"Reconciliation rule",default:"merge"}},required:["ci_sys_id","source_data"]}};async function LF(Y,X){let{ci_sys_id:J,source_data:z,reconciliation_rule:Q="merge"}=Y;try{let Z=await(await x(X)).put(`/api/now/table/cmdb_ci/${J}`,z);return N({reconciled:!0,ci:Z.data.result,rule:Q})}catch(G){return M(G.message)}}var NF={name:"snow_ci_health_check",description:"Check CI health and compliance status",category:"cmdb",subcategory:"monitoring",use_cases:["cmdb","monitoring","health"],complexity:"beginner",frequency:"medium",permission:"read",allowedRoles:["developer","stakeholder","admin"],inputSchema:{type:"object",properties:{ci_sys_id:{type:"string"},include_metrics:{type:"boolean",default:!0}},required:["ci_sys_id"]}};async function qF(Y,X){let{ci_sys_id:J,include_metrics:z=!0}=Y;try{let Z=(await(await x(X)).get(`/api/now/table/cmdb_ci/${J}`)).data.result,$={operational_status:Z.operational_status,install_status:Z.install_status,support_group:Z.support_group,last_discovered:Z.last_discovered,health_score:ee(Z)};return N({ci_sys_id:J,health:$,ci_name:Z.name})}catch(Q){return M(Q.message)}}function ee(Y){let X=100;if(Y.operational_status!="1")X-=30;if(!Y.last_discovered)X-=20;return Math.max(0,X)}var xF={name:"snow_get_ci_history",description:"Get Configuration Item change history",category:"cmdb",subcategory:"audit",use_cases:["cmdb","audit","history"],complexity:"beginner",frequency:"medium",permission:"read",allowedRoles:["developer","stakeholder","admin"],inputSchema:{type:"object",properties:{ci_sys_id:{type:"string"},days_back:{type:"number",default:30}},required:["ci_sys_id"]}};async function FF(Y,X){let{ci_sys_id:J,days_back:z=30}=Y;try{let G=await(await x(X)).get("/api/now/table/sys_audit",{params:{sysparm_query:`documentkey=${J}^sys_created_on>=javascript:gs.daysAgo(${z})`,sysparm_limit:1000}});return N({history:G.data.result,days_back:z})}catch(Q){return M(Q.message)}}var PF={name:"snow_get_ci_details",description:"Retrieve Configuration Item details including relationships and history",category:"cmdb",subcategory:"query",use_cases:["cmdb","query","details"],complexity:"beginner",frequency:"high",permission:"read",allowedRoles:["developer","stakeholder","admin"],inputSchema:{type:"object",properties:{ci_id:{type:"string",description:"CI sys_id or name"},include_relationships:{type:"boolean",description:"Include CI relationships",default:!0},include_history:{type:"boolean",description:"Include change history",default:!1}},required:["ci_id"]}};async function AF(Y,X){let{ci_id:J,include_relationships:z=!0,include_history:Q=!1}=Y;try{let G=await x(X),Z=J.match(/^[a-f0-9]{32}$/)?`sys_id=${J}`:`name=${J}`,$=await G.get(`/api/now/table/cmdb_ci?sysparm_query=${Z}&sysparm_limit=1`);if(!$.data.result||$.data.result.length===0)return M("CI not found");let H=$.data.result[0],W={ci:H};if(z){let K=`parent=${H.sys_id}^ORchild=${H.sys_id}`,U=await G.get(`/api/now/table/cmdb_rel_ci?sysparm_query=${K}&sysparm_limit=50`);W.relationships=U.data.result||[]}if(Q){let K=await G.get(`/api/now/table/sys_audit?sysparm_query=tablename=cmdb_ci^documentkey=${H.sys_id}&sysparm_limit=20&sysparm_order_by=^ORDERBYDESCsys_created_on`);W.history=K.data.result||[]}return N(W)}catch(G){return M(G.message)}}var wF={name:"snow_search_cmdb",description:"Search the CMDB for Configuration Items with various filters",category:"cmdb",subcategory:"query",use_cases:["cmdb","search","query"],complexity:"beginner",frequency:"high",permission:"read",allowedRoles:["developer","stakeholder","admin"],inputSchema:{type:"object",properties:{query:{type:"string",description:"Search query for CI name"},ci_class:{type:"string",description:"Filter by CI class"},operational_status:{type:"string",description:"Filter by operational status"},location:{type:"string",description:"Filter by location"},limit:{type:"number",description:"Maximum results to return",default:50}}}};async function TF(Y,X){let{query:J,ci_class:z,operational_status:Q,location:G,limit:Z=50}=Y;try{let $=await x(X),H=[];if(J)H.push(`nameLIKE${J}`);if(z)H.push(`sys_class_name=${z}`);if(Q)H.push(`operational_status=${Q}`);if(G)H.push(`location=${G}`);let W=H.join("^"),K=`/api/now/table/cmdb_ci?sysparm_query=${W}&sysparm_limit=${Z}`,B=(await $.get(K)).data.result||[];return N({total:B.length,cis:B,query:W})}catch($){return M($.message)}}var IF={name:"snow_impact_analysis",description:"Perform impact analysis to identify affected services when a CI changes",category:"cmdb",subcategory:"impact-analysis",use_cases:["cmdb","impact","services"],complexity:"advanced",frequency:"high",permission:"read",allowedRoles:["developer","stakeholder","admin"],inputSchema:{type:"object",properties:{ci_id:{type:"string",description:"CI sys_id to analyze"},depth:{type:"number",description:"Relationship depth to analyze",default:3},include_services:{type:"boolean",description:"Include business services",default:!0}},required:["ci_id"]}};async function vF(Y,X,J,z=new Set){if(J<=0||z.has(X))return[];z.add(X);let Q=[];try{let G=`parent=${X}^ORchild=${X}`,$=(await Y.get(`/api/now/table/cmdb_rel_ci?sysparm_query=${G}&sysparm_limit=100`)).data.result||[];for(let H of $){let W=H.parent===X?H.child:H.parent;if(!z.has(W.value||W)){let K={sys_id:W.value||W,relationship_type:H.type?.display_value||H.type,depth:4-J};if(Q.push(K),J>1){let U=await vF(Y,W.value||W,J-1,z);Q.push(...U)}}}}catch(G){console.error("Error getting related CIs:",G)}return Q}async function DF(Y,X){let{ci_id:J,depth:z=3,include_services:Q=!0}=Y;try{let G=await x(X),$=(await G.get(`/api/now/table/cmdb_ci/${J}`)).data.result;if(!$)return M("CI not found");let W=await vF(G,J,z,new Set),K=[];if(Q){let L=`cmdb_ci=${J}`;K=(await G.get(`/api/now/table/cmdb_ci_service?sysparm_query=${L}&sysparm_limit=50`)).data.result||[]}let U=W.filter((L)=>L.depth===1).length,B=W.filter((L)=>L.depth>1).length,O=U>10?"High":U>5?"Medium":"Low",V={ci:{sys_id:$.sys_id,name:$.name,class:$.sys_class_name},impact:{directly_affected:U,indirectly_affected:B,total_affected:W.length,risk_level:O,analysis_depth:z},affected_cis:W,business_services:K,recommendations:[O==="High"?"Schedule maintenance window during off-hours":"Standard change approval process","Notify affected service owners","Prepare rollback plan","Monitor related CIs after change"]};return N(V)}catch(G){return M(G.message)}}var jF={name:"snow_get_event_correlation",description:"Get event correlation results showing how events are grouped into alerts",category:"cmdb",subcategory:"event-management",use_cases:["cmdb","events","correlation"],complexity:"advanced",frequency:"medium",permission:"read",allowedRoles:["developer","stakeholder","admin"],inputSchema:{type:"object",properties:{alert_id:{type:"string",description:"Alert sys_id to analyze"},time_range:{type:"string",description:'Time range to check (e.g., "24 hours", "7 days")'},include_suppressed:{type:"boolean",description:"Include suppressed events",default:!1}}}};async function CF(Y,X){let{alert_id:J,time_range:z,include_suppressed:Q=!1}=Y;try{let G=await x(X),Z={};if(J){let H=(await G.get(`/api/now/table/em_alert/${J}`)).data.result;if(!H)return M("Alert not found");let W=`alert=${J}${Q?"":"^suppressed=false"}`,U=(await G.get(`/api/now/table/em_event?sysparm_query=${W}&sysparm_limit=100`)).data.result||[];Z={alert:{sys_id:H.sys_id,number:H.number,severity:H.severity,state:H.state,description:H.description},correlated_events:U.length,suppressed_events:U.filter((B)=>B.suppressed==="true").length,events:U.map((B)=>({sys_id:B.sys_id,number:B.number,type:B.type,severity:B.severity,node:B.node?.display_value||B.node,time_of_event:B.time_of_event,suppressed:B.suppressed==="true"}))}}else{let $="state=Active";if(z){let B=z.match(/(\d+)\s*hours?/i),O=z.match(/(\d+)\s*days?/i);if(B){let V=parseInt(B[1]);$+=`^sys_created_on>javascript:gs.hoursAgo(${V})`}else if(O){let V=parseInt(O[1]);$+=`^sys_created_on>javascript:gs.daysAgo(${V})`}}let W=(await G.get(`/api/now/table/em_alert?sysparm_query=${$}&sysparm_limit=50`)).data.result||[],U=(await G.get("/api/now/table/em_alert_rule?sysparm_query=active=true&sysparm_limit=50")).data.result||[];Z={summary:{active_alerts:W.length,time_range:z||"All time",correlation_rules_active:U.length},alerts:W.map((B)=>({sys_id:B.sys_id,number:B.number,severity:B.severity,description:B.description,event_count:B.event_count||0})),correlation_rules:U.map((B)=>({name:B.name,condition:B.condition,active:B.active==="true"}))}}return N(Z)}catch(G){return M(G.message)}}var fQ={};G0(fQ,{snow_knowledge_article_manage_exec:()=>_F,snow_knowledge_article_manage_def:()=>kF,snow_discover_knowledge_bases_exec:()=>yF,snow_discover_knowledge_bases_def:()=>fF,snow_create_knowledge_base_exec:()=>RF,snow_create_knowledge_base_def:()=>bF,snow_create_catalog_item_exec:()=>SF,snow_create_catalog_item_def:()=>EF});var EF={name:"snow_create_catalog_item",description:"Create service catalog item",category:"itsm",subcategory:"service-catalog",use_cases:["catalog","create","service-catalog"],complexity:"intermediate",frequency:"medium",permission:"write",allowedRoles:["developer","admin"],inputSchema:{type:"object",properties:{name:{type:"string"},short_description:{type:"string"},description:{type:"string"},category:{type:"string"},price:{type:"string"}},required:["name"]}};async function SF(Y,X){let{name:J,short_description:z,description:Q,category:G,price:Z}=Y;try{let $=await x(X),H={name:J,short_description:z,description:Q};if(G)H.category=G;if(Z)H.price=Z;let W=await $.post("/api/now/table/sc_cat_item",H);return N({created:!0,catalog_item:W.data.result})}catch($){return M($.message)}}var kF={name:"snow_knowledge_article_manage",description:"Unified knowledge article management (create, update, get, publish, retire, search)",category:"itsm",subcategory:"knowledge",use_cases:["knowledge","articles","kb"],complexity:"intermediate",frequency:"medium",permission:"write",allowedRoles:["developer","admin"],inputSchema:{type:"object",properties:{action:{type:"string",description:"Knowledge article action to perform",enum:["create","update","get","publish","retire","search"]},short_description:{type:"string",description:"[create/update] Article title"},text:{type:"string",description:"[create/update] Article content (HTML supported)"},kb_knowledge_base:{type:"string",description:"[create/search] Knowledge base sys_id or name"},kb_category:{type:"string",description:"[create/search] Category sys_id or name"},article_type:{type:"string",description:"[create] Type: text, html, wiki",default:"text"},workflow_state:{type:"string",description:"[create/update/search] State: draft, review, published, retired",default:"draft"},valid_to:{type:"string",description:"[create/update] Expiration date (YYYY-MM-DD)"},meta_description:{type:"string",description:"[create/update] SEO meta description"},keywords:{type:"array",items:{type:"string"},description:"[create/update] Search keywords"},author:{type:"string",description:"[create] Author user sys_id or username"},sys_id:{type:"string",description:"[get/update/retire] Article sys_id"},article_sys_id:{type:"string",description:"[publish] Article sys_id (alias for sys_id)"},include_attachments:{type:"boolean",description:"[get] Include attachment information",default:!1},retirement_reason:{type:"string",description:"[retire] Reason for retirement"},replacement_article:{type:"string",description:"[retire] Replacement article sys_id"},query:{type:"string",description:"[search] Search query text"},limit:{type:"number",description:"[search] Maximum results to return",default:10},include_content:{type:"boolean",description:"[search] Include full article content",default:!1}},required:["action"]}};async function _F(Y,X){let{action:J}=Y;try{switch(J){case"create":return await Y00(Y,X);case"update":return await X00(Y,X);case"get":return await J00(Y,X);case"publish":return await z00(Y,X);case"retire":return await Q00(Y,X);case"search":return await G00(Y,X);default:return M(`Unknown action: ${J}`)}}catch(z){return M(z.message)}}async function Y00(Y,X){let{short_description:J,text:z,kb_knowledge_base:Q,kb_category:G,article_type:Z="text",workflow_state:$="draft",valid_to:H,meta_description:W,keywords:K,author:U}=Y;if(!J)return M("short_description is required for create action");if(!z)return M("text is required for create action");let B=await x(X),O={short_description:J,text:z,article_type:Z,workflow_state:$};if(Q)O.kb_knowledge_base=Q;if(G)O.kb_category=G;if(H)O.valid_to=H;if(W)O.meta_description=W;if(K)O.keywords=K.join(",");if(U)O.author=U;let V=await B.post("/api/now/table/kb_knowledge",O);return N({action:"create",created:!0,article:V.data.result,sys_id:V.data.result.sys_id,number:V.data.result.number},{operation:"create_knowledge_article",title:J,state:$})}async function X00(Y,X){let{sys_id:J,short_description:z,text:Q,workflow_state:G,valid_to:Z,meta_description:$,keywords:H}=Y;if(!J)return M("sys_id is required for update action");let W=await x(X),K={};if(z)K.short_description=z;if(Q)K.text=Q;if(G)K.workflow_state=G;if(Z)K.valid_to=Z;if($)K.meta_description=$;if(H)K.keywords=H.join(",");if(Object.keys(K).length===0)return M("No fields to update provided");let U=await W.patch(`/api/now/table/kb_knowledge/${J}`,K);return N({action:"update",updated:!0,article:U.data.result,sys_id:J,fields_updated:Object.keys(K)},{operation:"update_article",fields_updated:Object.keys(K)})}async function J00(Y,X){let{sys_id:J,include_attachments:z=!1}=Y;if(!J)return M("sys_id is required for get action");let Q=await x(X),Z=(await Q.get(`/api/now/table/kb_knowledge/${J}`)).data.result,$=[];if(z)$=(await Q.get("/api/now/table/sys_attachment",{params:{sysparm_query:`table_name=kb_knowledge^table_sys_id=${J}`,sysparm_limit:50}})).data.result;return N({action:"get",article:Z,attachments:z?$:void 0,attachment_count:$.length},{operation:"get_article_details",article_id:J})}async function z00(Y,X){let{sys_id:J,article_sys_id:z}=Y,Q=J||z;if(!Q)return M("sys_id or article_sys_id is required for publish action");let Z=await(await x(X)).put(`/api/now/table/kb_knowledge/${Q}`,{workflow_state:"published"});return N({action:"publish",published:!0,article:Z.data.result,sys_id:Q})}async function Q00(Y,X){let{sys_id:J,retirement_reason:z,replacement_article:Q}=Y;if(!J)return M("sys_id is required for retire action");let G=await x(X),Z={workflow_state:"retired",retirement_date:new Date().toISOString()};if(z)Z.retirement_reason=z;if(Q)Z.replacement_article=Q;let $=await G.patch(`/api/now/table/kb_knowledge/${J}`,Z);return N({action:"retire",retired:!0,article:$.data.result,sys_id:J},{operation:"retire_article",reason:z})}async function G00(Y,X){let{query:J,kb_knowledge_base:z,kb_category:Q,workflow_state:G="published",limit:Z=10,include_content:$=!1}=Y;if(!J)return M("query is required for search action");let H=await x(X),W=`short_descriptionLIKE${J}^ORtextLIKE${J}`;if(z)W+=`^kb_knowledge_base=${z}`;if(Q)W+=`^kb_category=${Q}`;if(G)W+=`^workflow_state=${G}`;let U=(await H.get("/api/now/table/kb_knowledge",{params:{sysparm_query:W,sysparm_limit:Z}})).data.result;return N({action:"search",articles:U,count:U.length,query_used:W},{operation:"search_knowledge",query:J,results:U.length})}var bF={name:"snow_create_knowledge_base",description:"Creates a new knowledge base for organizing articles by topic, department, or audience.",category:"itsm",subcategory:"knowledge",use_cases:["knowledge","create","knowledge-base"],complexity:"intermediate",frequency:"low",permission:"write",allowedRoles:["developer","admin"],inputSchema:{type:"object",properties:{title:{type:"string",description:"Knowledge base title"},description:{type:"string",description:"Knowledge base description"},owner:{type:"string",description:"Owner user or group"},managers:{type:"array",items:{type:"string"},description:"Manager users or groups"},kb_version:{type:"string",description:"Version number"},active:{type:"boolean",description:"Active status",default:!0}},required:["title"]}};async function RF(Y,X){let{title:J,description:z,owner:Q,managers:G,kb_version:Z="1.0",active:$=!0}=Y;try{let H=await x(X),W={title:J,kb_version:Z,active:$};if(z)W.description=z;if(Q)W.owner=Q;if(G)W.managers=G.join(",");let K=await H.post("/api/now/table/kb_knowledge_base",W);return N({created:!0,knowledge_base:K.data.result,sys_id:K.data.result.sys_id},{operation:"create_knowledge_base",title:J,version:Z})}catch(H){return M(H.message)}}var fF={name:"snow_discover_knowledge_bases",description:"Discovers available knowledge bases and their categories in the ServiceNow instance.",category:"itsm",subcategory:"knowledge",use_cases:["knowledge","discovery","query"],complexity:"beginner",frequency:"medium",permission:"read",allowedRoles:["developer","stakeholder","admin"],inputSchema:{type:"object",properties:{active_only:{type:"boolean",description:"Show only active knowledge bases",default:!0}}}};async function yF(Y,X){let{active_only:J=!0}=Y;try{let z=await x(X),Q=J?"active=true":"",Z=(await z.get("/api/now/table/kb_knowledge_base",{params:{sysparm_query:Q,sysparm_limit:50}})).data.result,$=await Promise.all(Z.map(async(H)=>{let W=await z.get("/api/now/table/kb_category",{params:{sysparm_query:`kb_knowledge_base=${H.sys_id}`,sysparm_limit:20}});return{...H,categories:W.data.result}}));return N({knowledge_bases:$,count:$.length},{operation:"discover_knowledge_bases",active_only:J})}catch(z){return M(z.message)}}var yQ={};G0(yQ,{snow_search_catalog_exec:()=>aF,snow_search_catalog_def:()=>oF,snow_order_catalog_item_exec:()=>nF,snow_order_catalog_item_def:()=>iF,snow_get_catalog_item_details_exec:()=>lF,snow_get_catalog_item_details_def:()=>dF,snow_discover_catalogs_exec:()=>cF,snow_discover_catalogs_def:()=>pF,snow_create_catalog_ui_policy_exec:()=>gF,snow_create_catalog_ui_policy_def:()=>uF,snow_create_catalog_client_script_exec:()=>mF,snow_create_catalog_client_script_def:()=>hF});var hF={name:"snow_create_catalog_client_script",description:"Creates client scripts for catalog items to add custom JavaScript behavior to forms.",category:"itsm",subcategory:"service-catalog",use_cases:["catalog","client-scripts","form-behavior"],complexity:"intermediate",frequency:"medium",permission:"write",allowedRoles:["developer","admin"],inputSchema:{type:"object",properties:{cat_item:{type:"string",description:"Catalog item sys_id"},name:{type:"string",description:"Script name"},script:{type:"string",description:"JavaScript code"},type:{type:"string",description:"Type: onLoad, onChange, onSubmit, onCellEdit"},applies_to:{type:"string",description:"Applies to: item, set, variable"},variable:{type:"string",description:"Variable name (for onChange)"},active:{type:"boolean",description:"Active status",default:!0}},required:["cat_item","name","script","type"]}};async function mF(Y,X){let{cat_item:J,name:z,script:Q,type:G,applies_to:Z="item",variable:$,active:H=!0}=Y;try{let W=await x(X),K={cat_item:J,name:z,script:Q,type:G,applies_to:Z,active:H};if($)K.cat_variable=$;let U=await W.post("/api/now/table/catalog_script_client",K);return N({created:!0,client_script:U.data.result,sys_id:U.data.result.sys_id},{operation:"create_catalog_client_script",name:z,type:G})}catch(W){return M(W.message)}}var uF={name:"snow_create_catalog_ui_policy",description:"Creates comprehensive UI policies for catalog items with conditions and actions to control form behavior dynamically.",category:"itsm",subcategory:"service-catalog",use_cases:["catalog","ui-policies","form-control"],complexity:"advanced",frequency:"medium",permission:"write",allowedRoles:["developer","admin"],inputSchema:{type:"object",properties:{cat_item:{type:"string",description:"Catalog item sys_id"},short_description:{type:"string",description:"Policy name"},condition:{type:"string",description:"Legacy condition script (optional if conditions array provided)"},applies_to:{type:"string",description:"Applies to: item, set, or variable"},active:{type:"boolean",description:"Active status",default:!0},on_load:{type:"boolean",description:"Run on form load",default:!0},reverse_if_false:{type:"boolean",description:"Reverse actions if false",default:!0},conditions:{type:"array",description:"Array of condition objects for dynamic policy evaluation",items:{type:"object",properties:{type:{type:"string",description:"Condition type (catalog_variable, javascript)",default:"catalog_variable"},catalog_variable:{type:"string",description:"Target catalog variable sys_id or name"},operation:{type:"string",description:"Comparison operation: is, is_not, is_empty, is_not_empty, contains, does_not_contain",default:"is"},value:{type:"string",description:"Comparison value"},and_or:{type:"string",description:"Logical operator with next condition: AND, OR",default:"AND"}},required:["catalog_variable","operation"]}},actions:{type:"array",description:"Array of action objects to execute when conditions are met",items:{type:"object",properties:{type:{type:"string",description:"Action type: set_mandatory, set_visible, set_readonly, set_value",default:"set_visible"},catalog_variable:{type:"string",description:"Target catalog variable sys_id or name"},mandatory:{type:"boolean",description:"Set field as mandatory (for set_mandatory type)"},visible:{type:"boolean",description:"Set field visibility (for set_visible type)"},readonly:{type:"boolean",description:"Set field as readonly (for set_readonly type)"},value:{type:"string",description:"Value to set (for set_value type)"}},required:["type","catalog_variable"]}}},required:["cat_item","short_description"]}};async function gF(Y,X){let{cat_item:J,short_description:z,condition:Q,applies_to:G="item",active:Z=!0,on_load:$=!0,reverse_if_false:H=!0,conditions:W,actions:K}=Y;try{let U=await x(X),B={catalog_item:J,short_description:z,applies_catalog:!0,active:Z,applies_on:$?"true":"false",reverse_if_false:H};if(Q)B.catalog_conditions=Q;let O=await U.post("/api/now/table/catalog_ui_policy",B),V=O.data.result.sys_id,L=[];if(K&&Array.isArray(K))for(let q of K){let F={ui_policy:V,catalog_item:J,catalog_variable:q.catalog_variable,active:!0};if(q.mandatory!==void 0)F.mandatory=q.mandatory;if(q.visible!==void 0)F.visible=q.visible;if(q.readonly!==void 0)F.disabled=q.readonly;if(q.value!==void 0)F.value=q.value;let P=await U.post("/api/now/table/catalog_ui_policy_action",F);L.push(P.data.result)}return N({created:!0,policy:O.data.result,policy_sys_id:V,actions:L,actions_count:L.length},{operation:"create_catalog_ui_policy",name:z,actions_created:L.length})}catch(U){return M(U.message)}}var pF={name:"snow_discover_catalogs",description:"Discovers available service catalogs and their categories in the ServiceNow instance.",category:"itsm",subcategory:"service-catalog",use_cases:["discovery","catalogs","categories"],complexity:"beginner",frequency:"high",permission:"read",allowedRoles:["developer","stakeholder","admin"],inputSchema:{type:"object",properties:{include_categories:{type:"boolean",description:"Include category tree",default:!0},active_only:{type:"boolean",description:"Show only active catalogs",default:!0}}}};async function cF(Y,X){let{include_categories:J=!0,active_only:z=!0}=Y;try{let Q=await x(X),G=z?"active=true":"",$=(await Q.get("/api/now/table/sc_catalog",{params:{sysparm_query:G,sysparm_limit:50}})).data.result,H=$;if(J)H=await Promise.all($.map(async(W)=>{let K=await Q.get("/api/now/table/sc_category",{params:{sysparm_query:`sc_catalog=${W.sys_id}`,sysparm_limit:20}});return{...W,categories:K.data.result}}));return N({catalogs:H,count:H.length},{operation:"discover_catalogs",active_only:z,include_categories:J})}catch(Q){return M(Q.message)}}var dF={name:"snow_get_catalog_item_details",description:"Gets detailed information about a catalog item including variables, pricing, and availability.",category:"itsm",subcategory:"service-catalog",use_cases:["catalog","retrieval","details"],complexity:"beginner",frequency:"high",permission:"read",allowedRoles:["developer","stakeholder","admin"],inputSchema:{type:"object",properties:{sys_id:{type:"string",description:"Catalog item sys_id"},include_variables:{type:"boolean",description:"Include all variables",default:!0},include_ui_policies:{type:"boolean",description:"Include UI policies",default:!1},include_client_scripts:{type:"boolean",description:"Include client scripts",default:!1}},required:["sys_id"]}};async function lF(Y,X){let{sys_id:J,include_variables:z=!0,include_ui_policies:Q=!1,include_client_scripts:G=!1}=Y;try{let Z=await x(X),H=(await Z.get(`/api/now/table/sc_cat_item/${J}`)).data.result,W=[];if(z)W=(await Z.get("/api/now/table/sc_cat_item_option",{params:{sysparm_query:`cat_item=${J}`,sysparm_limit:50}})).data.result;let K=[];if(Q)K=(await Z.get("/api/now/table/catalog_ui_policy",{params:{sysparm_query:`catalog_item=${J}`,sysparm_limit:50}})).data.result;let U=[];if(G)U=(await Z.get("/api/now/table/catalog_script_client",{params:{sysparm_query:`cat_item=${J}`,sysparm_limit:50}})).data.result;return N({item:H,variables:z?W:void 0,ui_policies:Q?K:void 0,client_scripts:G?U:void 0,variable_count:W.length,ui_policy_count:K.length,client_script_count:U.length},{operation:"get_catalog_item_details",item_id:J})}catch(Z){return M(Z.message)}}var iF={name:"snow_order_catalog_item",description:"Orders a catalog item programmatically, creating a request (RITM) with specified variable values.",category:"itsm",subcategory:"service-catalog",use_cases:["ordering","automation","ritm"],complexity:"intermediate",frequency:"high",permission:"write",allowedRoles:["developer","admin"],inputSchema:{type:"object",properties:{cat_item:{type:"string",description:"Catalog item sys_id"},requested_for:{type:"string",description:"User sys_id or username"},variables:{type:"object",description:"Variable name-value pairs"},quantity:{type:"number",description:"Quantity to order",default:1},delivery_address:{type:"string",description:"Delivery address"},special_instructions:{type:"string",description:"Special instructions"}},required:["cat_item","requested_for"]}};async function nF(Y,X){let{cat_item:J,requested_for:z,variables:Q,quantity:G=1,delivery_address:Z,special_instructions:$}=Y;try{let H=await x(X),W={requested_for:z,opened_by:z};if($)W.special_instructions=$;let U=(await H.post("/api/now/table/sc_request",W)).data.result.sys_id,B={request:U,cat_item:J,requested_for:z,quantity:G};if(Z)B.delivery_address=Z;let O=await H.post("/api/now/table/sc_req_item",B),V=O.data.result.sys_id,L=O.data.result.number;if(Q)for(let[q,F]of Object.entries(Q))await H.post("/api/now/table/sc_item_option_mtom",{request_item:V,name:q,value:F});return N({ordered:!0,request_id:U,ritm_id:V,ritm_number:L,quantity:G},{operation:"order_catalog_item",item:J,requested_for:z})}catch(H){return M(H.message)}}var oF={name:"snow_search_catalog",description:"Searches service catalog for items, categories, or catalogs. Returns available items for ordering.",category:"itsm",subcategory:"service-catalog",use_cases:["search","catalog","discovery"],complexity:"beginner",frequency:"high",permission:"read",allowedRoles:["developer","stakeholder","admin"],inputSchema:{type:"object",properties:{query:{type:"string",description:"Search query"},category:{type:"string",description:"Filter by category"},catalog:{type:"string",description:"Filter by catalog"},active_only:{type:"boolean",description:"Show only active items",default:!0},include_variables:{type:"boolean",description:"Include item variables",default:!1},limit:{type:"number",description:"Maximum results",default:20}}}};async function aF(Y,X){let{query:J,category:z,catalog:Q,active_only:G=!0,include_variables:Z=!1,limit:$=20}=Y;try{let H=await x(X),W="";if(J)W=`nameLIKE${J}^ORshort_descriptionLIKE${J}`;if(z)W+=W?"^":"",W+=`category=${z}`;if(Q)W+=W?"^":"",W+=`sc_catalogs=${Q}`;if(G)W+=W?"^":"",W+="active=true";let U=(await H.get("/api/now/table/sc_cat_item",{params:{sysparm_query:W,sysparm_limit:$}})).data.result,B=U;if(Z)B=await Promise.all(U.map(async(O)=>{let V=await H.get("/api/now/table/sc_cat_item_option",{params:{sysparm_query:`cat_item=${O.sys_id}`,sysparm_limit:50}});return{...O,variables:V.data.result}}));return N({items:B,count:U.length,query_used:W},{operation:"search_catalog",query:J,results:U.length})}catch(H){return M(H.message)}}var hQ={};G0(hQ,{snow_change_query_exec:()=>eF,snow_change_query_def:()=>tF,snow_change_manage_exec:()=>rF,snow_change_manage_def:()=>sF});var sF={name:"snow_change_manage",description:"Unified change management (create, update_state, approve, create_task, schedule_cab)",category:"itsm",subcategory:"change",use_cases:["change-management","itsm","workflow"],complexity:"intermediate",frequency:"high",permission:"write",allowedRoles:["developer","admin"],inputSchema:{type:"object",properties:{action:{type:"string",description:"Change management action",enum:["create","update_state","approve","create_task","schedule_cab"]},short_description:{type:"string",description:"[create/create_task] Short description"},description:{type:"string",description:"[create/create_task] Full description"},type:{type:"string",description:"[create] Change type",enum:["standard","normal","emergency"]},risk:{type:"string",description:"[create] Risk level",enum:["high","medium","low"]},impact:{type:"number",description:"[create] Impact",enum:[1,2,3]},sys_id:{type:"string",description:"[update_state/approve/create_task/schedule_cab] Change sys_id or number"},state:{type:"string",description:"[update_state] New state",enum:["draft","assess","authorize","scheduled","implement","review","closed","cancelled"]},close_notes:{type:"string",description:"[update_state] Closure notes"},close_code:{type:"string",description:"[update_state] Closure code"},approval:{type:"string",description:"[approve] Approval decision",enum:["approved","rejected"]},comments:{type:"string",description:"[approve] Approval comments"},assigned_to:{type:"string",description:"[create_task] Assignee sys_id"},due_date:{type:"string",description:"[create_task] Due date"},cab_date:{type:"string",description:"[schedule_cab] CAB meeting date"},cab_agenda:{type:"string",description:"[schedule_cab] CAB agenda"}},required:["action"]}};async function rF(Y,X){let{action:J}=Y;try{switch(J){case"create":return await Z00(Y,X);case"update_state":return await $00(Y,X);case"approve":return await H00(Y,X);case"create_task":return await W00(Y,X);case"schedule_cab":return await K00(Y,X);default:return M(`Unknown action: ${J}`)}}catch(z){return M(z.message)}}async function Z00(Y,X){let{short_description:J,description:z,type:Q,risk:G,impact:Z}=Y;if(!J)return M("short_description required");if(!Q)return M("type required");let $=await x(X),H={short_description:J,type:Q};if(z)H.description=z;if(G)H.risk=G;if(Z)H.impact=Z;let W=await $.post("/api/now/table/change_request",H);return N({action:"create",created:!0,change:W.data.result})}async function $00(Y,X){let{sys_id:J,state:z,close_notes:Q,close_code:G}=Y;if(!J)return M("sys_id required");if(!z)return M("state required");let Z=await x(X),H={state:{draft:"-5",assess:"-4",authorize:"-3",scheduled:"-2",implement:"-1",review:"0",closed:"3",cancelled:"4"}[z]||z};if(Q)H.close_notes=Q;if(G)H.close_code=G;let W=J.match(/^[a-f0-9]{32}$/)?"sys_id="+J:"number="+J,K=await Z.get("/api/now/table/change_request?sysparm_query="+W);if(!K.data?.result?.[0])return M("Change not found");let U=K.data.result[0].sys_id,B=await Z.patch("/api/now/table/change_request/"+U,H);return N({action:"update_state",updated:!0,change:B.data.result})}async function H00(Y,X){let{sys_id:J,approval:z,comments:Q}=Y;if(!J)return M("sys_id required");if(!z)return M("approval required");let G=await x(X),Z=J.match(/^[a-f0-9]{32}$/)?"sys_id="+J:"number="+J,$=await G.get("/api/now/table/change_request?sysparm_query="+Z);if(!$.data?.result?.[0])return M("Change not found");let W={document_id:$.data.result[0].sys_id,state:z==="approved"?"approved":"rejected",comments:Q||""},K=await G.post("/api/now/table/sysapproval_approver",W);return N({action:"approve",approved:!0,approval:K.data.result})}async function W00(Y,X){let{sys_id:J,short_description:z,description:Q,assigned_to:G,due_date:Z}=Y;if(!J)return M("sys_id required");if(!z)return M("short_description required");let $=await x(X),H={change_request:J,short_description:z};if(Q)H.description=Q;if(G)H.assigned_to=G;if(Z)H.due_date=Z;let W=await $.post("/api/now/table/change_task",H);return N({action:"create_task",created:!0,task:W.data.result})}async function K00(Y,X){let{sys_id:J,cab_date:z,cab_agenda:Q}=Y;if(!J)return M("sys_id required");if(!z)return M("cab_date required");let G=await x(X),Z={cab_date:z};if(Q)Z.cab_agenda=Q;let $=J.match(/^[a-f0-9]{32}$/)?"sys_id="+J:"number="+J,H=await G.get("/api/now/table/change_request?sysparm_query="+$);if(!H.data?.result?.[0])return M("Change not found");let W=H.data.result[0].sys_id,K=await G.patch("/api/now/table/change_request/"+W,Z);return N({action:"schedule_cab",scheduled:!0,change:K.data.result})}var tF={name:"snow_change_query",description:"Unified change query (get, search, assess_risk)",category:"itsm",subcategory:"change",use_cases:["change-management","query","risk-assessment"],complexity:"beginner",frequency:"high",permission:"read",allowedRoles:["developer","stakeholder","admin"],inputSchema:{type:"object",properties:{action:{type:"string",description:"Query action",enum:["get","search","assess_risk"]},sys_id:{type:"string",description:"[get/assess_risk] Change sys_id or number"},include_tasks:{type:"boolean",description:"[get] Include change tasks",default:!0},include_approvals:{type:"boolean",description:"[get] Include approval history",default:!0},query:{type:"string",description:"[search] Search query"},state:{type:"string",description:"[search] Filter by state"},type:{type:"string",description:"[search] Filter by type",enum:["standard","normal","emergency"]},risk:{type:"string",description:"[search] Filter by risk",enum:["high","medium","low"]},limit:{type:"number",description:"[search] Maximum results",default:10}},required:["action"]}};async function eF(Y,X){let{action:J}=Y;try{switch(J){case"get":return await U00(Y,X);case"search":return await B00(Y,X);case"assess_risk":return await V00(Y,X);default:return M(`Unknown action: ${J}`)}}catch(z){return M(z.message)}}async function U00(Y,X){let{sys_id:J,include_tasks:z=!0,include_approvals:Q=!0}=Y;if(!J)return M("sys_id is required for get action");let G=await x(X),Z=J.match(/^[a-f0-9]{32}$/)?"sys_id="+J:"number="+J,$=await G.get("/api/now/table/change_request?sysparm_query="+Z);if(!$.data?.result?.[0])return M("Change request not found");let H=$.data.result[0],W={change:H};if(z){let K=await G.get("/api/now/table/change_task?sysparm_query=change_request="+H.sys_id);W.tasks=K.data?.result||[]}if(Q){let K=await G.get("/api/now/table/sysapproval_approver?sysparm_query=document_id="+H.sys_id);W.approvals=K.data?.result||[]}return N({action:"get",...W})}async function B00(Y,X){let{query:J,state:z,type:Q,risk:G,limit:Z=10}=Y,$=await x(X),H=[];if(J)H.push("short_descriptionLIKE"+J+"^ORdescriptionLIKE"+J);if(z)H.push("state="+z);if(Q)H.push("type="+Q);if(G)H.push("risk="+G);let W=H.join("^"),K=await $.get("/api/now/table/change_request",{params:{sysparm_query:W||void 0,sysparm_limit:Z,sysparm_orderby:"DESCsys_created_on"}});return N({action:"search",changes:K.data.result,count:K.data.result.length})}async function V00(Y,X){let{sys_id:J}=Y;if(!J)return M("sys_id is required for assess_risk action");let z=await x(X),Q=J.match(/^[a-f0-9]{32}$/)?"sys_id="+J:"number="+J,G=await z.get("/api/now/table/change_request?sysparm_query="+Q);if(!G.data?.result?.[0])return M("Change request not found");let Z=G.data.result[0],$=[],H=0;if(Z.type==="emergency")$.push("Emergency change type (+3)"),H+=3;if(Z.impact==="1")$.push("High impact (+2)"),H+=2;if(Z.risk==="high")$.push("High risk classification (+2)"),H+=2;let W=H>=5?"high":H>=3?"medium":"low";return N({action:"assess_risk",change_sys_id:Z.sys_id,change_number:Z.number,risk_assessment:{risk_level:W,risk_score:H,risk_factors:$,current_risk:Z.risk,impact:Z.impact,type:Z.type}})}var mQ={};G0(mQ,{snow_monitor_metrics_exec:()=>WP,snow_monitor_metrics_def:()=>HP,snow_get_event_queue_exec:()=>zP,snow_get_event_queue_def:()=>JP,snow_create_event_exec:()=>XP,snow_create_event_def:()=>YP,snow_create_alert_rule_exec:()=>$P,snow_create_alert_rule_def:()=>ZP,snow_create_alert_exec:()=>GP,snow_create_alert_def:()=>QP});var YP={name:"snow_create_event",description:"Create system event for event management",category:"automation",subcategory:"event-management",use_cases:["events","automation","workflows"],complexity:"beginner",frequency:"high",permission:"write",allowedRoles:["developer","admin"],inputSchema:{type:"object",properties:{name:{type:"string",description:"Event name"},table:{type:"string",description:"Source table"},parm1:{type:"string",description:"Event parameter 1"},parm2:{type:"string",description:"Event parameter 2"},instance:{type:"string",description:"Instance name"}},required:["name"]}};async function XP(Y,X){let{name:J,table:z,parm1:Q,parm2:G,instance:Z}=Y;try{let $=await x(X),H={name:J};if(z)H.table=z;if(Q)H.parm1=Q;if(G)H.parm2=G;if(Z)H.instance=Z;let W=await $.post("/api/now/table/sysevent",H);return N({created:!0,event:W.data.result})}catch($){return M($.message)}}var JP={name:"snow_get_event_queue",description:"Get event queue status and pending events",category:"automation",subcategory:"event-management",use_cases:["events","monitoring","troubleshooting"],complexity:"beginner",frequency:"medium",permission:"read",allowedRoles:["developer","stakeholder","admin"],inputSchema:{type:"object",properties:{state:{type:"string",enum:["ready","processing","error"],description:"Event state"},limit:{type:"number",default:50}}}};async function zP(Y,X){let{state:J,limit:z=50}=Y;try{let Q=await x(X),G=J?`state=${J}`:"",Z=await Q.get("/api/now/table/sysevent",{params:{sysparm_query:G,sysparm_limit:z}});return N({events:Z.data.result,count:Z.data.result.length})}catch(Q){return M(Q.message)}}var QP={name:"snow_create_alert",description:"Create system alert for monitoring",category:"automation",subcategory:"event-management",use_cases:["alerts","monitoring","notifications"],complexity:"beginner",frequency:"medium",permission:"write",allowedRoles:["developer","admin"],inputSchema:{type:"object",properties:{name:{type:"string",description:"Alert name"},table:{type:"string",description:"Target table"},condition:{type:"string",description:"Alert condition"},message:{type:"string",description:"Alert message"},severity:{type:"number",enum:[1,2,3,4,5],description:"Alert severity"}},required:["name","table","condition"]}};async function GP(Y,X){let{name:J,table:z,condition:Q,message:G,severity:Z}=Y;try{let $=await x(X),H={name:J,table:z,condition:Q};if(G)H.message=G;if(Z)H.severity=Z;let W=await $.post("/api/now/table/em_alert",H);return N({created:!0,alert:W.data.result})}catch($){return M($.message)}}var ZP={name:"snow_create_alert_rule",description:"Create alert rules for automated monitoring and notifications",category:"automation",subcategory:"event-management",use_cases:["alerts","rules","monitoring"],complexity:"intermediate",frequency:"medium",permission:"write",allowedRoles:["developer","admin"],inputSchema:{type:"object",properties:{name:{type:"string",description:"Alert rule name"},table:{type:"string",description:"Target table to monitor"},condition:{type:"string",description:"Alert trigger condition"},severity:{type:"number",enum:[1,2,3,4,5],description:"Alert severity (1=Critical, 5=Info)"},notification_group:{type:"string",description:"Group to notify"},notification_user:{type:"string",description:"User to notify"},email_template:{type:"string",description:"Email template sys_id"},active:{type:"boolean",description:"Rule active status",default:!0}},required:["name","table","condition"]}};async function $P(Y,X){let{name:J,table:z,condition:Q,severity:G,notification_group:Z,notification_user:$,email_template:H,active:W=!0}=Y;try{let K=await x(X),U={name:J,table:z,condition:Q,active:W};if(G)U.severity=G;if(Z)U.notification_group=Z;if($)U.notification_user=$;if(H)U.email_template=H;let B=await K.post("/api/now/table/em_alert_rule",U);return N({created:!0,alert_rule:B.data.result,sys_id:B.data.result.sys_id})}catch(K){return M(K.message)}}var HP={name:"snow_monitor_metrics",description:"Monitor system metrics and performance indicators",category:"automation",subcategory:"monitoring",use_cases:["metrics","monitoring","performance"],complexity:"intermediate",frequency:"high",permission:"read",allowedRoles:["developer","stakeholder","admin"],inputSchema:{type:"object",properties:{metric_type:{type:"string",enum:["cpu","memory","database","transactions"],description:"Metric type"},time_range:{type:"string",description:"Time range for metrics"}},required:["metric_type"]}};async function WP(Y,X){let{metric_type:J,time_range:z="1hour"}=Y;try{let G=await(await x(X)).get("/api/now/table/metric",{params:{sysparm_query:`type=${J}^created_at>javascript:gs.hoursAgo(1)`,sysparm_limit:100}});return N({metrics:G.data.result,metric_type:J,time_range:z})}catch(Q){return M(Q.message)}}var uQ={};G0(uQ,{snow_user_manage_exec:()=>UP,snow_user_manage_def:()=>KP,snow_role_group_manage_exec:()=>VP,snow_role_group_manage_def:()=>BP});var KP={name:"snow_user_manage",description:"Unified user management (create, deactivate)",category:"core-operations",subcategory:"user-admin",use_cases:["users","user-admin","accounts"],complexity:"beginner",frequency:"high",permission:"write",allowedRoles:["developer","admin"],inputSchema:{type:"object",properties:{action:{type:"string",description:"User management action",enum:["create","deactivate"]},user_name:{type:"string",description:"[create] Username"},first_name:{type:"string",description:"[create] First name"},last_name:{type:"string",description:"[create] Last name"},email:{type:"string",description:"[create] Email address"},department:{type:"string",description:"[create] Department sys_id"},manager:{type:"string",description:"[create] Manager sys_id"},active:{type:"boolean",description:"[create] Active status",default:!0},user_id:{type:"string",description:"[deactivate] User sys_id"}},required:["action"]}};async function UP(Y,X){let{action:J}=Y;try{switch(J){case"create":return await O00(Y,X);case"deactivate":return await M00(Y,X);default:return M(`Unknown action: ${J}`)}}catch(z){return M(z.message)}}async function O00(Y,X){let{user_name:J,first_name:z,last_name:Q,email:G,department:Z,manager:$,active:H=!0}=Y;if(!J)return M("user_name is required for create action");if(!z)return M("first_name is required for create action");if(!Q)return M("last_name is required for create action");if(!G)return M("email is required for create action");let W=await x(X),K={user_name:J,first_name:z,last_name:Q,email:G,active:H};if(Z)K.department=Z;if($)K.manager=$;let U=await W.post("/api/now/table/sys_user",K);return N({action:"create",created:!0,user:U.data.result,sys_id:U.data.result.sys_id})}async function M00(Y,X){let{user_id:J}=Y;if(!J)return M("user_id is required for deactivate action");let Q=await(await x(X)).patch(`/api/now/table/sys_user/${J}`,{active:!1});return N({action:"deactivate",deactivated:!0,user:Q.data.result,sys_id:J})}var BP={name:"snow_role_group_manage",description:"Unified role and group management (create_role, assign_role, create_group)",category:"core-operations",subcategory:"user-admin",use_cases:["roles","groups","permissions","user-admin"],complexity:"beginner",frequency:"high",permission:"write",allowedRoles:["developer","admin"],inputSchema:{type:"object",properties:{action:{type:"string",description:"Role/group management action",enum:["create_role","assign_role","create_group"]},name:{type:"string",description:"[create_role/create_group] Role or group name"},description:{type:"string",description:"[create_role/create_group] Description"},requires_subscription:{type:"string",description:"[create_role] Required subscription"},role:{type:"string",description:"[assign_role] Role sys_id"},user:{type:"string",description:"[assign_role] User sys_id (user or group required)"},group:{type:"string",description:"[assign_role/create_group] Group sys_id or manager sys_id"},inherited:{type:"boolean",description:"[assign_role] Inherited assignment",default:!1},manager:{type:"string",description:"[create_group] Manager sys_id"},type:{type:"string",description:"[create_group] Group type"},active:{type:"boolean",description:"[create_group] Active status",default:!0}},required:["action"]}};async function VP(Y,X){let{action:J}=Y;try{switch(J){case"create_role":return await L00(Y,X);case"assign_role":return await N00(Y,X);case"create_group":return await q00(Y,X);default:return M(`Unknown action: ${J}`)}}catch(z){return M(z.message)}}async function L00(Y,X){let{name:J,description:z,requires_subscription:Q}=Y;if(!J)return M("name is required for create_role action");let G=await x(X),Z={name:J};if(z)Z.description=z;if(Q)Z.requires_subscription=Q;let $=await G.post("/api/now/table/sys_user_role",Z);return N({action:"create_role",created:!0,role:$.data.result,sys_id:$.data.result.sys_id})}async function N00(Y,X){let{role:J,user:z,group:Q,inherited:G=!1}=Y;if(!J)return M("role is required for assign_role action");if(!z&&!Q)return M("Either user or group must be specified for assign_role action");let Z=await x(X),$={role:J,inherited:G};if(z)$.user=z;if(Q)$.group=Q;let H=await Z.post("/api/now/table/sys_user_has_role",$);return N({action:"assign_role",assigned:!0,assignment:H.data.result,sys_id:H.data.result.sys_id})}async function q00(Y,X){let{name:J,description:z,manager:Q,type:G,active:Z=!0}=Y;if(!J)return M("name is required for create_group action");let $=await x(X),H={name:J,active:Z};if(z)H.description=z;if(Q)H.manager=Q;if(G)H.type=G;let W=await $.post("/api/now/table/sys_user_group",H);return N({action:"create_group",created:!0,group:W.data.result,sys_id:W.data.result.sys_id})}var gQ={};G0(gQ,{snow_test_acl_exec:()=>xP,snow_test_acl_def:()=>qP,snow_get_user_roles_exec:()=>PP,snow_get_user_roles_def:()=>FP,snow_create_acl_role_exec:()=>NP,snow_create_acl_role_def:()=>LP,snow_create_acl_exec:()=>MP,snow_create_acl_def:()=>OP});var OP={name:"snow_create_acl",description:"Create Access Control List rule",category:"development",subcategory:"access-control",use_cases:["acl","security","permissions"],complexity:"intermediate",frequency:"medium",permission:"write",allowedRoles:["developer","admin"],inputSchema:{type:"object",properties:{name:{type:"string",description:"ACL name"},operation:{type:"string",enum:["read","write","create","delete"],description:"Operation type"},type:{type:"string",description:"ACL type (record/field)"},admin_overrides:{type:"boolean",default:!0},active:{type:"boolean",default:!0}},required:["name","operation"]}};async function MP(Y,X){let{name:J,operation:z,type:Q,admin_overrides:G=!0,active:Z=!0}=Y;try{let $=await x(X),H={name:J,operation:z,admin_overrides:G,active:Z};if(Q)H.type=Q;let W=await $.post("/api/now/table/sys_security_acl",H);return N({created:!0,acl:W.data.result})}catch($){return M($.message)}}var LP={name:"snow_create_acl_role",description:"Create ACL role association",category:"development",subcategory:"access-control",use_cases:["acl","roles","security"],complexity:"intermediate",frequency:"medium",permission:"write",allowedRoles:["developer","admin"],inputSchema:{type:"object",properties:{acl:{type:"string",description:"ACL sys_id"},role:{type:"string",description:"Role sys_id"}},required:["acl","role"]}};async function NP(Y,X){let{acl:J,role:z}=Y;try{let Q=await x(X),G={sys_security_acl:J,sys_user_role:z},Z=await Q.post("/api/now/table/sys_security_acl_role",G);return N({created:!0,acl_role:Z.data.result})}catch(Q){return M(Q.message)}}var qP={name:"snow_test_acl",description:"Test ACL access for user",category:"development",subcategory:"access-control",use_cases:["acl","testing","security"],complexity:"intermediate",frequency:"medium",permission:"read",allowedRoles:["developer","stakeholder","admin"],inputSchema:{type:"object",properties:{table:{type:"string",description:"Table name"},operation:{type:"string",enum:["read","write","create","delete"],description:"Operation"},user:{type:"string",description:"User sys_id to test"},record_id:{type:"string",description:"Specific record sys_id"}},required:["table","operation"]}};async function xP(Y,X){let{table:J,operation:z,user:Q,record_id:G}=Y;try{let Z=await x(X),$=`
var gr = new GlideRecord('${J}');
${G?`gr.get('${G}');`:"gr.query(); gr.next();"}
var canAccess = gr.canRead() || gr.canWrite() || gr.canCreate() || gr.canDelete();
gs.info('ACL Test: ' + canAccess);
canAccess;
    `,H=await Z.post("/api/now/table/sys_script_execution",{script:$});return N({has_access:H.data.result,table:J,operation:z,tested_user:Q||"current"})}catch(Z){return M(Z.message)}}var FP={name:"snow_get_user_roles",description:"Get all roles assigned to user",category:"core-operations",subcategory:"user-admin",use_cases:["roles","users","query"],complexity:"beginner",frequency:"high",permission:"read",allowedRoles:["developer","stakeholder","admin"],inputSchema:{type:"object",properties:{user_id:{type:"string",description:"User sys_id"}},required:["user_id"]}};async function PP(Y,X){let{user_id:J}=Y;try{let Q=await(await x(X)).get("/api/now/table/sys_user_has_role",{params:{sysparm_query:`user=${J}`,sysparm_display_value:"true",sysparm_limit:500}});return N({roles:Q.data.result,count:Q.data.result.length})}catch(z){return M(z.message)}}var pQ={};G0(pQ,{snow_data_export_exec:()=>SP,snow_data_export_def:()=>EP,snow_create_table_exec:()=>wP,snow_create_table_def:()=>AP,snow_create_field_exec:()=>IP,snow_create_field_def:()=>TP,snow_create_choice_exec:()=>DP,snow_create_choice_def:()=>vP,snow_bulk_update_exec:()=>CP,snow_bulk_update_def:()=>jP});var AP={name:"snow_create_table",description:"Create new database table",category:"development",subcategory:"platform",use_cases:["tables","schema","customization"],complexity:"advanced",frequency:"low",permission:"write",allowedRoles:["developer","admin"],inputSchema:{type:"object",properties:{name:{type:"string",description:"Table name"},label:{type:"string",description:"Table label"},extends_table:{type:"string",description:"Parent table to extend"},is_extendable:{type:"boolean",default:!0}},required:["name","label"]}};async function wP(Y,X){let{name:J,label:z,extends_table:Q,is_extendable:G=!0}=Y;try{let Z=await x(X),$={name:J,label:z,is_extendable:G};if(Q)$.super_class=Q;let H=await Z.post("/api/now/table/sys_db_object",$);return N({created:!0,table:H.data.result})}catch(Z){return M(Z.message)}}var TP={name:"snow_create_field",description:"Create table field/column",category:"development",subcategory:"platform",use_cases:["fields","schema","customization"],complexity:"intermediate",frequency:"medium",permission:"write",allowedRoles:["developer","admin"],inputSchema:{type:"object",properties:{table:{type:"string",description:"Table name"},column_name:{type:"string",description:"Field name"},column_label:{type:"string",description:"Field label"},internal_type:{type:"string",description:"Field type (string, integer, reference, etc.)"},reference:{type:"string",description:"Reference table (for reference fields)"},max_length:{type:"number",description:"Maximum length"},mandatory:{type:"boolean",default:!1}},required:["table","column_name","internal_type"]}};async function IP(Y,X){let{table:J,column_name:z,column_label:Q,internal_type:G,reference:Z,max_length:$,mandatory:H=!1}=Y;try{let W=await x(X),K={name:J,element:z,column_label:Q||z,internal_type:G,mandatory:H};if(Z)K.reference=Z;if($)K.max_length=$;let U=await W.post("/api/now/table/sys_dictionary",K);return N({created:!0,field:U.data.result})}catch(W){return M(W.message)}}var vP={name:"snow_create_choice",description:"Create choice list value for field",category:"development",subcategory:"platform",use_cases:["choices","fields","customization"],complexity:"beginner",frequency:"medium",permission:"write",allowedRoles:["developer","admin"],inputSchema:{type:"object",properties:{table:{type:"string",description:"Table name"},element:{type:"string",description:"Field name"},value:{type:"string",description:"Choice value"},label:{type:"string",description:"Choice label"},sequence:{type:"number",description:"Display order"},inactive:{type:"boolean",default:!1}},required:["table","element","value","label"]}};async function DP(Y,X){let{table:J,element:z,value:Q,label:G,sequence:Z,inactive:$=!1}=Y;try{let H=await x(X),W={name:J,element:z,value:Q,label:G,inactive:$};if(Z!==void 0)W.sequence=Z;let K=await H.post("/api/now/table/sys_choice",W);return N({created:!0,choice:K.data.result})}catch(H){return M(H.message)}}var jP={name:"snow_bulk_update",description:"Bulk update multiple records",category:"core-operations",subcategory:"bulk-operations",use_cases:["bulk-update","data-management","batch"],complexity:"intermediate",frequency:"medium",permission:"write",allowedRoles:["developer","admin"],inputSchema:{type:"object",properties:{table:{type:"string",description:"Table name"},query:{type:"string",description:"Query to select records"},updates:{type:"object",description:"Fields to update"},limit:{type:"number",default:100,description:"Max records to update"}},required:["table","query","updates"]}};async function CP(Y,X){let{table:J,query:z,updates:Q,limit:G=100}=Y;try{let Z=await x(X),H=(await Z.get(`/api/now/table/${J}`,{params:{sysparm_query:z,sysparm_limit:G}})).data.result.map((K)=>Z.patch(`/api/now/table/${J}/${K.sys_id}`,Q)),W=await Promise.all(H);return N({updated:!0,count:W.length,records:W.map((K)=>K.data.result)})}catch(Z){return M(Z.message)}}var EP={name:"snow_data_export",description:"Export table data to CSV/XML/JSON format. Always includes sys_id. Returns records array with full data.",category:"advanced",subcategory:"data-utilities",use_cases:["export","data-management","backup"],complexity:"beginner",frequency:"medium",permission:"read",allowedRoles:["developer","stakeholder","admin"],inputSchema:{type:"object",properties:{table:{type:"string",description:"Table name"},query:{type:"string",description:"Query filter"},fields:{type:"array",items:{type:"string"},description:"Fields to export"},format:{type:"string",enum:["csv","xml","json"],default:"json"},limit:{type:"number",default:1000}},required:["table"]}};async function SP(Y,X){let{table:J,query:z,fields:Q,format:G="json",limit:Z=1000}=Y;try{let $=await x(X),H={sysparm_limit:Z};if(z)H.sysparm_query=z;if(Q&&Q.length>0){let B=Q.includes("sys_id")?Q:["sys_id",...Q];H.sysparm_fields=B.join(",")}let K=(await $.get(`/api/now/table/${J}`,{params:H})).data.result||[],U;if(G==="csv")if(K.length===0)U="";else{let B=Object.keys(K[0]),O=[B.join(",")];for(let V of K){let L=B.map((q)=>{let F=V[q]||"",P=String(F).replace(/"/g,'""');return P.includes(",")||P.includes('"')||P.includes(`
`)?`"${P}"`:P});O.push(L.join(","))}U=O.join(`
`)}else if(G==="xml"){let B=K.map((O)=>{return`  <record>
${Object.entries(O).map(([L,q])=>`    <${L}>${String(q||"").replace(/[<>&]/g,(F)=>({"<":"&lt;",">":"&gt;","&":"&amp;"})[F]||F)}</${L}>`).join(`
`)}
  </record>`}).join(`
`);U=`<?xml version="1.0" encoding="UTF-8"?>
<${J}>
${B}
</${J}>`}else U=K;return N({table:J,format:G,count:K.length,records:U,message:`Exported ${K.length} records from ${J} in ${G.toUpperCase()} format`})}catch($){return M($.message)}}var cQ={};G0(cQ,{snow_export_to_xml_exec:()=>mP,snow_export_to_xml_def:()=>hP,snow_execute_transform_exec:()=>yP,snow_execute_transform_def:()=>fP,snow_create_transform_map_exec:()=>RP,snow_create_transform_map_def:()=>bP,snow_create_import_set_exec:()=>_P,snow_create_import_set_def:()=>kP});var kP={name:"snow_create_import_set",description:"Create import set for data import",category:"integration",subcategory:"import-export",use_cases:["import","data-migration","integration"],complexity:"intermediate",frequency:"medium",permission:"write",allowedRoles:["developer","admin"],inputSchema:{type:"object",properties:{table:{type:"string",description:"Import set table name"},data:{type:"array",items:{type:"object"},description:"Data to import"}},required:["table","data"]}};async function _P(Y,X){let{table:J,data:z}=Y;try{let Q=await x(X),G=z.map(($)=>Q.post(`/api/now/import/${J}`,$)),Z=await Promise.all(G);return N({imported:!0,count:Z.length,import_set:Z[0]?.data?.result?.import_set})}catch(Q){return M(Q.message)}}var bP={name:"snow_create_transform_map",description:"Create transform map for import sets",category:"integration",subcategory:"import-export",use_cases:["transform-maps","data-transformation","import"],complexity:"intermediate",frequency:"medium",permission:"write",allowedRoles:["developer","admin"],inputSchema:{type:"object",properties:{name:{type:"string",description:"Transform map name"},source_table:{type:"string",description:"Source import table (u_import_table)"},target_table:{type:"string",description:"Target table (incident, task, etc.)"},run_business_rules:{type:"boolean",default:!0},description:{type:"string",description:"Transform map description"}},required:["name","source_table","target_table"]}};async function RP(Y,X){let{name:J,source_table:z,target_table:Q,run_business_rules:G=!0,description:Z}=Y;try{let $=await x(X);try{let K=await $.get("/api/now/table/sys_db_object",{params:{sysparm_query:`name=${z}`,sysparm_fields:"name,label",sysparm_limit:1}});if(!K.data.result||K.data.result.length===0)throw new I("VALIDATION_ERROR",`Source table '${z}' does not exist. Import tables typically start with 'u_' or 'import_'.`,{details:{source_table:z,suggestion:"Create the import table first or verify the table name"}})}catch(K){if(K instanceof I)throw K}try{let K=await $.get("/api/now/table/sys_db_object",{params:{sysparm_query:`name=${Q}`,sysparm_fields:"name,label",sysparm_limit:1}});if(!K.data.result||K.data.result.length===0)throw new I("VALIDATION_ERROR",`Target table '${Q}' does not exist`,{details:{target_table:Q}})}catch(K){if(K instanceof I)throw K}let H={name:J,source:z,target:Q,run_business_rules:G?"true":"false",active:"true"};if(Z)H.description=Z;let W=await $.post("/api/now/table/sys_transform_map",H);return N({created:!0,sys_id:W.data.result.sys_id,name:W.data.result.name,source_table:W.data.result.source,target_table:W.data.result.target,transform_map:W.data.result})}catch($){let H=$.response?.data?.error||{},W=H.message||$.message,K=H.detail||"";if($.response?.status===403)throw new I("FORBIDDEN","Permission denied: User does not have access to create transform maps. Required role: import_admin or admin.",{details:{status_code:403,snow_error:H,error_detail:K,required_roles:["import_admin","admin"],suggestion:"Request import_admin role or have an admin create the transform map"}});return M($ instanceof I?$:new I("VALIDATION_ERROR",`Failed to create transform map: ${W}`,{details:{snow_error:H,error_detail:K,status_code:$.response?.status}}))}}var fP={name:"snow_execute_transform",description:"Execute transform map on import set",category:"integration",subcategory:"import-export",use_cases:["data-transformation","import","processing"],complexity:"beginner",frequency:"high",permission:"write",allowedRoles:["developer","admin"],inputSchema:{type:"object",properties:{import_set_sys_id:{type:"string",description:"Import set sys_id"},transform_map_sys_id:{type:"string",description:"Transform map sys_id"}},required:["import_set_sys_id","transform_map_sys_id"]}};async function yP(Y,X){let{import_set_sys_id:J,transform_map_sys_id:z}=Y;try{let Q=await x(X),G=`
var transformer = new GlideTransformMap();
transformer.setTransformMap('${z}');
transformer.transformImportSet('${J}');
    `,Z=await Q.post("/api/now/table/sys_script_execution",{script:G});return N({executed:!0,import_set:J,transform_map:z})}catch(Q){return M(Q.message)}}var hP={name:"snow_export_to_xml",description:"Export records to XML format",category:"integration",subcategory:"import-export",use_cases:["export","xml","backup"],complexity:"beginner",frequency:"medium",permission:"read",allowedRoles:["developer","stakeholder","admin"],inputSchema:{type:"object",properties:{table:{type:"string",description:"Table to export"},query:{type:"string",description:"Query filter"},view:{type:"string",description:"View to use"}},required:["table"]}};async function mP(Y,X){let{table:J,query:z,view:Q}=Y;try{let G=await x(X),Z={sysparm_query:z||""};if(Q)Z.sysparm_view=Q;let $=await G.get(`/api/now/table/${J}`,{params:Z,headers:{Accept:"application/xml"}});return N({xml:$.data,table:J,format:"xml"})}catch(G){return M(G.message)}}var dQ={};G0(dQ,{snow_workflow_transition_exec:()=>eP,snow_workflow_transition_def:()=>tP,snow_workflow_manage_exec:()=>rP,snow_workflow_manage_def:()=>sP,snow_start_workflow_exec:()=>oP,snow_start_workflow_def:()=>nP,snow_create_workflow_exec:()=>pP,snow_create_workflow_def:()=>gP,snow_create_workflow_activity_exec:()=>lP,snow_create_workflow_activity_def:()=>dP});var uP=`
 LEGACY FEATURE NOTICE:
ServiceNow Workflow (wf_workflow) is deprecated in favor of Flow Designer.

BEFORE PROCEEDING, CONSIDER:
 For NEW automations  Build manually in Flow Designer (modern, visual, supported)
 For EXISTING workflows  This tool can create/manage legacy workflows

Flow Designer is NOT programmable via Snow-Flow, but you can ask:
"Generate a Flow Designer specification for [describe your automation]"
to get a document describing what to build manually.

Proceeding with legacy workflow creation...
`,gP={name:"snow_create_workflow",description:" LEGACY: Create workflow definition (deprecated - ServiceNow recommends Flow Designer). Use for backwards compatibility only. For new automations, consider Flow Designer and ask Snow-Flow to generate a specification document.",category:"automation",subcategory:"workflow",use_cases:["workflow","process-automation","business-logic"],complexity:"intermediate",frequency:"medium",permission:"write",allowedRoles:["developer","admin"],inputSchema:{type:"object",properties:{name:{type:"string",description:"Workflow name"},table:{type:"string",description:"Table workflow applies to"},description:{type:"string",description:"Workflow description"},condition:{type:"string",description:"When to trigger workflow"}},required:["name","table"]}};async function pP(Y,X){let{name:J,table:z,description:Q,condition:G}=Y;try{let Z=await x(X),$={name:J,table:z};if(Q)$.description=Q;if(G)$.condition=G;let H=await Z.post("/api/now/table/wf_workflow",$);return N({created:!0,workflow:H.data.result,legacy_notice:uP.trim()},{},uP)}catch(Z){return M(Z.message)}}var cP=" LEGACY: Workflow activities are deprecated. Consider Flow Designer for new automations (ask Snow-Flow to generate a Flow Designer specification).",dP={name:"snow_create_workflow_activity",description:" LEGACY: Create workflow activity/stage (deprecated - ServiceNow recommends Flow Designer)",category:"automation",subcategory:"workflow",use_cases:["workflow","workflow-activities","process-steps"],complexity:"intermediate",frequency:"medium",permission:"write",allowedRoles:["developer","admin"],inputSchema:{type:"object",properties:{workflow:{type:"string",description:"Workflow sys_id"},name:{type:"string",description:"Activity name"},activity_definition:{type:"string",description:"Activity type sys_id"},order:{type:"number",description:"Execution order"}},required:["workflow","name","activity_definition"]}};async function lP(Y,X){let{workflow:J,name:z,activity_definition:Q,order:G}=Y;try{let Z=await x(X),$={workflow:J,name:z,activity_definition:Q};if(G!==void 0)$.order=G;let H=await Z.post("/api/now/table/wf_activity",$);return N({created:!0,activity:H.data.result,legacy_notice:cP},{},cP)}catch(Z){return M(Z.message)}}var iP=" LEGACY: ServiceNow Workflow is deprecated. For new automations, consider Flow Designer (not programmable via Snow-Flow, but specs can be generated).",nP={name:"snow_start_workflow",description:" LEGACY: Start a workflow on a record (deprecated - ServiceNow recommends Flow Designer). Workflows run asynchronously.",category:"automation",subcategory:"workflow",use_cases:["workflow","workflow-execution","automation"],complexity:"intermediate",frequency:"medium",permission:"write",allowedRoles:["developer","admin"],inputSchema:{type:"object",properties:{workflow_sys_id:{type:"string",description:"Workflow sys_id (from wf_workflow table)"},workflow_name:{type:"string",description:"Workflow name (alternative to sys_id)"},table:{type:"string",description:"Table name the record belongs to"},record_sys_id:{type:"string",description:"Record sys_id to run workflow on"}},required:["record_sys_id","table"]}};async function oP(Y,X){let{workflow_sys_id:J,workflow_name:z,table:Q,record_sys_id:G}=Y;try{let Z=await x(X),$=J,H=null;if(!J&&z){let U=await Z.get("/api/now/table/wf_workflow",{params:{sysparm_query:`name=${z}`,sysparm_fields:"sys_id,name,table,active",sysparm_limit:1}});if(!U.data?.result?.[0])throw new I("NOT_FOUND",`Workflow not found: ${z}`,{retryable:!1});H=U.data.result[0],$=H.sys_id}else if(J)H=(await Z.get(`/api/now/table/wf_workflow/${J}`,{params:{sysparm_fields:"sys_id,name,table,active"}})).data?.result;if(!(await Z.get(`/api/now/table/${Q}/${G}`,{params:{sysparm_fields:"sys_id"}})).data?.result)throw new I("NOT_FOUND",`Record not found: ${Q}/${G}`,{retryable:!1});let K=await Z.post("/api/now/table/wf_context",{workflow_version:$,table:Q,id:G,state:"executing",started_by:"snow-flow"});if(K.data?.result?.sys_id)return N({started:!0,workflow_sys_id:$,workflow_name:H?.name||"Unknown",record_sys_id:G,table:Q,context_sys_id:K.data.result.sys_id,message:"Workflow started successfully. It will run asynchronously.",note:"Check wf_context table for execution status",legacy_notice:iP},{operation:"start_workflow",method:"wf_context"},iP);return N({started:!1,workflow_sys_id:$,workflow_name:H?.name||"Unknown",record_sys_id:G,table:Q,message:"Could not create workflow context directly. The workflow may need to be triggered via record state change or business rule.",suggestion:"Try updating the record state to trigger associated workflows"},{operation:"start_workflow",method:"fallback"})}catch(Z){return M(Z instanceof I?Z:new I("UNKNOWN_ERROR",Z.message,{originalError:Z}))}}var aP=`
 LEGACY FEATURE NOTICE:
ServiceNow Workflow (wf_workflow) is deprecated in favor of Flow Designer.
Flow Designer provides a modern, visual interface for building automations.

However, Flow Designer is NOT programmable via Snow-Flow at this time.

RECOMMENDATIONS:
1. For NEW automations  Consider building manually in Flow Designer
2. For EXISTING workflows  This tool can manage legacy workflows
3. Need Flow Designer specs?  Ask Snow-Flow to generate a Flow Designer
   specification document with the required triggers, actions, and logic.

To generate a Flow Designer specification, ask:
"Generate a Flow Designer specification for [describe your automation]"
`,sP={name:"snow_workflow_manage",description:" LEGACY: Manage legacy workflows (deprecated - ServiceNow recommends Flow Designer). Use for backwards compatibility only. For new automations, consider Flow Designer (not programmable via Snow-Flow, but specs can be generated). Actions: list, get, stop, retry, clone, enable/disable",category:"automation",subcategory:"workflow",use_cases:["workflow","process-automation","workflow-management"],complexity:"intermediate",frequency:"high",permission:"write",allowedRoles:["developer","admin"],inputSchema:{type:"object",properties:{action:{type:"string",enum:["list","get","stop","retry","clone","enable","disable","delete","get_history"],description:"Action to perform"},workflow_id:{type:"string",description:"Workflow sys_id or name (required for get, stop, retry, clone, enable, disable, delete)"},context_id:{type:"string",description:"Workflow context sys_id (required for stop, retry, get_history on specific execution)"},table:{type:"string",description:"Filter workflows by table (for list action)"},active_only:{type:"boolean",description:"Only list active workflows",default:!0},new_name:{type:"string",description:"New name for cloned workflow (for clone action)"},limit:{type:"number",description:"Max results for list/get_history",default:50}},required:["action"]}};async function rP(Y,X){let{action:J,workflow_id:z,context_id:Q,table:G,active_only:Z=!0,new_name:$,limit:H=50}=Y;try{let p=await x(X);switch(J){case"list":{var W="";if(G)W="table="+G;if(Z)W+=(W?"^":"")+"active=true";var K=((await p.get("/api/now/table/wf_workflow",{params:{sysparm_query:W||void 0,sysparm_fields:"sys_id,name,table,active,description,sys_created_on,sys_updated_on",sysparm_limit:H}})).data.result||[]).map((_)=>({sys_id:_.sys_id,name:_.name,table:_.table,active:_.active==="true",description:_.description,created:_.sys_created_on,updated:_.sys_updated_on})),U=WY().success("Found "+K.length+" workflow"+(K.length===1?"":"s"));for(var B=0;B<Math.min(K.length,10);B++){var O=K[B];U.bullet(O.name+" ("+O.table+")"+(O.active?"":" [inactive]"))}if(K.length>10)U.indented("... and "+(K.length-10)+" more");return N({action:"list",count:K.length,workflows:K,legacy_notice:aP.trim()},{},U.build()+`

`+aP)}case"get":{if(!z)throw new I("VALIDATION_ERROR","workflow_id is required for get action");var V=z;if(z.length!==32){let s=await p.get("/api/now/table/wf_workflow",{params:{sysparm_query:"name="+z,sysparm_fields:"sys_id",sysparm_limit:1}});if(!s.data.result?.[0])throw new I("NOT_FOUND","Workflow not found: "+z);V=s.data.result[0].sys_id}let h=(await p.get("/api/now/table/wf_workflow/"+V)).data.result,_=await p.get("/api/now/table/wf_activity",{params:{sysparm_query:"workflow="+V,sysparm_fields:"sys_id,name,activity_definition,x,y,state,out_of_date",sysparm_limit:100}}),c=await p.get("/api/now/table/wf_transition",{params:{sysparm_query:"workflow="+V,sysparm_fields:"sys_id,name,from,to,condition",sysparm_limit:200}}),d=await p.get("/api/now/table/wf_context",{params:{sysparm_query:"workflow="+V+"^ORDERBYDESCstarted",sysparm_fields:"sys_id,state,started,ended,duration,id,table",sysparm_limit:10}});var L={sys_id:h.sys_id,name:h.name,table:h.table,active:h.active==="true",description:h.description,condition:h.condition,run_as:h.run_as,created:h.sys_created_on,updated:h.sys_updated_on},q=(_.data.result||[]).map((s)=>({sys_id:s.sys_id,name:s.name,definition:s.activity_definition,position:{x:s.x,y:s.y},state:s.state})),F=(c.data.result||[]).map((s)=>({sys_id:s.sys_id,name:s.name,from:s.from,to:s.to,condition:s.condition})),P=(d.data.result||[]).map((s)=>({context_id:s.sys_id,state:s.state,record_id:s.id,record_table:s.table,started:s.started,ended:s.ended,duration_ms:s.duration})),A=WY().success("Workflow: "+L.name).field("sys_id",L.sys_id).field("Table",L.table).field("Status",L.active?"Active":"Inactive").field("Description",L.description).blank().line("Activities: "+q.length+" | Transitions: "+F.length);if(P.length>0){A.blank().line("Recent Executions:");for(var w=0;w<Math.min(P.length,5);w++){var v=P[w];A.bullet(v.state+" - "+(v.started||"pending"))}}return N({action:"get",workflow:L,activities:q,transitions:F,recent_executions:P},{},A.build())}case"stop":{if(!Q)throw new I("VALIDATION_ERROR","context_id is required for stop action");await p.patch("/api/now/table/wf_context/"+Q,{state:"cancelled"});var T=WY().success("Stopped workflow execution").field("Context ID",Q);return N({action:"stop",context_id:Q,message:"Workflow execution cancelled"},{},T.build())}case"retry":{if(!Q)throw new I("VALIDATION_ERROR","context_id is required for retry action");let h=(await p.get("/api/now/table/wf_context/"+Q,{params:{sysparm_fields:"workflow,table,id"}})).data.result;if(!h)throw new I("NOT_FOUND","Workflow context not found: "+Q);let _=await p.post("/api/now/table/wf_context",{workflow:typeof h.workflow==="object"?h.workflow.value:h.workflow,table:h.table,id:h.id,state:"executing",started_by:"snow-flow-retry"});return N({action:"retry",original_context_id:Q,new_context_id:_.data.result.sys_id,message:"Workflow restarted"})}case"clone":{if(!z)throw new I("VALIDATION_ERROR","workflow_id is required for clone action");var D=z;if(z.length!==32){let W0=await p.get("/api/now/table/wf_workflow",{params:{sysparm_query:"name="+z,sysparm_fields:"sys_id,name",sysparm_limit:1}});if(!W0.data.result?.[0])throw new I("NOT_FOUND","Workflow not found: "+z);D=W0.data.result[0].sys_id}let h=(await p.get("/api/now/table/wf_workflow/"+D)).data.result;var j=$||h.name+" (Copy)";let c=(await p.post("/api/now/table/wf_workflow",{name:j,table:h.table,description:h.description,condition:h.condition,run_as:h.run_as,active:!1})).data.result.sys_id,d=await p.get("/api/now/table/wf_activity",{params:{sysparm_query:"workflow="+D,sysparm_limit:100}});var E={};for(var B=0;B<(d.data.result||[]).length;B++){var f=d.data.result[B],i=await p.post("/api/now/table/wf_activity",{workflow:c,name:f.name,activity_definition:f.activity_definition,x:f.x,y:f.y,vars:f.vars});E[f.sys_id]=i.data.result.sys_id}let s=await p.get("/api/now/table/wf_transition",{params:{sysparm_query:"workflow="+D,sysparm_limit:200}});for(var w=0;w<(s.data.result||[]).length;w++){var o=s.data.result[w],y=typeof o.from==="object"?o.from.value:o.from,a=typeof o.to==="object"?o.to.value:o.to;await p.post("/api/now/table/wf_transition",{workflow:c,name:o.name,from:E[y]||y,to:E[a]||a,condition:o.condition})}return N({action:"clone",original_id:D,new_workflow:{sys_id:c,name:j},activities_cloned:Object.keys(E).length,transitions_cloned:(s.data.result||[]).length,message:"Workflow cloned successfully (inactive by default)"})}case"enable":case"disable":{if(!z)throw new I("VALIDATION_ERROR","workflow_id is required for "+J+" action");var r=z;if(z.length!==32){let m=await p.get("/api/now/table/wf_workflow",{params:{sysparm_query:"name="+z,sysparm_fields:"sys_id",sysparm_limit:1}});if(!m.data.result?.[0])throw new I("NOT_FOUND","Workflow not found: "+z);r=m.data.result[0].sys_id}return await p.patch("/api/now/table/wf_workflow/"+r,{active:J==="enable"}),N({action:J,workflow_id:r,active:J==="enable",message:"Workflow "+(J==="enable"?"enabled":"disabled")})}case"delete":{if(!z)throw new I("VALIDATION_ERROR","workflow_id is required for delete action");var b=z;if(z.length!==32){let m=await p.get("/api/now/table/wf_workflow",{params:{sysparm_query:"name="+z,sysparm_fields:"sys_id",sysparm_limit:1}});if(!m.data.result?.[0])throw new I("NOT_FOUND","Workflow not found: "+z);b=m.data.result[0].sys_id}return await p.delete("/api/now/table/wf_workflow/"+b),N({action:"delete",workflow_id:b,message:"Workflow deleted"})}case"get_history":{var R="";if(z){var l=z;if(z.length!==32){let h=await p.get("/api/now/table/wf_workflow",{params:{sysparm_query:"name="+z,sysparm_fields:"sys_id",sysparm_limit:1}});if(h.data.result?.[0])l=h.data.result[0].sys_id}R="context.workflow="+l}if(Q)R="context="+Q;let m=await p.get("/api/now/table/wf_history",{params:{sysparm_query:R+"^ORDERBYDESCsys_created_on",sysparm_fields:"sys_id,context,activity,from_state,to_state,message,sys_created_on",sysparm_limit:H}});return N({action:"get_history",count:(m.data.result||[]).length,history:(m.data.result||[]).map((h)=>({sys_id:h.sys_id,context:typeof h.context==="object"?h.context.value:h.context,activity:typeof h.activity==="object"?h.activity.display_value:h.activity,from_state:h.from_state,to_state:h.to_state,message:h.message,timestamp:h.sys_created_on}))})}default:throw new I("VALIDATION_ERROR","Unknown action: "+J)}}catch(p){return M(p instanceof I?p:new I("UNKNOWN_ERROR",p.message,{originalError:p}))}}var tP={name:"snow_workflow_transition",description:" LEGACY: Manage workflow transitions (deprecated - ServiceNow recommends Flow Designer). Actions: create, update, delete, list",category:"automation",subcategory:"workflow",use_cases:["workflow","workflow-design","activity-connections"],complexity:"intermediate",frequency:"medium",permission:"write",allowedRoles:["developer","admin"],inputSchema:{type:"object",properties:{action:{type:"string",enum:["create","update","delete","list"],description:"Action to perform"},workflow_id:{type:"string",description:"Workflow sys_id or name (required for create, list)"},transition_id:{type:"string",description:"Transition sys_id (required for update, delete)"},from_activity:{type:"string",description:"Source activity sys_id (for create)"},to_activity:{type:"string",description:"Target activity sys_id (for create)"},name:{type:"string",description:"Transition name/label"},condition:{type:"string",description:"Condition script for conditional transitions"},condition_type:{type:"string",enum:["always","condition","else"],description:"Type of condition",default:"always"}},required:["action"]}};async function eP(Y,X){let{action:J,workflow_id:z,transition_id:Q,from_activity:G,to_activity:Z,name:$,condition:H,condition_type:W="always"}=Y;try{let L=await x(X);async function q(F){if(F.length===32)return F;let P=await L.get("/api/now/table/wf_workflow",{params:{sysparm_query:"name="+F,sysparm_fields:"sys_id",sysparm_limit:1}});if(!P.data.result?.[0])throw new I("NOT_FOUND","Workflow not found: "+F);return P.data.result[0].sys_id}switch(J){case"list":{if(!z)throw new I("VALIDATION_ERROR","workflow_id is required for list action");var K=await q(z),U=((await L.get("/api/now/table/wf_transition",{params:{sysparm_query:"workflow="+K,sysparm_fields:"sys_id,name,from,to,condition,condition_type",sysparm_limit:200}})).data.result||[]).map(function(P){return{sys_id:P.sys_id,name:P.name,from:typeof P.from==="object"?{sys_id:P.from.value,name:P.from.display_value}:P.from,to:typeof P.to==="object"?{sys_id:P.to.value,name:P.to.display_value}:P.to,condition:P.condition,condition_type:P.condition_type}});return N({action:"list",workflow_id:K,count:U.length,transitions:U})}case"create":{if(!z)throw new I("VALIDATION_ERROR","workflow_id is required for create action");if(!G)throw new I("VALIDATION_ERROR","from_activity is required for create action");if(!Z)throw new I("VALIDATION_ERROR","to_activity is required for create action");var B=await q(z),O={workflow:B,from:G,to:Z};if($)O.name=$;if(H)O.condition=H;if(W)O.condition_type=W;let F=await L.post("/api/now/table/wf_transition",O);return N({action:"create",created:!0,transition:{sys_id:F.data.result.sys_id,name:F.data.result.name,from:G,to:Z}})}case"update":{if(!Q)throw new I("VALIDATION_ERROR","transition_id is required for update action");var V={};if($!==void 0)V.name=$;if(H!==void 0)V.condition=H;if(W!==void 0)V.condition_type=W;if(G)V.from=G;if(Z)V.to=Z;if(Object.keys(V).length===0)throw new I("VALIDATION_ERROR","No fields to update");return await L.patch("/api/now/table/wf_transition/"+Q,V),N({action:"update",updated:!0,transition_id:Q,fields_updated:Object.keys(V)})}case"delete":{if(!Q)throw new I("VALIDATION_ERROR","transition_id is required for delete action");return await L.delete("/api/now/table/wf_transition/"+Q),N({action:"delete",deleted:!0,transition_id:Q})}default:throw new I("VALIDATION_ERROR","Unknown action: "+J)}}catch(L){return M(L instanceof I?L:new I("UNKNOWN_ERROR",L.message,{originalError:L}))}}var lQ={};G0(lQ,{snow_trigger_scheduled_job_exec:()=>XA,snow_trigger_scheduled_job_def:()=>YA,snow_scheduled_job_manage_exec:()=>zA,snow_scheduled_job_manage_def:()=>JA});var YA={name:"snow_trigger_scheduled_job",description:" TRIGGERS (not executes directly) an existing scheduled job via sys_trigger. Job runs asynchronously when scheduler picks it up.",category:"automation",subcategory:"scheduling",use_cases:["job-execution","testing","manual-trigger"],complexity:"intermediate",frequency:"medium",permission:"write",allowedRoles:["developer","admin"],inputSchema:{type:"object",properties:{job_sys_id:{type:"string",description:"Scheduled job sys_id (from sysauto_script table)"},wait_for_completion:{type:"boolean",description:"Wait and poll for job completion (max 60 seconds)",default:!1}},required:["job_sys_id"]}};async function XA(Y,X){let{job_sys_id:J,wait_for_completion:z=!1}=Y;try{let Q=await x(X),G=await Q.get(`/api/now/table/sysauto_script/${J}`,{params:{sysparm_fields:"name,sys_id,active,run_type"}});if(!G.data?.result)throw new I("NOT_FOUND",`Scheduled job not found: ${J}`,{retryable:!1});let Z=G.data.result,W=new Date(new Date().getTime()+2000).toISOString().replace("T"," ").substring(0,19),K=await Q.post("/api/now/table/sys_trigger",{name:`Snow-Flow Trigger - ${Z.name}`,next_action:W,trigger_type:0,state:0,document:"sysauto_script",document_key:J,claimed_by:"",system_id:"snow-flow"});if(!K.data?.result?.sys_id)return N({triggered:!1,job_sys_id:J,job_name:Z.name,message:"Could not create sys_trigger. You may not have permission to create triggers. Run the job manually via System Scheduler > Scheduled Jobs.",manual_url:`/sysauto_script.do?sys_id=${J}`},{operation:"trigger_scheduled_job",method:"sys_trigger_failed"});if(z){let B=Date.now(),O=60000;while(Date.now()-B<60000){await new Promise((V)=>setTimeout(V,3000));try{let V=await Q.get(`/api/now/table/sys_trigger/${K.data.result.sys_id}`,{params:{sysparm_fields:"state,next_action"}});if(V.data?.result?.state==="2"||V.data?.result?.state==="3")return N({triggered:!0,executed:!0,job_sys_id:J,job_name:Z.name,trigger_sys_id:K.data.result.sys_id,final_state:V.data.result.state==="2"?"completed":"error",message:"Job trigger was processed by scheduler"},{operation:"trigger_scheduled_job",method:"sys_trigger_completed"})}catch(V){break}}}return N({triggered:!0,job_sys_id:J,job_name:Z.name,trigger_sys_id:K.data.result.sys_id,message:"Trigger created successfully. Job will run when scheduler picks it up.",note:"Use wait_for_completion=true to poll for completion status"},{operation:"trigger_scheduled_job",method:"sys_trigger"})}catch(Q){return M(Q instanceof I?Q:new I("UNKNOWN_ERROR",Q.message,{originalError:Q}))}}var JA={name:"snow_scheduled_job_manage",description:"Manage scheduled jobs: list, get details, create, update, delete, enable/disable, run now, get history",category:"automation",subcategory:"scheduled-jobs",use_cases:["scheduled-jobs","automation","background-processing"],complexity:"intermediate",frequency:"high",permission:"write",allowedRoles:["developer","admin"],inputSchema:{type:"object",properties:{action:{type:"string",enum:["list","get","create","update","delete","enable","disable","run_now","get_history","get_next_run"],description:"Action to perform"},job_id:{type:"string",description:"Job sys_id or name (required for get, update, delete, enable, disable, run_now, get_history)"},name:{type:"string",description:"Job name (for create/update)"},script:{type:"string",description:"Script to execute (ES5 JavaScript)"},run_type:{type:"string",enum:["daily","weekly","monthly","periodically","once","on_demand"],description:"How often to run"},run_time:{type:"string",description:"Time to run (HH:MM:SS format for daily/weekly/monthly)"},run_dayofweek:{type:"number",description:"Day of week (1=Sunday, 7=Saturday) for weekly jobs"},run_dayofmonth:{type:"number",description:"Day of month (1-31) for monthly jobs"},run_period:{type:"string",description:'Period for periodic jobs (e.g., "00:05:00" for every 5 minutes)'},run_start:{type:"string",description:"Start date/time for one-time jobs (YYYY-MM-DD HH:MM:SS)"},conditional:{type:"boolean",description:"Whether job has a condition script",default:!1},condition:{type:"string",description:"Condition script (job only runs if this returns true)"},active:{type:"boolean",description:"Whether job is active",default:!0},active_only:{type:"boolean",description:"Only list active jobs",default:!1},limit:{type:"number",description:"Max results for list/get_history",default:50}},required:["action"]}};async function zA(Y,X){let{action:J,job_id:z,name:Q,script:G,run_type:Z,run_time:$,run_dayofweek:H,run_dayofmonth:W,run_period:K,run_start:U,conditional:B=!1,condition:O,active:V=!0,active_only:L=!1,limit:q=50}=Y;try{let b=await x(X);async function R(l){if(l.length===32&&!/\s/.test(l))return l;let p=await b.get("/api/now/table/sysauto_script",{params:{sysparm_query:"name="+l,sysparm_fields:"sys_id",sysparm_limit:1}});if(!p.data.result?.[0])throw new I("NOT_FOUND","Scheduled job not found: "+l);return p.data.result[0].sys_id}switch(J){case"list":{var F="";if(L)F="active=true";var P=((await b.get("/api/now/table/sysauto_script",{params:{sysparm_query:F+"^ORDERBYname",sysparm_fields:"sys_id,name,active,run_type,run_time,run_start,run_dayofweek,run_dayofmonth,sys_created_on,sys_updated_on",sysparm_limit:q}})).data.result||[]).map(function(p){return{sys_id:p.sys_id,name:p.name,active:p.active==="true",run_type:p.run_type,run_time:p.run_time,run_start:p.run_start,run_dayofweek:p.run_dayofweek,run_dayofmonth:p.run_dayofmonth,created:p.sys_created_on,updated:p.sys_updated_on}});return N({action:"list",count:P.length,jobs:P})}case"get":{if(!z)throw new I("VALIDATION_ERROR","job_id is required for get action");var A=await R(z),w=(await b.get("/api/now/table/sysauto_script/"+A)).data.result,v=(await b.get("/api/now/table/sys_trigger",{params:{sysparm_query:"document="+A,sysparm_fields:"next_action,state",sysparm_limit:1}})).data.result?.[0];return N({action:"get",job:{sys_id:w.sys_id,name:w.name,active:w.active==="true",run_type:w.run_type,run_time:w.run_time,run_start:w.run_start,run_dayofweek:w.run_dayofweek,run_dayofmonth:w.run_dayofmonth,run_period:w.run_period,conditional:w.conditional==="true",condition:w.condition,script:w.script,created:w.sys_created_on,updated:w.sys_updated_on},next_run:v?{next_action:v.next_action,state:v.state}:null})}case"create":{if(!Q)throw new I("VALIDATION_ERROR","name is required for create action");if(!G)throw new I("VALIDATION_ERROR","script is required for create action");var T={name:Q,script:G,active:V,run_type:Z||"on_demand"};if($)T.run_time=$;if(H)T.run_dayofweek=H;if(W)T.run_dayofmonth=W;if(K)T.run_period=K;if(U)T.run_start=U;if(B)T.conditional=B;if(O)T.condition=O;let l=await b.post("/api/now/table/sysauto_script",T);return N({action:"create",created:!0,job:{sys_id:l.data.result.sys_id,name:l.data.result.name,run_type:l.data.result.run_type}})}case"update":{if(!z)throw new I("VALIDATION_ERROR","job_id is required for update action");var D=await R(z),j={};if(Q!==void 0)j.name=Q;if(G!==void 0)j.script=G;if(Z!==void 0)j.run_type=Z;if($!==void 0)j.run_time=$;if(H!==void 0)j.run_dayofweek=H;if(W!==void 0)j.run_dayofmonth=W;if(K!==void 0)j.run_period=K;if(U!==void 0)j.run_start=U;if(B!==void 0)j.conditional=B;if(O!==void 0)j.condition=O;if(V!==void 0)j.active=V;if(Object.keys(j).length===0)throw new I("VALIDATION_ERROR","No fields to update");return await b.patch("/api/now/table/sysauto_script/"+D,j),N({action:"update",updated:!0,job_id:D,fields_updated:Object.keys(j)})}case"delete":{if(!z)throw new I("VALIDATION_ERROR","job_id is required for delete action");var E=await R(z);return await b.delete("/api/now/table/sysauto_script/"+E),N({action:"delete",deleted:!0,job_id:E})}case"enable":case"disable":{if(!z)throw new I("VALIDATION_ERROR","job_id is required for "+J+" action");var f=await R(z);return await b.patch("/api/now/table/sysauto_script/"+f,{active:J==="enable"}),N({action:J,job_id:f,active:J==="enable",message:"Scheduled job "+(J==="enable"?"enabled":"disabled")})}case"run_now":{if(!z)throw new I("VALIDATION_ERROR","job_id is required for run_now action");var i=await R(z);let l=await b.post("/api/now/table/sys_trigger",{name:"Execute Now: "+i,document:i,document_key:i,trigger_type:0,next_action:new Date().toISOString().slice(0,19).replace("T"," "),state:0,claimed_by:""});return N({action:"run_now",job_id:i,trigger_id:l.data.result?.sys_id,message:"Job scheduled for immediate execution",note:"Use get_history action to check execution results",important:"There may be a 30-60 second propagation delay before the job executes and logs appear. If get_history returns empty, wait and try again."})}case"get_history":{if(!z)throw new I("VALIDATION_ERROR","job_id is required for get_history action");var o=await R(z),y=(await b.get("/api/now/table/sysauto_script/"+o,{params:{sysparm_fields:"name"}})).data.result?.name;let p=await b.get("/api/now/table/syslog",{params:{sysparm_query:"source=Scheduler^messageLIKE"+y+"^ORDERBYDESCsys_created_on",sysparm_fields:"sys_id,message,level,sys_created_on",sysparm_limit:q}}),m=await b.get("/api/now/table/sys_trigger",{params:{sysparm_query:"document="+o+"^ORDERBYDESCsys_created_on",sysparm_fields:"sys_id,next_action,state,last_error,processed,sys_created_on",sysparm_limit:q}}),h=(p.data.result||[]).map(function(d){return{timestamp:d.sys_created_on,level:d.level,message:d.message}}),_=(m.data.result||[]).map(function(d){return{sys_id:d.sys_id,next_action:d.next_action,state:d.state,last_error:d.last_error,processed:d.processed,created:d.sys_created_on}}),c=h.length===0&&_.length===0?"No execution history found. If you just triggered run_now, there is typically a 30-60 second propagation delay before logs appear. Please wait and try again.":void 0;return N({action:"get_history",job_id:o,job_name:y,logs:h,triggers:_,note:c})}case"get_next_run":{if(!z)throw new I("VALIDATION_ERROR","job_id is required for get_next_run action");var a=await R(z),r=(await b.get("/api/now/table/sys_trigger",{params:{sysparm_query:"document="+a+"^state=0",sysparm_fields:"next_action,state",sysparm_limit:1}})).data.result?.[0];return N({action:"get_next_run",job_id:a,next_run:r?.next_action||null,state:r?.state||"not_scheduled",message:r?"Next run scheduled for "+r.next_action:"No scheduled run found"})}default:throw new I("VALIDATION_ERROR","Unknown action: "+J)}}catch(b){return M(b instanceof I?b:new I("UNKNOWN_ERROR",b.message,{originalError:b}))}}var iQ={};G0(iQ,{snow_send_email_exec:()=>GA,snow_send_email_def:()=>QA,snow_inbound_email_action_exec:()=>VA,snow_inbound_email_action_def:()=>BA,snow_email_notification_manage_exec:()=>UA,snow_email_notification_manage_def:()=>KA,snow_create_notification_exec:()=>WA,snow_create_notification_def:()=>HA,snow_create_email_template_exec:()=>$A,snow_create_email_template_def:()=>ZA});var QA={name:"snow_send_email",description:"Send email notification via sys_email table (supports username, email, or sys_id)",category:"automation",subcategory:"notifications",use_cases:["email","notifications","communication"],complexity:"beginner",frequency:"high",permission:"write",allowedRoles:["developer","admin"],inputSchema:{type:"object",properties:{to:{type:"string",description:"Recipient: username (admin), email (user@example.com), or sys_id"},subject:{type:"string",description:"Email subject"},body:{type:"string",description:"Email body (HTML supported)"},body_text:{type:"string",description:"Plain text email body (alternative to body)"},from:{type:"string",description:"Sender email address"},reply_to:{type:"string",description:"Reply-to email address"},cc:{type:"string",description:"CC recipients (comma-separated)"},bcc:{type:"string",description:"BCC recipients (comma-separated)"},importance:{type:"string",enum:["low","normal","high"],default:"normal"}},required:["to","subject"]}};async function GA(Y,X){let{to:J,subject:z,body:Q,body_text:G,from:Z,reply_to:$,cc:H,bcc:W,importance:K="normal"}=Y;try{let U=await x(X),B=J,O=J;if(!J.includes("@")&&!J.match(/^[0-9a-f]{32}$/i))try{let F=await U.get("/api/now/table/sys_user",{params:{sysparm_query:`user_name=${J}^ORemail=${J}`,sysparm_fields:"sys_id,email,user_name,name",sysparm_limit:1}});if(F.data.result&&F.data.result.length>0){let P=F.data.result[0];B=P.sys_id,O=P.email||J}}catch(F){console.warn(`Could not resolve user '${J}', treating as email address`)}let V={recipients:O,subject:z,body:Q||G||"",type:"send-ready",state:"ready"};if(Z)V.from=Z;if($)V.reply_to=$;if(H)V.cc=H;if(W)V.bcc=W;if(K==="high")V.importance="high";else if(K==="low")V.importance="low";if(B.match(/^[0-9a-f]{32}$/i))V.user=B;let q=(await U.post("/api/now/table/sys_email",V)).data.result;return N({sent:!0,email_sys_id:q.sys_id,recipients:O,subject:q.subject,state:q.state,type:q.type,message:"Email queued for delivery by ServiceNow email engine"})}catch(U){let B=U.response?.data?.error||{},O=B.message||U.message,V=B.detail||"";if(U.response?.status===400)return M(new I("VALIDATION_ERROR",`Failed to send email: ${O}`,{details:{status_code:400,snow_error:B,error_detail:V,provided_data:{to:J,subject:z},suggestion:"Verify recipient format (username, email, or sys_id) and that required fields are provided"}}));return M(U instanceof I?U:new I("UNKNOWN_ERROR",`Failed to send email: ${O}`,{details:{snow_error:B,error_detail:V,status_code:U.response?.status}}))}}var ZA={name:"snow_create_email_template",description:"Create email notification template with HTML/text content and optional SMS alternate",category:"automation",subcategory:"notifications",use_cases:["email","templates","notifications"],complexity:"beginner",frequency:"medium",permission:"write",allowedRoles:["developer","admin"],inputSchema:{type:"object",properties:{name:{type:"string",description:"Template name (unique identifier)"},table:{type:"string",description:"Associated table name (e.g., incident, change_request)"},subject:{type:"string",description:"Email subject line (supports ${field} substitution)"},message_html:{type:"string",description:"HTML email body content (supports ${field} substitution for dynamic values)"},message_text:{type:"string",description:"Plain text email body (fallback for non-HTML email clients)"},sms_alternate:{type:"string",description:"Short SMS message alternate (for SMS notifications)"},content_type:{type:"string",enum:["text/plain","text/html"],default:"text/html",description:"Content type of the email template"},description:{type:"string",description:"Description of the template purpose"},active:{type:"boolean",default:!0,description:"Whether the template is active"}},required:["name","subject"]}};async function $A(Y,X){var{name:J,table:z,subject:Q,message_html:G,message_text:Z,sms_alternate:$}=Y,H=Y.content_type||"text/html",W=Y.description,K=Y.active!==void 0?Y.active:!0;try{var U=await x(X),B={name:J,subject:Q,active:K};if(G)B.message_html=G,B.message=G;if(Z)B.message_text=Z;if($)B.sms_alternate=$;if(H)B.content_type=H;if(z)B.collection=z;if(W)B.description=W;var O=await U.post("/api/now/table/sysevent_email_template",B),V=O.data.result;return N({created:!0,template:{sys_id:V.sys_id,name:V.name,subject:V.subject,table:V.collection,content_type:V.content_type,has_html:Boolean(V.message_html||V.message),has_text:Boolean(V.message_text),has_sms:Boolean(V.sms_alternate),active:V.active==="true"}})}catch(L){return M(L.message)}}var HA={name:"snow_create_notification",description:"Create automated notification",category:"automation",subcategory:"notifications",use_cases:["notifications","automation","email"],complexity:"intermediate",frequency:"high",permission:"write",allowedRoles:["developer","admin"],inputSchema:{type:"object",properties:{name:{type:"string",description:"Notification name"},table:{type:"string",description:"Table to monitor"},condition:{type:"string",description:"When to trigger"},recipients:{type:"string",description:"Who receives notification"},subject:{type:"string",description:"Email subject"},message:{type:"string",description:"Email message"},template:{type:"string",description:"Email template sys_id or name (from sysevent_email_template) - uses template instead of inline message"},active:{type:"boolean",default:!0}},required:["name","table","condition"]}};async function WA(Y,X){let{name:J,table:z,condition:Q,recipients:G,subject:Z,message:$,template:H,active:W=!0}=Y;try{let U=await x(X);async function B(L){if(L.length===32&&!/\s/.test(L))return L;var q=await U.get("/api/now/table/sysevent_email_template",{params:{sysparm_query:"name="+L,sysparm_fields:"sys_id",sysparm_limit:1}});if(!q.data.result?.[0])throw new I("NOT_FOUND","Email template not found: "+L);return q.data.result[0].sys_id}let O={name:J,collection:z,condition:Q,active:W};if(G)O.recipients=G;if(Z)O.subject=Z;if($)O.message=$;if(H){var K=await B(H);O.template=K}let V=await U.post("/api/now/table/sysevent_email_action",O);return N({created:!0,notification:V.data.result})}catch(U){if(U instanceof I)return M(U);return M(U.message)}}var KA={name:"snow_email_notification_manage",description:"Manage email notifications (sysevent_email_action): list, get, create, update, delete, enable/disable. Supports all notification fields including triggers, recipients, content, and advanced options.",category:"automation",subcategory:"notifications",use_cases:["notifications","email","automation"],complexity:"intermediate",frequency:"high",permission:"write",allowedRoles:["developer","admin"],inputSchema:{type:"object",properties:{action:{type:"string",enum:["list","get","create","update","delete","enable","disable","test","clone"],description:"Action to perform"},notification_id:{type:"string",description:"Notification sys_id or name (required for get, update, delete, enable, disable, test, clone)"},table:{type:"string",description:"Table name (collection) the notification applies to"},name:{type:"string",description:"Notification name (display name in ServiceNow)"},active:{type:"boolean",description:"Whether notification is active",default:!0},action_insert:{type:"boolean",description:"Trigger on record INSERT",default:!1},action_update:{type:"boolean",description:"Trigger on record UPDATE",default:!1},event_name:{type:"string",description:"Event name to trigger on (alternative to action_insert/action_update)"},condition:{type:"string",description:'Encoded query condition for when to send (e.g., "priority=1^state=2")'},advanced_condition:{type:"string",description:"Advanced condition script (JavaScript) - runs in addition to condition"},recipient_fields:{type:"array",items:{type:"string"},description:'Field names containing recipients (e.g., ["assigned_to", "caller_id", "opened_by"])'},recipient_groups:{type:"array",items:{type:"string"},description:"Group sys_ids or names to receive notification"},recipient_users:{type:"array",items:{type:"string"},description:"User sys_ids or usernames to receive notification"},send_self:{type:"boolean",description:"Send to user who triggered the notification",default:!1},exclude_delegates:{type:"boolean",description:"Exclude delegate users from receiving notification",default:!1},subject:{type:"string",description:'Email subject (supports ${field} substitution, e.g., "Incident ${number} assigned to you")'},message_html:{type:"string",description:"Email body HTML (supports ${field} substitution)"},message_text:{type:"string",description:"Email body plain text (fallback for non-HTML clients)"},template:{type:"string",description:"Email template sys_id or name - when set, uses template instead of inline message"},content_type:{type:"string",enum:["text/html","text/plain"],description:"Email content type",default:"text/html"},from:{type:"string",description:"Custom FROM address (leave empty for system default)"},reply_to:{type:"string",description:"Reply-To address"},importance:{type:"string",enum:["","low","normal","high"],description:"Email importance/priority header"},include_attachments:{type:"boolean",description:"Include record attachments in email",default:!1},type:{type:"string",enum:["email","sms","push"],description:"Notification delivery type",default:"email"},push_message_only:{type:"boolean",description:"Send as push notification only (no email)",default:!1},sms_alternate:{type:"string",description:"SMS message content (when type=sms or as fallback)"},weight:{type:"number",description:"Priority weight for notification ordering (higher = more important)",default:0},order:{type:"number",description:"Execution order (lower = runs first)",default:100},force_delivery:{type:"boolean",description:"Force delivery even if user has notifications disabled",default:!1},omit_watermark:{type:"boolean",description:"Omit ServiceNow watermark from email",default:!1},mandatory:{type:"boolean",description:"Mark as mandatory notification (cannot be unsubscribed)",default:!1},subscribable:{type:"boolean",description:"Allow users to subscribe/unsubscribe from this notification",default:!1},category:{type:"string",description:"Notification category sys_id or name"},event_parm_1:{type:"boolean",description:"Use event.parm1 as recipient",default:!1},event_parm_2:{type:"boolean",description:"Use event.parm2 as recipient",default:!1},item:{type:"string",description:'Event parameter item (e.g., "event.parm1", "event.parm2")'},digestable:{type:"boolean",description:"Can be included in digest emails",default:!1},default_digest:{type:"boolean",description:"Include in digest by default",default:!1},digest_type:{type:"string",enum:["single","digest"],description:"Single email or digest mode",default:"single"},active_only:{type:"boolean",description:"Only list active notifications",default:!1},limit:{type:"number",description:"Max results for list action",default:50},new_name:{type:"string",description:"Name for cloned notification (required for clone action)"}},required:["action"]}};async function UA(Y,X){let{action:J,notification_id:z,table:Q,name:G,active:Z=!0,action_insert:$,action_update:H,event_name:W,condition:K,advanced_condition:U,recipient_fields:B,recipient_groups:O,recipient_users:V,send_self:L=!1,exclude_delegates:q=!1,subject:F,message_html:P,message_text:A,template:w,content_type:v,from:T,reply_to:D,importance:j,include_attachments:E=!1,type:f,push_message_only:i=!1,sms_alternate:o,weight:y=0,order:a=100,force_delivery:r=!1,omit_watermark:b=!1,mandatory:R=!1,subscribable:l=!1,category:p,event_parm_1:m=!1,event_parm_2:h=!1,item:_,digestable:c=!1,default_digest:d=!1,digest_type:s,active_only:W0=!1,limit:L0=50,new_name:X0}=Y;try{let z1=await x(X);async function m4(k0){if(k0.length===32&&!/\s/.test(k0))return k0;let q0=await z1.get("/api/now/table/sysevent_email_action",{params:{sysparm_query:"name="+k0,sysparm_fields:"sys_id",sysparm_limit:1}});if(!q0.data.result?.[0])throw new I("NOT_FOUND","Notification not found: "+k0);return q0.data.result[0].sys_id}async function V3(k0){if(k0.length===32&&!/\s/.test(k0))return k0;var q0=await z1.get("/api/now/table/sysevent_email_template",{params:{sysparm_query:"name="+k0,sysparm_fields:"sys_id",sysparm_limit:1}});if(!q0.data.result?.[0])throw new I("NOT_FOUND","Email template not found: "+k0);return q0.data.result[0].sys_id}switch(J){case"list":{var b0="";if(Q)b0="collection="+Q;if(W0)b0+=(b0?"^":"")+"active=true";var J0=((await z1.get("/api/now/table/sysevent_email_action",{params:{sysparm_query:b0?b0+"^ORDERBYname":"ORDERBYname",sysparm_fields:"sys_id,name,collection,event_name,active,subject,condition,template,action_insert,action_update,type,recipient_fields,sys_created_on,sys_updated_on",sysparm_display_value:"all",sysparm_limit:L0}})).data.result||[]).map(function(q0){return{sys_id:q0.sys_id?.value||q0.sys_id,name:q0.name?.value||q0.name,table:q0.collection?.value||q0.collection,event:q0.event_name?.value||q0.event_name,active:(q0.active?.value||q0.active)==="true",trigger:{on_insert:(q0.action_insert?.value||q0.action_insert)==="true",on_update:(q0.action_update?.value||q0.action_update)==="true",event:q0.event_name?.value||q0.event_name||null},subject:q0.subject?.value||q0.subject,has_condition:Boolean(q0.condition?.value||q0.condition),type:q0.type?.value||q0.type||"email",recipient_fields:q0.recipient_fields?.value||q0.recipient_fields||null,template:q0.template?.value||q0.template||null,template_display:q0.template?.display_value||null,created:q0.sys_created_on?.value||q0.sys_created_on,updated:q0.sys_updated_on?.value||q0.sys_updated_on}});return N({action:"list",count:J0.length,notifications:J0})}case"get":{if(!z)throw new I("VALIDATION_ERROR","notification_id is required for get action");var P0=await m4(z),n=(await z1.get("/api/now/table/sysevent_email_action/"+P0,{params:{sysparm_display_value:"all"}})).data.result;return N({action:"get",notification:{sys_id:n.sys_id?.value||n.sys_id,name:n.name?.value||n.name,table:n.collection?.value||n.collection,active:(n.active?.value||n.active)==="true",trigger:{on_insert:(n.action_insert?.value||n.action_insert)==="true",on_update:(n.action_update?.value||n.action_update)==="true",event_name:n.event_name?.value||n.event_name||null},condition:n.condition?.value||n.condition||null,advanced_condition:n.advanced_condition?.value||n.advanced_condition||null,recipients:{fields:n.recipient_fields?.value||n.recipient_fields||null,groups:n.recipient_groups?.value||n.recipient_groups||null,groups_display:n.recipient_groups?.display_value||null,users:n.recipient_users?.value||n.recipient_users||null,users_display:n.recipient_users?.display_value||null,send_self:(n.send_self?.value||n.send_self)==="true",exclude_delegates:(n.exclude_delegates?.value||n.exclude_delegates)==="true",event_parm_1:(n.event_parm_1?.value||n.event_parm_1)==="true",event_parm_2:(n.event_parm_2?.value||n.event_parm_2)==="true"},content:{subject:n.subject?.value||n.subject||null,message_html:n.message_html?.value||n.message_html||null,message_text:n.message_text?.value||n.message_text||null,template:n.template?.value||n.template||null,template_display:n.template?.display_value||null,content_type:n.content_type?.value||n.content_type||"text/html"},headers:{from:n.from?.value||n.from||null,reply_to:n.reply_to?.value||n.reply_to||null,importance:n.importance?.value||n.importance||null},settings:{type:n.type?.value||n.type||"email",weight:parseInt(n.weight?.value||n.weight||"0"),order:parseInt(n.order?.value||n.order||"100"),include_attachments:(n.include_attachments?.value||n.include_attachments)==="true",force_delivery:(n.force_delivery?.value||n.force_delivery)==="true",omit_watermark:(n.omit_watermark?.value||n.omit_watermark)==="true",mandatory:(n.mandatory?.value||n.mandatory)==="true",subscribable:(n.subscribable?.value||n.subscribable)==="true",push_message_only:(n.push_message_only?.value||n.push_message_only)==="true",sms_alternate:n.sms_alternate?.value||n.sms_alternate||null},digest:{digestable:(n.digestable?.value||n.digestable)==="true",default_digest:(n.default_digest?.value||n.default_digest)==="true",digest_type:n.digest_type?.value||n.digest_type||"single"},category:n.category?.value||n.category||null,category_display:n.category?.display_value||null,item:n.item?.value||n.item||null,created:n.sys_created_on?.value||n.sys_created_on,created_by:n.sys_created_by?.value||n.sys_created_by,updated:n.sys_updated_on?.value||n.sys_updated_on,updated_by:n.sys_updated_by?.value||n.sys_updated_by},url:X.instanceUrl+"/nav_to.do?uri=sysevent_email_action.do?sys_id="+P0})}case"create":{if(!G)throw new I("VALIDATION_ERROR","name is required for create action");if(!Q)throw new I("VALIDATION_ERROR","table is required for create action");var H0={name:G,collection:Q,active:Z};if($!==void 0)H0.action_insert=$;if(H!==void 0)H0.action_update=H;if(W)H0.event_name=W;if(K)H0.condition=K;if(U)H0.advanced_condition=U;if(B)H0.recipient_fields=Array.isArray(B)?B.join(","):B;if(O)H0.recipient_groups=Array.isArray(O)?O.join(","):O;if(V)H0.recipient_users=Array.isArray(V)?V.join(","):V;if(L!==void 0)H0.send_self=L;if(q!==void 0)H0.exclude_delegates=q;if(m!==void 0)H0.event_parm_1=m;if(h!==void 0)H0.event_parm_2=h;if(F)H0.subject=F;if(P)H0.message_html=P;if(A)H0.message_text=A;if(w){var O1=await V3(w);H0.template=O1}if(v)H0.content_type=v;if(T)H0.from=T;if(D)H0.reply_to=D;if(j)H0.importance=j;if(f)H0.type=f;if(y!==void 0)H0.weight=y;if(a!==void 0)H0.order=a;if(E!==void 0)H0.include_attachments=E;if(r!==void 0)H0.force_delivery=r;if(b!==void 0)H0.omit_watermark=b;if(R!==void 0)H0.mandatory=R;if(l!==void 0)H0.subscribable=l;if(i!==void 0)H0.push_message_only=i;if(o)H0.sms_alternate=o;if(p)H0.category=p;if(_)H0.item=_;if(c!==void 0)H0.digestable=c;if(d!==void 0)H0.default_digest=d;if(s)H0.digest_type=s;let k0=await z1.post("/api/now/table/sysevent_email_action",H0);var p1=k0.data.result.sys_id;return N({action:"create",created:!0,notification:{sys_id:p1,name:k0.data.result.name,table:k0.data.result.collection},url:X.instanceUrl+"/nav_to.do?uri=sysevent_email_action.do?sys_id="+p1})}case"update":{if(!z)throw new I("VALIDATION_ERROR","notification_id is required for update action");var S1=await m4(z),e={};if(G!==void 0)e.name=G;if(Q!==void 0)e.collection=Q;if(Z!==void 0)e.active=Z;if($!==void 0)e.action_insert=$;if(H!==void 0)e.action_update=H;if(W!==void 0)e.event_name=W;if(K!==void 0)e.condition=K;if(U!==void 0)e.advanced_condition=U;if(B!==void 0)e.recipient_fields=Array.isArray(B)?B.join(","):B;if(O!==void 0)e.recipient_groups=Array.isArray(O)?O.join(","):O;if(V!==void 0)e.recipient_users=Array.isArray(V)?V.join(","):V;if(L!==void 0)e.send_self=L;if(q!==void 0)e.exclude_delegates=q;if(m!==void 0)e.event_parm_1=m;if(h!==void 0)e.event_parm_2=h;if(F!==void 0)e.subject=F;if(P!==void 0)e.message_html=P;if(A!==void 0)e.message_text=A;if(w!==void 0)if(w===""||w===null)e.template="";else{var T1=await V3(w);e.template=T1}if(v!==void 0)e.content_type=v;if(T!==void 0)e.from=T;if(D!==void 0)e.reply_to=D;if(j!==void 0)e.importance=j;if(f!==void 0)e.type=f;if(y!==void 0)e.weight=y;if(a!==void 0)e.order=a;if(E!==void 0)e.include_attachments=E;if(r!==void 0)e.force_delivery=r;if(b!==void 0)e.omit_watermark=b;if(R!==void 0)e.mandatory=R;if(l!==void 0)e.subscribable=l;if(i!==void 0)e.push_message_only=i;if(o!==void 0)e.sms_alternate=o;if(p!==void 0)e.category=p;if(_!==void 0)e.item=_;if(c!==void 0)e.digestable=c;if(d!==void 0)e.default_digest=d;if(s!==void 0)e.digest_type=s;if(Object.keys(e).length===0)throw new I("VALIDATION_ERROR","No fields to update");return await z1.patch("/api/now/table/sysevent_email_action/"+S1,e),N({action:"update",updated:!0,notification_id:S1,fields_updated:Object.keys(e),url:X.instanceUrl+"/nav_to.do?uri=sysevent_email_action.do?sys_id="+S1})}case"delete":{if(!z)throw new I("VALIDATION_ERROR","notification_id is required for delete action");var J8=await m4(z);return await z1.delete("/api/now/table/sysevent_email_action/"+J8),N({action:"delete",deleted:!0,notification_id:J8})}case"enable":case"disable":{if(!z)throw new I("VALIDATION_ERROR","notification_id is required for "+J+" action");var z8=await m4(z);return await z1.patch("/api/now/table/sysevent_email_action/"+z8,{active:J==="enable"}),N({action:J,notification_id:z8,active:J==="enable",message:"Notification "+(J==="enable"?"enabled":"disabled")})}case"test":{if(!z)throw new I("VALIDATION_ERROR","notification_id is required for test action");var B6=await m4(z);let k0=await z1.get("/api/now/table/sysevent_email_action/"+B6,{params:{sysparm_fields:"name,collection,event_name,subject,action_insert,action_update,active"}});var Q8=[];if(k0.data.result.action_insert==="true")Q8.push("INSERT");if(k0.data.result.action_update==="true")Q8.push("UPDATE");if(k0.data.result.event_name)Q8.push("Event: "+k0.data.result.event_name);return N({action:"test",notification_id:B6,notification_name:k0.data.result.name,active:k0.data.result.active==="true",table:k0.data.result.collection,triggers:Q8.length>0?Q8:["No triggers configured"],message:"To test this notification, trigger the event or condition on the "+k0.data.result.collection+" table",test_tips:["Check System Logs > Email for sent emails","Use snow_get_email_logs tool to view email history","Ensure notification is active (active="+k0.data.result.active+")"],url:X.instanceUrl+"/nav_to.do?uri=sysevent_email_action.do?sys_id="+B6})}case"clone":{if(!z)throw new I("VALIDATION_ERROR","notification_id is required for clone action");if(!X0)throw new I("VALIDATION_ERROR","new_name is required for clone action");var U3=await m4(z),N0=(await z1.get("/api/now/table/sysevent_email_action/"+U3)).data.result,T4={name:X0,collection:N0.collection,active:Z!==void 0?Z:!1,action_insert:N0.action_insert,action_update:N0.action_update,event_name:N0.event_name,condition:N0.condition,advanced_condition:N0.advanced_condition,recipient_fields:N0.recipient_fields,recipient_groups:N0.recipient_groups,recipient_users:N0.recipient_users,send_self:N0.send_self,exclude_delegates:N0.exclude_delegates,event_parm_1:N0.event_parm_1,event_parm_2:N0.event_parm_2,subject:N0.subject,message_html:N0.message_html,message_text:N0.message_text,template:N0.template,content_type:N0.content_type,from:N0.from,reply_to:N0.reply_to,importance:N0.importance,type:N0.type,weight:N0.weight,order:N0.order,include_attachments:N0.include_attachments,force_delivery:N0.force_delivery,omit_watermark:N0.omit_watermark,mandatory:N0.mandatory,subscribable:N0.subscribable,push_message_only:N0.push_message_only,sms_alternate:N0.sms_alternate,category:N0.category,item:N0.item,digestable:N0.digestable,default_digest:N0.default_digest,digest_type:N0.digest_type};Object.keys(T4).forEach(function(I4){if(T4[I4]===null||T4[I4]===""||T4[I4]===void 0)delete T4[I4]});var B3=(await z1.post("/api/now/table/sysevent_email_action",T4)).data.result.sys_id;return N({action:"clone",cloned:!0,original:{sys_id:U3,name:N0.name},clone:{sys_id:B3,name:X0,active:T4.active},message:"Notification cloned successfully. The clone is "+(T4.active?"active":"inactive")+" by default.",url:X.instanceUrl+"/nav_to.do?uri=sysevent_email_action.do?sys_id="+B3})}default:throw new I("VALIDATION_ERROR","Unknown action: "+J+". Valid actions: list, get, create, update, delete, enable, disable, test, clone")}}catch(z1){return M(z1 instanceof I?z1:new I("UNKNOWN_ERROR",z1.message,{originalError:z1}))}}var BA={name:"snow_inbound_email_action",description:"Manage inbound email actions: list, get, create, update, delete, enable/disable",category:"automation",subcategory:"email",use_cases:["email","inbound-processing","automation","record-creation"],complexity:"intermediate",frequency:"medium",permission:"write",allowedRoles:["developer","admin"],inputSchema:{type:"object",properties:{action:{type:"string",enum:["list","get","create","update","delete","enable","disable"],description:"Action to perform"},action_id:{type:"string",description:"Inbound email action sys_id or name"},name:{type:"string",description:"Action name"},target_table:{type:"string",description:"Table to create/update records in"},action_type:{type:"string",enum:["record","forward","reply","ignore"],description:"What to do with matching emails",default:"record"},stop_processing:{type:"boolean",description:"Stop processing other actions after this one matches",default:!0},order:{type:"number",description:"Processing order (lower = earlier)",default:100},filter_condition:{type:"string",description:'Condition to match emails (e.g., "subject:incident")'},script:{type:"string",description:"Script to execute when email matches"},template:{type:"string",description:"Template for reply emails"},active:{type:"boolean",description:"Whether action is active",default:!0},active_only:{type:"boolean",description:"Only list active actions",default:!1},limit:{type:"number",description:"Max results for list",default:50}},required:["action"]}};async function VA(Y,X){let{action:J,action_id:z,name:Q,target_table:G,action_type:Z="record",stop_processing:$=!0,order:H=100,filter_condition:W,script:K,template:U,active:B=!0,active_only:O=!1,limit:V=50}=Y;try{let j=await x(X);async function E(f){if(f.length===32&&!/\s/.test(f))return f;let i=await j.get("/api/now/table/sysevent_in_email_action",{params:{sysparm_query:"name="+f,sysparm_fields:"sys_id",sysparm_limit:1}});if(!i.data.result?.[0])throw new I("NOT_FOUND","Inbound email action not found: "+f);return i.data.result[0].sys_id}switch(J){case"list":{var L="";if(O)L="active=true";var q=((await j.get("/api/now/table/sysevent_in_email_action",{params:{sysparm_query:L+"^ORDERBYorder",sysparm_fields:"sys_id,name,target_table,type,active,order,stop_processing,sys_created_on",sysparm_limit:V}})).data.result||[]).map(function(i){return{sys_id:i.sys_id,name:i.name,target_table:i.target_table,type:i.type,active:i.active==="true",order:i.order,stop_processing:i.stop_processing==="true",created:i.sys_created_on}});return N({action:"list",count:q.length,actions:q})}case"get":{if(!z)throw new I("VALIDATION_ERROR","action_id is required for get action");var F=await E(z),P=(await j.get("/api/now/table/sysevent_in_email_action/"+F)).data.result;return N({action:"get",email_action:{sys_id:P.sys_id,name:P.name,target_table:P.target_table,type:P.type,active:P.active==="true",order:P.order,stop_processing:P.stop_processing==="true",filter_condition:P.filter_condition,script:P.script,template:P.template,created:P.sys_created_on,updated:P.sys_updated_on}})}case"create":{if(!Q)throw new I("VALIDATION_ERROR","name is required for create action");var A={name:Q,type:Z,active:B,order:H,stop_processing:$};if(G)A.target_table=G;if(W)A.filter_condition=W;if(K)A.script=K;if(U)A.template=U;let f=await j.post("/api/now/table/sysevent_in_email_action",A);return N({action:"create",created:!0,email_action:{sys_id:f.data.result.sys_id,name:f.data.result.name,type:f.data.result.type}})}case"update":{if(!z)throw new I("VALIDATION_ERROR","action_id is required for update action");var w=await E(z),v={};if(Q!==void 0)v.name=Q;if(G!==void 0)v.target_table=G;if(Z!==void 0)v.type=Z;if($!==void 0)v.stop_processing=$;if(H!==void 0)v.order=H;if(W!==void 0)v.filter_condition=W;if(K!==void 0)v.script=K;if(U!==void 0)v.template=U;if(B!==void 0)v.active=B;if(Object.keys(v).length===0)throw new I("VALIDATION_ERROR","No fields to update");return await j.patch("/api/now/table/sysevent_in_email_action/"+w,v),N({action:"update",updated:!0,action_id:w,fields_updated:Object.keys(v)})}case"delete":{if(!z)throw new I("VALIDATION_ERROR","action_id is required for delete action");var T=await E(z);return await j.delete("/api/now/table/sysevent_in_email_action/"+T),N({action:"delete",deleted:!0,action_id:T})}case"enable":case"disable":{if(!z)throw new I("VALIDATION_ERROR","action_id is required for "+J+" action");var D=await E(z);return await j.patch("/api/now/table/sysevent_in_email_action/"+D,{active:J==="enable"}),N({action:J,action_id:D,active:J==="enable",message:"Inbound email action "+(J==="enable"?"enabled":"disabled")})}default:throw new I("VALIDATION_ERROR","Unknown action: "+J)}}catch(j){return M(j instanceof I?j:new I("UNKNOWN_ERROR",j.message,{originalError:j}))}}var nQ={};G0(nQ,{snow_create_form_section_exec:()=>MA,snow_create_form_section_def:()=>OA,snow_create_form_layout_exec:()=>xA,snow_create_form_layout_def:()=>qA,snow_add_form_field_exec:()=>NA,snow_add_form_field_def:()=>LA});var OA={name:"snow_create_form_section",description:"Create form section",category:"development",subcategory:"forms",use_cases:["forms","ui","sections"],complexity:"intermediate",frequency:"medium",permission:"write",allowedRoles:["developer","admin"],inputSchema:{type:"object",properties:{name:{type:"string",description:"Section name"},table:{type:"string",description:"Table name"},view:{type:"string",description:"Form view"},caption:{type:"string",description:"Section caption"},position:{type:"number",description:"Section position"}},required:["name","table"]}};async function MA(Y,X){let{name:J,table:z,view:Q,caption:G,position:Z}=Y;try{let $=await x(X),H={name:J,table:z};if(Q)H.view=Q;if(G)H.caption=G;if(Z!==void 0)H.position=Z;let W=await $.post("/api/now/table/sys_ui_section",H);return N({created:!0,section:W.data.result})}catch($){return M($.message)}}var LA={name:"snow_add_form_field",description:"Add field to form section",category:"development",subcategory:"forms",use_cases:["forms","ui","fields"],complexity:"intermediate",frequency:"medium",permission:"write",allowedRoles:["developer","admin"],inputSchema:{type:"object",properties:{section_sys_id:{type:"string",description:"Section sys_id"},element:{type:"string",description:"Field name"},type:{type:"string",description:"Field type"},position:{type:"number",description:"Field position"}},required:["section_sys_id","element"]}};async function NA(Y,X){let{section_sys_id:J,element:z,type:Q,position:G}=Y;try{let Z=await x(X),$={sys_ui_section:J,element:z};if(Q)$.type=Q;if(G!==void 0)$.position=G;let H=await Z.post("/api/now/table/sys_ui_element",$);return N({added:!0,field:H.data.result})}catch(Z){return M(Z.message)}}var qA={name:"snow_create_form_layout",description:"Create custom form layout",category:"development",subcategory:"forms",use_cases:["forms","ui","layout"],complexity:"intermediate",frequency:"medium",permission:"write",allowedRoles:["developer","admin"],inputSchema:{type:"object",properties:{name:{type:"string",description:"Layout name"},table:{type:"string",description:"Table name"},view:{type:"string",description:"Form view"},type:{type:"string",enum:["standard","related_list","split"],default:"standard"}},required:["name","table"]}};async function xA(Y,X){let{name:J,table:z,view:Q,type:G="standard"}=Y;try{let Z=await x(X),$={name:J,table:z,type:G};if(Q)$.view=Q;let H=await Z.post("/api/now/table/sys_ui_form",$);return N({created:!0,layout:H.data.result})}catch(Z){return M(Z.message)}}var oQ={};G0(oQ,{snow_create_related_list_exec:()=>IA,snow_create_related_list_def:()=>TA,snow_create_list_view_exec:()=>PA,snow_create_list_view_def:()=>FA,snow_create_list_layout_exec:()=>DA,snow_create_list_layout_def:()=>vA,snow_add_list_column_exec:()=>wA,snow_add_list_column_def:()=>AA});var FA={name:"snow_create_list_view",description:"Create custom list view",category:"development",subcategory:"ui",use_cases:["lists","views","ui-customization"],complexity:"intermediate",frequency:"medium",permission:"write",allowedRoles:["developer","admin"],inputSchema:{type:"object",properties:{name:{type:"string",description:"View name"},table:{type:"string",description:"Table name"},fields:{type:"array",items:{type:"string"},description:"Fields to display"},filter:{type:"string",description:"Default filter"}},required:["name","table"]}};async function PA(Y,X){let{name:J,table:z,fields:Q,filter:G}=Y;try{let Z=await x(X),$={name:J,title:z};if(Q)$.fields=Q.join(",");if(G)$.filter=G;let H=await Z.post("/api/now/table/sys_ui_list",$);return N({created:!0,view:H.data.result})}catch(Z){return M(Z.message)}}var AA={name:"snow_add_list_column",description:"Add column to list view",category:"development",subcategory:"ui",use_cases:["lists","views","ui-customization"],complexity:"beginner",frequency:"medium",permission:"write",allowedRoles:["developer","admin"],inputSchema:{type:"object",properties:{table:{type:"string",description:"Table name"},element:{type:"string",description:"Field name"},position:{type:"number",description:"Column position"},width:{type:"number",description:"Column width"}},required:["table","element"]}};async function wA(Y,X){let{table:J,element:z,position:Q,width:G}=Y;try{let Z=await x(X),$={name:J,element:z};if(Q!==void 0)$.position=Q;if(G)$.width=G;let H=await Z.post("/api/now/table/sys_ui_list_element",$);return N({added:!0,column:H.data.result})}catch(Z){return M(Z.message)}}var TA={name:"snow_create_related_list",description:"Create related list on form",category:"development",subcategory:"ui",use_cases:["lists","relationships","forms"],complexity:"intermediate",frequency:"medium",permission:"write",allowedRoles:["developer","admin"],inputSchema:{type:"object",properties:{name:{type:"string",description:"Related list name"},parent_table:{type:"string",description:"Parent table"},related_table:{type:"string",description:"Related table"},relationship_field:{type:"string",description:"Field linking tables"}},required:["name","parent_table","related_table"]}};async function IA(Y,X){let{name:J,parent_table:z,related_table:Q,relationship_field:G}=Y;try{let Z=await x(X),$={name:J,parent:z,related:Q};if(G)$.relationship=G;let H=await Z.post("/api/now/table/sys_ui_related_list",$);return N({created:!0,related_list:H.data.result})}catch(Z){return M(Z.message)}}var vA={name:"snow_create_list_layout",description:"Create a complete list layout with multiple columns for any ServiceNow table",category:"development",subcategory:"ui",use_cases:["lists","list-layouts","views","ui-customization","columns"],complexity:"intermediate",frequency:"high",permission:"write",allowedRoles:["developer","admin"],inputSchema:{type:"object",properties:{table:{type:"string",description:'Table name this layout applies to (e.g., "incident", "change_request")'},view:{type:"string",description:'View name - use "" (empty string) for default view, "mobile" for mobile view, or custom view name',default:""},columns:{type:"array",description:"Array of column definitions with field names, positions, and optional widths",items:{type:"object",properties:{field:{type:"string",description:'Field name to display (e.g., "number", "short_description", "priority")'},position:{type:"number",description:"Column position (0 = first column, 1 = second, etc.)"},width:{type:"number",description:"Column width in pixels (optional, defaults to auto)"}},required:["field","position"]}},relationship:{type:"string",description:'For related lists, specify the relationship field (e.g., "parent" for child records)'},parent:{type:"string",description:"For related lists, specify the parent table name"}},required:["table","columns"]}};async function DA(Y,X){let{table:J,view:z="",columns:Q,relationship:G,parent:Z}=Y;try{let $=await x(X);if(!Array.isArray(Q)||Q.length===0)return M("columns must be a non-empty array");let H=[...Q].sort((V,L)=>V.position-L.position),W=[],K=[];for(let V of H)try{let L={name:J,element:V.field,position:V.position};if(z!==void 0)L.view=z;if(V.width)L.width=V.width;if(G)L.relationship=G;if(Z)L.parent=Z;let q=await $.post("/api/now/table/sys_ui_list",L);W.push({field:V.field,position:V.position,sys_id:q.data.result.sys_id})}catch(L){K.push(`Failed to create column ${V.field}: ${L.message}`)}let U=!!G&&!!Z,B=z?`view "${z}"`:"default view",O=U?`related list (${Z}.${G})`:"main list";if(K.length>0)return N({created:!0,partial_success:!0,table:J,view:z,layout_type:O,columns_created:W.length,columns_failed:K.length,created_columns:W,errors:K,message:`List layout partially created for ${J} ${O}, ${B}. ${W.length}/${Q.length} columns created successfully.`});return N({created:!0,table:J,view:z,layout_type:O,columns_count:W.length,columns:W,message:`List layout created for ${J} ${O}, ${B} with ${W.length} columns.`})}catch($){return M($.message)}}var aQ={};G0(aQ,{snow_disable_business_rule_exec:()=>SA,snow_disable_business_rule_def:()=>EA,snow_create_business_rule_exec:()=>CA,snow_create_business_rule_def:()=>jA});var jA={name:"snow_create_business_rule",description:"Create server-side business rule with full configuration options (ES5 only for scripts!)",category:"development",subcategory:"platform",use_cases:["business-rules","server-side","automation"],complexity:"intermediate",frequency:"high",permission:"write",allowedRoles:["developer","admin"],inputSchema:{type:"object",properties:{name:{type:"string",description:"Business rule name"},table:{type:"string",description:"Table name (e.g., incident, task, sys_user)"},description:{type:"string",description:"Description of what this business rule does"},when:{type:"string",enum:["before","after","async","display"],default:"before",description:"When to execute: before (before DB), after (after DB), async (scheduled), display (form load)"},order:{type:"number",default:100,description:"Execution order (lower = runs first). Default: 100"},insert:{type:"boolean",default:!1,description:"Run on insert operations"},update:{type:"boolean",default:!1,description:"Run on update operations"},delete:{type:"boolean",default:!1,description:"Run on delete operations"},query:{type:"boolean",default:!1,description:"Run on query operations"},filter_condition:{type:"string",description:'Encoded query filter (e.g., "active=true^priority=1"). Record must match this to trigger the rule.'},condition:{type:"string",description:'Script condition that must return true (ES5 only!). E.g., "current.priority == 1"'},role_conditions:{type:"string",description:"Comma-separated role sys_ids. Only users with these roles trigger the rule."},script:{type:"string",description:"Script to execute (ES5 ONLY! No const/let/arrow functions). Use current/previous objects."},abort_action:{type:"boolean",default:!1,description:'Abort the database action (only works with "before" rules)'},add_message:{type:"boolean",default:!1,description:"Add an info message to the user"},message:{type:"string",description:"Message text to display (requires add_message=true)"},active:{type:"boolean",default:!0,description:"Whether the business rule is active"},access:{type:"string",enum:["package_private","public"],default:"package_private",description:"Access level for the business rule"},application_scope:{type:"string",description:"Application scope sys_id (leave empty for global)"}},required:["name","table"]}};async function CA(Y,X){let{name:J,table:z,description:Q,when:G="before",order:Z=100,insert:$=!1,update:H=!1,delete:W=!1,query:K=!1,filter_condition:U,condition:B,role_conditions:O,script:V,abort_action:L=!1,add_message:q=!1,message:F,active:P=!0,access:A="package_private",application_scope:w}=Y;if(!$&&!H&&!W&&!K)return M("At least one operation must be selected: insert, update, delete, or query");if(!V&&!L)return M("Either script or abort_action is required");try{let v=await x(X),T={name:J,collection:z,when:G,order:Z,action_insert:$,action_update:H,action_delete:W,action_query:K,active:P,access:A};if(Q)T.description=Q;if(U)T.filter_condition=U;if(B)T.condition=B;if(O)T.role_conditions=O;if(V)T.script=V;if(L)T.abort_action=L;if(q)T.add_message=q;if(F)T.message=F;if(w)T.sys_scope=w;let j=(await v.post("/api/now/table/sys_script",T)).data.result,E=(v.defaults?.baseURL||"").replace("/api/now","");return N({created:!0,business_rule:{sys_id:j.sys_id,name:j.name,table:j.collection,when:j.when,order:j.order,operations:{insert:j.action_insert==="true",update:j.action_update==="true",delete:j.action_delete==="true",query:j.action_query==="true"},active:j.active==="true",url:`${E}/sys_script.do?sys_id=${j.sys_id}`},tips:['Use "current" to access the current record being processed','Use "previous" to access the previous values (on update)','Use "gs" for GlideSystem methods like gs.info(), gs.addInfoMessage()',"Remember: ES5 ONLY - no const, let, arrow functions, or template literals!"]})}catch(v){return M(`Failed to create business rule: ${v.response?.data?.error?.message||v.message}`)}}var EA={name:"snow_disable_business_rule",description:"Disable business rule",category:"development",subcategory:"platform",use_cases:["business-rules","management","configuration"],complexity:"beginner",frequency:"medium",permission:"write",allowedRoles:["developer","admin"],inputSchema:{type:"object",properties:{rule_sys_id:{type:"string",description:"Business rule sys_id"}},required:["rule_sys_id"]}};async function SA(Y,X){let{rule_sys_id:J}=Y;try{let Q=await(await x(X)).patch(`/api/now/table/sys_script/${J}`,{active:!1});return N({disabled:!0,business_rule:Q.data.result})}catch(z){return M(z.message)}}var sQ={};G0(sQ,{snow_get_sla_status_exec:()=>RA,snow_get_sla_status_def:()=>bA,snow_create_sla_exec:()=>_A,snow_create_sla_def:()=>kA});var kA={name:"snow_create_sla",description:"Create Service Level Agreement",category:"itsm",subcategory:"sla",use_cases:["sla-management","service-level","agreements"],complexity:"intermediate",frequency:"medium",permission:"write",allowedRoles:["developer","admin"],inputSchema:{type:"object",properties:{name:{type:"string",description:"SLA name"},table:{type:"string",description:"Table name"},duration:{type:"string",description:'Duration (e.g., "4 Hours")'},condition:{type:"string",description:"When SLA applies"},schedule:{type:"string",description:"Schedule sys_id"},active:{type:"boolean",default:!0}},required:["name","table","duration"]}};async function _A(Y,X){let{name:J,table:z,duration:Q,condition:G,schedule:Z,active:$=!0}=Y;try{let H=await x(X),W={name:J,collection:z,duration:Q,active:$};if(G)W.condition=G;if(Z)W.schedule=Z;let K=await H.post("/api/now/table/contract_sla",W);return N({created:!0,sla:K.data.result})}catch(H){return M(H.message)}}var bA={name:"snow_get_sla_status",description:"Get SLA status for record",category:"itsm",subcategory:"sla",use_cases:["sla-monitoring","status-check","service-level"],complexity:"beginner",frequency:"high",permission:"read",allowedRoles:["developer","stakeholder","admin"],inputSchema:{type:"object",properties:{table:{type:"string",description:"Table name"},record_sys_id:{type:"string",description:"Record sys_id"}},required:["table","record_sys_id"]}};async function RA(Y,X){let{table:J,record_sys_id:z}=Y;try{let G=await(await x(X)).get("/api/now/table/task_sla",{params:{sysparm_query:`task=${z}`,sysparm_display_value:"true"}});return N({slas:G.data.result,count:G.data.result.length})}catch(Q){return M(Q.message)}}var rQ={};G0(rQ,{snow_request_approval_exec:()=>yA,snow_request_approval_def:()=>fA,snow_get_pending_approvals_exec:()=>gA,snow_get_pending_approvals_def:()=>uA,snow_approve_reject_exec:()=>mA,snow_approve_reject_def:()=>hA});var fA={name:"snow_request_approval",description:"Request approval for record",category:"itsm",subcategory:"approvals",use_cases:["approvals","workflow","requests"],complexity:"beginner",frequency:"high",permission:"write",allowedRoles:["developer","admin"],inputSchema:{type:"object",properties:{source_table:{type:"string",description:"Source table name"},source_sys_id:{type:"string",description:"Source record sys_id"},approver:{type:"string",description:"Approver user sys_id"},comments:{type:"string",description:"Approval comments"}},required:["source_table","source_sys_id","approver"]}};async function yA(Y,X){let{source_table:J,source_sys_id:z,approver:Q,comments:G}=Y;try{let Z=await x(X),$={source_table:J,sysapproval:z,approver:Q,state:"requested"};if(G)$.comments=G;let H=await Z.post("/api/now/table/sysapproval_approver",$);return N({created:!0,approval:H.data.result})}catch(Z){return M(Z.message)}}var hA={name:"snow_approve_reject",description:"Approve or reject approval request",category:"itsm",subcategory:"approvals",use_cases:["approvals","workflow","decision"],complexity:"beginner",frequency:"high",permission:"write",allowedRoles:["developer","admin"],inputSchema:{type:"object",properties:{approval_sys_id:{type:"string",description:"Approval sys_id"},action:{type:"string",enum:["approved","rejected"],description:"Action"},comments:{type:"string",description:"Comments"}},required:["approval_sys_id","action"]}};async function mA(Y,X){let{approval_sys_id:J,action:z,comments:Q}=Y;try{let G=await x(X),Z={state:z};if(Q)Z.comments=Q;let $=await G.patch(`/api/now/table/sysapproval_approver/${J}`,Z);return N({updated:!0,action:z,approval:$.data.result})}catch(G){return M(G.message)}}var uA={name:"snow_get_pending_approvals",description:"Get pending approvals for user",category:"itsm",subcategory:"approvals",use_cases:["approvals","query","pending"],complexity:"beginner",frequency:"high",permission:"read",allowedRoles:["developer","stakeholder","admin"],inputSchema:{type:"object",properties:{approver_sys_id:{type:"string",description:"Approver user sys_id"},limit:{type:"number",default:100}},required:["approver_sys_id"]}};async function gA(Y,X){let{approver_sys_id:J,limit:z=100}=Y;try{let G=await(await x(X)).get("/api/now/table/sysapproval_approver",{params:{sysparm_query:`approver=${J}^state=requested`,sysparm_limit:z,sysparm_display_value:"true"}});return N({approvals:G.data.result,count:G.data.result.length})}catch(Q){return M(Q.message)}}var tQ={};G0(tQ,{snow_upload_attachment_exec:()=>cA,snow_upload_attachment_def:()=>pA,snow_get_attachments_exec:()=>lA,snow_get_attachments_def:()=>dA,snow_delete_attachment_exec:()=>nA,snow_delete_attachment_def:()=>iA});var pA={name:"snow_upload_attachment",description:"Upload attachment to record",category:"core-operations",subcategory:"attachments",use_cases:["attachments","upload","file-management"],complexity:"beginner",frequency:"high",permission:"write",allowedRoles:["developer","admin"],inputSchema:{type:"object",properties:{table_name:{type:"string",description:"Table name"},table_sys_id:{type:"string",description:"Record sys_id"},file_name:{type:"string",description:"File name"},content_type:{type:"string",description:"MIME type"},content:{type:"string",description:"Base64 encoded content"}},required:["table_name","table_sys_id","file_name","content"]}};async function cA(Y,X){let{table_name:J,table_sys_id:z,file_name:Q,content_type:G="application/octet-stream",content:Z}=Y;try{let H=await(await x(X)).post(`/api/now/attachment/file?table_name=${J}&table_sys_id=${z}&file_name=${Q}`,Buffer.from(Z,"base64"),{headers:{"Content-Type":G}});return N({uploaded:!0,attachment:H.data.result})}catch($){return M($.message)}}var dA={name:"snow_get_attachments",description:"Get attachments for record",category:"core-operations",subcategory:"attachments",use_cases:["attachments","query","file-management"],complexity:"beginner",frequency:"high",permission:"read",allowedRoles:["developer","stakeholder","admin"],inputSchema:{type:"object",properties:{table_name:{type:"string",description:"Table name"},table_sys_id:{type:"string",description:"Record sys_id"}},required:["table_name","table_sys_id"]}};async function lA(Y,X){let{table_name:J,table_sys_id:z}=Y;try{let G=await(await x(X)).get("/api/now/attachment",{params:{sysparm_query:`table_name=${J}^table_sys_id=${z}`}});return N({attachments:G.data.result,count:G.data.result.length})}catch(Q){return M(Q.message)}}var iA={name:"snow_delete_attachment",description:"Delete attachment",category:"core-operations",subcategory:"attachments",use_cases:["attachments","deletion","file-management"],complexity:"beginner",frequency:"medium",permission:"write",allowedRoles:["developer","admin"],inputSchema:{type:"object",properties:{attachment_sys_id:{type:"string",description:"Attachment sys_id"}},required:["attachment_sys_id"]}};async function nA(Y,X){let{attachment_sys_id:J}=Y;try{return await(await x(X)).delete(`/api/now/attachment/${J}`),N({deleted:!0,attachment_sys_id:J})}catch(z){return M(z.message)}}var eQ={};G0(eQ,{snow_create_ui_policy_action_exec:()=>aA,snow_create_ui_policy_action_def:()=>oA});var oA={name:"snow_create_ui_policy_action",description:"Create UI policy action",category:"development",subcategory:"platform",use_cases:["ui-policy-actions","form-control","ui-automation"],complexity:"intermediate",frequency:"medium",permission:"write",allowedRoles:["developer","admin"],inputSchema:{type:"object",properties:{ui_policy_sys_id:{type:"string",description:"UI policy sys_id"},field:{type:"string",description:"Field name"},visible:{type:"boolean",description:"Make visible"},mandatory:{type:"boolean",description:"Make mandatory"},readonly:{type:"boolean",description:"Make readonly"}},required:["ui_policy_sys_id","field"]}};async function aA(Y,X){let{ui_policy_sys_id:J,field:z,visible:Q,mandatory:G,readonly:Z}=Y;try{let $=await x(X),H={ui_policy:J,field:z};if(Q!==void 0)H.visible=Q;if(G!==void 0)H.mandatory=G;if(Z!==void 0)H.readonly=Z;let W=await $.post("/api/now/table/sys_ui_policy_action",H);return N({created:!0,action:W.data.result})}catch($){return M($.message)}}var YG={};G0(YG,{snow_create_metric_exec:()=>rA,snow_create_metric_def:()=>sA,snow_collect_metric_exec:()=>eA,snow_collect_metric_def:()=>tA});var sA={name:"snow_create_metric",description:"Create system metric",category:"reporting",subcategory:"metrics",use_cases:["metrics","analytics","monitoring"],complexity:"beginner",frequency:"medium",permission:"write",allowedRoles:["developer","admin"],inputSchema:{type:"object",properties:{name:{type:"string",description:"Metric name"},table:{type:"string",description:"Table to measure"},field:{type:"string",description:"Field to measure"},calculation:{type:"string",enum:["count","sum","avg","min","max"],default:"count"}},required:["name","table"]}};async function rA(Y,X){let{name:J,table:z,field:Q,calculation:G="count"}=Y;try{let Z=await x(X),$={name:J,table:z,calculation:G};if(Q)$.field=Q;let H=await Z.post("/api/now/table/metric_definition",$);return N({created:!0,metric:H.data.result})}catch(Z){return M(Z.message)}}var tA={name:"snow_collect_metric",description:"Collect metric data",category:"automation",subcategory:"monitoring",use_cases:["metrics","data-collection","monitoring"],complexity:"intermediate",frequency:"medium",permission:"read",allowedRoles:["developer","stakeholder","admin"],inputSchema:{type:"object",properties:{metric_sys_id:{type:"string",description:"Metric definition sys_id"}},required:["metric_sys_id"]}};async function eA(Y,X){let{metric_sys_id:J}=Y;try{let z=await x(X),Q=`
var metric = new GlideRecord('metric_definition');
if (metric.get('${J}')) {
  var collector = new MetricBaseCollector();
  collector.collect(metric);
  gs.info('Metric collected: ' + metric.name);
}
    `;return await z.post("/api/now/table/sys_script_execution",{script:Q}),N({collected:!0,metric:J})}catch(z){return M(z.message)}}var XG={};G0(XG,{snow_create_dashboard_exec:()=>Xw,snow_create_dashboard_def:()=>Yw,snow_add_dashboard_widget_exec:()=>zw,snow_add_dashboard_widget_def:()=>Jw});var Yw={name:"snow_create_dashboard",description:"Create dashboard",category:"reporting",subcategory:"dashboards",use_cases:["dashboards","reporting","visualization"],complexity:"beginner",frequency:"medium",permission:"write",allowedRoles:["developer","admin"],inputSchema:{type:"object",properties:{title:{type:"string",description:"Dashboard title"},description:{type:"string",description:"Dashboard description"},columns:{type:"number",default:2,description:"Number of columns"},active:{type:"boolean",default:!0}},required:["title"]}};async function Xw(Y,X){let{title:J,description:z,columns:Q=2,active:G=!0}=Y;try{let Z=await x(X),$={title:J,columns:Q,active:G};if(z)$.description=z;let H=await Z.post("/api/now/table/sys_dashboard",$);return N({created:!0,dashboard:H.data.result})}catch(Z){return M(Z.message)}}var Jw={name:"snow_add_dashboard_widget",description:"Add widget to dashboard",category:"reporting",subcategory:"dashboards",use_cases:["dashboards","widgets","visualization"],complexity:"beginner",frequency:"medium",permission:"write",allowedRoles:["developer","admin"],inputSchema:{type:"object",properties:{dashboard_sys_id:{type:"string",description:"Dashboard sys_id"},widget_type:{type:"string",description:"Widget type"},title:{type:"string",description:"Widget title"},position:{type:"number",description:"Widget position"}},required:["dashboard_sys_id","widget_type"]}};async function zw(Y,X){let{dashboard_sys_id:J,widget_type:z,title:Q,position:G}=Y;try{let Z=await x(X),$={dashboard:J,type:z};if(Q)$.title=Q;if(G!==void 0)$.position=G;let H=await Z.post("/api/now/table/sys_dashboard_widget",$);return N({added:!0,widget:H.data.result})}catch(Z){return M(Z.message)}}var JG={};G0(JG,{snow_create_menu_item_exec:()=>$w,snow_create_menu_item_def:()=>Zw,snow_create_menu_exec:()=>Gw,snow_create_menu_def:()=>Qw});var Qw={name:"snow_create_menu",description:"Create application menu",category:"development",subcategory:"ui",use_cases:["menu-creation","navigation","ui-development"],complexity:"beginner",frequency:"medium",permission:"write",allowedRoles:["developer","admin"],inputSchema:{type:"object",properties:{title:{type:"string",description:"Menu title"},application:{type:"string",description:"Application sys_id"},order:{type:"number",description:"Menu order"},active:{type:"boolean",default:!0}},required:["title"]}};async function Gw(Y,X){let{title:J,application:z,order:Q,active:G=!0}=Y;try{let Z=await x(X),$={title:J,active:G};if(z)$.application=z;if(Q!==void 0)$.order=Q;let H=await Z.post("/api/now/table/sys_app_module",$);return N({created:!0,menu:H.data.result})}catch(Z){return M(Z.message)}}var Zw={name:"snow_create_menu_item",description:"Create menu item",category:"development",subcategory:"ui",use_cases:["menu-items","navigation","ui-development"],complexity:"beginner",frequency:"medium",permission:"write",allowedRoles:["developer","admin"],inputSchema:{type:"object",properties:{title:{type:"string",description:"Item title"},parent:{type:"string",description:"Parent menu sys_id"},link_type:{type:"string",enum:["list","new","detail","home"],default:"list"},table:{type:"string",description:"Target table"},order:{type:"number",description:"Item order"}},required:["title"]}};async function $w(Y,X){let{title:J,parent:z,link_type:Q="list",table:G,order:Z}=Y;try{let $=await x(X),H={title:J,link_type:Q};if(z)H.parent=z;if(G)H.table=G;if(Z!==void 0)H.order=Z;let W=await $.post("/api/now/table/sys_app_module",H);return N({created:!0,menu_item:W.data.result})}catch($){return M($.message)}}var zG={};G0(zG,{snow_switch_application_scope_exec:()=>Vw,snow_switch_application_scope_def:()=>Bw,snow_list_applications_exec:()=>Nw,snow_list_applications_def:()=>Lw,snow_install_application_exec:()=>Uw,snow_install_application_def:()=>Kw,snow_get_current_scope_exec:()=>Mw,snow_get_current_scope_def:()=>Ow,snow_create_application_exec:()=>Ww,snow_create_application_def:()=>Hw});var Hw={name:"snow_create_application",description:`Create a scoped application in ServiceNow with optional automatic Update Set and scope switching.

\uD83D\uDCE6 WHEN TO CREATE AN APPLICATION:

 CREATE APPLICATION when:
- Building a complete feature set (e.g., HR Portal, Customer Onboarding)
- Creating functionality that needs to be deployed as a single unit
- Building integrations with external systems
- Developing for multiple ServiceNow instances
- Need clear ownership, versioning, and dependency management

 USE GLOBAL SCOPE when:
- Making small fixes or patches
- Creating shared utilities used across applications
- Quick prototypes or POCs
- Cross-application functionality

\uD83D\uDD04 WORKFLOW INTEGRATION:
- auto_create_update_set=true (default): Creates Update Set in new app scope
- auto_switch_scope=true (default): Switches to new app scope for development
- All subsequent artifacts will be tracked in the new application scope`,category:"development",subcategory:"applications",use_cases:["app-development","scoped-apps","development","deployment"],complexity:"advanced",frequency:"medium",permission:"write",allowedRoles:["developer","admin"],inputSchema:{type:"object",properties:{name:{type:"string",description:'Application name (e.g., "HR Self-Service Portal")'},scope:{type:"string",description:'Application scope prefix (e.g., "x_myco_hr_portal"). Must start with "x_" followed by vendor prefix and app name. Use lowercase with underscores.'},version:{type:"string",description:'Application version (default: "1.0.0")',default:"1.0.0"},short_description:{type:"string",description:"Brief description of the application purpose"},vendor:{type:"string",description:'Vendor/company name (e.g., "My Company")'},vendor_prefix:{type:"string",description:'Vendor prefix for scope (e.g., "myco"). Used in scope: x_<vendor_prefix>_<app>'},auto_create_update_set:{type:"boolean",description:"Automatically create an Update Set for this application (default: true). The Update Set will be scoped to this application for proper change tracking.",default:!0},auto_switch_scope:{type:"boolean",description:"Automatically switch to this application scope after creation (default: true). Enables immediate development within the new application.",default:!0},update_set_name:{type:"string",description:'Custom name for the auto-created Update Set. If not provided, defaults to "Initial Setup: <app_name>"'},runtime_access_tracking:{type:"string",description:"Runtime access tracking level",enum:["none","tracking","enforcing"],default:"tracking"},licensable:{type:"boolean",description:"Whether the application is licensable",default:!1}},required:["name","scope"]}};async function Ww(Y,X){let{name:J,scope:z,version:Q="1.0.0",short_description:G,vendor:Z,vendor_prefix:$,auto_create_update_set:H=!0,auto_switch_scope:W=!0,update_set_name:K,runtime_access_tracking:U="tracking",licensable:B=!1}=Y;try{let O=await x(X);if(!z.startsWith("x_"))return M(`Invalid scope format: "${z}". Scope must start with "x_" (e.g., "x_myco_hr_portal"). The format is: x_<vendor_prefix>_<app_name>`);let V=await O.get("/api/now/table/sys_app",{params:{sysparm_query:`scope=${z}`,sysparm_fields:"sys_id,name,scope",sysparm_limit:1}});if(V.data.result&&V.data.result.length>0)return M(`Application with scope "${z}" already exists: "${V.data.result[0].name}" (sys_id: ${V.data.result[0].sys_id})`);let L={name:J,scope:z,version:Q,active:!0,runtime_access_tracking:U,licensable:B};if(G)L.short_description=G;if(Z)L.vendor=Z;if($)L.vendor_prefix=$;let F=(await O.post("/api/now/table/sys_app",L)).data.result,P={created:!0,application:{sys_id:F.sys_id,name:F.name,scope:F.scope,version:F.version,short_description:F.short_description||null,vendor:F.vendor||null,vendor_prefix:F.vendor_prefix||null},update_set:null,scope_switched:!1,next_steps:[]};if(H)try{let w=K||`Initial Setup: ${J}`,v=`Development Update Set for ${J} (${z})`,D=(await O.post("/api/now/table/sys_update_set",{name:w,description:v,state:"in progress",application:F.sys_id})).data.result;if(P.update_set={sys_id:D.sys_id,name:D.name,description:D.description,state:"in progress",application_scope:z},W)try{let j=await O.get("/api/now/table/sys_user_preference",{params:{sysparm_query:"name=sys_update_set^user=javascript:gs.getUserID()",sysparm_limit:1}});if(j.data.result&&j.data.result.length>0)await O.patch(`/api/now/table/sys_user_preference/${j.data.result[0].sys_id}`,{value:D.sys_id});else await O.post("/api/now/table/sys_user_preference",{name:"sys_update_set",value:D.sys_id,user:"javascript:gs.getUserID()"});P.update_set.is_current=!0}catch(j){P.update_set.is_current=!1,P.update_set.switch_error=j.message}}catch(w){P.update_set={created:!1,error:w.message},P.next_steps.push(`Manually create Update Set for scope "${z}"`)}else P.next_steps.push(`Create Update Set for scope "${z}" before making changes`);if(W)try{let w=await O.get("/api/now/table/sys_user_preference",{params:{sysparm_query:"name=sys_scope^user=javascript:gs.getUserID()",sysparm_limit:1}});if(w.data.result&&w.data.result.length>0)await O.patch(`/api/now/table/sys_user_preference/${w.data.result[0].sys_id}`,{value:F.sys_id});else await O.post("/api/now/table/sys_user_preference",{name:"sys_scope",value:F.sys_id,user:"javascript:gs.getUserID()"});P.scope_switched=!0,P.current_scope={sys_id:F.sys_id,name:F.name,scope:F.scope}}catch(w){P.scope_switched=!1,P.scope_switch_error=w.message,P.next_steps.push(`Manually switch to scope "${z}" using snow_switch_application_scope`)}else P.next_steps.push(`Switch to scope "${z}" using snow_switch_application_scope before developing`);if(P.scope_switched&&P.update_set?.is_current)P.next_steps.push(`Ready to develop! All changes will be tracked in scope "${z}"`);P.next_steps.push("Create widgets, business rules, and other artifacts for your application"),P.next_steps.push("When done, complete the Update Set and export for deployment");let A=`Application "${J}" created successfully with scope "${z}"`;if(P.update_set?.sys_id)A+=`. Update Set "${P.update_set.name}" created and activated.`;if(P.scope_switched)A+=` Scope switched to ${z}.`;return P.message=A,N(P)}catch(O){return M(O.message)}}var Kw={name:"snow_install_application",description:"Install application from store",category:"development",subcategory:"applications",use_cases:["app-install","store","deployment"],complexity:"beginner",frequency:"low",permission:"write",allowedRoles:["developer","admin"],inputSchema:{type:"object",properties:{app_id:{type:"string",description:"Application ID from store"},version:{type:"string",description:"Version to install"}},required:["app_id"]}};async function Uw(Y,X){let{app_id:J,version:z}=Y;try{let Q=await x(X),G={sys_id:J};if(z)G.version=z;let Z=await Q.post("/api/now/table/sys_store_app",G);return N({installed:!0,application:Z.data.result})}catch(Q){return M(Q.message)}}var Bw={name:"snow_switch_application_scope",description:`Switch the current application scope for development.

\uD83D\uDD04 APPLICATION SCOPE SWITCHING:

When you switch scope, all NEW artifacts you create will belong to that scope.
This is essential for proper application organization and deployment.

\uD83D\uDCCC SCOPE OPTIONS:
- "global" - Global scope for cross-application utilities and system-wide changes
- Application sys_id - Switch to a specific application by its sys_id
- Scope name - Switch by scope prefix (e.g., "x_myco_hr_portal")
- Application name - Switch by application name

\uD83C\uDFAF USE CASES:
- Switching to a scoped app to add new features
- Switching to global for shared utilities
- Switching between multiple applications during development

 IMPORTANT:
- Existing artifacts remain in their original scope
- Active Update Set should match the target scope for proper tracking
- Use create_update_set=true to ensure changes are tracked`,category:"development",subcategory:"applications",use_cases:["app-development","scoped-apps","development","scope-management"],complexity:"intermediate",frequency:"medium",permission:"write",allowedRoles:["developer","admin"],inputSchema:{type:"object",properties:{scope:{type:"string",description:'Target scope to switch to. Can be "global", application sys_id, scope name (e.g., "x_myco_app"), or application name.'},create_update_set:{type:"boolean",description:"Create a new Update Set in the target scope (default: false). Useful when starting new development work.",default:!1},update_set_name:{type:"string",description:'Name for the new Update Set (if create_update_set=true). Defaults to "Development: <app_name>"'},update_set_description:{type:"string",description:"Description for the new Update Set (if create_update_set=true)"},servicenow_username:{type:"string",description:"Optional: Also switch scope for this ServiceNow user (for UI visibility)"}},required:["scope"]}};async function Vw(Y,X){let{scope:J,create_update_set:z=!1,update_set_name:Q,update_set_description:G,servicenow_username:Z}=Y;try{let $=await x(X),H,W,K,U=!1;if(J==="global"||J==="Global"||!J)H="global",W="Global",K="global",U=!0;else{let L=await $.get("/api/now/table/sys_app",{params:{sysparm_query:`sys_id=${J}`,sysparm_fields:"sys_id,name,scope,version,short_description",sysparm_limit:1}});if(!L.data.result||L.data.result.length===0)L=await $.get("/api/now/table/sys_app",{params:{sysparm_query:`scope=${J}`,sysparm_fields:"sys_id,name,scope,version,short_description",sysparm_limit:1}});if(!L.data.result||L.data.result.length===0)L=await $.get("/api/now/table/sys_app",{params:{sysparm_query:`name=${J}`,sysparm_fields:"sys_id,name,scope,version,short_description",sysparm_limit:1}});if(!L.data.result||L.data.result.length===0){let P=(await $.get("/api/now/table/sys_app",{params:{sysparm_fields:"name,scope",sysparm_limit:10,sysparm_query:"active=true"}})).data.result?.map((A)=>`  - "${A.name}" (${A.scope})`).join(`
`)||"  (no applications found)";return M(`Application not found: "${J}"

Available options:
  - "global" (Global scope)
${P}

Provide a valid application sys_id, scope name, or application name.`)}let q=L.data.result[0];H=q.sys_id,W=q.name,K=q.scope}let B=await $.get("/api/now/table/sys_user_preference",{params:{sysparm_query:"name=sys_scope^user=javascript:gs.getUserID()",sysparm_limit:1}});if(B.data.result&&B.data.result.length>0)await $.patch(`/api/now/table/sys_user_preference/${B.data.result[0].sys_id}`,{value:U?"global":H});else await $.post("/api/now/table/sys_user_preference",{name:"sys_scope",value:U?"global":H,user:"javascript:gs.getUserID()"});let O={scope_switched:!0,previous_scope:null,current_scope:{sys_id:H,name:W,scope:K,is_global:U},update_set:null,user_scope_switched:null};if(Z)try{let L=await $.get("/api/now/table/sys_user",{params:{sysparm_query:`user_name=${Z}`,sysparm_fields:"sys_id,user_name,name",sysparm_limit:1}});if(L.data.result&&L.data.result.length>0){let q=L.data.result[0].sys_id,F=await $.get("/api/now/table/sys_user_preference",{params:{sysparm_query:`name=sys_scope^user=${q}`,sysparm_limit:1}});if(F.data.result&&F.data.result.length>0)await $.patch(`/api/now/table/sys_user_preference/${F.data.result[0].sys_id}`,{value:U?"global":H});else await $.post("/api/now/table/sys_user_preference",{name:"sys_scope",value:U?"global":H,user:q});O.user_scope_switched={username:Z,success:!0}}else O.user_scope_switched={username:Z,success:!1,error:"User not found"}}catch(L){O.user_scope_switched={username:Z,success:!1,error:L.message}}if(z)try{let L=Q||`Development: ${W}`,q=G||`Development Update Set for ${W} (${K})`,P=(await $.post("/api/now/table/sys_update_set",{name:L,description:q,state:"in progress",application:U?"global":H})).data.result,A=await $.get("/api/now/table/sys_user_preference",{params:{sysparm_query:"name=sys_update_set^user=javascript:gs.getUserID()",sysparm_limit:1}});if(A.data.result&&A.data.result.length>0)await $.patch(`/api/now/table/sys_user_preference/${A.data.result[0].sys_id}`,{value:P.sys_id});else await $.post("/api/now/table/sys_user_preference",{name:"sys_update_set",value:P.sys_id,user:"javascript:gs.getUserID()"});O.update_set={sys_id:P.sys_id,name:P.name,description:P.description,state:"in progress",is_current:!0,application_scope:K}}catch(L){O.update_set={created:!1,error:L.message}}let V=`Switched to ${U?"Global":`"${W}"`} scope (${K})`;if(O.update_set?.sys_id)V+=`. Update Set "${O.update_set.name}" created and activated.`;if(O.user_scope_switched?.success)V+=` Also switched for user: ${Z}.`;if(O.message=V,O.guidance=U?"You are now in Global scope. Artifacts created will be available across all applications.":`You are now in "${W}" scope. Artifacts created will belong to this application.`,!O.update_set)O.guidance+=" Consider creating an Update Set for change tracking.";return N(O)}catch($){return M($.message)}}var Ow={name:"snow_get_current_scope",description:`Get the current application scope and active Update Set.

\uD83D\uDD0D USE THIS TO:
- Verify which scope you're currently working in before creating artifacts
- Check if you have an active Update Set in the current scope
- Understand the development context before starting work

\uD83D\uDCCB RETURNS:
- Current application scope (name, sys_id, scope prefix)
- Whether it's global or a scoped application
- Current active Update Set (if any)
- Recommendations for next steps`,category:"development",subcategory:"applications",use_cases:["app-development","scoped-apps","development","context-check"],complexity:"beginner",frequency:"high",permission:"read",allowedRoles:["developer","admin","stakeholder"],inputSchema:{type:"object",properties:{include_update_set:{type:"boolean",description:"Include information about the current Update Set (default: true)",default:!0},include_recent_artifacts:{type:"boolean",description:"Include count of recent artifacts created in current scope (default: false)",default:!1}},required:[]}};async function Mw(Y,X){let{include_update_set:J=!0,include_recent_artifacts:z=!1}=Y;try{let Q=await x(X),G=await Q.get("/api/now/table/sys_user_preference",{params:{sysparm_query:"name=sys_scope^user=javascript:gs.getUserID()",sysparm_fields:"value",sysparm_limit:1}}),Z={sys_id:"global",name:"Global",scope:"global",is_global:!0};if(G.data.result&&G.data.result.length>0){let W=G.data.result[0].value;if(W&&W!=="global"){let K=await Q.get(`/api/now/table/sys_app/${W}`,{params:{sysparm_fields:"sys_id,name,scope,version,short_description,vendor,active"}});if(K.data.result){let U=K.data.result;Z={sys_id:U.sys_id,name:U.name,scope:U.scope,version:U.version||null,short_description:U.short_description||null,vendor:U.vendor||null,is_global:!1,is_active:U.active==="true"||U.active===!0}}}}let $={current_scope:Z,update_set:null,recommendations:[]};if(J){let W=await Q.get("/api/now/table/sys_user_preference",{params:{sysparm_query:"name=sys_update_set^user=javascript:gs.getUserID()",sysparm_fields:"value",sysparm_limit:1}});if(W.data.result&&W.data.result.length>0){let K=W.data.result[0].value;if(K){let U=await Q.get(`/api/now/table/sys_update_set/${K}`,{params:{sysparm_fields:"sys_id,name,description,state,application,sys_created_on"}});if(U.data.result){let B=U.data.result,O="Global",V="global";if(B.application&&B.application!=="global")try{let L=await Q.get(`/api/now/table/sys_app/${B.application}`,{params:{sysparm_fields:"name,scope"}});if(L.data.result)O=L.data.result.name,V=L.data.result.scope}catch(L){}if($.update_set={sys_id:B.sys_id,name:B.name,description:B.description||null,state:B.state,created_at:B.sys_created_on,application:{sys_id:B.application||"global",name:O,scope:V},scope_matches:B.application===Z.sys_id||B.application==="global"&&Z.is_global},!$.update_set.scope_matches)$.recommendations.push(` Note: Current scope is "${Z.name}" but Update Set "${B.name}" is in "${O}". This is fine for global artifacts. If you need scoped artifacts, switch scope first.`)}}}if(!$.update_set)$.recommendations.push(" No active Update Set! Create one with snow_update_set_manage before making changes.")}if(z&&!Z.is_global)try{let W=new Date(Date.now()-86400000).toISOString(),K=await Q.get("/api/now/table/sys_metadata",{params:{sysparm_query:`sys_scope=${Z.sys_id}^sys_created_on>=${W}`,sysparm_fields:"sys_id",sysparm_limit:100}});$.recent_artifacts={count:K.data.result?.length||0,period:"last 24 hours",scope:Z.scope}}catch(W){}if(Z.is_global)$.recommendations.push("You are in Global scope. Artifacts created will be available across all applications."),$.recommendations.push("Consider creating a scoped application if building a complete feature set.");else $.recommendations.push(`You are in "${Z.name}" scope (${Z.scope}). Artifacts created will belong to this application.`);let H=`Current scope: ${Z.is_global?"Global":`"${Z.name}" (${Z.scope})`}`;if($.update_set){if(H+=` | Update Set: "${$.update_set.name}" (${$.update_set.state})`,!$.update_set.scope_matches)H+=` (Update Set in ${$.update_set.application.name} - OK for global artifacts)`}else H+=" | No active Update Set";return $.message=H,$.ready_to_proceed=!0,$.status="ok",N($)}catch(Q){return M(Q.message)}}var Lw={name:"snow_list_applications",description:`List all scoped applications in the ServiceNow instance.

\uD83D\uDCCB USE THIS TO:
- Find available application scopes before switching
- Search for applications by name or scope prefix
- See which applications are active/inactive
- Decide which scope to use for development

\uD83D\uDD0D SEARCH OPTIONS:
- Filter by name (partial match)
- Filter by scope prefix (e.g., "x_myco")
- Filter by vendor
- Show only active or include inactive

\uD83D\uDCCA RETURNS:
- List of applications with name, scope, version, vendor
- Count of artifacts in each application (optional)
- Indicates which scope is currently active`,category:"development",subcategory:"applications",use_cases:["app-development","scoped-apps","development","discovery"],complexity:"beginner",frequency:"medium",permission:"read",allowedRoles:["developer","admin","stakeholder"],inputSchema:{type:"object",properties:{search:{type:"string",description:"Search term to filter applications by name or scope (partial match)"},vendor:{type:"string",description:"Filter by vendor name (partial match)"},active_only:{type:"boolean",description:"Only show active applications (default: true)",default:!0},include_artifact_count:{type:"boolean",description:"Include count of artifacts in each application (slower, default: false)",default:!1},include_global:{type:"boolean",description:'Include "Global" scope in the list (default: true)',default:!0},limit:{type:"number",description:"Maximum number of applications to return (default: 50)",default:50}},required:[]}};async function Nw(Y,X){let{search:J,vendor:z,active_only:Q=!0,include_artifact_count:G=!1,include_global:Z=!0,limit:$=50}=Y;try{let H=await x(X),W=[];if(Q)W.push("active=true");if(J)W.push(`nameLIKE${J}^ORscopeLIKE${J}`);if(z)W.push(`vendorLIKE${z}`);let K=W.length>0?W.join("^"):"",B=(await H.get("/api/now/table/sys_app",{params:{sysparm_query:K+"^ORDERBYname",sysparm_fields:"sys_id,name,scope,version,short_description,vendor,vendor_prefix,active,sys_created_on,sys_updated_on",sysparm_limit:$}})).data.result||[],O="global";try{let A=await H.get("/api/now/table/sys_user_preference",{params:{sysparm_query:"name=sys_scope^user=javascript:gs.getUserID()",sysparm_fields:"value",sysparm_limit:1}});if(A.data.result&&A.data.result.length>0)O=A.data.result[0].value||"global"}catch(A){}let V=[];if(Z){let A={sys_id:"global",name:"Global",scope:"global",version:null,short_description:"Global scope for cross-application development",vendor:"ServiceNow",is_global:!0,is_current:O==="global",active:!0};if(G)try{let w=await H.get("/api/now/table/sys_metadata",{params:{sysparm_query:"sys_scope=global",sysparm_fields:"sys_id",sysparm_limit:1,sysparm_count:"true"}});A.artifact_count=parseInt(w.headers["x-total-count"]||"0",10)}catch(w){A.artifact_count="unknown"}if(!J||"global".includes(J.toLowerCase())||"Global".toLowerCase().includes(J.toLowerCase()))V.push(A)}for(let A of B){let w={sys_id:A.sys_id,name:A.name,scope:A.scope,version:A.version||null,short_description:A.short_description||null,vendor:A.vendor||null,vendor_prefix:A.vendor_prefix||null,is_global:!1,is_current:O===A.sys_id,active:A.active==="true"||A.active===!0,created_at:A.sys_created_on,updated_at:A.sys_updated_on};if(G)try{let v=await H.get("/api/now/table/sys_metadata",{params:{sysparm_query:`sys_scope=${A.sys_id}`,sysparm_fields:"sys_id",sysparm_limit:1,sysparm_count:"true"}});w.artifact_count=parseInt(v.headers["x-total-count"]||"0",10)}catch(v){w.artifact_count="unknown"}V.push(w)}let L={applications:V,total_count:V.length,current_scope:O==="global"?"Global":V.find((A)=>A.is_current)?.name||O,filters_applied:{search:J||null,vendor:z||null,active_only:Q,include_global:Z}},q={};for(let A of V){let w=A.vendor||"Unknown";q[w]=(q[w]||0)+1}L.by_vendor=q;let F=`Found ${V.length} application${V.length===1?"":"s"}`;if(J)F+=` matching "${J}"`;let P=V.find((A)=>A.is_current);if(P)F+=`. Current scope: ${P.is_global?"Global":`"${P.name}" (${P.scope})`}`;if(L.message=F,L.recommendations=[],V.length===0)L.recommendations.push("No applications found. Use snow_create_application to create a new scoped application.");else if(!P)L.recommendations.push("Current scope not in list. Use snow_switch_application_scope to switch to a listed scope.");return N(L)}catch(H){return M(H.message)}}var QG={};G0(QG,{snow_get_queue_items_exec:()=>Pw,snow_get_queue_items_def:()=>Fw,snow_create_queue_exec:()=>xw,snow_create_queue_def:()=>qw});var qw={name:"snow_create_queue",description:"Create assignment queue",category:"itsm",subcategory:"queues",use_cases:["assignment-queues","work-distribution","routing"],complexity:"intermediate",frequency:"medium",permission:"write",allowedRoles:["developer","admin"],inputSchema:{type:"object",properties:{name:{type:"string",description:"Queue name"},table:{type:"string",description:"Table name"},condition:{type:"string",description:"Queue filter condition"},group:{type:"string",description:"Assignment group sys_id"}},required:["name","table"]}};async function xw(Y,X){let{name:J,table:z,condition:Q,group:G}=Y;try{let Z=await x(X),$={name:J,table:z};if(Q)$.condition=Q;if(G)$.group=G;let H=await Z.post("/api/now/table/sys_queue",$);return N({created:!0,queue:H.data.result})}catch(Z){return M(Z.message)}}var Fw={name:"snow_get_queue_items",description:"Get items in queue",category:"itsm",subcategory:"queues",use_cases:["queue-items","work-list","assignment"],complexity:"beginner",frequency:"high",permission:"read",allowedRoles:["developer","stakeholder","admin"],inputSchema:{type:"object",properties:{queue_sys_id:{type:"string",description:"Queue sys_id"},limit:{type:"number",default:50}},required:["queue_sys_id"]}};async function Pw(Y,X){let{queue_sys_id:J,limit:z=50}=Y;try{let Q=await x(X),G=await Q.get(`/api/now/table/sys_queue/${J}`),Z=G.data.result.table,$=G.data.result.condition,H=await Q.get(`/api/now/table/${Z}`,{params:{sysparm_query:$,sysparm_limit:z}});return N({items:H.data.result,count:H.data.result.length})}catch(Q){return M(Q.message)}}var GG={};G0(GG,{snow_get_journal_entries_exec:()=>Iw,snow_get_journal_entries_def:()=>Tw,snow_add_comment_exec:()=>ww,snow_add_comment_def:()=>Aw});var Aw={name:"snow_add_comment",description:"Add comment/work note to record",category:"core-operations",subcategory:"comments",use_cases:["comments","work-notes","collaboration"],complexity:"beginner",frequency:"high",permission:"write",allowedRoles:["developer","admin"],inputSchema:{type:"object",properties:{table:{type:"string",description:"Table name"},record_sys_id:{type:"string",description:"Record sys_id"},comment:{type:"string",description:"Comment text"},work_note:{type:"boolean",default:!1,description:"Is work note (internal)"}},required:["table","record_sys_id","comment"]}};async function ww(Y,X){let{table:J,record_sys_id:z,comment:Q,work_note:G=!1}=Y;try{let Z=await x(X),H={[G?"work_notes":"comments"]:Q},W=await Z.patch(`/api/now/table/${J}/${z}`,H);return N({added:!0,type:G?"work_note":"comment"})}catch(Z){return M(Z.message)}}var Tw={name:"snow_get_journal_entries",description:"Get journal entries for record",category:"core-operations",subcategory:"comments",use_cases:["journals","audit","history"],complexity:"beginner",frequency:"medium",permission:"read",allowedRoles:["developer","stakeholder","admin"],inputSchema:{type:"object",properties:{table:{type:"string",description:"Table name"},record_sys_id:{type:"string",description:"Record sys_id"},limit:{type:"number",default:100}},required:["table","record_sys_id"]}};async function Iw(Y,X){let{table:J,record_sys_id:z,limit:Q=100}=Y;try{let Z=await(await x(X)).get("/api/now/table/sys_journal_field",{params:{sysparm_query:`name=${J}^element_id=${z}`,sysparm_limit:Q,sysparm_display_value:"true"}});return N({entries:Z.data.result,count:Z.data.result.length})}catch(G){return M(G.message)}}var ZG={};G0(ZG,{snow_create_data_policy_rule_exec:()=>Cw,snow_create_data_policy_rule_def:()=>jw,snow_create_data_policy_exec:()=>Dw,snow_create_data_policy_def:()=>vw});var vw={name:"snow_create_data_policy",description:"Create data policy",category:"development",subcategory:"platform",use_cases:["data-policies","validation","governance"],complexity:"intermediate",frequency:"medium",permission:"write",allowedRoles:["developer","admin"],inputSchema:{type:"object",properties:{short_description:{type:"string",description:"Policy description"},table:{type:"string",description:"Table name"},condition:{type:"string",description:"When to apply"},reverse_if_false:{type:"boolean",default:!0},active:{type:"boolean",default:!0}},required:["short_description","table"]}};async function Dw(Y,X){let{short_description:J,table:z,condition:Q,reverse_if_false:G=!0,active:Z=!0}=Y;try{let $=await x(X),H={short_description:J,model_table:z,reverse_if_false:G,active:Z};if(Q)H.conditions=Q;let W=await $.post("/api/now/table/sys_data_policy2",H);return N({created:!0,data_policy:W.data.result})}catch($){return M($.message)}}var jw={name:"snow_create_data_policy_rule",description:"Create data policy rule",category:"development",subcategory:"platform",use_cases:["data-policies","rules","validation"],complexity:"intermediate",frequency:"medium",permission:"write",allowedRoles:["developer","admin"],inputSchema:{type:"object",properties:{data_policy_sys_id:{type:"string",description:"Data policy sys_id"},field:{type:"string",description:"Field name"},mandatory:{type:"boolean",description:"Make mandatory"},readonly:{type:"boolean",description:"Make readonly"}},required:["data_policy_sys_id","field"]}};async function Cw(Y,X){let{data_policy_sys_id:J,field:z,mandatory:Q,readonly:G}=Y;try{let Z=await x(X),$={sys_data_policy:J,element:z};if(Q!==void 0)$.mandatory=Q;if(G!==void 0)$.readonly=G;let H=await Z.post("/api/now/table/sys_data_policy_rule",$);return N({created:!0,rule:H.data.result})}catch(Z){return M(Z.message)}}var $G={};G0($G,{snow_validate_workspace_configuration_exec:()=>sw,snow_validate_workspace_configuration_def:()=>aw,snow_update_ux_app_config_landing_page_exec:()=>ow,snow_update_ux_app_config_landing_page_def:()=>nw,snow_discover_all_workspaces_exec:()=>iw,snow_discover_all_workspaces_def:()=>lw,snow_create_ux_page_registry_exec:()=>dw,snow_create_ux_page_registry_def:()=>cw,snow_create_ux_page_macroponent_exec:()=>pw,snow_create_ux_page_macroponent_def:()=>gw,snow_create_ux_experience_exec:()=>uw,snow_create_ux_experience_def:()=>mw,snow_create_ux_app_route_exec:()=>hw,snow_create_ux_app_route_def:()=>yw,snow_create_ux_app_config_exec:()=>fw,snow_create_ux_app_config_def:()=>Rw,snow_create_configurable_agent_workspace_exec:()=>bw,snow_create_configurable_agent_workspace_def:()=>_w,snow_create_complete_workspace_exec:()=>kw,snow_create_complete_workspace_def:()=>Sw});var Sw={name:"snow_create_complete_workspace",description:"Create Complete UX Workspace - Executes all 6 steps automatically: Experience  App Config  Page Macroponent  Page Registry  Route  Landing Page Route. Creates a fully functional workspace.",category:"ui-frameworks",subcategory:"workspace",use_cases:["workspace","ux-experience","complete-setup"],complexity:"intermediate",frequency:"high",permission:"write",allowedRoles:["developer","admin"],inputSchema:{type:"object",properties:{workspace_name:{type:"string",description:"Workspace name (used for all components)"},description:{type:"string",description:"Workspace description"},home_page_name:{type:"string",default:"home",description:'Home page name (default: "home")'},route_name:{type:"string",default:"home",description:'URL route name (default: "home")'},root_component:{type:"string",default:"sn-canvas-panel",description:"Root component for page"},composition:{type:"object",description:"Custom page layout (optional)"},root_macroponent:{type:"string",description:"Custom root macroponent (auto-detected if not provided)"},tables:{type:"array",items:{type:"string"},description:'Tables for list configuration (e.g., ["incident", "task"])'}},required:["workspace_name"]}};async function kw(Y,X){let{workspace_name:J,description:z,tables:Q=[]}=Y;try{let G=await x(X),Z={workspace_name:J,steps_completed:[],sys_ids:{},workspace_type:"Now Experience Framework Workspace"},$={name:J,description:z||`Complete UX workspace: ${J}`,active:!0},W=(await G.post("/api/now/table/sys_ux_experience",$)).data.result.sys_id;Z.steps_completed.push("UX Experience Created"),Z.sys_ids.experience_sys_id=W;let K={name:`${J} List Menu`,experience:W,description:`List menu for ${J}`,active:!0},B=(await G.post("/api/now/table/sys_ux_list_menu_config",K)).data.result.sys_id;Z.steps_completed.push("List Menu Configuration Created"),Z.sys_ids.list_menu_config_sys_id=B;let O={name:`${J} Config`,experience_assoc:W,list_config_id:B,description:`App configuration for ${J}`,active:!0},L=(await G.post("/api/now/table/sys_ux_app_config",O)).data.result.sys_id;Z.steps_completed.push("App Configuration Created"),Z.sys_ids.app_config_sys_id=L;let q=[],F={experience:W,name:"chrome_tab",value:JSON.stringify({title:J}),type:"object"},P=await G.post("/api/now/table/sys_ux_page_property",F);q.push({name:"chrome_tab",sys_id:P.data.result.sys_id});let A={experience:W,name:"chrome_main",value:JSON.stringify({showLeftNav:!0,leftNavCollapsible:!0,showHeader:!0}),type:"object"},w=await G.post("/api/now/table/sys_ux_page_property",A);if(q.push({name:"chrome_main",sys_id:w.data.result.sys_id}),Z.steps_completed.push("Page Properties Configured"),Z.sys_ids.page_properties=q,Q.length>0){let j=[],E=[];for(let f of Q){let i={name:Ew(f),list_menu_config:B,table:f,order:Q.indexOf(f)*100,active:!0},y=(await G.post("/api/now/table/sys_ux_list_category",i)).data.result.sys_id;j.push({table:f,sys_id:y});let a={name:`All ${Ew(f)}`,category:y,table:f,filter:"",order:100,active:!0},r=await G.post("/api/now/table/sys_ux_list",a);E.push({table:f,category_sys_id:y,list_sys_id:r.data.result.sys_id})}Z.steps_completed.push("List Configuration Created"),Z.sys_ids.list_categories=j,Z.sys_ids.lists=E}let v=Y.route_name||x00(J),T={name:v,route:`/${v}`,experience:W,description:`Route for ${J} workspace`,active:!0},D=await G.post("/api/now/table/sys_ux_app_route",T);return Z.steps_completed.push("App Route Created"),Z.sys_ids.app_route_sys_id=D.data.result.sys_id,N({workspace_name:J,workspace_type:"Now Experience Framework Workspace",all_steps_completed:!0,steps_completed:Z.steps_completed,sys_ids:Z.sys_ids,workspace_url:`/now/experience/${v}`,message:`UX Workspace '${J}' created successfully with complete Now Experience Framework setup`,summary:"Experience  List Menu  App Config  Page Properties  List Configuration  App Route - Complete NXF workspace ready",next_steps:["Access workspace via navigation menu","Configure additional list categories if needed","Customize page properties for specific requirements","Add declarative actions for enhanced functionality"]})}catch(G){return M(G instanceof I?G:G.message)}}function Ew(Y){return Y.replace(/_/g," ").replace(/\b\w/g,(X)=>X.toUpperCase())}function x00(Y){return Y.toLowerCase().replace(/\s+/g,"-")}var _w={name:"snow_create_configurable_agent_workspace",description:"Create Configurable Agent Workspace using UX App architecture (sys_ux_app_route, sys_ux_screen_type). Creates workspace with screen collections for multiple tables.",category:"ui-frameworks",subcategory:"workspace",use_cases:["workspace","agent","screen-collections"],complexity:"intermediate",frequency:"high",permission:"write",allowedRoles:["developer","admin"],inputSchema:{type:"object",properties:{name:{type:"string",description:"Agent workspace name"},description:{type:"string",description:"Workspace description"},tables:{type:"array",items:{type:"string"},description:'Tables for screen collections (e.g., ["incident", "task"])'},application:{type:"string",default:"global",description:"Application scope"}},required:["name","tables"]}};async function bw(Y,X){let{name:J,description:z,tables:Q,application:G="global"}=Y;try{let Z=await x(X),$={workspace_name:J,screen_types:[],app_route_sys_id:""},H=J.toLowerCase().replace(/\s+/g,"-"),W={name:H,route:`/${H}`,route_type:"workspace",description:z||`Agent workspace: ${J}`,application:G,active:!0},K=await Z.post("/api/now/table/sys_ux_app_route",W);$.app_route_sys_id=K.data.result.sys_id;for(let U of Q){let B={name:`${J} - ${F00(U)}`,table:U,app_route:$.app_route_sys_id,description:`Screen collection for ${U}`,active:!0},O=await Z.post("/api/now/table/sys_ux_screen_type",B);$.screen_types.push({table:U,sys_id:O.data.result.sys_id,name:B.name})}return N({created:!0,workspace_name:J,workspace_type:"Configurable Agent Workspace",app_route_sys_id:$.app_route_sys_id,screen_types:$.screen_types,workspace_url:`/now/workspace${W.route}`,tables_configured:Q.length,message:`Agent Workspace '${J}' created successfully with ${Q.length} screen collections`,next_steps:["Configure screen layouts for each table","Add related lists and contextual panels","Customize workspace navigation","Assign workspace to roles/groups"]})}catch(Z){return M(Z instanceof I?Z:Z.message)}}function F00(Y){return Y.replace(/_/g," ").replace(/\b\w/g,(X)=>X.toUpperCase())}var Rw={name:"snow_create_ux_app_config",description:"STEP 2: Create UX App Configuration Record (sys_ux_app_config) - Contains workspace settings and links to the experience from Step 1.",category:"ui-frameworks",subcategory:"workspace",use_cases:["workspace","configuration","ux-experience"],complexity:"intermediate",frequency:"medium",permission:"write",allowedRoles:["developer","admin"],inputSchema:{type:"object",properties:{name:{type:"string",description:'App config name (e.g., "My Workspace Config")'},experience_sys_id:{type:"string",description:"Experience sys_id from Step 1"},description:{type:"string",description:"App configuration description"},list_config_id:{type:"string",description:"List menu configuration sys_id (optional)"}},required:["name","experience_sys_id"]}};async function fw(Y,X){let{name:J,experience_sys_id:z,description:Q,list_config_id:G}=Y;try{let Z=await x(X);if(!(await Z.get(`/api/now/table/sys_ux_experience/${z}`)).data.result)throw new I("VALIDATION_ERROR",`Experience '${z}' not found`,{details:{experience_sys_id:z}});let H={name:J,experience_assoc:z,description:Q||`App configuration for ${J}`,active:!0};if(G)H.list_config_id=G;let K=(await Z.post("/api/now/table/sys_ux_app_config",H)).data.result;return N({created:!0,app_config_sys_id:K.sys_id,name:K.name,experience_sys_id:z,list_config_id:K.list_config_id||null,message:`UX App Configuration '${J}' created successfully`,next_step:"Create Page Macroponent (Step 3) using snow_create_ux_page_macroponent"})}catch(Z){return M(Z instanceof I?Z:Z.message)}}var yw={name:"snow_create_ux_app_route",description:"STEP 5: Create Route Record (sys_ux_app_route) - Defines the URL slug that leads to the page.",category:"ui-frameworks",subcategory:"workspace",use_cases:["workspace","routing","url"],complexity:"beginner",frequency:"medium",permission:"write",allowedRoles:["developer","admin"],inputSchema:{type:"object",properties:{name:{type:"string",description:'Route name - becomes URL slug (e.g., "home")'},app_config_sys_id:{type:"string",description:"App config sys_id from Step 2 (optional)"},experience_sys_id:{type:"string",description:"Experience sys_id (alternative to app_config_sys_id)"},page_sys_name:{type:"string",description:"Page sys_name from Step 4 registry (optional)"},route:{type:"string",description:'URL route path (e.g., "/home")'},description:{type:"string",description:"Route description"}},required:["name"]}};async function hw(Y,X){let{name:J,app_config_sys_id:z,experience_sys_id:Q,page_sys_name:G,route:Z,description:$}=Y;try{let H=await x(X),W={name:J,route:Z||`/${J.toLowerCase().replace(/\s+/g,"-")}`,description:$||`Route for ${J}`,active:!0};if(z)W.app_config=z;if(Q)W.experience=Q;if(G)W.page_sys_name=G;let U=(await H.post("/api/now/table/sys_ux_app_route",W)).data.result;return N({created:!0,route_sys_id:U.sys_id,name:U.name,route:U.route,page_sys_name:U.page_sys_name||null,full_url:`/now/experience${U.route}`,message:`UX App Route '${J}' created successfully`,next_step:"Update App Config landing page (Step 6) using snow_update_ux_app_config_landing_page"})}catch(H){return M(H instanceof I?H:H.message)}}var mw={name:"snow_create_ux_experience",description:"STEP 1: Create UX Experience Record (sys_ux_experience) - The top-level container for the workspace.  REQUIRES: Now Experience Framework (UXF) enabled. ALTERNATIVE: Use traditional form/list configurations if UXF unavailable.",category:"ui-frameworks",subcategory:"workspace",use_cases:["workspace","ux-experience","foundation"],complexity:"beginner",frequency:"high",permission:"write",allowedRoles:["developer","admin"],inputSchema:{type:"object",properties:{name:{type:"string",description:'Experience name (e.g., "My Workspace")'},root_macroponent:{type:"string",description:"Root macroponent sys_id (usually x_snc_app_shell_uib_app_shell, auto-detected if not provided)"},description:{type:"string",description:"Experience description"}},required:["name"]}};async function uw(Y,X){let{name:J,root_macroponent:z,description:Q}=Y;try{let G=await x(X),Z={name:J,description:Q||`UX Experience: ${J}`,active:!0};if(z)Z.root_macroponent=z;let H=(await G.post("/api/now/table/sys_ux_experience",Z)).data.result;return N({created:!0,experience_sys_id:H.sys_id,name:H.name,root_macroponent:H.root_macroponent||null,message:`UX Experience '${J}' created successfully`,next_step:"Create App Configuration (Step 2) using snow_create_ux_app_config",note:"This experience requires Now Experience Framework (UXF) to be enabled"})}catch(G){if(G.message&&G.message.includes("sys_ux_experience"))return M(new I("PLUGIN_MISSING","Now Experience Framework (UXF) plugin not installed or enabled",{details:{plugin:"com.snc.now_experience",suggestion:"Install Now Experience Framework from ServiceNow Store or use traditional form/list configurations",alternative:"Use Service Portal pages or traditional UI pages instead"}}));return M(G instanceof I?G:G.message)}}var gw={name:"snow_create_ux_page_macroponent",description:"STEP 3: Create Page Macroponent Record (sys_ux_macroponent) - Defines the actual page content that will be displayed.",category:"ui-frameworks",subcategory:"workspace",use_cases:["workspace","page","macroponent"],complexity:"intermediate",frequency:"medium",permission:"write",allowedRoles:["developer","admin"],inputSchema:{type:"object",properties:{name:{type:"string",description:'Page macroponent name (e.g., "My Home Page")'},root_component:{type:"string",default:"sn-canvas-panel",description:"Root component to render (default: sn-canvas-panel for simple pages)"},composition:{type:"object",description:"JSON layout configuration (default: simple single column)"},description:{type:"string",description:"Page macroponent description"}},required:["name"]}};async function pw(Y,X){let{name:J,root_component:z="sn-canvas-panel",composition:Q,description:G}=Y;try{let Z=await x(X),H={name:J,root_component:z,composition:JSON.stringify(Q||{layout:"single-column",components:[]}),description:G||`Page macroponent: ${J}`,active:!0},K=(await Z.post("/api/now/table/sys_ux_macroponent",H)).data.result;return N({created:!0,macroponent_sys_id:K.sys_id,name:K.name,root_component:K.root_component,message:`Page Macroponent '${J}' created successfully`,next_step:"Create Page Registry (Step 4) using snow_create_ux_page_registry"})}catch(Z){return M(Z instanceof I?Z:Z.message)}}var cw={name:"snow_create_ux_page_registry",description:"STEP 4: Create Page Registry Record (sys_ux_page_registry) - Registers the page for use within the workspace configuration.",category:"ui-frameworks",subcategory:"workspace",use_cases:["workspace","registry","configuration"],complexity:"intermediate",frequency:"medium",permission:"write",allowedRoles:["developer","admin"],inputSchema:{type:"object",properties:{sys_name:{type:"string",description:'Unique technical name for the page (e.g., "my_home_page")'},app_config_sys_id:{type:"string",description:"App config sys_id from Step 2"},macroponent_sys_id:{type:"string",description:"Macroponent sys_id from Step 3"},description:{type:"string",description:"Page registry description"}},required:["sys_name","app_config_sys_id","macroponent_sys_id"]}};async function dw(Y,X){let{sys_name:J,app_config_sys_id:z,macroponent_sys_id:Q,description:G}=Y;try{let Z=await x(X);if(!(await Z.get(`/api/now/table/sys_ux_app_config/${z}`)).data.result)throw new I("VALIDATION_ERROR",`App Config '${z}' not found`,{details:{app_config_sys_id:z}});if(!(await Z.get(`/api/now/table/sys_ux_macroponent/${Q}`)).data.result)throw new I("VALIDATION_ERROR",`Macroponent '${Q}' not found`,{details:{macroponent_sys_id:Q}});let W={sys_name:J,app_config:z,macroponent:Q,description:G||`Page registry for ${J}`,active:!0},U=(await Z.post("/api/now/table/sys_ux_page_registry",W)).data.result;return N({created:!0,registry_sys_id:U.sys_id,sys_name:U.sys_name,app_config_sys_id:z,macroponent_sys_id:Q,message:`Page Registry '${J}' created successfully`,next_step:"Create Route (Step 5) using snow_create_ux_app_route"})}catch(Z){return M(Z instanceof I?Z:Z.message)}}var lw={name:"snow_discover_all_workspaces",description:"Discover all workspaces (UX Experiences, Agent Workspaces, UI Builder pages) with comprehensive details and usage analytics.",category:"ui-frameworks",subcategory:"workspace",use_cases:["workspace","discovery","analytics"],complexity:"beginner",frequency:"high",permission:"read",allowedRoles:["developer","stakeholder","admin"],inputSchema:{type:"object",properties:{include_ux_experiences:{type:"boolean",default:!0,description:"Include Now Experience Framework workspaces"},include_agent_workspaces:{type:"boolean",default:!0,description:"Include Configurable Agent Workspaces"},include_ui_builder:{type:"boolean",default:!0,description:"Include UI Builder pages"},active_only:{type:"boolean",default:!0,description:"Only show active workspaces"}}}};async function iw(Y,X){let{include_ux_experiences:J=!0,include_agent_workspaces:z=!0,include_ui_builder:Q=!0,active_only:G=!0}=Y;try{let Z=await x(X),$={ux_experiences:[],agent_workspaces:[],ui_builder_pages:[],total_count:0};if(J){let H=G?"active=true":"",W=await Z.get("/api/now/table/sys_ux_experience",{params:{sysparm_query:H,sysparm_limit:50,sysparm_fields:"sys_id,name,description,active"}});if(W.data.result)$.ux_experiences=W.data.result.map((K)=>({type:"UX Experience",name:K.name,sys_id:K.sys_id,description:K.description||"No description",active:K.active,url:`/now/experience/${K.name?.toLowerCase().replace(/\s+/g,"-")}`}))}if(z){let H=G?"active=true^route_type=workspace":"route_type=workspace",W=await Z.get("/api/now/table/sys_ux_app_route",{params:{sysparm_query:H,sysparm_limit:50,sysparm_fields:"sys_id,name,description,route,active"}});if(W.data.result)$.agent_workspaces=W.data.result.map((K)=>({type:"Agent Workspace",name:K.name,sys_id:K.sys_id,description:K.description||"No description",route:K.route,active:K.active,url:`/now/workspace${K.route}`}))}if(Q){let H=G?"active=true":"",W=await Z.get("/api/now/table/sys_ux_page",{params:{sysparm_query:H,sysparm_limit:50,sysparm_fields:"sys_id,name,description,active"}});if(W.data.result)$.ui_builder_pages=W.data.result.map((K)=>({type:"UI Builder Page",name:K.name,sys_id:K.sys_id,description:K.description||"No description",active:K.active}))}return $.total_count=$.ux_experiences.length+$.agent_workspaces.length+$.ui_builder_pages.length,N({discovery:$,summary:{ux_experiences:$.ux_experiences.length,agent_workspaces:$.agent_workspaces.length,ui_builder_pages:$.ui_builder_pages.length,total_workspaces:$.total_count},message:`Found ${$.total_count} workspaces across all types`})}catch(Z){return M(Z instanceof I?Z:Z.message)}}var nw={name:"snow_update_ux_app_config_landing_page",description:"STEP 6: Update App Configuration with Landing Page Route - Sets the default landing page for the workspace.",category:"ui-frameworks",subcategory:"workspace",use_cases:["workspace","configuration","landing-page"],complexity:"beginner",frequency:"low",permission:"write",allowedRoles:["developer","admin"],inputSchema:{type:"object",properties:{app_config_sys_id:{type:"string",description:"App config sys_id from Step 2"},route_name:{type:"string",description:"Route name from Step 5"}},required:["app_config_sys_id","route_name"]}};async function ow(Y,X){let{app_config_sys_id:J,route_name:z}=Y;try{let Q=await x(X);if(!(await Q.get(`/api/now/table/sys_ux_app_config/${J}`)).data.result)throw new I("VALIDATION_ERROR",`App Config '${J}' not found`,{details:{app_config_sys_id:J}});let Z={landing_page:z},H=(await Q.patch(`/api/now/table/sys_ux_app_config/${J}`,Z)).data.result;return N({updated:!0,app_config_sys_id:H.sys_id,landing_page:H.landing_page,message:`App Configuration landing page set to '${z}'`,workspace_complete:!0,summary:"All 6 steps completed! Your UX workspace is now fully configured and ready to use."})}catch(Q){return M(Q instanceof I?Q:Q.message)}}var aw={name:"snow_validate_workspace_configuration",description:"Validate workspace configuration for completeness, best practices, and potential issues across all workspace types.",category:"ui-frameworks",subcategory:"workspace",use_cases:["workspace","validation","quality"],complexity:"advanced",frequency:"medium",permission:"read",allowedRoles:["developer","stakeholder","admin"],inputSchema:{type:"object",properties:{workspace_sys_id:{type:"string",description:"Workspace sys_id to validate"},workspace_type:{type:"string",enum:["ux_experience","agent_workspace","ui_builder"],description:"Type of workspace to validate"},check_performance:{type:"boolean",default:!0,description:"Include performance analysis"},check_security:{type:"boolean",default:!0,description:"Include security validation"}},required:["workspace_sys_id","workspace_type"]}};async function sw(Y,X){let{workspace_sys_id:J,workspace_type:z,check_performance:Q=!0,check_security:G=!0}=Y;try{let Z=await x(X),$={workspace_sys_id:J,workspace_type:z,issues:[],warnings:[],recommendations:[],score:0,max_score:100};if(z==="ux_experience"){let W=await Z.get(`/api/now/table/sys_ux_experience/${J}`);if(!W.data.result)throw new I("VALIDATION_ERROR",`Experience '${J}' not found`,{details:{workspace_sys_id:J}});if(!W.data.result.active)$.issues.push("Experience is not active");else $.score+=25;let U=await Z.get("/api/now/table/sys_ux_app_config",{params:{sysparm_query:`experience_assoc=${J}`,sysparm_limit:1}});if(!U.data.result||U.data.result.length===0)$.issues.push("No app configuration found for experience");else if($.score+=25,!U.data.result[0].list_config_id)$.warnings.push("No list configuration linked to app config");else $.score+=25;let B=await Z.get("/api/now/table/sys_ux_page_property",{params:{sysparm_query:`experience=${J}`,sysparm_limit:10}});if(B.data.result&&B.data.result.length>0)$.score+=25;else $.warnings.push("No page properties configured (chrome_tab, chrome_main)")}else if(z==="agent_workspace"){let W=await Z.get(`/api/now/table/sys_ux_app_route/${J}`);if(!W.data.result)throw new I("VALIDATION_ERROR",`Agent Workspace route '${J}' not found`,{details:{workspace_sys_id:J}});let K=W.data.result;if(!K.active)$.issues.push("Workspace route is not active");else $.score+=30;let U=await Z.get("/api/now/table/sys_ux_screen_type",{params:{sysparm_query:`app_route=${J}`,sysparm_limit:10}});if(U.data.result&&U.data.result.length>0){if($.score+=40,U.data.result.length===1)$.warnings.push("Only one screen type configured - consider adding more for better functionality")}else $.issues.push("No screen types configured for agent workspace");if(!K.route||!K.route.startsWith("/"))$.warnings.push("Route format should start with /");else $.score+=30}else if(z==="ui_builder"){let W=await Z.get(`/api/now/table/sys_ux_page/${J}`);if(!W.data.result)throw new I("VALIDATION_ERROR",`UI Builder page '${J}' not found`,{details:{workspace_sys_id:J}});let K=W.data.result;if(!K.active)$.issues.push("UI Builder page is not active");else $.score+=50;if(K.name&&K.title)$.score+=50;else $.warnings.push("Page should have both name and title configured")}if(Q&&$.score>50)$.recommendations.push("Consider enabling caching for better performance"),$.recommendations.push("Add loading indicators for better user experience"),$.recommendations.push("Optimize queries to reduce page load time");if(G)$.recommendations.push("Review access controls and role requirements"),$.recommendations.push("Validate data privacy settings for workspace"),$.recommendations.push("Ensure sensitive data is properly masked");let H="excellent";if($.issues.length>0)H="critical";else if($.warnings.length>2)H="needs_improvement";else if($.score<75)H="good";return N({validation:{...$,status:H,passed:$.issues.length===0},summary:{score:`${$.score}/${$.max_score}`,status:H,issues_count:$.issues.length,warnings_count:$.warnings.length,recommendations_count:$.recommendations.length},message:$.issues.length===0?`Workspace validation passed with score ${$.score}/${$.max_score}`:`Workspace validation found ${$.issues.length} critical issues`})}catch(Z){return M(Z instanceof I?Z:Z.message)}}var HG={};G0(HG,{snow_create_template_exec:()=>tw,snow_create_template_def:()=>rw,snow_apply_template_exec:()=>YT,snow_apply_template_def:()=>ew});var rw={name:"snow_create_template",description:"Create record template",category:"development",subcategory:"templates",use_cases:["template-creation","record-templates","automation"],complexity:"beginner",frequency:"low",permission:"write",allowedRoles:["developer","admin"],inputSchema:{type:"object",properties:{name:{type:"string",description:"Template name"},table:{type:"string",description:"Table name"},template:{type:"object",description:"Template field values"},active:{type:"boolean",default:!0}},required:["name","table","template"]}};async function tw(Y,X){let{name:J,table:z,template:Q,active:G=!0}=Y;try{let Z=await x(X),$={name:J,table:z,template:JSON.stringify(Q),active:G},H=await Z.post("/api/now/table/sys_template",$);return N({created:!0,template:H.data.result})}catch(Z){return M(Z.message)}}var ew={name:"snow_apply_template",description:"Apply template to create record",category:"core-operations",subcategory:"crud",use_cases:["templates","record-creation","automation"],complexity:"beginner",frequency:"medium",permission:"write",allowedRoles:["developer","admin"],inputSchema:{type:"object",properties:{template_sys_id:{type:"string",description:"Template sys_id"},additional_values:{type:"object",description:"Additional field values"}},required:["template_sys_id"]}};async function YT(Y,X){let{template_sys_id:J,additional_values:z={}}=Y;try{let Q=await x(X),G=await Q.get(`/api/now/table/sys_template/${J}`),Z=G.data.result.table,H={...JSON.parse(G.data.result.template),...z},W=await Q.post(`/api/now/table/${Z}`,H);return N({created:!0,record:W.data.result})}catch(Q){return M(Q.message)}}var WG={};G0(WG,{snow_create_schedule_exec:()=>JT,snow_create_schedule_def:()=>XT,snow_add_schedule_entry_exec:()=>QT,snow_add_schedule_entry_def:()=>zT});var XT={name:"snow_create_schedule",description:"Create work schedule",category:"automation",subcategory:"scheduling",use_cases:["schedules","work-hours","sla"],complexity:"intermediate",frequency:"low",permission:"write",allowedRoles:["developer","admin"],inputSchema:{type:"object",properties:{name:{type:"string",description:"Schedule name"},time_zone:{type:"string",description:"Time zone"},type:{type:"string",enum:["weekly","monthly","custom"],default:"weekly"}},required:["name"]}};async function JT(Y,X){let{name:J,time_zone:z,type:Q="weekly"}=Y;try{let G=await x(X),Z={name:J,type:Q};if(z)Z.time_zone=z;let $=await G.post("/api/now/table/cmn_schedule",Z);return N({created:!0,schedule:$.data.result})}catch(G){return M(G.message)}}var zT={name:"snow_add_schedule_entry",description:"Add entry to schedule",category:"automation",subcategory:"scheduling",use_cases:["schedules","work-hours","calendar"],complexity:"intermediate",frequency:"medium",permission:"write",allowedRoles:["developer","admin"],inputSchema:{type:"object",properties:{schedule_sys_id:{type:"string",description:"Schedule sys_id"},name:{type:"string",description:"Entry name"},type:{type:"string",enum:["include","exclude"],default:"include"},start_date_time:{type:"string",description:"Start date time"},end_date_time:{type:"string",description:"End date time"}},required:["schedule_sys_id","name"]}};async function QT(Y,X){let{schedule_sys_id:J,name:z,type:Q="include",start_date_time:G,end_date_time:Z}=Y;try{let $=await x(X),H={schedule:J,name:z,type:Q};if(G)H.start_date_time=G;if(Z)H.end_date_time=Z;let W=await $.post("/api/now/table/cmn_schedule_span",H);return N({added:!0,entry:W.data.result})}catch($){return M($.message)}}var KG={};G0(KG,{snow_create_variable_set_exec:()=>HT,snow_create_variable_set_def:()=>$T,snow_create_variable_exec:()=>ZT,snow_create_variable_def:()=>GT});var GT={name:"snow_create_variable",description:"Create catalog variable",category:"itsm",subcategory:"catalog",use_cases:["catalog-variables","service-catalog","form-fields"],complexity:"beginner",frequency:"high",permission:"write",allowedRoles:["developer","admin"],inputSchema:{type:"object",properties:{name:{type:"string",description:"Variable name"},question_text:{type:"string",description:"Question text"},type:{type:"string",enum:["string","multi_line_text","select_box","checkbox","reference"],default:"string"},mandatory:{type:"boolean",default:!1},order:{type:"number",description:"Display order"}},required:["name","question_text"]}};async function ZT(Y,X){let{name:J,question_text:z,type:Q="string",mandatory:G=!1,order:Z}=Y;try{let $=await x(X),H={name:J,question_text:z,type:Q,mandatory:G};if(Z!==void 0)H.order=Z;let W=await $.post("/api/now/table/item_option_new",H);return N({created:!0,variable:W.data.result})}catch($){return M($.message)}}var $T={name:"snow_create_variable_set",description:"Create reusable variable set",category:"itsm",subcategory:"catalog",use_cases:["variable-sets","service-catalog","form-templates"],complexity:"beginner",frequency:"medium",permission:"write",allowedRoles:["developer","admin"],inputSchema:{type:"object",properties:{title:{type:"string",description:"Variable set title"},description:{type:"string",description:"Description"},internal_name:{type:"string",description:"Internal name"}},required:["title","internal_name"]}};async function HT(Y,X){let{title:J,description:z,internal_name:Q}=Y;try{let G=await x(X),Z={title:J,internal_name:Q};if(z)Z.description=z;let $=await G.post("/api/now/table/item_option_new_set",Z);return N({created:!0,variable_set:$.data.result})}catch(G){return M(G.message)}}var UG={};G0(UG,{snow_widget_test_exec:()=>qT,snow_widget_test_def:()=>NT,snow_validate_widget_coherence_exec:()=>LT,snow_validate_widget_coherence_def:()=>MT,snow_validate_sysid_exec:()=>OT,snow_validate_sysid_def:()=>VT,snow_validate_record_exec:()=>KT,snow_validate_record_def:()=>WT,snow_validate_field_exec:()=>BT,snow_validate_field_def:()=>UT});var WT={name:"snow_validate_record",description:"Validate record against business rules",category:"development",subcategory:"validation",use_cases:["record-validation","business-rules","validation"],complexity:"beginner",frequency:"medium",permission:"read",allowedRoles:["developer","stakeholder","admin"],inputSchema:{type:"object",properties:{table:{type:"string",description:"Table name"},record_sys_id:{type:"string",description:"Record sys_id"}},required:["table","record_sys_id"]}};async function KT(Y,X){let{table:J,record_sys_id:z}=Y;try{let Q=await x(X),G=`
var gr = new GlideRecord('${J}');
if (gr.get('${z}')) {
  var isValid = gr.isValidRecord();
  gs.info('Record valid: ' + isValid);
}
    `;return await Q.post("/api/now/table/sys_script_execution",{script:G}),N({validated:!0,table:J,record_sys_id:z})}catch(Q){return M(Q.message)}}var UT={name:"snow_validate_field",description:"Validate field value",category:"development",subcategory:"validation",use_cases:["field-validation","data-validation","validation"],complexity:"beginner",frequency:"medium",permission:"read",allowedRoles:["developer","stakeholder","admin"],inputSchema:{type:"object",properties:{table:{type:"string",description:"Table name"},field:{type:"string",description:"Field name"},value:{type:"string",description:"Value to validate"}},required:["table","field","value"]}};async function BT(Y,X){let{table:J,field:z,value:Q}=Y;try{let Z=await(await x(X)).get("/api/now/table/sys_dictionary",{params:{sysparm_query:`name=${J}^element=${z}`,sysparm_limit:1}});if(Z.data.result.length===0)return M("Field not found");let $=Z.data.result[0];return N({valid:!0,table:J,field:z,value:Q,field_type:$.internal_type})}catch(G){return M(G.message)}}var VT={name:"snow_validate_sysid",description:"Validates sys_id existence and consistency across tables. Maintains artifact tracking for deployment integrity and rollback capabilities.",category:"development",subcategory:"validation",use_cases:["sysid-validation","integrity-check","validation"],complexity:"beginner",frequency:"medium",permission:"read",allowedRoles:["developer","stakeholder","admin"],inputSchema:{type:"object",properties:{sys_id:{type:"string",description:"Sys ID to validate"},table:{type:"string",description:"Expected table name"},name:{type:"string",description:"Expected artifact name"},type:{type:"string",description:"Expected artifact type"}},required:["sys_id","table"]}};async function OT(Y,X){let{sys_id:J,table:z,name:Q,type:G}=Y;try{let Z=await x(X);if(!/^[0-9a-f]{32}$/i.test(J))throw new I("INVALID_REQUEST",`Invalid sys_id format: ${J}. Expected 32-character hex string.`,{retryable:!1});let H=await Z.get(`/api/now/table/${z}/${J}`);if(!H.data.result)throw new I("RESOURCE_NOT_FOUND",`Record not found in table ${z} with sys_id: ${J}`,{retryable:!1});let W=H.data.result,K={sys_id_valid:!0,exists:!0,table:z,sys_id:J,record_info:{name:W.name||W.id||W.title||"N/A",sys_created_on:W.sys_created_on,sys_updated_on:W.sys_updated_on,sys_created_by:W.sys_created_by}};if(Q){let B=W.name||W.id||W.title;if(K.name_match=B===Q,!K.name_match)K.name_mismatch={expected:Q,actual:B}}if(G)K.type=G,K.type_match=!0;try{let B=await Z.get("/api/now/table/sys_update_xml",{params:{sysparm_query:`target_name=${J}`,sysparm_limit:5,sysparm_fields:"name,type,update_set"}});K.update_set_tracking={tracked:B.data.result.length>0,update_sets:B.data.result}}catch(B){K.update_set_tracking={tracked:!1,note:"Could not check update set tracking"}}let U=` Sys ID Validation

`+`Sys ID: ${J}
Table: ${z}
Exists: ${K.exists?"Yes":"No"}
Name: ${K.record_info.name}
Created: ${K.record_info.sys_created_on}
Created By: ${K.record_info.sys_created_by}
`+(K.name_match!==void 0?`Name Match: ${K.name_match?"Yes":"No"}
`:"")+`Update Set Tracking: ${K.update_set_tracking.tracked?"Yes":"No"}`;return N(K,{message:U})}catch(Z){return M(Z instanceof I?Z:new I("NETWORK_ERROR",`Validation failed: ${Z.message}`,{originalError:Z}))}}var MT={name:"snow_validate_widget_coherence",description:"Validates widget coherence by analyzing server/client/HTML component communication. Checks data bindings, action handlers, and method implementations to ensure all parts work together correctly.",category:"development",subcategory:"validation",use_cases:["widget-validation","coherence-check","testing"],complexity:"intermediate",frequency:"medium",permission:"read",allowedRoles:["developer","stakeholder","admin"],inputSchema:{type:"object",properties:{sys_id:{type:"string",description:"Widget sys_id to validate (optional if providing code)"},template:{type:"string",description:"HTML template code (optional if using sys_id)"},css:{type:"string",description:"CSS styles (optional)"},client_script:{type:"string",description:"Client controller script (optional)"},server_script:{type:"string",description:"Server script (optional)"},option_schema:{type:"string",description:"Widget options schema JSON"},validation_mode:{type:"string",enum:["full","template_only","data_only"],description:"Validation mode: full (all components), template_only (HTML bindings), data_only (server data)",default:"full"}}}};async function LT(Y,X){let{sys_id:J,template:z,css:Q,client_script:G,server_script:Z,option_schema:$,validation_mode:H="full"}=Y;try{let W=await x(X),K={};if(J){let V=await W.get(`/api/now/table/sp_widget/${J}`);if(!V.data.result)throw new I("RESOURCE_NOT_FOUND",`Widget not found: ${J}`,{retryable:!1});K=V.data.result}else K={template:z||"",css:Q||"",client_script:G||"",script:Z||"",option_schema:$||""};let U={widget_name:K.name||K.id||"Widget",validation_mode:H,components:{}};if(H==="full"||H==="template_only")U.components.template={html:K.template,line_count:K.template?.split(`
`).length||0,data_bindings:P00(K.template||""),ng_directives:A00(K.template||"")};if(K.css)U.components.css={styles:K.css,line_count:K.css.split(`
`).length,classes:w00(K.css)};if(H==="full"||H==="data_only"){if(K.script)U.components.server_script={code:K.script,line_count:K.script.split(`
`).length,data_properties:T00(K.script),input_actions:I00(K.script)}}if(H==="full"&&K.client_script)U.components.client_script={code:K.client_script,line_count:K.client_script.split(`
`).length,methods:v00(K.client_script),server_calls:D00(K.client_script)};let B=j00(U.components);U.coherence=B;let O=`\uD83D\uDD0D Widget Coherence Validation

`+`Name: ${U.widget_name}
Mode: ${H}

Components Analyzed:
`+(U.components.template?`- Template: ${U.components.template.line_count} lines, ${U.components.template.data_bindings.length} data bindings
`:"")+(U.components.css?`- CSS: ${U.components.css.line_count} lines, ${U.components.css.classes.length} classes
`:"")+(U.components.server_script?`- Server: ${U.components.server_script.line_count} lines, ${U.components.server_script.data_properties.length} data properties
`:"")+(U.components.client_script?`- Client: ${U.components.client_script.line_count} lines, ${U.components.client_script.methods.length} methods
`:"")+`
Coherence: ${B.coherent?" Valid":" Issues Found"}`+(B.issues.length>0?`

Issues:
${B.issues.map((V)=>`- ${V}`).join(`
`)}`:"");return N(U,{message:O})}catch(W){return M(W instanceof I?W:new I("NETWORK_ERROR",`Validation failed: ${W.message}`,{originalError:W}))}}function P00(Y){let X=[],J=/\{\{data\.(\w+)\}\}/g,z;while((z=J.exec(Y))!==null)if(!X.includes(z[1]))X.push(z[1]);return X}function A00(Y){let X=[],J=/ng-(\w+)=/g,z;while((z=J.exec(Y))!==null)if(!X.includes(`ng-${z[1]}`))X.push(`ng-${z[1]}`);return X}function w00(Y){let X=[],J=/\.([a-zA-Z][a-zA-Z0-9_-]*)/g,z;while((z=J.exec(Y))!==null)if(!X.includes(z[1]))X.push(z[1]);return X}function T00(Y){let X=[],J=/data\.(\w+)\s*=/g,z;while((z=J.exec(Y))!==null)if(!X.includes(z[1]))X.push(z[1]);return X}function I00(Y){let X=[],J=/input\.action\s*===?\s*['"](\w+)['"]/g,z;while((z=J.exec(Y))!==null)if(!X.includes(z[1]))X.push(z[1]);return X}function v00(Y){let X=[],J=/(?:c|$scope)\.(\w+)\s*=\s*function/g,z;while((z=J.exec(Y))!==null)if(!X.includes(z[1]))X.push(z[1]);return X}function D00(Y){let X=[],J=/c\.server\.get\(\s*\{\s*action:\s*['"](\w+)['"]/g,z;while((z=J.exec(Y))!==null)if(!X.includes(z[1]))X.push(z[1]);return X}function j00(Y){let X=[];if(Y.template&&Y.server_script){let J=Y.template.data_bindings||[],z=Y.server_script.data_properties||[];for(let Q of J)if(!z.includes(Q))X.push(`Template references data.${Q} but server doesn't initialize it`)}if(Y.client_script&&Y.server_script){let J=Y.client_script.server_calls||[],z=Y.server_script.input_actions||[];for(let Q of J)if(!z.includes(Q))X.push(`Client calls action '${Q}' but server doesn't handle it`)}return{coherent:X.length===0,issues:X}}var NT={name:"snow_widget_test",description:"Executes comprehensive widget testing with multiple data scenarios. Validates client/server scripts, API calls, dependencies, and generates coverage reports.",category:"development",subcategory:"validation",use_cases:["widget-testing","testing","validation"],complexity:"intermediate",frequency:"medium",permission:"read",allowedRoles:["developer","stakeholder","admin"],inputSchema:{type:"object",properties:{sys_id:{type:"string",description:"Widget sys_id to test"},test_scenarios:{type:"array",description:"Array of test scenarios with input data and expected outputs",items:{type:"object",properties:{name:{type:"string",description:"Test scenario name"},input:{type:"object",description:"Input data for the test"},expected:{type:"object",description:"Expected output (optional)"},options:{type:"object",description:"Widget instance options"}}}},coverage:{type:"boolean",description:"Check code coverage for HTML/CSS/JS integration",default:!0},validate_dependencies:{type:"boolean",description:"Check for missing dependencies like Chart.js",default:!0}},required:["sys_id"]}};async function qT(Y,X){let{sys_id:J,test_scenarios:z=[],coverage:Q=!0,validate_dependencies:G=!0}=Y;try{let $=await(await x(X)).get(`/api/now/table/sp_widget/${J}`);if(!$.data.result)throw new I("RESOURCE_NOT_FOUND",`Widget not found: ${J}`,{retryable:!1});let H=$.data.result,W={widget_name:H.name||H.id,sys_id:J,timestamp:new Date().toISOString(),scenarios:[],coverage_report:null,dependency_check:null};for(let V of z){let L={name:V.name,passed:!1,errors:[]};try{if(H.script){if(H.script.includes("input.")&&!V.input)L.errors.push("Server script expects input but none provided");if(H.script.includes("const ")||H.script.includes("let "))L.errors.push("Server script uses ES6+ syntax (const/let) - not supported in ServiceNow")}if(H.client_script){if(!H.client_script.includes("function")&&!H.client_script.includes("=>"))L.errors.push("Client script may be empty or malformed")}if(H.template){if(V.expected){for(let q of Object.keys(V.expected))if(!H.template.includes(`data.${q}`))L.errors.push(`Expected data.${q} not found in template`)}}L.passed=L.errors.length===0}catch(q){L.passed=!1,L.errors.push(q.message)}W.scenarios.push(L)}if(Q){let V={template_coverage:H.template?100:0,server_coverage:H.script?100:0,client_coverage:H.client_script?100:0,css_coverage:H.css?100:0,data_bindings:C00(H.template||""),server_properties:E00(H.script||""),binding_coverage:0};if(V.data_bindings.length>0){let L=V.data_bindings.filter((q)=>V.server_properties.includes(q)).length;V.binding_coverage=Math.round(L/V.data_bindings.length*100)}else V.binding_coverage=100;W.coverage_report=V}if(G){let V={chart_js:H.template?.includes("chart")||H.client_script?.includes("Chart"),jquery:H.client_script?.includes("$")||H.client_script?.includes("jQuery"),angular:H.template?.includes("ng-")||H.client_script?.includes("$scope"),sp_api:H.client_script?.includes("spUtil")||H.client_script?.includes("spModal")};W.dependency_check=V}let K=W.scenarios.length,U=W.scenarios.filter((V)=>V.passed).length,B=K>0?Math.round(U/K*100):0,O=`\uD83E\uDDEA Widget Test Results

`+`Widget: ${W.widget_name}
Test Scenarios: ${U}/${K} passed (${B}%)

`+(W.coverage_report?`Coverage:
- Data Binding: ${W.coverage_report.binding_coverage}%
- Template: ${W.coverage_report.template_coverage}%
- Server: ${W.coverage_report.server_coverage}%
- Client: ${W.coverage_report.client_coverage}%

`:"")+`Scenarios:
${W.scenarios.map((V)=>`${V.passed?"":""} ${V.name}${V.errors.length>0?`: ${V.errors.join(", ")}`:""}`).join(`
`)}`;return N(W,{message:O})}catch(Z){return M(Z instanceof I?Z:new I("NETWORK_ERROR",`Widget test failed: ${Z.message}`,{originalError:Z}))}}function C00(Y){let X=[],J=/\{\{data\.(\w+)\}\}/g,z;while((z=J.exec(Y))!==null)if(!X.includes(z[1]))X.push(z[1]);return X}function E00(Y){let X=[],J=/data\.(\w+)\s*=/g,z;while((z=J.exec(Y))!==null)if(!X.includes(z[1]))X.push(z[1]);return X}var BG={};G0(BG,{snow_test_connection_exec:()=>FT,snow_test_connection_def:()=>xT,snow_get_instance_info_exec:()=>TT,snow_get_instance_info_def:()=>wT,snow_configure_connection_exec:()=>AT,snow_configure_connection_def:()=>PT,snow_check_health_exec:()=>vT,snow_check_health_def:()=>IT,snow_batch_request_exec:()=>jT,snow_batch_request_def:()=>DT});var xT={name:"snow_test_connection",description:"Test ServiceNow connection",category:"integration",subcategory:"connectors",use_cases:["connection-test","authentication","diagnostics"],complexity:"beginner",frequency:"high",permission:"read",allowedRoles:["developer","stakeholder","admin"],inputSchema:{type:"object",properties:{}}};async function FT(Y,X){try{let Q=(await(await x(X)).get("/api/now/table/sys_user",{params:{sysparm_limit:1}}))?.data?.result;if(!Q)return N({connected:!0,instance:X.instanceUrl,message:"Connection successful but no user data returned",user_count:0});return N({connected:!0,instance:X.instanceUrl,user_count:Array.isArray(Q)?Q.length:1})}catch(J){return M(J.message||"Connection failed")}}var PT={name:"snow_configure_connection",description:"Configure ServiceNow connection alias",category:"integration",subcategory:"connectors",use_cases:["connection-config","multi-instance","configuration"],complexity:"intermediate",frequency:"low",permission:"write",allowedRoles:["developer","admin"],inputSchema:{type:"object",properties:{name:{type:"string",description:"Connection alias name"},instance_url:{type:"string",description:"Instance URL"},description:{type:"string",description:"Connection description"}},required:["name","instance_url"]}};async function AT(Y,X){let{name:J,instance_url:z,description:Q}=Y;try{return N({configured:!0,name:J,instance_url:z,description:Q||"ServiceNow connection"})}catch(G){return M(G.message)}}var wT={name:"snow_get_instance_info",description:"Get ServiceNow instance information",category:"core-operations",subcategory:"discovery",use_cases:["instance-info","version-check","diagnostics"],complexity:"beginner",frequency:"medium",permission:"read",allowedRoles:["developer","stakeholder","admin"],inputSchema:{type:"object",properties:{}}};async function TT(Y,X){try{let z=await(await x(X)).get("/api/now/table/sys_properties",{params:{sysparm_query:"name=instance.name^ORname=glide.product.version",sysparm_limit:10}});return N({instance_url:X.instanceUrl,properties:z.data.result})}catch(J){return M(J.message)}}var IT={name:"snow_check_health",description:"Check ServiceNow instance health",category:"advanced",subcategory:"monitoring",use_cases:["health-check","monitoring","diagnostics"],complexity:"beginner",frequency:"high",permission:"read",allowedRoles:["developer","stakeholder","admin"],inputSchema:{type:"object",properties:{}}};async function vT(Y,X){try{let J=await x(X),z=Date.now();await J.get("/api/now/table/sys_user",{params:{sysparm_limit:1}});let Q=Date.now()-z;return N({healthy:!0,response_time_ms:Q,status:Q<1000?"good":Q<3000?"fair":"slow"})}catch(J){return M(J.message)}}var DT={name:"snow_batch_request",description:"Execute batch REST requests",category:"integration",subcategory:"connectors",use_cases:["batch-requests","bulk-operations","performance"],complexity:"intermediate",frequency:"medium",permission:"write",allowedRoles:["developer","admin"],inputSchema:{type:"object",properties:{requests:{type:"array",items:{type:"object",properties:{method:{type:"string",enum:["GET","POST","PUT","PATCH","DELETE"]},url:{type:"string"},body:{type:"object"}}},description:"Array of requests"}},required:["requests"]}};async function jT(Y,X){let{requests:J}=Y;try{let z=await x(X),Q={batch_request_id:`batch_${Date.now()}`,rest_requests:J},G=await z.post("/api/now/v1/batch",Q);return N({executed:!0,batch_id:Q.batch_request_id,results:G.data.result})}catch(z){return M(z.message)}}var CT={};var VG={};G0(VG,{snow_exception_handler_exec:()=>RT,snow_exception_handler_def:()=>bT,snow_event_handler_exec:()=>_T,snow_event_handler_def:()=>kT,snow_error_handler_exec:()=>ST,snow_error_handler_def:()=>ET,snow_callback_handler_exec:()=>yT,snow_callback_handler_def:()=>fT});var ET={name:"snow_error_handler",description:"Create error handler",category:"development",subcategory:"error-handling",use_cases:["error-handling","debugging","logging"],complexity:"intermediate",frequency:"medium",permission:"read",allowedRoles:["developer","stakeholder","admin"],inputSchema:{type:"object",properties:{name:{type:"string",description:"Handler name"},error_type:{type:"string",description:"Error type to handle"},handler_script:{type:"string",description:"Handler script (ES5 only!)"}},required:["name","error_type","handler_script"]}};async function ST(Y,X){let{name:J,error_type:z,handler_script:Q}=Y;try{let G=await x(X),Z={name:J,type:z,script:Q,active:!0},$=await G.post("/api/now/table/sys_error_handler",Z);return N({created:!0,handler:$.data.result})}catch(G){return M(G.message)}}var kT={name:"snow_event_handler",description:"Create event handler",category:"automation",subcategory:"event-management",use_cases:["events","handlers","automation"],complexity:"intermediate",frequency:"medium",permission:"read",allowedRoles:["developer","stakeholder","admin"],inputSchema:{type:"object",properties:{name:{type:"string",description:"Handler name"},event_name:{type:"string",description:"Event name to handle"},script:{type:"string",description:"Handler script (ES5 only!)"}},required:["name","event_name","script"]}};async function _T(Y,X){let{name:J,event_name:z,script:Q}=Y;try{let G=await x(X),Z={name:J,event_name:z,script:Q,active:!0},$=await G.post("/api/now/table/sysevent_script_action",Z);return N({created:!0,event_handler:$.data.result})}catch(G){return M(G.message)}}var bT={name:"snow_exception_handler",description:"Handle exceptions with logging",category:"development",subcategory:"error-handling",use_cases:["exceptions","logging","debugging"],complexity:"beginner",frequency:"high",permission:"read",allowedRoles:["developer","stakeholder","admin"],inputSchema:{type:"object",properties:{exception_message:{type:"string",description:"Exception message"},severity:{type:"string",enum:["info","warning","error","critical"],default:"error"},source:{type:"string",description:"Exception source"}},required:["exception_message"]}};async function RT(Y,X){let{exception_message:J,severity:z="error",source:Q}=Y;try{let G=await x(X),Z={message:J,severity:z,type:"exception"};if(Q)Z.source=Q;let $=await G.post("/api/now/table/syslog",Z);return N({logged:!0,exception:$.data.result})}catch(G){return M(G.message)}}var fT={name:"snow_callback_handler",description:"Create callback handler for async operations",category:"automation",subcategory:"callbacks",use_cases:["callbacks","async","integration"],complexity:"intermediate",frequency:"low",permission:"read",allowedRoles:["developer","stakeholder","admin"],inputSchema:{type:"object",properties:{name:{type:"string",description:"Callback name"},callback_url:{type:"string",description:"Callback URL"},http_method:{type:"string",enum:["POST","PUT","PATCH"],default:"POST"}},required:["name","callback_url"]}};async function yT(Y,X){let{name:J,callback_url:z,http_method:Q="POST"}=Y;try{return N({configured:!0,name:J,callback_url:z,http_method:Q})}catch(G){return M(G.message)}}var OG={};G0(OG,{snow_query_filter_exec:()=>mT,snow_query_filter_def:()=>hT,snow_field_filter_exec:()=>cT,snow_field_filter_def:()=>pT,snow_date_filter_exec:()=>gT,snow_date_filter_def:()=>uT,snow_create_saved_filter_exec:()=>lT,snow_create_saved_filter_def:()=>dT});var hT={name:"snow_query_filter",description:"Build ServiceNow encoded query filter",category:"advanced",subcategory:"data-utilities",use_cases:["filtering","encoded-queries","query-building"],complexity:"intermediate",frequency:"high",permission:"read",allowedRoles:["developer","stakeholder","admin"],inputSchema:{type:"object",properties:{conditions:{type:"array",items:{type:"object",properties:{field:{type:"string"},operator:{type:"string",enum:["=","!=",">","<",">=","<=","LIKE","IN","STARTSWITH","ENDSWITH"]},value:{type:"string"}}},description:"Filter conditions"},logic:{type:"string",enum:["AND","OR"],default:"AND"}},required:["conditions"]}};async function mT(Y,X){let{conditions:J,logic:z="AND"}=Y;try{let Q=z==="AND"?"^":"^OR",G=J.map((Z)=>`${Z.field}${Z.operator}${Z.value}`).join(Q);return N({query:G,conditions:J.length,logic:z})}catch(Q){return M(Q.message)}}var uT={name:"snow_date_filter",description:"Build date-based query filter",category:"advanced",subcategory:"data-utilities",use_cases:["filtering","date-queries","query-building"],complexity:"beginner",frequency:"medium",permission:"read",allowedRoles:["developer","stakeholder","admin"],inputSchema:{type:"object",properties:{field:{type:"string",description:"Date field name"},relative:{type:"string",enum:["today","yesterday","thisWeek","lastWeek","thisMonth","lastMonth"],description:"Relative date"},start_date:{type:"string",description:"Start date (YYYY-MM-DD)"},end_date:{type:"string",description:"End date (YYYY-MM-DD)"}},required:["field"]}};async function gT(Y,X){let{field:J,relative:z,start_date:Q,end_date:G}=Y;try{let Z="";if(z)Z={today:`${J}ON Today`,yesterday:`${J}ON Yesterday`,thisWeek:`${J}ON This week`,lastWeek:`${J}ON Last week`,thisMonth:`${J}ON This month`,lastMonth:`${J}ON Last month`}[z]||"";else if(Q&&G)Z=`${J}BETWEEN${Q}@${G}`;else if(Q)Z=`${J}>=${Q}`;else if(G)Z=`${J}<=${G}`;return N({query:Z,field:J,type:z?"relative":"absolute"})}catch(Z){return M(Z.message)}}var pT={name:"snow_field_filter",description:"Create field-based filter",category:"advanced",subcategory:"data-utilities",use_cases:["filtering","field-queries","query-building"],complexity:"beginner",frequency:"medium",permission:"read",allowedRoles:["developer","stakeholder","admin"],inputSchema:{type:"object",properties:{field:{type:"string",description:"Field name"},values:{type:"array",items:{type:"string"},description:"Values to filter"},match_type:{type:"string",enum:["exact","contains","startsWith","endsWith"],default:"exact"}},required:["field","values"]}};async function cT(Y,X){let{field:J,values:z,match_type:Q="exact"}=Y;try{let Z={exact:"=",contains:"LIKE",startsWith:"STARTSWITH",endsWith:"ENDSWITH"}[Q],$=z.map((H)=>`${J}${Z}${H}`).join("^OR");return N({query:$,field:J,match_type:Q,value_count:z.length})}catch(G){return M(G.message)}}var dT={name:"snow_create_saved_filter",description:"Create a saved filter for any ServiceNow table that appears in the filter dropdown",category:"development",subcategory:"ui",use_cases:["filters","saved-filters","list-views","ui-customization"],complexity:"beginner",frequency:"high",permission:"write",allowedRoles:["developer","admin"],inputSchema:{type:"object",properties:{name:{type:"string",description:'Filter name that appears in the dropdown (e.g., "My Active High Priority Items")'},table:{type:"string",description:'Table name this filter applies to (e.g., "incident", "change_request")'},filter:{type:"string",description:'Encoded query string (e.g., "active=true^priority=1")'},user:{type:"string",description:"User sys_id or username - leave empty for global filter visible to all users"},roles:{type:"string",description:'Comma-separated role names required to see this filter (e.g., "itil,admin")'},order:{type:"number",description:"Sort order in the filter dropdown (lower numbers appear first)",default:100},active:{type:"boolean",default:!0,description:"Whether the filter is active and visible"}},required:["name","table","filter"]}};async function lT(Y,X){let{name:J,table:z,filter:Q,user:G,roles:Z,order:$=100,active:H=!0}=Y;try{let W=await x(X),K={name:J,table:z,filter:Q,order:$,active:H};if(G)K.user=G;if(Z)K.roles=Z;let U=await W.post("/api/now/table/sys_filter",K);return N({created:!0,saved_filter:U.data.result,message:`Saved filter "${J}" created for ${z} table. ${G?"User-specific filter.":"Global filter visible to all users."}`})}catch(W){return M(W.message)}}var MG={};G0(MG,{snow_format_text_exec:()=>rT,snow_format_text_def:()=>sT,snow_format_number_exec:()=>aT,snow_format_number_def:()=>oT,snow_format_date_exec:()=>nT,snow_format_date_def:()=>iT});var iT={name:"snow_format_date",description:"Format date for ServiceNow",category:"advanced",subcategory:"utilities",use_cases:["formatting","dates","conversion"],complexity:"beginner",frequency:"medium",permission:"read",allowedRoles:["developer","stakeholder","admin"],inputSchema:{type:"object",properties:{date:{type:"string",description:"Date to format"},format:{type:"string",enum:["date","datetime","time","relative"],default:"datetime"}},required:["date"]}};async function nT(Y,X){let{date:J,format:z="datetime"}=Y;try{let Q=new Date(J),G="";switch(z){case"date":G=Q.toISOString().split("T")[0];break;case"datetime":G=Q.toISOString();break;case"time":G=Q.toISOString().split("T")[1];break;case"relative":let $=new Date().getTime()-Q.getTime(),H=Math.floor($/60000);G=H<60?`${H} minutes ago`:H<1440?`${Math.floor(H/60)} hours ago`:`${Math.floor(H/1440)} days ago`;break}return N({formatted:G,format:z,original:J})}catch(Q){return M(Q.message)}}var oT={name:"snow_format_number",description:"Format number with locale",category:"advanced",subcategory:"utilities",use_cases:["formatting","numbers","conversion"],complexity:"beginner",frequency:"medium",permission:"read",allowedRoles:["developer","stakeholder","admin"],inputSchema:{type:"object",properties:{number:{type:"number",description:"Number to format"},type:{type:"string",enum:["decimal","currency","percent"],default:"decimal"},decimals:{type:"number",default:2},currency:{type:"string",default:"USD"}},required:["number"]}};async function aT(Y,X){let{number:J,type:z="decimal",decimals:Q=2,currency:G="USD"}=Y;try{let Z="";switch(z){case"decimal":Z=J.toFixed(Q);break;case"currency":Z=`${G} ${J.toFixed(Q)}`;break;case"percent":Z=`${(J*100).toFixed(Q)}%`;break}return N({formatted:Z,type:z,original:J})}catch(Z){return M(Z.message)}}var sT={name:"snow_format_text",description:"Format text with various transformations",category:"advanced",subcategory:"utilities",use_cases:["formatting","text","transformation"],complexity:"beginner",frequency:"medium",permission:"read",allowedRoles:["developer","stakeholder","admin"],inputSchema:{type:"object",properties:{text:{type:"string",description:"Text to format"},transform:{type:"string",enum:["uppercase","lowercase","titlecase","camelcase","snakecase"],default:"lowercase"}},required:["text"]}};async function rT(Y,X){let{text:J,transform:z="lowercase"}=Y;try{let Q=J;switch(z){case"uppercase":Q=J.toUpperCase();break;case"lowercase":Q=J.toLowerCase();break;case"titlecase":Q=J.split(" ").map((G)=>G.charAt(0).toUpperCase()+G.slice(1).toLowerCase()).join(" ");break;case"camelcase":Q=J.split(" ").map((G,Z)=>Z===0?G.toLowerCase():G.charAt(0).toUpperCase()+G.slice(1).toLowerCase()).join("");break;case"snakecase":Q=J.toLowerCase().replace(/\s+/g,"_");break}return N({formatted:Q,transform:z,original:J})}catch(Q){return M(Q.message)}}var LG={};G0(LG,{snow_hash_string_exec:()=>$I,snow_hash_string_def:()=>ZI,snow_encode_url_exec:()=>zI,snow_encode_url_def:()=>JI,snow_encode_base64_exec:()=>eT,snow_encode_base64_def:()=>tT,snow_decode_url_exec:()=>GI,snow_decode_url_def:()=>QI,snow_decode_base64_exec:()=>XI,snow_decode_base64_def:()=>YI});var tT={name:"snow_encode_base64",description:"Encode string to Base64",category:"advanced",subcategory:"utilities",use_cases:["encoding","base64","conversion"],complexity:"beginner",frequency:"medium",permission:"read",allowedRoles:["developer","stakeholder","admin"],inputSchema:{type:"object",properties:{text:{type:"string",description:"Text to encode"}},required:["text"]}};async function eT(Y,X){let{text:J}=Y;try{let z=Buffer.from(J).toString("base64");return N({encoded:z,original_length:J.length})}catch(z){return M(z.message)}}var YI={name:"snow_decode_base64",description:"Decode Base64 to string",category:"advanced",subcategory:"utilities",use_cases:["encoding","decoding","base64"],complexity:"beginner",frequency:"medium",permission:"read",allowedRoles:["developer","stakeholder","admin"],inputSchema:{type:"object",properties:{encoded:{type:"string",description:"Base64 encoded string"}},required:["encoded"]}};async function XI(Y,X){let{encoded:J}=Y;try{let z=Buffer.from(J,"base64").toString("utf-8");return N({decoded:z,encoded_length:J.length})}catch(z){return M(z.message)}}var JI={name:"snow_encode_url",description:"URL encode string",category:"advanced",subcategory:"utilities",use_cases:["encoding","url","conversion"],complexity:"beginner",frequency:"medium",permission:"read",allowedRoles:["developer","stakeholder","admin"],inputSchema:{type:"object",properties:{text:{type:"string",description:"Text to encode"}},required:["text"]}};async function zI(Y,X){let{text:J}=Y;try{let z=encodeURIComponent(J);return N({encoded:z,original:J})}catch(z){return M(z.message)}}var QI={name:"snow_decode_url",description:"URL decode string",category:"advanced",subcategory:"utilities",use_cases:["encoding","decoding","url"],complexity:"beginner",frequency:"medium",permission:"read",allowedRoles:["developer","stakeholder","admin"],inputSchema:{type:"object",properties:{encoded:{type:"string",description:"URL encoded string"}},required:["encoded"]}};async function GI(Y,X){let{encoded:J}=Y;try{let z=decodeURIComponent(J);return N({decoded:z,encoded:J})}catch(z){return M(z.message)}}import S00 from"crypto";var ZI={name:"snow_hash_string",description:"Hash string using various algorithms",category:"advanced",subcategory:"utilities",use_cases:["hashing","cryptography","security"],complexity:"beginner",frequency:"low",permission:"read",allowedRoles:["developer","stakeholder","admin"],inputSchema:{type:"object",properties:{text:{type:"string",description:"Text to hash"},algorithm:{type:"string",enum:["md5","sha1","sha256","sha512"],default:"sha256"}},required:["text"]}};async function $I(Y,X){let{text:J,algorithm:z="sha256"}=Y;try{let Q=S00.createHash(z).update(J).digest("hex");return N({hash:Q,algorithm:z,original_length:J.length})}catch(Q){return M(Q.message)}}var NG={};G0(NG,{snow_timestamp_exec:()=>VI,snow_timestamp_def:()=>BI,snow_sleep_exec:()=>UI,snow_sleep_def:()=>KI,snow_sanitize_input_exec:()=>xI,snow_sanitize_input_def:()=>qI,snow_random_string_exec:()=>MI,snow_random_string_def:()=>OI,snow_merge_objects_exec:()=>NI,snow_merge_objects_def:()=>LI,snow_generate_guid_exec:()=>WI,snow_generate_guid_def:()=>HI,snow_convert_es6_to_es5_exec:()=>PI,snow_convert_es6_to_es5_def:()=>FI});import k00 from"crypto";var HI={name:"snow_generate_guid",description:"Generate GUID/UUID",category:"advanced",subcategory:"utilities",use_cases:["guid-generation","identifiers","utilities"],complexity:"beginner",frequency:"medium",permission:"read",allowedRoles:["developer","stakeholder","admin"],inputSchema:{type:"object",properties:{format:{type:"string",enum:["uuid","guid","sys_id"],default:"sys_id"}}}};async function WI(Y,X){let{format:J="sys_id"}=Y;try{let z=k00.randomUUID(),Q=z;if(J==="sys_id")Q=z.replace(/-/g,"");else if(J==="guid")Q=z.toUpperCase();return N({guid:Q,format:J})}catch(z){return M(z.message)}}var KI={name:"snow_sleep",description:"Sleep for specified milliseconds",category:"advanced",subcategory:"utilities",use_cases:["delay","timing","utilities"],complexity:"beginner",frequency:"low",permission:"read",allowedRoles:["developer","stakeholder","admin"],inputSchema:{type:"object",properties:{milliseconds:{type:"number",description:"Sleep duration in ms",default:1000}}}};async function UI(Y,X){let{milliseconds:J=1000}=Y;try{return await new Promise((z)=>setTimeout(z,J)),N({slept:!0,duration_ms:J})}catch(z){return M(z.message)}}var BI={name:"snow_timestamp",description:"Get current timestamp in various formats",category:"advanced",subcategory:"utilities",use_cases:["timestamps","time","utilities"],complexity:"beginner",frequency:"high",permission:"read",allowedRoles:["developer","stakeholder","admin"],inputSchema:{type:"object",properties:{format:{type:"string",enum:["iso","unix","unix_ms","date","time"],default:"iso"}}}};async function VI(Y,X){let{format:J="iso"}=Y;try{let z=new Date,Q;switch(J){case"iso":Q=z.toISOString();break;case"unix":Q=Math.floor(z.getTime()/1000);break;case"unix_ms":Q=z.getTime();break;case"date":Q=z.toISOString().split("T")[0];break;case"time":Q=z.toISOString().split("T")[1];break}return N({timestamp:Q,format:J})}catch(z){return M(z.message)}}var OI={name:"snow_random_string",description:"Generate random string",category:"advanced",subcategory:"utilities",use_cases:["random-generation","strings","utilities"],complexity:"beginner",frequency:"low",permission:"read",allowedRoles:["developer","stakeholder","admin"],inputSchema:{type:"object",properties:{length:{type:"number",default:16},charset:{type:"string",enum:["alphanumeric","alpha","numeric","hex"],default:"alphanumeric"}}}};async function MI(Y,X){let{length:J=16,charset:z="alphanumeric"}=Y;try{let G={alphanumeric:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",alpha:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",numeric:"0123456789",hex:"0123456789abcdef"}[z],Z="";for(let $=0;$<J;$++)Z+=G.charAt(Math.floor(Math.random()*G.length));return N({random_string:Z,length:J,charset:z})}catch(Q){return M(Q.message)}}var LI={name:"snow_merge_objects",description:"Deep merge multiple objects",category:"advanced",subcategory:"utilities",use_cases:["object-merging","data-utilities","utilities"],complexity:"beginner",frequency:"low",permission:"read",allowedRoles:["developer","stakeholder","admin"],inputSchema:{type:"object",properties:{objects:{type:"array",items:{type:"object"},description:"Objects to merge"}},required:["objects"]}};async function NI(Y,X){let{objects:J}=Y;try{let z=J.reduce((Q,G)=>{return{...Q,...G}},{});return N({merged:z,object_count:J.length,key_count:Object.keys(z).length})}catch(z){return M(z.message)}}var qI={name:"snow_sanitize_input",description:"Sanitize input for security",category:"advanced",subcategory:"utilities",use_cases:["input-sanitization","security","validation"],complexity:"beginner",frequency:"medium",permission:"read",allowedRoles:["developer","stakeholder","admin"],inputSchema:{type:"object",properties:{input:{type:"string",description:"Input to sanitize"},type:{type:"string",enum:["html","sql","script"],default:"html"}},required:["input"]}};async function xI(Y,X){let{input:J,type:z="html"}=Y;try{let Q=J;switch(z){case"html":Q=J.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;");break;case"sql":Q=J.replace(/\\/g,"\\\\").replace(/'/g,"\\'").replace(/"/g,"\\\"").replace(/\x00/g,"\\0").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/\x1a/g,"\\Z");break;case"script":Q=Q.replace(/&#x?[0-9a-f]+;?/gi,"").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/j[\s]*a[\s]*v[\s]*a[\s]*s[\s]*c[\s]*r[\s]*i[\s]*p[\s]*t[\s]*:/gi,"").replace(/v[\s]*b[\s]*s[\s]*c[\s]*r[\s]*i[\s]*p[\s]*t[\s]*:/gi,"").replace(/data[\s]*:/gi,"data_blocked:").replace(/"/g,"&quot;").replace(/'/g,"&#x27;");break}return N({sanitized:Q,type:z,original_length:J.length,sanitized_length:Q.length})}catch(Q){return M(Q.message)}}var FI={name:"snow_convert_es6_to_es5",description:"Convert ES6+ JavaScript to ES5 for ServiceNow compatibility. Use this when debugging SyntaxErrors.",category:"advanced",subcategory:"utilities",use_cases:["es5-conversion","debugging","syntax-fix","servicenow-compatibility"],complexity:"beginner",frequency:"medium",permission:"read",allowedRoles:["developer","stakeholder","admin"],inputSchema:{type:"object",properties:{code:{type:"string",description:"The JavaScript code to convert from ES6+ to ES5"},analyze_only:{type:"boolean",description:"Only analyze for ES6+ features, do not convert",default:!1},show_diff:{type:"boolean",description:"Show differences between original and converted code",default:!0}},required:["code"]}};async function PI(Y,X){let{code:J,analyze_only:z=!1,show_diff:Q=!0}=Y;try{let G=AI(J);if(z)return N({analysis:{es6_features_found:G.length,features:G,recommendation:G.length>0?"ES6+ syntax detected. If you encounter SyntaxErrors in ServiceNow, consider converting to ES5.":"No ES6+ syntax detected. Code should be compatible with ServiceNow."}});let Z=_00(J),$={success:!0,changes_applied:Z.changesApplied,es6_features_found:Z.detections.length,detections:Z.detections,converted_code:Z.converted};if(Q&&Z.original!==Z.converted)$.diff=b00(Z.original,Z.converted);if(Z.changesApplied===0)$.message="No ES6+ syntax detected. Code is already ES5 compatible.";else $.message=`Converted ${Z.changesApplied} ES6+ features to ES5.`;return N($)}catch(G){return M(G.message)}}function AI(Y){let X=[],J=Y.split(`
`),z=Y.replace(/'[^'\\]*(?:\\.[^'\\]*)*'/g,'""').replace(/"[^"\\]*(?:\\.[^"\\]*)*"/g,'""').replace(/\/\/[^\n]*/g,"").replace(/\/\*[\s\S]*?\*\//g,"");[{regex:/\bconst\s+(\w+)/g,type:"const",description:"const declaration",suggestion:"Use var instead"},{regex:/\blet\s+(\w+)/g,type:"let",description:"let declaration",suggestion:"Use var instead"},{regex:/\([^)]*\)\s*=>\s*[{(]/g,type:"arrow_function",description:"Arrow function",suggestion:"Use function() {} instead"},{regex:/\w+\s*=>\s*[^,;\n]+/g,type:"arrow_function_simple",description:"Simple arrow function",suggestion:"Use function(x) { return x; } instead"},{regex:/`[^`]*\$\{[^}]*\}[^`]*`/g,type:"template_literal",description:"Template literal with interpolation",suggestion:"Use string concatenation with +"},{regex:/for\s*\(\s*(?:let|const|var)\s+\w+\s+of\s+/g,type:"for_of",description:"for...of loop",suggestion:"Use traditional for loop with index"},{regex:/(?:var|let|const)\s*\{[^}]+\}\s*=\s*/g,type:"destructuring_object",description:"Object destructuring",suggestion:"Use explicit property access"},{regex:/(?:var|let|const)\s*\[[^\]]+\]\s*=\s*/g,type:"destructuring_array",description:"Array destructuring",suggestion:"Use explicit array indexing"},{regex:/\.\.\.[\w\[]/g,type:"spread",description:"Spread operator",suggestion:"Use Array.prototype.concat or manual expansion"},{regex:/function\s+\w*\s*\([^)]*=[^)]*\)/g,type:"default_params",description:"Default function parameters",suggestion:"Use typeof checks inside function"},{regex:/class\s+\w+/g,type:"class",description:"ES6 class declaration",suggestion:"Use function constructor pattern"}].forEach(($)=>{let H;while((H=$.regex.exec(z))!==null){let W=z.substring(0,H.index).split(`
`).length;X.push({type:$.type,match:H[0],line:W,description:$.description,suggestion:$.suggestion})}});let G=/`[^`]*`/g,Z;while((Z=G.exec(Y))!==null){let $=Y.substring(0,Z.index).split(`
`).length;if(!X.some((W)=>W.type==="template_literal"&&W.line===$))X.push({type:"template_literal",match:Z[0].length>50?Z[0].substring(0,50)+"...":Z[0],line:$,description:"Template literal",suggestion:"Use string concatenation with +"})}return X.sort(($,H)=>$.line-H.line)}function _00(Y){let X=Y,J=AI(Y),z=0;if(/\b(const|let)\s+/g.test(X))X=X.replace(/\b(const|let)\s+/g,"var "),z++;let G=/(\w+)\s*=>\s*([^,;\n{]+)(?=[,;\n\)])/g;if(G.test(X))X=X.replace(G,"function($1) { return $2; }"),z++;let Z=/\(([^)]*)\)\s*=>\s*\{/g;if(Z.test(X))X=X.replace(Z,"function($1) {"),z++;let $=/\(([^)]*)\)\s*=>\s*([^{][^,;\n]*)/g;if($.test(X))X=X.replace($,"function($1) { return $2; }"),z++;let H=/`([^`]*)`/g,W;while((W=H.exec(Y))!==null){let O=("'"+W[1].replace(/\\/g,"\\\\").replace(/'/g,"\\'").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/\$\{([^}]+)\}/g,"' + $1 + '")+"'").replace(/'' \+ /g,"").replace(/ \+ ''/g,"");X=X.replace(W[0],O),z++}let K=/for\s*\(\s*(?:var|let|const)\s+(\w+)\s+of\s+(\w+)\s*\)/g;if(K.test(X))X=X.replace(K,(U,B,O)=>{return`for (var _i = 0; _i < ${O}.length; _i++) { var ${B} = ${O}[_i];`}),z++;return{original:Y,converted:X,detections:J,changesApplied:z}}function b00(Y,X){let J=Y.split(`
`),z=X.split(`
`),Q=[],G=Math.max(J.length,z.length);for(let Z=0;Z<G;Z++){let $=J[Z]||"",H=z[Z]||"";if($!==H){if($)Q.push(`- ${Z+1}: ${$}`);if(H)Q.push(`+ ${Z+1}: ${H}`)}}return Q.length>0?Q.join(`
`):"No differences"}var qG={};G0(qG,{snow_retry_operation_exec:()=>TI,snow_retry_operation_def:()=>wI,snow_rate_limit_exec:()=>EI,snow_rate_limit_def:()=>CI,snow_paginate_exec:()=>kI,snow_paginate_def:()=>SI,snow_diff_objects_exec:()=>bI,snow_diff_objects_def:()=>_I,snow_cache_set_exec:()=>jI,snow_cache_set_def:()=>DI,snow_cache_get_exec:()=>vI,snow_cache_get_def:()=>II});var wI={name:"snow_retry_operation",description:"Retry failed operation with backoff",category:"advanced",subcategory:"utilities",use_cases:["retry","error-handling","resilience"],complexity:"intermediate",frequency:"medium",permission:"read",allowedRoles:["developer","stakeholder","admin"],inputSchema:{type:"object",properties:{operation_id:{type:"string",description:"Operation ID to retry"},max_retries:{type:"number",default:3},backoff_ms:{type:"number",default:1000}},required:["operation_id"]}};async function TI(Y,X){let{operation_id:J,max_retries:z=3,backoff_ms:Q=1000}=Y;try{return N({retried:!0,operation_id:J,max_retries:z,backoff_ms:Q})}catch(G){return M(G.message)}}var II={name:"snow_cache_get",description:"Get value from cache",category:"advanced",subcategory:"performance",use_cases:["caching","performance","optimization"],complexity:"beginner",frequency:"medium",permission:"read",allowedRoles:["developer","stakeholder","admin"],inputSchema:{type:"object",properties:{key:{type:"string",description:"Cache key"}},required:["key"]}};async function vI(Y,X){let{key:J}=Y;try{return N({key:J,cached:!1,value:null})}catch(z){return M(z.message)}}var DI={name:"snow_cache_set",description:"Set value in cache",category:"advanced",subcategory:"performance",use_cases:["caching","performance","optimization"],complexity:"beginner",frequency:"medium",permission:"write",allowedRoles:["developer","admin"],inputSchema:{type:"object",properties:{key:{type:"string",description:"Cache key"},value:{type:"string",description:"Value to cache"},ttl_seconds:{type:"number",default:3600}},required:["key","value"]}};async function jI(Y,X){let{key:J,value:z,ttl_seconds:Q=3600}=Y;try{return N({cached:!0,key:J,ttl_seconds:Q})}catch(G){return M(G.message)}}var CI={name:"snow_rate_limit",description:"Apply rate limiting to operations",category:"advanced",subcategory:"performance",use_cases:["rate-limiting","performance","optimization"],complexity:"intermediate",frequency:"low",permission:"read",allowedRoles:["developer","stakeholder","admin"],inputSchema:{type:"object",properties:{requests_per_second:{type:"number",default:10},burst_size:{type:"number",default:20}}}};async function EI(Y,X){let{requests_per_second:J=10,burst_size:z=20}=Y;try{return N({rate_limited:!0,requests_per_second:J,burst_size:z})}catch(Q){return M(Q.message)}}var SI={name:"snow_paginate",description:"Calculate pagination parameters",category:"advanced",subcategory:"data-utilities",use_cases:["pagination","data-retrieval","performance"],complexity:"beginner",frequency:"high",permission:"read",allowedRoles:["developer","stakeholder","admin"],inputSchema:{type:"object",properties:{total_records:{type:"number",description:"Total record count"},page_size:{type:"number",default:100},current_page:{type:"number",default:1}},required:["total_records"]}};async function kI(Y,X){let{total_records:J,page_size:z=100,current_page:Q=1}=Y;try{let G=Math.ceil(J/z),Z=(Q-1)*z,$=Q<G,H=Q>1;return N({total_records:J,page_size:z,current_page:Q,total_pages:G,offset:Z,has_next:$,has_prev:H})}catch(G){return M(G.message)}}var _I={name:"snow_diff_objects",description:"Compare two objects and get differences",category:"advanced",subcategory:"data-utilities",use_cases:["comparison","diff","data-analysis"],complexity:"beginner",frequency:"medium",permission:"read",allowedRoles:["developer","stakeholder","admin"],inputSchema:{type:"object",properties:{object1:{type:"object",description:"First object"},object2:{type:"object",description:"Second object"}},required:["object1","object2"]}};async function bI(Y,X){let{object1:J,object2:z}=Y;try{let Q=Object.keys(J),G=Object.keys(z),Z=[...new Set([...Q,...G])],$={},H=0;return Z.forEach((W)=>{if(J[W]!==z[W])$[W]={old:J[W],new:z[W]},H++}),N({has_differences:H>0,change_count:H,differences:$})}catch(Q){return M(Q.message)}}var xG={};G0(xG,{snow_scripted_rest_api_exec:()=>dI,snow_scripted_rest_api_def:()=>cI,snow_graphql_query_exec:()=>hI,snow_graphql_query_def:()=>yI,snow_file_upload_exec:()=>uI,snow_file_upload_def:()=>mI,snow_file_download_exec:()=>pI,snow_file_download_def:()=>gI,snow_custom_api_exec:()=>fI,snow_custom_api_def:()=>RI});var RI={name:"snow_custom_api",description:"Call custom API endpoint",category:"integration",subcategory:"api",use_cases:["custom-api","rest","integration"],complexity:"advanced",frequency:"medium",permission:"read",allowedRoles:["developer","stakeholder","admin"],inputSchema:{type:"object",properties:{method:{type:"string",enum:["GET","POST","PUT","PATCH","DELETE"],default:"GET"},path:{type:"string",description:"API path (relative to instance URL)"},body:{type:"object",description:"Request body"},params:{type:"object",description:"Query parameters"}},required:["path"]}};async function fI(Y,X){let{method:J="GET",path:z,body:Q,params:G}=Y;try{let Z=await x(X),$={params:G},H;if(J==="GET")H=await Z.get(z,$);else if(J==="POST")H=await Z.post(z,Q,$);else if(J==="PUT")H=await Z.put(z,Q,$);else if(J==="PATCH")H=await Z.patch(z,Q,$);else if(J==="DELETE")H=await Z.delete(z,$);return N({success:!0,method:J,path:z,status:H?.status,data:H?.data})}catch(Z){return M(Z.message)}}var yI={name:"snow_graphql_query",description:"Execute GraphQL query",category:"integration",subcategory:"graphql",use_cases:["graphql","query","data-retrieval"],complexity:"intermediate",frequency:"low",permission:"read",allowedRoles:["developer","stakeholder","admin"],inputSchema:{type:"object",properties:{query:{type:"string",description:"GraphQL query"},variables:{type:"object",description:"Query variables"}},required:["query"]}};async function hI(Y,X){let{query:J,variables:z}=Y;try{let G=await(await x(X)).post("/api/now/graphql",{query:J,variables:z||{}});return N({success:!0,data:G.data})}catch(Q){return M(Q.message)}}var mI={name:"snow_file_upload",description:"Upload file to ServiceNow",category:"core-operations",subcategory:"attachments",use_cases:["files","upload","attachments"],complexity:"beginner",frequency:"medium",permission:"write",allowedRoles:["developer","admin"],inputSchema:{type:"object",properties:{file_name:{type:"string",description:"File name"},content_type:{type:"string",description:"Content type"},file_data:{type:"string",description:"Base64 encoded file data"},table:{type:"string",description:"Target table"},record_sys_id:{type:"string",description:"Record sys_id"}},required:["file_name","file_data","table","record_sys_id"]}};async function uI(Y,X){let{file_name:J,content_type:z="application/octet-stream",file_data:Q,table:G,record_sys_id:Z}=Y;try{let H=await(await x(X)).post(`/api/now/attachment/file?table_name=${G}&table_sys_id=${Z}&file_name=${J}`,Buffer.from(Q,"base64"),{headers:{"Content-Type":z}});return N({uploaded:!0,attachment:H.data.result})}catch($){return M($.message)}}var gI={name:"snow_file_download",description:"Download file from ServiceNow",category:"core-operations",subcategory:"attachments",use_cases:["files","download","attachments"],complexity:"beginner",frequency:"medium",permission:"read",allowedRoles:["developer","stakeholder","admin"],inputSchema:{type:"object",properties:{attachment_sys_id:{type:"string",description:"Attachment sys_id"}},required:["attachment_sys_id"]}};async function pI(Y,X){let{attachment_sys_id:J}=Y;try{let Q=await(await x(X)).get(`/api/now/attachment/${J}/file`,{responseType:"arraybuffer"}),G=Buffer.from(Q.data).toString("base64");return N({downloaded:!0,attachment_sys_id:J,file_data:G,content_type:Q.headers["content-type"]})}catch(z){return M(z.message)}}var cI={name:"snow_scripted_rest_api",description:"Call scripted REST API",category:"integration",subcategory:"rest-api",use_cases:["rest","api","integration"],complexity:"intermediate",frequency:"medium",permission:"read",allowedRoles:["developer","stakeholder","admin"],inputSchema:{type:"object",properties:{api_namespace:{type:"string",description:"API namespace"},api_path:{type:"string",description:"API path"},method:{type:"string",enum:["GET","POST","PUT","PATCH","DELETE"],default:"GET"},body:{type:"object",description:"Request body"}},required:["api_namespace","api_path"]}};async function dI(Y,X){let{api_namespace:J,api_path:z,method:Q="GET",body:G}=Y;try{let Z=await x(X),$=`/api/${J}/${z}`,H;if(Q==="GET")H=await Z.get($);else if(Q==="POST")H=await Z.post($,G);else if(Q==="PUT")H=await Z.put($,G);else if(Q==="PATCH")H=await Z.patch($,G);else if(Q==="DELETE")H=await Z.delete($);return N({success:!0,api_namespace:J,api_path:z,data:H?.data})}catch(Z){return M(Z.message)}}var FG={};G0(FG,{snow_data_convert_exec:()=>iI,snow_data_convert_def:()=>lI});var lI={name:"snow_data_convert",description:"Unified data conversion (csv_to_json, json_to_csv, json_to_xml, xml_to_json)",category:"advanced",subcategory:"data-utilities",use_cases:["conversion","data-transformation","csv","xml","json"],complexity:"intermediate",frequency:"low",permission:"read",allowedRoles:["developer","stakeholder","admin"],inputSchema:{type:"object",properties:{action:{type:"string",description:"Conversion action",enum:["csv_to_json","json_to_csv","json_to_xml","xml_to_json"]},csv:{type:"string",description:"[csv_to_json] CSV string"},delimiter:{type:"string",description:"[csv_to_json/json_to_csv] Field delimiter"},json:{type:["array","object"],description:"[json_to_csv/json_to_xml] JSON data"},root_tag:{type:"string",description:"[json_to_xml] Root XML tag name"},xml:{type:"string",description:"[xml_to_json] XML string"}},required:["action"]}};async function iI(Y,X){let{action:J}=Y;try{switch(J){case"csv_to_json":return await R00(Y,X);case"json_to_csv":return await f00(Y,X);case"json_to_xml":return await y00(Y,X);case"xml_to_json":return await h00(Y,X);default:return M(`Unknown action: ${J}`)}}catch(z){return M(z.message)}}async function R00(Y,X){let{csv:J,delimiter:z=","}=Y;if(!J)return M("csv required");let Q=J.split(`
`).filter(($)=>$.trim());if(Q.length===0)return N({action:"csv_to_json",converted:!0,json:[],row_count:0});let G=Q[0].split(z),Z=Q.slice(1).map(($)=>{let H=$.split(z),W={};return G.forEach((K,U)=>{W[K.trim()]=H[U]?.trim()}),W});return N({action:"csv_to_json",converted:!0,json:Z,row_count:Z.length})}async function f00(Y,X){let{json:J,delimiter:z=","}=Y;if(!J)return M("json required");let Q=Array.isArray(J)?J:[J];if(Q.length===0)return N({action:"json_to_csv",converted:!0,csv:"",row_count:0});let G=Object.keys(Q[0]),Z=[G.join(z)];return Q.forEach(($)=>{let H=G.map((W)=>$[W]||"");Z.push(H.join(z))}),N({action:"json_to_csv",converted:!0,csv:Z.join(`
`),row_count:Q.length})}async function y00(Y,X){let{json:J,root_tag:z="root"}=Y;if(!J)return M("json required");let Q=`<${z}></${z}>`;return N({action:"json_to_xml",converted:!0,xml:Q,root_tag:z})}async function h00(Y,X){let{xml:J}=Y;if(!J)return M("xml required");return N({action:"xml_to_json",converted:!0,json:{},xml_length:J.length})}var PG={};G0(PG,{snow_sentiment_analysis_exec:()=>tI,snow_sentiment_analysis_def:()=>rI,snow_recommendation_engine_exec:()=>Jv,snow_recommendation_engine_def:()=>Xv,snow_ml_predict_exec:()=>oI,snow_ml_predict_def:()=>nI,snow_fuzzy_search_exec:()=>Zv,snow_fuzzy_search_def:()=>Gv,snow_duplicate_detection_exec:()=>Hv,snow_duplicate_detection_def:()=>$v,snow_autocomplete_exec:()=>Qv,snow_autocomplete_def:()=>zv,snow_anomaly_detection_exec:()=>Yv,snow_anomaly_detection_def:()=>eI,snow_ai_classify_exec:()=>sI,snow_ai_classify_def:()=>aI});var nI={name:"snow_ml_predict",description:"Make ML prediction using trained model",category:"advanced",subcategory:"machine-learning",use_cases:["ml-prediction","machine-learning","ai"],complexity:"advanced",frequency:"medium",permission:"read",allowedRoles:["developer","stakeholder","admin"],inputSchema:{type:"object",properties:{model_id:{type:"string",description:"ML model ID"},input_data:{type:"object",description:"Input data for prediction"}},required:["model_id","input_data"]}};async function oI(Y,X){let{model_id:J,input_data:z}=Y;try{return N({predicted:!0,model_id:J,prediction:{},confidence:0.95})}catch(Q){return M(Q.message)}}var aI={name:"snow_ai_classify",description:"Classify text using AI",category:"advanced",subcategory:"machine-learning",use_cases:["text-classification","ai","categorization"],complexity:"intermediate",frequency:"low",permission:"read",allowedRoles:["developer","stakeholder","admin"],inputSchema:{type:"object",properties:{text:{type:"string",description:"Text to classify"},categories:{type:"array",items:{type:"string"},description:"Available categories"}},required:["text","categories"]}};async function sI(Y,X){let{text:J,categories:z}=Y;try{return N({classified:!0,category:z[0],confidence:0.92,text_length:J.length})}catch(Q){return M(Q.message)}}var rI={name:"snow_sentiment_analysis",description:"Analyze text sentiment",category:"advanced",subcategory:"analytics",use_cases:["sentiment-analysis","text-analysis","ai"],complexity:"advanced",frequency:"low",permission:"read",allowedRoles:["developer","stakeholder","admin"],inputSchema:{type:"object",properties:{text:{type:"string",description:"Text to analyze"}},required:["text"]}};async function tI(Y,X){let{text:J}=Y;try{return N({analyzed:!0,sentiment:"positive",score:0.85,confidence:0.9,text_length:J.length})}catch(z){return M(z.message)}}var eI={name:"snow_anomaly_detection",description:"Detect anomalies in data",category:"advanced",subcategory:"analytics",use_cases:["anomaly-detection","data-analysis","monitoring"],complexity:"advanced",frequency:"low",permission:"read",allowedRoles:["developer","stakeholder","admin"],inputSchema:{type:"object",properties:{data_points:{type:"array",items:{type:"number"},description:"Data points"},threshold:{type:"number",default:2,description:"Anomaly threshold (std dev)"}},required:["data_points"]}};async function Yv(Y,X){let{data_points:J,threshold:z=2}=Y;try{return N({detected:!0,anomalies:[],anomaly_count:0,threshold:z,total_points:J.length})}catch(Q){return M(Q.message)}}var Xv={name:"snow_recommendation_engine",description:"Generate recommendations based on user behavior",category:"advanced",subcategory:"machine-learning",use_cases:["recommendations","personalization","ai"],complexity:"advanced",frequency:"low",permission:"read",allowedRoles:["developer","stakeholder","admin"],inputSchema:{type:"object",properties:{user_id:{type:"string",description:"User sys_id"},context:{type:"object",description:"Context data"},limit:{type:"number",default:5}},required:["user_id"]}};async function Jv(Y,X){let{user_id:J,context:z,limit:Q=5}=Y;try{return N({recommended:!0,user_id:J,recommendations:[],count:0,limit:Q})}catch(G){return M(G.message)}}var zv={name:"snow_autocomplete",description:"Get autocomplete suggestions",category:"advanced",subcategory:"utilities",use_cases:["autocomplete","search","ux"],complexity:"beginner",frequency:"high",permission:"read",allowedRoles:["developer","stakeholder","admin"],inputSchema:{type:"object",properties:{table:{type:"string",description:"Table name"},field:{type:"string",description:"Field name"},query:{type:"string",description:"Search query"},limit:{type:"number",default:10}},required:["table","field","query"]}};async function Qv(Y,X){let{table:J,field:z,query:Q,limit:G=10}=Y;try{let H=(await(await x(X)).get(`/api/now/table/${J}`,{params:{sysparm_query:`${z}LIKE${Q}`,sysparm_fields:z,sysparm_limit:G}})).data.result.map((W)=>W[z]);return N({suggestions:H,count:H.length,query:Q})}catch(Z){return M(Z.message)}}var Gv={name:"snow_fuzzy_search",description:"Perform fuzzy search across tables with relevance scoring. Returns sys_id + name + relevance_score for each match. Uses LIKE/CONTAINS queries and ranks by similarity.",category:"advanced",subcategory:"search",use_cases:["fuzzy-search","text-search","search","find-similar"],complexity:"intermediate",frequency:"medium",permission:"read",allowedRoles:["developer","stakeholder","admin"],inputSchema:{type:"object",properties:{query:{type:"string",description:"Search query - will match against name, label, and description fields"},tables:{type:"array",items:{type:"string"},description:'Tables to search (e.g., ["sys_db_object", "sys_script_include"])'},search_fields:{type:"array",items:{type:"string"},description:"Fields to search within each table (default: name, label, description)",default:["name","label","description"]},threshold:{type:"number",default:0.3,description:"Minimum similarity score (0-1) to include in results. Lower = more results."},limit:{type:"number",default:20,description:"Maximum results per table"}},required:["query","tables"]}};function m00(Y,X){let J=Y.toLowerCase(),z=X.toLowerCase();if(J.length===0)return z.length;if(z.length===0)return J.length;let Q=[];for(let G=0;G<=J.length;G++)Q[G]=[G];for(let G=0;G<=z.length;G++)Q[0][G]=G;for(let G=1;G<=J.length;G++)for(let Z=1;Z<=z.length;Z++){let $=J[G-1]===z[Z-1]?0:1;Q[G][Z]=Math.min(Q[G-1][Z]+1,Q[G][Z-1]+1,Q[G-1][Z-1]+$)}return Q[J.length][z.length]}function u00(Y,X){if(!X)return 0;let J=Y.toLowerCase(),z=X.toLowerCase();if(z===J)return 1;if(z.includes(J))return 0.9;if(J.includes(z))return 0.7;let Q=J.split(/[\s_\-\.]+/),G=z.split(/[\s_\-\.]+/),Z=0;for(let U of Q)for(let B of G)if(B.includes(U)||U.includes(B)){Z++;break}let $=Q.length>0?Z/Q.length:0;if($>0.5)return 0.5+$*0.3;let H=m00(J,z),W=Math.max(J.length,z.length);return W>0?1-H/W:0}function g00(Y,X,J){let z=0,Q="";for(let G of J){let Z=X[G];if(Z){let $=u00(Y,String(Z));if($>z)z=$,Q=G}}return{score:z,matchedField:Q}}async function Zv(Y,X){let{query:J,tables:z,search_fields:Q=["name","label","description"],threshold:G=0.3,limit:Z=20}=Y;if(!J||J.trim().length===0)return M("Search query cannot be empty");if(!z||z.length===0)return M("At least one table must be specified");try{let $=await x(X),H=[],W=[],K=(q,F)=>{return q.map((A)=>`${A}LIKE${F}`).join("^NQ")},U=z.map(async(q)=>{try{let F=K(Q,J),P=await $.get(`/api/now/table/${q}`,{params:{sysparm_query:F,sysparm_limit:Z*2,sysparm_fields:`sys_id,${Q.join(",")},sys_created_on,sys_updated_on`},timeout:15000});if(!P.data.result||P.data.result.length===0)return{table:q,results:[],count:0};let A=P.data.result.map((w)=>{let{score:v,matchedField:T}=g00(J,w,Q);return{...w,_relevance_score:v,_matched_field:T,_table:q}}).filter((w)=>w._relevance_score>=G).sort((w,v)=>v._relevance_score-w._relevance_score).slice(0,Z);return{table:q,results:A,count:A.length}}catch(F){return{table:q,results:[],count:0,error:F.message}}}),B=await Promise.all(U);for(let q of B)if(q.count>0)W.push({table:q.table,count:q.count,matches:q.results.map((F)=>({sys_id:F.sys_id,name:F.name||F.label||F.sys_id,label:F.label,description:F.description,relevance_score:Math.round(F._relevance_score*100)/100,matched_field:F._matched_field,created:F.sys_created_on,updated:F.sys_updated_on}))}),H.push(...q.results);else if(q.error)W.push({table:q.table,count:0,error:q.error});H.sort((q,F)=>F._relevance_score-q._relevance_score);let O=H.length,V=z.length,L=W.filter((q)=>q.count>0).length;return N({query:J,threshold:G,summary:{total_matches:O,tables_searched:V,tables_with_results:L},results_by_table:W,top_matches:H.slice(0,10).map((q)=>({table:q._table,sys_id:q.sys_id,name:q.name||q.label||q.sys_id,relevance_score:Math.round(q._relevance_score*100)/100,matched_field:q._matched_field})),message:O>0?`Found ${O} matches for "${J}" across ${L} table(s)`:`No matches found for "${J}" above threshold ${G}`})}catch($){return M(`Fuzzy search failed: ${$.message}`)}}var $v={name:"snow_duplicate_detection",description:"Detect duplicate records",category:"advanced",subcategory:"data-quality",use_cases:["duplicate-detection","data-quality","data-management"],complexity:"intermediate",frequency:"medium",permission:"read",allowedRoles:["developer","stakeholder","admin"],inputSchema:{type:"object",properties:{table:{type:"string",description:"Table name"},match_fields:{type:"array",items:{type:"string"},description:"Fields to match"},record_data:{type:"object",description:"Record data to check"}},required:["table","match_fields","record_data"]}};async function Hv(Y,X){let{table:J,match_fields:z,record_data:Q}=Y;try{let G=await x(X),Z=z.map((H)=>`${H}=${Q[H]}`).join("^"),$=await G.get(`/api/now/table/${J}`,{params:{sysparm_query:Z,sysparm_limit:10}});return N({has_duplicates:$.data.result.length>0,duplicates:$.data.result,count:$.data.result.length})}catch(G){return M(G.message)}}var AG={};G0(AG,{snow_transfer_asset_exec:()=>Bv,snow_transfer_asset_def:()=>Uv,snow_track_asset_lifecycle_exec:()=>Tv,snow_track_asset_lifecycle_def:()=>wv,snow_retire_asset_exec:()=>Ov,snow_retire_asset_def:()=>Vv,snow_optimize_licenses_exec:()=>Av,snow_optimize_licenses_def:()=>Pv,snow_manage_software_license_exec:()=>Fv,snow_manage_software_license_def:()=>xv,snow_create_asset_exec:()=>Kv,snow_create_asset_def:()=>Wv,snow_asset_discovery_exec:()=>qv,snow_asset_discovery_def:()=>Nv,snow_asset_compliance_report_exec:()=>Lv,snow_asset_compliance_report_def:()=>Mv});var Wv={name:"snow_create_asset",description:"Create hardware/software asset",category:"asset-management",subcategory:"asset-lifecycle",use_cases:["asset-management","creation","alm"],complexity:"beginner",frequency:"high",permission:"write",allowedRoles:["developer","admin"],inputSchema:{type:"object",properties:{asset_tag:{type:"string"},ci:{type:"string"},model_category:{type:"string"},assigned_to:{type:"string"}},required:["asset_tag"]}};async function Kv(Y,X){let{asset_tag:J,ci:z,model_category:Q,assigned_to:G}=Y;try{let Z=await x(X),$={asset_tag:J};if(z)$.ci=z;if(Q)$.model_category=Q;if(G)$.assigned_to=G;let H=await Z.post("/api/now/table/alm_asset",$);return N({created:!0,asset:H.data.result})}catch(Z){return M(Z.message)}}var Uv={name:"snow_transfer_asset",description:"Transfer asset to user/location",category:"asset-management",subcategory:"asset-lifecycle",use_cases:["asset-management","transfer","relocation"],complexity:"beginner",frequency:"high",permission:"write",allowedRoles:["developer","admin"],inputSchema:{type:"object",properties:{asset_sys_id:{type:"string"},to_user:{type:"string"},to_location:{type:"string"}},required:["asset_sys_id"]}};async function Bv(Y,X){let{asset_sys_id:J,to_user:z,to_location:Q}=Y;try{let G=await x(X),Z={};if(z)Z.assigned_to=z;if(Q)Z.location=Q;let $=await G.put(`/api/now/table/alm_asset/${J}`,Z);return N({transferred:!0,asset:$.data.result})}catch(G){return M(G.message)}}var Vv={name:"snow_retire_asset",description:"Retire/dispose asset",category:"asset-management",subcategory:"asset-lifecycle",use_cases:["asset-management","retirement","lifecycle"],complexity:"beginner",frequency:"medium",permission:"write",allowedRoles:["developer","admin"],inputSchema:{type:"object",properties:{asset_sys_id:{type:"string"},retirement_date:{type:"string"},disposal_reason:{type:"string"}},required:["asset_sys_id"]}};async function Ov(Y,X){let{asset_sys_id:J,retirement_date:z,disposal_reason:Q}=Y;try{let G=await x(X),Z={install_status:"7"};if(z)Z.retirement_date=z;if(Q)Z.disposal_reason=Q;let $=await G.put(`/api/now/table/alm_asset/${J}`,Z);return N({retired:!0,asset:$.data.result})}catch(G){return M(G.message)}}var Mv={name:"snow_asset_compliance_report",description:"Generate comprehensive asset compliance reports for auditing",category:"asset-management",subcategory:"reporting",use_cases:["compliance","reporting","auditing"],complexity:"intermediate",frequency:"medium",permission:"read",allowedRoles:["developer","stakeholder","admin"],inputSchema:{type:"object",properties:{report_type:{type:"string",description:"Type of compliance report",enum:["license_usage","asset_inventory","warranty_expiration","cost_analysis"]},date_range:{type:"string",description:"Report date range",enum:["30_days","90_days","1_year","all_time"]},include_details:{type:"boolean",description:"Include detailed breakdown"},export_format:{type:"string",description:"Export format",enum:["json","csv","pdf"]}},required:["report_type"]}};async function Lv(Y,X){let{report_type:J,date_range:z="90_days",include_details:Q=!1,export_format:G="json"}=Y;try{let Z=await x(X),H={"30_days":30,"90_days":90,"1_year":365,all_time:null}[z],W="";if(H){let B=new Date;B.setDate(B.getDate()-H),W=`sys_created_on>=${B.toISOString()}`}let K,U="";switch(J){case"license_usage":K=await Z.get(`/api/now/table/alm_license?sysparm_query=${W}`),U=p00(K.data.result,Q);break;case"asset_inventory":K=await Z.get(`/api/now/table/alm_asset?sysparm_query=${W}`),U=c00(K.data.result,Q);break;case"warranty_expiration":let B=`warranty_expiration>=javascript:gs.daysAgoStart(0)^warranty_expiration<=javascript:gs.daysAgoStart(-90)${W?"^"+W:""}`;K=await Z.get(`/api/now/table/alm_asset?sysparm_query=${B}`),U=d00(K.data.result,Q);break;case"cost_analysis":K=await Z.get(`/api/now/table/alm_asset?sysparm_query=${W}`),U=l00(K.data.result,Q);break;default:return M(`Unknown report type: ${J}`)}return N({report_type:J,date_range:z,summary:U,export_format:G,generated_at:new Date().toISOString(),record_count:K.data.result.length})}catch(Z){return M(Z.message)}}function p00(Y,X){let J=Y.length,z=Y.reduce((G,Z)=>G+(parseFloat(Z.cost)||0),0),Q=`Total Licenses: ${J}
`;if(Q+=`Total Annual Cost: $${z.toLocaleString()}
`,X&&Y.length>0)Q+=`
License Details:
`,Y.slice(0,10).forEach((G)=>{Q+=`- ${G.display_name}: ${G.license_count} licenses
`});return Q}function c00(Y,X){let J=Y.length,z=Y.reduce((G,Z)=>{return G[Z.state||"unknown"]=(G[Z.state||"unknown"]||0)+1,G},{}),Q=`Total Assets: ${J}
`;return Q+=`Assets by State:
`,Object.entries(z).forEach(([G,Z])=>{Q+=`- ${G}: ${Z}
`}),Q}function d00(Y,X){return`Assets with expiring warranties: ${Y.length}
Recommend planning for replacements or warranty extensions.`}function l00(Y,X){let J=Y.reduce((Q,G)=>Q+(parseFloat(G.cost)||0),0),z=Y.length>0?J/Y.length:0;return`Total Portfolio Value: $${J.toLocaleString()}
Average Asset Cost: $${z.toLocaleString()}
Assets Analyzed: ${Y.length}`}var Nv={name:"snow_asset_discovery",description:"Discover and normalize assets from multiple sources",category:"asset-management",subcategory:"discovery",use_cases:["discovery","asset-management","normalization"],complexity:"advanced",frequency:"medium",permission:"write",allowedRoles:["developer","admin"],inputSchema:{type:"object",properties:{discovery_source:{type:"string",description:"Discovery source",enum:["network_scan","agent_based","manual_import","csv_upload"]},ip_range:{type:"string",description:"IP range for network discovery (CIDR notation)"},normalize_duplicates:{type:"boolean",description:"Automatically normalize duplicate assets"},create_relationships:{type:"boolean",description:"Create CI relationships automatically"}},required:["discovery_source"]}};async function qv(Y,X){let{discovery_source:J,ip_range:z,normalize_duplicates:Q=!0,create_relationships:G=!0}=Y;try{let Z=await x(X),$;switch(J){case"network_scan":if(!z)return M("IP range required for network scan");$=await i00(Z,z);break;case"agent_based":$=await n00(Z);break;case"manual_import":$=await o00(Z);break;case"csv_upload":$=await a00(Z);break;default:return M(`Unknown discovery source: ${J}`)}return N({discovery_source:J,assets_discovered:$.count,duplicates_normalized:Q?$.duplicates:0,relationships_created:G?$.relationships:0,discovery_status:$.status})}catch(Z){return M(Z.message)}}async function i00(Y,X){let J=await Y.post("/api/now/table/discovery_schedule",{name:`Network Discovery - ${X}`,type:"network",ip_range:X,active:!0});return{count:0,duplicates:0,relationships:0,status:"scheduled"}}async function n00(Y){return{count:0,duplicates:0,relationships:0,status:"initiated"}}async function o00(Y){return{count:0,duplicates:0,relationships:0,status:"ready_for_import"}}async function a00(Y){return{count:0,duplicates:0,relationships:0,status:"ready_for_upload"}}var xv={name:"snow_manage_software_license",description:"Manage software licenses with compliance tracking and optimization",category:"asset-management",subcategory:"license-management",use_cases:["licenses","compliance","sam"],complexity:"intermediate",frequency:"high",permission:"write",allowedRoles:["developer","admin"],inputSchema:{type:"object",properties:{license_name:{type:"string",description:"Software license name"},publisher:{type:"string",description:"Software publisher/vendor"},licensed_installs:{type:"number",description:"Number of licensed installations"},license_type:{type:"string",description:"Type of license",enum:["named_user","concurrent_user","server","enterprise"]},cost_per_license:{type:"number",description:"Cost per license"},expiration_date:{type:"string",description:"License expiration (YYYY-MM-DD)"},auto_renew:{type:"boolean",description:"Automatic renewal enabled"}},required:["license_name","publisher","licensed_installs"]}};async function Fv(Y,X){let{license_name:J,publisher:z,licensed_installs:Q,license_type:G="named_user",cost_per_license:Z=0,expiration_date:$,auto_renew:H=!1}=Y;try{let W=await x(X),K=await W.get(`/api/now/table/alm_license?sysparm_query=display_name=${J}^publisher=${z}&sysparm_limit=1`);if(K.data.result.length>0){let U=K.data.result[0].sys_id,B=await W.patch(`/api/now/table/alm_license/${U}`,{license_count:Q,license_type:G,cost:Z,expiration_date:$,auto_renew:H});return N({action:"updated",license:B.data.result,annual_cost:Z*Q})}else{let U=await W.post("/api/now/table/alm_license",{display_name:J,publisher:z,license_count:Q,license_type:G,cost:Z,expiration_date:$,auto_renew:H});return N({action:"created",license:U.data.result,annual_cost:Z*Q})}}catch(W){return M(W.message)}}var Pv={name:"snow_optimize_licenses",description:"Analyze license usage and provide optimization recommendations",category:"asset-management",subcategory:"license-management",use_cases:["optimization","cost-reduction","sam"],complexity:"advanced",frequency:"medium",permission:"write",allowedRoles:["developer","admin"],inputSchema:{type:"object",properties:{software_name:{type:"string",description:"Specific software to analyze (optional)"},optimization_type:{type:"string",description:"Type of optimization",enum:["cost_reduction","compliance","usage_efficiency"]},threshold_percentage:{type:"number",description:"Usage threshold for optimization (default 80)"}}}};async function Av(Y,X){let{software_name:J,optimization_type:z="cost_reduction",threshold_percentage:Q=80}=Y;try{let G=await x(X),Z=J?`display_nameCONTAINS${J}`:"",H=(await G.get(`/api/now/table/alm_license?sysparm_query=${Z}`)).data.result;if(H.length===0)return M("No licenses found for analysis");let K=(await Promise.all(H.map(async(B)=>{let O=`license=${B.sys_id}`,L=(await G.get(`/api/now/table/alm_license_usage?sysparm_query=${O}`)).data.result.length,q=parseInt(B.license_count)||0,F=q>0?L/q*100:0,P=parseFloat(B.cost)||0,A=0,w="";if(F<50)A=P*q*0.5,w="Consider reducing licenses by 50%";else if(F<Q){let v=q-Math.ceil(L*1.2);A=P*v,w=`Consider reducing by ${v} licenses`}else if(F>95)w="Consider increasing licenses to avoid compliance issues";else w="Optimal usage - no changes recommended";return{license_name:B.display_name,publisher:B.publisher,total_licenses:q,used_licenses:L,usage_percentage:F.toFixed(1),potential_savings:A.toFixed(2),recommendation:w}}))).filter((B)=>parseFloat(B.potential_savings)>0),U=K.reduce((B,O)=>B+parseFloat(O.potential_savings),0);return N({optimization_type:z,threshold_percentage:Q,total_licenses_analyzed:H.length,optimization_opportunities:K.length,potential_annual_savings:U.toFixed(2),optimizations:K.slice(0,10),recommendations:s00(z,K)})}catch(G){return M(G.message)}}function s00(Y,X){let J=[];if(Y==="cost_reduction")J.push("Implement license harvesting for unused installations"),J.push("Negotiate better terms with publishers based on actual usage"),J.push("Consider switching to concurrent licensing for lower cost");else if(Y==="compliance")J.push("Monitor high-usage licenses to avoid compliance violations"),J.push("Implement automated license reclamation processes"),J.push("Regular compliance audits recommended");else J.push("Implement usage monitoring dashboards"),J.push("Set up alerts for license threshold breaches"),J.push("Review license types for better efficiency");return J}var wv={name:"snow_track_asset_lifecycle",description:"Track complete asset lifecycle from procurement to disposal",category:"asset-management",subcategory:"asset-lifecycle",use_cases:["lifecycle","tracking","audit-trail"],complexity:"intermediate",frequency:"high",permission:"write",allowedRoles:["developer","admin"],inputSchema:{type:"object",properties:{asset_sys_id:{type:"string",description:"Asset sys_id to track"},action:{type:"string",description:"Lifecycle action",enum:["procure","receive","deploy","transfer","retire","dispose"]},reason:{type:"string",description:"Reason for lifecycle change"},user_sys_id:{type:"string",description:"User performing the action"},notes:{type:"string",description:"Additional notes"}},required:["asset_sys_id","action"]}};async function Tv(Y,X){let{asset_sys_id:J,action:z,reason:Q,user_sys_id:G,notes:Z}=Y;try{let $=await x(X),H=await $.get(`/api/now/table/alm_asset/${J}`);if(!H.data.result)return M(`Asset ${J} not found`);let W=H.data.result,U={procure:"on_order",receive:"in_stock",deploy:"deployed",transfer:"deployed",retire:"retired",dispose:"disposed"}[z];if(U&&U!==W.state)await $.patch(`/api/now/table/alm_asset/${J}`,{state:U});return await $.post("/api/now/table/alm_audit",{asset:J,action:z,state:U||W.state,user:G||"system",reason:Q||`Asset ${z} via Snow-Flow automation`,notes:Z||"",timestamp:new Date().toISOString()}),N({asset_tag:W.asset_tag,display_name:W.display_name,action:z,previous_state:W.state,new_state:U||W.state,reason:Q||"Automated via Snow-Flow",notes:Z})}catch($){return M($.message)}}var wG={};G0(wG,{snow_vulnerability_risk_assessment_exec:()=>WD,snow_vulnerability_risk_assessment_def:()=>HD,snow_security_risk_assessment_exec:()=>av,snow_security_risk_assessment_def:()=>ov,snow_security_dashboard_exec:()=>$D,snow_security_dashboard_def:()=>ZD,snow_scan_vulnerabilities_exec:()=>dv,snow_scan_vulnerabilities_def:()=>cv,snow_run_compliance_scan_exec:()=>pv,snow_run_compliance_scan_def:()=>gv,snow_execute_security_playbook_exec:()=>GD,snow_execute_security_playbook_def:()=>QD,snow_escalate_permissions_exec:()=>uv,snow_escalate_permissions_def:()=>mv,snow_discover_security_policies_exec:()=>hv,snow_discover_security_policies_def:()=>yv,snow_discover_security_frameworks_exec:()=>fv,snow_discover_security_frameworks_def:()=>Rv,snow_create_vulnerability_scan_exec:()=>bv,snow_create_vulnerability_scan_def:()=>_v,snow_create_security_policy_exec:()=>kv,snow_create_security_policy_def:()=>Sv,snow_create_security_incident_exec:()=>zD,snow_create_security_incident_def:()=>JD,snow_create_compliance_rule_exec:()=>Ev,snow_create_compliance_rule_def:()=>Cv,snow_create_audit_rule_exec:()=>jv,snow_create_audit_rule_def:()=>Dv,snow_create_access_control_exec:()=>vv,snow_create_access_control_def:()=>Iv,snow_automate_threat_response_exec:()=>XD,snow_automate_threat_response_def:()=>YD,snow_audit_trail_analysis_exec:()=>ev,snow_audit_trail_analysis_def:()=>tv,snow_analyze_threat_intelligence_exec:()=>rv,snow_analyze_threat_intelligence_def:()=>sv});var Iv={name:"snow_create_access_control",description:"Createaccesscontrol",category:"security",subcategory:"access-control",use_cases:["configuration","security","compliance"],complexity:"intermediate",frequency:"medium",permission:"write",allowedRoles:["developer","admin"],inputSchema:{type:"object",properties:{name:{type:"string"},table:{type:"string"},operation:{type:"string"},roles:{type:"array",items:{type:"string"}},condition:{type:"string"},advanced:{type:"boolean"},active:{type:"boolean"}},required:["name","table","operation"]}};async function vv(Y,X){return{success:!0,data:{name:Y.name,table:Y.table,operation:Y.operation,roles:Y.roles||[],condition:Y.condition||"",advanced:Y.advanced||!1,active:Y.active!==!1},summary:`Access control "${Y.name}" prepared for table: ${Y.table}`}}var Dv={name:"snow_create_audit_rule",description:"Createauditrule",category:"security",subcategory:"audit-rules",use_cases:["configuration","security","compliance"],complexity:"intermediate",frequency:"medium",permission:"write",allowedRoles:["developer","admin"],inputSchema:{type:"object",properties:{name:{type:"string"},table:{type:"string"},events:{type:"array",items:{type:"string"}},fields:{type:"array",items:{type:"string"}},retention:{type:"number"},filter:{type:"string"},active:{type:"boolean"}},required:["name","table","events"]}};async function jv(Y,X){return{success:!0,data:{name:Y.name,table:Y.table,events:Y.events,fields:Y.fields||[],retention:Y.retention||90,filter:Y.filter||"",active:Y.active!==!1},summary:`Audit rule "${Y.name}" prepared for table: ${Y.table}`}}var Cv={name:"snow_create_compliance_rule",description:"Creates compliance rules for regulatory frameworks (SOX, GDPR, HIPAA). Defines validation, remediation, and severity levels.",category:"security",subcategory:"compliance",use_cases:["rules","security","compliance"],complexity:"intermediate",frequency:"medium",permission:"write",allowedRoles:["developer","admin"],inputSchema:{type:"object",properties:{name:{type:"string",description:"Compliance rule name"},framework:{type:"string",description:"Compliance framework (SOX, GDPR, HIPAA, etc.)"},requirement:{type:"string",description:"Specific requirement or control"},validation:{type:"string",description:"Validation script or condition"},remediation:{type:"string",description:"Remediation actions"},severity:{type:"string",description:"Severity level (critical, high, medium, low)"},active:{type:"boolean",description:"Rule active status"}},required:["name","framework","requirement","validation"]}};async function Ev(Y,X){return{success:!0,data:{name:Y.name,framework:Y.framework,requirement:Y.requirement,validation:Y.validation,remediation:Y.remediation||"",severity:Y.severity||"medium",active:Y.active!==!1},summary:`Compliance rule "${Y.name}" prepared for framework: ${Y.framework}`}}var Sv={name:"snow_create_security_policy",description:"Creates security policies for access control and data protection. Configures enforcement levels, scope, and rule sets.",category:"security",subcategory:"policies",use_cases:["configuration","security","compliance"],complexity:"intermediate",frequency:"medium",permission:"write",allowedRoles:["developer","admin"],inputSchema:{type:"object",properties:{name:{type:"string",description:"Security policy name"},type:{type:"string",description:"Policy type (access, data, network, etc.)"},description:{type:"string",description:"Policy description"},enforcement:{type:"string",description:"Enforcement level (strict, moderate, advisory)"},scope:{type:"string",description:"Policy scope (global, application, table)"},rules:{type:"array",items:{type:"string"},description:"Security rules and conditions"},active:{type:"boolean",description:"Policy active status"}},required:["name","type","rules"]}};async function kv(Y,X){return{success:!0,data:{name:Y.name,type:Y.type,description:Y.description||"",enforcement:Y.enforcement||"moderate",scope:Y.scope||"global",rules:Y.rules||[],active:Y.active!==!1},summary:`Security policy "${Y.name}" prepared with type: ${Y.type}`}}var _v={name:"snow_create_vulnerability_scan",description:"Creates vulnerability scanning configurations. Schedules scans, sets severity thresholds, and enables auto-remediation.",category:"security",subcategory:"vulnerability-scanning",use_cases:["scanning","security","compliance"],complexity:"intermediate",frequency:"medium",permission:"write",allowedRoles:["developer","admin"],inputSchema:{type:"object",properties:{name:{type:"string",description:"Scan name"},scope:{type:"string",description:"Scan scope (application, platform, integrations)"},schedule:{type:"string",description:"Scan schedule"},severity:{type:"string",description:"Minimum severity to report"},notifications:{type:"array",items:{type:"string"},description:"Notification recipients"},remediation:{type:"boolean",description:"Auto-remediation enabled"},active:{type:"boolean",description:"Scan active status"}},required:["name","scope"]}};async function bv(Y,X){return{success:!0,data:{name:Y.name,scope:Y.scope,schedule:Y.schedule||"weekly",severity:Y.severity||"medium",notifications:Y.notifications||[],remediation:Y.remediation||!1,active:Y.active!==!1},summary:`Vulnerability scan "${Y.name}" prepared for scope: ${Y.scope}`}}var Rv={name:"snow_discover_security_frameworks",description:"Discovers security and compliance frameworks available in the instance for policy creation and auditing.",category:"security",subcategory:"frameworks",use_cases:["discovery","security","compliance"],complexity:"intermediate",frequency:"medium",permission:"read",allowedRoles:["developer","stakeholder","admin"],inputSchema:{type:"object",properties:{type:{type:"string",description:"Framework type (security, compliance, audit)"}}}};async function fv(Y,X){return{success:!0,data:{type:Y?.type||"all",frameworks:[]},summary:`Security frameworks discovery prepared for type: ${Y?.type||"all"}`}}var yv={name:"snow_discover_security_policies",description:"Lists existing security policies and rules with filtering by category and active status.",category:"security",subcategory:"policies",use_cases:["security-audit","policy-discovery","compliance"],complexity:"beginner",frequency:"medium",permission:"read",allowedRoles:["developer","stakeholder","admin"],inputSchema:{type:"object",properties:{category:{type:"string",description:"Policy category filter"},active:{type:"boolean",description:"Filter by active status"}}}};async function hv(Y,X){return{success:!0,data:{category:Y?.category,active:Y?.active,policies:[]},summary:`Security policies discovery prepared${Y?.category?` for category: ${Y.category}`:""}`}}var mv={name:"snow_escalate_permissions",description:"Escalate user permissions with approval workflow and time-based access controls",category:"security",subcategory:"permissions",use_cases:["escalation","security","compliance"],complexity:"intermediate",frequency:"medium",permission:"write",allowedRoles:["developer","admin"],inputSchema:{type:"object",properties:{user_id:{type:"string",description:"User sys_id or username"},role:{type:"string",description:"Role to grant (admin, security_admin, etc.)"},duration:{type:"number",description:"Access duration in hours (0 = permanent)"},justification:{type:"string",description:"Business justification for escalation"},approver:{type:"string",description:"Approver sys_id or username"},require_approval:{type:"boolean",description:"Require approval before granting"}},required:["user_id","role","justification"]}};async function uv(Y,X){let{user_id:J,role:z,duration:Q=24,justification:G,approver:Z,require_approval:$=!0}=Y;return{success:!0,data:{user_id:J,role:z,duration:Q,justification:G,approver:Z,require_approval:$},summary:`Permission escalation prepared for user ${J} with role: ${z}`}}var gv={name:"snow_run_compliance_scan",description:"Run compliance scans against security frameworks (SOX, GDPR, HIPAA, PCI-DSS)",category:"security",subcategory:"compliance",use_cases:["security","compliance","audit"],complexity:"advanced",frequency:"medium",permission:"read",allowedRoles:["developer","stakeholder","admin"],inputSchema:{type:"object",properties:{framework:{type:"string",description:"Compliance framework to scan against",enum:["sox","gdpr","hipaa","pci_dss","iso27001","nist"]},scope:{type:"string",description:"Scan scope",enum:["full","critical_only","incremental"],default:"full"},target_table:{type:"string",description:"Specific table to scan (optional)"},generate_report:{type:"boolean",description:"Generate compliance report",default:!0}},required:["framework"]}};async function pv(Y,X){let{framework:J,scope:z="full",target_table:Q,generate_report:G=!0}=Y;try{let Z=await x(X),$={framework:J,scope:z,status:"in_progress",started_at:new Date().toISOString()};if(Q)$.target_table=Q;let W=(await Z.post("/api/now/table/sn_compliance_scan",$)).data.result.sys_id,K=await r00(Z,J,z,Q);await Z.patch(`/api/now/table/sn_compliance_scan/${W}`,{status:"completed",completed_at:new Date().toISOString(),total_checks:K.total_checks,passed:K.passed,failed:K.failed,warnings:K.warnings});let U=null;if(G)U=(await Z.post("/api/now/table/sn_compliance_report",{scan_id:W,framework:J,results:JSON.stringify(K),generated_at:new Date().toISOString()})).data.result.sys_id;return N({scan_id:W,report_id:U,results:K,compliance_score:Y10(K)},{framework:J,scope:z})}catch(Z){return M(Z.message)}}async function r00(Y,X,J,z){let Q=t00(X),G={total_checks:Q.length,passed:0,failed:0,warnings:0,violations:[]};for(let Z of Q)try{let $=await e00(Y,Z,z);if($.status==="passed")G.passed++;else if($.status==="failed")G.failed++,G.violations.push({check_id:Z.id,check_name:Z.name,severity:Z.severity,details:$.details});else if($.status==="warning")G.warnings++,G.violations.push({check_id:Z.id,check_name:Z.name,severity:"warning",details:$.details})}catch($){G.warnings++}return G}function t00(Y){return{sox:[{id:"SOX-001",name:"Audit Trail Enabled",severity:"critical",table:"sys_audit"},{id:"SOX-002",name:"User Access Reviews",severity:"high",table:"sys_user_role"},{id:"SOX-003",name:"Change Management",severity:"high",table:"sys_update_set"}],gdpr:[{id:"GDPR-001",name:"Data Encryption",severity:"critical",table:"sys_properties"},{id:"GDPR-002",name:"Data Retention Policies",severity:"high",table:"sys_data_policy"},{id:"GDPR-003",name:"User Consent Management",severity:"critical",table:"sys_user"}],hipaa:[{id:"HIPAA-001",name:"PHI Encryption",severity:"critical",table:"sys_properties"},{id:"HIPAA-002",name:"Access Controls",severity:"critical",table:"sys_security_acl"},{id:"HIPAA-003",name:"Audit Logging",severity:"high",table:"sys_audit"}],pci_dss:[{id:"PCI-001",name:"Cardholder Data Protection",severity:"critical",table:"sys_properties"},{id:"PCI-002",name:"Network Security",severity:"critical",table:"sys_security"},{id:"PCI-003",name:"Access Restrictions",severity:"high",table:"sys_security_acl"}],iso27001:[{id:"ISO-001",name:"Information Security Policy",severity:"high",table:"sys_properties"},{id:"ISO-002",name:"Risk Assessment",severity:"high",table:"risk_assessment"},{id:"ISO-003",name:"Security Controls",severity:"critical",table:"sys_security_acl"}],nist:[{id:"NIST-001",name:"Identity Management",severity:"high",table:"sys_user"},{id:"NIST-002",name:"Access Control",severity:"critical",table:"sys_security_acl"},{id:"NIST-003",name:"System Hardening",severity:"high",table:"sys_properties"}]}[Y]||[]}async function e00(Y,X,J){if(J&&X.table!==J)return{status:"skipped"};try{let z=await Y.get(`/api/now/table/${X.table}`,{params:{sysparm_limit:1}}),Q=z.data.result&&z.data.result.length>0;return{status:Q?"passed":"warning",details:Q?"Check passed":"No records found for validation"}}catch(z){return{status:"failed",details:`Check failed: ${z}`}}}function Y10(Y){let X=Y.total_checks;if(X===0)return 100;let J=(Y.passed+Y.warnings*0.5)/X*100;return Math.round(J*10)/10}var cv={name:"snow_scan_vulnerabilities",description:"Scan for security vulnerabilities",category:"security",subcategory:"vulnerability-management",use_cases:["security","vulnerabilities","scanning"],complexity:"intermediate",frequency:"high",permission:"read",allowedRoles:["developer","stakeholder","admin"],inputSchema:{type:"object",properties:{target:{type:"string"},scan_type:{type:"string",enum:["full","quick"]}},required:["target"]}};async function dv(Y,X){let{target:J,scan_type:z="quick"}=Y;try{let Q=await x(X),G={target:J,scan_type:z},Z=await Q.post("/api/now/table/sn_vul_scan",G);return N({scan_started:!0,scan:Z.data.result})}catch(Q){return M(Q.message)}}var ov={name:"snow_security_risk_assessment",description:"Perform comprehensive security risk assessment analyzing access controls, vulnerabilities, and security posture",category:"security",subcategory:"risk-assessment",use_cases:["security","risk","assessment"],complexity:"advanced",frequency:"medium",permission:"read",allowedRoles:["developer","stakeholder","admin"],inputSchema:{type:"object",properties:{assessment_type:{type:"string",description:"Type of security assessment",enum:["access_control","vulnerability","configuration","full"],default:"full"},target_scope:{type:"string",description:"Assessment scope",enum:["instance","application","table","user"],default:"instance"},target_id:{type:"string",description:"Target identifier (app sys_id, table name, or user sys_id)"},risk_threshold:{type:"string",description:"Minimum risk level to report",enum:["critical","high","medium","low"],default:"medium"}},required:["assessment_type"]}};async function av(Y,X){let{assessment_type:J,target_scope:z="instance",target_id:Q,risk_threshold:G="medium"}=Y;try{let Z=await x(X),$={assessment_type:J,target_scope:z,risk_threshold:G,status:"in_progress",started_at:new Date().toISOString()};if(Q)$.target_id=Q;let W=(await Z.post("/api/now/table/risk_assessment",$)).data.result.sys_id,K={};switch(J){case"access_control":K=await lv(Z,z,Q);break;case"vulnerability":K=await iv(Z,z,Q);break;case"configuration":K=await nv(Z,z,Q);break;case"full":K={access_control:await lv(Z,z,Q),vulnerabilities:await iv(Z,z,Q),configuration:await nv(Z,z,Q)};break}let U=X10(K,G);return await Z.patch(`/api/now/table/risk_assessment/${W}`,{status:"completed",completed_at:new Date().toISOString(),risk_score:U.overall,findings:JSON.stringify(K)}),N({assessment_id:W,risk_score:U,findings:K,recommendations:J10(K,G)},{assessment_type:J,target_scope:z})}catch(Z){return M(Z.message)}}async function lv(Y,X,J){let z={excessive_permissions:[],weak_acls:[],privileged_users:[]};try{let G=(await Y.get("/api/now/table/sys_user_has_role",{params:{sysparm_query:"role.name=admin^ORrole.name=security_admin",sysparm_limit:100}})).data.result||[];if(G.length>10)z.excessive_permissions.push({severity:"high",issue:"Excessive admin users",count:G.length,recommendation:"Review and reduce admin role assignments"});let H=((await Y.get("/api/now/table/sys_security_acl",{params:{sysparm_query:"active=true",sysparm_limit:50}})).data.result||[]).filter((W)=>!W.script&&!W.condition);if(H.length>0)z.weak_acls.push({severity:"medium",issue:"ACLs without conditions",count:H.length,recommendation:"Add conditions to ACL rules"})}catch(Q){z.excessive_permissions.push({severity:"warning",issue:"Unable to complete access control assessment",details:String(Q)})}return z}async function iv(Y,X,J){let z={known_vulnerabilities:[],outdated_components:[],security_patches:[]};try{let Z=((await Y.get("/api/now/table/sn_vul_vulnerable_item",{params:{sysparm_query:"state=open",sysparm_limit:100}})).data.result||[]).filter(($)=>$.severity==="1"||$.severity==="2");if(Z.length>0)z.known_vulnerabilities.push({severity:"critical",issue:"Open critical vulnerabilities",count:Z.length,recommendation:"Prioritize remediation of critical vulnerabilities"})}catch(Q){z.known_vulnerabilities.push({severity:"info",issue:"Vulnerability assessment not available",details:"Vulnerability management plugin may not be active"})}return z}async function nv(Y,X,J){let z={security_properties:[],encryption_status:[],authentication:[]};try{let Q=["glide.ui.security.allow_codetag","glide.script.block.escape.functions","glide.ui.strict_customer_uploaded_static_content"];for(let G of Q){let $=(await Y.get("/api/now/table/sys_properties",{params:{sysparm_query:`name=${G}`,sysparm_limit:1}})).data.result?.[0];if($&&$.value!=="true")z.security_properties.push({severity:"medium",issue:`Insecure property: ${G}`,current_value:$.value,recommendation:"Set to true for enhanced security"})}}catch(Q){z.security_properties.push({severity:"warning",issue:"Unable to assess security properties",details:String(Q)})}return z}function X10(Y,X){let J=0,z=0,Q=0,G=0,Z=(H)=>{if(Array.isArray(H))H.forEach((W)=>{switch(W.severity){case"critical":J++;break;case"high":z++;break;case"medium":Q++;break;case"low":G++;break}});else if(typeof H==="object")Object.values(H).forEach(Z)};Z(Y);let $=J*10+z*5+Q*2+G;return{overall:$,by_severity:{critical:J,high:z,medium:Q,low:G},risk_level:$>50?"critical":$>20?"high":$>10?"medium":"low"}}function J10(Y,X){let J=[],z=(Q)=>{if(Array.isArray(Q))Q.forEach((G)=>{if(G.recommendation)J.push(`[${G.severity.toUpperCase()}] ${G.recommendation}`)});else if(typeof Q==="object")Object.values(Q).forEach(z)};return z(Y),J}var sv={name:"snow_analyze_threat_intelligence",description:"Analyzethreatintelligence",category:"security",subcategory:"threat-intelligence",use_cases:["analysis","security","compliance"],complexity:"intermediate",frequency:"medium",permission:"read",allowedRoles:["developer","stakeholder","admin"],inputSchema:{type:"object",properties:{ioc_value:{type:"string"},ioc_type:{type:"string",enum:["ip","domain","hash_md5","hash_sha1","hash_sha256","url","email"]},threat_feed_sources:{type:"array",items:{type:"string"}},correlation_timeframe:{type:"string",enum:["1_hour","24_hours","7_days","30_days"]}},required:["ioc_value","ioc_type"]}};async function rv(Y,X){return{success:!0,data:{ioc_value:Y.ioc_value,ioc_type:Y.ioc_type,threat_feed_sources:Y.threat_feed_sources||[],correlation_timeframe:Y.correlation_timeframe||"24_hours"},summary:`Threat intelligence analysis prepared for ${Y.ioc_type}: ${Y.ioc_value}`}}var tv={name:"snow_audit_trail_analysis",description:"Audittrailanalysis",category:"security",subcategory:"audit-trail",use_cases:["analysis","security","compliance"],complexity:"intermediate",frequency:"medium",permission:"read",allowedRoles:["developer","stakeholder","admin"],inputSchema:{type:"object",properties:{timeframe:{type:"string"},user:{type:"string"},table:{type:"string"},anomalies:{type:"boolean"},exportFormat:{type:"string",enum:["json","csv","pdf"]}}}};async function ev(Y,X){return{success:!0,data:{timeframe:Y.timeframe||"24h",user:Y.user,table:Y.table,anomalies:Y.anomalies||!1,exportFormat:Y.exportFormat||"json"},summary:`Audit trail analysis prepared for timeframe: ${Y.timeframe||"24h"}`}}var YD={name:"snow_automate_threat_response",description:"Automatethreatresponse",category:"security",subcategory:"threat-response",use_cases:["automation","security","compliance"],complexity:"intermediate",frequency:"medium",permission:"write",allowedRoles:["developer","admin"],inputSchema:{type:"object",properties:{threat_id:{type:"string"},response_level:{type:"string",enum:["contain","isolate","eradicate","recover"]},automated_actions:{type:"boolean"},notification_groups:{type:"array",items:{type:"string"}}},required:["threat_id","response_level"]}};async function XD(Y,X){return{success:!0,data:{threat_id:Y.threat_id,response_level:Y.response_level,automated_actions:Y.automated_actions||!1,notification_groups:Y.notification_groups||[]},summary:`Threat response prepared for ${Y.threat_id} at level: ${Y.response_level}`}}var JD={name:"snow_create_security_incident",description:"Create security incident with automated threat correlation and priority assignment",category:"security",subcategory:"incidents",use_cases:["logging","security","compliance"],complexity:"intermediate",frequency:"medium",permission:"write",allowedRoles:["developer","admin"],inputSchema:{type:"object",properties:{title:{type:"string",description:"Security incident title"},description:{type:"string",description:"Detailed incident description"},priority:{type:"string",description:"Incident priority",enum:["critical","high","medium","low"]},threat_type:{type:"string",description:"Type of security threat",enum:["malware","phishing","data_breach","unauthorized_access","ddos","insider_threat"]},affected_systems:{type:"array",items:{type:"string"},description:"List of affected system CIs"},iocs:{type:"array",items:{type:"string"},description:"Indicators of Compromise (IOCs)"},source:{type:"string",description:"Incident source (SIEM, manual, automated)"}},required:["title","description","threat_type"]}};async function zD(Y,X){let{title:J,description:z,priority:Q="medium",threat_type:G,affected_systems:Z=[],iocs:$=[],source:H="manual"}=Y;return{success:!0,data:{title:J,description:z,priority:Q,threat_type:G,affected_systems:Z,iocs:$,source:H},summary:`Security incident "${J}" prepared with priority: ${Q}`}}var QD={name:"snow_execute_security_playbook",description:"Execute automated security response playbook with orchestrated actions",category:"security",subcategory:"playbooks",use_cases:["execution","security","compliance"],complexity:"intermediate",frequency:"medium",permission:"write",allowedRoles:["developer","admin"],inputSchema:{type:"object",properties:{playbook_id:{type:"string",description:"Security playbook sys_id"},incident_id:{type:"string",description:"Related security incident sys_id"},execution_mode:{type:"string",description:"Execution mode",enum:["automatic","semi_automatic","manual_approval"]},parameters:{type:"object",description:"Playbook execution parameters"}},required:["playbook_id","incident_id"]}};async function GD(Y,X){let{playbook_id:J,incident_id:z,execution_mode:Q="semi_automatic",parameters:G={}}=Y;return{success:!0,data:{playbook_id:J,incident_id:z,execution_mode:Q,parameters:G},summary:`Security playbook ${J} prepared for incident: ${z}`}}var ZD={name:"snow_security_dashboard",description:"Generate real-time security operations dashboard with key metrics",category:"security",subcategory:"dashboard",use_cases:["monitoring","security","compliance"],complexity:"intermediate",frequency:"medium",permission:"read",allowedRoles:["developer","stakeholder","admin"],inputSchema:{type:"object",properties:{dashboard_type:{type:"string",description:"Dashboard type",enum:["executive","analyst","incident_response","compliance"]},time_range:{type:"string",description:"Time range for metrics",enum:["24_hours","7_days","30_days","90_days"]},include_trends:{type:"boolean",description:"Include trend analysis"},export_format:{type:"string",description:"Export format",enum:["json","pdf","csv"]}},required:["dashboard_type"]}};async function $D(Y,X){let{dashboard_type:J,time_range:z="24_hours",include_trends:Q=!1,export_format:G="json"}=Y;return{success:!0,data:{dashboard_type:J,time_range:z,include_trends:Q,export_format:G},summary:`Security dashboard prepared for type: ${J}`}}var HD={name:"snow_vulnerability_risk_assessment",description:"Assess vulnerability risk with automated CVSS scoring and remediation planning",category:"security",subcategory:"risk-assessment",use_cases:["vulnerabilities","security","compliance"],complexity:"intermediate",frequency:"medium",permission:"read",allowedRoles:["developer","stakeholder","admin"],inputSchema:{type:"object",properties:{cve_id:{type:"string",description:"CVE identifier (e.g., CVE-2024-1234)"},affected_assets:{type:"array",items:{type:"string"},description:"List of affected asset sys_ids"},assessment_type:{type:"string",description:"Assessment type",enum:["automated","manual","hybrid"]},business_context:{type:"string",description:"Business context for risk calculation"}},required:["cve_id"]}};async function WD(Y,X){let{cve_id:J,affected_assets:z=[],assessment_type:Q="automated",business_context:G}=Y;return{success:!0,data:{cve_id:J,affected_assets:z,assessment_type:Q,business_context:G},summary:`Vulnerability risk assessment prepared for CVE: ${J}`}}var TG={};G0(TG,{snow_schedule_report_delivery_exec:()=>xD,snow_schedule_report_delivery_def:()=>qD,snow_define_kpi_exec:()=>ND,snow_define_kpi_def:()=>LD,snow_create_report_exec:()=>UD,snow_create_report_def:()=>KD,snow_create_dashboard_exec:()=>VD,snow_create_dashboard_def:()=>BD,snow_analyze_data_quality_exec:()=>MD,snow_analyze_data_quality_def:()=>OD});var KD={name:"snow_create_report",description:"Create ServiceNow report",category:"reporting",subcategory:"reports",use_cases:["reporting","visualization","analytics"],complexity:"beginner",frequency:"high",permission:"write",allowedRoles:["developer","admin"],inputSchema:{type:"object",properties:{title:{type:"string"},table:{type:"string"},type:{type:"string",enum:["bar","pie","line","list"]},filter:{type:"string"}},required:["title","table","type"]}};async function UD(Y,X){let{title:J,table:z,type:Q,filter:G}=Y;try{let Z=await x(X),$={title:J,table:z,type:Q};if(G)$.filter=G;let H=await Z.post("/api/now/table/sys_report",$);return N({created:!0,report:H.data.result})}catch(Z){return M(Z.message)}}var BD={name:"snow_create_dashboard",description:"Create interactive dashboards with multiple widgets",category:"reporting",subcategory:"dashboards",use_cases:["dashboards","visualization","analytics"],complexity:"intermediate",frequency:"medium",permission:"write",allowedRoles:["developer","admin"],inputSchema:{type:"object",properties:{name:{type:"string",description:"Dashboard name"},description:{type:"string",description:"Dashboard description"},layout:{type:"string",description:"Dashboard layout (grid, tabs, accordion)",enum:["grid","tabs","accordion"]},widgets:{type:"array",items:{type:"string"},description:"Dashboard widgets configuration"},permissions:{type:"array",description:"User/role permissions",items:{type:"string"}},refresh_interval:{type:"number",description:"Auto-refresh interval in minutes"},public:{type:"boolean",description:"Public dashboard"}},required:["name","widgets"]}};async function VD(Y,X){let{name:J,description:z,layout:Q="grid",widgets:G=[],permissions:Z=[],refresh_interval:$=15,public:H=!1}=Y;try{let W=await x(X),K={name:J,title:J,description:z||"",layout:Q,refresh_interval:$,active:!0,roles:Z.join(","),public:H},U=await W.post("/api/now/table/pa_dashboards",K);if(!U.data.result)return M("Failed to create dashboard");let B=U.data.result.sys_id;if(G.length>0)for(let O of G)await W.post("/api/now/table/pa_widgets",{dashboard:B,title:O.name||O.title,type:O.type||"chart",order:O.order||0,...O});return N({created:!0,dashboard:U.data.result,widgets_added:G.length})}catch(W){return M(W.message)}}var OD={name:"snow_analyze_data_quality",description:"Analyze data quality including completeness, consistency, and accuracy metrics",category:"advanced",subcategory:"data-quality",use_cases:["data-quality","analysis","metrics"],complexity:"advanced",frequency:"medium",permission:"read",allowedRoles:["developer","stakeholder","admin"],inputSchema:{type:"object",properties:{table:{type:"string",description:"Table to analyze"},fields:{type:"array",description:"Specific fields to analyze",items:{type:"string"}},check_completeness:{type:"boolean",description:"Check data completeness"},check_consistency:{type:"boolean",description:"Check data consistency"},check_accuracy:{type:"boolean",description:"Check data accuracy"}},required:["table"]}};async function MD(Y,X){let{table:J,fields:z,check_completeness:Q=!0,check_consistency:G=!0,check_accuracy:Z=!0}=Y;try{let $=await x(X),H=1000,K=(await $.get(`/api/now/table/${J}?sysparm_limit=1000`)).data.result;if(K.length===0)return M("No data found in table");let U={table:J,total_records:K.length,completeness:Q?z10(K,z):null,consistency:G?Q10(K,z):null,accuracy:Z?G10(K,z):null,issues:[]},B=[];if(U.completeness)B.push(U.completeness.score);if(U.consistency)B.push(U.consistency.score);if(U.accuracy)B.push(U.accuracy.score);let O=B.length>0?B.reduce((V,L)=>V+L,0)/B.length:0;return N({...U,overall_quality_score:O.toFixed(1),sample_size:K.length})}catch($){return M($.message)}}function z10(Y,X){let J=X||Object.keys(Y[0]||{}),z=J.length,Q=0;return J.forEach((G)=>{if(Y.filter(($)=>$[G]&&$[G]!=="").length/Y.length>0.8)Q++}),{score:Q/z*100,complete_fields:Q,total_fields:z}}function Q10(Y,X){let J=X||Object.keys(Y[0]||{}),z=J.length,Q=0;return J.forEach((G)=>{let Z=Y.map((H)=>H[G]).filter((H)=>H);if(new Set(Z).size<Z.length*0.5)Q++}),{score:Q/z*100,consistent_fields:Q,total_fields:z}}function G10(Y,X){let J=X||Object.keys(Y[0]||{}),z=J.length,Q=0;return J.forEach((G)=>{let Z=Y.map((H)=>H[G]).filter((H)=>H!==null&&H!==void 0&&H!=="");if(Z.length===0)return;let $=!0;if(G.includes("email"))$=Z.filter((W)=>/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(String(W))).length/Z.length>0.8;else if(G.includes("phone"))$=Z.filter((W)=>/^[\d\s\+\-\(\)]+$/.test(String(W))).length/Z.length>0.8;else if(G.includes("date"))$=Z.filter((W)=>!isNaN(Date.parse(String(W)))).length/Z.length>0.9;if($)Q++}),{score:z>0?Q/z*100:0,accurate_fields:Q,total_fields:z}}var LD={name:"snow_define_kpi",description:"Define Key Performance Indicators for monitoring",category:"reporting",subcategory:"kpi",use_cases:["kpi","monitoring","metrics"],complexity:"intermediate",frequency:"medium",permission:"write",allowedRoles:["developer","admin"],inputSchema:{type:"object",properties:{name:{type:"string",description:"KPI name"},description:{type:"string",description:"KPI description"},table:{type:"string",description:"Source table"},metric:{type:"string",description:"Metric to measure"},aggregation:{type:"string",description:"Aggregation function",enum:["count","sum","avg","max","min"]},conditions:{type:"string",description:"KPI conditions/filters"},target:{type:"number",description:"Target value"},threshold:{type:"object",description:"Threshold configuration"},unit:{type:"string",description:"Unit of measurement"},frequency:{type:"string",description:"Update frequency",enum:["hourly","daily","weekly","monthly"]}},required:["name","table","metric","aggregation"]}};async function ND(Y,X){let{name:J,description:z,table:Q,metric:G,aggregation:Z,conditions:$,target:H,threshold:W,unit:K,frequency:U="daily"}=Y;try{let B=await x(X),O={name:J,label:J,description:z||"",facts_table:Q,field:G,aggregate:Z.toUpperCase(),conditions:$||"",unit:K||"",frequency:U,active:!0,direction:H?"minimize":"maximize"};if(H)O.target=H;if(W)O.threshold_config=JSON.stringify(W);let V=await B.post("/api/now/table/pa_indicators",O);return N({created:!0,kpi:V.data.result})}catch(B){return M(B.message)}}var qD={name:"snow_schedule_report_delivery",description:"Schedule automated report delivery via email",category:"reporting",subcategory:"scheduling",use_cases:["scheduling","automation","delivery"],complexity:"intermediate",frequency:"medium",permission:"write",allowedRoles:["developer","admin"],inputSchema:{type:"object",properties:{report_name:{type:"string",description:"Source report name or sys_id"},schedule:{type:"string",description:"Schedule frequency",enum:["daily","weekly","monthly","quarterly"]},recipients:{type:"array",description:"Email recipients",items:{type:"string"}},format:{type:"string",description:"Report format",enum:["PDF","Excel","CSV"]},conditions:{type:"string",description:"Additional conditions"},subject:{type:"string",description:"Email subject"},message:{type:"string",description:"Email message"}},required:["report_name","schedule","recipients"]}};async function xD(Y,X){let{report_name:J,schedule:z,recipients:Q,format:G="PDF",conditions:Z,subject:$,message:H}=Y;try{let W=await x(X),K=await W.get(`/api/now/table/sys_report?sysparm_query=name=${J}^ORsys_id=${J}&sysparm_limit=1`);if(!K.data.result||K.data.result.length===0)return M(`Report not found: ${J}`);let U=K.data.result[0],B={name:`Scheduled: ${U.name||U.title}`,report:U.sys_id,schedule_type:z,email_list:Q.join(";"),export_format:G.toLowerCase(),condition:Z||"",subject:$||`Scheduled Report: ${U.name||U.title}`,body:H||"Please find the attached scheduled report.",active:!0},O=await W.post("/api/now/table/sysauto_report",B);return N({created:!0,scheduled_report:O.data.result,source_report:U.name||U.title,schedule:z,recipients:Q.length})}catch(W){return M(W.message)}}var IG={};G0(IG,{snow_employee_onboarding_exec:()=>wD,snow_employee_onboarding_def:()=>AD,snow_create_hr_case_exec:()=>PD,snow_create_hr_case_def:()=>FD,snow_create_customer_case_exec:()=>ID,snow_create_customer_case_def:()=>TD});var FD={name:"snow_create_hr_case",description:"Create HR service case",category:"itsm",subcategory:"hr",use_cases:["hr-service-delivery","case-management","hr"],complexity:"beginner",frequency:"high",permission:"write",allowedRoles:["developer","admin"],inputSchema:{type:"object",properties:{subject:{type:"string"},opened_for:{type:"string"},hr_service:{type:"string"},priority:{type:"number"}},required:["subject","hr_service"]}};async function PD(Y,X){let{subject:J,opened_for:z,hr_service:Q,priority:G}=Y;try{let Z=await x(X),$={subject:J,hr_service:Q};if(z)$.opened_for=z;if(G)$.priority=G;let H=await Z.post("/api/now/table/sn_hr_core_case",$);return N({created:!0,hr_case:H.data.result})}catch(Z){return M(Z.message)}}var AD={name:"snow_employee_onboarding",description:"Trigger employee onboarding workflow",category:"itsm",subcategory:"hr",use_cases:["hr-service-delivery","onboarding","lifecycle"],complexity:"intermediate",frequency:"medium",permission:"read",allowedRoles:["developer","stakeholder","admin"],inputSchema:{type:"object",properties:{employee_sys_id:{type:"string"},start_date:{type:"string"},department:{type:"string"}},required:["employee_sys_id","start_date"]}};async function wD(Y,X){let{employee_sys_id:J,start_date:z,department:Q}=Y;try{let G=await x(X),Z={employee:J,start_date:z};if(Q)Z.department=Q;let $=await G.post("/api/now/table/sn_hr_le_onboarding",Z);return N({initiated:!0,onboarding:$.data.result})}catch(G){return M(G.message)}}var TD={name:"snow_create_customer_case",description:"Create CSM customer case",category:"itsm",subcategory:"csm",use_cases:["customer-service","case-management","csm"],complexity:"beginner",frequency:"high",permission:"write",allowedRoles:["developer","admin"],inputSchema:{type:"object",properties:{subject:{type:"string"},account:{type:"string"},contact:{type:"string"},priority:{type:"number"}},required:["subject","account"]}};async function ID(Y,X){let{subject:J,account:z,contact:Q,priority:G}=Y;try{let Z=await x(X),$={subject:J,account:z};if(Q)$.contact=Q;if(G)$.priority=G;let H=await Z.post("/api/now/table/sn_customerservice_case",$);return N({created:!0,case:H.data.result})}catch(Z){return M(Z.message)}}var vG={};G0(vG,{snow_send_push_exec:()=>CD,snow_send_push_def:()=>jD,snow_send_notification_exec:()=>DD,snow_send_notification_def:()=>vD,snow_schedule_notification_exec:()=>mD,snow_schedule_notification_def:()=>hD,snow_notification_preferences_exec:()=>yD,snow_notification_preferences_def:()=>fD,snow_notification_analytics_exec:()=>RD,snow_notification_analytics_def:()=>bD,snow_emergency_broadcast_exec:()=>_D,snow_emergency_broadcast_def:()=>kD,snow_create_notification_template_exec:()=>SD,snow_create_notification_template_def:()=>ED});var vD={name:"snow_send_notification",description:"Send email/SMS notification",category:"automation",subcategory:"notifications",use_cases:["notifications","email","sms"],complexity:"beginner",frequency:"high",permission:"read",allowedRoles:["developer","stakeholder","admin"],inputSchema:{type:"object",properties:{users:{type:"array",items:{type:"string"}},subject:{type:"string"},message:{type:"string"},type:{type:"string",enum:["email","sms","push"]}},required:["users","subject","message"]}};async function DD(Y,X){let{users:J,subject:z,message:Q,type:G="email"}=Y;try{let Z=await x(X),$={users:J.join(","),subject:z,message:Q,type:G},H=await Z.post("/api/now/table/sysevent_email_action",$);return N({sent:!0,notification:H.data.result})}catch(Z){return M(Z.message)}}var jD={name:"snow_send_push",description:"Send mobile push notification",category:"automation",subcategory:"notifications",use_cases:["push-notifications","mobile","alerts"],complexity:"beginner",frequency:"high",permission:"read",allowedRoles:["developer","stakeholder","admin"],inputSchema:{type:"object",properties:{device_ids:{type:"array",items:{type:"string"}},title:{type:"string"},body:{type:"string"}},required:["device_ids","title","body"]}};async function CD(Y,X){let{device_ids:J,title:z,body:Q}=Y;try{let G=await x(X),Z={device_ids:J.join(","),title:z,body:Q},$=await G.post("/api/now/v1/push/notification",Z);return N({sent:!0,push:$.data.result})}catch(G){return M(G.message)}}var ED={name:"snow_create_notification_template",description:"Create reusable notification template with multi-channel support",category:"automation",subcategory:"notifications",use_cases:["templates","notifications","multi-channel"],complexity:"intermediate",frequency:"medium",permission:"write",allowedRoles:["developer","admin"],inputSchema:{type:"object",properties:{template_name:{type:"string",description:"Template name"},template_type:{type:"string",description:"Template type",enum:["incident","change","approval","alert","reminder"]},subject_template:{type:"string",description:'Subject template with variables (e.g., "Incident ${number} assigned")'},body_template:{type:"string",description:"Body template with variables"},channels:{type:"array",items:{type:"string"},description:"Supported channels",default:["email"]},active:{type:"boolean",description:"Template is active",default:!0}},required:["template_name","template_type","subject_template","body_template"]}};async function SD(Y,X){let{template_name:J,template_type:z,subject_template:Q,body_template:G,channels:Z=["email"],active:$=!0}=Y;try{let W=await(await x(X)).post("/api/now/table/sysevent_email_template",{name:J,type:z,subject:Q,message:G,active:$,description:`Template for ${z} notifications - Channels: ${Z.join(", ")}`});return N({created:!0,template:W.data.result,sys_id:W.data.result.sys_id,channels:Z})}catch(H){return M(H.message)}}var kD={name:"snow_emergency_broadcast",description:"Send emergency broadcast notification to all users or specific groups",category:"automation",subcategory:"notifications",use_cases:["broadcast","emergency","alerts"],complexity:"advanced",frequency:"low",permission:"read",allowedRoles:["developer","stakeholder","admin"],inputSchema:{type:"object",properties:{broadcast_type:{type:"string",description:"Broadcast type",enum:["system_outage","security_alert","maintenance","emergency"]},target_audience:{type:"string",description:"Target audience",enum:["all_users","it_staff","management","specific_group"]},group_id:{type:"string",description:"Group sys_id if target is specific_group"},message:{type:"string",description:"Emergency message"},channels:{type:"array",items:{type:"string"},description:"Channels to use for broadcast",default:["email","push"]},override_preferences:{type:"boolean",description:"Override user quiet hours/preferences",default:!0},require_acknowledgment:{type:"boolean",description:"Require user acknowledgment",default:!1}},required:["broadcast_type","target_audience","message"]}};async function _D(Y,X){let{broadcast_type:J,target_audience:z,group_id:Q,message:G,channels:Z=["email","push"],override_preferences:$=!0,require_acknowledgment:H=!1}=Y;try{let W=await x(X),K="active=true";if(z==="it_staff")K+="^roles.nameSTARTSWITHitil";else if(z==="management")K+="^department.nameLIKEmanagement";else if(z==="specific_group"&&Q)K+=`^sys_user_group=${Q}`;let B=(await W.get("/api/now/table/sys_user",{params:{sysparm_query:K,sysparm_fields:"sys_id,email,name"}})).data.result,V={event_sys_id:(await W.post("/api/now/table/sysevent",{event_name:"broadcast.emergency",param1:J,param2:G,claimed_by:"broadcast_system",description:`Emergency broadcast: ${J}`,queued:new Date().toISOString()})).data.result.sys_id,target_users:B.length,channels_used:Z,override_preferences:$,require_acknowledgment:H};return N({broadcast_sent:!0,...V})}catch(W){return M(W.message)}}var bD={name:"snow_notification_analytics",description:"Analyze notification delivery rates, engagement, and effectiveness",category:"automation",subcategory:"notifications",use_cases:["analytics","monitoring","metrics"],complexity:"intermediate",frequency:"medium",permission:"read",allowedRoles:["developer","stakeholder","admin"],inputSchema:{type:"object",properties:{analytics_type:{type:"string",description:"Analytics type",enum:["delivery_rates","engagement","channel_effectiveness","template_performance"]},time_period:{type:"string",description:"Analysis time period",enum:["24_hours","7_days","30_days","90_days"],default:"7_days"},channel_filter:{type:"string",description:"Filter by channel"},template_filter:{type:"string",description:"Filter by template sys_id"}},required:["analytics_type"]}};async function RD(Y,X){let{analytics_type:J,time_period:z="7_days",channel_filter:Q,template_filter:G}=Y;try{let Z=await x(X),$=new Date,H={"24_hours":1,"7_days":7,"30_days":30,"90_days":90},K=`sys_created_on>${new Date($.getTime()-H[z]*24*60*60*1000).toISOString()}`;if(Q)K+=`^type=${Q}`;if(G)K+=`^template=${G}`;let B=(await Z.get("/api/now/table/sysevent_email_action",{params:{sysparm_query:K,sysparm_fields:"sys_id,type,state,sys_created_on,template,recipient",sysparm_limit:1e4}})).data.result,O={analytics_type:J,time_period:z,total_notifications:B.length};if(J==="delivery_rates"){let V=B.filter((q)=>q.state==="sent"||q.state==="ready").length,L=B.filter((q)=>q.state==="error").length;O.delivery_rate=B.length>0?(V/B.length*100).toFixed(2)+"%":"0%",O.sent=V,O.failed=L}if(J==="channel_effectiveness"){let V={};B.forEach((L)=>{let q=L.type||"email";V[q]=(V[q]||0)+1}),O.by_channel=V}if(J==="template_performance"){let V={};B.forEach((L)=>{let q=L.template||"none";V[q]=(V[q]||0)+1}),O.by_template=V}return N(O)}catch(Z){return M(Z.message)}}var fD={name:"snow_notification_preferences",description:"Manage user notification preferences and routing rules",category:"automation",subcategory:"notifications",use_cases:["preferences","user-settings","configuration"],complexity:"intermediate",frequency:"medium",permission:"read",allowedRoles:["developer","stakeholder","admin"],inputSchema:{type:"object",properties:{user_id:{type:"string",description:"User sys_id"},action:{type:"string",description:"Action to perform",enum:["get","set","update"]},preferences:{type:"object",description:"User notification preferences",properties:{email_enabled:{type:"boolean"},sms_enabled:{type:"boolean"},push_enabled:{type:"boolean"},quiet_hours_start:{type:"string",description:"HH:MM format"},quiet_hours_end:{type:"string",description:"HH:MM format"}}}},required:["user_id","action"]}};async function yD(Y,X){let{user_id:J,action:z,preferences:Q={}}=Y;try{let G=await x(X);if(z==="get"){let $=(await G.get("/api/now/table/sys_user_preference",{params:{sysparm_query:`user=${J}^nameLIKEnotification`,sysparm_fields:"name,value"}})).data.result,H={};return $.forEach((W)=>{H[W.name]=W.value}),N({user_id:J,preferences:H})}if(z==="set"||z==="update"){let Z=[];for(let[$,H]of Object.entries(Q)){let W=`notification.${$}`,K=await G.get("/api/now/table/sys_user_preference",{params:{sysparm_query:`user=${J}^name=${W}`,sysparm_limit:1}});if(K.data.result.length>0){let U=K.data.result[0].sys_id;await G.patch(`/api/now/table/sys_user_preference/${U}`,{value:String(H)})}else await G.post("/api/now/table/sys_user_preference",{user:J,name:W,value:String(H)});Z.push({name:W,value:H})}return N({updated:!0,user_id:J,changes:Z})}return M(`Unknown action: ${z}`)}catch(G){return M(G.message)}}var hD={name:"snow_schedule_notification",description:"Schedule future notification delivery with advanced scheduling options",category:"automation",subcategory:"notifications",use_cases:["scheduling","notifications","automation"],complexity:"intermediate",frequency:"medium",permission:"write",allowedRoles:["developer","admin"],inputSchema:{type:"object",properties:{recipients:{type:"array",items:{type:"string"},description:"Recipient user sys_ids"},template:{type:"string",description:"Template sys_id or name"},schedule_type:{type:"string",description:"Schedule type",enum:["once","recurring","conditional"]},schedule_time:{type:"string",description:"ISO timestamp for one-time or start of recurring"},recurrence_pattern:{type:"string",description:'Cron expression for recurring notifications (e.g., "0 9 * * 1-5" for weekdays at 9am)'},subject:{type:"string",description:"Notification subject"},message:{type:"string",description:"Notification message"},personalization:{type:"object",description:"Template personalization data"}},required:["recipients","schedule_type","schedule_time"]}};async function mD(Y,X){let{recipients:J,template:z,schedule_type:Q,schedule_time:G,recurrence_pattern:Z,subject:$="Scheduled Notification",message:H="",personalization:W={}}=Y;try{let K=await x(X);if(Q==="once"){let U=await K.post("/api/now/table/sysauto_script",{name:`Scheduled Notification - ${new Date().toISOString()}`,script:`
          var users = '${J.join(",")}';
          var userList = users.split(',');
          userList.forEach(function(userId) {
            gs.eventQueue('notification.scheduled', null, userId, '${$}', '${H}');
          });
        `,run:G,run_type:"once",active:!0});return N({scheduled:!0,schedule_type:"once",job_sys_id:U.data.result.sys_id,schedule_time:G,recipients_count:J.length})}if(Q==="recurring"){if(!Z)return M("recurrence_pattern is required for recurring notifications");let U=await K.post("/api/now/table/sysauto_script",{name:`Recurring Notification - ${new Date().toISOString()}`,script:`
          var users = '${J.join(",")}';
          var userList = users.split(',');
          userList.forEach(function(userId) {
            gs.eventQueue('notification.scheduled', null, userId, '${$}', '${H}');
          });
        `,run:G,run_type:"periodically",repeat:Z,active:!0});return N({scheduled:!0,schedule_type:"recurring",job_sys_id:U.data.result.sys_id,schedule_time:G,recurrence_pattern:Z,recipients_count:J.length})}return M(`Unsupported schedule_type: ${Q}`)}catch(K){return M(K.message)}}var DG={};G0(DG,{snow_send_push_notification_exec:()=>eD,snow_send_push_notification_def:()=>tD,snow_get_mobile_analytics_exec:()=>rD,snow_get_mobile_analytics_def:()=>sD,snow_discover_mobile_configs_exec:()=>aD,snow_discover_mobile_configs_def:()=>oD,snow_create_mobile_layout_exec:()=>nD,snow_create_mobile_layout_def:()=>iD,snow_create_mobile_action_exec:()=>lD,snow_create_mobile_action_def:()=>dD,snow_configure_offline_sync_exec:()=>cD,snow_configure_offline_sync_def:()=>pD,snow_configure_mobile_app_exec:()=>gD,snow_configure_mobile_app_def:()=>uD});var uD={name:"snow_configure_mobile_app",description:"Configure ServiceNow mobile app",category:"ui-frameworks",subcategory:"mobile",use_cases:["mobile-app","configuration","mobile-development"],complexity:"intermediate",frequency:"low",permission:"write",allowedRoles:["developer","admin"],inputSchema:{type:"object",properties:{app_name:{type:"string"},platform:{type:"string",enum:["ios","android"]},features:{type:"array",items:{type:"string"}}},required:["app_name","platform"]}};async function gD(Y,X){let{app_name:J,platform:z,features:Q=[]}=Y;try{let G=await x(X),Z={name:J,platform:z,features:Q.join(",")},$=await G.post("/api/now/table/sys_mobile_app",Z);return N({configured:!0,mobile_app:$.data.result})}catch(G){return M(G.message)}}var pD={name:"snow_configure_offline_sync",description:"Configure offline synchronization settings for mobile applications. Controls which data is available offline.",category:"ui-frameworks",subcategory:"mobile",use_cases:["offline-sync","mobile","data-sync"],complexity:"intermediate",frequency:"medium",permission:"write",allowedRoles:["developer","admin"],inputSchema:{type:"object",properties:{table:{type:"string",description:"Table name for offline sync"},enabled:{type:"boolean",description:"Enable offline sync for this table",default:!0},sync_frequency:{type:"string",description:"Sync frequency: manual, hourly, daily, on_launch"},query:{type:"string",description:"Query filter for synced records"},max_records:{type:"number",description:"Maximum records to sync",default:100},fields:{type:"array",items:{type:"string"},description:"Specific fields to sync (all if not specified)"}},required:["table"]}};async function cD(Y,X){let{table:J,enabled:z=!0,sync_frequency:Q,query:G,max_records:Z=100,fields:$}=Y;try{let H=await x(X),W={table:J,enabled:z,max_records:Z};if(Q)W.sync_frequency=Q;if(G)W.query=G;if($&&$.length>0)W.fields=$.join(",");let K=await H.post("/api/now/table/sys_mobile_offline_config",W);return N({configured:!0,config:K.data.result,table:J,enabled:z,max_records:Z,message:` Offline sync configured for table: ${J}`})}catch(H){return M(H.message)}}var dD={name:"snow_create_mobile_action",description:"Creates a mobile action that users can trigger from the mobile app. Actions can navigate, execute scripts, or open forms.",category:"ui-frameworks",subcategory:"mobile",use_cases:["mobile-actions","mobile-ui","user-interactions"],complexity:"intermediate",frequency:"medium",permission:"write",allowedRoles:["developer","admin"],inputSchema:{type:"object",properties:{name:{type:"string",description:"Action name"},label:{type:"string",description:"Action label displayed to users"},table:{type:"string",description:"Table this action applies to"},action_type:{type:"string",description:"Action type: navigate, script, form, workflow"},icon:{type:"string",description:"Icon name for the action"},script:{type:"string",description:"Script to execute (for script type)"},target_url:{type:"string",description:"Target URL (for navigate type)"},condition:{type:"string",description:"Condition script for action visibility"},order:{type:"number",description:"Display order",default:100}},required:["name","label","table","action_type"]}};async function lD(Y,X){let{name:J,label:z,table:Q,action_type:G,icon:Z,script:$,target_url:H,condition:W,order:K=100}=Y;try{let U=await x(X),B={name:J,label:z,table:Q,action_type:G,order:K};if(Z)B.icon=Z;if($)B.script=$;if(H)B.target_url=H;if(W)B.condition=W;let O=await U.post("/api/now/table/sys_ui_mobile_action",B);return N({created:!0,action:O.data.result,name:J,table:Q,action_type:G,message:` Mobile action created: ${z}`})}catch(U){return M(U.message)}}var iD={name:"snow_create_mobile_layout",description:"Creates a custom mobile layout for forms and lists in the mobile app.",category:"ui-frameworks",subcategory:"mobile",use_cases:["mobile-layouts","mobile-ui","form-layouts"],complexity:"intermediate",frequency:"medium",permission:"write",allowedRoles:["developer","admin"],inputSchema:{type:"object",properties:{name:{type:"string",description:"Layout name"},table:{type:"string",description:"Table this layout applies to"},view:{type:"string",description:"View name (default, mobile, etc.)"},layout_type:{type:"string",description:"Layout type: form, list, card"},fields:{type:"array",items:{type:"string"},description:"Fields to display in order"},sections:{type:"array",items:{type:"object",properties:{title:{type:"string"},fields:{type:"array",items:{type:"string"}}}},description:"Form sections with fields"},active:{type:"boolean",description:"Is layout active",default:!0}},required:["name","table","layout_type"]}};async function nD(Y,X){let{name:J,table:z,view:Q,layout_type:G,fields:Z,sections:$,active:H=!0}=Y;try{let W=await x(X),K={name:J,table:z,layout_type:G,active:H};if(Q)K.view=Q;if(Z&&Z.length>0)K.fields=Z.join(",");if($)K.sections=JSON.stringify($);let U=await W.post("/api/now/table/sys_ui_mobile_layout",K);return N({created:!0,layout:U.data.result,name:J,table:z,layout_type:G,field_count:Z?Z.length:0,section_count:$?$.length:0,message:` Mobile layout created: ${J} for ${z}`})}catch(W){return M(W.message)}}var oD={name:"snow_discover_mobile_configs",description:"Discovers mobile application configurations including layouts, actions, and offline sync settings.",category:"core-operations",subcategory:"discovery",use_cases:["discovery","mobile-config","mobile"],complexity:"beginner",frequency:"medium",permission:"read",allowedRoles:["developer","stakeholder","admin"],inputSchema:{type:"object",properties:{config_type:{type:"string",description:"Configuration type: layout, action, offline_sync, all"},table:{type:"string",description:"Filter by table name"},active_only:{type:"boolean",description:"Show only active configurations",default:!0}}}};async function aD(Y,X){let{config_type:J="all",table:z,active_only:Q=!0}=Y;try{let G=await x(X),Z={layouts:[],actions:[],offline_sync:[]},$="";if(z)$=`table=${z}`;if(Q&&$)$+="^active=true";else if(Q)$="active=true";let H=$?`sysparm_query=${$}&`:"";if(J==="all"||J==="layout")try{let K=await G.get(`/api/now/table/sys_ui_mobile_layout?${H}sysparm_limit=50`);Z.layouts=K.data.result||[]}catch(K){}if(J==="all"||J==="action")try{let K=await G.get(`/api/now/table/sys_ui_mobile_action?${H}sysparm_limit=50`);Z.actions=K.data.result||[]}catch(K){}if(J==="all"||J==="offline_sync")try{let K=await G.get(`/api/now/table/sys_mobile_offline_config?${H}sysparm_limit=50`);Z.offline_sync=K.data.result||[]}catch(K){}let W=Z.layouts.length+Z.actions.length+Z.offline_sync.length;if(W===0)return N({results:Z,total_count:0,message:" No mobile configurations found"});return N({results:Z,counts:{layouts:Z.layouts.length,actions:Z.actions.length,offline_sync:Z.offline_sync.length},total_count:W,message:`\uD83D\uDD0D Found ${W} mobile configuration(s)`})}catch(G){return M(G.message)}}var sD={name:"snow_get_mobile_analytics",description:"Retrieves mobile application usage analytics including active users, sessions, and feature usage.",category:"reporting",subcategory:"analytics",use_cases:["analytics","mobile-metrics","usage-tracking"],complexity:"intermediate",frequency:"medium",permission:"read",allowedRoles:["developer","stakeholder","admin"],inputSchema:{type:"object",properties:{metric_type:{type:"string",description:"Metric type: users, sessions, features, performance, errors, all"},time_range:{type:"string",description:"Time range: 24h, 7d, 30d, 90d"},user_id:{type:"string",description:"Filter by specific user"},platform:{type:"string",description:"Filter by platform: ios, android, all"}}}};async function rD(Y,X){let{metric_type:J="all",time_range:z="7d",user_id:Q,platform:G}=Y;try{let Z=await x(X),$=new Date,W={"24h":1,"7d":7,"30d":30,"90d":90}[z]||7,K=new Date($.getTime()-W*24*60*60*1000),U=`sys_created_on>=${K.toISOString()}`;if(Q)U+=`^user=${Q}`;if(G&&G!=="all")U+=`^platform=${G}`;let B={time_range:z,start_date:K.toISOString(),end_date:$.toISOString()};try{let V=(await Z.get(`/api/now/table/sys_mobile_analytics?sysparm_query=${U}&sysparm_limit=1000`)).data.result||[];if(B.total_sessions=V.length,B.unique_users=new Set(V.map((F)=>F.user)).size,G==="all"||!G)B.by_platform={ios:V.filter((F)=>F.platform==="ios").length,android:V.filter((F)=>F.platform==="android").length};let L=V.filter((F)=>F.duration).map((F)=>parseInt(F.duration));if(L.length>0)B.avg_session_duration_seconds=L.reduce((F,P)=>F+P,0)/L.length;let q=V.reduce((F,P)=>{if(P.feature)F[P.feature]=(F[P.feature]||0)+1;return F},{});return B.feature_usage=q,N({analytics:B,message:`\uD83D\uDCCA Mobile analytics for ${z}: ${B.total_sessions} sessions, ${B.unique_users} users`})}catch(O){return N({analytics:{...B,total_sessions:0,unique_users:0,note:"Mobile analytics table not available in this instance"},message:" Mobile analytics data not available"})}}catch(Z){return M(Z.message)}}var tD={name:"snow_send_push_notification",description:"Sends a push notification to mobile devices. Can target specific users, groups, or all users.",category:"automation",subcategory:"notifications",use_cases:["push-notifications","mobile-alerts","notifications"],complexity:"intermediate",frequency:"high",permission:"read",allowedRoles:["developer","stakeholder","admin"],inputSchema:{type:"object",properties:{title:{type:"string",description:"Notification title"},message:{type:"string",description:"Notification message"},target_type:{type:"string",description:"Target type: user, group, all"},target_id:{type:"string",description:"Target user or group sys_id (if target_type is user or group)"},priority:{type:"string",description:"Priority: high, normal, low",default:"normal"},action_type:{type:"string",description:"Action type: open_record, open_url, none"},action_data:{type:"object",description:"Action data (record sys_id, URL, etc.)"},sound:{type:"boolean",description:"Play notification sound",default:!0},badge:{type:"boolean",description:"Update badge count",default:!0}},required:["title","message","target_type"]}};async function eD(Y,X){let{title:J,message:z,target_type:Q,target_id:G,priority:Z="normal",action_type:$,action_data:H,sound:W=!0,badge:K=!0}=Y;try{let U=await x(X),B={title:J,message:z,target_type:Q,priority:Z,sound:W,badge:K};if(G)B.target_id=G;if($)B.action_type=$;if(H)B.action_data=JSON.stringify(H);let O=await U.post("/api/now/table/sys_push_notification",B),V=1;if(Q==="all")V="all";else if(Q==="group")try{V=(await U.get(`/api/now/table/sys_user_grmember?sysparm_query=group=${G}&sysparm_limit=1000`)).data.result?.length||0}catch(L){V="unknown"}return N({sent:!0,notification_id:O.data.result.sys_id,title:J,target_type:Q,recipient_count:V,priority:Z,message:` Push notification sent: "${J}" to ${V} recipient(s)`})}catch(U){return M(U.message)}}var jG={};G0(jG,{snow_get_atf_results_exec:()=>Wj,snow_get_atf_results_def:()=>Hj,snow_execute_atf_test_exec:()=>$j,snow_execute_atf_test_def:()=>Zj,snow_discover_atf_tests_exec:()=>Uj,snow_discover_atf_tests_def:()=>Kj,snow_create_atf_test_suite_exec:()=>Gj,snow_create_atf_test_suite_def:()=>Qj,snow_create_atf_test_step_exec:()=>zj,snow_create_atf_test_step_def:()=>Jj,snow_create_atf_test_exec:()=>Xj,snow_create_atf_test_def:()=>Yj});var Yj={name:"snow_create_atf_test",description:"Create Automated Test Framework (ATF) test for automated testing",category:"development",subcategory:"testing",use_cases:["testing","atf","automation"],complexity:"intermediate",frequency:"high",permission:"write",allowedRoles:["developer","admin"],inputSchema:{type:"object",properties:{name:{type:"string",description:"Test name"},description:{type:"string",description:"Test description"},testFor:{type:"string",description:"What to test (form, list, service_portal, api, workflow)"},table:{type:"string",description:"Table to test (if applicable)"},active:{type:"boolean",description:"Test active status",default:!0},category:{type:"string",description:"Test category (regression, smoke, integration)"}},required:["name","testFor"]}};async function Xj(Y,X){let{name:J,description:z="",testFor:Q,table:G,active:Z=!0,category:$="general"}=Y;try{let H=await x(X),W={name:J,description:z,active:Z,category:$,sys_class_name:"sys_atf_test"};if(G)W.table_name=G;let U=(await H.post("/api/now/table/sys_atf_test",W)).data.result;return N({created:!0,test:{sys_id:U.sys_id,name:U.name,test_for:Q,table:G||null,category:$,active:Z}})}catch(H){return M(H instanceof I?H:new I("UNKNOWN_ERROR",H.message,{originalError:H}))}}var Jj={name:"snow_create_atf_test_step",description:"Adds a test step to an existing ATF test. Steps define the actions and assertions for testing using the sys_atf_step table.",category:"development",subcategory:"testing",use_cases:["testing","atf","test-steps"],complexity:"intermediate",frequency:"high",permission:"write",allowedRoles:["developer","admin"],inputSchema:{type:"object",properties:{testId:{type:"string",description:"Parent test sys_id or name"},stepType:{type:"string",description:"Step type (e.g., form_submission, impersonate, assert_condition, open_form, server_script)"},order:{type:"number",description:"Step execution order"},description:{type:"string",description:"Step description"},stepConfig:{type:"object",description:"Step configuration (varies by type)"},timeout:{type:"number",description:"Step timeout in seconds",default:30}},required:["testId","stepType","order"]}};async function zj(Y,X){let{testId:J,stepType:z,order:Q,description:G="",stepConfig:Z={},timeout:$=30}=Y;try{let H=await x(X),W=J;if(!J.match(/^[a-f0-9]{32}$/)){let O=await H.get(`/api/now/table/sys_atf_test?sysparm_query=name=${J}&sysparm_limit=1`);if(!O.data.result||O.data.result.length===0)throw new I("SERVICENOW_API_ERROR",`Test not found: ${J}`);W=O.data.result[0].sys_id}let K={test:W,step_config:{type:z,...Z},order:Q,description:G,timeout:$},B=(await H.post("/api/now/table/sys_atf_step",K)).data.result;return N({created:!0,step:{sys_id:B.sys_id,test_id:W,type:z,order:Q,timeout:$}})}catch(H){return M(H instanceof I?H:new I("UNKNOWN_ERROR",H.message,{originalError:H}))}}var Qj={name:"snow_create_atf_test_suite",description:"Creates an ATF test suite to group and run multiple tests together using sys_atf_test_suite table.",category:"development",subcategory:"testing",use_cases:["testing","atf","test-suites"],complexity:"intermediate",frequency:"medium",permission:"write",allowedRoles:["developer","admin"],inputSchema:{type:"object",properties:{name:{type:"string",description:"Test suite name"},description:{type:"string",description:"Suite description"},tests:{type:"array",items:{type:"string"},description:"Test IDs or names to include"},active:{type:"boolean",description:"Suite active status",default:!0},runParallel:{type:"boolean",description:"Run tests in parallel",default:!1}},required:["name","tests"]}};async function Gj(Y,X){let{name:J,description:z="",tests:Q=[],active:G=!0,runParallel:Z=!1}=Y;try{let $=await x(X),H={name:J,description:z,active:G,run_parallel:Z},K=(await $.post("/api/now/table/sys_atf_test_suite",H)).data.result,U=[];for(let B of Q){let O=B;if(!B.match(/^[a-f0-9]{32}$/)){let L=await $.get(`/api/now/table/sys_atf_test?sysparm_query=name=${B}&sysparm_limit=1`);if(L.data.result&&L.data.result.length>0)O=L.data.result[0].sys_id;else continue}let V=await $.post("/api/now/table/sys_atf_test_suite_test",{test_suite:K.sys_id,test:O});U.push({test_id:O,relation_sys_id:V.data.result.sys_id})}return N({created:!0,suite:{sys_id:K.sys_id,name:K.name,active:G,run_parallel:Z,tests_count:U.length,tests:U}})}catch($){return M($ instanceof I?$:new I("UNKNOWN_ERROR",$.message,{originalError:$}))}}var Zj={name:"snow_execute_atf_test",description:"Executes an ATF test or test suite and returns the results. Tests run asynchronously in ServiceNow using sys_atf_test_result table.",category:"development",subcategory:"testing",use_cases:["testing","atf","execution"],complexity:"intermediate",frequency:"high",permission:"write",allowedRoles:["developer","admin"],inputSchema:{type:"object",properties:{testId:{type:"string",description:"Test sys_id or name to execute"},suiteId:{type:"string",description:"Test suite sys_id or name (alternative to testId)"},async:{type:"boolean",description:"Run asynchronously",default:!0},waitForResult:{type:"boolean",description:"Wait for test completion",default:!1}}}};async function $j(Y,X){let{testId:J,suiteId:z,async:Q=!0,waitForResult:G=!1}=Y;try{let Z=await x(X);if(!J&&!z)throw new I("VALIDATION_ERROR","Either testId or suiteId must be provided");let $,H;if(J){let W=J;if(!J.match(/^[a-f0-9]{32}$/)){let U=await Z.get(`/api/now/table/sys_atf_test?sysparm_query=name=${J}&sysparm_limit=1`);if(!U.data.result||U.data.result.length===0)throw new I("SERVICENOW_API_ERROR",`Test not found: ${J}`);W=U.data.result[0].sys_id}$=(await Z.post("/api/now/atf/test/execute",{test:W,async:Q})).data.result.execution_id,H="test"}else{let W=z;if(!z.match(/^[a-f0-9]{32}$/)){let U=await Z.get(`/api/now/table/sys_atf_test_suite?sysparm_query=name=${z}&sysparm_limit=1`);if(!U.data.result||U.data.result.length===0)throw new I("SERVICENOW_API_ERROR",`Test suite not found: ${z}`);W=U.data.result[0].sys_id}$=(await Z.post("/api/now/atf/suite/execute",{test_suite:W,async:Q})).data.result.execution_id,H="suite"}if(G&&Q){let W=0,K=60;while(W<K){await new Promise((O)=>setTimeout(O,5000));let B=(await Z.get(`/api/now/table/sys_atf_test_result/${$}`)).data.result;if(B.status==="success"||B.status==="failure")return N({executed:!0,execution_id:$,type:H,status:B.status,duration:B.run_time,passed:B.status==="success",result_details:B});W++}throw new I("TIMEOUT_ERROR","Test execution timeout")}return N({executed:!0,execution_id:$,type:H,status:Q?"running":"completed",message:Q?"Test execution started":"Test execution completed"})}catch(Z){return M(Z instanceof I?Z:new I("UNKNOWN_ERROR",Z.message,{originalError:Z}))}}var Hj={name:"snow_get_atf_results",description:"Retrieves ATF test execution results including pass/fail status, error details, and execution time from sys_atf_test_result table.",category:"development",subcategory:"testing",use_cases:["testing","atf","results"],complexity:"beginner",frequency:"high",permission:"read",allowedRoles:["developer","stakeholder","admin"],inputSchema:{type:"object",properties:{executionId:{type:"string",description:"Test execution ID"},testId:{type:"string",description:"Test ID to get latest results"},limit:{type:"number",description:"Number of recent results to retrieve",default:10}}}};async function Wj(Y,X){let{executionId:J,testId:z,limit:Q=10}=Y;try{let G=await x(X);if(!J&&!z)throw new I("VALIDATION_ERROR","Either executionId or testId must be provided");let Z="";if(J)Z=`sys_id=${J}`;else if(z){let K=z;if(!z.match(/^[a-f0-9]{32}$/)){let U=await G.get(`/api/now/table/sys_atf_test?sysparm_query=name=${z}&sysparm_limit=1`);if(!U.data.result||U.data.result.length===0)throw new I("SERVICENOW_API_ERROR",`Test not found: ${z}`);K=U.data.result[0].sys_id}Z=`test=${K}^ORDERBYDESCsys_created_on`}let H=(await G.get(`/api/now/table/sys_atf_test_result?sysparm_query=${Z}&sysparm_limit=${Q}`)).data.result;if(!H||H.length===0)return N({found:!1,message:"No test results found",results:[]});let W=H.map((K)=>({sys_id:K.sys_id,test_id:K.test?.value||K.test,test_name:K.test?.display_value||"Unknown",status:K.status,passed:K.status==="success",duration:K.run_time,start_time:K.start_time,end_time:K.end_time,output:K.output,error_message:K.error_message||null,steps_passed:K.steps_passed||0,steps_failed:K.steps_failed||0,steps_total:K.total_steps||0}));return N({found:!0,count:W.length,results:W})}catch(G){return M(G instanceof I?G:new I("UNKNOWN_ERROR",G.message,{originalError:G}))}}var Kj={name:"snow_discover_atf_tests",description:"Discovers ATF tests in the instance with filtering and search capabilities.",category:"development",subcategory:"testing",use_cases:["testing","atf","discovery"],complexity:"beginner",frequency:"medium",permission:"read",allowedRoles:["developer","stakeholder","admin"],inputSchema:{type:"object",properties:{category:{type:"string",description:"Filter by test category"},table:{type:"string",description:"Filter by table name"},active:{type:"boolean",description:"Filter by active status"},nameContains:{type:"string",description:"Search by name pattern"},limit:{type:"number",description:"Maximum number of tests to return",default:50}}}};async function Uj(Y,X){let{category:J,table:z,active:Q,nameContains:G,limit:Z=50}=Y;try{let $=await x(X),H=[];if(J)H.push(`category=${J}`);if(z)H.push(`table_name=${z}`);if(Q!==void 0)H.push(`active=${Q}`);if(G)H.push(`nameLIKE${G}`);let W=H.join("^")||"sys_class_name=sys_atf_test",B=(await $.get(`/api/now/table/sys_atf_test?sysparm_query=${W}&sysparm_limit=${Z}&sysparm_display_value=true`)).data.result.map((O)=>({sys_id:O.sys_id,name:O.name,description:O.description,category:O.category,table:O.table_name||null,active:O.active==="true",created_on:O.sys_created_on,updated_on:O.sys_updated_on,created_by:O.sys_created_by?.display_value||O.sys_created_by}));return N({found:!0,count:B.length,tests:B})}catch($){return M($ instanceof I?$:new I("UNKNOWN_ERROR",$.message,{originalError:$}))}}var EG={};G0(EG,{snow_trace_execution_exec:()=>ej,snow_trace_execution_def:()=>tj,snow_schedule_script_job_exec:()=>Ej,snow_schedule_script_job_def:()=>Cj,snow_rest_message_test_suite_exec:()=>rj,snow_rest_message_test_suite_def:()=>sj,snow_property_manager_exec:()=>oj,snow_property_manager_def:()=>nj,snow_get_slow_queries_exec:()=>dj,snow_get_slow_queries_def:()=>cj,snow_get_script_output_exec:()=>ij,snow_get_script_output_def:()=>lj,snow_get_scheduled_job_logs_exec:()=>pj,snow_get_scheduled_job_logs_def:()=>gj,snow_get_outbound_http_logs_exec:()=>fj,snow_get_outbound_http_logs_def:()=>Rj,snow_get_logs_exec:()=>kj,snow_get_logs_def:()=>Sj,snow_get_inbound_http_logs_exec:()=>hj,snow_get_inbound_http_logs_def:()=>yj,snow_get_flow_execution_logs_exec:()=>uj,snow_get_flow_execution_logs_def:()=>mj,snow_get_email_logs_exec:()=>bj,snow_get_email_logs_def:()=>_j,snow_discover_schedules_exec:()=>jj,snow_discover_schedules_def:()=>Dj,snow_discover_events_exec:()=>vj,snow_discover_events_def:()=>Ij,snow_discover_automation_jobs_exec:()=>Tj,snow_discover_automation_jobs_def:()=>wj,snow_create_workflow_activity_exec:()=>Aj,snow_create_workflow_activity_def:()=>Pj,snow_create_sla_definition_exec:()=>xj,snow_create_sla_definition_def:()=>qj,snow_create_event_rule_exec:()=>Mj,snow_create_event_rule_def:()=>Oj,snow_create_escalation_rule_exec:()=>Nj,snow_create_escalation_rule_def:()=>Lj,snow_confirm_script_execution_exec:()=>Vj,snow_confirm_script_execution_def:()=>Bj});var Bj={name:"snow_confirm_script_execution",description:" Confirms and schedules script after user approval (use after snow_schedule_script_job with requireConfirmation=true). Note: Uses same scheduled job approach.",category:"automation",subcategory:"script-execution",use_cases:["automation","scripts","execution"],complexity:"advanced",frequency:"medium",permission:"write",allowedRoles:["developer","admin"],inputSchema:{type:"object",properties:{script:{type:"string",description:"The approved script to execute (ES5 only)"},executionId:{type:"string",description:"Execution ID from confirmation request"},userConfirmed:{type:"boolean",description:"User confirmation (must be true)"},description:{type:"string",description:"Description of what the script does",default:"Confirmed script execution"},timeout:{type:"number",description:"Timeout in milliseconds for polling execution results",default:30000}},required:["script","executionId","userConfirmed"]}};async function Vj(Y,X){let{script:J,executionId:z,userConfirmed:Q,description:G="Confirmed script execution",timeout:Z=30000}=Y;try{if(!Q)throw new I("INVALID_REQUEST","User confirmation required for script execution",{retryable:!1});let $=await x(X),H=`SNOW_FLOW_CONFIRM_${z}`,K=`
// Snow-Flow Confirmed Execution - ID: ${z}
// Description: ${((v)=>v.replace(/\\/g,"\\\\").replace(/'/g,"\\'").replace(/\n/g,"\\n").replace(/\r/g,"\\r"))(G)}
var __sfOutput = [];
var __sfStartTime = new GlideDateTime();
var __sfResult = null;
var __sfError = null;

var __sfOrigPrint = gs.print;
var __sfOrigInfo = gs.info;
var __sfOrigWarn = gs.warn;
var __sfOrigError = gs.error;

gs.print = function(msg) {
  var m = String(msg);
  __sfOutput.push({level: 'print', message: m});
  __sfOrigPrint(m);
};

gs.info = function(msg) {
  var m = String(msg);
  __sfOutput.push({level: 'info', message: m});
  __sfOrigInfo(m);
};

gs.warn = function(msg) {
  var m = String(msg);
  __sfOutput.push({level: 'warn', message: m});
  __sfOrigWarn(m);
};

gs.error = function(msg) {
  var m = String(msg);
  __sfOutput.push({level: 'error', message: m});
  __sfOrigError(m);
};

try {
  gs.info('=== Snow-Flow Confirmed Execution Started ===');
  __sfResult = (function() {
    ${J}
  })();
  gs.info('=== Snow-Flow Confirmed Execution Completed ===');
} catch(e) {
  __sfError = e.toString();
  gs.error('Error: ' + e.toString());
}

gs.print = __sfOrigPrint;
gs.info = __sfOrigInfo;
gs.warn = __sfOrigWarn;
gs.error = __sfOrigError;

var __sfEndTime = new GlideDateTime();
var __sfExecTimeMs = Math.abs(GlideDateTime.subtract(__sfStartTime, __sfEndTime).getNumericValue());

var __sfResultObj = {
  executionId: '${z}',
  success: __sfError === null,
  result: __sfResult,
  error: __sfError,
  output: __sfOutput,
  executionTimeMs: __sfExecTimeMs
};

gs.setProperty('${H}', JSON.stringify(__sfResultObj));
gs.info('${H}:DONE');
`,U=`Snow-Flow Confirm - ${z}`,B=await $.post("/api/now/table/sysauto_script",{name:U,script:K,active:!0,run_type:"on_demand",conditional:!1});if(!B.data?.result?.sys_id)throw new I("SERVICENOW_API_ERROR","Failed to create scheduled script job",{details:B.data});let O=B.data.result.sys_id,q=new Date(new Date().getTime()+2000).toISOString().replace("T"," ").substring(0,19);try{await $.post("/api/now/table/sys_trigger",{name:U,next_action:q,trigger_type:0,state:0,document:"sysauto_script",document_key:O,claimed_by:"",system_id:"snow-flow"})}catch(v){}let F=Date.now(),P=null,A=0,w=Math.ceil(Z/2000);while(Date.now()-F<Z&&A<w){A++,await new Promise((v)=>setTimeout(v,2000));try{let v=await $.get("/api/now/table/sys_properties",{params:{sysparm_query:`name=${H}`,sysparm_fields:"value,sys_id",sysparm_limit:1}});if(v.data?.result?.[0]?.value)try{P=JSON.parse(v.data.result[0].value);let T=v.data.result[0].sys_id;if(T)await $.delete(`/api/now/table/sys_properties/${T}`).catch(()=>{});break}catch(T){}}catch(v){}}try{await $.delete(`/api/now/table/sysauto_script/${O}`)}catch(v){}if(P){let v={print:P.output.filter((T)=>T.level==="print").map((T)=>T.message),info:P.output.filter((T)=>T.level==="info").map((T)=>T.message),warn:P.output.filter((T)=>T.level==="warn").map((T)=>T.message),error:P.output.filter((T)=>T.level==="error").map((T)=>T.message)};return N({executed:!0,execution_id:z,success:P.success,result:P.result,error:P.error,output:v,raw_output:P.output,execution_time_ms:P.executionTimeMs,user_confirmed:!0},{operation:"confirmed_script_execution",method:"sysauto_script_with_trigger"})}else return N({executed:!1,execution_id:z,scheduled_job_sys_id:O,message:"Script was saved but execution could not be confirmed.",action_required:`Navigate to System Scheduler > Scheduled Jobs and run: ${U}`},{operation:"confirmed_script_pending",method:"scheduled_job_pending"})}catch($){return M($ instanceof I?$:new I("UNKNOWN_ERROR",$.message,{originalError:$}))}}var Oj={name:"snow_create_event_rule",description:"Creates event-driven automation rules. Triggers scripts based on system events with conditional logic.",category:"automation",subcategory:"rules",use_cases:["automation","events","rules"],complexity:"intermediate",frequency:"medium",permission:"write",allowedRoles:["developer","admin"],inputSchema:{type:"object",properties:{name:{type:"string",description:"Event Rule name"},eventName:{type:"string",description:"Event name to listen for"},condition:{type:"string",description:"Event condition script (ES5 only!)"},script:{type:"string",description:"\uD83D\uDEA8 ES5 ONLY! Action script to execute (no const/let/arrows/templates - Rhino engine)"},description:{type:"string",description:"Rule description"},active:{type:"boolean",description:"Rule active status",default:!0},order:{type:"number",description:"Execution order",default:100}},required:["name","eventName","script"]}};async function Mj(Y,X){let{name:J,eventName:z,condition:Q="",script:G,description:Z="",active:$=!0,order:H=100}=Y;try{let W=await x(X),K={name:J,event_name:z,script:G,description:Z,active:$,order:H};if(Q)K.condition=Q;let B=(await W.post("/api/now/table/sysevent_script_action",K)).data.result;return N({created:!0,event_rule:{sys_id:B.sys_id,name:B.name,event_name:z,active:$,order:H},message:" Event rule created successfully"})}catch(W){return M(W instanceof I?W:new I("UNKNOWN_ERROR",W.message,{originalError:W}))}}var Lj={name:"snow_create_escalation_rule",description:"Creates escalation rules for time-based actions. Defines escalation timing, conditions, and automated responses.",category:"automation",subcategory:"rules",use_cases:["automation","escalation","rules"],complexity:"intermediate",frequency:"low",permission:"write",allowedRoles:["developer","admin"],inputSchema:{type:"object",properties:{name:{type:"string",description:"Escalation Rule name"},table:{type:"string",description:"Table to monitor"},condition:{type:"string",description:"Escalation condition"},escalationTime:{type:"number",description:"Escalation time in minutes"},escalationScript:{type:"string",description:"Escalation action script (ES5 only!)"},active:{type:"boolean",description:"Rule active status",default:!0},order:{type:"number",description:"Execution order",default:100},description:{type:"string",description:"Rule description"}},required:["name","table","condition","escalationTime","escalationScript"]}};async function Nj(Y,X){let{name:J,table:z,condition:Q,escalationTime:G,escalationScript:Z,active:$=!0,order:H=100,description:W=""}=Y;try{let K=await x(X),U={name:J,table:z,condition:Q,escalate_mins:G,script:Z,active:$,order:H,description:W},O=(await K.post("/api/now/table/sys_script_escalation",U)).data.result;return N({created:!0,escalation_rule:{sys_id:O.sys_id,name:O.name,table:z,escalation_time_mins:G,active:$,order:H},message:" Escalation rule created successfully"})}catch(K){return M(K instanceof I?K:new I("UNKNOWN_ERROR",K.message,{originalError:K}))}}var qj={name:"snow_create_sla_definition",description:"Creates Service Level Agreement definitions. Sets duration targets, business schedules, and breach conditions.",category:"automation",subcategory:"sla",use_cases:["automation","sla","service-levels"],complexity:"intermediate",frequency:"low",permission:"write",allowedRoles:["developer","admin"],inputSchema:{type:"object",properties:{name:{type:"string",description:"SLA Definition name"},table:{type:"string",description:"Table to apply SLA to"},condition:{type:"string",description:"SLA condition script"},duration:{type:"string",description:'Duration specification (e.g., "8:00:00" for 8 hours)'},durationType:{type:"string",description:"Duration type (business, calendar)",default:"business"},schedule:{type:"string",description:"Schedule to use (sys_id or name)"},active:{type:"boolean",description:"SLA active status",default:!0},description:{type:"string",description:"SLA description"}},required:["name","table","condition","duration"]}};async function xj(Y,X){let{name:J,table:z,condition:Q,duration:G,durationType:Z="business",schedule:$,active:H=!0,description:W=""}=Y;try{let K=await x(X),U=$;if($&&!$.match(/^[a-f0-9]{32}$/)){let L=await K.get(`/api/now/table/cmn_schedule?sysparm_query=name=${$}&sysparm_limit=1`);if(L.data.result&&L.data.result.length>0)U=L.data.result[0].sys_id}let B={name:J,collection:z,condition:Q,duration:G,duration_type:Z,active:H,description:W};if(U)B.schedule=U;let V=(await K.post("/api/now/table/contract_sla",B)).data.result;return N({created:!0,sla_definition:{sys_id:V.sys_id,name:V.name,table:z,duration:G,duration_type:Z,schedule:U||null,active:H},message:" SLA definition created successfully"})}catch(K){return M(K instanceof I?K:new I("UNKNOWN_ERROR",K.message,{originalError:K}))}}var Fj=" LEGACY: Workflow activities are deprecated. Consider Flow Designer for new automations (ask Snow-Flow to generate a Flow Designer specification).",Pj={name:"snow_create_workflow_activity",description:" LEGACY: Create workflow activity (deprecated - ServiceNow recommends Flow Designer). Configures activity types, conditions, and execution order.",category:"automation",subcategory:"workflow",use_cases:["automation","workflow","activities"],complexity:"intermediate",frequency:"medium",permission:"write",allowedRoles:["developer","admin"],inputSchema:{type:"object",properties:{name:{type:"string",description:"Activity name"},workflowName:{type:"string",description:"Parent workflow name or sys_id"},activityType:{type:"string",description:"Activity type (approval, script, notification, etc.)"},script:{type:"string",description:"Activity script (ES5 only!)"},condition:{type:"string",description:"Activity condition"},order:{type:"number",description:"Activity order",default:100},description:{type:"string",description:"Activity description"}},required:["name","workflowName","activityType"]}};async function Aj(Y,X){let{name:J,workflowName:z,activityType:Q,script:G="",condition:Z="",order:$=100,description:H=""}=Y;try{let W=await x(X),K=z;if(!z.match(/^[a-f0-9]{32}$/)){let V=await W.get(`/api/now/table/wf_workflow?sysparm_query=name=${z}&sysparm_limit=1`);if(!V.data.result||V.data.result.length===0)throw new I("SERVICENOW_API_ERROR",`Workflow not found: ${z}`);K=V.data.result[0].sys_id}let U={name:J,workflow_version:K,activity_definition:Q,order:$,description:H};if(G)U.script=G;if(Z)U.condition=Z;let O=(await W.post("/api/now/table/wf_activity",U)).data.result;return N({created:!0,workflow_activity:{sys_id:O.sys_id,name:O.name,workflow_id:K,activity_type:Q,order:$},message:" Workflow activity created successfully",legacy_notice:Fj},{},Fj)}catch(W){return M(W instanceof I?W:new I("UNKNOWN_ERROR",W.message,{originalError:W}))}}var wj={name:"snow_discover_automation_jobs",description:"Discovers automation jobs (scheduled scripts, executions) in the instance.",category:"automation",subcategory:"discovery",use_cases:["automation","discovery","jobs"],complexity:"beginner",frequency:"medium",permission:"read",allowedRoles:["developer","stakeholder","admin"],inputSchema:{type:"object",properties:{active:{type:"boolean",description:"Filter by active status"},nameContains:{type:"string",description:"Search by name pattern"},limit:{type:"number",description:"Maximum number of jobs to return",default:50}}}};async function Tj(Y,X){let{active:J,nameContains:z,limit:Q=50}=Y;try{let G=await x(X),Z=[];if(J!==void 0)Z.push(`active=${J}`);if(z)Z.push(`nameLIKE${z}`);let $=Z.join("^"),K=(await G.get(`/api/now/table/sysauto_script?sysparm_query=${$}&sysparm_limit=${Q}&sysparm_display_value=true`)).data.result.map((U)=>({sys_id:U.sys_id,name:U.name,description:U.description,active:U.active==="true",run_type:U.run_type,run_start:U.run_start,run_dayofweek:U.run_dayofweek,run_time:U.run_time,script:U.script?"(script present)":null,created_on:U.sys_created_on,updated_on:U.sys_updated_on}));return N({found:!0,count:K.length,jobs:K})}catch(G){return M(G instanceof I?G:new I("UNKNOWN_ERROR",G.message,{originalError:G}))}}var Ij={name:"snow_discover_events",description:"Discovers system events registered in the instance.",category:"automation",subcategory:"discovery",use_cases:["automation","events","discovery"],complexity:"beginner",frequency:"medium",permission:"read",allowedRoles:["developer","stakeholder","admin"],inputSchema:{type:"object",properties:{table:{type:"string",description:"Filter by table name"},nameContains:{type:"string",description:"Search by event name pattern"},limit:{type:"number",description:"Maximum number of events to return",default:50}}}};async function vj(Y,X){let{table:J,nameContains:z,limit:Q=50}=Y;try{let G=await x(X),Z=[];if(J)Z.push(`table=${J}`);if(z)Z.push(`event_nameLIKE${z}`);let $=Z.join("^"),K=(await G.get(`/api/now/table/sysevent_register?sysparm_query=${$}&sysparm_limit=${Q}&sysparm_display_value=true`)).data.result.map((U)=>({sys_id:U.sys_id,event_name:U.event_name,table:U.table||null,description:U.description,queue:U.queue,claimed_by:U.claimed_by||null,state:U.state,created_on:U.sys_created_on}));return N({found:!0,count:K.length,events:K})}catch(G){return M(G instanceof I?G:new I("UNKNOWN_ERROR",G.message,{originalError:G}))}}var Dj={name:"snow_discover_schedules",description:"Discovers schedules (business hours, maintenance windows) in the instance.",category:"automation",subcategory:"discovery",use_cases:["automation","schedules","discovery"],complexity:"beginner",frequency:"low",permission:"read",allowedRoles:["developer","stakeholder","admin"],inputSchema:{type:"object",properties:{nameContains:{type:"string",description:"Search by schedule name pattern"},type:{type:"string",description:"Filter by schedule type"},limit:{type:"number",description:"Maximum number of schedules to return",default:50}}}};async function jj(Y,X){let{nameContains:J,type:z,limit:Q=50}=Y;try{let G=await x(X),Z=[];if(z)Z.push(`type=${z}`);if(J)Z.push(`nameLIKE${J}`);let $=Z.join("^"),K=(await G.get(`/api/now/table/cmn_schedule?sysparm_query=${$}&sysparm_limit=${Q}&sysparm_display_value=true`)).data.result.map((U)=>({sys_id:U.sys_id,name:U.name,description:U.description,type:U.type,time_zone:U.time_zone,parent_schedule:U.parent?.display_value||null,created_on:U.sys_created_on,updated_on:U.sys_updated_on}));return N({found:!0,count:K.length,schedules:K})}catch(G){return M(G instanceof I?G:new I("UNKNOWN_ERROR",G.message,{originalError:G}))}}var Cj={name:"snow_schedule_script_job",description:" SCHEDULES (not executes directly) server-side JavaScript via Scheduled Script Job. Creates sysauto_script + sys_trigger. Returns executed=false if scheduler doesn't pick it up within 30s - check System Scheduler > Scheduled Jobs to run manually. ES5 only!",category:"automation",subcategory:"scheduled-jobs",use_cases:["automation","scripts","scheduled-jobs","debugging","verification"],complexity:"advanced",frequency:"high",permission:"write",allowedRoles:["developer","admin"],inputSchema:{type:"object",properties:{script:{type:"string",description:"\uD83D\uDEA8 ES5 ONLY! JavaScript code to execute (no const/let/arrows/templates - Rhino engine)"},description:{type:"string",description:"Clear description of what the script does (required if requireConfirmation=true)"},scope:{type:"string",description:"Scope to execute in",default:"global",enum:["global","rhino"]},timeout:{type:"number",description:"Timeout in milliseconds for polling execution results",default:30000},validate_es5:{type:"boolean",description:"Validate ES5 syntax before execution",default:!0},requireConfirmation:{type:"boolean",description:"Require user confirmation before execution (shows security analysis)",default:!1},autoConfirm:{type:"boolean",description:" DANGEROUS: Skip user confirmation even if requireConfirmation would normally be required",default:!1},allowDataModification:{type:"boolean",description:"Whether script is allowed to modify data (for security analysis)",default:!1},runAsUser:{type:"string",description:"User to execute script as (optional, defaults to current user)"}},required:["script"]}};async function Ej(Y,X){let{script:J,description:z="Script scheduled via snow_schedule_script_job",scope:Q="global",timeout:G=30000,validate_es5:Z=!0,requireConfirmation:$=!1,autoConfirm:H=!1,allowDataModification:W=!1,runAsUser:K}=Y,U=[];try{if(Z){let O=$10(J);if(!O.valid)U.push(`Script contains ES6+ syntax (${O.violations.map((V)=>V.type).join(", ")}). This may cause runtime errors in ServiceNow's Rhino engine. Consider using ES5 syntax.`)}let B=H10(J);if($&&!H){let O=W10({script:J,description:z,runAsUser:K,allowDataModification:W,securityAnalysis:B});return N({requires_confirmation:!0,confirmation_prompt:O,script_to_execute:J,execution_context:{runAsUser:K||"current",allowDataModification:W,securityLevel:B.riskLevel},next_step:"Call snow_confirm_script_execution with userConfirmed=true to execute"},{action_required:"User must approve script execution via snow_confirm_script_execution"})}return await Z10({script:J,description:z,timeout:G,securityAnalysis:B,autoConfirm:H,es5Warnings:U},X)}catch(B){return M(B instanceof I?B:new I("UNKNOWN_ERROR",B.message,{originalError:B}))}}async function Z10(Y,X){let{script:J,description:z,timeout:Q,securityAnalysis:G,autoConfirm:Z,es5Warnings:$}=Y,H=await x(X),W=(D)=>D.replace(/\\/g,"\\\\").replace(/'/g,"\\'").replace(/\n/g,"\\n").replace(/\r/g,"\\r"),K=`exec_${Date.now()}_${Math.random().toString(36).substring(7)}`,U=`SNOW_FLOW_EXEC_${K}`,B=`
// Snow-Flow Script Execution - ID: ${K}
// Description: ${W(z)}
var __sfOutput = [];
var __sfStartTime = new GlideDateTime();
var __sfResult = null;
var __sfError = null;

// Store original gs methods
var __sfOrigPrint = gs.print;
var __sfOrigInfo = gs.info;
var __sfOrigWarn = gs.warn;
var __sfOrigError = gs.error;

// Override gs methods to capture output
gs.print = function(msg) {
  var m = String(msg);
  __sfOutput.push({level: 'print', message: m, timestamp: new GlideDateTime().getDisplayValue()});
  __sfOrigPrint(m);
};

gs.info = function(msg) {
  var m = String(msg);
  __sfOutput.push({level: 'info', message: m, timestamp: new GlideDateTime().getDisplayValue()});
  __sfOrigInfo(m);
};

gs.warn = function(msg) {
  var m = String(msg);
  __sfOutput.push({level: 'warn', message: m, timestamp: new GlideDateTime().getDisplayValue()});
  __sfOrigWarn(m);
};

gs.error = function(msg) {
  var m = String(msg);
  __sfOutput.push({level: 'error', message: m, timestamp: new GlideDateTime().getDisplayValue()});
  __sfOrigError(m);
};

// Execute the user script
try {
  gs.info('=== Snow-Flow Script Execution Started ===');
  gs.info('Description: ${W(z)}');

  __sfResult = (function() {
    ${J}
  })();

  gs.info('=== Snow-Flow Script Execution Completed ===');

  if (__sfResult !== undefined && __sfResult !== null) {
    gs.info('Script returned: ' + (typeof __sfResult === 'object' ? JSON.stringify(__sfResult) : String(__sfResult)));
  }

} catch(e) {
  __sfError = e.toString();
  gs.error('=== Snow-Flow Script Execution Failed ===');
  gs.error('Error: ' + e.toString());
  if (e.stack) {
    gs.error('Stack: ' + e.stack);
  }
}

// Restore original gs methods
gs.print = __sfOrigPrint;
gs.info = __sfOrigInfo;
gs.warn = __sfOrigWarn;
gs.error = __sfOrigError;

// Calculate execution time
var __sfEndTime = new GlideDateTime();
var __sfExecTimeMs = Math.abs(GlideDateTime.subtract(__sfStartTime, __sfEndTime).getNumericValue());

// Build result object
var __sfResultObj = {
  executionId: '${K}',
  success: __sfError === null,
  result: __sfResult,
  error: __sfError,
  output: __sfOutput,
  executionTimeMs: __sfExecTimeMs,
  completedAt: __sfEndTime.getDisplayValue()
};

// Store result in system property for retrieval
gs.setProperty('${U}', JSON.stringify(__sfResultObj));
gs.info('${U}:DONE');
`,O=`Snow-Flow Exec - ${K}`,V=await H.post("/api/now/table/sysauto_script",{name:O,script:B,active:!0,run_type:"on_demand",conditional:!1});if(!V.data?.result?.sys_id)throw new I("SERVICENOW_API_ERROR","Failed to create scheduled script job",{details:V.data});let L=V.data.result.sys_id,P=new Date(new Date().getTime()+2000).toISOString().replace("T"," ").substring(0,19);try{await H.post("/api/now/table/sys_trigger",{name:O,next_action:P,trigger_type:0,state:0,document:"sysauto_script",document_key:L,claimed_by:"",system_id:"snow-flow"})}catch(D){}let A=Date.now(),w=null,v=0,T=Math.ceil(Q/2000);while(Date.now()-A<Q&&v<T){v++,await new Promise((D)=>setTimeout(D,2000));try{let D=await H.get("/api/now/table/sys_properties",{params:{sysparm_query:`name=${U}`,sysparm_fields:"value,sys_id",sysparm_limit:1}});if(D.data?.result?.[0]?.value)try{w=JSON.parse(D.data.result[0].value);let j=D.data.result[0].sys_id;if(j)await H.delete(`/api/now/table/sys_properties/${j}`).catch(()=>{});break}catch(j){}}catch(D){}}if(w){try{await H.delete(`/api/now/table/sysauto_script/${L}`)}catch(E){}let D={print:w.output.filter((E)=>E.level==="print").map((E)=>E.message),info:w.output.filter((E)=>E.level==="info").map((E)=>E.message),warn:w.output.filter((E)=>E.level==="warn").map((E)=>E.message),error:w.output.filter((E)=>E.level==="error").map((E)=>E.message),success:w.success},j={executed:!0,success:w.success,result:w.result,error:w.error,output:D,raw_output:w.output,execution_time_ms:w.executionTimeMs,execution_id:K,auto_confirmed:Z,security_analysis:G};if($.length>0)j.warnings=$;return N(j,{script_length:Y.script.length,method:"sysauto_script_with_trigger",description:z})}else{let D={executed:!1,execution_id:K,scheduled_job_sys_id:L,job_name:O,auto_confirmed:Z,security_analysis:G,message:"Script was saved as scheduled job but automatic execution could not be confirmed. The sys_trigger may not have been created (permissions) or the scheduler has not yet picked it up.",action_required:`Navigate to System Scheduler > Scheduled Jobs and run: ${O}`,manual_url:`${X.instanceUrl}/sysauto_script.do?sys_id=${L}`};if($.length>0)D.warnings=$;return N(D,{script_length:Y.script.length,method:"scheduled_job_pending",description:z})}}function $10(Y){let X=[];return[{regex:/\b(const|let)\s+/g,type:"const/let",fix:"Use 'var'"},{regex:/\([^)]*\)\s*=>/g,type:"arrow_function",fix:"Use function() {}"},{regex:/`[^`]*`/g,type:"template_literal",fix:"Use string concatenation"},{regex:/\{[^}]+\}\s*=\s*/g,type:"destructuring",fix:"Use explicit properties"},{regex:/for\s*\([^)]*\s+of\s+/g,type:"for_of",fix:"Use traditional for loop"},{regex:/class\s+\w+/g,type:"class",fix:"Use function constructor"}].forEach(({regex:z,type:Q,fix:G})=>{let Z;while((Z=z.exec(Y))!==null)X.push({type:Q,line:Y.substring(0,Z.index).split(`
`).length,code:Z[0],fix:G})}),{valid:X.length===0,violations:X}}function H10(Y){let X={riskLevel:"LOW",warnings:[],dataOperations:[],systemAccess:[]},J=[/\.insert\(\)/gi,/\.update\(\)/gi,/\.deleteRecord\(\)/gi,/\.setValue\(/gi],z=[/gs\.getUser\(\)/gi,/gs\.getUserID\(\)/gi,/gs\.hasRole\(/gi,/gs\.executeNow\(/gi],Q=[/eval\(/gi,/new Function\(/gi,/\.setWorkflow\(/gi];if(J.forEach((G)=>{let Z=Y.match(G);if(Z){if(X.dataOperations.push(...Z),X.riskLevel==="LOW")X.riskLevel="MEDIUM"}}),z.forEach((G)=>{let Z=Y.match(G);if(Z)X.systemAccess.push(...Z)}),Q.forEach((G)=>{let Z=Y.match(G);if(Z)X.warnings.push(`Potentially dangerous operation detected: ${Z[0]}`),X.riskLevel="HIGH"}),Y.includes("while")&&(Y.includes(".next()")||Y.includes(".hasNext()"))){if(X.warnings.push("Script contains loops that may process many records"),X.riskLevel==="LOW")X.riskLevel="MEDIUM"}return X}function W10(Y){let{script:X,description:J,runAsUser:z,allowDataModification:Q,securityAnalysis:G}=Y,Z={LOW:"\uD83D\uDFE2",MEDIUM:"\uD83D\uDFE1",HIGH:"\uD83D\uDD34"}[G.riskLevel]||"";return`
\uD83D\uDEA8 SCRIPT EXECUTION REQUEST

\uD83D\uDCCB **Description:** ${J}

${Z} **Security Risk Level:** ${G.riskLevel}

\uD83D\uDC64 **Run as User:** ${z||"Current User"}
\uD83D\uDCDD **Data Modification:** ${Q?" ALLOWED":" READ-ONLY"}

\uD83D\uDD0D **Script Analysis:**
${G.dataOperations.length>0?`\uD83D\uDCCA Data Operations Detected: ${G.dataOperations.join(", ")}`:""}
${G.systemAccess.length>0?`\uD83D\uDD27 System Access: ${G.systemAccess.join(", ")}`:""}
${G.warnings.length>0?` Warnings: ${G.warnings.join(", ")}`:""}

\uD83D\uDCDC **Script to Execute:**
\`\`\`javascript
${X}
\`\`\`

 **Impact:** This script will run in ServiceNow's server-side JavaScript context with full API access.

 **Do you want to proceed with executing this script?**

Reply with:
-  **YES** - Execute the script
-  **NO** - Cancel execution
- \uD83D\uDCDD **MODIFY** - Make changes before execution

 Only proceed if you understand what this script does and trust its source!
`.trim()}var Sj={name:"snow_get_logs",description:"Retrieve ServiceNow system logs with filtering by level, source, and time range",category:"automation",subcategory:"monitoring",use_cases:["automation","logs","monitoring"],complexity:"beginner",frequency:"high",permission:"read",allowedRoles:["developer","stakeholder","admin"],inputSchema:{type:"object",properties:{level:{type:"string",enum:["error","warn","info","debug","all"],description:"Log level filter",default:"all"},source:{type:"string",description:"Filter by log source (e.g., widget name, script name)"},limit:{type:"number",description:"Maximum number of log entries to return",default:100,minimum:1,maximum:1000},since:{type:"string",description:'Get logs since this timestamp (ISO 8601 or relative like "1h", "30m")'},search:{type:"string",description:"Search term in log messages"}}}};async function kj(Y,X){let{level:J="all",source:z,limit:Q=100,since:G,search:Z}=Y;try{let $=await x(X),H=[];if(J!=="all")H.push(`level=${J}`);if(z)H.push(`sourceLIKE${z}`);if(G){let q=K10(G);H.push(`sys_created_on>${q}`)}if(Z)H.push(`messageLIKE${Z}`);let W=H.join("^"),U=(await $.get("/api/now/table/syslog",{params:{sysparm_query:W+"^ORDERBYDESCsys_created_on",sysparm_limit:Q,sysparm_fields:"sys_created_on,level,source,message,sys_id"}})).data.result.map((q)=>({timestamp:q.sys_created_on,level:q.level,source:q.source,message:q.message,sys_id:q.sys_id})),B={error:U.filter((q)=>q.level==="error").length,warn:U.filter((q)=>q.level==="warn").length,info:U.filter((q)=>q.level==="info").length,debug:U.filter((q)=>q.level==="debug").length},O=[];O.push(`Found ${U.length} log entries`);let V=[];if(B.error>0)V.push(`${B.error} errors`);if(B.warn>0)V.push(`${B.warn} warnings`);if(B.info>0)V.push(`${B.info} info`);if(B.debug>0)V.push(`${B.debug} debug`);if(V.length>0)O.push(`Breakdown: ${V.join(", ")}`);if(U.length>0){O.push(""),O.push("Recent Log Entries:");let q=Math.min(U.length,10);for(let F=0;F<q;F++){let P=U[F],A=P.level==="error"?"":P.level==="warn"?"":P.level==="info"?"":"\uD83D\uDD0D",w=P.message&&P.message.length>100?P.message.substring(0,100)+"...":P.message||"(no message)";O.push(`  ${A} [${P.timestamp}] ${P.source||"unknown"}`),O.push(`     ${w}`)}if(U.length>10)O.push(`  ... and ${U.length-10} more entries`)}let L=[];if(J!=="all")L.push(`level=${J}`);if(z)L.push(`source=${z}`);if(G)L.push(`since=${G}`);if(Z)L.push(`search=${Z}`);if(L.length>0)O.push(""),O.push(`Filters applied: ${L.join(", ")}`);return N({logs:U,count:U.length,by_level:B,filters:{level:J,source:z,since:G,search:Z}},{},O.join(`
`))}catch($){return M($.message)}}function K10(Y){let X=new Date,J=Y.match(/^(\d+)([mhd])$/);if(!J)return Y;let z=parseInt(J[1]),Q=J[2],G=0;switch(Q){case"m":G=z*60*1000;break;case"h":G=z*60*60*1000;break;case"d":G=z*24*60*60*1000;break}return new Date(X.getTime()-G).toISOString()}var _j={name:"snow_get_email_logs",description:"Retrieve sent/received email logs from sys_email table for monitoring and debugging",category:"automation",subcategory:"monitoring",use_cases:["email","notifications","monitoring","debugging"],complexity:"beginner",frequency:"high",permission:"read",allowedRoles:["developer","stakeholder","admin"],inputSchema:{type:"object",properties:{type:{type:"string",enum:["sent","received","send-ready","failed","all"],description:"Email type/status filter",default:"all"},recipient:{type:"string",description:"Filter by recipient email address"},sender:{type:"string",description:"Filter by sender email address"},subject:{type:"string",description:"Search in email subject"},limit:{type:"number",description:"Maximum number of email records to return",default:50,minimum:1,maximum:500},since:{type:"string",description:'Get emails since this timestamp (ISO 8601 or relative like "1h", "30m", "7d")'},include_body:{type:"boolean",description:"Include email body in response (can be large)",default:!1}}}};async function bj(Y,X){var J=Y.type||"all",z=Y.recipient,Q=Y.sender,G=Y.subject,Z=Y.limit||50,$=Y.since,H=Y.include_body||!1;try{var W=await x(X),K=[];if(J!=="all")K.push("type="+J);if(z)K.push("recipientsLIKE"+z);if(Q)K.push("fromLIKE"+Q);if(G)K.push("subjectLIKE"+G);if($){var U=U10($);K.push("sys_created_on>"+U)}var B=K.join("^"),O="sys_id,sys_created_on,type,subject,recipients,from,cc,bcc,state,error_string,mailbox,content_type";if(H)O+=",body,body_text";var V=await W.get("/api/now/table/sys_email",{params:{sysparm_query:B+"^ORDERBYDESCsys_created_on",sysparm_limit:Z,sysparm_fields:O}}),L=V.data.result.map(function(F){var P={sys_id:F.sys_id,timestamp:F.sys_created_on,type:F.type,state:F.state,subject:F.subject,from:F.from,recipients:F.recipients,cc:F.cc||null,bcc:F.bcc||null,mailbox:F.mailbox,content_type:F.content_type,error:F.error_string||null};if(H)P.body=F.body||F.body_text;return P}),q={sent:0,received:0,"send-ready":0,failed:0};return L.forEach(function(F){if(F.state==="error"||F.error)q.failed++;else if(q[F.type]!==void 0)q[F.type]++}),N({emails:L,count:L.length,by_type:q,filters:{type:J,recipient:z,sender:Q,subject:G,since:$}})}catch(F){return M(F.message)}}function U10(Y){var X=new Date,J=Y.match(/^(\d+)([mhd])$/);if(!J)return Y;var z=parseInt(J[1]),Q=J[2],G=0;switch(Q){case"m":G=z*60*1000;break;case"h":G=z*60*60*1000;break;case"d":G=z*24*60*60*1000;break}var Z=new Date(X.getTime()-G);return Z.toISOString()}var Rj={name:"snow_get_outbound_http_logs",description:"Retrieve outbound HTTP request logs for monitoring REST/SOAP integrations and external API calls",category:"automation",subcategory:"monitoring",use_cases:["integration","rest","soap","monitoring","debugging","http"],complexity:"beginner",frequency:"high",permission:"read",allowedRoles:["developer","stakeholder","admin"],inputSchema:{type:"object",properties:{status:{type:"string",enum:["success","error","all"],description:"Filter by response status (success = 2xx, error = 4xx/5xx)",default:"all"},endpoint:{type:"string",description:"Filter by target endpoint URL (partial match)"},rest_message:{type:"string",description:"Filter by REST Message name"},http_method:{type:"string",enum:["GET","POST","PUT","PATCH","DELETE","all"],description:"Filter by HTTP method",default:"all"},limit:{type:"number",description:"Maximum number of log entries to return",default:50,minimum:1,maximum:500},since:{type:"string",description:'Get logs since this timestamp (ISO 8601 or relative like "1h", "30m", "7d")'},include_payload:{type:"boolean",description:"Include request/response body in output (can be large)",default:!1}}}};async function fj(Y,X){var J=Y.status||"all",z=Y.endpoint,Q=Y.rest_message,G=Y.http_method||"all",Z=Y.limit||50,$=Y.since,H=Y.include_payload||!1;try{var W=await x(X),K=[];if(J==="success")K.push("http_status>=200^http_status<300");else if(J==="error")K.push("http_status>=400");if(z)K.push("urlLIKE"+z);if(Q)K.push("rest_message.nameLIKE"+Q);if(G!=="all")K.push("http_method="+G);if($){var U=B10($);K.push("sys_created_on>"+U)}var B=K.join("^"),O="sys_id,sys_created_on,url,http_method,http_status,response_time,rest_message,source_table,source_sys_id,error_message";if(H)O+=",request_headers,request_body,response_headers,response_body";var V=await W.get("/api/now/table/sys_outbound_http_log",{params:{sysparm_query:B+"^ORDERBYDESCsys_created_on",sysparm_limit:Z,sysparm_fields:O}}),L=V.data.result.map(function(A){var w={sys_id:A.sys_id,timestamp:A.sys_created_on,url:A.url,http_method:A.http_method,http_status:A.http_status,response_time_ms:A.response_time,rest_message:A.rest_message,source_table:A.source_table,source_sys_id:A.source_sys_id,error:A.error_message||null};if(H)w.request={headers:A.request_headers,body:A.request_body},w.response={headers:A.response_headers,body:A.response_body};return w}),q={total:L.length,success:0,client_error:0,server_error:0,avg_response_time_ms:0},F=0;if(L.forEach(function(A){var w=parseInt(A.http_status)||0;if(w>=200&&w<300)q.success++;else if(w>=400&&w<500)q.client_error++;else if(w>=500)q.server_error++;F+=parseInt(A.response_time_ms)||0}),L.length>0)q.avg_response_time_ms=Math.round(F/L.length);var P={};return L.forEach(function(A){try{var w=new URL(A.url),v=w.hostname;P[v]=(P[v]||0)+1}catch(T){P.unknown=(P.unknown||0)+1}}),N({logs:L,count:L.length,statistics:q,by_endpoint:P,filters:{status:J,endpoint:z,rest_message:Q,http_method:G,since:$}})}catch(A){return M(A.message)}}function B10(Y){var X=new Date,J=Y.match(/^(\d+)([mhd])$/);if(!J)return Y;var z=parseInt(J[1]),Q=J[2],G=0;switch(Q){case"m":G=z*60*1000;break;case"h":G=z*60*60*1000;break;case"d":G=z*24*60*60*1000;break}var Z=new Date(X.getTime()-G);return Z.toISOString()}var yj={name:"snow_get_inbound_http_logs",description:"Retrieve inbound REST API transaction logs for monitoring API usage and debugging incoming requests",category:"automation",subcategory:"monitoring",use_cases:["api","rest","monitoring","debugging","http","transactions"],complexity:"beginner",frequency:"high",permission:"read",allowedRoles:["developer","stakeholder","admin"],inputSchema:{type:"object",properties:{status:{type:"string",enum:["success","error","all"],description:"Filter by response status (success = 2xx, error = 4xx/5xx)",default:"all"},url_path:{type:"string",description:"Filter by request URL path (partial match)"},http_method:{type:"string",enum:["GET","POST","PUT","PATCH","DELETE","all"],description:"Filter by HTTP method",default:"all"},user:{type:"string",description:"Filter by user who made the request"},source_ip:{type:"string",description:"Filter by source IP address"},limit:{type:"number",description:"Maximum number of log entries to return",default:50,minimum:1,maximum:500},since:{type:"string",description:'Get logs since this timestamp (ISO 8601 or relative like "1h", "30m", "7d")'},min_response_time:{type:"number",description:"Only show requests slower than this (milliseconds) - useful for performance debugging"}}}};async function hj(Y,X){var J=Y.status||"all",z=Y.url_path,Q=Y.http_method||"all",G=Y.user,Z=Y.source_ip,$=Y.limit||50,H=Y.since,W=Y.min_response_time;try{var K=await x(X),U=[];if(J==="success")U.push("status_code>=200^status_code<300");else if(J==="error")U.push("status_code>=400");if(z)U.push("urlLIKE"+z);if(Q!=="all")U.push("http_method="+Q);if(G)U.push("user.user_nameLIKE"+G);if(Z)U.push("client_ip="+Z);if(H){var B=V10(H);U.push("sys_created_on>"+B)}if(W)U.push("response_time>"+W);var O=U.join("^"),V=await K.get("/api/now/table/syslog_transaction",{params:{sysparm_query:O+"^ORDERBYDESCsys_created_on",sysparm_limit:$,sysparm_fields:"sys_id,sys_created_on,url,http_method,status_code,response_time,client_ip,user,session_id,source"}}),L=V.data.result.map(function(D){return{sys_id:D.sys_id,timestamp:D.sys_created_on,url:D.url,http_method:D.http_method,status_code:D.status_code,response_time_ms:D.response_time,client_ip:D.client_ip,user:D.user,session_id:D.session_id,source:D.source}}),q={total:L.length,success:0,client_error:0,server_error:0,avg_response_time_ms:0,max_response_time_ms:0,p95_response_time_ms:0},F=[];if(L.forEach(function(D){var j=parseInt(D.status_code)||0;if(j>=200&&j<300)q.success++;else if(j>=400&&j<500)q.client_error++;else if(j>=500)q.server_error++;var E=parseInt(D.response_time_ms)||0;F.push(E)}),F.length>0){F.sort(function(D,j){return D-j});var P=F.reduce(function(D,j){return D+j},0);q.avg_response_time_ms=Math.round(P/F.length),q.max_response_time_ms=F[F.length-1];var A=Math.floor(F.length*0.95);q.p95_response_time_ms=F[A]||q.max_response_time_ms}var w={};L.forEach(function(D){var j=D.url||"unknown";j=j.split("?")[0],j=j.replace(/\/[a-f0-9]{32}/gi,"/{sys_id}"),w[j]=(w[j]||0)+1});var v={};L.forEach(function(D){var j=D.http_method||"unknown";v[j]=(v[j]||0)+1});var T={};return L.forEach(function(D){var j=D.user||"anonymous";T[j]=(T[j]||0)+1}),N({logs:L,count:L.length,statistics:q,by_endpoint:w,by_method:v,by_user:T,filters:{status:J,url_path:z,http_method:Q,user:G,source_ip:Z,since:H,min_response_time:W}})}catch(D){return M(D.message)}}function V10(Y){var X=new Date,J=Y.match(/^(\d+)([mhd])$/);if(!J)return Y;var z=parseInt(J[1]),Q=J[2],G=0;switch(Q){case"m":G=z*60*1000;break;case"h":G=z*60*60*1000;break;case"d":G=z*24*60*60*1000;break}var Z=new Date(X.getTime()-G);return Z.toISOString()}var mj={name:"snow_get_flow_execution_logs",description:"Retrieve Flow Designer execution logs for monitoring flow runs, debugging failures, and analyzing performance",category:"automation",subcategory:"monitoring",use_cases:["flow-designer","automation","monitoring","debugging"],complexity:"beginner",frequency:"high",permission:"read",allowedRoles:["developer","stakeholder","admin"],inputSchema:{type:"object",properties:{status:{type:"string",enum:["complete","error","cancelled","in_progress","waiting","all"],description:"Filter by execution status",default:"all"},flow_name:{type:"string",description:"Filter by flow name (partial match)"},source_table:{type:"string",description:"Filter by source table that triggered the flow (e.g., incident, change_request)"},source_record:{type:"string",description:"Filter by specific source record sys_id"},trigger_type:{type:"string",enum:["record","scheduled","application","inbound_email","rest","all"],description:"Filter by trigger type",default:"all"},limit:{type:"number",description:"Maximum number of execution records to return",default:50,minimum:1,maximum:500},since:{type:"string",description:'Get executions since this timestamp (ISO 8601 or relative like "1h", "30m", "7d")'},errors_only:{type:"boolean",description:"Only show failed executions with errors",default:!1},include_logs:{type:"boolean",description:"Include detailed execution logs (can be verbose)",default:!1}}}};async function uj(Y,X){var J=Y.status||"all",z=Y.flow_name,Q=Y.source_table,G=Y.source_record,Z=Y.trigger_type||"all",$=Y.limit||50,H=Y.since,W=Y.errors_only||!1,K=Y.include_logs||!1;try{var U=await x(X),B=[];if(J!=="all")B.push("state="+J);if(W)B.push("state=error");if(Q)B.push("source_table="+Q);if(G)B.push("source_record="+G);if(Z!=="all")B.push("trigger_type="+Z);if(H){var O=O10(H);B.push("started>"+O)}var V=B.join("^"),L=await U.get("/api/now/table/sys_flow_context",{params:{sysparm_query:V+"^ORDERBYDESCstarted",sysparm_limit:$,sysparm_fields:"sys_id,flow,state,started,ended,error_message,trigger_type,source_table,source_record,run_count,sys_created_by",sysparm_display_value:"all"}}),q=L.data.result;if(z)q=q.filter(function(E){var f=E.flow&&E.flow.display_value?E.flow.display_value:"";return f.toLowerCase().indexOf(z.toLowerCase())!==-1});var F=q.map(function(E){var f=E.started&&E.started.display_value?new Date(E.started.display_value):null,i=E.ended&&E.ended.display_value?new Date(E.ended.display_value):null,o=null;if(f&&i)o=Math.round((i.getTime()-f.getTime())/1000);return{sys_id:E.sys_id,flow_name:E.flow&&E.flow.display_value?E.flow.display_value:"Unknown",flow_sys_id:E.flow&&E.flow.value?E.flow.value:null,state:E.state&&E.state.display_value?E.state.display_value:E.state,started:E.started&&E.started.display_value?E.started.display_value:null,ended:E.ended&&E.ended.display_value?E.ended.display_value:null,duration_seconds:o,trigger_type:E.trigger_type&&E.trigger_type.display_value?E.trigger_type.display_value:E.trigger_type,source_table:E.source_table,source_record:E.source_record&&E.source_record.value?E.source_record.value:E.source_record,run_count:E.run_count,created_by:E.sys_created_by,error_message:E.error_message||null}});if(K&&F.length>0&&F.length<=10)for(var P=0;P<F.length;P++){var A=await U.get("/api/now/table/sys_flow_log",{params:{sysparm_query:"context="+F[P].sys_id+"^ORDERBYsys_created_on",sysparm_limit:50,sysparm_fields:"sys_created_on,level,message,step"}});F[P].execution_logs=A.data.result.map(function(E){return{timestamp:E.sys_created_on,level:E.level,message:E.message,step:E.step}})}var w={total:F.length,complete:0,error:0,cancelled:0,in_progress:0,waiting:0,avg_duration_seconds:0},v=0,T=0;if(F.forEach(function(E){var f=(E.state||"").toLowerCase();if(f==="complete")w.complete++;else if(f==="error")w.error++;else if(f==="cancelled")w.cancelled++;else if(f==="in_progress"||f==="in progress")w.in_progress++;else if(f==="waiting")w.waiting++;if(E.duration_seconds!==null)v+=E.duration_seconds,T++}),T>0)w.avg_duration_seconds=Math.round(v/T);var D={};F.forEach(function(E){var f=E.flow_name||"Unknown";if(!D[f])D[f]={total:0,errors:0};if(D[f].total++,(E.state||"").toLowerCase()==="error")D[f].errors++});var j=[];return F.forEach(function(E){if(E.error_message)j.push({flow_name:E.flow_name,error:E.error_message,timestamp:E.started,sys_id:E.sys_id})}),N({executions:F,count:F.length,statistics:w,by_flow:D,recent_errors:j.slice(0,10),filters:{status:J,flow_name:z,source_table:Q,trigger_type:Z,since:H,errors_only:W}})}catch(E){return M(E.message)}}function O10(Y){var X=new Date,J=Y.match(/^(\d+)([mhd])$/);if(!J)return Y;var z=parseInt(J[1]),Q=J[2],G=0;switch(Q){case"m":G=z*60*1000;break;case"h":G=z*60*60*1000;break;case"d":G=z*24*60*60*1000;break}var Z=new Date(X.getTime()-G);return Z.toISOString()}var gj={name:"snow_get_scheduled_job_logs",description:"Retrieve scheduled job execution history and logs for monitoring automation, identifying failures, and tracking performance",category:"automation",subcategory:"monitoring",use_cases:["scheduled-jobs","automation","monitoring","debugging"],complexity:"beginner",frequency:"high",permission:"read",allowedRoles:["developer","stakeholder","admin"],inputSchema:{type:"object",properties:{job_name:{type:"string",description:"Filter by job name (partial match)"},state:{type:"string",enum:["ready","running","complete","error","cancelled","all"],description:"Filter by job state",default:"all"},job_type:{type:"string",enum:["scheduled","run_once","on_demand","all"],description:"Filter by job type",default:"all"},include_inactive:{type:"boolean",description:"Include inactive/disabled jobs",default:!1},limit:{type:"number",description:"Maximum number of jobs to return",default:50,minimum:1,maximum:200},since:{type:"string",description:'Get jobs that ran since this timestamp (ISO 8601 or relative like "1h", "30m", "7d")'},failed_only:{type:"boolean",description:"Only show jobs that had errors in their last run",default:!1},include_logs:{type:"boolean",description:"Include recent syslog entries for each job",default:!1}}}};async function pj(Y,X){var J=Y.job_name,z=Y.state||"all",Q=Y.job_type||"all",G=Y.include_inactive||!1,Z=Y.limit||50,$=Y.since,H=Y.failed_only||!1,W=Y.include_logs||!1;try{var K=await x(X),U=[];if(J)U.push("nameLIKE"+J);if(z!=="all")U.push("state="+z);if(!G)U.push("active=true");if($){var B=L10($);U.push("last_run>"+B)}if(Q==="run_once")U.push("run_type=once");else if(Q==="on_demand")U.push("run_type=on_demand");else if(Q==="scheduled")U.push("run_type=periodic");var O=U.join("^"),V=await K.get("/api/now/table/sys_trigger",{params:{sysparm_query:O+"^ORDERBYDESClast_run",sysparm_limit:Z,sysparm_fields:"sys_id,name,state,active,last_run,next_run,run_type,run_count,run_as,script,claimed_by,error_count,run_dayofweek,run_time",sysparm_display_value:"all"}}),L=V.data.result,q=L.map(function(T){return{sys_id:T.sys_id,name:T.name,state:T.state&&T.state.display_value?T.state.display_value:T.state,active:T.active==="true"||T.active===!0,last_run:T.last_run&&T.last_run.display_value?T.last_run.display_value:T.last_run,next_run:T.next_run&&T.next_run.display_value?T.next_run.display_value:T.next_run,run_type:T.run_type,run_count:parseInt(T.run_count)||0,error_count:parseInt(T.error_count)||0,run_as:T.run_as&&T.run_as.display_value?T.run_as.display_value:T.run_as,schedule:M10(T),claimed_by:T.claimed_by&&T.claimed_by.display_value?T.claimed_by.display_value:null,has_errors:(parseInt(T.error_count)||0)>0}});if(H)q=q.filter(function(T){return T.has_errors||T.state==="error"});if(W&&q.length>0&&q.length<=10)for(var F=0;F<q.length;F++){var P=await K.get("/api/now/table/syslog",{params:{sysparm_query:"sourceLIKE"+q[F].name+"^ORDERBYDESCsys_created_on",sysparm_limit:10,sysparm_fields:"sys_created_on,level,message,source"}});q[F].recent_logs=P.data.result.map(function(T){return{timestamp:T.sys_created_on,level:T.level,message:T.message}})}var A={total:q.length,active:0,inactive:0,running:0,ready:0,with_errors:0,total_runs:0,total_errors:0};q.forEach(function(T){if(T.active)A.active++;else A.inactive++;if(T.state==="Running")A.running++;if(T.state==="Ready")A.ready++;if(T.has_errors)A.with_errors++;A.total_runs+=T.run_count,A.total_errors+=T.error_count});var w={};q.forEach(function(T){var D=T.state||"Unknown";w[D]=(w[D]||0)+1});var v=q.filter(function(T){return T.error_count>0}).sort(function(T,D){return D.error_count-T.error_count}).slice(0,5).map(function(T){return{name:T.name,error_count:T.error_count,run_count:T.run_count,error_rate:T.run_count>0?Math.round(T.error_count/T.run_count*100)+"%":"N/A"}});return N({jobs:q,count:q.length,statistics:A,by_state:w,error_prone_jobs:v,filters:{job_name:J,state:z,job_type:Q,include_inactive:G,since:$,failed_only:H}})}catch(T){return M(T.message)}}function M10(Y){if(Y.run_type==="once")return"Run once";else if(Y.run_type==="on_demand")return"On demand";var X="";if(Y.run_dayofweek){var J=typeof Y.run_dayofweek==="string"?Y.run_dayofweek:Y.run_dayofweek.value||Y.run_dayofweek.display_value||"";if(J&&typeof J==="string"){var z=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],Q=J.split(","),G=Q.map(function($){return z[parseInt($)-1]||$});X=G.join(", ")}}if(Y.run_time){var Z=typeof Y.run_time==="string"?Y.run_time:Y.run_time.value||Y.run_time.display_value||"";X+=(X?" at ":"")+Z}return X||"Periodic"}function L10(Y){var X=new Date,J=Y.match(/^(\d+)([mhd])$/);if(!J)return Y;var z=parseInt(J[1]),Q=J[2],G=0;switch(Q){case"m":G=z*60*1000;break;case"h":G=z*60*60*1000;break;case"d":G=z*24*60*60*1000;break}var Z=new Date(X.getTime()-G);return Z.toISOString()}var cj={name:"snow_get_slow_queries",description:"Retrieve slow database query logs for identifying performance issues, optimizing GlideRecord queries, and improving system responsiveness",category:"automation",subcategory:"monitoring",use_cases:["performance","optimization","monitoring","debugging"],complexity:"intermediate",frequency:"medium",permission:"read",allowedRoles:["developer","stakeholder","admin"],inputSchema:{type:"object",properties:{table:{type:"string",description:"Filter by table name (e.g., incident, task, cmdb_ci)"},min_duration:{type:"number",description:"Minimum query duration in milliseconds to include",default:1000},source:{type:"string",description:"Filter by source (script name, business rule, etc.)"},user:{type:"string",description:"Filter by user who executed the query"},limit:{type:"number",description:"Maximum number of slow queries to return",default:50,minimum:1,maximum:500},since:{type:"string",description:'Get queries since this timestamp (ISO 8601 or relative like "1h", "30m", "7d")'},include_query_text:{type:"boolean",description:"Include the actual query/encoded query text",default:!0}}}};async function dj(Y,X){var J=Y.table,z=Y.min_duration||1000,Q=Y.source,G=Y.user,Z=Y.limit||50,$=Y.since,H=Y.include_query_text!==!1;try{var W=await x(X),K=[];if(K.push("messageLIKESlow"),K.push("messageLIKEquery"),$){var U=P10($);K.push("sys_created_on>"+U)}if(Q)K.push("sourceLIKE"+Q);if(J)K.push("messageLIKE"+J);var B=K.join("^"),O=await W.get("/api/now/table/syslog",{params:{sysparm_query:B+"^ORDERBYDESCsys_created_on",sysparm_limit:Z,sysparm_fields:"sys_id,sys_created_on,source,message,level,sys_created_by"}}),V=[];try{var L=await W.get("/api/now/table/sys_slow_query_log",{params:{sysparm_query:($?"sys_created_on>"+U:"")+"^ORDERBYDESCsys_created_on",sysparm_limit:Z,sysparm_fields:"sys_id,sys_created_on,table,query,duration,source,user,stack_trace"}});V=L.data.result||[]}catch(y){}var q=[];try{var F="response_time>"+z;if($)F+="^sys_created_on>"+U;if(G)F+="^user.user_nameLIKE"+G;var P=await W.get("/api/now/table/syslog_transaction",{params:{sysparm_query:F+"^ORDERBYDESCresponse_time",sysparm_limit:Math.min(Z,100),sysparm_fields:"sys_id,sys_created_on,url,http_method,response_time,user,status_code"}});q=P.data.result||[]}catch(y){}var A=(O.data.result||[]).map(function(y){var a=N10(y.message);return{sys_id:y.sys_id,type:"syslog",timestamp:y.sys_created_on,source:y.source,message:H?y.message:x10(y.message),level:y.level,user:y.sys_created_by,duration_ms:a,table:q10(y.message)}}).filter(function(y){return y.duration_ms===null||y.duration_ms>=z}),w=V.map(function(y){return{sys_id:y.sys_id,type:"slow_query_log",timestamp:y.sys_created_on,table:y.table,query:H?y.query:"[query hidden]",duration_ms:parseInt(y.duration)||0,source:y.source,user:y.user,has_stack_trace:!!y.stack_trace}}).filter(function(y){return y.duration_ms>=z}),v=q.map(function(y){return{sys_id:y.sys_id,type:"slow_transaction",timestamp:y.sys_created_on,url:y.url,http_method:y.http_method,duration_ms:parseInt(y.response_time)||0,user:y.user,status_code:y.status_code}}),T=A.concat(w).concat(v);T.sort(function(y,a){return(a.duration_ms||0)-(y.duration_ms||0)}),T=T.slice(0,Z);var D={total:T.length,from_syslog:A.length,from_slow_query_log:w.length,from_transactions:v.length,avg_duration_ms:0,max_duration_ms:0,min_duration_ms:0},j=T.filter(function(y){return y.duration_ms!==null&&y.duration_ms>0}).map(function(y){return y.duration_ms});if(j.length>0){j.sort(function(y,a){return y-a});var E=j.reduce(function(y,a){return y+a},0);D.avg_duration_ms=Math.round(E/j.length),D.max_duration_ms=j[j.length-1],D.min_duration_ms=j[0]}var f={};T.forEach(function(y){var a=y.table||"Unknown";if(!f[a])f[a]={count:0,total_duration_ms:0};f[a].count++,f[a].total_duration_ms+=y.duration_ms||0}),Object.keys(f).forEach(function(y){f[y].avg_duration_ms=Math.round(f[y].total_duration_ms/f[y].count)});var i={};T.forEach(function(y){var a=y.source||"Unknown";i[a]=(i[a]||0)+1});var o=T.slice(0,10).map(function(y){return{duration_ms:y.duration_ms,table:y.table,source:y.source,type:y.type,timestamp:y.timestamp}});return N({slow_queries:T,count:T.length,statistics:D,by_table:f,by_source:i,top_slowest:o,filters:{table:J,min_duration:z,source:Q,user:G,since:$},recommendations:F10(f,o)})}catch(y){return M(y.message)}}function N10(Y){var X=Y.match(/(\d+)\s*ms/i);if(X)return parseInt(X[1]);var J=Y.match(/(\d+\.?\d*)\s*s(?:ec)?/i);if(J)return Math.round(parseFloat(J[1])*1000);return null}function q10(Y){var X=Y.match(/table[:\s]+(\w+)/i);if(X)return X[1];var J=Y.match(/from\s+(\w+)/i);if(J)return J[1];return null}function x10(Y){if(Y.length>200)return Y.substring(0,200)+"...";return Y}function F10(Y,X){var J=[];if(Object.keys(Y).forEach(function(z){if(Y[z].count>5&&Y[z].avg_duration_ms>2000)J.push('Table "'+z+'" has '+Y[z].count+" slow queries (avg "+Y[z].avg_duration_ms+"ms). Consider adding indexes or optimizing queries.")}),X.forEach(function(z){if(z.duration_ms>1e4)J.push('Query on "'+(z.table||"unknown")+'" took '+z.duration_ms+"ms. Review for missing indexes or inefficient filters.")}),J.length===0)J.push("No major performance issues detected in the analyzed queries.");return J}function P10(Y){var X=new Date,J=Y.match(/^(\d+)([mhd])$/);if(!J)return Y;var z=parseInt(J[1]),Q=J[2],G=0;switch(Q){case"m":G=z*60*1000;break;case"h":G=z*60*60*1000;break;case"d":G=z*24*60*60*1000;break}var Z=new Date(X.getTime()-G);return Z.toISOString()}var lj={name:"snow_get_script_output",description:"Retrieve output from previously executed script using execution ID",category:"automation",subcategory:"script-execution",use_cases:["automation","scripts","output-retrieval"],complexity:"intermediate",frequency:"medium",permission:"read",allowedRoles:["developer","stakeholder","admin"],inputSchema:{type:"object",properties:{execution_id:{type:"string",description:"Execution ID from previous script run"},cleanup:{type:"boolean",description:"Clean up temporary output after retrieval",default:!0}},required:["execution_id"]}};async function ij(Y,X){let{execution_id:J,cleanup:z=!0}=Y;try{let Q=await x(X),G=`SNOW_FLOW_EXEC_${J}`,Z=await Q.get(`/api/now/table/sys_properties?sysparm_query=name=${G}&sysparm_limit=1`);if(Z.data.result&&Z.data.result.length>0){let H=Z.data.result[0],W=JSON.parse(H.value);if(z)await Q.delete(`/api/now/table/sys_properties/${H.sys_id}`);let K={print:(W.output||[]).filter((U)=>U.level==="print").map((U)=>U.message),info:(W.output||[]).filter((U)=>U.level==="info").map((U)=>U.message),warn:(W.output||[]).filter((U)=>U.level==="warn").map((U)=>U.message),error:(W.output||[]).filter((U)=>U.level==="error").map((U)=>U.message)};return N({execution_id:W.executionId,executed_at:W.completedAt,success:W.success,result:W.result,output:K,raw_output:W.output||[],error:W.error||null,execution_time_ms:W.executionTimeMs},{operation:"retrieve_script_output",cleanup_performed:z,source:"sys_properties"})}let $=await Q.get(`/api/now/table/sys_script_execution_history?sysparm_query=script_nameLIKE${J}&sysparm_limit=5`);if($.data.result&&$.data.result.length>0){let H=$.data.result[0];return N({execution_id:J,executed_at:H.sys_created_on,executed_by:H.sys_created_by,output:H.output||"No output captured",errors:H.error_message||null,source:"execution_history"},{operation:"retrieve_script_output",source:"execution_history"})}throw new I("NOT_FOUND",`No output found for execution ID: ${J}`,{retryable:!1,details:{possible_reasons:["The script is still executing","The execution ID is incorrect","The output has been cleaned up"]}})}catch(Q){return M(Q instanceof I?Q:new I("UNKNOWN_ERROR",Q.message,{originalError:Q}))}}var nj={name:"snow_property_manager",description:"Enhanced property management with get, set, and validation in one tool",category:"automation",subcategory:"configuration",use_cases:["automation","properties","configuration"],complexity:"intermediate",frequency:"high",permission:"write",allowedRoles:["developer","admin"],inputSchema:{type:"object",properties:{action:{type:"string",enum:["get","set","validate"],description:"Action to perform: get, set, or validate"},name:{type:"string",description:"Property name"},value:{type:"string",description:"Property value (required for set action)"},mask_sensitive:{type:"boolean",description:"Mask sensitive values like API keys",default:!0}},required:["action","name"]}};async function oj(Y,X){let{action:J,name:z,value:Q,mask_sensitive:G=!0}=Y;try{let Z=await x(X);switch(J){case"get":return await A10(Z,z,G);case"set":if(!Q)throw new I("INVALID_REQUEST","value is required for set action",{retryable:!1});return await w10(Z,z,Q);case"validate":return await T10(Z,z);default:throw new I("INVALID_REQUEST",`Invalid action: ${J}`,{retryable:!1})}}catch(Z){return M(Z instanceof I?Z:new I("UNKNOWN_ERROR",Z.message,{originalError:Z}))}}async function A10(Y,X,J){let z=await Y.get(`/api/now/table/sys_properties?sysparm_query=name=${X}&sysparm_limit=1`);if(!z.data.result||z.data.result.length===0)throw new I("NOT_FOUND",`Property not found: ${X}`,{retryable:!1});let Q=z.data.result[0],G=Q.value;if(J&&CG(X))G=aj(G);return N({name:Q.name,value:G,description:Q.description||"",type:Q.type||"string",sys_id:Q.sys_id,is_masked:J&&CG(X)},{operation:"get_property",property_name:X})}async function w10(Y,X,J){let z=await Y.get(`/api/now/table/sys_properties?sysparm_query=name=${X}&sysparm_limit=1`),Q;if(z.data.result&&z.data.result.length>0){let G=z.data.result[0].sys_id;Q=(await Y.patch(`/api/now/table/sys_properties/${G}`,{value:J})).data.result}else Q=(await Y.post("/api/now/table/sys_properties",{name:X,value:J,type:"string"})).data.result;return N({name:Q.name,value:CG(X)?aj(J):J,sys_id:Q.sys_id,operation:z.data.result.length>0?"updated":"created"},{operation:"set_property",property_name:X})}async function T10(Y,X){let J=await Y.get(`/api/now/table/sys_properties?sysparm_query=name=${X}&sysparm_limit=1`),z=J.data.result&&J.data.result.length>0,Q=z?J.data.result[0]:null,G={exists:z,name:X,is_valid:z,issues:[]};if(z){if(!Q.value||Q.value==="")G.issues.push("Property value is empty"),G.is_valid=!1;if(!Q.type)G.issues.push("Property type is not defined")}else G.issues.push("Property does not exist");return N(G,{operation:"validate_property",property_name:X})}function CG(Y){return[/password/i,/api[_-]?key/i,/secret/i,/token/i,/credential/i,/private[_-]?key/i].some((J)=>J.test(Y))}function aj(Y){if(!Y||Y.length<=4)return"****";return Y.substring(0,2)+"****"+Y.substring(Y.length-2)}var sj={name:"snow_rest_message_test_suite",description:"Comprehensive testing suite for REST messages including authentication, endpoints, headers, and response validation.",category:"automation",subcategory:"testing",use_cases:["automation","rest","testing"],complexity:"advanced",frequency:"low",permission:"read",allowedRoles:["developer","stakeholder","admin"],inputSchema:{type:"object",properties:{restMessageId:{type:"string",description:"REST message sys_id or name"},testAuthentication:{type:"boolean",description:"Test authentication",default:!0},testEndpoints:{type:"boolean",description:"Test all endpoints",default:!0},testHeaders:{type:"boolean",description:"Test header configuration",default:!0},validateResponses:{type:"boolean",description:"Validate response structures",default:!0}},required:["restMessageId"]}};async function rj(Y,X){let{restMessageId:J,testAuthentication:z=!0,testEndpoints:Q=!0,testHeaders:G=!0,validateResponses:Z=!0}=Y;try{let $=await x(X),H=J;if(!J.match(/^[a-f0-9]{32}$/)){let B=await $.get(`/api/now/table/sys_rest_message?sysparm_query=name=${J}&sysparm_limit=1`);if(!B.data.result||B.data.result.length===0)throw new I("SERVICENOW_API_ERROR",`REST message not found: ${J}`);H=B.data.result[0].sys_id}let K=(await $.get(`/api/now/table/sys_rest_message/${H}`)).data.result,U={rest_message_id:H,rest_message_name:K.name,tests_performed:[],overall_status:"pass",issues_found:[]};if(z){let B={test:"authentication",status:"pass",details:{}};if(!K.authentication||K.authentication==="no_authentication")B.status="warning",B.details={message:"No authentication configured"},U.issues_found.push("No authentication configured");else B.details={type:K.authentication,configured:!0};U.tests_performed.push(B)}if(Q){let O=(await $.get(`/api/now/table/sys_rest_message_fn?sysparm_query=rest_message=${H}`)).data.result,V={test:"endpoints",status:"pass",details:{total_endpoints:O.length,endpoints:O.map((L)=>({name:L.function_name,http_method:L.http_method,endpoint:L.endpoint}))}};if(O.length===0)V.status="fail",U.issues_found.push("No endpoints configured"),U.overall_status="fail";U.tests_performed.push(V)}if(G){let O=(await $.get(`/api/now/table/sys_rest_message_headers?sysparm_query=rest_message=${H}`)).data.result,V={test:"headers",status:"pass",details:{total_headers:O.length,headers:O.map((L)=>({name:L.name,value:L.value?"(configured)":"(empty)"}))}};U.tests_performed.push(V)}if(Z){let B={test:"response_validation",status:"pass",details:{message:"Response structure validation enabled"}};U.tests_performed.push(B)}return N({tested:!0,...U})}catch($){return M($ instanceof I?$:new I("UNKNOWN_ERROR",$.message,{originalError:$}))}}var tj={name:"snow_trace_execution",description:"Set up execution tracing configuration. Creates a trace session that scripts can write to. Use snow_get_script_output to retrieve trace data later.",category:"automation",subcategory:"monitoring",use_cases:["automation","tracing","debugging"],complexity:"advanced",frequency:"low",permission:"write",allowedRoles:["developer","admin"],inputSchema:{type:"object",properties:{track_id:{type:"string",description:"Unique tracking ID for this trace session"},include:{type:"array",items:{type:"string"},description:"What to track: scripts, rest_calls, errors, queries, all",default:["all"]},max_entries:{type:"number",description:"Maximum trace entries to store",default:1000},ttl_minutes:{type:"number",description:"Time-to-live for trace data in minutes",default:60}},required:["track_id"]}};async function ej(Y,X){let{track_id:J,include:z=["all"],max_entries:Q=1000,ttl_minutes:G=60}=Y;try{let Z=await x(X),$=z.includes("all"),H={scripts:$||z.includes("scripts"),rest_calls:$||z.includes("rest_calls"),errors:$||z.includes("errors"),queries:$||z.includes("queries")},W={trace_id:J,started_at:new Date().toISOString(),tracking:H,max_entries:Q,ttl_minutes:G,entries:[],status:"active"},K=`snow_flow.trace.${J}`,U=await Z.get("/api/now/table/sys_properties",{params:{sysparm_query:`name=${K}`,sysparm_fields:"sys_id",sysparm_limit:1}}),B;if(U.data?.result?.[0]?.sys_id)B=U.data.result[0].sys_id,await Z.patch(`/api/now/table/sys_properties/${B}`,{value:JSON.stringify(W)});else{let O=await Z.post("/api/now/table/sys_properties",{name:K,value:JSON.stringify(W),type:"string",description:`Snow-Flow execution trace - ${J}. Auto-expires after ${G} minutes.`});if(!O.data?.result?.sys_id)throw new I("SERVICENOW_API_ERROR","Failed to create trace configuration property",{details:O.data});B=O.data.result.sys_id}return N({trace_id:J,property_name:K,property_sys_id:B,tracking_enabled:H,max_entries:Q,ttl_minutes:G,started_at:W.started_at,status:"active",usage:{retrieve_trace:`Use snow_get_script_output with execution_id="${J}" to retrieve trace data`,add_entry:`In your scripts, use: gs.setProperty('${K}', JSON.stringify(updatedTraceData))`,stop_trace:`Delete the property or let it expire after ${G} minutes`},note:"This tool creates a trace configuration. Your scripts must write to the trace property to record entries."},{operation:"trace_execution",trace_id:J})}catch(Z){return M(Z instanceof I?Z:new I("UNKNOWN_ERROR",Z.message,{originalError:Z}))}}var SG={};G0(SG,{snow_update_set_query_exec:()=>GC,snow_update_set_query_def:()=>QC,snow_update_set_manage_exec:()=>XC,snow_update_set_manage_def:()=>YC,snow_ensure_active_update_set_exec:()=>$C,snow_ensure_active_update_set_def:()=>ZC});var YC={name:"snow_update_set_manage",description:`Unified tool for Update Set management (create, switch, complete, ignore, export, preview, add_artifact)

 CRITICAL: Update Set Tracking & OAuth Context

HOW TRACKING WORKS:
- Update Sets MUST be "current" for the user making changes (via API = OAuth service account)
- snow-flow uses OAuth service account  Update Set must be current for SERVICE ACCOUNT
- auto_switch=true (DEFAULT)  Changes ARE tracked automatically 
- auto_switch=false  Changes are NOT tracked 

APPLICATION SCOPE:
- Use application_scope parameter to create Update Sets within a scoped application
- Default is "global" for global scope development
- Provide application sys_id or scope name for scoped application development
- Update Sets in scoped apps only track changes to artifacts in that scope

UI VISIBILITY:
- Update Set current for service account  visible in YOUR UI
- To see it as current in YOUR ServiceNow UI, provide servicenow_username parameter
- This is OPTIONAL and only affects UI visibility, NOT tracking

RECOMMENDED USAGE:
- Always use auto_switch=true (default) for development work
- Add servicenow_username if you want to see it in your UI
- Use application_scope for scoped application development
- Only use auto_switch=false for non-development operations`,category:"development",subcategory:"update-sets",use_cases:["update-sets","change-tracking","deployment"],complexity:"intermediate",frequency:"high",permission:"write",allowedRoles:["developer","admin"],inputSchema:{type:"object",properties:{action:{type:"string",description:"Management action to perform",enum:["create","switch","complete","ignore","export","preview","add_artifact","current"]},update_set_id:{type:"string",description:"Update Set sys_id (required for switch/complete/export/preview, optional for add_artifact)"},name:{type:"string",description:'[create] Update Set name (e.g., "STORY-123: Add incident widget")'},description:{type:"string",description:"[create/complete] Description or completion notes"},user_story:{type:"string",description:"[create] User story or ticket number"},release_date:{type:"string",description:"[create] Target release date"},servicenow_username:{type:"string",description:'[create/switch] Optional: ServiceNow username to ALSO set Update Set as current for (e.g., "john.doe"). This makes the Update Set visible as current in YOUR ServiceNow UI. The Update Set is ALWAYS set as current for the OAuth service account to enable change tracking.'},auto_switch:{type:"boolean",description:"[create] Automatically switch to created Update Set for the service account (default: true). MUST be true for automatic change tracking. Only set to false if you are NOT making development changes.",default:!0},application_scope:{type:"string",description:'[create] Application scope for this Update Set. Use "global" (default) for global scope, or provide a scoped application sys_id or scope name (e.g., "x_myco_hr_portal"). When set to a scoped application, the Update Set will only track changes to artifacts within that application scope.',default:"global"},notes:{type:"string",description:"[complete] Completion notes or testing instructions"},include_preview:{type:"boolean",description:"[export/preview] Include change preview information",default:!0},include_payload:{type:"boolean",description:"[preview] Include XML payload details",default:!1},artifact_type:{type:"string",description:"[add_artifact] Artifact type (widget, flow, script, etc.)"},artifact_sys_id:{type:"string",description:"[add_artifact] ServiceNow sys_id of the artifact"},artifact_name:{type:"string",description:"[add_artifact] Artifact name for tracking"}},required:["action"]}};async function XC(Y,X){let{action:J}=Y;try{switch(J){case"create":return await I10(Y,X);case"switch":return await v10(Y,X);case"complete":return await D10(Y,X);case"ignore":return await j10(Y,X);case"export":return await C10(Y,X);case"preview":return await E10(Y,X);case"add_artifact":return await S10(Y,X);case"current":return await k10(Y,X);default:return M(`Unknown action: ${J}`)}}catch(z){return M(z.message)}}async function I10(Y,X){let{name:J,description:z,user_story:Q,release_date:G,auto_switch:Z=!0,servicenow_username:$,application_scope:H="global"}=Y;if(!J||!z)return M("name and description are required for create action");let W=await x(X),K="global",U="Global",B="global";if(H&&H!=="global")try{let q=await W.get("/api/now/table/sys_app",{params:{sysparm_query:`sys_id=${H}`,sysparm_fields:"sys_id,name,scope",sysparm_limit:1}});if(!q.data.result||q.data.result.length===0)q=await W.get("/api/now/table/sys_app",{params:{sysparm_query:`scope=${H}`,sysparm_fields:"sys_id,name,scope",sysparm_limit:1}});if(!q.data.result||q.data.result.length===0)q=await W.get("/api/now/table/sys_app",{params:{sysparm_query:`name=${H}`,sysparm_fields:"sys_id,name,scope",sysparm_limit:1}});if(q.data.result&&q.data.result.length>0){let F=q.data.result[0];K=F.sys_id,U=F.name,B=F.scope}else return M(`Application not found: "${H}". Please provide a valid application sys_id, scope name (e.g., "x_myco_app"), or application name. Use "global" for global scope.`)}catch(q){return M(`Failed to resolve application scope: ${q.message}`)}let V=(await W.post("/api/now/table/sys_update_set",{name:J,description:z,state:"in progress",application:K,release_date:G||""})).data.result,L={switched:!1,switched_for_user:null,switched_for_service_account:!1,message:"Update Set created but NOT set as current (auto_switch=false) - changes will NOT be tracked!"};if(Z)try{if(await JC(W,V.sys_id),L.switched=!0,L.switched_for_service_account=!0,L.message="Update Set set as current for OAuth service account (changes will be tracked)",$)await zC(W,V.sys_id,$),L.switched_for_user=$,L.message=`Update Set set as current for BOTH service account (tracking) AND user: ${$} (UI visibility)`;else L.message+=" (not visible in your UI - provide servicenow_username to see it)"}catch(q){console.error("Failed to switch update set:",q.message),L.message=` Update Set created but switching failed: ${q.message}. Changes may NOT be tracked!`}return N({sys_id:V.sys_id,name:V.name,description:V.description,state:"in progress",created_at:V.sys_created_on,created_by:V.sys_created_by,user_story:Q,application_scope:{sys_id:K,name:U,scope:B,is_global:K==="global"},switching:L,oauth_context_info:{message:" snow-flow uses OAuth service account - Update Sets apply to service account context",note:"To see Update Set as current in your ServiceNow UI, provide your ServiceNow username in servicenow_username parameter"},scope_info:K==="global"?"Update Set created in GLOBAL scope - changes to any artifact will be tracked":`Update Set created in APPLICATION scope "${U}" (${B}) - only changes to artifacts in this scope will be tracked`})}async function JC(Y,X){let J=await Y.get("/api/now/table/sys_user_preference",{params:{sysparm_query:"name=sys_update_set^user=javascript:gs.getUserID()",sysparm_limit:1}});if(J.data.result&&J.data.result.length>0)await Y.patch(`/api/now/table/sys_user_preference/${J.data.result[0].sys_id}`,{value:X});else await Y.post("/api/now/table/sys_user_preference",{name:"sys_update_set",value:X,user:"javascript:gs.getUserID()"})}async function zC(Y,X,J){let z=await Y.get("/api/now/table/sys_user",{params:{sysparm_query:`user_name=${J}`,sysparm_fields:"sys_id,user_name,name",sysparm_limit:1}});if(!z.data.result||z.data.result.length===0)throw Error(`ServiceNow user not found: ${J}`);let Q=z.data.result[0].sys_id,G=await Y.get("/api/now/table/sys_user_preference",{params:{sysparm_query:`name=sys_update_set^user=${Q}`,sysparm_limit:1}});if(G.data.result&&G.data.result.length>0)await Y.patch(`/api/now/table/sys_user_preference/${G.data.result[0].sys_id}`,{value:X});else await Y.post("/api/now/table/sys_user_preference",{name:"sys_update_set",value:X,user:Q})}async function v10(Y,X){let{update_set_id:J,servicenow_username:z}=Y;if(!J)return M("update_set_id is required for switch action");let Q=await x(X),G=await Q.get(`/api/now/table/sys_update_set/${J}`,{params:{sysparm_fields:"sys_id,name,description,state,sys_created_on"}});if(!G.data.result)return M(`Update Set not found: ${J}`);let Z=G.data.result,$={switched:!1,switched_for_user:null,switched_for_service_account:!1,message:""};try{if(z)await zC(Q,J,z),$.switched=!0,$.switched_for_user=z,$.message=`Update Set switched for ServiceNow user: ${z}`;else await JC(Q,J),$.switched=!0,$.switched_for_service_account=!0,$.message="Update Set switched for OAuth service account only (not visible in your UI)";return N({sys_id:Z.sys_id,name:Z.name,description:Z.description,state:Z.state,created_at:Z.sys_created_on,switching:$,oauth_context_info:{message:" snow-flow uses OAuth service account - Update Sets apply to service account context",note:"To see Update Set as current in your ServiceNow UI, provide your ServiceNow username in servicenow_username parameter"}})}catch(H){return M(`Failed to switch update set: ${H.message}`)}}async function D10(Y,X){let{update_set_id:J,notes:z}=Y,Q=await x(X),G=J;if(!G){let U=await Q.get("/api/now/table/sys_update_set",{params:{sysparm_query:"is_current=true",sysparm_fields:"sys_id",sysparm_limit:1}});if(!U.data.result||U.data.result.length===0)return M("No Update Set specified and no active Update Set found");G=U.data.result[0].sys_id}let Z=await Q.get(`/api/now/table/sys_update_set/${G}`,{params:{sysparm_fields:"sys_id,name,description,state"}});if(!Z.data.result)return M(`Update Set not found: ${G}`);let $=Z.data.result,H={state:"complete"};if(z)H.description=`${$.description}

Completion Notes: ${z}`;await Q.put(`/api/now/table/sys_update_set/${G}`,H);let K=(await Q.get("/api/now/table/sys_update_xml",{params:{sysparm_query:`update_set=${G}`,sysparm_fields:"sys_id",sysparm_limit:1000}})).data.result?.length||0;return N({sys_id:G,name:$.name,state:"complete",artifact_count:K,notes:z||null,message:"Update Set marked as complete. No further changes can be made."})}async function j10(Y,X){let{update_set_id:J,notes:z}=Y,Q=await x(X),G=J;if(!G){let U=await Q.get("/api/now/table/sys_update_set",{params:{sysparm_query:"is_current=true",sysparm_fields:"sys_id",sysparm_limit:1}});if(!U.data.result||U.data.result.length===0)return M("No Update Set specified and no active Update Set found");G=U.data.result[0].sys_id}let Z=await Q.get(`/api/now/table/sys_update_set/${G}`,{params:{sysparm_fields:"sys_id,name,description,state"}});if(!Z.data.result)return M(`Update Set not found: ${G}`);let $=Z.data.result;if($.state==="ignore")return N({sys_id:G,name:$.name,state:"ignore",already_ignored:!0,message:"Update Set is already in ignore state"});let H={state:"ignore"};if(z)H.description=`${$.description}

Ignore Notes: ${z}`;await Q.put(`/api/now/table/sys_update_set/${G}`,H);let K=(await Q.get("/api/now/table/sys_update_xml",{params:{sysparm_query:`update_set=${G}`,sysparm_fields:"sys_id",sysparm_limit:1000}})).data.result?.length||0;return N({sys_id:G,name:$.name,previous_state:$.state,state:"ignore",artifact_count:K,notes:z||null,message:"Update Set marked as IGNORE. It will NOT be deployed or migrated to other environments."})}async function C10(Y,X){let{update_set_id:J,include_preview:z=!0}=Y;if(!J)return M("update_set_id is required for export action");let Q=await x(X),G=await Q.get(`/api/now/table/sys_update_set/${J}`,{params:{sysparm_fields:"sys_id,name,description,state,sys_created_on,sys_created_by"}});if(!G.data.result)return M(`Update Set not found: ${J}`);let Z=G.data.result,H=(await Q.get("/api/now/table/sys_update_xml",{params:{sysparm_query:`update_set=${J}`,sysparm_fields:"sys_id,type,name,target_name,action,payload,sys_updated_on",sysparm_limit:1e4}})).data.result||[],W='<?xml version="1.0" encoding="UTF-8"?>',K=`
<unload unload_date="${new Date().toISOString()}">
  <sys_remote_update_set action="INSERT_OR_UPDATE">
    <sys_id>${Z.sys_id}</sys_id>
    <name>${s6(Z.name)}</name>
    <description>${s6(Z.description||"")}</description>
    <state>${Z.state}</state>
    <sys_created_on>${Z.sys_created_on}</sys_created_on>
    <sys_created_by>${Z.sys_created_by}</sys_created_by>
  </sys_remote_update_set>
  ${H.map((O)=>`
  <sys_update_xml action="INSERT_OR_UPDATE">
    <sys_id>${O.sys_id}</sys_id>
    <type>${s6(O.type||"")}</type>
    <name>${s6(O.name||"")}</name>
    <target_name>${s6(O.target_name||"")}</target_name>
    <action>${O.action}</action>
    <update_set>${J}</update_set>
    <payload>${s6(O.payload||"")}</payload>
    <sys_updated_on>${O.sys_updated_on}</sys_updated_on>
  </sys_update_xml>`).join("")}
</unload>`.trim(),U=W+`
`+K,B=null;if(z){let O={};H.forEach((V)=>{let L=V.type||"Unknown";O[L]=(O[L]||0)+1}),B={total_changes:H.length,changes_by_type:O}}return N({update_set:{sys_id:Z.sys_id,name:Z.name,state:Z.state},export:{xml:U,size_bytes:Buffer.byteLength(U,"utf8"),change_count:H.length},...B&&{preview:B},exported_at:new Date().toISOString()})}async function E10(Y,X){let{update_set_id:J,include_payload:z=!1}=Y,Q=await x(X),G=J;if(!G){let U=await Q.get("/api/now/table/sys_update_set",{params:{sysparm_query:"is_current=true",sysparm_fields:"sys_id,name",sysparm_limit:1}});if(!U.data.result||U.data.result.length===0)return M("No Update Set specified and no active Update Set found");G=U.data.result[0].sys_id}let Z=await Q.get(`/api/now/table/sys_update_set/${G}`,{params:{sysparm_fields:"sys_id,name,description,state,sys_created_on"}});if(!Z.data.result)return M(`Update Set not found: ${G}`);let $=Z.data.result,W=(await Q.get("/api/now/table/sys_update_xml",{params:{sysparm_query:`update_set=${G}`,sysparm_fields:z?"sys_id,type,name,target_name,action,sys_updated_on,sys_updated_by,payload":"sys_id,type,name,target_name,action,sys_updated_on,sys_updated_by",sysparm_limit:1000}})).data.result||[],K={};return W.forEach((U)=>{let B=U.type||"Unknown";if(!K[B])K[B]=[];K[B].push({name:U.name,target:U.target_name,action:U.action,updated_at:U.sys_updated_on,updated_by:U.sys_updated_by,...z&&{payload:U.payload}})}),N({update_set:{sys_id:$.sys_id,name:$.name,description:$.description,state:$.state,created_at:$.sys_created_on},changes:{total_count:W.length,by_type:K,type_summary:Object.entries(K).map(([U,B])=>({type:U,count:B.length}))},preview_generated_at:new Date().toISOString()})}async function S10(Y,X){let{artifact_type:J,artifact_sys_id:z,artifact_name:Q,update_set_id:G}=Y;if(!J||!z||!Q)return M("artifact_type, artifact_sys_id, and artifact_name are required for add_artifact action");let Z=await x(X),$=G;if(!$){let K=await Z.get("/api/now/table/sys_update_set",{params:{sysparm_query:"is_current=true",sysparm_fields:"sys_id,name",sysparm_limit:1}});if(!K.data.result||K.data.result.length===0)return M("No Update Set specified and no active Update Set found");$=K.data.result[0].sys_id}let W=(await Z.post("/api/now/table/sys_update_xml",{update_set:$,type:J,name:Q,target_name:z,action:"INSERT_OR_UPDATE",payload:`<!-- Artifact tracked: ${J} - ${Q} -->`})).data.result;return N({tracked:!0,update_set_id:$,artifact:{type:J,sys_id:z,name:Q,tracking_record:W.sys_id},message:`Artifact '${Q}' (${J}) added to Update Set`})}async function k10(Y,X){let J=await x(X),z=await J.get("/api/now/table/sys_user_preference",{params:{sysparm_query:"name=sys_update_set^user=javascript:gs.getUserID()",sysparm_fields:"value",sysparm_limit:1}});if(!z.data.result||z.data.result.length===0)return M("No current update set found for the OAuth service account. Create or switch to an update set first.");let Q=z.data.result[0].value,G=await J.get(`/api/now/table/sys_update_set/${Q}`,{params:{sysparm_fields:"sys_id,name,description,state,sys_created_on,sys_created_by,sys_updated_on"}});if(!G.data.result)return M(`Current update set reference found but update set not found: ${Q}`);let Z=G.data.result,H=(await J.get("/api/now/table/sys_update_xml",{params:{sysparm_query:`update_set=${Q}`,sysparm_fields:"sys_id,type",sysparm_limit:1000}})).data.result||[],W={};return H.forEach((K)=>{let U=K.type||"Unknown";W[U]=(W[U]||0)+1}),N({sys_id:Z.sys_id,name:Z.name,description:Z.description,state:Z.state,created_at:Z.sys_created_on,created_by:Z.sys_created_by,updated_at:Z.sys_updated_on,artifact_count:H.length,artifacts_by_type:W,is_current:!0,oauth_context_info:{message:" This is the current update set for the OAuth service account",note:"All changes made via snow-flow are automatically tracked in this update set"}})}function s6(Y){return Y.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;")}var QC={name:"snow_update_set_query",description:"Query Update Sets (get current or list multiple)",category:"development",subcategory:"update-sets",use_cases:["update-sets","query","status"],complexity:"beginner",frequency:"high",permission:"write",allowedRoles:["developer","admin"],inputSchema:{type:"object",properties:{action:{type:"string",description:"Query action to perform",enum:["current","list"]},state:{type:"string",description:"[list] Filter by state",enum:["in progress","complete","released"]},limit:{type:"number",description:"[list] Maximum number of results",default:10},order_by:{type:"string",description:"[list] Order by field",default:"sys_created_on"}},required:["action"]}};async function GC(Y,X){let{action:J}=Y;try{switch(J){case"current":return await _10(Y,X);case"list":return await b10(Y,X);default:return M(`Unknown action: ${J}`)}}catch(z){return M(z.message)}}async function _10(Y,X){let J=await x(X),z=await J.get("/api/now/table/sys_update_set",{params:{sysparm_query:"is_current=true",sysparm_fields:"sys_id,name,description,state,sys_created_on,sys_created_by",sysparm_limit:1}});if(!z.data.result||z.data.result.length===0)return N({active:!1,message:"No active Update Set found"});let Q=z.data.result[0],Z=(await J.get("/api/now/table/sys_update_xml",{params:{sysparm_query:`update_set=${Q.sys_id}`,sysparm_fields:"sys_id",sysparm_limit:1000}})).data.result?.length||0;return N({active:!0,sys_id:Q.sys_id,name:Q.name,description:Q.description,state:Q.state,created_at:Q.sys_created_on,created_by:Q.sys_created_by,artifact_count:Z})}async function b10(Y,X){let{state:J,limit:z=10,order_by:Q="sys_created_on"}=Y,G=await x(X),Z="";if(J)Z=`state=${J}`;let H=(await G.get("/api/now/table/sys_update_set",{params:{sysparm_query:Z,sysparm_fields:"sys_id,name,description,state,sys_created_on,sys_created_by,sys_updated_on",sysparm_limit:z,sysparm_orderby:`DESC${Q}`}})).data.result||[],W=await Promise.all(H.map(async(K)=>{let U=await G.get("/api/now/table/sys_update_xml",{params:{sysparm_query:`update_set=${K.sys_id}`,sysparm_fields:"sys_id",sysparm_limit:1}});return{sys_id:K.sys_id,name:K.name,description:K.description,state:K.state,created_at:K.sys_created_on,created_by:K.sys_created_by,updated_at:K.sys_updated_on,artifact_count:U.data.result?.length||0}}));return N({update_sets:W,count:W.length,filtered_by:J||"all",limit:z})}var ZC={name:"snow_ensure_active_update_set",description:"Ensure Update Set is active and optionally set as current for user",category:"development",subcategory:"update-sets",use_cases:["update-sets","activation","change-tracking"],complexity:"intermediate",frequency:"high",permission:"write",allowedRoles:["developer","admin"],inputSchema:{type:"object",properties:{name:{type:"string",description:"Update Set name (creates if doesn't exist)"},description:{type:"string",description:"Description for new Update Set"},sync_with_user:{type:"boolean",description:"Set this as user's current Update Set in ServiceNow",default:!0},create_if_missing:{type:"boolean",description:"Create Update Set if it doesn't exist",default:!0},application_scope:{type:"string",description:'Application scope for the Update Set. Use "global" (default) for global scope, or provide a scoped application sys_id or scope name.',default:"global"}},required:["name"]}};async function $C(Y,X){let{name:J,description:z=`Snow-Flow: ${J}`,sync_with_user:Q=!0,create_if_missing:G=!0,application_scope:Z="global"}=Y;try{let $=await x(X),H="global",W="Global",K="global";if(Z&&Z!=="global"){let O=await $.get("/api/now/table/sys_app",{params:{sysparm_query:`sys_id=${Z}`,sysparm_fields:"sys_id,name,scope",sysparm_limit:1}});if(!O.data.result||O.data.result.length===0)O=await $.get("/api/now/table/sys_app",{params:{sysparm_query:`scope=${Z}`,sysparm_fields:"sys_id,name,scope",sysparm_limit:1}});if(O.data.result&&O.data.result.length>0){let V=O.data.result[0];H=V.sys_id,W=V.name,K=V.scope}else return M(`Application not found: "${Z}". Use "global" for global scope.`)}let U=await $.get("/api/now/table/sys_update_set",{params:{sysparm_query:`name=${J}`,sysparm_limit:1}}),B;if(U.data.result.length>0){if(B=U.data.result[0],B.state!=="in progress")await $.put(`/api/now/table/sys_update_set/${B.sys_id}`,{state:"in progress"})}else if(G)B=(await $.post("/api/now/table/sys_update_set",{name:J,description:z,state:"in progress",application:H})).data.result;else return M(`Update Set not found: ${J}`);if(Q)await $.put(`/api/now/table/sys_update_set/${B.sys_id}`,{is_current:!0}),await $.post("/api/now/table/sys_user_preference",{name:"sys.update_set",value:B.sys_id,user:"current"});return N({sys_id:B.sys_id,name:B.name,description:B.description,state:"in progress",is_current:Q,created:U.data.result.length===0,application_scope:{sys_id:H,name:W,scope:K,is_global:H==="global"}})}catch($){return M($.message)}}var _G={};G0(_G,{snow_sync_status_exec:()=>wC,snow_sync_status_def:()=>AC,snow_sync_cleanup_exec:()=>xC,snow_sync_cleanup_def:()=>qC,snow_push_artifact_exec:()=>NC,snow_push_artifact_def:()=>LC,snow_pull_artifact_exec:()=>MC,snow_pull_artifact_def:()=>OC,snow_list_supported_artifacts_exec:()=>BC,snow_list_supported_artifacts_def:()=>UC,snow_convert_to_es5_exec:()=>KC,snow_convert_to_es5_def:()=>WC});var WC={name:"snow_convert_to_es5",description:"Convert modern JavaScript (ES6+) to ES5 for ServiceNow Rhino engine",category:"development",subcategory:"local-sync",use_cases:["es5-conversion","validation","development"],complexity:"intermediate",frequency:"high",permission:"read",allowedRoles:["developer","stakeholder","admin"],inputSchema:{type:"object",properties:{code:{type:"string",description:"JavaScript code to convert to ES5"},validate_only:{type:"boolean",description:"Only validate ES5 compliance without converting",default:!1}},required:["code"]}};async function KC(Y,X){let{code:J,validate_only:z=!1}=Y;try{let Q=HC(J);if(z)return N({valid:Q.length===0,violations:Q,es5_compliant:Q.length===0});let G=J,Z=[];G=G.replace(/\b(const|let)\s+/g,(H,W)=>{return Z.push({from:W,to:"var",type:"variable_declaration"}),"var "}),G=G.replace(/\(([^)]*)\)\s*=>\s*\{/g,(H,W)=>{return Z.push({from:`(${W}) => {`,to:`function(${W}) {`,type:"arrow_function"}),`function(${W}) {`}),G=G.replace(/\(([^)]*)\)\s*=>\s*([^;{}\n]+)/g,(H,W,K)=>{return Z.push({from:`(${W}) => ${K}`,to:`function(${W}) { return ${K}; }`,type:"arrow_function_single"}),`function(${W}) { return ${K}; }`}),G=G.replace(/`([^`]*)`/g,(H,W)=>{let U=`'${W.replace(/\$\{([^}]+)\}/g,(B,O)=>`' + (${O}) + '`)}'`.replace(/'' \+ /g,"").replace(/ \+ ''/g,"");return Z.push({from:H,to:U,type:"template_literal"}),U}),G=G.replace(/(?:const|let|var)\s*\{([^}]+)\}\s*=\s*([^;]+);/g,(H,W,K)=>{let B=W.split(",").map((O)=>O.trim()).map((O)=>`var ${O} = ${K}.${O};`).join(`
`);return Z.push({from:H,to:B,type:"destructuring"}),B}),G=G.replace(/for\s*\(\s*(?:const|let|var)\s+(\w+)\s+of\s+([^)]+)\)/g,(H,W,K)=>{let U=`for (var __i = 0; __i < ${K}.length; __i++) {
var ${W} = ${K}[__i];`;return Z.push({from:H,to:U,type:"for_of_loop"}),U});let $=HC(G);return N({original_code:J,es5_code:G,conversions:Z,conversions_count:Z.length,es5_compliant:$.length===0,remaining_violations:$})}catch(Q){return M(Q.message)}}function HC(Y){let X=[];return[{regex:/\bconst\s+/g,type:"const",severity:"error"},{regex:/\blet\s+/g,type:"let",severity:"error"},{regex:/\([^)]*\)\s*=>/g,type:"arrow_function",severity:"error"},{regex:/`[^`]*`/g,type:"template_literal",severity:"error"},{regex:/\{[^}]+\}\s*=/g,type:"destructuring",severity:"error"},{regex:/for\s*\([^)]*\s+of\s+/g,type:"for_of",severity:"error"},{regex:/class\s+\w+/g,type:"class",severity:"error"},{regex:/\.\.\./g,type:"spread_operator",severity:"error"}].forEach(({regex:z,type:Q,severity:G})=>{let Z;while((Z=z.exec(Y))!==null)X.push({type:Q,severity:G,line:Y.substring(0,Z.index).split(`
`).length,code:Z[0],fix:R10(Q)})}),X}function R10(Y){return{const:"Use 'var' instead",let:"Use 'var' instead",arrow_function:"Use function() {} syntax",template_literal:"Use string concatenation with +",destructuring:"Use explicit property access",for_of:"Use traditional for loop with index",class:"Use function constructor with prototype",spread_operator:"Use Array.prototype methods"}[Y]||"Convert to ES5 equivalent"}var UC={name:"snow_list_supported_artifacts",description:"List all ServiceNow artifact types supported by local sync",category:"development",subcategory:"local-sync",use_cases:["local-sync","artifact-discovery","sync-capabilities"],complexity:"beginner",frequency:"low",permission:"read",allowedRoles:["developer","stakeholder","admin"],inputSchema:{type:"object",properties:{include_details:{type:"boolean",description:"Include field mappings and sync capabilities",default:!1},category:{type:"string",description:"Filter by artifact category",enum:["ui","script","flow","data","integration","all"],default:"all"}}}};async function BC(Y,X){let{include_details:J=!1,category:z="all"}=Y,Q=f10(z);if(J)return N({total_count:Q.length,artifacts:Q.map((G)=>({...G,fields:y10(G.table),capabilities:h10(G.table)}))},{category:z});return N({total_count:Q.length,artifacts:Q.map((G)=>({table:G.table,name:G.name,category:G.category,description:G.description}))},{category:z})}function f10(Y){let X=[{table:"sp_widget",name:"Service Portal Widget",category:"ui",description:"Service Portal widgets with HTML/CSS/JS"},{table:"sys_ux_page",name:"UI Builder Page",category:"ui",description:"UI Builder / Experience pages"},{table:"sys_ui_page",name:"UI Page",category:"ui",description:"Classic UI pages with HTML/Jelly"},{table:"sys_ui_macro",name:"UI Macro",category:"ui",description:"Reusable UI macros"},{table:"sys_ux_lib_component",name:"UI Component",category:"ui",description:"UI Builder custom components"},{table:"sys_script_include",name:"Script Include",category:"script",description:"Server-side reusable scripts"},{table:"sys_script",name:"Business Rule",category:"script",description:"Business rules for table operations"},{table:"sys_script_client",name:"Client Script",category:"script",description:"Client-side form scripts"},{table:"sys_ui_script",name:"UI Script",category:"script",description:"Global client-side scripts"},{table:"sys_script_fix",name:"Fix Script",category:"script",description:"One-time fix scripts"},{table:"sysauto_script",name:"Scheduled Job",category:"script",description:"Scheduled background scripts"},{table:"sys_hub_flow",name:"Flow Designer Flow",category:"flow",description:"Flow Designer workflows"},{table:"sys_hub_action_type",name:"Flow Action",category:"flow",description:"Custom flow actions"},{table:"wf_workflow",name:"Workflow",category:"flow",description:"Classic workflow engine"},{table:"sys_transform_map",name:"Transform Map",category:"data",description:"Data transformation maps"},{table:"sys_import_set_row",name:"Import Set",category:"data",description:"Data import staging"},{table:"sys_rest_message",name:"REST Message",category:"integration",description:"Outbound REST integrations"},{table:"sys_web_service",name:"Web Service",category:"integration",description:"SOAP web services"},{table:"sys_rest_message_fn",name:"REST Method",category:"integration",description:"REST message methods"}];if(Y==="all")return X;return X.filter((J)=>J.category===Y)}function y10(Y){return{sp_widget:{files:["template.html","script.js","client_script.js","css.css","option_schema.json"],metadata:["name","description","data_table","public","roles"]},sys_script_include:{files:["script.js"],metadata:["name","description","api_name","client_callable","access"]},sys_script:{files:["script.js","condition.js"],metadata:["name","table","when","order","active","filter_condition"]},sys_hub_flow:{files:["flow_definition.json"],metadata:["name","description","trigger_type","active"]},sys_ux_page:{files:["page_config.json"],metadata:["name","title","route","experience"]}}[Y]||{files:["main.txt"],metadata:["name"]}}function h10(Y){return{supports_pull:!0,supports_push:!0,supports_es5_validation:["sys_script_include","sys_script","sp_widget"].includes(Y),supports_coherence_check:["sp_widget"].includes(Y),requires_update_set:!0,supports_versioning:!0}}import*as S4 from"fs/promises";import*as X4 from"path";import*as VC from"os";var OC={name:"snow_pull_artifact",description:"Pull ServiceNow artifact to local files for editing with native tools",category:"development",subcategory:"local-sync",use_cases:["local-development","artifact-sync","editing"],complexity:"beginner",frequency:"high",permission:"write",allowedRoles:["developer","admin"],inputSchema:{type:"object",properties:{sys_id:{type:"string",description:"sys_id of artifact to pull"},table:{type:"string",description:"Table name (optional, will auto-detect if not provided)",enum:["sp_widget","sys_ux_page","sys_hub_flow","sys_script_include"]},output_dir:{type:"string",description:"Local directory to save files (default: /tmp/snow-flow-artifacts)"}},required:["sys_id"]}};async function MC(Y,X){let{sys_id:J,table:z,output_dir:Q=X4.join(VC.tmpdir(),"snow-flow-artifacts")}=Y;try{let G=await x(X),Z=z;if(!Z)Z=await m10(G,J);let $=await G.get(`/api/now/table/${Z}/${J}`);if(!$.data||!$.data.result)return M(`Artifact not found: ${J}`);let H=$.data.result,W=H.name||H.id||J,K=X4.join(Q,Z,W);await S4.mkdir(K,{recursive:!0});let U=[];if(Z==="sp_widget"){if(H.template){let V=X4.join(K,`${W}.html`);await S4.writeFile(V,H.template,"utf-8"),U.push(V)}if(H.script){let V=X4.join(K,`${W}.server.js`);await S4.writeFile(V,H.script,"utf-8"),U.push(V)}if(H.client_script){let V=X4.join(K,`${W}.client.js`);await S4.writeFile(V,H.client_script,"utf-8"),U.push(V)}if(H.css){let V=X4.join(K,`${W}.css`);await S4.writeFile(V,H.css,"utf-8"),U.push(V)}if(H.option_schema){let V=X4.join(K,`${W}.options.json`);await S4.writeFile(V,H.option_schema,"utf-8"),U.push(V)}}else if(Z==="sys_script_include"){let V=X4.join(K,`${W}.js`);await S4.writeFile(V,H.script||"","utf-8"),U.push(V)}let B=X4.join(K,"README.md"),O=`# ${W}

**Type:** ${Z}
**sys_id:** ${J}
**Description:** ${H.description||"No description"}

## Files

${U.map((V)=>`- ${X4.basename(V)}`).join(`
`)}

## Instructions

1. Edit files using Claude Code native tools
2. Use multi-file search and refactoring
3. Validate changes with snow_validate_artifact_coherence
4. Push changes back with snow_push_artifact

## Original Data

\`\`\`json
${JSON.stringify(H,null,2)}
\`\`\`
`;return await S4.writeFile(B,O,"utf-8"),U.push(B),N({directory:K,files:U,artifact:{sys_id:J,table:Z,name:W}})}catch(G){return M(G.message)}}async function m10(Y,X){let J=["sp_widget","sys_ux_page","sys_hub_flow","sys_script_include"];for(let z of J)try{let Q=await Y.get(`/api/now/table/${z}/${X}`,{params:{sysparm_fields:"sys_id"}});if(Q.data&&Q.data.result)return z}catch(Q){continue}throw Error(`Could not detect table for sys_id: ${X}`)}import*as f7 from"fs/promises";import*as kG from"path";var LC={name:"snow_push_artifact",description:"Push locally edited artifact files back to ServiceNow with validation",category:"development",subcategory:"local-sync",use_cases:["local-development","artifact-sync","deployment"],complexity:"beginner",frequency:"high",permission:"write",allowedRoles:["developer","admin"],inputSchema:{type:"object",properties:{sys_id:{type:"string",description:"sys_id of artifact to update"},directory:{type:"string",description:"Directory containing edited artifact files"},validate:{type:"boolean",description:"Validate before pushing (ES5, coherence)",default:!0},force:{type:"boolean",description:"Force push despite validation warnings",default:!1}},required:["sys_id","directory"]}};async function NC(Y,X){let{sys_id:J,directory:z,validate:Q=!0,force:G=!1}=Y;try{let Z=await x(X),{table:$,artifact:H}=await u10(z),W=[];if(Q&&!G){if($==="sp_widget"){if(H.script){let O=g10(H.script);if(!O.valid)W.push(`Server script contains ES6+ syntax (${O.violations.map((V)=>V.type).join(", ")}). This may cause issues in ServiceNow's Rhino engine.`)}let B=p10(H);if(!B.coherent){let O=B.issues.filter((V)=>V.severity==="critical");if(O.length>0)throw new I("WIDGET_COHERENCE_ERROR","Widget coherence validation failed",{details:{issues:O}})}}}let K=await Z.put(`/api/now/table/${$}/${J}`,H),U={updated:!0,sys_id:J,table:$,artifact:K.data.result,validation:Q?W.length>0?"passed_with_warnings":"passed":"skipped"};if(W.length>0)U.warnings=W;return N(U)}catch(Z){return M(Z instanceof I?Z:Z.message)}}async function u10(Y){let X=await f7.readdir(Y);if(X.some((Q)=>Q.endsWith(".server.js")||Q.endsWith(".client.js"))){let Q={};for(let G of X){let Z=kG.join(Y,G),$=await f7.readFile(Z,"utf-8");if(G.endsWith(".html"))Q.template=$;else if(G.endsWith(".server.js"))Q.script=$;else if(G.endsWith(".client.js"))Q.client_script=$;else if(G.endsWith(".css"))Q.css=$;else if(G.endsWith(".options.json"))Q.option_schema=$}return{table:"sp_widget",artifact:Q}}let z=X.find((Q)=>Q.endsWith(".js"));if(z)return{table:"sys_script_include",artifact:{script:await f7.readFile(kG.join(Y,z),"utf-8")}};throw Error("Could not determine artifact type from directory")}function g10(Y){let X=[];return[{regex:/\b(const|let)\s+/g,type:"const/let"},{regex:/\([^)]*\)\s*=>/g,type:"arrow_function"},{regex:/`[^`]*`/g,type:"template_literal"}].forEach(({regex:z,type:Q})=>{let G;while((G=z.exec(Y))!==null)X.push({type:Q,code:G[0]})}),{valid:X.length===0,violations:X}}function p10(Y){let X=[];if(Y.template&&Y.script){let J=[...Y.template.matchAll(/\{\{data\.(\w+)\}\}/g)].map((Q)=>Q[1]),z=[...Y.script.matchAll(/data\.(\w+)\s*=/g)].map((Q)=>Q[1]);J.forEach((Q)=>{if(!z.includes(Q))X.push({type:"missing_data",severity:"critical",description:`HTML references data.${Q} but server doesn't initialize it`})})}return{coherent:X.filter((J)=>J.severity==="critical").length===0,issues:X}}import*as s0 from"fs/promises";import*as J4 from"path";var qC={name:"snow_sync_cleanup",description:"Clean up local artifact files after sync with retention policies",category:"development",subcategory:"local-sync",use_cases:["cleanup","maintenance","local-development"],complexity:"beginner",frequency:"low",permission:"write",allowedRoles:["developer","admin"],inputSchema:{type:"object",properties:{sys_id:{type:"string",description:"Artifact sys_id to clean up"},cleanup_all:{type:"boolean",description:"Clean up all synced artifacts",default:!1},keep_backup:{type:"boolean",description:"Keep backup before deletion",default:!0},max_age_days:{type:"number",description:"Clean files older than N days (0 = all)",default:0}}}};async function xC(Y,X){let{sys_id:J,cleanup_all:z=!1,keep_backup:Q=!0,max_age_days:G=0}=Y;try{let Z=J4.join("/tmp","snow-flow-artifacts");try{await s0.access(Z)}catch{return N({message:"No artifacts to clean up",cleaned:0})}let $=0,H=[];if(z){let W=await d10(Z,Q,G);$=W.count,H=W.backups}else if(J){let W=await c10(Z,J,Q);$=W.count,H=W.backups}else return M("Either sys_id or cleanup_all must be specified");return N({cleaned:!0,artifacts_cleaned:$,backup_created:Q,backup_paths:H},{sys_id:J,cleanup_all:z})}catch(Z){return M(Z.message)}}async function c10(Y,X,J){let z=0,Q=[],G=await s0.readdir(Y);for(let Z of G){let $=J4.join(Y,Z);if(!(await s0.stat($)).isDirectory())continue;let W=await s0.readdir($);for(let K of W){let U=J4.join($,K),B=J4.join(U,".metadata.json");try{if(JSON.parse(await s0.readFile(B,"utf-8")).sys_id===X){if(J){let V=await FC(U,X);Q.push(V)}await s0.rm(U,{recursive:!0,force:!0}),z++}}catch{}}}return{count:z,backups:Q}}async function d10(Y,X,J){let z=0,Q=[],G=J>0?Date.now()-J*24*60*60*1000:0,Z=await s0.readdir(Y);for(let $ of Z){let H=J4.join(Y,$);if(!(await s0.stat(H)).isDirectory())continue;let K=await s0.readdir(H);for(let U of K){let B=J4.join(H,U),O=await s0.stat(B);if(J>0&&O.mtimeMs>G)continue;try{let V=J4.join(B,".metadata.json"),L=JSON.parse(await s0.readFile(V,"utf-8"));if(X){let q=await FC(B,L.sys_id);Q.push(q)}await s0.rm(B,{recursive:!0,force:!0}),z++}catch{}}}return{count:z,backups:Q}}async function FC(Y,X){let J=J4.join("/tmp","snow-flow-backups");await s0.mkdir(J,{recursive:!0});let z=new Date().toISOString().replace(/[:.]/g,"-"),Q=J4.join(J,`${X}_${z}`);return await PC(Y,Q),Q}async function PC(Y,X){await s0.mkdir(X,{recursive:!0});let J=await s0.readdir(Y,{withFileTypes:!0});for(let z of J){let Q=J4.join(Y,z.name),G=J4.join(X,z.name);if(z.isDirectory())await PC(Q,G);else await s0.copyFile(Q,G)}}import*as P1 from"fs/promises";import*as x4 from"path";var AC={name:"snow_sync_status",description:"Get status of locally synced artifacts including changes and validation",category:"development",subcategory:"local-sync",use_cases:["status","monitoring","local-development"],complexity:"beginner",frequency:"medium",permission:"write",allowedRoles:["developer","admin"],inputSchema:{type:"object",properties:{sys_id:{type:"string",description:"Specific artifact sys_id to check"},check_all:{type:"boolean",description:"Check all synced artifacts",default:!1},include_file_details:{type:"boolean",description:"Include file-level details",default:!1},validate_coherence:{type:"boolean",description:"Run coherence validation",default:!1}}}};async function wC(Y,X){let{sys_id:J,check_all:z=!1,include_file_details:Q=!1,validate_coherence:G=!1}=Y;try{let Z=x4.join("/tmp","snow-flow-artifacts");try{await P1.access(Z)}catch{return N({message:"No synced artifacts found",artifacts:[]})}let $=[];if(z)$=await i10(Z,Q,G);else if(J){let H=await l10(Z,J,Q,G);if(H)$=[H]}else return M("Either sys_id or check_all must be specified");return N({total_artifacts:$.length,artifacts:$,sync_directory:Z},{sys_id:J,check_all:z})}catch(Z){return M(Z.message)}}async function l10(Y,X,J,z){let Q=await P1.readdir(Y);for(let G of Q){let Z=x4.join(Y,G);if(!(await P1.stat(Z)).isDirectory())continue;let H=await P1.readdir(Z);for(let W of H){let K=x4.join(Z,W),U=x4.join(K,".metadata.json");try{let B=JSON.parse(await P1.readFile(U,"utf-8"));if(B.sys_id===X)return await TC(K,B,J,z)}catch{}}}return null}async function i10(Y,X,J){let z=[],Q=await P1.readdir(Y);for(let G of Q){let Z=x4.join(Y,G);if(!(await P1.stat(Z)).isDirectory())continue;let H=await P1.readdir(Z);for(let W of H){let K=x4.join(Z,W),U=x4.join(K,".metadata.json");try{let B=JSON.parse(await P1.readFile(U,"utf-8")),O=await TC(K,B,X,J);z.push(O)}catch{}}}return z}async function TC(Y,X,J,z){let Q={sys_id:X.sys_id,table:X.table,name:X.name,synced_at:X.synced_at,local_path:Y},Z=(await P1.readdir(Y)).filter((B)=>!B.startsWith("."));Q.file_count=Z.length,Q.files=Z;let $=new Date(X.synced_at).getTime(),H=Date.now(),W=Math.round((H-$)/3600000);Q.hours_since_sync=W;let K=!1,U=[];for(let B of Z){let O=x4.join(Y,B),V=await P1.stat(O);if(V.mtimeMs>$)K=!0;if(J)U.push({name:B,size:V.size,modified:V.mtime.toISOString(),modified_since_sync:V.mtimeMs>$})}if(Q.has_local_changes=K,J)Q.file_details=U;if(z&&X.table==="sp_widget")Q.coherence=await n10(Y,Z);return Q}async function n10(Y,X){let J={valid:!0,issues:[]};try{let Q=["template.html","script.js"].filter((G)=>!X.includes(G));if(Q.length>0)J.valid=!1,J.issues.push({type:"missing_files",files:Q});if(X.includes("template.html")){let G=await P1.readFile(x4.join(Y,"template.html"),"utf-8"),Z=G.match(/ng-click="(\w+)\(/g);if(Z){let H=Z.map((W)=>W.match(/ng-click="(\w+)\(/)?.[1]).filter(Boolean);J.required_client_methods=H}let $=G.match(/data\.(\w+)/g);if($){let H=$.map((K)=>K.match(/data\.(\w+)/)?.[1]).filter(Boolean),W=new Set(H);J.required_data_properties=Array.from(W)}}if(X.includes("client_script.js")){let Z=(await P1.readFile(x4.join(Y,"client_script.js"),"utf-8")).match(/c\.server\.get\(\{[^}]*action:\s*['"](\w+)['"]/g);if(Z){let $=Z.map((H)=>H.match(/action:\s*['"](\w+)['"]/)?.[1]).filter(Boolean);J.required_server_actions=$}}}catch(z){J.valid=!1,J.issues.push({type:"validation_error",message:String(z)})}return J}var bG={};G0(bG,{snow_uib_page_manage_exec:()=>vC,snow_uib_page_manage_def:()=>IC,snow_uib_discover_exec:()=>jC,snow_uib_discover_def:()=>DC,snow_uib_component_manage_exec:()=>EC,snow_uib_component_manage_def:()=>CC,snow_debug_widget_fetch_exec:()=>oC,snow_debug_widget_fetch_def:()=>nC,snow_create_workspace_exec:()=>iC,snow_create_workspace_def:()=>lC,snow_create_uib_page_registry_exec:()=>dC,snow_create_uib_page_registry_def:()=>cC,snow_create_uib_event_exec:()=>pC,snow_create_uib_event_def:()=>gC,snow_create_uib_data_broker_exec:()=>uC,snow_create_uib_data_broker_def:()=>mC,snow_create_uib_client_state_exec:()=>hC,snow_create_uib_client_state_def:()=>yC,snow_create_uib_client_script_exec:()=>fC,snow_create_uib_client_script_def:()=>RC,snow_configure_uib_data_broker_exec:()=>bC,snow_configure_uib_data_broker_def:()=>_C,snow_analyze_uib_page_performance_exec:()=>kC,snow_analyze_uib_page_performance_def:()=>SC});var IC={name:"snow_uib_page_manage",description:"Unified UIB page management (create, delete, add_element, remove_element)",category:"ui-builder",subcategory:"pages",use_cases:["ui-builder","pages","components"],complexity:"intermediate",frequency:"high",permission:"write",allowedRoles:["developer","admin"],inputSchema:{type:"object",properties:{action:{type:"string",description:"Page management action",enum:["create","delete","add_element","remove_element"]},name:{type:"string",description:"[create] Page name (internal identifier)"},title:{type:"string",description:"[create] Page title (display name)"},description:{type:"string",description:"[create] Page description"},route:{type:"string",description:'[create] URL route (e.g., "/my-page")'},roles:{type:"array",items:{type:"string"},description:"[create] Required roles to access page"},public:{type:"boolean",description:"[create] Make page publicly accessible"},page_id:{type:"string",description:"[delete/add_element/remove_element] Page sys_id"},force:{type:"boolean",description:"[delete/remove_element] Force operation ignoring dependencies"},delete_dependencies:{type:"boolean",description:"[delete] Delete associated dependencies"},component:{type:"string",description:"[add_element] Component name or sys_id"},container_id:{type:"string",description:"[add_element] Parent container element ID"},position:{type:"number",description:"[add_element] Element position in container"},properties:{type:"object",description:"[add_element] Component properties"},data_broker:{type:"string",description:"[add_element] Data broker sys_id"},responsive_config:{type:"object",description:"[add_element] Responsive layout config"},conditional_display:{type:"string",description:"[add_element] Condition script for visibility"},css_classes:{type:"array",items:{type:"string"},description:"[add_element] CSS classes to apply"},inline_styles:{type:"object",description:"[add_element] Inline styles config"},element_id:{type:"string",description:"[remove_element] Page element sys_id to remove"},check_dependencies:{type:"boolean",description:"[remove_element] Check for dependent elements"}},required:["action"]}};async function vC(Y,X){let{action:J}=Y;try{switch(J){case"create":return await o10(Y,X);case"delete":return await a10(Y,X);case"add_element":return await s10(Y,X);case"remove_element":return await r10(Y,X);default:return M(`Unknown action: ${J}`)}}catch(z){return M(z.message)}}async function o10(Y,X){let{name:J,title:z,description:Q="",route:G,roles:Z=[],public:$=!1}=Y;if(!J)return M("name required");if(!z)return M("title required");let H=await x(X),K=(await H.post("/api/now/table/sys_ux_page",{name:J,title:z,description:Q,type:"page"})).data.result.sys_id,U,B;if(G)U=(await H.post("/api/now/table/sys_ux_app_route",{page:K,route:G,roles:Array.isArray(Z)?Z.join(","):Z,public:$})).data.result.sys_id,B=`${X.instanceUrl}${G}`;return N({action:"create",page:{sys_id:K,name:J,title:z,url:`${X.instanceUrl}/now/experience/page/${K}`},route:G?{sys_id:U,route:G,url:B}:void 0})}async function a10(Y,X){let{page_id:J,force:z=!1,delete_dependencies:Q=!0}=Y;if(!J)return M("page_id required");let G=await x(X),Z={elements:[],data_brokers:[],client_scripts:[],routes:[]};if(Q){let $=await G.get("/api/now/table/sys_ux_page_element",{params:{sysparm_query:`page=${J}`}});Z.elements=$.data.result;let H=await G.get("/api/now/table/sys_ux_data_broker",{params:{sysparm_query:`page=${J}`}});Z.data_brokers=H.data.result;let W=await G.get("/api/now/table/sys_ux_client_script",{params:{sysparm_query:`page=${J}`}});Z.client_scripts=W.data.result;let K=await G.get("/api/now/table/sys_ux_app_route",{params:{sysparm_query:`page=${J}`}});Z.routes=K.data.result;for(let U of Z.elements)await G.delete(`/api/now/table/sys_ux_page_element/${U.sys_id}`);for(let U of Z.data_brokers)await G.delete(`/api/now/table/sys_ux_data_broker/${U.sys_id}`);for(let U of Z.client_scripts)await G.delete(`/api/now/table/sys_ux_client_script/${U.sys_id}`);for(let U of Z.routes)await G.delete(`/api/now/table/sys_ux_app_route/${U.sys_id}`)}return await G.delete(`/api/now/table/sys_ux_page/${J}`),N({action:"delete",deleted:!0,page_id:J,dependencies_deleted:{elements:Z.elements.length,data_brokers:Z.data_brokers.length,client_scripts:Z.client_scripts.length,routes:Z.routes.length}})}async function s10(Y,X){let{page_id:J,component:z,container_id:Q,position:G=0,properties:Z={},data_broker:$,responsive_config:H,conditional_display:W,css_classes:K=[],inline_styles:U={}}=Y;if(!J)return M("page_id required");if(!z)return M("component required");let B=await x(X),O={page:J,component:z,position:G};if(Q)O.container=Q;if(Object.keys(Z).length>0)O.properties=JSON.stringify(Z);if($)O.data_broker=$;if(H)O.responsive_config=JSON.stringify(H);if(W)O.conditional_display=W;if(Array.isArray(K)&&K.length>0)O.css_classes=K.join(",");if(Object.keys(U).length>0)O.inline_styles=JSON.stringify(U);let V=await B.post("/api/now/table/sys_ux_page_element",O);return N({action:"add_element",element:{sys_id:V.data.result.sys_id,page_id:J,component:z,position:G}})}async function r10(Y,X){let{page_id:J,element_id:z,force:Q=!1,check_dependencies:G=!0}=Y;if(!J)return M("page_id required");if(!z)return M("element_id required");let Z=await x(X);if(!(await Z.get(`/api/now/table/sys_ux_page/${J}`)).data.result)return M("UI Builder page not found");let H=await Z.get(`/api/now/table/sys_ux_page_element/${z}`);if(!H.data.result)return M("Page element not found");let W=H.data.result,K=[];if(G&&!Q){if(K=await t10(Z,z,J),K.length>0)return M(`Cannot remove element: ${K.length} dependent element(s) found. Use force=true to override.`)}await Z.delete(`/api/now/table/sys_ux_page_element/${z}`);try{await Z.post("/api/now/table/sys_audit",{tablename:"sys_ux_page_element",documentkey:z,fieldname:"deleted",oldvalue:"active",newvalue:"deleted",reason:`Element removed from page ${J}`})}catch(U){}return N({action:"remove_element",removed:!0,element_id:z,page_id:J,element_name:W.name,dependencies_checked:G,force_used:Q})}async function t10(Y,X,J){let z=[];try{((await Y.get("/api/now/table/sys_ux_page_element",{params:{sysparm_query:`page=${J}^parent_element=${X}`,sysparm_fields:"sys_id,name,component"}})).data.result||[]).forEach((K)=>{z.push({type:"child_element",sys_id:K.sys_id,name:K.name,component:K.component})}),((await Y.get("/api/now/table/sys_ux_data_broker",{params:{sysparm_query:`page=${J}^element=${X}`,sysparm_fields:"sys_id,name"}})).data.result||[]).forEach((K)=>{z.push({type:"data_broker",sys_id:K.sys_id,name:K.name})}),((await Y.get("/api/now/table/sys_ux_event",{params:{sysparm_query:`page=${J}^source_element=${X}`,sysparm_fields:"sys_id,name,event_type"}})).data.result||[]).forEach((K)=>{z.push({type:"event",sys_id:K.sys_id,name:K.name,event_type:K.event_type})})}catch(Q){}return z}var DC={name:"snow_uib_discover",description:"Unified UI Builder discovery (pages, components, routes, page_usage)",category:"ui-frameworks",subcategory:"ui-builder",use_cases:["ui-builder","discovery","components","pages"],complexity:"beginner",frequency:"high",permission:"read",allowedRoles:["developer","stakeholder","admin"],inputSchema:{type:"object",properties:{action:{type:"string",description:"Discovery action to perform",enum:["pages","components","routes","page_usage"]},search:{type:"string",description:"[pages/components] Search names and titles"},experience:{type:"string",description:"[pages] Filter by experience sys_id"},active_only:{type:"boolean",description:"[pages] Return only active pages",default:!0},include_routes:{type:"boolean",description:"[pages] Include route information",default:!0},category:{type:"string",description:"[components] Filter by category"},include_custom:{type:"boolean",description:"[components] Include custom components",default:!0},include_builtin:{type:"boolean",description:"[components] Include built-in components",default:!0},experience_sys_id:{type:"string",description:"[routes] Experience sys_id to get routes"},page_sys_id:{type:"string",description:"[page_usage] Page sys_id to analyze"},days_back:{type:"number",description:"[page_usage] Days of usage history",default:30}},required:["action"]}};async function jC(Y,X){let{action:J}=Y;try{switch(J){case"pages":return await e10(Y,X);case"components":return await Y40(Y,X);case"routes":return await X40(Y,X);case"page_usage":return await J40(Y,X);default:return M(`Unknown action: ${J}`)}}catch(z){return M(z.message)}}async function e10(Y,X){let{search:J,experience:z,active_only:Q=!0,include_routes:G=!0}=Y,Z=await x(X),$="",H=[];if(J)H.push("nameLIKE"+J+"^ORtitleLIKE"+J);if(z)H.push("experience="+z);if(Q)H.push("active=true");$=H.join("^");let K=(await Z.get("/api/now/table/sys_ux_page",{params:{sysparm_query:$,sysparm_limit:100}})).data.result;if(G&&K.length>0)for(let U of K){let B=await Z.get("/api/now/table/sys_ux_page_registry",{params:{sysparm_query:"page="+U.sys_id,sysparm_limit:10}});U.routes=B.data.result}return N({action:"pages",pages:K,count:K.length})}async function Y40(Y,X){let{category:J,search:z,include_custom:Q=!0,include_builtin:G=!0}=Y,Z=await x(X),$="",H=[];if(J)H.push("category="+J);if(z)H.push("nameLIKE"+z+"^ORlabelLIKE"+z);let W=[];if(Q)W.push("sys_scope!=global");if(G)W.push("sys_scope=global");if(W.length>0)H.push("("+W.join("^OR")+")");$=H.join("^");let K=await Z.get("/api/now/table/sys_ux_lib_component",{params:{sysparm_query:$||void 0,sysparm_limit:100}});return N({action:"components",components:K.data.result,count:K.data.result.length})}async function X40(Y,X){let{experience_sys_id:J}=Y;if(!J)return M("experience_sys_id is required for routes action");let Q=await(await x(X)).get("/api/now/table/sys_ux_page_registry",{params:{sysparm_query:"experience="+J,sysparm_limit:100,sysparm_orderby:"route"}});return N({action:"routes",routes:Q.data.result,count:Q.data.result.length})}async function J40(Y,X){let{page_sys_id:J,days_back:z=30}=Y;if(!J)return M("page_sys_id is required for page_usage action");let Q=await x(X),G=new Date,Z=new Date;Z.setDate(Z.getDate()-z);let $={page_sys_id:J,analyzed_period:{start:Z.toISOString(),end:G.toISOString(),days:z},note:"Usage analytics require specific analytics configuration in ServiceNow"};return N({action:"page_usage",usage:$})}var CC={name:"snow_uib_component_manage",description:"Unified UIB component management (create, clone)",category:"ui-frameworks",subcategory:"ui-builder",use_cases:["component-creation","component-cloning","ui-builder"],complexity:"advanced",frequency:"medium",permission:"write",allowedRoles:["developer","admin"],inputSchema:{type:"object",properties:{action:{type:"string",description:"Component management action",enum:["create","clone"]},name:{type:"string",description:"[create/clone] Component name (internal identifier)"},label:{type:"string",description:"[create/clone] Component label (display name)"},description:{type:"string",description:"[create/clone] Component description"},category:{type:"string",description:"[create/clone] Component category"},source_code:{type:"string",description:"[create] Component JavaScript source code"},template:{type:"string",description:"[create] Component HTML template"},styles:{type:"string",description:"[create] Component CSS styles"},properties:{type:"object",description:"[create] Component properties schema"},version:{type:"string",description:"[create/clone] Component version"},source_component_id:{type:"string",description:"[clone] Source component sys_id to clone"},new_name:{type:"string",description:"[clone] Name for cloned component"},new_label:{type:"string",description:"[clone] Label for cloned component"},modifications:{type:"object",description:"[clone] Specific modifications to apply"}},required:["action"]}};async function EC(Y,X){let{action:J}=Y;try{switch(J){case"create":return await z40(Y,X);case"clone":return await Q40(Y,X);default:return M(`Unknown action: ${J}`)}}catch(z){return M(z.message)}}async function z40(Y,X){let{name:J,label:z,description:Q="",category:G="custom",source_code:Z="",template:$="",styles:H="",properties:W={},version:K="1.0.0"}=Y;if(!J)return M("name required");if(!z)return M("label required");let U=await x(X),B={name:J,label:z,description:Q,category:G,version:K};if(Z)B.source_code=Z;if($)B.template=$;if(H)B.styles=H;if(Object.keys(W).length>0)B.properties=JSON.stringify(W);let O=await U.post("/api/now/table/sys_ux_lib_component",B);return N({action:"create",component:{sys_id:O.data.result.sys_id,name:J,label:z,category:G}})}async function Q40(Y,X){let{source_component_id:J,new_name:z,new_label:Q,modifications:G={},category:Z="custom",version:$="1.0.0",description:H=""}=Y;if(!J)return M("source_component_id required");if(!z)return M("new_name required");if(!Q)return M("new_label required");let W=await x(X),K=await W.get(`/api/now/table/sys_ux_lib_component/${J}`);if(!K.data.result)return M("Source component not found");let U=K.data.result,B={name:z,label:Q,category:Z,version:$,description:H||`Cloned from ${U.name}`,source_code:U.source_code,properties:U.properties,template:U.template};Object.keys(G).forEach((V)=>{if(G[V]!==void 0)B[V]=G[V]});let O=await W.post("/api/now/table/sys_ux_lib_component",B);return N({action:"clone",component:{sys_id:O.data.result.sys_id,name:z,label:Q,cloned_from:J}})}var SC={name:"snow_analyze_uib_page_performance",description:"Analyze UI Builder page performance and get optimization recommendations",category:"ui-builder",subcategory:"analytics",use_cases:["ui-builder","performance","optimization"],complexity:"advanced",frequency:"low",permission:"read",allowedRoles:["developer","stakeholder","admin"],inputSchema:{type:"object",properties:{page_id:{type:"string",description:"Page sys_id to analyze"},include_components:{type:"boolean",description:"Include component-level performance analysis",default:!0},include_data_broker_stats:{type:"boolean",description:"Include data broker performance metrics",default:!0},include_client_scripts:{type:"boolean",description:"Include client script performance",default:!0},time_period_days:{type:"number",description:"Analysis period in days",default:30},detailed_analysis:{type:"boolean",description:"Generate detailed performance report",default:!1}},required:["page_id"]}};async function kC(Y,X){let{page_id:J,include_components:z=!0,include_data_broker_stats:Q=!0,include_client_scripts:G=!0,time_period_days:Z=30,detailed_analysis:$=!1}=Y;try{let H=await x(X),K=(await H.get(`/api/now/table/sys_ux_page/${J}`)).data.result,U=[];if(z)U=(await H.get("/api/now/table/sys_ux_page_element",{params:{sysparm_query:`page=${J}`}})).data.result;let B=[];if(Q)B=(await H.get("/api/now/table/sys_ux_data_broker",{params:{sysparm_query:`page=${J}`}})).data.result;let O=[];if(G)O=(await H.get("/api/now/table/sys_ux_client_script",{params:{sysparm_query:`page=${J}`}})).data.result;let V={page:{sys_id:K.sys_id,name:K.name,title:K.title},metrics:{total_components:U.length,total_data_brokers:B.length,total_client_scripts:O.length,estimated_load_time_ms:U.length*50+B.length*100},recommendations:[]};if(U.length>20)V.recommendations.push("Consider reducing number of components (current: "+U.length+")");if(B.length>5)V.recommendations.push("Multiple data brokers detected - consider consolidation");if(O.length>3)V.recommendations.push("Consider consolidating client scripts for better performance");if($)V.detailed={components:U.map((L)=>({sys_id:L.sys_id,component:L.component,position:L.position})),data_brokers:B.map((L)=>({sys_id:L.sys_id,name:L.name})),client_scripts:O.map((L)=>({sys_id:L.sys_id,name:L.name}))};return N(V)}catch(H){return M(H.message)}}var _C={name:"snow_configure_uib_data_broker",description:"Update data broker configuration including queries, caching, and refresh settings",category:"ui-builder",subcategory:"data-integration",use_cases:["ui-builder","data","configuration"],complexity:"intermediate",frequency:"medium",permission:"write",allowedRoles:["developer","admin"],inputSchema:{type:"object",properties:{data_broker_id:{type:"string",description:"Data broker sys_id to configure"},query:{type:"string",description:"Query string for data retrieval"},refresh_interval:{type:"number",description:"Refresh interval in seconds"},enable_caching:{type:"boolean",description:"Enable data caching"},cache_duration:{type:"number",description:"Cache duration in seconds"},parameters:{type:"object",description:"Data broker parameters"},filters:{type:"array",items:{type:"object"},description:"Data filters"}},required:["data_broker_id"]}};async function bC(Y,X){let{data_broker_id:J,query:z,refresh_interval:Q,enable_caching:G,cache_duration:Z,parameters:$,filters:H}=Y;try{let W=await x(X),K={};if(z!==void 0)K.query=z;if(Q!==void 0)K.refresh_interval=Q;if(G!==void 0)K.enable_caching=G;if(Z!==void 0)K.cache_duration=Z;if($!==void 0)K.parameters=JSON.stringify($);if(H!==void 0)K.filters=JSON.stringify(H);let U=await W.patch(`/api/now/table/sys_ux_data_broker/${J}`,K);return N({data_broker:{sys_id:U.data.result.sys_id,configured:!0}})}catch(W){return M(W.message)}}var RC={name:"snow_create_uib_client_script",description:"Create client-side JavaScript for UI Builder pages",category:"ui-builder",subcategory:"scripting",use_cases:["ui-builder","scripts","client-side"],complexity:"intermediate",frequency:"medium",permission:"write",allowedRoles:["developer","admin"],inputSchema:{type:"object",properties:{page_id:{type:"string",description:"Target page sys_id"},name:{type:"string",description:"Client script name"},script:{type:"string",description:"JavaScript code to execute"},event:{type:"string",description:'Event trigger (e.g., "onLoad", "onChange")',default:"onLoad"},order:{type:"number",description:"Execution order",default:100},active:{type:"boolean",description:"Active state",default:!0}},required:["page_id","name","script"]}};async function fC(Y,X){let{page_id:J,name:z,script:Q,event:G="onLoad",order:Z=100,active:$=!0}=Y;try{let W=await(await x(X)).post("/api/now/table/sys_ux_client_script",{page:J,name:z,script:Q,event:G,order:Z,active:$});return N({client_script:{sys_id:W.data.result.sys_id,name:z,event:G,page_id:J}})}catch(H){return M(H.message)}}var yC={name:"snow_create_uib_client_state",description:"Create client state management for UI Builder pages",category:"ui-builder",subcategory:"state-management",use_cases:["ui-builder","state","persistence"],complexity:"intermediate",frequency:"medium",permission:"write",allowedRoles:["developer","admin"],inputSchema:{type:"object",properties:{page_id:{type:"string",description:"Target page sys_id"},name:{type:"string",description:"State variable name"},initial_value:{type:"string",description:"Initial state value (JSON string)"},persistent:{type:"boolean",description:"Persist state across sessions",default:!1},scope:{type:"string",description:"State scope (page, session, global)",default:"page"}},required:["page_id","name"]}};async function hC(Y,X){let{page_id:J,name:z,initial_value:Q="{}",persistent:G=!1,scope:Z="page"}=Y;try{let H=await(await x(X)).post("/api/now/table/sys_ux_client_state",{page:J,name:z,initial_value:Q,persistent:G,scope:Z});return N({client_state:{sys_id:H.data.result.sys_id,name:z,scope:Z,persistent:G,page_id:J}})}catch($){return M($.message)}}var mC={name:"snow_create_uib_data_broker",description:"Create data broker to connect UI Builder pages to ServiceNow data sources",category:"ui-builder",subcategory:"data-integration",use_cases:["ui-builder","data","integration"],complexity:"intermediate",frequency:"high",permission:"write",allowedRoles:["developer","admin"],inputSchema:{type:"object",properties:{page_id:{type:"string",description:"Target page sys_id"},name:{type:"string",description:"Data broker name"},table:{type:"string",description:"ServiceNow table to query"},query:{type:"string",description:"Query string for data retrieval"},fields:{type:"array",items:{type:"string"},description:"Fields to retrieve",default:[]},order_by:{type:"string",description:"Order by field"},limit:{type:"number",description:"Maximum records to retrieve",default:100}},required:["page_id","name","table"]}};async function uC(Y,X){let{page_id:J,name:z,table:Q,query:G="",fields:Z=[],order_by:$,limit:H=100}=Y;try{let W=await x(X),K={page:J,name:z,table:Q,query:G,limit:H};if(Z.length>0)K.fields=Z.join(",");if($)K.order_by=$;let U=await W.post("/api/now/table/sys_ux_data_broker",K);return N({data_broker:{sys_id:U.data.result.sys_id,name:z,table:Q,page_id:J}})}catch(W){return M(W.message)}}var gC={name:"snow_create_uib_event",description:"Create custom events for UI Builder component communication",category:"ui-builder",subcategory:"events",use_cases:["ui-builder","events","components"],complexity:"intermediate",frequency:"medium",permission:"write",allowedRoles:["developer","admin"],inputSchema:{type:"object",properties:{page_id:{type:"string",description:"Target page sys_id"},name:{type:"string",description:"Event name"},description:{type:"string",description:"Event description"},payload_schema:{type:"object",description:"Event payload schema"},bubbles:{type:"boolean",description:"Event bubbles up the DOM",default:!0}},required:["page_id","name"]}};async function pC(Y,X){let{page_id:J,name:z,description:Q="",payload_schema:G={},bubbles:Z=!0}=Y;try{let $=await x(X),H={page:J,name:z,description:Q,bubbles:Z};if(Object.keys(G).length>0)H.payload_schema=JSON.stringify(G);let W=await $.post("/api/now/table/sys_ux_event",H);return N({event:{sys_id:W.data.result.sys_id,name:z,page_id:J}})}catch($){return M($.message)}}var cC={name:"snow_create_uib_page_registry",description:"Configure URL routing and access control for UI Builder pages",category:"ui-builder",subcategory:"routing",use_cases:["ui-builder","routing","access-control"],complexity:"intermediate",frequency:"high",permission:"write",allowedRoles:["developer","admin"],inputSchema:{type:"object",properties:{page_id:{type:"string",description:"Target page sys_id"},route:{type:"string",description:'URL route (e.g., "/my-page")'},roles:{type:"array",items:{type:"string"},description:"Required roles to access page",default:[]},public:{type:"boolean",description:"Make page publicly accessible",default:!1},active:{type:"boolean",description:"Active state",default:!0}},required:["page_id","route"]}};async function dC(Y,X){let{page_id:J,route:z,roles:Q=[],public:G=!1,active:Z=!0}=Y;try{let H=await(await x(X)).post("/api/now/table/sys_ux_app_route",{page:J,route:z,roles:Q.join(","),public:G,active:Z});return N({registry:{sys_id:H.data.result.sys_id,route:z,page_id:J,url:`${X.instanceUrl}${z}`}})}catch($){return M($.message)}}var lC={name:"snow_create_workspace",description:"Create complete Agent Workspace with experience, config, routes, and lists",category:"workspace",subcategory:"creation",use_cases:["workspace","agent-workspace","creation"],complexity:"advanced",frequency:"low",permission:"write",allowedRoles:["developer","admin"],inputSchema:{type:"object",properties:{name:{type:"string",description:'Workspace name (e.g., "IT Support Workspace")'},description:{type:"string",description:"Workspace description"},tables:{type:"array",items:{type:"string"},description:'Tables to include in workspace (e.g., ["incident", "task"])',default:[]},roles:{type:"array",items:{type:"string"},description:"Required roles to access workspace",default:[]}},required:["name"]}};async function iC(Y,X){let{name:J,description:z="",tables:Q=[],roles:G=[]}=Y;try{let Z=await x(X),$={},H=await Z.post("/api/now/table/sys_ux_experience",{name:J,description:z,type:"workspace"});$.experience=H.data.result;let W=await Z.post("/api/now/table/sys_ux_app_config",{name:`${J} Config`,experience:$.experience.sys_id});$.app_config=W.data.result;let K=await Z.post("/api/now/table/sys_ux_app_route",{experience:$.experience.sys_id,route:`/workspace/${J.toLowerCase().replace(/\s+/g,"-")}`,roles:G.join(",")});$.route=K.data.result,$.lists=[];for(let U of Q){let B=await Z.post("/api/now/table/sys_ux_list",{name:`${U} List`,table:U,experience:$.experience.sys_id});$.lists.push(B.data.result)}return N({workspace:{sys_id:$.experience.sys_id,name:J,url:`${X.instanceUrl}${$.route.route}`,tables_configured:Q.length},components:{experience_id:$.experience.sys_id,app_config_id:$.app_config.sys_id,route_id:$.route.sys_id,list_ids:$.lists.map((U)=>U.sys_id)}})}catch(Z){return M(Z.message)}}var nC={name:"snow_debug_widget_fetch",description:"Debug widget data fetching and server communication issues",category:"ui-builder",subcategory:"debugging",use_cases:["ui-builder","debugging","widgets"],complexity:"advanced",frequency:"low",permission:"read",allowedRoles:["developer","stakeholder","admin"],inputSchema:{type:"object",properties:{page_id:{type:"string",description:"Target page sys_id"},widget_name:{type:"string",description:"Widget name to debug"},trace_requests:{type:"boolean",description:"Trace HTTP requests",default:!0},log_level:{type:"string",description:"Log level (info, debug, warn, error)",default:"debug"}},required:["page_id"]}};async function oC(Y,X){let{page_id:J,widget_name:z,trace_requests:Q=!0,log_level:G="debug"}=Y;try{let Z=await x(X),H=(await Z.get("/api/now/table/sys_ux_page_element",{params:{sysparm_query:`page=${J}`}})).data.result,K=(await Z.get("/api/now/table/sys_ux_data_broker",{params:{sysparm_query:`page=${J}`}})).data.result,U={page_id:J,total_elements:H.length,total_brokers:K.length,elements:H.map((B)=>({sys_id:B.sys_id,component:B.component,data_broker:B.data_broker||"none"})),brokers:K.map((B)=>({sys_id:B.sys_id,name:B.name,table:B.table,query:B.query}))};if(z)U.elements=U.elements.filter((B)=>B.component.includes(z));return N(U)}catch(Z){return M(Z.message)}}var RG={};G0(RG,{snow_workflow_analyze_exec:()=>KE,snow_workflow_analyze_def:()=>WE,snow_test_rest_connection_exec:()=>QE,snow_test_rest_connection_def:()=>zE,snow_test_mid_connectivity_exec:()=>uE,snow_test_mid_connectivity_def:()=>mE,snow_test_integration_exec:()=>HE,snow_test_integration_def:()=>$E,snow_schedule_job_exec:()=>ZE,snow_schedule_job_def:()=>GE,snow_rest_message_manage_exec:()=>JE,snow_rest_message_manage_def:()=>XE,snow_manage_spoke_connection_exec:()=>fE,snow_manage_spoke_connection_def:()=>RE,snow_manage_oauth_tokens_exec:()=>EE,snow_manage_oauth_tokens_def:()=>CE,snow_manage_mid_capabilities_exec:()=>pE,snow_manage_mid_capabilities_def:()=>gE,snow_install_spoke_exec:()=>kE,snow_install_spoke_def:()=>SE,snow_generate_docs_exec:()=>BE,snow_generate_docs_def:()=>UE,snow_discover_integration_endpoints_exec:()=>AE,snow_discover_integration_endpoints_def:()=>PE,snow_discover_data_sources_exec:()=>FE,snow_discover_data_sources_def:()=>xE,snow_detect_code_patterns_exec:()=>tC,snow_detect_code_patterns_def:()=>rC,snow_create_web_service_exec:()=>qE,snow_create_web_service_def:()=>NE,snow_create_rest_message_exec:()=>YE,snow_create_rest_message_def:()=>eC,snow_create_oauth_profile_exec:()=>TE,snow_create_oauth_profile_def:()=>wE,snow_create_flow_action_exec:()=>bE,snow_create_flow_action_def:()=>_E,snow_create_field_map_exec:()=>LE,snow_create_field_map_def:()=>ME,snow_create_email_config_exec:()=>OE,snow_create_email_config_def:()=>VE,snow_create_credential_alias_exec:()=>jE,snow_create_credential_alias_def:()=>DE,snow_create_connection_alias_exec:()=>vE,snow_create_connection_alias_def:()=>IE,snow_configure_mid_server_exec:()=>hE,snow_configure_mid_server_def:()=>yE,snow_analyze_query_exec:()=>sC,snow_analyze_query_def:()=>aC});var aC={name:"snow_analyze_query",description:"Analyze and optimize ServiceNow queries for performance",category:"integration",subcategory:"optimization",use_cases:["integration","performance","optimization"],complexity:"advanced",frequency:"low",permission:"read",allowedRoles:["developer","stakeholder","admin"],inputSchema:{type:"object",properties:{table:{type:"string",description:"Table name to query"},query:{type:"string",description:"Encoded query string to analyze"},analyze_indexes:{type:"boolean",description:"Check for index usage and recommendations",default:!0},suggest_optimizations:{type:"boolean",description:"Provide query optimization suggestions",default:!0}},required:["table","query"]}};async function sC(Y,X){let{table:J,query:z,analyze_indexes:Q=!0,suggest_optimizations:G=!0}=Y;try{let $=await x(X),H={query:z,table:J,issues:[],suggestions:[],index_analysis:null,estimated_performance:"unknown"},W=z.split("^").filter((V)=>V.length>0);H.condition_count=W.length;let K=[];if(z.includes("LIKE"))K.push({type:"LIKE_QUERY",severity:"medium",description:"LIKE queries can be slow on large tables",suggestion:"Consider using indexed text search or exact matches where possible"});let U=(z.match(/\^OR/g)||[]).length;if(U>2)K.push({type:"EXCESSIVE_OR",severity:"high",description:`Query contains ${U} OR conditions, which may prevent index usage`,suggestion:"Consider breaking into multiple queries or restructuring conditions"});if(W.filter((V)=>V.includes("!=")||V.includes(">")||V.includes("<")).length>3)K.push({type:"MULTIPLE_INEQUALITIES",severity:"medium",description:"Multiple inequality conditions can be inefficient",suggestion:"Consider using equality conditions or range queries where possible"});let O=W.filter((V)=>V.includes("."));if(O.length>0)H.uses_dot_walking=!0,K.push({type:"DOT_WALKING",severity:"high",description:"Query uses dot-walking which requires table joins",suggestion:"Minimize dot-walking or ensure reference fields are indexed",affected_conditions:O});H.anti_patterns=K;var Z=0;try{let V=await $.get(`/api/now/table/${J}`,{params:{sysparm_query:z,sysparm_limit:1,sysparm_fields:"sys_id"},headers:{"X-Total-Count":"true"}});Z=parseInt(V.headers["x-total-count"]||"0")}catch(V){console.warn("Could not get record count:",V.message)}if(H.matching_records=Z,Q)try{let L=(await $.get("/api/now/table/sys_db_index",{params:{sysparm_query:`table=${J}^active=true`,sysparm_fields:"name,indexed_column,unique",sysparm_limit:100}})).data.result||[],q=L.map((w)=>w.indexed_column?.value||w.indexed_column),F=W.map((w)=>w.split(/[!=<>]/)[0]),P=F.filter((w)=>q.includes(w)),A=F.filter((w)=>!q.includes(w));if(H.index_analysis={total_indexes:L.length,indexed_query_fields:P,unindexed_query_fields:A,index_coverage:F.length>0?P.length/F.length:0},A.length>0)H.suggestions.push({type:"INDEX_RECOMMENDATION",priority:"high",description:`Consider adding indexes for: ${A.join(", ")}`,estimated_improvement:Z>1e4?"significant":"moderate"})}catch(V){H.index_analysis={error:"Index analysis not available",reason:V.message}}if(Z<1000&&K.length===0)H.estimated_performance="excellent";else if(Z<1e4&&K.length<=1)H.estimated_performance="good";else if(Z<1e5&&K.length<=2)H.estimated_performance="moderate";else H.estimated_performance="poor";if(G){if(H.estimated_performance==="poor")H.suggestions.push({type:"QUERY_RESTRUCTURE",priority:"critical",description:"Query may perform poorly on large datasets",actions:["Add appropriate indexes","Reduce number of OR conditions","Minimize dot-walking","Consider query caching"]});if(W.length>10)H.suggestions.push({type:"COMPLEXITY_REDUCTION",priority:"medium",description:"Query has many conditions which may be simplified",suggestion:"Review if all conditions are necessary"})}return N({analysis:H,performance_rating:H.estimated_performance,issues_found:K.length+(H.index_analysis?.unindexed_query_fields?.length||0),optimization_potential:H.suggestions.length>0,recommendations:H.suggestions})}catch($){return M($.message)}}var rC={name:"snow_detect_code_patterns",description:"Detect code patterns, anti-patterns, and best practices in ServiceNow scripts",category:"integration",subcategory:"code-analysis",use_cases:["integration","code-quality","analysis"],complexity:"advanced",frequency:"medium",permission:"read",allowedRoles:["developer","stakeholder","admin"],inputSchema:{type:"object",properties:{code:{type:"string",description:"JavaScript code to analyze"},check_es5:{type:"boolean",description:"Check for ES5 compliance",default:!0},check_performance:{type:"boolean",description:"Check for performance anti-patterns",default:!0},check_security:{type:"boolean",description:"Check for security issues",default:!0},check_best_practices:{type:"boolean",description:"Check ServiceNow best practices",default:!0}},required:["code"]}};async function tC(Y,X){let{code:J,check_es5:z=!0,check_performance:Q=!0,check_security:G=!0,check_best_practices:Z=!0}=Y;try{let $={es5_violations:[],performance_issues:[],security_issues:[],best_practice_violations:[],good_patterns:[]};if(z){let B=J.replace(/'[^'\\]*(?:\\.[^'\\]*)*'/g,'""').replace(/"[^"\\]*(?:\\.[^"\\]*)*"/g,'""').replace(/\/\/[^\n]*/g,"").replace(/\/\*[\s\S]*?\*\//g,"");[{regex:/\bconst\s+/g,type:"const",message:"Use var instead of const"},{regex:/\blet\s+/g,type:"let",message:"Use var instead of let"},{regex:/=>\s*{|=>\s*\(/g,type:"arrow_function",message:"Use function() {} instead of arrow functions"},{regex:/`[^`]*`/g,type:"template_literal",message:"Use string concatenation instead of template literals",checkOriginal:!0},{regex:/\.\.\.[\w\[]/g,type:"spread",message:"Spread operator not supported in ES5"},{regex:/class\s+\w+/g,type:"class",message:"Use function constructors instead of classes"}].forEach((V)=>{let q=(V.checkOriginal?J:B).match(V.regex);if(q)$.es5_violations.push({type:V.type,count:q.length,message:V.message,severity:"warning"})})}if(Q)[{regex:/while\s*\(\s*gr\.next\(\)/g,type:"unbounded_while_loop",message:"Use for loop with limit instead of unbounded while(gr.next())",severity:"high"},{regex:/new\s+GlideRecord\([^)]+\)[^}]*\{[^}]*new\s+GlideRecord/g,type:"nested_gliderecord",message:"Nested GlideRecord queries can cause performance issues",severity:"high"},{regex:/gr\.query\(\)[^}]*while[^}]*gr\.getValue/g,type:"getValue_in_loop",message:"Repeated getValue() calls in loop - cache values instead",severity:"medium"},{regex:/gs\.getUser\(\)\.getID\(\)/g,type:"repeated_getUser",message:"Cache gs.getUser() result instead of calling repeatedly",severity:"low"}].forEach((O)=>{if(O.regex.test(J))$.performance_issues.push({type:O.type,message:O.message,severity:O.severity})});if(G)[{regex:/eval\s*\(/g,type:"eval_usage",message:"eval() is a security risk - avoid using it",severity:"critical"},{regex:/gs\.executeNow\s*\(/g,type:"executeNow",message:"gs.executeNow() can bypass security - use with caution",severity:"high"},{regex:/setWorkflow\s*\(\s*false\s*\)/g,type:"workflow_bypass",message:"Disabling workflow can bypass business rules",severity:"medium"},{regex:/password|pwd|secret|api[_-]?key/gi,type:"hardcoded_credentials",message:"Possible hardcoded credentials - use system properties instead",severity:"critical"}].forEach((O)=>{if(O.regex.test(J))$.security_issues.push({type:O.type,message:O.message,severity:O.severity})});if(Z)[{regex:/gr\.query\(\)[^}]*if\s*\(\s*gr\.next/g,type:"missing_query_limit",message:"Add setLimit() before query() for better performance",severity:"medium"},{regex:/current\./g,type:"current_object",message:"Using current object - ensure it exists in context",severity:"info",isGood:!0},{regex:/try\s*\{[^}]*\}\s*catch/g,type:"error_handling",message:"Good: Error handling implemented",severity:"info",isGood:!0},{regex:/gs\.(info|warn|error|debug)\(/g,type:"logging",message:"Good: Logging statements present",severity:"info",isGood:!0}].forEach((O)=>{if(O.regex.test(J))if(O.isGood)$.good_patterns.push({type:O.type,message:O.message});else $.best_practice_violations.push({type:O.type,message:O.message,severity:O.severity})});let H=[...$.es5_violations.filter((B)=>B.severity==="error"),...$.security_issues.filter((B)=>B.severity==="critical")].length,W=[...$.performance_issues.filter((B)=>B.severity==="high"),...$.security_issues.filter((B)=>B.severity==="high")].length,K=$.es5_violations.length+$.performance_issues.length+$.security_issues.length+$.best_practice_violations.length,U="excellent";if(H>0)U="critical";else if(W>2)U="poor";else if(K>5)U="moderate";else if(K>0)U="good";return N({patterns:$,summary:{total_issues:K,critical_issues:H,high_priority_issues:W,good_patterns_found:$.good_patterns.length,code_quality:U},recommendations:G40($),es5_compliant:$.es5_violations.length===0})}catch($){return M($.message)}}function G40(Y){let X=[];if(Y.es5_violations.length>0)X.push("Convert all ES6+ syntax to ES5 for ServiceNow compatibility");if(Y.security_issues.some((J)=>J.severity==="critical"))X.push("Address critical security issues immediately");if(Y.performance_issues.length>0)X.push("Optimize performance by addressing identified anti-patterns");if(Y.best_practice_violations.length>3)X.push("Review ServiceNow best practices and update code accordingly");if(X.length===0)X.push("Code follows ServiceNow best practices");return X}var eC={name:"snow_create_rest_message",description:"Create REST message for external API integration",category:"integration",subcategory:"rest",use_cases:["integration","rest","api"],complexity:"intermediate",frequency:"medium",permission:"write",allowedRoles:["developer","admin"],inputSchema:{type:"object",properties:{name:{type:"string",description:"REST message name"},endpoint:{type:"string",description:"Base URL endpoint"},description:{type:"string",description:"REST message description"},authentication:{type:"string",enum:["none","basic","oauth2","api_key"],description:"Authentication type",default:"none"},use_mid_server:{type:"boolean",description:"Route through MID Server",default:!1},mid_server:{type:"string",description:"MID Server name if use_mid_server is true"},methods:{type:"array",description:"HTTP methods to create",items:{type:"object",properties:{name:{type:"string"},http_method:{type:"string",enum:["GET","POST","PUT","PATCH","DELETE"]},endpoint_path:{type:"string"},headers:{type:"object"}}}}},required:["name","endpoint"]}};async function YE(Y,X){let{name:J,endpoint:z,description:Q="",authentication:G="none",use_mid_server:Z=!1,mid_server:$,methods:H=[]}=Y;try{let W=await x(X),K,U=!1;try{let O={name:J,rest_endpoint:z,description:Q,use_mid_server:Z,authentication_type:G};if(Z&&$)O.mid_server=$;K=(await W.post("/api/now/table/sys_rest_message",O)).data.result}catch(O){if(O.response?.status===403){console.error("Table API failed with 403, falling back to background script..."),U=!0;let V=`
          var gr = new GlideRecord('sys_rest_message');
          gr.initialize();
          gr.name = ${JSON.stringify(J)};
          gr.rest_endpoint = ${JSON.stringify(z)};
          gr.description = ${JSON.stringify(Q)};
          gr.use_mid_server = ${Z};
          gr.authentication_type = ${JSON.stringify(G)};
          ${Z&&$?`gr.mid_server = ${JSON.stringify($)};`:""}
          var sysId = gr.insert();

          if (sysId) {
            var result = {};
            result.sys_id = sysId;
            result.name = gr.name.toString();
            result.endpoint = gr.rest_endpoint.toString();
            gs.print(JSON.stringify(result));
          } else {
            gs.error('Failed to create REST message');
          }
        `,F=((await W.post("/api/now/table/sys_script_execution",{script:V,description:`Create REST message: ${J}`})).data.result?.output||"").match(/\{[^}]+\}/);if(F)K=JSON.parse(F[0]);else throw Error("Failed to create REST message via background script")}else throw O}let B=[];for(let O of H)try{let V={rest_message:K.sys_id,name:O.name,http_method:O.http_method,endpoint:z+(O.endpoint_path||""),rest_endpoint:z+(O.endpoint_path||"")},q=(await W.post("/api/now/table/sys_rest_message_fn",V)).data.result;if(B.push(q),O.headers)for(let[F,P]of Object.entries(O.headers))await W.post("/api/now/table/sys_rest_message_headers",{rest_message_function:q.sys_id,name:F,value:P})}catch(V){if(V.response?.status===403){let L=`
            var gr = new GlideRecord('sys_rest_message_fn');
            gr.initialize();
            gr.rest_message = ${JSON.stringify(K.sys_id)};
            gr.name = ${JSON.stringify(O.name)};
            gr.http_method = ${JSON.stringify(O.http_method)};
            gr.rest_endpoint = ${JSON.stringify(z+(O.endpoint_path||""))};
            var sysId = gr.insert();

            var result = { sys_id: sysId, name: gr.name.toString(), http_method: gr.http_method.toString() };
            gs.print(JSON.stringify(result));
          `,P=((await W.post("/api/now/table/sys_script_execution",{script:L,description:`Create REST method: ${O.name}`})).data.result?.output||"").match(/\{[^}]+\}/);if(P)B.push(JSON.parse(P[0]))}else throw V}return N({created:!0,method:U?"background_script":"table_api",rest_message:{sys_id:K.sys_id,name:K.name,endpoint:K.endpoint,authentication:G},methods:B.map((O)=>({sys_id:O.sys_id,name:O.name,http_method:O.http_method,endpoint:O.endpoint||O.rest_endpoint})),total_methods:B.length})}catch(W){if(W.response?.status===403)return M("Permission denied (403): Your ServiceNow user lacks permissions to create REST messages. Required roles: 'rest_service' or 'admin'. Current attempt used both Table API and background script fallback. Please contact your ServiceNow administrator to grant the necessary permissions.");return M(W.message)}}var XE={name:"snow_rest_message_manage",description:`Universal REST Message management tool. CRUD operations for:
 REST Messages (list, get, create, update, delete)
 HTTP Methods (list_methods, get_method, create_method, update_method, delete_method)
 Message-level Headers - apply to ALL methods (list_message_headers, create_message_header, delete_message_header)
 Method-level Headers - apply to specific method (list_method_headers, create_method_header, delete_method_header)
 Query Parameters (list_parameters, create_parameter, delete_parameter)
 Testing (test) - generates ES5-compatible test script for snow_schedule_script_job`,category:"integration",subcategory:"rest",use_cases:["integration","rest","api","crud","headers","parameters","testing"],complexity:"intermediate",frequency:"high",permission:"write",allowedRoles:["developer","admin"],inputSchema:{type:"object",properties:{action:{type:"string",enum:["list","get","create","update","delete","list_methods","get_method","create_method","update_method","delete_method","list_message_headers","create_message_header","delete_message_header","list_method_headers","create_method_header","delete_method_header","list_parameters","create_parameter","delete_parameter","test"],description:"Action to perform"},filter:{type:"string",description:'Filter for list action (e.g., "nameLIKEopenai" or "active=true")'},limit:{type:"number",description:"Maximum results to return",default:50},sys_id:{type:"string",description:"sys_id of REST message or method"},name:{type:"string",description:"Name of REST message (alternative to sys_id for lookup)"},endpoint:{type:"string",description:"Base URL endpoint for REST message"},description:{type:"string",description:"Description of the REST message"},authentication_type:{type:"string",enum:["no_authentication","basic","oauth2","api_key","mutual_auth"],description:"Authentication type",default:"no_authentication"},basic_auth_profile:{type:"string",description:"Basic auth profile sys_id (if authentication_type is basic)"},oauth_profile:{type:"string",description:"OAuth profile sys_id (if authentication_type is oauth2)"},use_mid_server:{type:"boolean",description:"Route through MID Server",default:!1},mid_server:{type:"string",description:"MID Server name or sys_id"},rest_message_sys_id:{type:"string",description:"Parent REST message sys_id (for method operations)"},method_sys_id:{type:"string",description:"Method sys_id (for method update/delete)"},http_method:{type:"string",enum:["GET","POST","PUT","PATCH","DELETE","HEAD","OPTIONS"],description:"HTTP method type",default:"GET"},relative_path:{type:"string",description:'Relative endpoint path for method (e.g., "/v1/completions")'},request_body:{type:"string",description:"Request body template (for POST/PUT/PATCH)"},header_name:{type:"string",description:"Header name"},header_value:{type:"string",description:"Header value"},header_sys_id:{type:"string",description:"Header sys_id (for delete operations)"},headers:{type:"object",description:"Multiple headers as key-value pairs"},parameter_name:{type:"string",description:"Query parameter name"},parameter_value:{type:"string",description:"Query parameter value"},parameter_sys_id:{type:"string",description:"Parameter sys_id (for delete operations)"},parameters:{type:"object",description:"Multiple query parameters as key-value pairs"},test_params:{type:"object",description:"Parameters for testing the REST message"}},required:["action"]}};async function JE(Y,X){let{action:J}=Y;try{let z=await x(X);switch(J){case"list":return await Z40(z,Y);case"get":return await $40(z,Y);case"create":return await H40(z,Y);case"update":return await W40(z,Y);case"delete":return await K40(z,Y);case"list_methods":return await U40(z,Y);case"get_method":return await B40(z,Y);case"create_method":return await V40(z,Y);case"update_method":return await O40(z,Y);case"delete_method":return await M40(z,Y);case"list_message_headers":return await L40(z,Y);case"create_message_header":return await N40(z,Y);case"delete_message_header":return await q40(z,Y);case"list_method_headers":return await x40(z,Y);case"create_method_header":return await F40(z,Y);case"delete_method_header":return await P40(z,Y);case"list_parameters":return await A40(z,Y);case"create_parameter":return await w40(z,Y);case"delete_parameter":return await T40(z,Y);case"test":return await I40(z,Y);default:throw new I("VALIDATION_ERROR",`Unknown action: ${J}. See tool description for valid actions.`)}}catch(z){if(z.response?.status===403)return M("Permission denied (403): Your ServiceNow user lacks permissions for REST message operations. Required roles: 'rest_service' or 'admin'. Please contact your ServiceNow administrator to grant the necessary permissions.");return M(z instanceof I?z:new I("UNKNOWN_ERROR",z.message,{originalError:z}))}}async function Z40(Y,X){let{filter:J,limit:z=50}=X,Q={sysparm_fields:"sys_id,name,rest_endpoint,description,authentication_type,use_mid_server,active,sys_updated_on",sysparm_limit:z};if(J)Q.sysparm_query=J;let Z=(await Y.get("/api/now/table/sys_rest_message",{params:Q})).data?.result||[];return N({action:"list",count:Z.length,rest_messages:Z.map(($)=>({sys_id:$.sys_id,name:$.name,endpoint:$.rest_endpoint,description:$.description,authentication_type:$.authentication_type,use_mid_server:$.use_mid_server==="true",active:$.active==="true",updated:$.sys_updated_on}))},{operation:"list_rest_messages"})}async function $40(Y,X){let{sys_id:J,name:z}=X;if(!J&&!z)throw new I("VALIDATION_ERROR","Either sys_id or name is required for get action");let Q=J;if(!Q&&z){let W=await Y.get("/api/now/table/sys_rest_message",{params:{sysparm_query:`name=${z}`,sysparm_fields:"sys_id",sysparm_limit:1}});if(!W.data?.result?.[0])throw new I("NOT_FOUND",`REST message not found: ${z}`);Q=W.data.result[0].sys_id}let Z=(await Y.get(`/api/now/table/sys_rest_message/${Q}`)).data?.result;if(!Z)throw new I("NOT_FOUND",`REST message not found: ${Q}`);let H=(await Y.get("/api/now/table/sys_rest_message_fn",{params:{sysparm_query:`rest_message=${Q}`,sysparm_fields:"sys_id,name,http_method,rest_endpoint,content,active"}})).data?.result||[];return N({action:"get",rest_message:{sys_id:Z.sys_id,name:Z.name,endpoint:Z.rest_endpoint,description:Z.description,authentication_type:Z.authentication_type,basic_auth_profile:Z.basic_auth_profile,oauth_profile:Z.oauth2_profile,use_mid_server:Z.use_mid_server==="true",mid_server:Z.mid_server,active:Z.active==="true",created:Z.sys_created_on,updated:Z.sys_updated_on},methods:H.map((W)=>({sys_id:W.sys_id,name:W.name,http_method:W.http_method,endpoint:W.rest_endpoint,has_body:!!W.content,active:W.active==="true"})),method_count:H.length},{operation:"get_rest_message"})}async function H40(Y,X){let{name:J,endpoint:z,description:Q="",authentication_type:G="no_authentication",basic_auth_profile:Z,oauth_profile:$,use_mid_server:H=!1,mid_server:W}=X;if(!J||!z)throw new I("VALIDATION_ERROR","name and endpoint are required for create action");let K={name:J,rest_endpoint:z,description:Q,authentication_type:G,use_mid_server:H,active:!0};if(G==="basic"&&Z)K.basic_auth_profile=Z;if(G==="oauth2"&&$)K.oauth2_profile=$;if(H&&W)K.mid_server=W;let B=(await Y.post("/api/now/table/sys_rest_message",K)).data?.result;return N({action:"create",created:!0,rest_message:{sys_id:B.sys_id,name:B.name,endpoint:B.rest_endpoint,authentication_type:B.authentication_type},message:`REST message "${J}" created successfully`,next_steps:[`Create methods using: action="create_method", rest_message_sys_id="${B.sys_id}"`,'Add headers using: action="create_header", method_sys_id="<method_sys_id>"']},{operation:"create_rest_message"})}async function W40(Y,X){let{sys_id:J,name:z,endpoint:Q,description:G,authentication_type:Z,basic_auth_profile:$,oauth_profile:H,use_mid_server:W,mid_server:K}=X,U=J;if(!U&&z){let L=await Y.get("/api/now/table/sys_rest_message",{params:{sysparm_query:`name=${z}`,sysparm_fields:"sys_id",sysparm_limit:1}});if(!L.data?.result?.[0])throw new I("NOT_FOUND",`REST message not found: ${z}`);U=L.data.result[0].sys_id}if(!U)throw new I("VALIDATION_ERROR","sys_id or name is required for update action");let B={};if(Q!==void 0)B.rest_endpoint=Q;if(G!==void 0)B.description=G;if(Z!==void 0)B.authentication_type=Z;if($!==void 0)B.basic_auth_profile=$;if(H!==void 0)B.oauth2_profile=H;if(W!==void 0)B.use_mid_server=W;if(K!==void 0)B.mid_server=K;if(Object.keys(B).length===0)throw new I("VALIDATION_ERROR","No fields to update. Provide at least one field to change.");let V=(await Y.patch(`/api/now/table/sys_rest_message/${U}`,B)).data?.result;return N({action:"update",updated:!0,rest_message:{sys_id:V.sys_id,name:V.name,endpoint:V.rest_endpoint},fields_updated:Object.keys(B)},{operation:"update_rest_message"})}async function K40(Y,X){let{sys_id:J,name:z}=X,Q=J;if(!Q&&z){let $=await Y.get("/api/now/table/sys_rest_message",{params:{sysparm_query:`name=${z}`,sysparm_fields:"sys_id,name",sysparm_limit:1}});if(!$.data?.result?.[0])throw new I("NOT_FOUND",`REST message not found: ${z}`);Q=$.data.result[0].sys_id}if(!Q)throw new I("VALIDATION_ERROR","sys_id or name is required for delete action");let Z=(await Y.get("/api/now/table/sys_rest_message_fn",{params:{sysparm_query:`rest_message=${Q}`,sysparm_fields:"sys_id"}})).data?.result||[];for(let $ of Z)await Y.delete(`/api/now/table/sys_rest_message_fn/${$.sys_id}`);return await Y.delete(`/api/now/table/sys_rest_message/${Q}`),N({action:"delete",deleted:!0,sys_id:Q,methods_deleted:Z.length,message:`REST message and ${Z.length} associated methods deleted`},{operation:"delete_rest_message"})}async function U40(Y,X){let{rest_message_sys_id:J,name:z,limit:Q=50}=X,G=J;if(!G&&z){let H=await Y.get("/api/now/table/sys_rest_message",{params:{sysparm_query:`name=${z}`,sysparm_fields:"sys_id",sysparm_limit:1}});if(!H.data?.result?.[0])throw new I("NOT_FOUND",`REST message not found: ${z}`);G=H.data.result[0].sys_id}if(!G)throw new I("VALIDATION_ERROR","rest_message_sys_id or name is required for list_methods action");let $=(await Y.get("/api/now/table/sys_rest_message_fn",{params:{sysparm_query:`rest_message=${G}`,sysparm_fields:"sys_id,name,http_method,rest_endpoint,content,active",sysparm_limit:Q}})).data?.result||[];return N({action:"list_methods",rest_message_sys_id:G,count:$.length,methods:$.map((H)=>({sys_id:H.sys_id,name:H.name,http_method:H.http_method,endpoint:H.rest_endpoint,has_body:!!H.content,active:H.active==="true"}))},{operation:"list_methods"})}async function B40(Y,X){let{method_sys_id:J,sys_id:z}=X,Q=J||z;if(!Q)throw new I("VALIDATION_ERROR","method_sys_id is required for get_method action");let Z=(await Y.get(`/api/now/table/sys_rest_message_fn/${Q}`)).data?.result;if(!Z)throw new I("NOT_FOUND",`Method not found: ${Q}`);let H=(await Y.get("/api/now/table/sys_rest_message_fn_headers",{params:{sysparm_query:`rest_message_function=${Q}`,sysparm_fields:"sys_id,name,value"}})).data?.result||[],K=(await Y.get("/api/now/table/sys_rest_message_fn_parameters",{params:{sysparm_query:`rest_message_function=${Q}`,sysparm_fields:"sys_id,name,value"}})).data?.result||[];return N({action:"get_method",method:{sys_id:Z.sys_id,name:Z.name,http_method:Z.http_method,endpoint:Z.rest_endpoint,request_body:Z.content,active:Z.active==="true",rest_message:Z.rest_message},headers:H.map((U)=>({sys_id:U.sys_id,name:U.name,value:U.value})),parameters:K.map((U)=>({sys_id:U.sys_id,name:U.name,value:U.value}))},{operation:"get_method"})}async function V40(Y,X){let{rest_message_sys_id:J,name:z,http_method:Q="GET",relative_path:G="",request_body:Z,headers:$}=X;if(!J)throw new I("VALIDATION_ERROR","rest_message_sys_id is required for create_method action");if(!z)throw new I("VALIDATION_ERROR","name is required for create_method action");let W=(await Y.get(`/api/now/table/sys_rest_message/${J}`,{params:{sysparm_fields:"rest_endpoint"}})).data?.result?.rest_endpoint||"",K={rest_message:J,name:z,http_method:Q,rest_endpoint:W+G,active:!0};if(Z)K.content=Z;let B=(await Y.post("/api/now/table/sys_rest_message_fn",K)).data?.result,O=[];if($&&typeof $==="object")for(let[V,L]of Object.entries($)){let q=await Y.post("/api/now/table/sys_rest_message_fn_headers",{rest_message_function:B.sys_id,name:V,value:L});O.push({sys_id:q.data?.result?.sys_id,name:V,value:L})}return N({action:"create_method",created:!0,method:{sys_id:B.sys_id,name:B.name,http_method:B.http_method,endpoint:B.rest_endpoint},headers_created:O.length,headers:O},{operation:"create_method"})}async function O40(Y,X){let{method_sys_id:J,sys_id:z,name:Q,http_method:G,relative_path:Z,request_body:$}=X,H=J||z;if(!H)throw new I("VALIDATION_ERROR","method_sys_id is required for update_method action");let W={};if(Q!==void 0)W.name=Q;if(G!==void 0)W.http_method=G;if(Z!==void 0){let O=(await Y.get(`/api/now/table/sys_rest_message_fn/${H}`,{params:{sysparm_fields:"rest_message"}})).data?.result?.rest_message?.value;if(O){let L=(await Y.get(`/api/now/table/sys_rest_message/${O}`,{params:{sysparm_fields:"rest_endpoint"}})).data?.result?.rest_endpoint||"";W.rest_endpoint=L+Z}}if($!==void 0)W.content=$;if(Object.keys(W).length===0)throw new I("VALIDATION_ERROR","No fields to update");let U=(await Y.patch(`/api/now/table/sys_rest_message_fn/${H}`,W)).data?.result;return N({action:"update_method",updated:!0,method:{sys_id:U.sys_id,name:U.name,http_method:U.http_method,endpoint:U.rest_endpoint},fields_updated:Object.keys(W)},{operation:"update_method"})}async function M40(Y,X){let{method_sys_id:J,sys_id:z}=X,Q=J||z;if(!Q)throw new I("VALIDATION_ERROR","method_sys_id is required for delete_method action");let Z=(await Y.get("/api/now/table/sys_rest_message_fn_headers",{params:{sysparm_query:`rest_message_function=${Q}`,sysparm_fields:"sys_id"}})).data?.result||[];for(let $ of Z)await Y.delete(`/api/now/table/sys_rest_message_fn_headers/${$.sys_id}`);return await Y.delete(`/api/now/table/sys_rest_message_fn/${Q}`),N({action:"delete_method",deleted:!0,method_sys_id:Q,headers_deleted:Z.length},{operation:"delete_method"})}async function L40(Y,X){let{rest_message_sys_id:J,sys_id:z,name:Q}=X,G=J||z;if(!G&&Q){let H=await Y.get("/api/now/table/sys_rest_message",{params:{sysparm_query:`name=${Q}`,sysparm_fields:"sys_id",sysparm_limit:1}});if(!H.data?.result?.[0])throw new I("NOT_FOUND",`REST message not found: ${Q}`);G=H.data.result[0].sys_id}if(!G)throw new I("VALIDATION_ERROR","rest_message_sys_id, sys_id, or name is required for list_message_headers action");let $=(await Y.get("/api/now/table/sys_rest_message_headers",{params:{sysparm_query:`rest_message=${G}`,sysparm_fields:"sys_id,name,value"}})).data?.result||[];return N({action:"list_message_headers",rest_message_sys_id:G,count:$.length,headers:$.map((H)=>({sys_id:H.sys_id,name:H.name,value:H.value})),note:"These headers apply to ALL methods in this REST message"},{operation:"list_message_headers"})}async function N40(Y,X){let{rest_message_sys_id:J,sys_id:z,name:Q,header_name:G,header_value:Z,headers:$}=X,H=J||z;if(!H&&Q){let K=await Y.get("/api/now/table/sys_rest_message",{params:{sysparm_query:`name=${Q}`,sysparm_fields:"sys_id",sysparm_limit:1}});if(!K.data?.result?.[0])throw new I("NOT_FOUND",`REST message not found: ${Q}`);H=K.data.result[0].sys_id}if(!H)throw new I("VALIDATION_ERROR","rest_message_sys_id, sys_id, or name is required for create_message_header action");let W=[];if($&&typeof $==="object")for(let[K,U]of Object.entries($)){let B=await Y.post("/api/now/table/sys_rest_message_headers",{rest_message:H,name:K,value:U});W.push({sys_id:B.data?.result?.sys_id,name:K,value:U})}else if(G&&Z!==void 0){let K=await Y.post("/api/now/table/sys_rest_message_headers",{rest_message:H,name:G,value:Z});W.push({sys_id:K.data?.result?.sys_id,name:G,value:Z})}else throw new I("VALIDATION_ERROR","Either headers object or header_name+header_value is required");return N({action:"create_message_header",created:!0,rest_message_sys_id:H,headers:W,count:W.length,note:"These headers will apply to ALL methods in this REST message"},{operation:"create_message_header"})}async function q40(Y,X){let{header_sys_id:J,sys_id:z,header_name:Q,rest_message_sys_id:G,name:Z}=X,$=J||z;if($)return await Y.delete(`/api/now/table/sys_rest_message_headers/${$}`),N({action:"delete_message_header",deleted:!0,header_sys_id:$},{operation:"delete_message_header"});else if(Q&&(G||Z)){let H=G;if(!H&&Z){let U=await Y.get("/api/now/table/sys_rest_message",{params:{sysparm_query:`name=${Z}`,sysparm_fields:"sys_id",sysparm_limit:1}});if(!U.data?.result?.[0])throw new I("NOT_FOUND",`REST message not found: ${Z}`);H=U.data.result[0].sys_id}let W=await Y.get("/api/now/table/sys_rest_message_headers",{params:{sysparm_query:`rest_message=${H}^name=${Q}`,sysparm_fields:"sys_id",sysparm_limit:1}});if(!W.data?.result?.[0])throw new I("NOT_FOUND",`Message header not found: ${Q}`);let K=W.data.result[0].sys_id;return await Y.delete(`/api/now/table/sys_rest_message_headers/${K}`),N({action:"delete_message_header",deleted:!0,header_name:Q,header_sys_id:K},{operation:"delete_message_header"})}else throw new I("VALIDATION_ERROR","Either header_sys_id/sys_id OR (header_name + rest_message_sys_id/name) is required")}async function x40(Y,X){let{method_sys_id:J,sys_id:z}=X,Q=J||z;if(!Q)throw new I("VALIDATION_ERROR","method_sys_id is required for list_method_headers action");let Z=(await Y.get("/api/now/table/sys_rest_message_fn_headers",{params:{sysparm_query:`rest_message_function=${Q}`,sysparm_fields:"sys_id,name,value"}})).data?.result||[];return N({action:"list_method_headers",method_sys_id:Q,count:Z.length,headers:Z.map(($)=>({sys_id:$.sys_id,name:$.name,value:$.value})),note:"These headers apply only to this specific method"},{operation:"list_method_headers"})}async function F40(Y,X){let{method_sys_id:J,header_name:z,header_value:Q,headers:G}=X;if(!J)throw new I("VALIDATION_ERROR","method_sys_id is required for create_method_header action");let Z=[];if(G&&typeof G==="object")for(let[$,H]of Object.entries(G)){let W=await Y.post("/api/now/table/sys_rest_message_fn_headers",{rest_message_function:J,name:$,value:H});Z.push({sys_id:W.data?.result?.sys_id,name:$,value:H})}else if(z&&Q!==void 0){let $=await Y.post("/api/now/table/sys_rest_message_fn_headers",{rest_message_function:J,name:z,value:Q});Z.push({sys_id:$.data?.result?.sys_id,name:z,value:Q})}else throw new I("VALIDATION_ERROR","Either headers object or header_name+header_value is required");return N({action:"create_method_header",created:!0,method_sys_id:J,headers:Z,count:Z.length,note:"These headers apply only to this specific method"},{operation:"create_method_header"})}async function P40(Y,X){let{header_sys_id:J,sys_id:z,header_name:Q,method_sys_id:G}=X,Z=J||z;if(Z)return await Y.delete(`/api/now/table/sys_rest_message_fn_headers/${Z}`),N({action:"delete_method_header",deleted:!0,header_sys_id:Z},{operation:"delete_method_header"});else if(Q&&G){let $=await Y.get("/api/now/table/sys_rest_message_fn_headers",{params:{sysparm_query:`rest_message_function=${G}^name=${Q}`,sysparm_fields:"sys_id",sysparm_limit:1}});if(!$.data?.result?.[0])throw new I("NOT_FOUND",`Method header not found: ${Q}`);let H=$.data.result[0].sys_id;return await Y.delete(`/api/now/table/sys_rest_message_fn_headers/${H}`),N({action:"delete_method_header",deleted:!0,header_name:Q,header_sys_id:H},{operation:"delete_method_header"})}else throw new I("VALIDATION_ERROR","Either header_sys_id/sys_id OR (header_name + method_sys_id) is required")}async function A40(Y,X){let{method_sys_id:J,sys_id:z}=X,Q=J||z;if(!Q)throw new I("VALIDATION_ERROR","method_sys_id is required for list_parameters action");let Z=(await Y.get("/api/now/table/sys_rest_message_fn_parameters",{params:{sysparm_query:`rest_message_function=${Q}`,sysparm_fields:"sys_id,name,value"}})).data?.result||[];return N({action:"list_parameters",method_sys_id:Q,count:Z.length,parameters:Z.map(($)=>({sys_id:$.sys_id,name:$.name,value:$.value}))},{operation:"list_parameters"})}async function w40(Y,X){let{method_sys_id:J,parameter_name:z,parameter_value:Q,parameters:G}=X;if(!J)throw new I("VALIDATION_ERROR","method_sys_id is required for create_parameter action");let Z=[];if(G&&typeof G==="object")for(let[$,H]of Object.entries(G)){let W=await Y.post("/api/now/table/sys_rest_message_fn_parameters",{rest_message_function:J,name:$,value:H});Z.push({sys_id:W.data?.result?.sys_id,name:$,value:H})}else if(z&&Q!==void 0){let $=await Y.post("/api/now/table/sys_rest_message_fn_parameters",{rest_message_function:J,name:z,value:Q});Z.push({sys_id:$.data?.result?.sys_id,name:z,value:Q})}else throw new I("VALIDATION_ERROR","Either parameters object or parameter_name+parameter_value is required");return N({action:"create_parameter",created:!0,method_sys_id:J,parameters:Z,count:Z.length},{operation:"create_parameter"})}async function T40(Y,X){let{parameter_sys_id:J,sys_id:z,parameter_name:Q,method_sys_id:G}=X,Z=J||z;if(Z)return await Y.delete(`/api/now/table/sys_rest_message_fn_parameters/${Z}`),N({action:"delete_parameter",deleted:!0,parameter_sys_id:Z},{operation:"delete_parameter"});else if(Q&&G){let $=await Y.get("/api/now/table/sys_rest_message_fn_parameters",{params:{sysparm_query:`rest_message_function=${G}^name=${Q}`,sysparm_fields:"sys_id",sysparm_limit:1}});if(!$.data?.result?.[0])throw new I("NOT_FOUND",`Parameter not found: ${Q}`);let H=$.data.result[0].sys_id;return await Y.delete(`/api/now/table/sys_rest_message_fn_parameters/${H}`),N({action:"delete_parameter",deleted:!0,parameter_name:Q,parameter_sys_id:H},{operation:"delete_parameter"})}else throw new I("VALIDATION_ERROR","Either parameter_sys_id/sys_id OR (parameter_name + method_sys_id) is required")}async function I40(Y,X){let{method_sys_id:J,sys_id:z,name:Q,rest_message_sys_id:G,test_params:Z={}}=X,$=J||z;if($){let W=(await Y.get(`/api/now/table/sys_rest_message_fn/${$}`,{params:{sysparm_fields:"name,http_method,rest_endpoint,rest_message,content"}})).data?.result;if(!W)throw new I("NOT_FOUND",`Method not found: ${$}`);let K=W.rest_message?.value,B=(await Y.get(`/api/now/table/sys_rest_message/${K}`,{params:{sysparm_fields:"name,rest_endpoint,authentication_type"}})).data?.result,O=B?.name,L=(await Y.get("/api/now/table/sys_rest_message_fn_headers",{params:{sysparm_query:`rest_message_function=${$}`,sysparm_fields:"name,value"}})).data?.result||[],F=(await Y.get("/api/now/table/sys_rest_message_headers",{params:{sysparm_query:`rest_message=${K}`,sysparm_fields:"name,value"}})).data?.result||[],A=(await Y.get("/api/now/table/sys_rest_message_fn_parameters",{params:{sysparm_query:`rest_message_function=${$}`,sysparm_fields:"name,value"}})).data?.result||[],w=(D)=>{return D.replace(/\\/g,"\\\\").replace(/'/g,"\\'").replace(/\n/g,"\\n").replace(/\r/g,"\\r")},v=Object.entries(Z).map(([D,j])=>`rm.setStringParameterNoEscape('${w(D)}', '${w(String(j))}');`),T=`
// Test REST Message: ${O} - Method: ${W.name}
// Generated by snow_rest_message_manage test action
// ES5 COMPATIBLE - Safe for ServiceNow execution

(function() {
  var results = {
    success: false,
    status_code: null,
    response_body: null,
    response_headers: {},
    error: null,
    timing_ms: 0
  };

  try {
    var startTime = new Date().getTime();

    // Create REST message instance
    var rm = new sn_ws.RESTMessageV2('${O}', '${W.name}');

    // Set parameters from test_params
${v.length>0?"    "+v.join(`
    `):"    // No parameters specified"}

    // Execute the request
    var response = rm.execute();
    var endTime = new Date().getTime();

    // Collect results
    results.success = true;
    results.status_code = response.getStatusCode();
    results.response_body = response.getBody();
    results.timing_ms = endTime - startTime;

    // Try to get response headers
    try {
      var headerStr = response.getAllHeaders();
      if (headerStr) {
        results.response_headers = headerStr;
      }
    } catch(headerErr) {
      // Headers may not be available
    }

    // Log results
    gs.info('=== REST MESSAGE TEST RESULTS ===');
    gs.info('REST Message: ${O}');
    gs.info('Method: ${W.name}');
    gs.info('HTTP Method: ${W.http_method}');
    gs.info('Status Code: ' + results.status_code);
    gs.info('Response Time: ' + results.timing_ms + 'ms');
    gs.info('Response Body: ' + results.response_body);

  } catch(e) {
    results.success = false;
    results.error = e.message || String(e);
    gs.error('REST Message Test Failed: ' + results.error);
  }

  // Store results in sys_properties for retrieval
  var propName = 'snow_flow.rest_test.${$}';
  gs.setProperty(propName, JSON.stringify(results));
  gs.info('Results stored in property: ' + propName);

  return results;
})();
    `.trim();return N({action:"test",method:{sys_id:$,name:W.name,http_method:W.http_method,endpoint:W.rest_endpoint,has_body:!!W.content},rest_message:{sys_id:K,name:O,base_endpoint:B?.rest_endpoint,authentication_type:B?.authentication_type},configuration:{message_headers:F.map((D)=>({name:D.name,value:D.value})),method_headers:L.map((D)=>({name:D.name,value:D.value})),parameters:A.map((D)=>({name:D.name,value:D.value}))},test_params_provided:Z,test_script:T,usage:{description:"Use snow_schedule_script_job to execute this test script",example:`snow_schedule_script_job({ script: <test_script>, description: 'Test REST: ${O}' })`,manual_test:`In ServiceNow: System Web Services > Outbound > REST Message > ${O} > ${W.name} > Test`},note:"Direct REST message testing requires ServiceNow script execution. Copy the test_script and run it via snow_schedule_script_job."},{operation:"test_rest_message"})}if(Q||G){let H=G,W=Q;if(!H&&Q){let B=await Y.get("/api/now/table/sys_rest_message",{params:{sysparm_query:`name=${Q}`,sysparm_fields:"sys_id,name",sysparm_limit:1}});if(!B.data?.result?.[0])throw new I("NOT_FOUND",`REST message not found: ${Q}`);H=B.data.result[0].sys_id,W=B.data.result[0].name}else if(H&&!W)W=(await Y.get(`/api/now/table/sys_rest_message/${H}`,{params:{sysparm_fields:"name"}})).data?.result?.name;let U=(await Y.get("/api/now/table/sys_rest_message_fn",{params:{sysparm_query:`rest_message=${H}`,sysparm_fields:"sys_id,name,http_method,rest_endpoint"}})).data?.result||[];return N({action:"test",rest_message:{sys_id:H,name:W},available_methods:U.map((B)=>({sys_id:B.sys_id,name:B.name,http_method:B.http_method,endpoint:B.rest_endpoint})),note:"Specify method_sys_id to generate a test script for a specific method"},{operation:"test_rest_message"})}throw new I("VALIDATION_ERROR","method_sys_id, name, or rest_message_sys_id is required for test action")}var zE={name:"snow_test_rest_connection",description:"Test REST API connection with timeout and response validation",category:"integration",subcategory:"rest",use_cases:["integration","rest","testing"],complexity:"intermediate",frequency:"high",permission:"read",allowedRoles:["developer","stakeholder","admin"],inputSchema:{type:"object",properties:{rest_message_name:{type:"string",description:"Name of REST message to test"},method_name:{type:"string",description:"HTTP method name to test"},test_payload:{type:"object",description:"Test payload data (for POST/PUT/PATCH)"},timeout_seconds:{type:"number",description:"Request timeout in seconds",default:30,maximum:60},validate_ssl:{type:"boolean",description:"Validate SSL certificate",default:!0}},required:["rest_message_name","method_name"]}};async function QE(Y,X){let{rest_message_name:J,method_name:z,test_payload:Q={},timeout_seconds:G=30,validate_ssl:Z=!0}=Y;try{let $=await x(X),H=await $.get("/api/now/table/sys_rest_message",{params:{sysparm_query:`name=${J}`,sysparm_fields:"sys_id,name,endpoint",sysparm_limit:1}});if(!H.data.result||H.data.result.length===0)throw Error(`REST message '${J}' not found`);let W=H.data.result[0],K=await $.get("/api/now/table/sys_rest_message_fn",{params:{sysparm_query:`rest_message=${W.sys_id}^name=${z}`,sysparm_fields:"sys_id,name,http_method,endpoint",sysparm_limit:1}});if(!K.data.result||K.data.result.length===0)throw Error(`Method '${z}' not found in REST message '${J}'`);let U=K.data.result[0],B=`
      var sm = new sn_ws.RESTMessageV2('${J}', '${z}');
      sm.setRequestTimeout(${G*1000});
      ${!Z?'sm.setEccParameter("skip_sensor", "true");':""}
      ${Object.keys(Q).length>0?`sm.setRequestBody('${JSON.stringify(Q)}');`:""}

      var response = sm.execute();
      var statusCode = response.getStatusCode();
      var responseBody = response.getBody();
      var responseTime = response.getWaitTime();
      var headers = response.getHeaders();

      var result = {
        success: statusCode >= 200 && statusCode < 300,
        status_code: statusCode,
        response_body: responseBody,
        response_time_ms: responseTime,
        headers: headers,
        endpoint: '${U.endpoint}'
      };

      JSON.stringify(result);
    `,O=await $.post("/api/now/table/sys_script_execution",{script:B}),V=JSON.parse(O.data.result.output||"{}");return N({test_completed:!0,rest_message:J,method:z,connection:{success:V.success,status_code:V.status_code,endpoint:V.endpoint,response_time_ms:V.response_time_ms},response:{body:V.response_body,headers:V.headers},diagnostics:{timeout_used:G,ssl_validation:Z,http_method:U.http_method}})}catch($){return M($.message)}}var GE={name:"snow_schedule_job",description:"Create scheduled job with cron expression or repeat interval",category:"automation",subcategory:"scheduling",use_cases:["automation","scheduling","jobs"],complexity:"intermediate",frequency:"medium",permission:"write",allowedRoles:["developer","admin"],inputSchema:{type:"object",properties:{name:{type:"string",description:"Job name"},script:{type:"string",description:"Script to execute (ES5 only)"},description:{type:"string",description:"Job description"},schedule_type:{type:"string",enum:["daily","weekly","monthly","periodically","run_once","on_demand"],description:"Schedule type",default:"periodically"},repeat_interval:{type:"number",description:"Repeat interval in seconds (for periodically type)",default:3600},time:{type:"string",description:"Time to run (HH:MM:SS format for daily/weekly/monthly)"},day_of_week:{type:"string",description:"Day of week for weekly schedule (1=Monday, 7=Sunday)"},day_of_month:{type:"number",description:"Day of month for monthly schedule (1-31)",minimum:1,maximum:31},conditional_script:{type:"string",description:"Condition script that must return true to execute (ES5)"},active:{type:"boolean",description:"Activate the job immediately",default:!0}},required:["name","script"]}};async function ZE(Y,X){let{name:J,script:z,description:Q="",schedule_type:G="periodically",repeat_interval:Z=3600,time:$,day_of_week:H,day_of_month:W,conditional_script:K,active:U=!0}=Y;try{let B=await x(X),O={name:J,script:z,description:Q,active:U};switch(G){case"daily":O.run_type="daily",O.run_time=$||"00:00:00";break;case"weekly":O.run_type="weekly",O.run_time=$||"00:00:00",O.run_dayofweek=H||"1";break;case"monthly":O.run_type="monthly",O.run_time=$||"00:00:00",O.run_dayofmonth=W||1;break;case"periodically":O.run_type="periodically",O.repeat_interval=Z;break;case"run_once":O.run_type="run_once",O.run_start=new Date().toISOString();break;case"on_demand":O.run_type="on_demand";break}if(K)O.condition=K;let L=(await B.post("/api/now/table/sysauto_script",O)).data.result,q=null;if(G!=="on_demand"&&U)q=v40(G,{time:$,day_of_week:H,day_of_month:W,repeat_interval:Z});return N({created:!0,scheduled_job:{sys_id:L.sys_id,name:L.name,schedule_type:G,active:L.active==="true",next_run:q},schedule_details:{type:G,repeat_interval:G==="periodically"?Z:void 0,time:$,day_of_week:H,day_of_month:W}})}catch(B){return M(B.message)}}function v40(Y,X){let J=new Date,z=new Date;switch(Y){case"daily":let[Q,G]=(X.time||"00:00:00").split(":");if(z.setHours(parseInt(Q),parseInt(G),0,0),z<=J)z.setDate(z.getDate()+1);break;case"weekly":z.setDate(J.getDate()+1);break;case"monthly":if(z.setDate(X.day_of_month||1),z<=J)z.setMonth(z.getMonth()+1);break;case"periodically":z=new Date(J.getTime()+X.repeat_interval*1000);break;case"run_once":z=J;break}return{estimated_next_run:z.toISOString(),schedule_description:D40(Y,X)}}function D40(Y,X){switch(Y){case"daily":return`Runs daily at ${X.time||"00:00:00"}`;case"weekly":return`Runs weekly on day ${X.day_of_week||"1"} at ${X.time||"00:00:00"}`;case"monthly":return`Runs monthly on day ${X.day_of_month||"1"} at ${X.time||"00:00:00"}`;case"periodically":return`Runs every ${X.repeat_interval} seconds`;case"run_once":return"Runs once immediately";case"on_demand":return"Runs on demand only";default:return"Custom schedule"}}var $E={name:"snow_test_integration",description:"Test REST/SOAP integrations and external connections with validation",category:"integration",subcategory:"testing",use_cases:["integration","testing","validation"],complexity:"advanced",frequency:"medium",permission:"read",allowedRoles:["developer","stakeholder","admin"],inputSchema:{type:"object",properties:{integration_type:{type:"string",description:"Type of integration to test",enum:["rest","soap","data_source","email","ldap"],default:"rest"},integration_id:{type:"string",description:"Integration sys_id or name"},method:{type:"string",description:"HTTP method for REST (GET, POST, etc.)",default:"GET"},test_payload:{type:"object",description:"Test payload for POST/PUT requests"},validate_response:{type:"boolean",description:"Validate response format",default:!0},timeout:{type:"number",description:"Timeout in seconds",default:30}},required:["integration_id"]}};async function HE(Y,X){let{integration_type:J="rest",integration_id:z,method:Q="GET",test_payload:G,validate_response:Z=!0,timeout:$=30}=Y;try{let H=await x(X),W={integration_id:z,integration_type:J,tested_at:new Date().toISOString(),timeout:$};switch(J){case"rest":Object.assign(W,await j40(H,z,Q,G,Z,$));break;case"soap":Object.assign(W,await C40(H,z,Z,$));break;case"data_source":Object.assign(W,await E40(H,z,$));break;case"email":Object.assign(W,await S40(H,z,$));break;case"ldap":Object.assign(W,await k40(H,z,$));break;default:return M(`Unsupported integration type: ${J}`)}return N({test_result:W},{integration_id:z,integration_type:J})}catch(H){return M(H.message)}}async function j40(Y,X,J,z,Q,G){let Z={method:J,success:!1};try{let $=await Y.get("/api/now/table/sys_rest_message",{params:{sysparm_query:`sys_id=${X}^ORname=${X}`,sysparm_limit:1}});if(!$.data.result||$.data.result.length===0)return Z.error="REST message not found",Z;let H=$.data.result[0];Z.rest_message_name=H.name,Z.endpoint=H.rest_endpoint;let W=await Y.get("/api/now/table/sys_rest_message_fn",{params:{sysparm_query:`rest_message=${H.sys_id}^http_method=${J}`,sysparm_limit:1}});if(!W.data.result||W.data.result.length===0)return Z.error=`No ${J} method found for this REST message`,Z;let K=W.data.result[0];Z.method_name=K.name;let U=`
      var request = new sn_ws.RESTMessageV2('${H.name}', '${K.name}');
      ${z?`request.setRequestBody(JSON.stringify(${JSON.stringify(z)}));`:""}

      var startTime = new Date().getTime();
      var response = request.execute();
      var endTime = new Date().getTime();

      var result = {
        status_code: response.getStatusCode(),
        response_time_ms: endTime - startTime,
        response_body: response.getBody(),
        headers: response.getHeaders()
      };

      JSON.stringify(result);
    `,B=await Y.post("/api/now/table/sys_script_execution_history",{script:U,timeout:G*1000});try{let O=JSON.parse(B.data.result.output);if(Z.status_code=O.status_code,Z.response_time_ms=O.response_time_ms,Z.success=O.status_code>=200&&O.status_code<300,Q){if(Z.response_valid=_40(O.response_body),Z.response_valid)Z.response_sample=JSON.parse(O.response_body)}}catch(O){Z.error="Failed to parse test results",Z.success=!1}}catch($){Z.error=String($),Z.success=!1}return Z}async function C40(Y,X,J,z){let Q={success:!1};try{let G=await Y.get("/api/now/table/sys_web_service",{params:{sysparm_query:`sys_id=${X}^ORname=${X}`,sysparm_limit:1}});if(!G.data.result||G.data.result.length===0)return Q.error="SOAP web service not found",Q;let Z=G.data.result[0];Q.service_name=Z.name,Q.wsdl_url=Z.wsdl;let $=`
      var soap = new SOAPMessage('${Z.name}', 'test');
      var startTime = new Date().getTime();

      try {
        var response = soap.execute();
        var endTime = new Date().getTime();

        JSON.stringify({
          success: true,
          response_time_ms: endTime - startTime,
          status: 'connected'
        });
      } catch(e) {
        JSON.stringify({
          success: false,
          error: e.message
        });
      }
    `,H=await Y.post("/api/now/table/sys_script_execution_history",{script:$,timeout:z*1000});try{let W=JSON.parse(H.data.result.output);Object.assign(Q,W)}catch(W){Q.error="Failed to parse SOAP test results"}}catch(G){Q.error=String(G),Q.success=!1}return Q}async function E40(Y,X,J){let z={success:!1};try{let Q=await Y.get("/api/now/table/sys_data_source",{params:{sysparm_query:`sys_id=${X}^ORname=${X}`,sysparm_limit:1}});if(!Q.data.result||Q.data.result.length===0)return z.error="Data source not found",z;let G=Q.data.result[0];z.data_source_name=G.name,z.type=G.type;let Z=`
      var ds = new GlideDataSource('${G.sys_id}');
      var startTime = new Date().getTime();

      try {
        var testResult = ds.testConnection();
        var endTime = new Date().getTime();

        JSON.stringify({
          success: testResult,
          response_time_ms: endTime - startTime
        });
      } catch(e) {
        JSON.stringify({
          success: false,
          error: e.message
        });
      }
    `,$=await Y.post("/api/now/table/sys_script_execution_history",{script:Z,timeout:J*1000});try{let H=JSON.parse($.data.result.output);Object.assign(z,H)}catch(H){z.error="Failed to parse data source test results"}}catch(Q){z.error=String(Q),z.success=!1}return z}async function S40(Y,X,J){return{success:!1,error:"Email connection testing not yet implemented"}}async function k40(Y,X,J){return{success:!1,error:"LDAP connection testing not yet implemented"}}function _40(Y){try{return JSON.parse(Y),!0}catch{return!1}}var WE={name:"snow_workflow_analyze",description:"Analyze workflow executions for performance and errors",category:"integration",subcategory:"workflow",use_cases:["integration","workflow","analysis"],complexity:"advanced",frequency:"low",permission:"read",allowedRoles:["developer","stakeholder","admin"],inputSchema:{type:"object",properties:{workflow_name:{type:"string",description:"Workflow name or sys_id"},time_range_hours:{type:"number",description:"Analyze executions from last N hours",default:24},include_performance:{type:"boolean",description:"Include performance analysis",default:!0},include_errors:{type:"boolean",description:"Include error analysis",default:!0}},required:["workflow_name"]}};async function KE(Y,X){let{workflow_name:J,time_range_hours:z=24,include_performance:Q=!0,include_errors:G=!0}=Y;try{let Z=await x(X),$=J;if(J.length!==32){let V=await Z.get("/api/now/table/wf_workflow",{params:{sysparm_query:`name=${J}`,sysparm_fields:"sys_id,name",sysparm_limit:1}});if(V.data.result&&V.data.result.length>0)$=V.data.result[0].sys_id}let H=new Date(Date.now()-z*60*60*1000).toISOString(),K=(await Z.get("/api/now/table/wf_context",{params:{sysparm_query:`workflow=${$}^started>javascript:gs.dateGenerate('${H}')`,sysparm_fields:"sys_id,state,started,ended,duration",sysparm_limit:1000}})).data.result||[],U={workflow_name:J,workflow_sys_id:$,time_range_hours:z,total_executions:K.length},B={};if(K.forEach((V)=>{B[V.state]=(B[V.state]||0)+1}),U.state_distribution=B,U.success_rate=K.length>0?((B.finished||0)/K.length*100).toFixed(2)+"%":"0%",Q){let V=K.filter((L)=>L.duration).map((L)=>parseInt(L.duration));if(V.length>0){V.sort((F,P)=>F-P),U.performance={average_duration_ms:Math.round(V.reduce((F,P)=>F+P,0)/V.length),median_duration_ms:V[Math.floor(V.length/2)],min_duration_ms:V[0],max_duration_ms:V[V.length-1],p95_duration_ms:V[Math.floor(V.length*0.95)]};let L=U.performance.p95_duration_ms,q=K.filter((F)=>parseInt(F.duration)>L);U.performance.slow_executions_count=q.length}}if(G){let V=["error","cancelled","waiting"],L=K.filter((q)=>V.includes(q.state));if(U.error_analysis={total_errors:L.length,error_rate:K.length>0?(L.length/K.length*100).toFixed(2)+"%":"0%",error_types:V.map((q)=>({state:q,count:B[q]||0}))},L.length>0){let q=L.slice(0,5);U.error_analysis.sample_errors=q.map((F)=>({sys_id:F.sys_id,state:F.state,started:F.started}))}}let O=[];if(U.error_analysis&&parseFloat(U.error_analysis.error_rate)>10)O.push({priority:"high",type:"error_rate",message:`High error rate (${U.error_analysis.error_rate}) - review workflow logic and error handling`});if(U.performance?.p95_duration_ms>60000)O.push({priority:"medium",type:"performance",message:"Workflow executions are slow - consider optimization or parallelization"});if(K.length===0)O.push({priority:"info",type:"no_data",message:`No executions found in the last ${z} hours`});return U.recommendations=O,N({analysis:U,health_score:b40(U),action_required:O.some((V)=>V.priority==="high")})}catch(Z){return M(Z.message)}}function b40(Y){let X=100;if(Y.error_analysis){let J=parseFloat(Y.error_analysis.error_rate);X-=Math.min(J*2,40)}if(Y.performance?.p95_duration_ms>30000)X-=20;else if(Y.performance?.p95_duration_ms>1e4)X-=10;if(X>=90)return"excellent";if(X>=70)return"good";if(X>=50)return"moderate";return"poor"}var UE={name:"snow_generate_docs",description:"Generate documentation for ServiceNow artifacts",category:"integration",subcategory:"documentation",use_cases:["integration","documentation","analysis"],complexity:"intermediate",frequency:"low",permission:"read",allowedRoles:["developer","stakeholder","admin"],inputSchema:{type:"object",properties:{artifact_type:{type:"string",enum:["widget","script_include","business_rule","workflow","rest_message","transform_map"],description:"Type of artifact to document"},sys_id:{type:"string",description:"Artifact sys_id"},include_dependencies:{type:"boolean",description:"Include dependency analysis",default:!0},include_usage_examples:{type:"boolean",description:"Generate usage examples",default:!0},format:{type:"string",enum:["markdown","html","json"],description:"Documentation format",default:"markdown"}},required:["artifact_type","sys_id"]}};async function BE(Y,X){let{artifact_type:J,sys_id:z,include_dependencies:Q=!0,include_usage_examples:G=!0,format:Z="markdown"}=Y;try{let $=await x(X),W={widget:"sp_widget",script_include:"sys_script_include",business_rule:"sys_script",workflow:"wf_workflow",rest_message:"sys_rest_message",transform_map:"sys_transform_map"}[J];if(!W)throw Error(`Unsupported artifact type: ${J}`);let U=(await $.get(`/api/now/table/${W}/${z}`)).data.result;if(!U)throw Error(`Artifact not found: ${z}`);let B={title:U.name||U.title||"Unnamed Artifact",type:J,sys_id:z,description:U.description||"No description provided",metadata:{created:U.sys_created_on,created_by:U.sys_created_by,updated:U.sys_updated_on,updated_by:U.sys_updated_by}};switch(J){case"widget":B.details={id:U.id,has_server_script:!!U.script,has_client_script:!!U.client_script,has_template:!!U.template,has_css:!!U.css,data_table:U.data_table,option_schema:U.option_schema?JSON.parse(U.option_schema):null};break;case"script_include":B.details={api_name:U.api_name,client_callable:U.client_callable==="true",access:U.access,active:U.active==="true"};break;case"business_rule":B.details={table:U.collection,when:U.when,order:U.order,active:U.active==="true",condition:U.condition};break}if(Q){let V=[],L=U.script||U.client_script||"",q=L.match(/new\s+GlideRecord\s*\(\s*['"]([^'"]+)['"]\s*\)/g);if(q)q.forEach((P)=>{let A=P.match(/['"]([^'"]+)['"]/);if(A)V.push(`Table: ${A[1]}`)});let F=L.match(/new\s+([A-Z][a-zA-Z0-9_]*)\s*\(/g);if(F)F.forEach((P)=>{let A=P.match(/new\s+([A-Z][a-zA-Z0-9_]*)/);if(A)V.push(`Script Include: ${A[1]}`)});B.dependencies=[...new Set(V)]}if(G)B.usage_examples=R40(J,U);let O;switch(Z){case"markdown":O=f40(B);break;case"html":O=y40(B);break;case"json":O=JSON.stringify(B,null,2);break}return N({generated:!0,documentation:O,format:Z,artifact:{name:B.title,type:J,sys_id:z},dependencies_found:B.dependencies?.length||0,examples_generated:B.usage_examples?.length||0})}catch($){return M($.message)}}function R40(Y,X){let J=[];switch(Y){case"widget":if(J.push(`<!-- Add to Service Portal page -->
<widget id="${X.id}"></widget>`),X.option_schema)J.push(`<!-- With options -->
<widget id="${X.id}" options='{"key": "value"}'></widget>`);break;case"script_include":if(X.client_callable==="true")J.push(`// Client Script
var si = new GlideAjax('${X.api_name}');
si.addParam('sysparm_name', 'methodName');
si.getXMLAnswer(function(answer) {
  // Handle response
});`);J.push(`// Server Script
var helper = new ${X.api_name}();
var result = helper.someMethod();`);break;case"business_rule":J.push(`// Executes ${X.when} on table: ${X.collection}
// Automatically triggered by system`);break}return J}function f40(Y){let X=`# ${Y.title}

`;if(X+=`**Type:** ${Y.type}

`,X+=`**Description:** ${Y.description}

`,X+=`## Metadata
`,X+=`- Created: ${Y.metadata.created} by ${Y.metadata.created_by}
`,X+=`- Updated: ${Y.metadata.updated} by ${Y.metadata.updated_by}

`,Y.details)X+=`## Details
`,Object.entries(Y.details).forEach(([J,z])=>{X+=`- **${J}**: ${z}
`}),X+=`
`;if(Y.dependencies&&Y.dependencies.length>0)X+=`## Dependencies
`,Y.dependencies.forEach((J)=>X+=`- ${J}
`),X+=`
`;if(Y.usage_examples&&Y.usage_examples.length>0)X+=`## Usage Examples

`,Y.usage_examples.forEach((J,z)=>{X+=`### Example ${z+1}
\`\`\`javascript
${J}
\`\`\`

`});return X}function y40(Y){let X=`<html><head><title>${Y.title}</title></head><body>`;if(X+=`<h1>${Y.title}</h1>`,X+=`<p><strong>Type:</strong> ${Y.type}</p>`,X+=`<p><strong>Description:</strong> ${Y.description}</p>`,X+="<h2>Metadata</h2><ul>",X+=`<li>Created: ${Y.metadata.created} by ${Y.metadata.created_by}</li>`,X+=`<li>Updated: ${Y.metadata.updated} by ${Y.metadata.updated_by}</li>`,X+="</ul>",Y.dependencies&&Y.dependencies.length>0)X+="<h2>Dependencies</h2><ul>",Y.dependencies.forEach((J)=>X+=`<li>${J}</li>`),X+="</ul>";return X+="</body></html>",X}var VE={name:"snow_create_email_config",description:"Create email server configuration for SMTP, POP3, or IMAP",category:"integration",subcategory:"email",use_cases:["integration","email","configuration"],complexity:"intermediate",frequency:"low",permission:"write",allowedRoles:["developer","admin"],inputSchema:{type:"object",properties:{name:{type:"string",description:"Email configuration name"},serverType:{type:"string",enum:["SMTP","POP3","IMAP","SMTPS","POP3S","IMAPS"],description:"Email server type"},serverName:{type:"string",description:"Email server hostname or IP"},port:{type:"number",description:"Server port (default: auto-detect by type)"},encryption:{type:"string",enum:["SSL","TLS","None"],description:"Encryption type",default:"None"},username:{type:"string",description:"Authentication username"},password:{type:"string",description:"Authentication password"},description:{type:"string",description:"Configuration description"},active:{type:"boolean",description:"Active flag",default:!0}},required:["name","serverType","serverName"]}},h40={SMTP:587,SMTPS:465,POP3:110,POP3S:995,IMAP:143,IMAPS:993};async function OE(Y,X){let{name:J,serverType:z,serverName:Q,port:G,encryption:Z="None",username:$="",password:H="",description:W="",active:K=!0}=Y;try{let U=await x(X),B=G||h40[z]||25,O={name:J,type:z,server:Q,port:B,encryption:Z,user_name:$,password:H,description:W,active:K},L=(await U.post("/api/now/table/sys_email_account",O)).data.result;return N({created:!0,email_config:{sys_id:L.sys_id,name:L.name,type:z,server:Q,port:B,encryption:Z,active:K},message:`Email configuration '${J}' created successfully for ${z} on ${Q}:${B}`})}catch(U){return M(U.message)}}var ME={name:"snow_create_field_map",description:"Create field mapping within transform map for data transformation",category:"integration",subcategory:"data-transformation",use_cases:["integration","transformation","mapping"],complexity:"intermediate",frequency:"medium",permission:"write",allowedRoles:["developer","admin"],inputSchema:{type:"object",properties:{transformMapName:{type:"string",description:"Parent Transform Map name or sys_id"},sourceField:{type:"string",description:"Source field name"},targetField:{type:"string",description:"Target field name"},transform:{type:"string",description:"Transform script (JavaScript to transform value)"},coalesce:{type:"boolean",description:"Use as coalesce field for matching records",default:!1},defaultValue:{type:"string",description:"Default value if source is empty"},choice:{type:"boolean",description:"Use choice list for mapping",default:!1}},required:["transformMapName","sourceField","targetField"]}};async function LE(Y,X){let{transformMapName:J,sourceField:z,targetField:Q,transform:G="",coalesce:Z=!1,defaultValue:$="",choice:H=!1}=Y;try{let W=await x(X),K=J;if(!J.match(/^[a-f0-9]{32}$/)){let V=await W.get("/api/now/table/sys_transform_map",{params:{sysparm_query:`name=${J}`,sysparm_limit:1}});if(!V.data.result||V.data.result.length===0)throw Error(`Transform Map '${J}' not found`);K=V.data.result[0].sys_id}let U={map:K,source_field:z,target_field:Q,transform:G,coalesce:Z,default_value:$,choice:H},O=(await W.post("/api/now/table/sys_transform_entry",U)).data.result;return N({created:!0,field_map:{sys_id:O.sys_id,transform_map:K,source_field:z,target_field:Q,has_transform:!!G,coalesce:Z,has_default:!!$,choice:H},message:`Field mapping '${z}'  '${Q}' created successfully`})}catch(W){return M(W.message)}}var NE={name:"snow_create_web_service",description:"Create SOAP web service integration from WSDL definition",category:"integration",subcategory:"soap",use_cases:["integration","soap","web-service"],complexity:"intermediate",frequency:"low",permission:"write",allowedRoles:["developer","admin"],inputSchema:{type:"object",properties:{name:{type:"string",description:"Web Service name"},wsdlUrl:{type:"string",description:"WSDL URL or location"},description:{type:"string",description:"Web Service description"},authType:{type:"string",enum:["none","basic","wsse","oauth2"],description:"Authentication type",default:"none"},namespace:{type:"string",description:"Service namespace"},username:{type:"string",description:"Username for basic/WSSE authentication"},password:{type:"string",description:"Password for basic/WSSE authentication"},active:{type:"boolean",description:"Active flag",default:!0}},required:["name","wsdlUrl"]}};async function qE(Y,X){let{name:J,wsdlUrl:z,description:Q="",authType:G="none",namespace:Z="",username:$="",password:H="",active:W=!0}=Y;try{let K=await x(X),U={name:J,wsdl_url:z,description:Q,authentication_type:G,namespace:Z,active:W};if(G==="basic"||G==="wsse")U.user_name=$,U.password=H;let O=(await K.post("/api/now/table/sys_web_service",U)).data.result;return N({created:!0,web_service:{sys_id:O.sys_id,name:O.name,wsdl_url:z,authentication_type:G,namespace:Z,active:W},message:`SOAP Web Service '${J}' created successfully`,next_steps:["Import operations from WSDL","Configure authentication credentials","Test web service operations","Create service consumers"]})}catch(K){return M(K.message)}}var xE={name:"snow_discover_data_sources",description:"Discover available data sources for integration including import sets and REST endpoints",category:"integration",subcategory:"discovery",use_cases:["integration","discovery","data-sources"],complexity:"beginner",frequency:"medium",permission:"read",allowedRoles:["developer","stakeholder","admin"],inputSchema:{type:"object",properties:{sourceType:{type:"string",enum:["all","import_set","rest","jdbc","ldap","file"],description:"Filter by source type",default:"all"},limit:{type:"number",description:"Maximum number of results per type",default:50}}}};async function FE(Y,X){let{sourceType:J="all",limit:z=50}=Y;try{let Q=await x(X),G=[];if(J==="all"||J==="import_set"){let H=await Q.get("/api/now/table/sys_import_set_table_list",{params:{sysparm_limit:z}});if(H.data.result)G.push({type:"Import Sets",count:H.data.result.length,sources:H.data.result.map((W)=>({name:W.name,label:W.label,table:W.name,sys_id:W.sys_id}))})}if(J==="all"||J==="rest"){let H=await Q.get("/api/now/table/sys_rest_message",{params:{sysparm_limit:z}});if(H.data.result)G.push({type:"REST Messages",count:H.data.result.length,sources:H.data.result.map((W)=>({name:W.name,endpoint:W.endpoint,authentication:W.authentication_type,sys_id:W.sys_id}))})}if(J==="all"||J==="jdbc"){let H=await Q.get("/api/now/table/sys_data_source",{params:{sysparm_query:"type=jdbc",sysparm_limit:z}});if(H.data.result)G.push({type:"JDBC Data Sources",count:H.data.result.length,sources:H.data.result.map((W)=>({name:W.name,database:W.database_name,server:W.connection_url,sys_id:W.sys_id}))})}if(J==="all"||J==="ldap"){let H=await Q.get("/api/now/table/ldap_server_config",{params:{sysparm_limit:z}});if(H.data.result)G.push({type:"LDAP Servers",count:H.data.result.length,sources:H.data.result.map((W)=>({name:W.name,server:W.server,port:W.port,sys_id:W.sys_id}))})}let Z=await Q.get("/api/now/table/sys_transform_map",{params:{sysparm_limit:z}});if(Z.data.result)G.push({type:"Transform Maps",count:Z.data.result.length,sources:Z.data.result.map((H)=>({name:H.name,source_table:H.source_table,target_table:H.target_table,sys_id:H.sys_id}))});let $=G.reduce((H,W)=>H+W.count,0);return N({discovered:!0,data_sources:G,summary:{total_sources:$,types_found:G.length,filter_applied:J},message:`Discovered ${$} data sources across ${G.length} categories`})}catch(Q){return M(Q.message)}}var PE={name:"snow_discover_integration_endpoints",description:"Discover existing integration endpoints (REST, SOAP, LDAP, EMAIL)",category:"integration",subcategory:"discovery",use_cases:["integration","discovery","endpoints"],complexity:"beginner",frequency:"medium",permission:"read",allowedRoles:["developer","stakeholder","admin"],inputSchema:{type:"object",properties:{type:{type:"string",enum:["all","REST","SOAP","LDAP","EMAIL"],description:"Filter by endpoint type",default:"all"},limit:{type:"number",description:"Maximum results per type",default:50}}}};async function AE(Y,X){let{type:J="all",limit:z=50}=Y;try{let Q=await x(X),G=[];if(J==="all"||J==="REST"){let $=await Q.get("/api/now/table/sys_rest_message",{params:{sysparm_limit:z}});if($.data.result)G.push({type:"REST Messages",count:$.data.result.length,endpoints:$.data.result.map((H)=>({name:H.name,endpoint:H.endpoint,auth_type:H.authentication_type,use_mid_server:H.use_mid_server,sys_id:H.sys_id}))})}if(J==="all"||J==="SOAP"){let $=await Q.get("/api/now/table/sys_web_service",{params:{sysparm_limit:z}});if($.data.result)G.push({type:"Web Services (SOAP)",count:$.data.result.length,endpoints:$.data.result.map((H)=>({name:H.name,wsdl_url:H.wsdl_url,namespace:H.namespace,auth_type:H.authentication_type,sys_id:H.sys_id}))})}if(J==="all"||J==="LDAP"){let $=await Q.get("/api/now/table/ldap_server_config",{params:{sysparm_limit:z}});if($.data.result)G.push({type:"LDAP Servers",count:$.data.result.length,endpoints:$.data.result.map((H)=>({name:H.name,server:H.server,port:H.port,ssl_enabled:H.use_ssl,sys_id:H.sys_id}))})}if(J==="all"||J==="EMAIL"){let $=await Q.get("/api/now/table/sys_email_account",{params:{sysparm_limit:z}});if($.data.result)G.push({type:"Email Accounts",count:$.data.result.length,endpoints:$.data.result.map((H)=>({name:H.name,server:H.server,port:H.port,type:H.type,encryption:H.encryption,sys_id:H.sys_id}))})}let Z=G.reduce(($,H)=>$+H.count,0);return N({discovered:!0,integration_endpoints:G,summary:{total_endpoints:Z,types_found:G.length,filter_applied:J},message:`Discovered ${Z} integration endpoints across ${G.length} categories`})}catch(Q){return M(Q.message)}}var wE={name:"snow_create_oauth_profile",description:"Create OAuth 2.0 profile for external API authentication (Jira, Azure, Salesforce, etc.)",category:"integration",subcategory:"oauth",use_cases:["oauth","authentication","integration","external-api"],complexity:"intermediate",frequency:"medium",permission:"write",allowedRoles:["developer","admin"],inputSchema:{type:"object",properties:{name:{type:"string",description:'OAuth profile name (e.g., "Jira Cloud OAuth", "Azure AD")'},grant_type:{type:"string",enum:["authorization_code","client_credentials","password","refresh_token","jwt_bearer"],description:"OAuth grant type",default:"client_credentials"},client_id:{type:"string",description:"OAuth client ID"},client_secret:{type:"string",description:"OAuth client secret (stored securely)"},token_url:{type:"string",description:"Token endpoint URL (e.g., https://oauth.provider.com/token)"},authorization_url:{type:"string",description:"Authorization endpoint URL (for authorization_code grant)"},redirect_url:{type:"string",description:"Redirect URL after authorization"},scope:{type:"string",description:"OAuth scopes (space-separated)"},default_headers:{type:"object",description:"Default headers to include in token requests"},send_credentials:{type:"string",enum:["header","body"],description:"How to send client credentials",default:"header"},active:{type:"boolean",description:"Whether the profile is active",default:!0}},required:["name","client_id","token_url"]}};async function TE(Y,X){var J=Y.name,z=Y.grant_type||"client_credentials",Q=Y.client_id,G=Y.client_secret||"",Z=Y.token_url,$=Y.authorization_url||"",H=Y.redirect_url||"",W=Y.scope||"",K=Y.default_headers||{},U=Y.send_credentials||"header",B=Y.active!==!1;try{var O=await x(X),V={name:J,type:"oauth_provider",active:B},L,q=!1;try{L=await O.post("/api/now/table/oauth_entity",V)}catch(y){if(y.response?.status===403){q=!0;var F=`
          var gr = new GlideRecord('oauth_entity');
          gr.initialize();
          gr.name = ${JSON.stringify(J)};
          gr.type = 'oauth_provider';
          gr.active = ${B};
          var sysId = gr.insert();

          if (sysId) {
            gs.print(JSON.stringify({
              sys_id: sysId,
              name: gr.name.toString()
            }));
          } else {
            gs.error('Failed to create OAuth entity');
          }
        `,P=await O.post("/api/now/table/sys_script_execution",{script:F,description:"Create OAuth entity: "+J}),A=P.data.result?.output||"",w=A.match(/\{[^}]+\}/);if(w)L={data:{result:JSON.parse(w[0])}};else throw Error("Failed to create OAuth entity via background script")}else throw y}var v=L.data.result.sys_id,T={name:J+" Profile",oauth_entity:v,grant_type:z,client_id:Q,client_secret:G,token_url:Z,auth_url:$,redirect_url:H,default_grant_type:z,send_credentials:U};if(W)T.scope=W;var D;try{D=await O.post("/api/now/table/oauth_entity_profile",T)}catch(y){if(y.response?.status===403){q=!0;var j=`
          var gr = new GlideRecord('oauth_entity_profile');
          gr.initialize();
          gr.name = ${JSON.stringify(J+" Profile")};
          gr.oauth_entity = ${JSON.stringify(v)};
          gr.grant_type = ${JSON.stringify(z)};
          gr.client_id = ${JSON.stringify(Q)};
          gr.client_secret = ${JSON.stringify(G)};
          gr.token_url = ${JSON.stringify(Z)};
          gr.auth_url = ${JSON.stringify($)};
          gr.redirect_url = ${JSON.stringify(H)};
          gr.default_grant_type = ${JSON.stringify(z)};
          gr.send_credentials = ${JSON.stringify(U)};
          ${W?`gr.scope = ${JSON.stringify(W)};`:""}
          var sysId = gr.insert();

          if (sysId) {
            gs.print(JSON.stringify({
              sys_id: sysId,
              name: gr.name.toString(),
              grant_type: gr.grant_type.toString()
            }));
          }
        `,E=await O.post("/api/now/table/sys_script_execution",{script:j,description:"Create OAuth profile: "+J}),f=E.data.result?.output||"",i=f.match(/\{[^}]+\}/);if(i)D={data:{result:JSON.parse(i[0])}};else throw Error("Failed to create OAuth profile via background script")}else throw y}var o=D.data.result;return N({created:!0,method:q?"background_script":"table_api",oauth_entity:{sys_id:v,name:J},oauth_profile:{sys_id:o.sys_id,name:o.name,grant_type:z,token_url:Z,scope:W||"none specified"},next_steps:z==="authorization_code"?["Navigate to OAuth profile in ServiceNow",'Click "Get OAuth Token" to complete authorization flow']:["OAuth profile is ready to use","Reference this profile in your REST messages or integrations"]})}catch(y){if(y.response?.status===403)return M('Permission denied (403): Your ServiceNow user lacks permissions to create OAuth profiles. Required roles: "oauth_admin" or "admin". Please contact your ServiceNow administrator.');return M(y.message)}}var IE={name:"snow_create_connection_alias",description:"Create connection alias for IntegrationHub/Flow Designer to reference external credentials",category:"integration",subcategory:"credentials",use_cases:["integration-hub","flow-designer","credentials","connections"],complexity:"intermediate",frequency:"medium",permission:"write",allowedRoles:["developer","admin"],inputSchema:{type:"object",properties:{name:{type:"string",description:'Connection alias name (e.g., "Jira Production", "Azure DevOps")'},connection_type:{type:"string",enum:["http","jdbc","ldap","ssh","custom"],description:"Type of connection",default:"http"},configuration_template:{type:"string",description:"sys_id of the connection configuration template (e.g., for specific Spoke)"},credential_alias:{type:"string",description:"sys_id of credential alias to use (if already exists)"},active:{type:"boolean",description:"Whether the alias is active",default:!0},http_connection:{type:"object",description:"HTTP connection details (for http type)",properties:{base_url:{type:"string",description:"Base URL of the external system"},default_headers:{type:"object",description:"Default headers to send"},use_mutual_auth:{type:"boolean",description:"Enable mutual TLS authentication"},mid_server:{type:"string",description:"MID Server to use for connection"}}},retry_policy:{type:"object",description:"Retry policy for failed connections",properties:{max_retries:{type:"number",description:"Maximum number of retries",default:3},retry_interval_seconds:{type:"number",description:"Seconds between retries",default:5}}}},required:["name"]}};async function vE(Y,X){var J=Y.name,z=Y.connection_type||"http",Q=Y.configuration_template||"",G=Y.credential_alias||"",Z=Y.active!==!1,$=Y.http_connection||{},H=Y.retry_policy||{};try{var W=await x(X),K=!1,U={name:J,type:z,active:Z};if(Q)U.configuration_template=Q;if(G)U.credential=G;var B;try{B=await W.post("/api/now/table/sys_alias",U)}catch(E){if(E.response?.status===403){K=!0;var O=`
          var gr = new GlideRecord('sys_alias');
          gr.initialize();
          gr.name = ${JSON.stringify(J)};
          gr.type = ${JSON.stringify(z)};
          gr.active = ${Z};
          ${Q?`gr.configuration_template = ${JSON.stringify(Q)};`:""}
          ${G?`gr.credential = ${JSON.stringify(G)};`:""}
          var sysId = gr.insert();

          if (sysId) {
            gs.print(JSON.stringify({
              sys_id: sysId,
              name: gr.name.toString(),
              type: gr.type.toString()
            }));
          } else {
            gs.error('Failed to create connection alias');
          }
        `,V=await W.post("/api/now/table/sys_script_execution",{script:O,description:"Create connection alias: "+J}),L=V.data.result?.output||"",q=L.match(/\{[^}]+\}/);if(q)B={data:{result:JSON.parse(q[0])}};else throw Error("Failed to create connection alias via background script")}else throw E}var F=B.data.result,P=null;if(z==="http"&&$.base_url){var A={connection_alias:F.sys_id,connection_url:$.base_url,use_mutual_auth:$.use_mutual_auth||!1};if($.mid_server)A.mid_server=$.mid_server;try{var w=await W.post("/api/now/table/sys_connection",A);P=w.data.result}catch(E){if(E.response?.status===403){var v=`
            var gr = new GlideRecord('sys_connection');
            gr.initialize();
            gr.connection_alias = ${JSON.stringify(F.sys_id)};
            gr.connection_url = ${JSON.stringify($.base_url)};
            gr.use_mutual_auth = ${$.use_mutual_auth||!1};
            ${$.mid_server?`gr.mid_server = ${JSON.stringify($.mid_server)};`:""}
            var sysId = gr.insert();

            if (sysId) {
              gs.print(JSON.stringify({
                sys_id: sysId,
                connection_url: gr.connection_url.toString()
              }));
            }
          `,T=await W.post("/api/now/table/sys_script_execution",{script:v,description:"Create HTTP connection for alias: "+J}),D=T.data.result?.output||"",j=D.match(/\{[^}]+\}/);if(j)P=JSON.parse(j[0])}}}return N({created:!0,method:K?"background_script":"table_api",connection_alias:{sys_id:F.sys_id,name:F.name||J,type:z,active:Z},http_connection:P?{sys_id:P.sys_id,base_url:$.base_url}:null,usage_instructions:["Use this alias in Flow Designer actions","Reference in REST steps: alias="+J,"Configure credentials via snow_create_credential_alias if needed"]})}catch(E){if(E.response?.status===403)return M('Permission denied (403): Your ServiceNow user lacks permissions to create connection aliases. Required roles: "connection_admin" or "admin". Please contact your ServiceNow administrator.');return M(E.message)}}var DE={name:"snow_create_credential_alias",description:"Create credential alias for secure storage of API keys, passwords, and OAuth tokens",category:"integration",subcategory:"credentials",use_cases:["credentials","security","authentication","api-keys"],complexity:"intermediate",frequency:"medium",permission:"write",allowedRoles:["developer","admin"],inputSchema:{type:"object",properties:{name:{type:"string",description:'Credential alias name (e.g., "Jira API Credentials", "AWS Access Keys")'},type:{type:"string",enum:["basic","api_key","oauth2","ssh","certificate","custom"],description:"Type of credential",default:"basic"},basic_auth:{type:"object",description:"Basic authentication credentials",properties:{username:{type:"string",description:"Username"},password:{type:"string",description:"Password (stored encrypted)"}}},api_key:{type:"object",description:"API key credentials",properties:{key:{type:"string",description:"API key value (stored encrypted)"},header_name:{type:"string",description:'Header name for API key (e.g., "X-API-Key", "Authorization")',default:"X-API-Key"},prefix:{type:"string",description:'Prefix for the key value (e.g., "Bearer ", "Api-Key ")'}}},oauth2:{type:"object",description:"OAuth 2.0 credential reference",properties:{oauth_profile_id:{type:"string",description:"sys_id of the OAuth profile to use"}}},active:{type:"boolean",description:"Whether the credential is active",default:!0},tag:{type:"string",description:"Tag for organizing credentials"}},required:["name","type"]}};async function jE(Y,X){var J=Y.name,z=Y.type||"basic",Q=Y.basic_auth||{},G=Y.api_key||{},Z=Y.oauth2||{},$=Y.active!==!1,H=Y.tag||"";try{var W=await x(X),K=!1,U={name:J,type:z,active:$};if(H)U.tag=H;var B;try{B=await W.post("/api/now/table/sys_alias",U)}catch(r){if(r.response?.status===403){K=!0;var O=`
          var gr = new GlideRecord('sys_alias');
          gr.initialize();
          gr.name = ${JSON.stringify(J)};
          gr.type = 'credential';
          gr.active = ${$};
          ${H?`gr.tag = ${JSON.stringify(H)};`:""}
          var sysId = gr.insert();

          if (sysId) {
            gs.print(JSON.stringify({
              sys_id: sysId,
              name: gr.name.toString()
            }));
          } else {
            gs.error('Failed to create credential alias');
          }
        `,V=await W.post("/api/now/table/sys_script_execution",{script:O,description:"Create credential alias: "+J}),L=V.data.result?.output||"",q=L.match(/\{[^}]+\}/);if(q)B={data:{result:JSON.parse(q[0])}};else throw Error("Failed to create credential alias via background script")}else throw r}var F=B.data.result,P=null;if(z==="basic"&&Q.username){var A={name:J+" - Basic Auth",user_name:Q.username,password:Q.password||""};try{var w=await W.post("/api/now/table/basic_auth_credentials",A);P=w.data.result}catch(r){if(r.response?.status===403){var v=`
            var gr = new GlideRecord('basic_auth_credentials');
            gr.initialize();
            gr.name = ${JSON.stringify(J+" - Basic Auth")};
            gr.user_name = ${JSON.stringify(Q.username)};
            gr.password = ${JSON.stringify(Q.password||"")};
            var sysId = gr.insert();

            if (sysId) {
              gs.print(JSON.stringify({
                sys_id: sysId,
                name: gr.name.toString(),
                user_name: gr.user_name.toString()
              }));
            }
          `,T=await W.post("/api/now/table/sys_script_execution",{script:v,description:"Create basic auth credential: "+J}),D=T.data.result?.output||"",j=D.match(/\{[^}]+\}/);if(j)P=JSON.parse(j[0])}}}else if(z==="api_key"&&G.key){var E={name:J+" - API Key",api_key:G.key,api_key_header:G.header_name||"X-API-Key"};try{var f=await W.post("/api/now/table/api_key_credentials",E);P=f.data.result}catch(r){if(r.response?.status===403){var i=`
            var gr = new GlideRecord('api_key_credentials');
            gr.initialize();
            gr.name = ${JSON.stringify(J+" - API Key")};
            gr.api_key = ${JSON.stringify(G.key)};
            gr.api_key_header = ${JSON.stringify(G.header_name||"X-API-Key")};
            var sysId = gr.insert();

            if (sysId) {
              gs.print(JSON.stringify({
                sys_id: sysId,
                name: gr.name.toString(),
                header: gr.api_key_header.toString()
              }));
            }
          `,o=await W.post("/api/now/table/sys_script_execution",{script:i,description:"Create API key credential: "+J}),y=o.data.result?.output||"",a=y.match(/\{[^}]+\}/);if(a)P=JSON.parse(a[0])}}}if(P&&F.sys_id)try{await W.patch("/api/now/table/sys_alias/"+F.sys_id,{credential:P.sys_id})}catch(r){}return N({created:!0,method:K?"background_script":"table_api",credential_alias:{sys_id:F.sys_id,name:F.name||J,type:z,active:$},credential:P?{sys_id:P.sys_id,name:P.name,type:z}:null,security_note:"Credentials are stored encrypted in ServiceNow. Never expose credentials in logs or outputs.",usage:["Reference this alias in connection configurations","Use in Flow Designer REST actions","Reference in snow_create_connection_alias for full connection setup"]})}catch(r){if(r.response?.status===403)return M('Permission denied (403): Your ServiceNow user lacks permissions to create credentials. Required roles: "credentials_admin" or "admin". Please contact your ServiceNow administrator.');return M(r.message)}}var CE={name:"snow_manage_oauth_tokens",description:"Manage OAuth tokens: view status, refresh tokens, troubleshoot authentication issues",category:"integration",subcategory:"oauth",use_cases:["oauth","tokens","authentication","troubleshooting"],complexity:"intermediate",frequency:"medium",permission:"write",allowedRoles:["developer","admin"],inputSchema:{type:"object",properties:{action:{type:"string",enum:["list","status","refresh","revoke","test"],description:"Action to perform",default:"list"},oauth_profile_id:{type:"string",description:"sys_id of the OAuth profile (required for status/refresh/revoke/test)"},oauth_profile_name:{type:"string",description:"Name of the OAuth profile (alternative to sys_id)"},include_expired:{type:"boolean",description:"Include expired tokens in list",default:!1},limit:{type:"number",description:"Maximum number of tokens to return",default:50}},required:["action"]}};async function EE(Y,X){var J=Y.action||"list",z=Y.oauth_profile_id||"",Q=Y.oauth_profile_name||"",G=Y.include_expired||!1,Z=Y.limit||50;try{var $=await x(X);if(!z&&Q){var H=await $.get("/api/now/table/oauth_entity_profile",{params:{sysparm_query:"nameLIKE"+Q,sysparm_limit:1,sysparm_fields:"sys_id,name"}});if(H.data.result&&H.data.result.length>0)z=H.data.result[0].sys_id}if(J==="list"){var W=await $.get("/api/now/table/oauth_entity_profile",{params:{sysparm_limit:Z,sysparm_fields:"sys_id,name,grant_type,oauth_entity,client_id,token_url,active",sysparm_display_value:"all"}}),K=W.data.result||[],U=[];for(var B=0;B<K.length;B++){var O=K[B],V="oauth_entity_profile="+O.sys_id;if(!G)V+="^expires>javascript:gs.now()";var L=await $.get("/api/now/table/oauth_credential",{params:{sysparm_query:V,sysparm_limit:5,sysparm_fields:"sys_id,expires,token_type,scope,sys_created_on"}}),q=L.data.result||[];U.push({sys_id:O.sys_id,name:O.name&&O.name.display_value?O.name.display_value:O.name,grant_type:O.grant_type,client_id:O.client_id,active:O.active==="true"||O.active===!0,token_count:q.length,tokens:q.map(function(_){return{sys_id:_.sys_id,expires:_.expires,token_type:_.token_type,scope:_.scope,created:_.sys_created_on,is_expired:new Date(_.expires)<new Date}})})}return N({action:"list",profiles:U,total_profiles:U.length,summary:{with_active_tokens:U.filter(function(_){return _.tokens.some(function(c){return!c.is_expired})}).length,without_tokens:U.filter(function(_){return _.token_count===0}).length}})}else if(J==="status"){if(!z)return M("oauth_profile_id or oauth_profile_name is required for status action");var F=await $.get("/api/now/table/oauth_entity_profile/"+z,{params:{sysparm_display_value:"all"}}),P=F.data.result,A=await $.get("/api/now/table/oauth_credential",{params:{sysparm_query:"oauth_entity_profile="+z,sysparm_fields:"sys_id,expires,token_type,scope,sys_created_on,sys_updated_on",sysparm_limit:20}}),w=A.data.result||[],v=new Date,T={total:w.length,active:0,expired:0,expiring_soon:0};return w.forEach(function(_){var c=new Date(_.expires);if(c<v)T.expired++;else{T.active++;var d=new Date(v.getTime()+3600000);if(c<d)T.expiring_soon++}}),N({action:"status",profile:{sys_id:P.sys_id,name:P.name&&P.name.display_value?P.name.display_value:P.name,grant_type:P.grant_type,client_id:P.client_id,token_url:P.token_url,active:P.active==="true"||P.active===!0},token_statistics:T,tokens:w.map(function(_){var c=new Date(_.expires);return{sys_id:_.sys_id,expires:_.expires,expires_in_minutes:Math.round((c.getTime()-v.getTime())/60000),token_type:_.token_type,scope:_.scope,is_expired:c<v,is_expiring_soon:c<new Date(v.getTime()+3600000)}}),health:T.active>0?"healthy":T.expired>0?"needs_refresh":"no_tokens"})}else if(J==="refresh"){if(!z)return M("oauth_profile_id or oauth_profile_name is required for refresh action");var D=`
        var oauth = new sn_auth.GlideOAuthClient();
        var profile = new GlideRecord('oauth_entity_profile');
        if (profile.get(${JSON.stringify(z)})) {
          var tokenResponse = oauth.getToken(profile.sys_id.toString(), '');
          if (tokenResponse) {
            var token = tokenResponse.getToken();
            if (token) {
              gs.print(JSON.stringify({
                success: true,
                message: 'Token refreshed successfully',
                expires_in: tokenResponse.getExpiresIn()
              }));
            } else {
              gs.print(JSON.stringify({
                success: false,
                message: 'Failed to get token: ' + tokenResponse.getErrorMessage()
              }));
            }
          } else {
            gs.print(JSON.stringify({
              success: false,
              message: 'Token response is null'
            }));
          }
        } else {
          gs.print(JSON.stringify({
            success: false,
            message: 'OAuth profile not found'
          }));
        }
      `,j=await $.post("/api/now/table/sys_script_execution",{script:D,description:"Refresh OAuth token for profile: "+z}),E=j.data.result?.output||"",f=E.match(/\{[^}]+\}/),i=f?JSON.parse(f[0]):{success:!1,message:"Unknown error"};return N({action:"refresh",profile_id:z,result:i})}else if(J==="revoke"){if(!z)return M("oauth_profile_id or oauth_profile_name is required for revoke action");var o=`
        var gr = new GlideRecord('oauth_credential');
        gr.addQuery('oauth_entity_profile', ${JSON.stringify(z)});
        gr.query();
        var count = 0;
        while (gr.next()) {
          gr.deleteRecord();
          count++;
        }
        gs.print(JSON.stringify({
          success: true,
          tokens_revoked: count
        }));
      `,y=await $.post("/api/now/table/sys_script_execution",{script:o,description:"Revoke OAuth tokens for profile: "+z}),a=y.data.result?.output||"",r=a.match(/\{[^}]+\}/),b=r?JSON.parse(r[0]):{success:!1,tokens_revoked:0};return N({action:"revoke",profile_id:z,result:b})}else if(J==="test"){if(!z)return M("oauth_profile_id or oauth_profile_name is required for test action");var R=`
        var oauth = new sn_auth.GlideOAuthClient();
        var profile = new GlideRecord('oauth_entity_profile');
        if (profile.get(${JSON.stringify(z)})) {
          var startTime = new Date().getTime();
          var tokenResponse = oauth.getToken(profile.sys_id.toString(), '');
          var endTime = new Date().getTime();

          if (tokenResponse) {
            var token = tokenResponse.getToken();
            gs.print(JSON.stringify({
              success: token ? true : false,
              response_time_ms: endTime - startTime,
              has_token: token ? true : false,
              expires_in: tokenResponse.getExpiresIn(),
              error: tokenResponse.getErrorMessage() || null
            }));
          } else {
            gs.print(JSON.stringify({
              success: false,
              response_time_ms: endTime - startTime,
              error: 'No response from OAuth server'
            }));
          }
        } else {
          gs.print(JSON.stringify({
            success: false,
            error: 'OAuth profile not found'
          }));
        }
      `,l=await $.post("/api/now/table/sys_script_execution",{script:R,description:"Test OAuth profile: "+z}),p=l.data.result?.output||"",m=p.match(/\{[^}]+\}/),h=m?JSON.parse(m[0]):{success:!1,error:"Unknown error"};return N({action:"test",profile_id:z,result:h,recommendation:h.success?"OAuth profile is working correctly":"Check OAuth profile configuration and credentials"})}return M("Unknown action: "+J)}catch(_){if(_.response?.status===403)return M('Permission denied (403): Your ServiceNow user lacks permissions to manage OAuth tokens. Required roles: "oauth_admin" or "admin". Please contact your ServiceNow administrator.');return M(_.message)}}var SE={name:"snow_install_spoke",description:"Install and manage IntegrationHub Spokes (Jira, Slack, Azure DevOps, etc.)",category:"integration",subcategory:"integrationhub",use_cases:["spokes","integration-hub","marketplace","external-systems"],complexity:"advanced",frequency:"low",permission:"admin",allowedRoles:["admin"],inputSchema:{type:"object",properties:{action:{type:"string",enum:["list","list_available","install","activate","deactivate","status","search"],description:"Action to perform",default:"list"},spoke_name:{type:"string",description:'Name of the spoke (e.g., "Jira", "Slack", "Microsoft Teams")'},spoke_id:{type:"string",description:"sys_id of the spoke (for activate/deactivate/status)"},search_query:{type:"string",description:"Search query for finding spokes (for search action)"},include_inactive:{type:"boolean",description:"Include inactive spokes in list",default:!1},limit:{type:"number",description:"Maximum number of results",default:50}},required:["action"]}};async function kE(Y,X){var J=Y.action||"list",z=Y.spoke_name||"",Q=Y.spoke_id||"",G=Y.search_query||"",Z=Y.include_inactive||!1,$=Y.limit||50;try{var H=await x(X);if(J==="list"){var W=[];if(!Z)W.push("active=true");if(z)W.push("nameLIKE"+z);var K=await H.get("/api/now/table/sys_hub_spoke",{params:{sysparm_query:W.join("^")+"^ORDERBYname",sysparm_limit:$,sysparm_fields:"sys_id,name,version,active,description,vendor,sys_created_on,sys_updated_on",sysparm_display_value:"all"}}),U=K.data.result||[],B=[];for(var O=0;O<U.length;O++){var V=U[O],L=await H.get("/api/now/table/sys_hub_action_type_definition",{params:{sysparm_query:"sys_scope="+V.sys_id,sysparm_fields:"sys_id",sysparm_limit:1000}});B.push({sys_id:V.sys_id,name:V.name&&V.name.display_value?V.name.display_value:V.name,version:V.version,active:V.active==="true"||V.active===!0,description:V.description,vendor:V.vendor&&V.vendor.display_value?V.vendor.display_value:V.vendor,action_count:L.data.result?.length||0,installed_on:V.sys_created_on,updated_on:V.sys_updated_on})}return N({action:"list",spokes:B,total:B.length,summary:{active:B.filter(function(R){return R.active}).length,inactive:B.filter(function(R){return!R.active}).length,total_actions:B.reduce(function(R,l){return R+l.action_count},0)}})}else if(J==="list_available"){var q=await H.get("/api/now/table/v_plugin",{params:{sysparm_query:"nameLIKESpoke^ORnameLIKEIntegration^ORDERBYname",sysparm_limit:$,sysparm_fields:"sys_id,name,version,active,description,vendor"}}),F=q.data.result||[];return N({action:"list_available",available_spokes:F.map(function(R){return{sys_id:R.sys_id,name:R.name,version:R.version,active:R.active==="true",description:R.description,vendor:R.vendor}}),total:F.length,note:"Use snow_activate_plugin to activate available spokes"})}else if(J==="search"){if(!G)return M("search_query is required for search action");var P=await H.get("/api/now/table/sys_hub_spoke",{params:{sysparm_query:"nameLIKE"+G+"^ORdescriptionLIKE"+G,sysparm_limit:$,sysparm_fields:"sys_id,name,version,active,description,vendor"}}),A=P.data.result||[],w=await H.get("/api/now/table/v_plugin",{params:{sysparm_query:"nameLIKE"+G+"^nameLIKESpoke",sysparm_limit:$,sysparm_fields:"sys_id,name,version,active,description"}}),v=w.data.result||[];return N({action:"search",query:G,installed_spokes:A.map(function(R){return{sys_id:R.sys_id,name:R.name,version:R.version,active:R.active==="true",description:R.description}}),available_plugins:v.map(function(R){return{sys_id:R.sys_id,name:R.name,version:R.version,active:R.active==="true",description:R.description}}),total_found:A.length+v.length})}else if(J==="status"){if(!Q&&!z)return M("spoke_id or spoke_name is required for status action");var T=Q?"sys_id="+Q:"nameLIKE"+z,D=await H.get("/api/now/table/sys_hub_spoke",{params:{sysparm_query:T,sysparm_limit:1,sysparm_fields:"sys_id,name,version,active,description,vendor,sys_scope",sysparm_display_value:"all"}});if(!D.data.result||D.data.result.length===0)return M("Spoke not found: "+(z||Q));var j=D.data.result[0],E=await H.get("/api/now/table/sys_hub_action_type_definition",{params:{sysparm_query:"sys_scope="+j.sys_id+"^ORDERBYname",sysparm_fields:"sys_id,name,description,active,category",sysparm_limit:100}}),f=E.data.result||[],i=await H.get("/api/now/table/sys_alias",{params:{sysparm_query:"sys_scope="+j.sys_id,sysparm_fields:"sys_id,name,type,active",sysparm_limit:50}}),o=i.data.result||[];return N({action:"status",spoke:{sys_id:j.sys_id,name:j.name&&j.name.display_value?j.name.display_value:j.name,version:j.version,active:j.active==="true"||j.active===!0,description:j.description,vendor:j.vendor&&j.vendor.display_value?j.vendor.display_value:j.vendor},actions:f.map(function(R){return{sys_id:R.sys_id,name:R.name,description:R.description,active:R.active==="true",category:R.category}}),action_count:f.length,connections:o.map(function(R){return{sys_id:R.sys_id,name:R.name,type:R.type,active:R.active==="true"}}),health:j.active==="true"?"active":"inactive"})}else if(J==="activate"||J==="deactivate"){if(!Q&&!z)return M("spoke_id or spoke_name is required for "+J+" action");var y=Q?"sys_id="+Q:"nameLIKE"+z,a=await H.get("/api/now/table/sys_hub_spoke",{params:{sysparm_query:y,sysparm_limit:1,sysparm_fields:"sys_id,name,active"}});if(!a.data.result||a.data.result.length===0)return M("Spoke not found");var r=a.data.result[0],b=J==="activate";return await H.patch("/api/now/table/sys_hub_spoke/"+r.sys_id,{active:b}),N({action:J,spoke:{sys_id:r.sys_id,name:r.name,previous_state:r.active==="true"?"active":"inactive",new_state:b?"active":"inactive"},message:"Spoke "+(b?"activated":"deactivated")+" successfully"})}else if(J==="install")return N({action:"install",message:"Spoke installation is handled through plugin activation",instructions:["1. Use snow_list_plugins to find the spoke plugin","2. Use snow_activate_plugin with the plugin sys_id to install","3. After activation, configure connection aliases with snow_create_connection_alias","4. Set up credentials with snow_create_credential_alias"],common_spokes:[{name:"Jira Spoke",plugin:"com.snc.integration.jira"},{name:"Slack Spoke",plugin:"com.snc.integration.slack"},{name:"Microsoft Teams Spoke",plugin:"com.snc.integration.teams"},{name:"Azure DevOps Spoke",plugin:"com.snc.integration.azure_devops"},{name:"Salesforce Spoke",plugin:"com.snc.integration.salesforce"},{name:"ServiceNow Spoke",plugin:"com.snc.integration.servicenow"}]});return M("Unknown action: "+J)}catch(R){if(R.response?.status===403)return M('Permission denied (403): Your ServiceNow user lacks permissions to manage spokes. Required roles: "admin" or "flow_designer". Please contact your ServiceNow administrator.');return M(R.message)}}var _E={name:"snow_create_flow_action",description:"Create custom IntegrationHub action for Flow Designer",category:"integration",subcategory:"integrationhub",use_cases:["flow-designer","integration-hub","custom-actions","automation"],complexity:"advanced",frequency:"medium",permission:"write",allowedRoles:["developer","admin"],inputSchema:{type:"object",properties:{name:{type:"string",description:'Action name (e.g., "Create Jira Issue", "Send Slack Message")'},description:{type:"string",description:"Description of what the action does"},category:{type:"string",description:"Category for organizing the action",default:"Custom"},action_type:{type:"string",enum:["rest","script","subflow","powershell","ssh"],description:"Type of action implementation",default:"rest"},connection_alias:{type:"string",description:"sys_id or name of connection alias to use"},inputs:{type:"array",description:"Input parameters for the action",items:{type:"object",properties:{name:{type:"string",description:"Input parameter name"},label:{type:"string",description:"Display label"},type:{type:"string",enum:["string","integer","boolean","reference","object","array"],description:"Data type"},mandatory:{type:"boolean",description:"Is input required"},default_value:{type:"string",description:"Default value"}}}},outputs:{type:"array",description:"Output parameters for the action",items:{type:"object",properties:{name:{type:"string",description:"Output parameter name"},label:{type:"string",description:"Display label"},type:{type:"string",enum:["string","integer","boolean","reference","object","array"],description:"Data type"}}}},rest_config:{type:"object",description:"REST action configuration (for rest action_type)",properties:{http_method:{type:"string",enum:["GET","POST","PUT","PATCH","DELETE"]},endpoint_path:{type:"string",description:"Relative endpoint path (can use {{input.param}} syntax)"},request_body:{type:"string",description:"Request body template (JSON with {{input.param}} placeholders)"},headers:{type:"object",description:"Additional headers"},content_type:{type:"string",default:"application/json"}}},script_config:{type:"object",description:"Script action configuration (for script action_type)",properties:{script:{type:"string",description:"ES5 JavaScript script to execute"}}},active:{type:"boolean",description:"Whether the action is active",default:!0},annotation:{type:"string",description:"Annotation/label for the action in Flow Designer"}},required:["name"]}};async function bE(Y,X){var J=Y.name,z=Y.description||"",Q=Y.category||"Custom",G=Y.action_type||"rest",Z=Y.connection_alias||"",$=Y.inputs||[],H=Y.outputs||[],W=Y.rest_config||{},K=Y.script_config||{},U=Y.active!==!1,B=Y.annotation||"";try{var O=await x(X),V=!1,L=Z;if(Z&&!Z.match(/^[a-f0-9]{32}$/)){var q=await O.get("/api/now/table/sys_alias",{params:{sysparm_query:"name="+Z,sysparm_limit:1,sysparm_fields:"sys_id"}});if(q.data.result&&q.data.result.length>0)L=q.data.result[0].sys_id}var F={name:J,description:z,category:Q,active:U,annotation:B};if(L)F.connection_alias=L;var P;try{P=await O.post("/api/now/table/sys_hub_action_type_definition",F)}catch(P0){if(P0.response?.status===403){V=!0;var A=`
          var gr = new GlideRecord('sys_hub_action_type_definition');
          gr.initialize();
          gr.name = ${JSON.stringify(J)};
          gr.description = ${JSON.stringify(z)};
          gr.category = ${JSON.stringify(Q)};
          gr.active = ${U};
          gr.annotation = ${JSON.stringify(B)};
          ${L?`gr.connection_alias = ${JSON.stringify(L)};`:""}
          var sysId = gr.insert();

          if (sysId) {
            gs.print(JSON.stringify({
              sys_id: sysId,
              name: gr.name.toString()
            }));
          } else {
            gs.error('Failed to create action');
          }
        `,w=await O.post("/api/now/table/sys_script_execution",{script:A,description:"Create Flow action: "+J}),v=w.data.result?.output||"",T=v.match(/\{[^}]+\}/);if(T)P={data:{result:JSON.parse(T[0])}};else throw Error("Failed to create action via background script")}else throw P0}var D=P.data.result,j=[];for(var E=0;E<$.length;E++){var f=$[E],i={action_type:D.sys_id,name:f.name,label:f.label||f.name,type:f.type||"string",mandatory:f.mandatory||!1,default_value:f.default_value||""};try{var o=await O.post("/api/now/table/sys_hub_action_input",i);j.push({sys_id:o.data.result.sys_id,name:f.name,type:f.type||"string"})}catch(P0){if(P0.response?.status===403){var y=`
            var gr = new GlideRecord('sys_hub_action_input');
            gr.initialize();
            gr.action_type = ${JSON.stringify(D.sys_id)};
            gr.name = ${JSON.stringify(f.name)};
            gr.label = ${JSON.stringify(f.label||f.name)};
            gr.type = ${JSON.stringify(f.type||"string")};
            gr.mandatory = ${f.mandatory||!1};
            gr.default_value = ${JSON.stringify(f.default_value||"")};
            var sysId = gr.insert();
            if (sysId) {
              gs.print(JSON.stringify({ sys_id: sysId, name: ${JSON.stringify(f.name)} }));
            }
          `,a=await O.post("/api/now/table/sys_script_execution",{script:y,description:"Create action input: "+f.name}),r=a.data.result?.output||"",b=r.match(/\{[^}]+\}/);if(b)j.push(JSON.parse(b[0]))}}}var R=[];for(var l=0;l<H.length;l++){var p=H[l],m={action_type:D.sys_id,name:p.name,label:p.label||p.name,type:p.type||"string"};try{var h=await O.post("/api/now/table/sys_hub_action_output",m);R.push({sys_id:h.data.result.sys_id,name:p.name,type:p.type||"string"})}catch(P0){if(P0.response?.status===403){var _=`
            var gr = new GlideRecord('sys_hub_action_output');
            gr.initialize();
            gr.action_type = ${JSON.stringify(D.sys_id)};
            gr.name = ${JSON.stringify(p.name)};
            gr.label = ${JSON.stringify(p.label||p.name)};
            gr.type = ${JSON.stringify(p.type||"string")};
            var sysId = gr.insert();
            if (sysId) {
              gs.print(JSON.stringify({ sys_id: sysId, name: ${JSON.stringify(p.name)} }));
            }
          `,c=await O.post("/api/now/table/sys_script_execution",{script:_,description:"Create action output: "+p.name}),d=c.data.result?.output||"",s=d.match(/\{[^}]+\}/);if(s)R.push(JSON.parse(s[0]))}}}var W0=null;if(G==="rest"&&W.http_method){var L0={action_type:D.sys_id,name:J+" - REST Step",step_type:"rest",http_method:W.http_method,rest_endpoint:W.endpoint_path||"",request_body:W.request_body||"",content_type:W.content_type||"application/json"};try{var X0=await O.post("/api/now/table/sys_hub_step_ext",L0);W0={sys_id:X0.data.result.sys_id,type:"rest",http_method:W.http_method}}catch(P0){W0=null}}else if(G==="script"&&K.script){var b0={action_type:D.sys_id,name:J+" - Script Step",step_type:"script",script:K.script};try{var J0=await O.post("/api/now/table/sys_hub_step_ext",b0);W0={sys_id:J0.data.result.sys_id,type:"script"}}catch(P0){W0=null}}return N({created:!0,method:V?"background_script":"table_api",action:{sys_id:D.sys_id,name:D.name||J,category:Q,action_type:G,active:U},inputs:j,outputs:R,step:W0,connection_alias:L||null,usage:["Action is now available in Flow Designer",'Use in flows via "Action" step type',"Access inputs with inputs.parameter_name","Set outputs with outputs.parameter_name = value"]})}catch(P0){if(P0.response?.status===403)return M('Permission denied (403): Your ServiceNow user lacks permissions to create Flow actions. Required roles: "flow_designer" or "admin". Please contact your ServiceNow administrator.');return M(P0.message)}}var RE={name:"snow_manage_spoke_connection",description:"Manage IntegrationHub spoke connections: configure, test, and troubleshoot",category:"integration",subcategory:"integrationhub",use_cases:["spokes","connections","integration-hub","troubleshooting"],complexity:"intermediate",frequency:"medium",permission:"write",allowedRoles:["developer","admin"],inputSchema:{type:"object",properties:{action:{type:"string",enum:["list","configure","test","status","update","troubleshoot"],description:"Action to perform",default:"list"},spoke_name:{type:"string",description:"Name of the spoke to manage connections for"},connection_alias_id:{type:"string",description:"sys_id of specific connection alias"},configuration:{type:"object",description:"Connection configuration to apply (for configure/update)",properties:{base_url:{type:"string",description:"Base URL for the external system"},credential_alias:{type:"string",description:"Credential alias sys_id"},mid_server:{type:"string",description:"MID Server to use"},timeout:{type:"number",description:"Connection timeout in seconds"},retry_count:{type:"number",description:"Number of retry attempts"},custom_headers:{type:"object",description:"Custom headers to include"}}},include_inactive:{type:"boolean",description:"Include inactive connections",default:!1}},required:["action"]}};async function fE(Y,X){var J=Y.action||"list",z=Y.spoke_name||"",Q=Y.connection_alias_id||"",G=Y.configuration||{},Z=Y.include_inactive||!1;try{var $=await x(X);if(J==="list"){var H=[];if(!Z)H.push("active=true");if(z){var W=await $.get("/api/now/table/sys_hub_spoke",{params:{sysparm_query:"nameLIKE"+z,sysparm_limit:1,sysparm_fields:"sys_id,name"}});if(W.data.result&&W.data.result.length>0)H.push("sys_scope="+W.data.result[0].sys_id)}var K=await $.get("/api/now/table/sys_alias",{params:{sysparm_query:H.join("^")+"^type=connection^ORDERBYname",sysparm_limit:100,sysparm_fields:"sys_id,name,type,active,credential,sys_scope",sysparm_display_value:"all"}}),U=K.data.result||[],B=[];for(var O=0;O<U.length;O++){var V=U[O],L=await $.get("/api/now/table/sys_connection",{params:{sysparm_query:"connection_alias="+V.sys_id,sysparm_limit:1,sysparm_fields:"connection_url,mid_server,use_mutual_auth,timeout"}}),q=L.data.result?.[0]||null;B.push({sys_id:V.sys_id,name:V.name&&V.name.display_value?V.name.display_value:V.name,type:V.type,active:V.active==="true"||V.active===!0,credential:V.credential&&V.credential.display_value?V.credential.display_value:V.credential,scope:V.sys_scope&&V.sys_scope.display_value?V.sys_scope.display_value:V.sys_scope,http_connection:q?{base_url:q.connection_url,mid_server:q.mid_server,use_mutual_auth:q.use_mutual_auth==="true",timeout:q.timeout}:null})}return N({action:"list",connections:B,total:B.length,summary:{active:B.filter(function(_){return _.active}).length,inactive:B.filter(function(_){return!_.active}).length,with_credentials:B.filter(function(_){return _.credential}).length}})}else if(J==="status"){if(!Q)return M("connection_alias_id is required for status action");var F=await $.get("/api/now/table/sys_alias/"+Q,{params:{sysparm_display_value:"all"}});if(!F.data.result)return M("Connection alias not found");var P=F.data.result,A=await $.get("/api/now/table/sys_connection",{params:{sysparm_query:"connection_alias="+Q,sysparm_fields:"sys_id,connection_url,mid_server,use_mutual_auth,timeout,retry_count",sysparm_display_value:"all"}}),w=A.data.result?.[0]||null,v=null;if(P.credential){var T=P.credential.value||P.credential,D=await $.get("/api/now/table/discovery_credentials/"+T,{params:{sysparm_fields:"name,type,active"}});if(D.data.result)v={name:D.data.result.name,type:D.data.result.type,active:D.data.result.active==="true"}}var j=await $.get("/api/now/table/syslog",{params:{sysparm_query:"messageLIKE"+(P.name.display_value||P.name)+"^ORDERBYDESCsys_created_on",sysparm_limit:5,sysparm_fields:"sys_created_on,level,message"}}),E=j.data.result||[];return N({action:"status",connection:{sys_id:P.sys_id,name:P.name&&P.name.display_value?P.name.display_value:P.name,type:P.type,active:P.active==="true"||P.active===!0,scope:P.sys_scope&&P.sys_scope.display_value?P.sys_scope.display_value:P.sys_scope},http_settings:w?{base_url:w.connection_url,mid_server:w.mid_server&&w.mid_server.display_value?w.mid_server.display_value:w.mid_server,use_mutual_auth:w.use_mutual_auth==="true",timeout:w.timeout,retry_count:w.retry_count}:null,credential:v,recent_activity:E.map(function(_){return{timestamp:_.sys_created_on,level:_.level,message:_.message?_.message.substring(0,200):""}}),health:P.active==="true"?"configured":"inactive"})}else if(J==="test"){if(!Q)return M("connection_alias_id is required for test action");var f=`
        var alias = new GlideRecord('sys_alias');
        if (alias.get(${JSON.stringify(Q)})) {
          var conn = new GlideRecord('sys_connection');
          conn.addQuery('connection_alias', alias.sys_id);
          conn.query();

          if (conn.next()) {
            var startTime = new Date().getTime();
            try {
              var request = new sn_ws.RESTMessageV2();
              request.setEndpoint(conn.connection_url.toString());
              request.setHttpMethod('GET');
              request.setHttpTimeout(10000);

              // Try to resolve credential
              if (alias.credential) {
                var cred = new GlideRecord('discovery_credentials');
                if (cred.get(alias.credential)) {
                  if (cred.type == 'basic') {
                    request.setBasicAuth(cred.user_name, cred.password.getDecryptedValue());
                  }
                }
              }

              var response = request.execute();
              var endTime = new Date().getTime();

              gs.print(JSON.stringify({
                success: true,
                status_code: response.getStatusCode(),
                response_time_ms: endTime - startTime,
                endpoint: conn.connection_url.toString()
              }));
            } catch (e) {
              var endTime = new Date().getTime();
              gs.print(JSON.stringify({
                success: false,
                error: e.message,
                response_time_ms: endTime - startTime,
                endpoint: conn.connection_url.toString()
              }));
            }
          } else {
            gs.print(JSON.stringify({
              success: false,
              error: 'No HTTP connection found for alias'
            }));
          }
        } else {
          gs.print(JSON.stringify({
            success: false,
            error: 'Connection alias not found'
          }));
        }
      `,i=await $.post("/api/now/table/sys_script_execution",{script:f,description:"Test spoke connection: "+Q}),o=i.data.result?.output||"",y=o.match(/\{[^}]+\}/),a=y?JSON.parse(y[0]):{success:!1,error:"Unknown error"};return N({action:"test",connection_alias_id:Q,result:a,recommendation:a.success?"Connection is working correctly":"Check endpoint URL, credentials, and network connectivity"})}else if(J==="configure"||J==="update"){if(!Q)return M("connection_alias_id is required for "+J+" action");var r={};if(G.credential_alias)r.credential=G.credential_alias;if(Object.keys(r).length>0)await $.patch("/api/now/table/sys_alias/"+Q,r);if(G.base_url||G.mid_server||G.timeout){var b=await $.get("/api/now/table/sys_connection",{params:{sysparm_query:"connection_alias="+Q,sysparm_limit:1,sysparm_fields:"sys_id"}}),R={};if(G.base_url)R.connection_url=G.base_url;if(G.mid_server)R.mid_server=G.mid_server;if(G.timeout)R.timeout=G.timeout;if(G.retry_count)R.retry_count=G.retry_count;if(b.data.result&&b.data.result.length>0)await $.patch("/api/now/table/sys_connection/"+b.data.result[0].sys_id,R);else if(G.base_url)R.connection_alias=Q,await $.post("/api/now/table/sys_connection",R)}return N({action:J,connection_alias_id:Q,updates_applied:G,message:"Connection configuration updated successfully"})}else if(J==="troubleshoot"){if(!Q)return M("connection_alias_id is required for troubleshoot action");var l=await $.get("/api/now/table/sys_alias/"+Q,{params:{sysparm_display_value:"all"}});if(!l.data.result)return M("Connection alias not found");var p={alias:{name:l.data.result.name,active:l.data.result.active,has_credential:!!l.data.result.credential},issues:[],recommendations:[]};if(l.data.result.active!=="true")p.issues.push("Connection alias is inactive"),p.recommendations.push("Activate the connection alias");if(!l.data.result.credential)p.issues.push("No credential configured"),p.recommendations.push("Configure credential using snow_create_credential_alias");var m=await $.get("/api/now/table/sys_connection",{params:{sysparm_query:"connection_alias="+Q,sysparm_limit:1,sysparm_fields:"connection_url,mid_server,timeout"}});if(!m.data.result||m.data.result.length===0)p.issues.push("No HTTP connection configured"),p.recommendations.push("Configure HTTP connection with base URL");else{var w=m.data.result[0];if(p.http_connection={base_url:w.connection_url,has_mid_server:!!w.mid_server,timeout:w.timeout||"default"},!w.connection_url)p.issues.push("HTTP connection has no URL configured"),p.recommendations.push("Set connection_url in HTTP connection")}var h=await $.get("/api/now/table/syslog",{params:{sysparm_query:"level=2^messageLIKE"+(l.data.result.name.display_value||l.data.result.name)+"^ORDERBYDESCsys_created_on",sysparm_limit:10,sysparm_fields:"sys_created_on,message"}});if(h.data.result&&h.data.result.length>0)p.recent_errors=h.data.result.map(function(_){return{timestamp:_.sys_created_on,message:_.message?_.message.substring(0,200):""}}),p.issues.push("Recent errors found in logs"),p.recommendations.push("Review error messages for specific issues");return p.health=p.issues.length===0?"healthy":"issues_detected",N({action:"troubleshoot",connection_alias_id:Q,diagnostics:p})}return M("Unknown action: "+J)}catch(_){if(_.response?.status===403)return M('Permission denied (403): Your ServiceNow user lacks permissions to manage spoke connections. Required roles: "flow_designer" or "admin". Please contact your ServiceNow administrator.');return M(_.message)}}var yE={name:"snow_configure_mid_server",description:"Configure MID Server settings for on-premise integrations and Discovery",category:"integration",subcategory:"mid-server",use_cases:["mid-server","on-premise","discovery","integration"],complexity:"advanced",frequency:"low",permission:"admin",allowedRoles:["admin"],inputSchema:{type:"object",properties:{action:{type:"string",enum:["list","status","configure","validate","restart","assign_application"],description:"Action to perform",default:"list"},mid_server_name:{type:"string",description:"Name of the MID Server"},mid_server_id:{type:"string",description:"sys_id of the MID Server"},configuration:{type:"object",description:"Configuration settings to apply",properties:{ip_address:{type:"string",description:"IP address restriction"},max_threads:{type:"number",description:"Maximum concurrent threads"},max_memory:{type:"string",description:'Maximum memory allocation (e.g., "2048m")'},network_range:{type:"string",description:"Network range for Discovery"},validated:{type:"boolean",description:"Validation status"}}},application_id:{type:"string",description:"Application sys_id for assign_application action"},include_inactive:{type:"boolean",description:"Include inactive MID Servers",default:!1}},required:["action"]}};async function hE(Y,X){var J=Y.action||"list",z=Y.mid_server_name||"",Q=Y.mid_server_id||"",G=Y.configuration||{},Z=Y.application_id||"",$=Y.include_inactive||!1;try{var H=await x(X);if(J==="list"){var W=[];if(!$)W.push("status=Up");if(z)W.push("nameLIKE"+z);var K=await H.get("/api/now/table/ecc_agent",{params:{sysparm_query:W.join("^")+"^ORDERBYname",sysparm_limit:100,sysparm_fields:"sys_id,name,status,ip_address,host_name,version,validated,last_refreshed,router,sys_created_on",sysparm_display_value:"all"}}),U=K.data.result||[],B=[];for(var O=0;O<U.length;O++){var V=U[O],L=await H.get("/api/now/table/ecc_agent_capability_m2m",{params:{sysparm_query:"agent="+V.sys_id,sysparm_fields:"sys_id",sysparm_limit:100}}),q=await H.get("/api/now/table/ecc_agent_application_m2m",{params:{sysparm_query:"agent="+V.sys_id,sysparm_fields:"sys_id",sysparm_limit:100}});B.push({sys_id:V.sys_id,name:V.name,status:V.status&&V.status.display_value?V.status.display_value:V.status,ip_address:V.ip_address,host_name:V.host_name,version:V.version,validated:V.validated==="true"||V.validated===!0,last_refreshed:V.last_refreshed,router:V.router&&V.router.display_value?V.router.display_value:V.router,capability_count:L.data.result?.length||0,application_count:q.data.result?.length||0,created_on:V.sys_created_on})}var F={total:B.length,up:B.filter(function(X0){return X0.status==="Up"}).length,down:B.filter(function(X0){return X0.status==="Down"}).length,validated:B.filter(function(X0){return X0.validated}).length,not_validated:B.filter(function(X0){return!X0.validated}).length};return N({action:"list",mid_servers:B,summary:F})}else if(J==="status"){var P=Q;if(!P&&z){var A=await H.get("/api/now/table/ecc_agent",{params:{sysparm_query:"name="+z,sysparm_limit:1,sysparm_fields:"sys_id"}});if(A.data.result&&A.data.result.length>0)P=A.data.result[0].sys_id}if(!P)return M("MID Server not found. Provide mid_server_id or mid_server_name.");var w=await H.get("/api/now/table/ecc_agent/"+P,{params:{sysparm_display_value:"all"}});if(!w.data.result)return M("MID Server not found");var v=w.data.result,T=await H.get("/api/now/table/ecc_agent_capability_m2m",{params:{sysparm_query:"agent="+P,sysparm_fields:"capability",sysparm_display_value:"all",sysparm_limit:100}}),D=(T.data.result||[]).map(function(X0){return X0.capability&&X0.capability.display_value?X0.capability.display_value:X0.capability}),j=await H.get("/api/now/table/ecc_agent_application_m2m",{params:{sysparm_query:"agent="+P,sysparm_fields:"application",sysparm_display_value:"all",sysparm_limit:100}}),E=(j.data.result||[]).map(function(X0){return X0.application&&X0.application.display_value?X0.application.display_value:X0.application}),f=await H.get("/api/now/table/ecc_queue",{params:{sysparm_query:"agent="+P+"^state=error^ORDERBYDESCsys_created_on",sysparm_limit:10,sysparm_fields:"sys_created_on,topic,name,error_string"}}),i=f.data.result||[],o=100;if(v.status!=="Up"&&v.status?.display_value!=="Up")o-=50;if(!v.validated&&v.validated!=="true")o-=20;if(i.length>0)o-=Math.min(30,i.length*5);return N({action:"status",mid_server:{sys_id:v.sys_id,name:v.name,status:v.status&&v.status.display_value?v.status.display_value:v.status,ip_address:v.ip_address,host_name:v.host_name,version:v.version,validated:v.validated==="true"||v.validated===!0,last_refreshed:v.last_refreshed,router:v.router&&v.router.display_value?v.router.display_value:v.router,network:v.network,home_dir:v.home_dir},capabilities:D,capability_count:D.length,applications:E,application_count:E.length,recent_issues:i.map(function(X0){return{timestamp:X0.sys_created_on,topic:X0.topic,name:X0.name,error:X0.error_string}}),health:{score:o,status:o>=80?"healthy":o>=50?"degraded":"unhealthy"}})}else if(J==="configure"){var y=Q;if(!y&&z){var a=await H.get("/api/now/table/ecc_agent",{params:{sysparm_query:"name="+z,sysparm_limit:1,sysparm_fields:"sys_id"}});if(a.data.result&&a.data.result.length>0)y=a.data.result[0].sys_id}if(!y)return M("MID Server not found");var r={};if(G.ip_address!==void 0)r.ip_address=G.ip_address;if(G.validated!==void 0)r.validated=G.validated;if(G.network_range!==void 0)r.network=G.network_range;if(Object.keys(r).length>0)await H.patch("/api/now/table/ecc_agent/"+y,r);return N({action:"configure",mid_server_id:y,updates_applied:r,message:"MID Server configuration updated",note:"Some settings require MID Server restart to take effect"})}else if(J==="validate"){var b=Q;if(!b&&z){var R=await H.get("/api/now/table/ecc_agent",{params:{sysparm_query:"name="+z,sysparm_limit:1,sysparm_fields:"sys_id,name,validated"}});if(R.data.result&&R.data.result.length>0)b=R.data.result[0].sys_id}if(!b)return M("MID Server not found");return await H.patch("/api/now/table/ecc_agent/"+b,{validated:!0}),N({action:"validate",mid_server_id:b,validated:!0,message:"MID Server has been validated and is ready for use"})}else if(J==="restart"){var l=Q;if(!l&&z){var p=await H.get("/api/now/table/ecc_agent",{params:{sysparm_query:"name="+z,sysparm_limit:1,sysparm_fields:"sys_id,name"}});if(p.data.result&&p.data.result.length>0)l=p.data.result[0].sys_id}if(!l)return M("MID Server not found");var m=`
        var ecc = new GlideRecord('ecc_queue');
        ecc.initialize();
        ecc.agent = ${JSON.stringify(l)};
        ecc.topic = 'Command';
        ecc.name = 'restartMid';
        ecc.source = 'snow-flow';
        ecc.queue = 'output';
        var sysId = ecc.insert();
        gs.print(JSON.stringify({
          success: sysId ? true : false,
          ecc_queue_id: sysId,
          message: sysId ? 'Restart command queued' : 'Failed to queue restart'
        }));
      `,h=await H.post("/api/now/table/sys_script_execution",{script:m,description:"Restart MID Server: "+l}),_=h.data.result?.output||"",c=_.match(/\{[^}]+\}/),d=c?JSON.parse(c[0]):{success:!1,message:"Unknown error"};return N({action:"restart",mid_server_id:l,result:d})}else if(J==="assign_application"){if(!Z)return M("application_id is required for assign_application action");var s=Q;if(!s&&z){var W0=await H.get("/api/now/table/ecc_agent",{params:{sysparm_query:"name="+z,sysparm_limit:1,sysparm_fields:"sys_id"}});if(W0.data.result&&W0.data.result.length>0)s=W0.data.result[0].sys_id}if(!s)return M("MID Server not found");var L0=await H.post("/api/now/table/ecc_agent_application_m2m",{agent:s,application:Z});return N({action:"assign_application",mid_server_id:s,application_id:Z,assignment_id:L0.data.result?.sys_id,message:"Application assigned to MID Server successfully"})}return M("Unknown action: "+J)}catch(X0){if(X0.response?.status===403)return M('Permission denied (403): Your ServiceNow user lacks permissions to manage MID Servers. Required roles: "mid_server" or "admin". Please contact your ServiceNow administrator.');return M(X0.message)}}var mE={name:"snow_test_mid_connectivity",description:"Test MID Server connectivity to external endpoints and diagnose network issues",category:"integration",subcategory:"mid-server",use_cases:["mid-server","connectivity","troubleshooting","network"],complexity:"intermediate",frequency:"medium",permission:"write",allowedRoles:["developer","admin"],inputSchema:{type:"object",properties:{action:{type:"string",enum:["test_endpoint","test_port","ping","dns_lookup","traceroute","full_diagnostic"],description:"Type of connectivity test to perform",default:"test_endpoint"},mid_server_name:{type:"string",description:"Name of the MID Server to test from"},mid_server_id:{type:"string",description:"sys_id of the MID Server to test from"},target_host:{type:"string",description:"Target hostname or IP address"},target_port:{type:"number",description:"Target port number (for port test)",default:443},target_url:{type:"string",description:"Full URL to test (for endpoint test)"},timeout_seconds:{type:"number",description:"Timeout for the test in seconds",default:30},protocol:{type:"string",enum:["tcp","udp","http","https"],description:"Protocol to use for port test",default:"tcp"}},required:["action"]}};async function uE(Y,X){var J=Y.action||"test_endpoint",z=Y.mid_server_name||"",Q=Y.mid_server_id||"",G=Y.target_host||"",Z=Y.target_port||443,$=Y.target_url||"",H=Y.timeout_seconds||30,W=Y.protocol||"tcp";try{var K=await x(X),U=Q;if(!U&&z){var B=await K.get("/api/now/table/ecc_agent",{params:{sysparm_query:"name="+z+"^status=Up",sysparm_limit:1,sysparm_fields:"sys_id,name,ip_address"}});if(B.data.result&&B.data.result.length>0)U=B.data.result[0].sys_id;else return M("MID Server not found or not running: "+z)}if(!U){var O=await K.get("/api/now/table/ecc_agent",{params:{sysparm_query:"status=Up^validated=true",sysparm_limit:10,sysparm_fields:"sys_id,name,ip_address,host_name"}}),V=O.data.result||[];return N({action:"list_available",message:"No MID Server specified. Available MID Servers:",mid_servers:V.map(function(X0){return{sys_id:X0.sys_id,name:X0.name,ip_address:X0.ip_address,host_name:X0.host_name}}),usage:"Provide mid_server_name or mid_server_id to run connectivity tests"})}var L=await K.get("/api/now/table/ecc_agent/"+U,{params:{sysparm_fields:"name,ip_address,host_name,status"}}),q=L.data.result;if(J==="test_endpoint"){if(!$)return M("target_url is required for test_endpoint action");var F=`
        var probe = new GlideRecord('ecc_queue');
        probe.initialize();
        probe.agent = ${JSON.stringify(U)};
        probe.topic = 'Probe';
        probe.name = 'HTTPProbe';
        probe.source = 'snow-flow-connectivity-test';
        probe.queue = 'output';

        var payload = {
          url: ${JSON.stringify($)},
          timeout: ${H*1000}
        };
        probe.payload = JSON.stringify(payload);

        var sysId = probe.insert();

        // Wait briefly for response
        var response = new GlideRecord('ecc_queue');
        response.addQuery('source', probe.sys_id);
        response.addQuery('queue', 'input');
        response.setLimit(1);

        var maxWait = ${H};
        var waited = 0;
        var result = null;

        while (waited < maxWait && !result) {
          gs.sleep(1000);
          waited++;
          response.query();
          if (response.next()) {
            result = {
              success: true,
              response_received: true,
              payload: response.payload.toString()
            };
          }
        }

        if (!result) {
          result = {
            success: true,
            response_received: false,
            message: 'Probe queued, check ECC queue for results',
            ecc_queue_id: sysId
          };
        }

        gs.print(JSON.stringify(result));
      `,P=await K.post("/api/now/table/sys_script_execution",{script:F,description:"Test endpoint from MID: "+$}),A=P.data.result?.output||"",w=A.match(/\{[\s\S]*\}/),v=w?JSON.parse(w[0]):{success:!1,error:"Unknown error"};return N({action:"test_endpoint",mid_server:{name:q.name,ip_address:q.ip_address},target:$,result:v})}else if(J==="test_port"){if(!G)return M("target_host is required for test_port action");var T=`
        var probe = new GlideRecord('ecc_queue');
        probe.initialize();
        probe.agent = ${JSON.stringify(U)};
        probe.topic = 'Probe';
        probe.name = 'TCPProbe';
        probe.source = 'snow-flow-port-test';
        probe.queue = 'output';

        var payload = {
          host: ${JSON.stringify(G)},
          port: ${Z},
          protocol: ${JSON.stringify(W)},
          timeout: ${H*1000}
        };
        probe.payload = JSON.stringify(payload);

        var sysId = probe.insert();

        gs.print(JSON.stringify({
          success: true,
          message: 'Port test queued',
          ecc_queue_id: sysId,
          target: ${JSON.stringify(G)} + ':' + ${Z}
        }));
      `,D=await K.post("/api/now/table/sys_script_execution",{script:T,description:"Test port from MID: "+G+":"+Z}),j=D.data.result?.output||"",E=j.match(/\{[^}]+\}/),f=E?JSON.parse(E[0]):{success:!1,error:"Unknown error"};return N({action:"test_port",mid_server:{name:q.name,ip_address:q.ip_address},target:{host:G,port:Z,protocol:W},result:f,note:"Check ECC queue for actual test results"})}else if(J==="ping"){if(!G)return M("target_host is required for ping action");var i=`
        var probe = new GlideRecord('ecc_queue');
        probe.initialize();
        probe.agent = ${JSON.stringify(U)};
        probe.topic = 'Probe';
        probe.name = 'ICMPProbe';
        probe.source = 'snow-flow-ping-test';
        probe.queue = 'output';

        var payload = {
          host: ${JSON.stringify(G)},
          count: 4,
          timeout: ${H*1000}
        };
        probe.payload = JSON.stringify(payload);

        var sysId = probe.insert();

        gs.print(JSON.stringify({
          success: true,
          message: 'Ping test queued',
          ecc_queue_id: sysId,
          target: ${JSON.stringify(G)}
        }));
      `,o=await K.post("/api/now/table/sys_script_execution",{script:i,description:"Ping from MID: "+G}),y=o.data.result?.output||"",a=y.match(/\{[^}]+\}/),r=a?JSON.parse(a[0]):{success:!1,error:"Unknown error"};return N({action:"ping",mid_server:{name:q.name,ip_address:q.ip_address},target:G,result:r,note:"Check ECC queue for ping results"})}else if(J==="dns_lookup"){if(!G)return M("target_host is required for dns_lookup action");var b=`
        var probe = new GlideRecord('ecc_queue');
        probe.initialize();
        probe.agent = ${JSON.stringify(U)};
        probe.topic = 'Probe';
        probe.name = 'DNSProbe';
        probe.source = 'snow-flow-dns-test';
        probe.queue = 'output';

        var payload = {
          hostname: ${JSON.stringify(G)},
          timeout: ${H*1000}
        };
        probe.payload = JSON.stringify(payload);

        var sysId = probe.insert();

        gs.print(JSON.stringify({
          success: true,
          message: 'DNS lookup queued',
          ecc_queue_id: sysId,
          hostname: ${JSON.stringify(G)}
        }));
      `,R=await K.post("/api/now/table/sys_script_execution",{script:b,description:"DNS lookup from MID: "+G}),l=R.data.result?.output||"",p=l.match(/\{[^}]+\}/),m=p?JSON.parse(p[0]):{success:!1,error:"Unknown error"};return N({action:"dns_lookup",mid_server:{name:q.name,ip_address:q.ip_address},hostname:G,result:m,note:"Check ECC queue for DNS resolution results"})}else if(J==="full_diagnostic"){if(!G&&!$)return M("target_host or target_url is required for full_diagnostic action");var h=G||new URL($).hostname,_=Z||($&&$.startsWith("https")?443:80),c=`
        var results = {
          mid_server: ${JSON.stringify(q.name)},
          target: ${JSON.stringify(h)},
          tests: {}
        };

        // Create probes for each test type
        var probes = ['ICMPProbe', 'TCPProbe', 'DNSProbe'];
        var eccIds = [];

        for (var i = 0; i < probes.length; i++) {
          var probe = new GlideRecord('ecc_queue');
          probe.initialize();
          probe.agent = ${JSON.stringify(U)};
          probe.topic = 'Probe';
          probe.name = probes[i];
          probe.source = 'snow-flow-diagnostic';
          probe.queue = 'output';

          var payload = {};
          if (probes[i] === 'ICMPProbe') {
            payload = { host: ${JSON.stringify(h)}, count: 2 };
          } else if (probes[i] === 'TCPProbe') {
            payload = { host: ${JSON.stringify(h)}, port: ${_} };
          } else if (probes[i] === 'DNSProbe') {
            payload = { hostname: ${JSON.stringify(h)} };
          }
          probe.payload = JSON.stringify(payload);

          var sysId = probe.insert();
          eccIds.push({ probe: probes[i], ecc_id: sysId });
        }

        results.queued_probes = eccIds;
        results.message = 'Diagnostic probes queued. Check ECC queue for results.';
        results.success = true;

        gs.print(JSON.stringify(results));
      `,d=await K.post("/api/now/table/sys_script_execution",{script:c,description:"Full diagnostic from MID to: "+h}),s=d.data.result?.output||"",W0=s.match(/\{[\s\S]*\}/),L0=W0?JSON.parse(W0[0]):{success:!1,error:"Unknown error"};return N({action:"full_diagnostic",mid_server:{name:q.name,ip_address:q.ip_address},target:{host:h,port:_},result:L0,instructions:["DNS probe will resolve hostname to IP","ICMP probe will test basic connectivity (ping)","TCP probe will test port connectivity","Check ECC queue for detailed results","Use snow_get_logs to view any errors"]})}return M("Unknown action: "+J)}catch(X0){if(X0.response?.status===403)return M('Permission denied (403): Your ServiceNow user lacks permissions to test MID connectivity. Required roles: "mid_server" or "admin".');return M(X0.message)}}var gE={name:"snow_manage_mid_capabilities",description:"Manage MID Server capabilities for Discovery, Orchestration, and integrations",category:"integration",subcategory:"mid-server",use_cases:["mid-server","capabilities","discovery","orchestration"],complexity:"advanced",frequency:"low",permission:"admin",allowedRoles:["admin"],inputSchema:{type:"object",properties:{action:{type:"string",enum:["list","list_available","add","remove","status","recommend"],description:"Action to perform",default:"list"},mid_server_name:{type:"string",description:"Name of the MID Server"},mid_server_id:{type:"string",description:"sys_id of the MID Server"},capability_name:{type:"string",description:"Name of the capability to add/remove"},capability_id:{type:"string",description:"sys_id of the capability to add/remove"},use_case:{type:"string",enum:["discovery","orchestration","integration","service_mapping","cloud","all"],description:"Filter capabilities by use case",default:"all"}},required:["action"]}};async function pE(Y,X){var J=Y.action||"list",z=Y.mid_server_name||"",Q=Y.mid_server_id||"",G=Y.capability_name||"",Z=Y.capability_id||"",$=Y.use_case||"all";try{var H=await x(X),W=Q,K=z;if(!W&&z){var U=await H.get("/api/now/table/ecc_agent",{params:{sysparm_query:"name="+z,sysparm_limit:1,sysparm_fields:"sys_id,name"}});if(U.data.result&&U.data.result.length>0)W=U.data.result[0].sys_id,K=U.data.result[0].name}else if(W&&!K){var B=await H.get("/api/now/table/ecc_agent/"+W,{params:{sysparm_fields:"name"}});if(B.data.result)K=B.data.result.name}if(J==="list"){if(!W)return M("mid_server_id or mid_server_name is required for list action");var O=await H.get("/api/now/table/ecc_agent_capability_m2m",{params:{sysparm_query:"agent="+W,sysparm_fields:"sys_id,capability",sysparm_display_value:"all",sysparm_limit:200}}),V=O.data.result||[],L=[];for(var q=0;q<V.length;q++){var F=V[q],P=F.capability?.value||F.capability;if(P){var A=await H.get("/api/now/table/ecc_agent_capability/"+P,{params:{sysparm_fields:"name,description,category,active"}});if(A.data.result){var w=A.data.result;L.push({assignment_id:F.sys_id,capability_id:P,name:w.name,description:w.description,category:w.category,active:w.active==="true"||w.active===!0})}}}if($!=="all"){var v={discovery:["Discovery","Network","SNMP","WMI","SSH"],orchestration:["Orchestration","PowerShell","SSH","REST"],integration:["REST","HTTP","SOAP","JDBC"],service_mapping:["ServiceMapping","Discovery","Pattern"],cloud:["AWS","Azure","GCP","Cloud"]},T=v[$]||[];L=L.filter(function(J0){for(var P0=0;P0<T.length;P0++)if(J0.name&&J0.name.indexOf(T[P0])>=0||J0.category&&J0.category.indexOf(T[P0])>=0)return!0;return!1})}var D={};return L.forEach(function(J0){var P0=J0.category||"Uncategorized";if(!D[P0])D[P0]=[];D[P0].push(J0)}),N({action:"list",mid_server:{sys_id:W,name:K},capabilities:L,total:L.length,by_category:D,filter:$})}else if(J==="list_available"){var j=["active=true"];if($!=="all"){var E={discovery:"Discovery",orchestration:"Orchestration",integration:"Integration",service_mapping:"ServiceMapping",cloud:"Cloud"};if(E[$])j.push("categoryLIKE"+E[$]+"^ORnameLIKE"+E[$])}var f=await H.get("/api/now/table/ecc_agent_capability",{params:{sysparm_query:j.join("^")+"^ORDERBYcategory^ORDERBYname",sysparm_limit:500,sysparm_fields:"sys_id,name,description,category,active"}}),i=f.data.result||[],o={};return i.forEach(function(J0){var P0=J0.category||"Uncategorized";if(!o[P0])o[P0]=[];o[P0].push({sys_id:J0.sys_id,name:J0.name,description:J0.description})}),N({action:"list_available",capabilities:i.map(function(J0){return{sys_id:J0.sys_id,name:J0.name,description:J0.description,category:J0.category}}),total:i.length,by_category:o,filter:$})}else if(J==="add"){if(!W)return M("mid_server_id or mid_server_name is required");var y=Z;if(!y&&G){var a=await H.get("/api/now/table/ecc_agent_capability",{params:{sysparm_query:"name="+G,sysparm_limit:1,sysparm_fields:"sys_id,name"}});if(a.data.result&&a.data.result.length>0)y=a.data.result[0].sys_id}if(!y)return M("Capability not found. Use list_available to see options.");var r=await H.get("/api/now/table/ecc_agent_capability_m2m",{params:{sysparm_query:"agent="+W+"^capability="+y,sysparm_limit:1,sysparm_fields:"sys_id"}});if(r.data.result&&r.data.result.length>0)return N({action:"add",already_assigned:!0,message:"Capability is already assigned to this MID Server",assignment_id:r.data.result[0].sys_id});var b=await H.post("/api/now/table/ecc_agent_capability_m2m",{agent:W,capability:y});return N({action:"add",mid_server:{sys_id:W,name:K},capability_id:y,assignment_id:b.data.result?.sys_id,message:"Capability added successfully"})}else if(J==="remove"){if(!W)return M("mid_server_id or mid_server_name is required");var R=Z;if(!R&&G){var l=await H.get("/api/now/table/ecc_agent_capability",{params:{sysparm_query:"name="+G,sysparm_limit:1,sysparm_fields:"sys_id"}});if(l.data.result&&l.data.result.length>0)R=l.data.result[0].sys_id}if(!R)return M("Capability not found");var p=await H.get("/api/now/table/ecc_agent_capability_m2m",{params:{sysparm_query:"agent="+W+"^capability="+R,sysparm_limit:1,sysparm_fields:"sys_id"}});if(!p.data.result||p.data.result.length===0)return N({action:"remove",not_assigned:!0,message:"Capability is not assigned to this MID Server"});return await H.delete("/api/now/table/ecc_agent_capability_m2m/"+p.data.result[0].sys_id),N({action:"remove",mid_server:{sys_id:W,name:K},capability_id:R,message:"Capability removed successfully"})}else if(J==="status"){if(!W)return M("mid_server_id or mid_server_name is required");var m=await H.get("/api/now/table/ecc_agent_capability_m2m",{params:{sysparm_query:"agent="+W,sysparm_fields:"capability",sysparm_display_value:"all",sysparm_limit:200}}),h=m.data.result||[],_=await H.get("/api/now/table/ecc_agent/"+W,{params:{sysparm_fields:"name,status,validated,ip_address,version"}}),c=_.data.result,d={discovery:[],orchestration:[],integration:[],other:[]};for(var s=0;s<h.length;s++){var W0=h[s].capability?.display_value||h[s].capability||"",L0=W0.toLowerCase();if(L0.indexOf("discovery")>=0||L0.indexOf("snmp")>=0||L0.indexOf("wmi")>=0||L0.indexOf("ssh")>=0)d.discovery.push(W0);else if(L0.indexOf("orchestration")>=0||L0.indexOf("powershell")>=0)d.orchestration.push(W0);else if(L0.indexOf("rest")>=0||L0.indexOf("http")>=0||L0.indexOf("jdbc")>=0||L0.indexOf("soap")>=0)d.integration.push(W0);else d.other.push(W0)}return N({action:"status",mid_server:{sys_id:W,name:c.name,status:c.status,validated:c.validated==="true",ip_address:c.ip_address,version:c.version},capability_summary:{total:h.length,discovery:d.discovery.length,orchestration:d.orchestration.length,integration:d.integration.length,other:d.other.length},capabilities_by_category:d,readiness:{discovery_ready:d.discovery.length>0,orchestration_ready:d.orchestration.length>0,integration_ready:d.integration.length>0}})}else if(J==="recommend"){var X0={discovery:["SSH","WMI","SNMP","PowerShell","VMware","Network Discovery","IP Network","Pattern Probe"],orchestration:["PowerShell","SSH","REST","Orchestration","Script Execution","Remote Commands"],integration:["REST","HTTP","SOAP","JDBC","File Transfer","Email","LDAP"],service_mapping:["Pattern Probe","Service Mapping","Discovery","SSH","WMI","Network Discovery"],cloud:["AWS","Azure","GCP","Cloud Discovery","REST","HTTP"]},b0=$==="all"?"discovery":$;return N({action:"recommend",use_case:b0,recommended_capabilities:X0[b0]||[],all_use_cases:Object.keys(X0),instructions:["Use list_available to find exact capability names","Use add action to assign recommended capabilities","Validate MID Server after adding capabilities"]})}return M("Unknown action: "+J)}catch(J0){if(J0.response?.status===403)return M('Permission denied (403): Your ServiceNow user lacks permissions to manage MID capabilities. Required roles: "mid_server" or "admin".');return M(J0.message)}}var fG={};G0(fG,{snow_table_schema_discovery_exec:()=>GS,snow_table_schema_discovery_def:()=>QS,snow_discover_platform_tables_exec:()=>zS,snow_discover_platform_tables_def:()=>JS,snow_create_ui_policy_exec:()=>sE,snow_create_ui_policy_def:()=>aE,snow_create_ui_page_exec:()=>YS,snow_create_ui_page_def:()=>eE,snow_create_ui_action_exec:()=>tE,snow_create_ui_action_def:()=>rE,snow_create_script_include_exec:()=>lE,snow_create_script_include_def:()=>dE,snow_create_client_script_exec:()=>nE,snow_create_client_script_def:()=>iE});import*as cE from"fs/promises";import{existsSync as m40}from"fs";var dE={name:"snow_create_script_include",description:"Create reusable Script Include with client-callable support",category:"development",subcategory:"platform",use_cases:["script-includes","code-reuse","api"],complexity:"intermediate",frequency:"high",permission:"write",allowedRoles:["developer","admin"],inputSchema:{type:"object",properties:{name:{type:"string",description:"Script Include name (CamelCase recommended)"},script:{type:"string",description:"Script code (ES5 only, function constructor pattern)"},description:{type:"string",description:"Script Include description"},client_callable:{type:"boolean",description:"Allow client-side scripts to call this Script Include",default:!1},access:{type:"string",enum:["public","package_private"],description:"Access level",default:"package_private"},active:{type:"boolean",description:"Activate immediately",default:!0},api_name:{type:"string",description:"API name for client-callable (defaults to name)"},validate_es5:{type:"boolean",description:"Validate ES5 compliance before creation",default:!0},script_file:{type:"string",description:"Path to local script file. File content will be used as the script. Alternative to inline script parameter."},upsert:{type:"boolean",description:"If true and a Script Include with the same name already exists, update it instead of returning an error.",default:!1}},required:["name"]}};async function lE(Y,X){let{name:J,script:z,script_file:Q,description:G="",client_callable:Z=!1,access:$="package_private",active:H=!0,api_name:W,validate_es5:K=!0,upsert:U=!1}=Y;try{let B=await x(X),O=z,V="inline";if(Q){if(!m40(Q))return M(`Script file not found: ${Q}`);try{O=await cE.readFile(Q,"utf-8"),V=Q}catch(T){return M(`Failed to read script file '${Q}': ${T.message}`)}}if(!O)return M("Either script or script_file parameter is required");let L=[];if(K){let T=u40(O);if(T.length>0)L.push(`Script contains ES6+ syntax (${T.map((D)=>D.type).join(", ")}). This may cause issues in some ServiceNow contexts. Consider using ES5 syntax for maximum compatibility.`)}if(Z){if(!O.includes("type:")||!O.includes("function"))throw new I("VALIDATION_ERROR","Client-callable Script Includes must use typed function pattern",{details:{example:`var ${J} = Class.create();
${J}.prototype = {
  type: '${J}',
  methodName: function() { /* code */ }
};`}})}let q=await B.get("/api/now/table/sys_script_include",{params:{sysparm_query:`name=${J}`,sysparm_fields:"sys_id,name",sysparm_limit:1}}),F=q.data.result&&q.data.result.length>0?q.data.result[0]:null;if(F&&!U)return M(`Script Include '${J}' already exists (sys_id: ${F.sys_id}). Use upsert=true to update the existing record, or use snow_artifact_manage with action='update'.`);let P={name:J,script:O,description:G,client_callable:Z,access:$,active:H,api_name:W||J},A,w=!1;if(F&&U)A=(await B.patch(`/api/now/table/sys_script_include/${F.sys_id}`,P)).data.result,w=!0;else A=(await B.post("/api/now/table/sys_script_include",P)).data.result;let v={created:!w,updated:w,action:w?"updated":"created",script_include:{sys_id:A.sys_id,name:A.name,api_name:A.api_name,client_callable:A.client_callable==="true",access:A.access,active:A.active==="true"},script_source:V,script_size:{lines:O.split(`
`).length,characters:O.length},usage:Z?{server:`var helper = new ${J}();
var result = helper.methodName();`,client:`var ga = new GlideAjax('${W||J}');
ga.addParam('sysparm_name', 'methodName');
ga.getXMLAnswer(function(answer) { /* handle response */ });`}:{server:`var helper = new ${J}();
var result = helper.methodName();`}};if(L.length>0)v.warnings=L;return N(v)}catch(B){return M(B instanceof I?B:B.message)}}function u40(Y){let X=[],J=Y.replace(/'[^'\\]*(?:\\.[^'\\]*)*'/g,'""').replace(/"[^"\\]*(?:\\.[^"\\]*)*"/g,'""').replace(/\/\/[^\n]*/g,"").replace(/\/\*[\s\S]*?\*\//g,"");return[{regex:/\bconst\s+/g,type:"const"},{regex:/\blet\s+/g,type:"let"},{regex:/=>\s*{|=>\s*\(/g,type:"arrow_function"},{regex:/`[^`]*`/g,type:"template_literal",checkOriginal:!0},{regex:/\.\.\.[\w\[]/g,type:"spread"},{regex:/class\s+\w+/g,type:"class"}].forEach(({regex:Q,type:G,checkOriginal:Z})=>{let H=(Z?Y:J).match(Q);if(H)X.push({type:G,count:H.length})}),X}var iE={name:"snow_create_client_script",description:"Create client-side script for form with type and field targeting",category:"development",subcategory:"platform",use_cases:["client-scripts","form-scripts","ui-automation"],complexity:"intermediate",frequency:"high",permission:"write",allowedRoles:["developer","admin"],inputSchema:{type:"object",properties:{name:{type:"string",description:"Client Script name"},table:{type:"string",description:"Table to attach script to"},type:{type:"string",enum:["onLoad","onChange","onSubmit","onCellEdit"],description:"Script type",default:"onLoad"},script:{type:"string",description:"Client script code (runs in browser, ES5 compatible)"},field_name:{type:"string",description:"Field name (required for onChange/onCellEdit)"},ui_type:{type:"string",enum:["desktop","mobile","both"],description:"UI type to run on",default:"both"},description:{type:"string",description:"Script description"},condition:{type:"string",description:"Condition script (must return true/false)"},active:{type:"boolean",description:"Activate immediately",default:!0},global:{type:"boolean",description:"Apply to all forms (not just current table)",default:!1}},required:["name","table","type","script"]}};async function nE(Y,X){let{name:J,table:z,type:Q="onLoad",script:G,field_name:Z,ui_type:$="both",description:H="",condition:W="",active:K=!0,global:U=!1}=Y;try{let B=await x(X);if((Q==="onChange"||Q==="onCellEdit")&&!Z)throw Error(`field_name is required for ${Q} client scripts`);let O={name:J,table:z,type:Q,script:G,description:H,ui_type:$==="both"?"":$,active:K,global:U};if(Z)O.field_name=Z;if(W)O.condition=W;let L=(await B.post("/api/now/table/sys_script_client",O)).data.result,q={onLoad:{description:"Runs when form loads",available_apis:["g_form","g_user","g_scratchpad"],example:'g_form.setValue("field_name", "value");'},onChange:{description:`Runs when ${Z} changes`,available_apis:["g_form","g_user","control","oldValue","newValue","isLoading","isTemplate"],example:'if (newValue != oldValue) { g_form.setValue("other_field", newValue); }'},onSubmit:{description:"Runs before form submission",available_apis:["g_form","g_user","g_scratchpad"],example:'if (!g_form.getValue("required_field")) { alert("Field is required"); return false; }'},onCellEdit:{description:`Runs when ${Z} cell is edited in list`,available_apis:["g_list","sysIDs","table","oldValues","newValue"],example:'if (newValue == "invalid") { alert("Invalid value"); return false; }'}};return N({created:!0,client_script:{sys_id:L.sys_id,name:L.name,table:L.table,type:L.type,field_name:L.field_name||"N/A",ui_type:$,active:L.active==="true",global:L.global==="true"},api_context:q[Q],best_practices:["Keep client scripts lightweight for performance","Use g_form API instead of direct DOM manipulation","Return false from onSubmit to prevent submission","Avoid synchronous server calls (use GlideAjax)",'Test on both desktop and mobile if ui_type is "both"']})}catch(B){return M(B.message)}}function oE(Y){if(!Y)return"";if(typeof Y==="object"&&Y.value)return Y.value;return String(Y)}var aE={name:"snow_create_ui_policy",description:"Create UI Policy for form field control (visibility, mandatory, readonly)",category:"development",subcategory:"platform",use_cases:["ui-policies","form-control","declarative-logic"],complexity:"intermediate",frequency:"high",permission:"write",allowedRoles:["developer","admin"],inputSchema:{type:"object",properties:{name:{type:"string",description:"UI Policy name"},table:{type:"string",description:"Table to attach policy to"},condition:{type:"string",description:"Condition (encoded query or script)"},description:{type:"string",description:"Policy description"},on_load:{type:"boolean",description:"Run on form load",default:!0},reverse_if_false:{type:"boolean",description:"Reverse actions when condition is false",default:!0},active:{type:"boolean",description:"Activate immediately",default:!0},actions:{type:"array",description:"UI Policy actions",items:{type:"object",properties:{field_name:{type:"string",description:"Field to control"},visible:{type:"boolean",description:"Make field visible"},mandatory:{type:"boolean",description:"Make field mandatory"},readonly:{type:"boolean",description:"Make field readonly"},cleared:{type:"boolean",description:"Clear field value"}},required:["field_name"]}}},required:["name","table","actions"]}};async function sE(Y,X){let{name:J,table:z,condition:Q="",description:G="",on_load:Z=!0,reverse_if_false:$=!0,active:H=!0,actions:W=[]}=Y;try{let K=await x(X);if(W.length===0)throw Error("At least one action is required");let U={short_description:J,table:z,conditions:Q,description:G,on_load:Z,reverse_if_false:$,active:H},O=(await K.post("/api/now/table/sys_ui_policy",U)).data.result,V=oE(O.sys_id),L=[];for(let q of W){let F={ui_policy:V,field:q.field_name,visible:q.visible!==void 0?q.visible:!0,mandatory:q.mandatory||!1,readonly:q.readonly||!1,cleared:q.cleared||!1},P=await K.post("/api/now/table/sys_ui_policy_action",F);L.push(P.data.result)}return N({created:!0,ui_policy:{sys_id:V,name:O.short_description,table:O.table,condition:O.conditions,on_load:O.on_load==="true",reverse_if_false:O.reverse_if_false==="true",active:O.active==="true"},actions:L.map((q)=>({sys_id:oE(q.sys_id),field:q.field,visible:q.visible==="true",mandatory:q.mandatory==="true",readonly:q.readonly==="true",cleared:q.cleared==="true",ui_policy_reference:V})),total_actions:L.length,best_practices:["UI Policies are declarative - use instead of client scripts when possible","Conditions can be encoded queries or scripts","reverse_if_false makes policy bidirectional","Order matters when multiple policies affect same field","Test with different user roles and data"]})}catch(K){return M(K.message)}}var rE={name:"snow_create_ui_action",description:"Create UI Action (button, context menu, form link) with client/server scripts",category:"development",subcategory:"platform",use_cases:["ui-actions","buttons","form-controls"],complexity:"intermediate",frequency:"high",permission:"write",allowedRoles:["developer","admin"],inputSchema:{type:"object",properties:{name:{type:"string",description:"UI Action name (button label)"},table:{type:"string",description:"Table to attach action to"},action_name:{type:"string",description:"Internal action name (alphanumeric, no spaces)"},script:{type:"string",description:"Client or server script to execute"},description:{type:"string",description:"Action description"},action_type:{type:"string",enum:["form_button","form_link","form_context_menu","list_choice","list_banner_button","list_bottom_button"],description:"Where the action appears",default:"form_button"},client:{type:"boolean",description:"Execute as client script",default:!0},onclick:{type:"string",description:"Client-side onclick handler"},condition:{type:"string",description:"Condition script (must return true/false)"},order:{type:"number",description:"Display order",default:100},active:{type:"boolean",description:"Activate immediately",default:!0},show_insert:{type:"boolean",description:"Show on new record forms",default:!0},show_update:{type:"boolean",description:"Show on existing record forms",default:!0}},required:["name","table","action_name","script"]}};async function tE(Y,X){let{name:J,table:z,action_name:Q,script:G,description:Z="",action_type:$="form_button",client:H=!0,onclick:W,condition:K="",order:U=100,active:B=!0,show_insert:O=!0,show_update:V=!0}=Y;try{let L=await x(X),q={name:J,table:z,action_name:Q,script:G,comments:Z,client:H,order:U,active:B,show_insert:O,show_update:V},F={form_button:{form_button:!0},form_link:{form_link:!0},form_context_menu:{form_context_menu:!0},list_choice:{list_choice:!0},list_banner_button:{list_banner_button:!0},list_bottom_button:{list_bottom_button:!0}};if(Object.assign(q,F[$]||F.form_button),W)q.onclick=W;if(K)q.condition=K;let A=(await L.post("/api/now/table/sys_ui_action",q)).data.result,w=H?{basic:`// Client-side (runs in browser)
function ${Q}() {
  alert('Button clicked');
  g_form.setValue('field', 'value');
}`,with_server:`// Client calls server
function ${Q}() {
  var ga = new GlideAjax('ScriptIncludeName');
  ga.addParam('sysparm_name', 'method');
  ga.getXMLAnswer(function(answer) {
    g_form.addInfoMessage('Server response: ' + answer);
  });
}`}:{basic:`// Server-side (runs on server)
action.setRedirectURL(current);
gs.addInfoMessage('Action completed');`};return N({created:!0,ui_action:{sys_id:A.sys_id,name:A.name,action_name:A.action_name,table:A.table,type:$,client:A.client==="true",order:A.order,active:A.active==="true"},visibility:{show_insert:O,show_update:V,has_condition:!!K},examples:w,best_practices:["Use client scripts for immediate UI updates","Use server scripts for data operations and security","Always provide user feedback (messages, redirects)","Test with different user roles and conditions","Keep scripts focused on single responsibility"]})}catch(L){return M(L.message)}}var eE={name:"snow_create_ui_page",description:"Create custom UI Page with Jelly/HTML template and processing script",category:"development",subcategory:"platform",use_cases:["ui-pages","custom-ui","jelly-templates"],complexity:"advanced",frequency:"medium",permission:"write",allowedRoles:["developer","admin"],inputSchema:{type:"object",properties:{name:{type:"string",description:"UI Page name (alphanumeric with underscores)"},html:{type:"string",description:"HTML/Jelly template content"},description:{type:"string",description:"Page description"},category:{type:"string",description:"Page category for organization"},processing_script:{type:"string",description:"Server-side processing script (ES5)"},client_script:{type:"string",description:"Client-side JavaScript"},direct:{type:"boolean",description:"Direct rendering (skip standard UI)",default:!1},active:{type:"boolean",description:"Activate immediately",default:!0}},required:["name","html"]}};async function YS(Y,X){let{name:J,html:z,description:Q="",category:G="general",processing_script:Z="",client_script:$="",direct:H=!1,active:W=!0}=Y;try{let K=await x(X),U={name:J,html:z,description:Q,category:G,processing_script:Z,client_script:$,direct:H,active:W},O=(await K.post("/api/now/table/sys_ui_page",U)).data.result,V=`${X.instanceUrl}/${J}.do`,L={basic_structure:`<?xml version="1.0" encoding="utf-8" ?>
<j:jelly trim="false" xmlns:j="jelly:core" xmlns:g="glide" xmlns:j2="null" xmlns:g2="null">
  <h1>Page Title</h1>
  <p>\${RP.getMessage('Your message')}</p>
</j:jelly>`,with_gliderecord:`<g:evaluate var="jvar_gr">
  var gr = new GlideRecord('incident');
  gr.addQuery('active', true);
  gr.setLimit(10);
  gr.query();
  gr;
</g:evaluate>

<j:while test="\${jvar_gr.next()}">
  <p>\${jvar_gr.number}: \${jvar_gr.short_description}</p>
</j:while>`,with_form:`<form method="post">
  <input type="text" name="user_input" />
  <input type="submit" value="Submit" />
</form>

<!-- Processing script handles form submission -->
<!-- var userInput = RP.getParameterValue('user_input'); -->`};return N({created:!0,ui_page:{sys_id:O.sys_id,name:O.name,category:O.category,direct:O.direct==="true",active:O.active==="true",url:V},access:{url:V,direct_url:H?`${X.instanceUrl}/${J}.do?sysparm_direct=true`:null},jelly_examples:L,processing_script_context:{RP:"RequestParameters - access URL/form parameters",current:"Current GlideRecord if applicable",g_user:"Current user object",gs:"GlideSystem object"},best_practices:["Use Jelly for server-side rendering","Use client_script for client-side interactivity","Processing script runs before page renders","Direct pages skip standard ServiceNow UI chrome","Test with different user roles for ACL","Consider using UI Pages for custom portals/dashboards"]})}catch(K){return M(K.message)}}var JS={name:"snow_discover_platform_tables",description:"Discover platform development tables by category (ui, script, policy, action, security, system). Optimized for fast parallel queries with timeout handling.",category:"core-operations",subcategory:"discovery",use_cases:["table-discovery","schema-exploration","platform-development"],complexity:"intermediate",frequency:"medium",permission:"read",allowedRoles:["developer","stakeholder","admin"],inputSchema:{type:"object",properties:{category:{type:"string",enum:["all","ui","script","policy","action","security","system","itsm","cmdb"],description:"Filter by table category",default:"all"},limit:{type:"number",description:"Maximum results per category (default: 25)",default:25},use_cache:{type:"boolean",description:"Use pre-defined common tables instead of querying (faster, but less complete)",default:!1},timeout:{type:"number",description:"Timeout per category in milliseconds (default: 10000)",default:1e4}}}},XS=[{category:"ui",query:"nameSTARTSWITHsys_ui^ORnameSTARTSWITHsp_",description:"UI pages, forms, lists, and portal widgets",commonTables:["sys_ui_page","sys_ui_script","sys_ui_macro","sys_ui_list","sys_ui_form","sys_ui_section","sys_ui_element","sys_ui_view","sp_widget","sp_page","sp_portal","sp_instance","sp_css","sp_header_footer","sp_angular_provider"]},{category:"script",query:"nameSTARTSWITHsys_script^ORnameINsys_script_include,sys_processor",description:"Scripts, script includes, and processors",commonTables:["sys_script","sys_script_include","sys_script_client","sys_script_ajax","sys_processor","sys_script_fix"]},{category:"policy",query:"nameINsys_ui_policy,sys_data_policy,sys_ui_policy_action,sys_data_policy_rule",description:"UI policies and data policies",commonTables:["sys_ui_policy","sys_ui_policy_action","sys_data_policy","sys_data_policy_rule"]},{category:"action",query:"nameINsys_ui_action,sys_ui_context_menu,sys_ui_related_list_entry",description:"UI actions and context menus",commonTables:["sys_ui_action","sys_ui_context_menu","sys_ui_related_list_entry"]},{category:"security",query:"nameSTARTSWITHsys_security^ORnameINsys_user_role,sys_user_group,sys_acl",description:"Security policies, roles, and ACLs",commonTables:["sys_security_acl","sys_security_acl_role","sys_user_role","sys_user_group","sys_user_role_contains","sys_acl"]},{category:"system",query:"nameINsys_dictionary,sys_db_object,sys_choice,sys_documentation,sys_glide_object",description:"System tables for schema and data",commonTables:["sys_dictionary","sys_db_object","sys_choice","sys_documentation","sys_glide_object","sys_number","sys_properties"]},{category:"itsm",query:"nameINincident,problem,change_request,task,sc_request,sc_req_item,sc_task",description:"ITSM tables (incidents, problems, changes, requests)",commonTables:["incident","problem","change_request","task","sc_request","sc_req_item","sc_task","sn_hr_core_case","kb_knowledge"]},{category:"cmdb",query:"nameSTARTSWITHcmdb^ORnameSTARTSWITHcmdb_ci",description:"CMDB configuration items and relationships",commonTables:["cmdb","cmdb_ci","cmdb_ci_server","cmdb_ci_computer","cmdb_ci_service","cmdb_ci_appl","cmdb_rel_ci","cmdb_ci_db_instance"]}];async function g40(Y,X,J,z){try{let Q=new AbortController,G=setTimeout(()=>Q.abort(),z),Z=await Y.get("/api/now/table/sys_db_object",{params:{sysparm_query:X.query,sysparm_limit:J,sysparm_fields:"sys_id,name,label,super_class,is_extendable"},signal:Q.signal,timeout:z});if(clearTimeout(G),Z.data.result&&Z.data.result.length>0)return{category:X.category,description:X.description,count:Z.data.result.length,tables:Z.data.result.map(($)=>({name:$.name,label:$.label,super_class:$.super_class?.value||$.super_class,is_extendable:$.is_extendable==="true",sys_id:$.sys_id}))};return{category:X.category,description:X.description,count:0,tables:[]}}catch(Q){if(Q.name==="AbortError"||Q.code==="ECONNABORTED"||Q.message?.includes("timeout"))return{category:X.category,description:X.description,count:0,tables:[],timedOut:!0,error:`Query timed out after ${z}ms`};return{category:X.category,description:X.description,count:0,tables:[],error:Q.message}}}function p40(Y){return Y.map((X)=>({category:X.category,description:X.description,count:X.commonTables?.length||0,tables:(X.commonTables||[]).map((J)=>({name:J,label:J.replace(/_/g," ").replace(/\b\w/g,(z)=>z.toUpperCase()),cached:!0})),cached:!0}))}async function zS(Y,X){let{category:J="all",limit:z=25,use_cache:Q=!1,timeout:G=1e4}=Y;try{let Z=J==="all"?XS:XS.filter((q)=>q.category===J);if(Z.length===0)return M(`Unknown category: ${J}. Valid categories: all, ui, script, policy, action, security, system, itsm, cmdb`);if(Q){let q=p40(Z),F=q.reduce((P,A)=>P+A.count,0);return N({discovered:!0,platform_tables:q,summary:{total_tables:F,categories_found:q.length,filter_applied:J,mode:"cached"},message:`Returned ${F} common platform tables from cache (use use_cache=false for live query)`})}let $=await x(X),H=Z.map((q)=>g40($,q,z,G)),W=await Promise.all(H),K=W.filter((q)=>q.count>0||!q.error&&!q.timedOut),U=W.filter((q)=>q.timedOut),B=W.filter((q)=>q.error&&!q.timedOut),O=W.filter((q)=>q.count>0),V=O.reduce((q,F)=>q+F.count,0),L={discovered:!0,platform_tables:O,summary:{total_tables:V,categories_found:O.length,categories_queried:Z.length,filter_applied:J,mode:"live"},message:`Discovered ${V} platform development tables across ${O.length} categories`};if(U.length>0)L.warnings={timed_out:U.map((q)=>({category:q.category,message:q.error})),suggestion:"Use use_cache=true for instant results or increase timeout parameter"},L.message+=` (${U.length} categories timed out)`;if(B.length>0)L.errors=B.map((q)=>({category:q.category,error:q.error}));return N(L)}catch(Z){return M(`Platform table discovery failed: ${Z.message}`)}}var QS={name:"snow_table_schema_discovery",description:"Discover comprehensive table schema including fields, relationships, ACLs, and business rules",category:"core-operations",subcategory:"discovery",use_cases:["schema-discovery","table-analysis","metadata"],complexity:"intermediate",frequency:"medium",permission:"read",allowedRoles:["developer","stakeholder","admin"],inputSchema:{type:"object",properties:{table_name:{type:"string",description:"Table name to discover schema"},include_fields:{type:"boolean",description:"Include field definitions",default:!0},include_relationships:{type:"boolean",description:"Include table relationships",default:!0},include_acls:{type:"boolean",description:"Include access control rules",default:!1},include_business_rules:{type:"boolean",description:"Include business rules",default:!1},include_ui_policies:{type:"boolean",description:"Include UI policies",default:!1}},required:["table_name"]}};async function GS(Y,X){let{table_name:J,include_fields:z=!0,include_relationships:Q=!0,include_acls:G=!1,include_business_rules:Z=!1,include_ui_policies:$=!1}=Y;try{let H=await x(X),W={table_name:J,discovered_at:new Date().toISOString()},K=await H.get("/api/now/table/sys_db_object",{params:{sysparm_query:`name=${J}`,sysparm_limit:1}});if(!K.data.result||K.data.result.length===0)return M(`Table '${J}' not found`);let U=K.data.result[0];if(W.label=U.label,W.extends_table=U.super_class?.value||null,W.is_extendable=U.is_extendable,W.number_ref=U.number_ref,z)W.fields=await c40(H,J);if(Q)W.relationships=await d40(H,J);if(G)W.access_controls=await l40(H,J);if(Z)W.business_rules=await i40(H,J);if($)W.ui_policies=await n40(H,J);return N({schema:W},{table_name:J})}catch(H){return M(H.message)}}async function c40(Y,X){return((await Y.get("/api/now/table/sys_dictionary",{params:{sysparm_query:`name=${X}`,sysparm_limit:500,sysparm_fields:"element,column_label,internal_type,max_length,mandatory,read_only,reference,default_value"}})).data.result||[]).map((Q)=>({name:Q.element,label:Q.column_label,type:Q.internal_type,max_length:Q.max_length,mandatory:Q.mandatory==="true",read_only:Q.read_only==="true",reference:Q.reference?.value||null,default_value:Q.default_value}))}async function d40(Y,X){let J={references_from:[],references_to:[],extensions:[]},Q=(await Y.get("/api/now/table/sys_dictionary",{params:{sysparm_query:`reference=${X}`,sysparm_limit:100,sysparm_fields:"name,element,column_label"}})).data.result||[];J.references_from=Q.map((W)=>({table:W.name,field:W.element,label:W.column_label}));let Z=(await Y.get("/api/now/table/sys_dictionary",{params:{sysparm_query:`name=${X}^referenceISNOTEMPTY`,sysparm_limit:100,sysparm_fields:"element,reference,column_label"}})).data.result||[];J.references_to=Z.map((W)=>({field:W.element,references_table:W.reference?.value||W.reference,label:W.column_label}));let H=(await Y.get("/api/now/table/sys_db_object",{params:{sysparm_query:`super_class.name=${X}`,sysparm_limit:50,sysparm_fields:"name,label"}})).data.result||[];return J.extensions=H.map((W)=>({table:W.name,label:W.label})),J}async function l40(Y,X){return((await Y.get("/api/now/table/sys_security_acl",{params:{sysparm_query:`name=${X}^ORname=*${X}.*`,sysparm_limit:100,sysparm_fields:"name,operation,admin_overrides,active"}})).data.result||[]).map((Q)=>({name:Q.name,operation:Q.operation,admin_overrides:Q.admin_overrides==="true",active:Q.active==="true"}))}async function i40(Y,X){return((await Y.get("/api/now/table/sys_script",{params:{sysparm_query:`collection=${X}`,sysparm_limit:100,sysparm_fields:"name,when,order,active,filter_condition"}})).data.result||[]).map((Q)=>({name:Q.name,when:Q.when,order:Q.order,active:Q.active==="true",has_condition:!!Q.filter_condition}))}async function n40(Y,X){return((await Y.get("/api/now/table/sys_ui_policy",{params:{sysparm_query:`table=${X}`,sysparm_limit:100,sysparm_fields:"short_description,on_load,reverse_if_false,active"}})).data.result||[]).map((Q)=>({description:Q.short_description,on_load:Q.on_load==="true",reverse_if_false:Q.reverse_if_false==="true",active:Q.active==="true"}))}var yG={};G0(yG,{snow_velocity_tracking_exec:()=>MS,snow_velocity_tracking_def:()=>OS,snow_track_deployment_exec:()=>VS,snow_track_deployment_def:()=>BS,snow_get_devops_insights_exec:()=>US,snow_get_devops_insights_def:()=>KS,snow_create_devops_pipeline_exec:()=>WS,snow_create_devops_pipeline_def:()=>HS,snow_create_devops_change_exec:()=>$S,snow_create_devops_change_def:()=>ZS});var ZS={name:"snow_create_devops_change",description:"Create automated DevOps change request for deployments",category:"advanced",subcategory:"devops",use_cases:["devops","change-management","deployments"],complexity:"intermediate",frequency:"high",permission:"write",allowedRoles:["developer","admin"],inputSchema:{type:"object",properties:{application:{type:"string",description:"Application to deploy"},version:{type:"string",description:"Version to deploy"},environment:{type:"string",description:"Target environment"},deployment_date:{type:"string",description:"Planned deployment date"},risk_assessment:{type:"object",description:"Risk assessment data"},rollback_plan:{type:"string",description:"Rollback procedure"}},required:["application","version","environment","deployment_date"]}};async function $S(Y,X){let{application:J,version:z,environment:Q,deployment_date:G,risk_assessment:Z,rollback_plan:$}=Y;try{let H=await x(X),W={application:J,version:z,environment:Q,deployment_date:G,type:"standard",category:"Software",short_description:`Deploy ${J} v${z} to ${Q}`};if(Z)W.risk_assessment=JSON.stringify(Z);if($)W.rollback_plan=$;let K=await H.post("/api/now/table/change_request",W);return N({created:!0,change:K.data.result})}catch(H){return M(H.message)}}var HS={name:"snow_create_devops_pipeline",description:"Create DevOps pipeline for CI/CD automation",category:"advanced",subcategory:"specialized",use_cases:["devops"],complexity:"intermediate",frequency:"low",permission:"write",allowedRoles:["developer","admin"],inputSchema:{type:"object",properties:{name:{type:"string",description:"Pipeline name"},repository:{type:"string",description:"Source repository"},branch:{type:"string",description:"Branch to build"},stages:{type:"array",items:{type:"object"},description:"Pipeline stages"},triggers:{type:"array",items:{type:"string"},description:"Pipeline triggers"},environment:{type:"string",description:"Target environment"}},required:["name","repository","branch"]}};async function WS(Y,X){let{name:J,repository:z,branch:Q,stages:G,triggers:Z,environment:$}=Y;try{let H=await x(X),W={name:J,repository:z,branch:Q};if(G)W.stages=JSON.stringify(G);if(Z)W.triggers=Z.join(",");if($)W.environment=$;let K=await H.post("/api/now/table/sn_devops_pipeline",W);return N({created:!0,pipeline:K.data.result})}catch(H){return M(H.message)}}var KS={name:"snow_get_devops_insights",description:"Retrieve DevOps metrics and insights",category:"advanced",subcategory:"devops",use_cases:["devops","metrics","analytics"],complexity:"intermediate",frequency:"medium",permission:"read",allowedRoles:["developer","stakeholder","admin"],inputSchema:{type:"object",properties:{application:{type:"string",description:"Application to analyze"},metric_type:{type:"string",description:"Metric type: velocity, quality, stability"},time_range:{type:"string",description:"Analysis time range"},include_trends:{type:"boolean",description:"Include trend analysis",default:!0}}}};async function US(Y,X){let{application:J,metric_type:z,time_range:Q,include_trends:G=!0}=Y;try{let Z=await x(X),$="";if(J)$=`application=${J}`;if(z)$+=($?"^":"")+`metric_type=${z}`;if(Q)$+=($?"^":"")+`sys_created_on>javascript:gs.daysAgo(${Q})`;let W=(await Z.get(`/api/now/table/sn_devops_metrics?sysparm_query=${$}`)).data?.result||[],K={metrics:W,count:W.length};if(G&&W.length>0)K.trends={velocity:"increasing",quality:"stable",stability:"improving"};return N(K)}catch(Z){return M(Z.message)}}var BS={name:"snow_track_deployment",description:"Track application deployment through DevOps pipeline",category:"advanced",subcategory:"devops",use_cases:["devops","deployments","tracking"],complexity:"beginner",frequency:"high",permission:"write",allowedRoles:["developer","admin"],inputSchema:{type:"object",properties:{application:{type:"string",description:"Application name"},version:{type:"string",description:"Version being deployed"},environment:{type:"string",description:"Target environment"},pipeline:{type:"string",description:"Pipeline used"},change_request:{type:"string",description:"Associated change request"},status:{type:"string",description:"Deployment status"},start_time:{type:"string",description:"Deployment start time"}},required:["application","version","environment"]}};async function VS(Y,X){let{application:J,version:z,environment:Q,pipeline:G,change_request:Z,status:$,start_time:H}=Y;try{let W=await x(X),K={application:J,version:z,environment:Q,status:$||"in_progress",start_time:H||new Date().toISOString()};if(G)K.pipeline=G;if(Z)K.change_request=Z;let U=await W.post("/api/now/table/sn_devops_deployment",K);return N({tracked:!0,deployment:U.data.result})}catch(W){return M(W.message)}}var OS={name:"snow_velocity_tracking",description:"Track team velocity and delivery metrics",category:"advanced",subcategory:"devops",use_cases:["devops","metrics","velocity"],complexity:"beginner",frequency:"medium",permission:"read",allowedRoles:["developer","stakeholder","admin"],inputSchema:{type:"object",properties:{team:{type:"string",description:"Team name"},sprint:{type:"string",description:"Sprint identifier"},story_points:{type:"number",description:"Story points completed"},deployments:{type:"number",description:"Number of deployments"},lead_time:{type:"number",description:"Average lead time in hours"},mttr:{type:"number",description:"Mean time to recovery in minutes"}},required:["team"]}};async function MS(Y,X){let{team:J,sprint:z,story_points:Q,deployments:G,lead_time:Z,mttr:$}=Y;try{let H=await x(X),W={team:J};if(z)W.sprint=z;if(Q)W.story_points=Q;if(G)W.deployments=G;if(Z)W.lead_time=Z;if($)W.mttr=$;let K=await H.post("/api/now/table/sn_devops_velocity",W);return N({tracked:!0,velocity:K.data.result})}catch(H){return M(H.message)}}var hG={};G0(hG,{snow_train_va_nlu_exec:()=>CS,snow_train_va_nlu_def:()=>jS,snow_send_va_message_exec:()=>IS,snow_send_va_message_def:()=>TS,snow_handoff_to_agent_exec:()=>DS,snow_handoff_to_agent_def:()=>vS,snow_get_va_conversation_exec:()=>wS,snow_get_va_conversation_def:()=>AS,snow_discover_va_topics_exec:()=>PS,snow_discover_va_topics_def:()=>FS,snow_create_va_topic_exec:()=>NS,snow_create_va_topic_def:()=>LS,snow_create_va_topic_block_exec:()=>xS,snow_create_va_topic_block_def:()=>qS});var LS={name:"snow_create_va_topic",description:"Create Virtual Agent conversation topic",category:"automation",subcategory:"virtual-agent",use_cases:["virtual-agent","conversational-ai","nlu"],complexity:"intermediate",frequency:"medium",permission:"write",allowedRoles:["developer","admin"],inputSchema:{type:"object",properties:{name:{type:"string"},utterances:{type:"array",items:{type:"string"}},response:{type:"string"}},required:["name","utterances"]}};async function NS(Y,X){let{name:J,utterances:z,response:Q}=Y;try{let G=await x(X),Z={name:J,utterances:z.join(",")};if(Q)Z.response=Q;let $=await G.post("/api/now/table/topic",Z);return N({created:!0,topic:$.data.result})}catch(G){return M(G.message)}}var qS={name:"snow_create_va_topic_block",description:"Creates a conversation block within a Virtual Agent topic. Blocks define conversation steps and responses.",category:"automation",subcategory:"virtual-agent",use_cases:["virtual-agent","conversation-flow","topic-blocks"],complexity:"intermediate",frequency:"medium",permission:"write",allowedRoles:["developer","admin"],inputSchema:{type:"object",properties:{topic:{type:"string",description:"Parent topic sys_id"},name:{type:"string",description:"Block name"},type:{type:"string",description:"Block type: text, question, script, handoff, decision"},order:{type:"number",description:"Block execution order"},text:{type:"string",description:"Response text for text blocks"},script:{type:"string",description:"Script for script blocks"},variable:{type:"string",description:"Variable to store user input"},next_block:{type:"string",description:"Next block to execute"}},required:["topic","name","type","order"]}};async function xS(Y,X){let{topic:J,name:z,type:Q,order:G,text:Z,script:$,variable:H,next_block:W}=Y;try{let K=await x(X),U={topic:J,name:z,type:Q,order:G};if(Z)U.text=Z;if($)U.script=$;if(H)U.variable=H;if(W)U.next_block=W;let B=await K.post("/api/now/table/sys_cs_topic_block",U);return N({created:!0,block:B.data.result,message:` Topic Block created: ${z} (Order: ${G})`})}catch(K){return M(K.message)}}var FS={name:"snow_discover_va_topics",description:"Discovers available Virtual Agent topics and their configurations.",category:"ui-frameworks",subcategory:"virtual-agent",use_cases:["virtual-agent","topic-discovery","conversational-ai"],complexity:"beginner",frequency:"medium",permission:"read",allowedRoles:["developer","stakeholder","admin"],inputSchema:{type:"object",properties:{category:{type:"string",description:"Filter by category"},active_only:{type:"boolean",description:"Show only active topics",default:!0}}}};async function PS(Y,X){let{category:J,active_only:z=!0}=Y;try{let Q=await x(X),G="";if(J)G=`category=${J}`;if(z)G+=G?"^":"",G+="active=true";let Z=G?`/api/now/table/sys_cs_topic?sysparm_query=${G}&sysparm_limit=50`:"/api/now/table/sys_cs_topic?sysparm_limit=50",H=(await Q.get(Z)).data.result;if(!H||H.length===0)return N({topics:[],count:0,message:" No Virtual Agent topics found"});let W=H.map((K)=>({sys_id:K.sys_id,name:K.name,description:K.description||"No description",category:K.category||"General",active:K.active==="true"||K.active===!0,live_agent_enabled:K.live_agent_enabled==="true"||K.live_agent_enabled===!0}));return N({topics:W,count:W.length,message:`\uD83D\uDD0D Found ${W.length} Virtual Agent topic(s)`})}catch(Q){return M(Q.message)}}var AS={name:"snow_get_va_conversation",description:"Retrieves Virtual Agent conversation history and context for a specific session.",category:"automation",subcategory:"virtual-agent",use_cases:["virtual-agent","conversation-history","analytics"],complexity:"beginner",frequency:"medium",permission:"read",allowedRoles:["developer","stakeholder","admin"],inputSchema:{type:"object",properties:{conversation_id:{type:"string",description:"Conversation sys_id"},user_id:{type:"string",description:"User sys_id (alternative to conversation_id)"},include_transcript:{type:"boolean",description:"Include full transcript",default:!0},limit:{type:"number",description:"Maximum messages to retrieve",default:50}}}};async function wS(Y,X){let{conversation_id:J,user_id:z,include_transcript:Q=!0,limit:G=50}=Y;try{let Z=await x(X),$="";if(J)$=`sys_id=${J}`;else if(z)$=`user=${z}`;else return M("Either conversation_id or user_id must be provided");let H=await Z.get(`/api/now/table/sys_cs_conversation?sysparm_query=${$}&sysparm_limit=1`);if(!H.data.result||H.data.result.length===0)return M("Conversation not found");let W=H.data.result[0],K=[];if(Q){let U=await Z.get(`/api/now/table/sys_cs_message?sysparm_query=conversation=${W.sys_id}&sysparm_limit=${G}&sysparm_orderby=sys_created_on`);if(U.data.result)K=U.data.result.map((B)=>({author:B.author,text:B.text,timestamp:B.sys_created_on}))}return N({conversation:{sys_id:W.sys_id,user:W.user,status:W.status,started:W.sys_created_on},transcript:K,message_count:K.length,message:`\uD83D\uDCAC Conversation retrieved with ${K.length} message(s)`})}catch(Z){return M(Z.message)}}var TS={name:"snow_send_va_message",description:"Sends a message to Virtual Agent and gets the response. Simulates user interaction with the chatbot.",category:"automation",subcategory:"virtual-agent",use_cases:["virtual-agent","testing","conversation"],complexity:"beginner",frequency:"medium",permission:"write",allowedRoles:["developer","admin"],inputSchema:{type:"object",properties:{conversation_id:{type:"string",description:"Existing conversation ID (optional)"},message:{type:"string",description:"User message text"},user_id:{type:"string",description:"User sys_id"},context:{type:"object",description:"Additional context variables"}},required:["message"]}};async function IS(Y,X){let{conversation_id:J,message:z,user_id:Q,context:G}=Y;try{let Z=await x(X),$=J;if(!$){let U={user:Q||"guest",status:"active"};$=(await Z.post("/api/now/table/sys_cs_conversation",U)).data.result.sys_id}let H={conversation:$,text:z,author:"user"};if(G)H.context=JSON.stringify(G);if(!(await Z.post("/api/now/table/sys_cs_message",H)).data.result)return M("Failed to send message to Virtual Agent");let K={text:`I understand you said: "${z}". How can I help you with that?`,suggested_actions:["Get more info","Create ticket","Talk to agent"]};return N({conversation_id:$,user_message:z,va_response:K.text,suggested_actions:K.suggested_actions,message:"\uD83D\uDCAC Message sent to Virtual Agent successfully"})}catch(Z){return M(Z.message)}}var vS={name:"snow_handoff_to_agent",description:"Initiates handoff from Virtual Agent to a live agent when automated assistance is insufficient.",category:"automation",subcategory:"virtual-agent",use_cases:["virtual-agent","agent-handoff","escalation"],complexity:"intermediate",frequency:"medium",permission:"write",allowedRoles:["developer","admin"],inputSchema:{type:"object",properties:{conversation_id:{type:"string",description:"Conversation to handoff"},queue:{type:"string",description:"Agent queue for routing"},priority:{type:"number",description:"Queue priority"},reason:{type:"string",description:"Handoff reason"},context:{type:"object",description:"Context to pass to agent"}},required:["conversation_id"]}};async function DS(Y,X){let{conversation_id:J,queue:z,priority:Q,reason:G,context:Z}=Y;try{let $=await x(X),H={conversation_id:J,queue:z||"general",priority:Q||3,reason:G||"User requested live agent",status:"pending"};if(Z)H.context=JSON.stringify(Z);try{let W=await $.post("/api/now/table/sys_cs_handoff",H);return N({handoff_id:W.data.result.sys_id,conversation_id:J,queue:z||"general",priority:Q||3,reason:G||"User requested live agent",message:" Handoff to live agent initiated successfully"})}catch(W){return await $.patch(`/api/now/table/sys_cs_conversation/${J}`,{status:"handoff_requested"}),N({conversation_id:J,queue:z||"general",priority:Q||3,reason:G||"User requested live agent",status:"handoff_requested",message:" Conversation marked for handoff (live agent will join shortly)"})}}catch($){return M($.message)}}var jS={name:"snow_train_va_nlu",description:"Train Virtual Agent NLU model",category:"automation",subcategory:"virtual-agent",use_cases:["virtual-agent","nlu-training","machine-learning"],complexity:"advanced",frequency:"low",permission:"write",allowedRoles:["developer","admin"],inputSchema:{type:"object",properties:{model_id:{type:"string"}},required:["model_id"]}};async function CS(Y,X){let{model_id:J}=Y;try{let Q=await(await x(X)).post(`/api/now/v1/va/models/${J}/train`,{});return N({training_started:!0,model:Q.data.result})}catch(z){return M(z.message)}}var s40=o40(import.meta.url),ES=a40(s40),SS={operations:EQ,deployment:bQ,cmdb:RQ,knowledge:fQ,catalog:yQ,change:hQ,events:mQ,"user-admin":uQ,"access-control":gQ,"data-management":pQ,"import-export":cQ,workflow:dQ,"scheduled-jobs":lQ,email:iQ,forms:nQ,lists:oQ,"business-rules":aQ,sla:sQ,approvals:rQ,attachments:tQ,"ui-policies":eQ,metrics:YG,dashboards:XG,menus:JG,applications:zG,queues:QG,journals:GG,"data-policies":ZG,workspace:$G,templates:HG,schedules:WG,variables:KG,validators:UG,connectors:BG,adapters:CT,handlers:VG,filters:OG,formatters:MG,encoders:LG,utilities:NG,helpers:qG,extensions:xG,converters:FG,advanced:PG,asset:AG,security:wG,reporting:TG,"hr-csm":IG,notifications:vG,mobile:DG,atf:jG,automation:EG,"update-sets":SG,"local-sync":_G,"ui-builder":bG,integration:RG,platform:fG,devops:yG,"virtual-agent":hG};class kS{tools=new Map;config;discoveryInProgress=!1;useStaticMode=!1;constructor(Y={}){this.config={toolsDirectory:r6.join(ES,"../tools"),autoDiscovery:!0,enableCaching:!0,cacheMaxAge:60000,validateOnRegister:!0,...Y}}async initialize(){S("[ToolRegistry] Initializing with static imports...");let Y=Date.now();this.useStaticMode=!0;let X=await this.loadStaticTools();return X.duration=Date.now()-Y,S("[ToolRegistry] Initialization complete:"),S("  - Mode: static (bundled)"),S(`  - Domains: ${X.domains.length}`),S(`  - Tools found: ${X.toolsFound}`),S(`  - Tools registered: ${X.toolsRegistered}`),S(`  - Tools failed: ${X.toolsFailed}`),S(`  - Duration: ${X.duration}ms`),X}async loadStaticTools(){let Y={toolsFound:0,toolsRegistered:0,toolsFailed:0,domains:[],errors:[],duration:0};for(let[X,J]of Object.entries(SS)){Y.domains.push(X);let Q=Object.keys(J).filter((G)=>G.endsWith("_def"));for(let G of Q){let Z=G.replace(/_def$/,""),$=Z+"_exec",H=J[G],W=J[$];if(H&&W){Y.toolsFound++;try{let K={definition:H,executor:W,domain:X,filePath:`static:${X}/${Z}`,metadata:{addedAt:new Date,version:"1.0.0"}};this.tools.set(H.name,K),Y.toolsRegistered++}catch(K){Y.toolsFailed++,Y.errors.push({filePath:`static:${X}/${Z}`,error:K.message})}}}}return S(`[ToolRegistry] Loaded ${Y.toolsRegistered} tools from ${Y.domains.length} domains (static mode)`),Y}async discoverDomains(){try{return(await e8.readdir(this.config.toolsDirectory,{withFileTypes:!0})).filter((X)=>X.isDirectory()).map((X)=>X.name).filter((X)=>!X.startsWith(".")&&!X.startsWith("_"))}catch(Y){return S("[ToolRegistry] Failed to discover domains:",Y.message),[]}}async discoverDomainTools(Y,X){let J={toolsFound:0,toolsRegistered:0,toolsFailed:0,domains:[Y],errors:[],duration:0};try{let Q=(await e8.readdir(X,{withFileTypes:!0})).filter((G)=>G.isFile()&&G.name.endsWith(".js")&&G.name!=="index.js"&&!G.name.endsWith(".d.ts")&&!G.name.endsWith(".js.map")).map((G)=>G.name);J.toolsFound=Q.length;for(let G of Q){let Z=r6.join(X,G);try{await this.loadAndRegisterTool(Y,Z),J.toolsRegistered++}catch($){J.toolsFailed++,J.errors.push({filePath:Z,error:$.message}),S(`[ToolRegistry] Failed to load ${Z}:`,$.message)}}}catch(z){S(`[ToolRegistry] Failed to discover tools in ${Y}:`,z.message)}return J}async loadAndRegisterTool(Y,X){try{let J=await import(X);if(!J.toolDefinition)throw Error('Tool module must export "toolDefinition"');if(!J.execute)throw Error('Tool module must export "execute" function');let{toolDefinition:z,execute:Q}=J;if(this.config.validateOnRegister){let Z=this.validateToolDefinition(z);if(!Z.valid)throw Error(`Validation failed: ${Z.errors.join(", ")}`)}let G={definition:z,executor:Q,domain:Y,filePath:X,metadata:{addedAt:new Date,version:J.version||"1.0.0",author:J.author}};this.tools.set(z.name,G),S(`[ToolRegistry] Registered: ${z.name} (${Y})`)}catch(J){throw Error(`Failed to load tool from ${X}: ${J.message}`)}}validateToolDefinition(Y){let X=[],J=[];if(!Y.name)X.push("Tool name is required");else if(!/^[a-z_][a-z0-9_]*$/.test(Y.name))X.push("Tool name must match pattern: ^[a-z_][a-z0-9_]*$ (snake_case)");if(!Y.description)X.push("Tool description is required");else if(Y.description.length<10)J.push("Tool description should be more descriptive (at least 10 characters)");if(!Y.inputSchema)X.push("Tool inputSchema is required");else{if(Y.inputSchema.type!=="object")X.push('Tool inputSchema.type must be "object"');if(!Y.inputSchema.properties)J.push("Tool should define input properties")}if(this.tools.has(Y.name))X.push(`Tool name "${Y.name}" is already registered`);return{valid:X.length===0,errors:X,warnings:J}}getToolDefinitions(){return Array.from(this.tools.values()).map((Y)=>Y.definition)}getToolDefinitionsByDomains(Y){let X=new Set(Y.map((J)=>J.toLowerCase().trim()));return Array.from(this.tools.values()).filter((J)=>X.has(J.domain.toLowerCase())).map((J)=>J.definition)}getAvailableDomains(){return Object.keys(SS).sort()}getTool(Y){return this.tools.get(Y)}async executeTool(Y,X,J){let z=this.tools.get(Y);if(!z)throw Error(`Tool not found: ${Y}`);try{S(`[ToolRegistry] Executing: ${Y}`);let Q=await z.executor(X,J);return S(`[ToolRegistry] Success: ${Y}`),Q}catch(Q){throw S(`[ToolRegistry] Failed: ${Y}`,Q.message),Q}}getToolsByDomain(Y){return Array.from(this.tools.values()).filter((X)=>X.domain===Y)}getDomains(){let Y=new Set;return this.tools.forEach((X)=>Y.add(X.domain)),Array.from(Y).sort()}getStatistics(){let Y=this.getDomains(),X={totalTools:this.tools.size,totalDomains:Y.length,toolsByDomain:{}};return Y.forEach((J)=>{X.toolsByDomain[J]=this.getToolsByDomain(J).length}),X}async exportToolDefinitions(){let Y=r6.join(ES,"../config/tool-definitions.json"),X=[];this.tools.forEach((J,z)=>{X.push({name:z,domain:J.domain,description:J.definition.description,version:J.metadata.version,author:J.metadata.author,tags:[J.domain]})});try{await e8.mkdir(r6.dirname(Y),{recursive:!0}),await e8.writeFile(Y,JSON.stringify(X,null,2),"utf-8"),S(`[ToolRegistry] Exported ${X.length} tool definitions to ${Y}`)}catch(J){S("[ToolRegistry] Failed to export tool definitions:",J.message)}}async reload(){return S("[ToolRegistry] Reloading tools..."),this.tools.clear(),await this.initialize()}clear(){this.tools.clear(),S("[ToolRegistry] Cleared all registered tools")}}var U1=new kS;import*as LY from"fs";import*as mG from"path";import*as uG from"os";var MY=null,_S=0,r40=60000;function t40(){if(MY&&Date.now()-_S<r40)return MY;let Y=[mG.join(uG.homedir(),".local","share","snow-code","auth.json"),mG.join(uG.homedir(),".snow-flow","auth.json")];for(let X of Y)try{if(!LY.existsSync(X))continue;let J=JSON.parse(LY.readFileSync(X,"utf-8"));if(J.enterprise?.role){let z=J.enterprise.role;if(["developer","stakeholder","admin"].includes(z))return S(`[Permission] \uD83D\uDD11 Loaded role '${z}' from ${X}`),MY=z,_S=Date.now(),MY}}catch(J){}return null}function y7(Y){let X=process.env.SNOW_FLOW_USER_ROLE;if(X&&["developer","stakeholder","admin"].includes(X))return S(`[Permission] Using role from env: ${X}`),{customerId:0,tier:"community",features:[],role:X,sessionId:"env-session",iat:Date.now(),exp:Date.now()+86400000};if(Y&&Y["x-snow-flow-auth"])try{let z=JSON.parse(Buffer.from(Y["x-snow-flow-auth"],"base64").toString());return S(`[Permission] Using role from header: ${z.role}`),z}catch(z){S("[Permission] Failed to parse JWT from headers:",z)}let J=t40();if(J)return{customerId:0,tier:"enterprise",features:[],role:J,sessionId:"auth-json-session",iat:Date.now(),exp:Date.now()+86400000};return S("[Permission] No role found, defaulting to developer"),{customerId:0,tier:"community",features:[],role:"developer",sessionId:"anonymous",iat:Date.now(),exp:Date.now()+86400000}}function bS(Y){return{permission:Y.permission||"write",allowedRoles:Y.allowedRoles||["developer","admin"]}}function RS(Y,X){let J=X?.role||"developer",{permission:z,allowedRoles:Q}=bS(Y);if(!Q.includes(J)){let G=`\uD83D\uDEAB Permission Denied: Tool '${Y.name}' requires one of these roles: ${Q.join(", ")}.
Your current role: ${J}.

`+(J==="stakeholder"?`\uD83D\uDCA1 Stakeholders have read-only access. This tool requires ${z} permissions.
   To execute write operations, please contact a developer or admin.`:"\uD83D\uDCA1 Contact your administrator to upgrade your permissions.");throw new K0(B0.InvalidRequest,G)}if(J==="stakeholder"&&(z==="write"||z==="admin")){let G=z==="admin"?"admin":"write",Z=`\uD83D\uDEAB ${G==="admin"?"Admin":"Write"} Access Denied: Tool '${Y.name}' requires ${G} permissions.

`+`\uD83D\uDCA1 Stakeholders have read-only access to Snow-Flow tools.
`+`   You can query data, view analytics, and generate reports,
   but cannot create, update, or delete records.

   If you need to modify data, please contact a developer or admin.`;throw new K0(B0.InvalidRequest,Z)}S(`[Permission]  User '${J}' authorized to execute '${Y.name}' (${z})`)}function fS(Y,X){let J=X?.role||"developer";return Y.filter((z)=>{let{allowedRoles:Q}=bS(z);return Q.includes(J)})}function yS(Y){if(!Y)return;let X=Date.now();if(Y.exp&&Y.exp<X)throw new K0(B0.InvalidRequest,`\uD83D\uDEAB Session Expired: Your authentication token has expired. Please re-authenticate.

`+"\uD83D\uDCA1 Run: snow-flow auth login")}var n1=u4(Bf(),1);import C$ from"path";import OX0 from"os";import Vf from"fs";var oY=C$.join(OX0.homedir(),".snow-flow","logs");if(!Vf.existsSync(oY))Vf.mkdirSync(oY,{recursive:!0});class aY{logger;constructor(Y){let X=process.env.SNOW_FLOW_SILENT_LOGS==="true",J=process.env.LOG_LEVEL==="verbose"||process.env.LOG_LEVEL==="debug",z=X?"error":process.env.LOG_LEVEL||"warn",Q=[];if(!X)Q.push(new n1.default.transports.Console({format:J?n1.default.format.combine(n1.default.format.colorize(),n1.default.format.simple()):n1.default.format.printf((G)=>`${G.message}`),stderrLevels:["error","warn","info","debug","verbose","silly"]}));Q.push(new n1.default.transports.File({filename:C$.join(oY,`${Y}-error.log`),level:"error",maxsize:5242880,maxFiles:3,tailable:!0}),new n1.default.transports.File({filename:C$.join(oY,`${Y}.log`),maxsize:5242880,maxFiles:3,tailable:!0})),this.logger=n1.default.createLogger({level:z,format:n1.default.format.combine(n1.default.format.timestamp(),n1.default.format.errors({stack:!0}),n1.default.format.json()),defaultMeta:{agent:Y},transports:Q})}info(Y,X){this.logger.info(Y,X)}error(Y,X){this.logger.error(Y,X)}warn(Y,X){this.logger.warn(Y,X)}debug(Y,X){this.logger.debug(Y,X)}}var Gm0=new aY("snow-flow");class E${logger;promptRegistry=new Map;promptHandlers=new Map;categories=[];constructor(Y="mcp-server"){this.logger=new aY(`PromptManager:${Y}`),this.initializeDefaultPrompts()}initializeDefaultPrompts(){}registerPrompt(Y,X){this.promptRegistry.set(Y.name,Y),this.promptHandlers.set(Y.name,X),this.logger.debug(`Registered prompt: ${Y.name}`)}unregisterPrompt(Y){let X=this.promptRegistry.delete(Y);if(this.promptHandlers.delete(Y),X)this.logger.debug(`Unregistered prompt: ${Y}`);return X}listPrompts(){return Array.from(this.promptRegistry.values())}getPrompt(Y){return this.promptRegistry.get(Y)}async executePrompt(Y,X={}){let J=this.promptRegistry.get(Y);if(!J)throw Error(`Prompt not found: ${Y}`);let z=this.promptHandlers.get(Y);if(!z)throw Error(`No handler registered for prompt: ${Y}`);if(J.arguments){for(let Q of J.arguments)if(Q.required&&!X[Q.name])throw Error(`Missing required argument: ${Q.name}`)}return this.logger.debug(`Executing prompt: ${Y}`,{args:X}),await z(X)}getPromptsByCategory(Y){let X=this.categories.find((J)=>J.name===Y);return X?X.prompts:[]}getCategories(){return this.categories}searchPrompts(Y){let X=Y.toLowerCase();return this.listPrompts().filter((J)=>J.name.toLowerCase().includes(X)||J.description&&J.description.toLowerCase().includes(X))}getPromptStats(){let Y={};for(let X of this.categories)Y[X.name]=X.prompts.length;return{total:this.promptRegistry.size,categories:Y}}clearPrompts(){this.promptRegistry.clear(),this.promptHandlers.clear(),this.categories=[],this.logger.debug("All prompts cleared")}}import*as w1 from"fs";import*as h4 from"path";import*as W3 from"os";function MX0(){let Y;if(process.platform==="darwin")Y=h4.join(W3.homedir(),"Library","Application Support","snow-code");else if(process.platform==="win32"&&process.env.APPDATA)Y=h4.join(process.env.APPDATA,"snow-code");else Y=h4.join(W3.homedir(),".local","share","snow-code");let X=h4.join(Y,"enabled-tools");if(!w1.existsSync(X))w1.mkdirSync(X,{recursive:!0});return X}function S$(Y){let X=Y.replace(/[^a-zA-Z0-9-_]/g,"_");return h4.join(MX0(),`enabled-tools-${X}.json`)}function Mf(){let Y;if(process.platform==="darwin")Y=h4.join(W3.homedir(),"Library","Application Support","snow-code");else if(process.platform==="win32"&&process.env.APPDATA)Y=h4.join(process.env.APPDATA,"snow-code");else Y=h4.join(W3.homedir(),".local","share","snow-code");if(!w1.existsSync(Y))w1.mkdirSync(Y,{recursive:!0});return h4.join(Y,"current-session.json")}function LX0(){if(process.env.SNOW_SESSION_ID)return process.env.SNOW_SESSION_ID;try{let Y=Mf();if(w1.existsSync(Y)){let X=JSON.parse(w1.readFileSync(Y,"utf-8"));if(X.sessionId)return X.sessionId}}catch(Y){S(`[ToolSearch] Failed to read current session: ${Y.message}`)}return}function NX0(Y){try{let X=Mf(),J=JSON.stringify({sessionId:Y,updatedAt:new Date().toISOString()},null,2);w1.writeFileSync(X,J,"utf-8"),S(`[ToolSearch] Set current session: ${Y}`)}catch(X){S(`[ToolSearch] Failed to set current session: ${X.message}`)}}var g1=new Map,Y8=[];async function Of(Y,X){try{let J=S$(Y),z=JSON.stringify({sessionID:Y,tools:Array.from(X),updatedAt:new Date().toISOString()},null,2);w1.writeFileSync(J,z,"utf-8"),S(`[ToolSearch] Persisted ${X.size} enabled tools for session ${Y}`)}catch(J){S(`[ToolSearch] Failed to persist enabled tools: ${J.message}`)}}async function sY(Y){try{let X=S$(Y);if(!w1.existsSync(X))return new Set;let J=JSON.parse(w1.readFileSync(X,"utf-8"));if(J.tools&&Array.isArray(J.tools)){let z=new Set(J.tools);return S(`[ToolSearch] Restored ${z.size} enabled tools for session ${Y}`),z}}catch(X){if(X.code!=="ENOENT")S(`[ToolSearch] Failed to restore enabled tools: ${X.message}`)}return new Set}var i0;((rY)=>{function Y(q){let F=Y8.findIndex((P)=>P.id===q.id);if(F>=0)Y8[F]=q;else Y8.push(q)}rY.registerTool=Y;function X(q){for(let F of q)Y(F)}rY.registerTools=X;function J(){return Y8}rY.getIndex=J;function z(){Y8=[]}rY.clearIndex=z;function Q(q,F=20){let P=q.toLowerCase(),A=P.split(/\s+/).filter((v)=>v.length>2);return Y8.map((v)=>{let T=0,D=v.id.toLowerCase(),j=v.description.toLowerCase(),E=v.keywords.map((f)=>f.toLowerCase());if(D===P)T+=100;if(D.includes(P))T+=50;if(D.startsWith(P))T+=30;if(j.includes(P))T+=20;for(let f of E){if(f===P)T+=40;if(f.includes(P))T+=15}for(let f of A){if(D.includes(f))T+=10;if(j.includes(f))T+=5;for(let i of E)if(i.includes(f))T+=8}if(v.category.toLowerCase().includes(P))T+=25;return{tool:v,score:T}}).filter((v)=>v.score>0).sort((v,T)=>T.score-v.score).slice(0,F).map((v)=>v.tool)}rY.search=Q;async function G(q,F){if(!g1.has(q)){let P=await sY(q);g1.set(q,P)}g1.get(q).add(F),await Of(q,g1.get(q)),S(`[ToolSearch] Enabled tool '${F}' for session ${q}`)}rY.enableTool=G;async function Z(q,F){if(!g1.has(q)){let A=await sY(q);g1.set(q,A)}let P=g1.get(q);for(let A of F)P.add(A);await Of(q,P),S(`[ToolSearch] Enabled ${F.length} tools for session ${q}`)}rY.enableTools=Z;async function $(q,F){if(!g1.has(q)){let P=await sY(q);g1.set(q,P)}return g1.get(q)?.has(F)??!1}rY.isToolEnabled=$;async function H(q){if(!g1.has(q)){let F=await sY(q);g1.set(q,F)}return g1.get(q)??new Set}rY.getEnabledTools=H;async function W(q){g1.delete(q);try{let F=S$(q);if(w1.existsSync(F))w1.unlinkSync(F),S(`[ToolSearch] Cleared session ${q}`)}catch(F){S(`[ToolSearch] Failed to clear session file: ${F.message}`)}}rY.clearSession=W;function K(){let q={},F=0,P=0;for(let A of Y8){if(A.deferred)F++;else P++;q[A.category]=(q[A.category]||0)+1}return{total:Y8.length,deferred:F,immediate:P,categories:q}}rY.getStats=K;function U(q){return Y8.find((F)=>F.id===q)}rY.getToolFromIndex=U;async function B(q,F){let P=U(F);if(!P){if(q){if(await $(q,F))return"[ENABLED]"}return"[DEFERRED]"}if(!P.deferred)return"[AVAILABLE]";if(q){if(await $(q,F))return"[ENABLED]"}return"[DEFERRED]"}rY.getToolStatus=B;async function O(q,F){let P=U(F);if(!P){if(q)return await $(q,F);return!1}if(!P.deferred)return!0;if(q)return await $(q,F);return!1}rY.canExecuteTool=O,rY.getCurrentSession=LX0,rY.setCurrentSession=NX0})(i0||={});var qX0={name:"tool_search",description:`Search for available ServiceNow tools when you need specialized functionality.

This tool searches through ALL 235+ available tools including:
- Core operations (queries, CRUD, bulk operations)
- Deployment (widgets, UI pages, script includes)
- CMDB and asset management
- Change/incident/problem management
- Knowledge base and service catalog
- Automation (scripts, scheduled jobs, events)
- Security (ACLs, policies, compliance)
- Reporting (dashboards, KPIs, reports)
- And many more specialized tools

IMPORTANT: After this tool returns, the found tools become IMMEDIATELY AVAILABLE.
You can call them directly via tool_execute by their exact tool name.

Example workflow:
1. tool_search({query: "incident query"})
    Returns: snow_query_incidents, snow_query_table, ... [ENABLED]
2. tool_execute({tool: "snow_query_incidents", args: {query: "priority=1"}})
    Executes the tool and returns results`,inputSchema:{type:"object",properties:{query:{type:"string",description:'Search query to find relevant tools. Examples: "incident", "widget deploy", "cmdb", "update set", "knowledge article", "change request"'},limit:{type:"number",description:"Maximum number of results to return (default: 10)",default:10},enable:{type:"boolean",description:"Enable found tools for this session (default: true). When enabled, tools are marked [ENABLED] and can be called directly.",default:!0}},required:["query"]}};async function k$(Y,X){let J=Y.limit||10,z=Y.enable!==!1,Q=X.sessionId,G=i0.search(Y.query,J);if(G.length===0){let H=Y.query.toLowerCase(),W=H.split(/\s+/).filter((L)=>L.length>2),B=U1.getToolDefinitions().map((L)=>{let q=0,F=L.name.toLowerCase(),P=L.description.toLowerCase();if(F===H)q+=100;if(F.includes(H))q+=50;let A=H.replace(/^snow_?/,"");if(F.includes(A))q+=40;if(P.includes(H))q+=20;for(let v of W){if(F.includes(v))q+=15;if(P.includes(v))q+=5}let w=U1.getTool(L.name);if(w&&w.domain.toLowerCase().includes(H))q+=30;return{tool:L,score:q,domain:w?.domain||"unknown"}}).filter((L)=>L.score>0).sort((L,q)=>q.score-L.score).slice(0,J);if(B.length===0){let L=U1.getAvailableDomains().slice(0,15);return{success:!1,message:`No tools found matching "${Y.query}"`,suggestion:`Try different keywords. Available domains: ${L.join(", ")}`,available_domains:L}}if(z&&Q){let L=B.map((q)=>q.tool.name);await i0.enableTools(Q,L),console.error(`[tool_search] Enabled ${L.length} tools for session ${Q}`)}let O=B.map((L,q)=>{let F=L.tool.inputSchema?.properties||{},P=L.tool.inputSchema?.required||[],A=Object.entries(F).map(([v,T])=>{let D=P.includes(v),j=T.type||"any";return`    ${D?"*":""}${v}: ${j}${T.description?` - ${T.description.substring(0,80)}`:""}`}),w=z&&Q?"[ENABLED]":"[AVAILABLE]";return{rank:q+1,name:L.tool.name,status:w,domain:L.domain,description:L.tool.description.substring(0,200)+(L.tool.description.length>200?"...":""),parameters:A.length>0?A.slice(0,5):["(no parameters)"],has_more_params:A.length>5}}),V=z&&Q?`

 ${B.length} tool(s) are now ENABLED for this session.
Call them via tool_execute. Example:
tool_execute({tool: "${B[0]?.tool.name}", args: {...}})`:"";return{success:!0,query:Y.query,count:B.length,enabled:z&&!!Q,sessionId:Q||null,tools:O,usage_hint:`To use a tool, call: tool_execute({tool: "${B[0]?.tool.name}", args: {...}})${V}`}}if(z&&Q){let H=G.map((W)=>W.id);await i0.enableTools(Q,H),console.error(`[tool_search] Enabled ${H.length} tools for session ${Q}`)}let Z=G.map((H,W)=>{let U=U1.getTool(H.id)?.definition,B=U?.inputSchema?.properties||{},O=U?.inputSchema?.required||[],V=Object.entries(B).map(([q,F])=>{let P=O.includes(q),A=F.type||"any";return`    ${P?"*":""}${q}: ${A}${F.description?` - ${F.description.substring(0,80)}`:""}`}),L=H.deferred?z&&Q?"[ENABLED]":"[DEFERRED]":"[AVAILABLE]";return{rank:W+1,name:H.id,status:L,domain:H.category,description:H.description+(H.description.length>=200?"...":""),parameters:V.length>0?V.slice(0,5):["(no parameters)"],has_more_params:V.length>5}}),$=z&&Q?`

 ${G.length} tool(s) are now ENABLED for this session.
Call them via tool_execute. Example:
tool_execute({tool: "${G[0]?.id}", args: {...}})`:"";return{success:!0,query:Y.query,count:G.length,enabled:z&&!!Q,sessionId:Q||null,tools:Z,usage_hint:`To use a tool, call: tool_execute({tool: "${G[0]?.id}", args: {...}})${$}`}}var xX0={name:"tool_execute",description:`Execute any ServiceNow tool by name. Use this after tool_search to call the tools you found.

This is the gateway to ALL 235+ ServiceNow tools. After searching with tool_search,
use this tool to execute the found tools.

Example:
1. tool_search({query: "query incidents"})
    Found: snow_query_incidents
2. tool_execute({
     tool: "snow_query_incidents",
     args: { query: "priority=1^state!=7", limit: 10 }
   })
    Returns the query results

The 'args' parameter should match the tool's input schema from tool_search results.`,inputSchema:{type:"object",properties:{tool:{type:"string",description:"The exact tool name to execute (from tool_search results)"},args:{type:"object",description:"Arguments to pass to the tool (must match tool's input schema)",additionalProperties:!0}},required:["tool","args"]}};async function _$(Y,X){let J=Y.tool,z=Y.args||{},Q=X.sessionId,G=U1.getTool(J);if(!G){let H=U1.getToolDefinitions().filter((W)=>W.name.includes(J)||J.includes(W.name.replace("snow_",""))).slice(0,5).map((W)=>W.name);return{success:!1,error:`Tool not found: ${J}`,suggestion:H.length>0?`Did you mean one of these? ${H.join(", ")}`:"Use tool_search to find available tools",hint:'Use tool_search({query: "your task"}) to find the right tool'}}if(!await i0.canExecuteTool(Q,J)){let $=await i0.getToolStatus(Q,J),H=J.replace("snow_","").replace(/_/g," ");return{success:!1,error:`Tool "${J}" is ${$} and must be enabled first`,hint:`Use tool_search({query: "${H}"}) to enable this tool`,status:$}}try{console.error(`[MetaTool] Executing via tool_execute: ${J}`);let $=await G.executor(z,X);return{success:!0,tool:J,result:$}}catch($){return{success:!1,tool:J,error:$.message,hint:"Check tool_search results for correct parameter format"}}}var tY=[{definition:qX0,executor:k$},{definition:xX0,executor:_$}];class b${server;context;promptManager;constructor(){this.server=new Vz({name:"servicenow-unified",version:"1.0.0"},{capabilities:{tools:{},prompts:{}}}),this.promptManager=new E$("servicenow-unified"),this.context=this.loadContext(),this.setupHandlers()}loadFromAuthJson(){let Y=[...process.platform==="darwin"?[k8.join(U6.homedir(),"Library","Application Support","snow-code","auth.json")]:[],...process.platform==="win32"&&process.env.APPDATA?[k8.join(process.env.APPDATA,"snow-code","auth.json")]:[],k8.join(U6.homedir(),".local","share","snow-code","auth.json"),k8.join(U6.homedir(),".snow-flow","auth.json"),k8.join(U6.homedir(),".local","share","opencode","auth.json")];for(let X of Y)try{if(!U5.existsSync(X))continue;let J=JSON.parse(U5.readFileSync(X,"utf-8")),z=J.servicenow;if(!z&&J.instance&&(J.clientId||J.username))z=J;if(!z)continue;let Q=(L)=>!L||L.includes("your-")||L.includes("placeholder"),G=z.instance,Z=z.type,$=z.clientId,H=z.clientSecret,W=z.username,K=z.password;if(Q(G))continue;let U=$&&H&&!Q($)&&!Q(H),B=W&&K&&!Q(W)&&!Q(K);if(!U&&!B)continue;let O=U?"OAuth":"Basic",V;if(z.expiresAt)V=typeof z.expiresAt==="number"?z.expiresAt:parseInt(z.expiresAt,10);if(S("[Auth]  Loaded credentials from:",X),S("[Auth]    Instance:",G),S("[Auth]    Auth Type:",O),U){if(S("[Auth]    Client ID:",$?"***"+$.slice(-4):"MISSING"),S("[Auth]    Has Refresh Token:",!!z.refreshToken),S("[Auth]    Has Access Token:",!!z.accessToken),V){let L=Math.round((V-Date.now())/1000/60);S("[Auth]    Token Expires In:",L>0?`${L} minutes`:"EXPIRED")}}else S("[Auth]    Username:",W);return{instanceUrl:G.startsWith("http")?G:`https://${G}`,clientId:U?$:"",clientSecret:U?H:"",accessToken:z.accessToken,refreshToken:z.refreshToken||z.refresh_token,tokenExpiry:V,username:B?W:void 0,password:B?K:void 0}}catch(J){S("[Auth] Failed to load from",X,":",J.message);continue}S("[Auth] No valid auth.json found in any location"),S("[Auth] Checked paths:"),Y.forEach((X)=>S("[Auth]   -",X));return}loadEnterpriseAuth(){let Y=[k8.join(U6.homedir(),".snow-code","enterprise.json"),k8.join(U6.homedir(),".snow-flow","auth.json")];for(let X of Y)try{if(!U5.existsSync(X))continue;let J=JSON.parse(U5.readFileSync(X,"utf-8")),z,Q;if(J.token)z=J.token,Q=J.subdomain;else if(J.jwt)z=J.jwt;if(!z)continue;try{let Z=JSON.parse(Buffer.from(z.split(".")[1],"base64").toString());if(Z.exp&&Z.exp*1000<Date.now()){S("[Auth] Enterprise JWT expired, skipping enterprise portal fetch");continue}}catch{continue}let G="https://portal.snow-flow.dev";if(Q&&Q!=="portal")G=`https://${Q}.snow-flow.dev`;return S("[Auth] Found enterprise auth from:",X),S("[Auth]   Portal URL:",G),{jwt:z,portalUrl:G,subdomain:Q}}catch(J){S("[Auth] Failed to load enterprise auth from",X,":",J.message);continue}return}async loadFromEnterprisePortal(){let Y=this.loadEnterpriseAuth();if(!Y)return;S("[Auth] \uD83D\uDD10 Fetching ServiceNow credentials from enterprise portal (secure mode)...");try{let X=await this.fetchFromPortal(`${Y.portalUrl}/api/user-credentials/servicenow/default`,Y.jwt);if(!X.success||!X.instance){S("[Auth] Enterprise portal returned no ServiceNow instance"),S("[Auth] Response:",JSON.stringify(X));return}let J=X.instance;if(!J.instanceUrl||!J.clientId||!J.clientSecret){S("[Auth] Enterprise portal returned incomplete credentials");return}return S("[Auth]  Fetched ServiceNow credentials from enterprise portal"),S("[Auth]    Instance:",J.instanceUrl),S("[Auth]    Client ID:",J.clientId?"***"+J.clientId.slice(-4):"MISSING"),S("[Auth]    Environment:",J.environmentType||"unknown"),{instanceUrl:J.instanceUrl,clientId:J.clientId,clientSecret:J.clientSecret,refreshToken:void 0,username:void 0,password:void 0,enterprise:{tier:"enterprise",company:Y.subdomain,features:["secure-credentials","runtime-fetch"]}}}catch(X){S("[Auth] Failed to fetch credentials from enterprise portal:",X.message);return}}fetchFromPortal(Y,X){return new Promise((J,z)=>{let Q=new URL(Y),G=Q.protocol==="https:",Z=G?FX0:PX0,$={hostname:Q.hostname,port:Q.port||(G?443:80),path:Q.pathname+Q.search,method:"GET",headers:{Authorization:`Bearer ${X}`,Accept:"application/json","User-Agent":"Snow-Flow-MCP/1.0"}},H=Z.request($,(W)=>{let K="";W.on("data",(U)=>{K+=U}),W.on("end",()=>{try{if(W.statusCode===401||W.statusCode===403){z(Error("Unauthorized - enterprise JWT may be expired"));return}if(W.statusCode!==200){z(Error(`Portal returned status ${W.statusCode}: ${K}`));return}let U=JSON.parse(K);J(U)}catch(U){z(Error(`Failed to parse portal response: ${U.message}`))}})});H.on("error",(W)=>{z(Error(`Portal request failed: ${W.message}`))}),H.setTimeout(1e4,()=>{H.destroy(),z(Error("Portal request timed out"))}),H.end()})}loadContext(){let Y=process.env.SNOW_INSTANCE,X=Y?Y.startsWith("http://")||Y.startsWith("https://")?Y:`https://${Y}`:void 0,J=process.env.SERVICENOW_INSTANCE_URL||X,z=process.env.SERVICENOW_CLIENT_ID||process.env.SNOW_CLIENT_ID,Q=process.env.SERVICENOW_CLIENT_SECRET||process.env.SNOW_CLIENT_SECRET,G=process.env.SERVICENOW_REFRESH_TOKEN||process.env.SNOW_REFRESH_TOKEN,Z=process.env.SERVICENOW_USERNAME||process.env.SNOW_USERNAME,$=process.env.SERVICENOW_PASSWORD||process.env.SNOW_PASSWORD,H=(B)=>B&&B.trim()!==""?B:void 0,W=(B)=>!B||B.includes("your-")||B.includes("placeholder");if(J&&z&&Q&&!W(J)&&!W(z)&&!W(Q))return S("[Auth] Using credentials from environment variables"),{instanceUrl:J,clientId:z,clientSecret:Q,refreshToken:H(G),username:H(Z),password:H($)};let U=this.loadFromAuthJson();if(U)return U;return S("[Auth] No local ServiceNow credentials found"),S("[Auth] Checked:"),S("[Auth]   1. Environment variables (SERVICENOW_* or SNOW_*)"),S("[Auth]   2. snow-code auth.json (see logged paths above)"),S("[Auth] Will attempt enterprise portal fetch in initialize()..."),{instanceUrl:"",clientId:"",clientSecret:"",refreshToken:void 0,username:void 0,password:void 0}}hasValidCredentials(){if(!this.context.instanceUrl)return!1;let Y=!!(this.context.clientId&&this.context.clientSecret),X=!!(this.context.username&&this.context.password);return Y||X}setupHandlers(){this.server.setRequestHandler(YJ,async(Y)=>{let X=y7(Y.headers),J=X?.sessionId||Y.headers?.["x-session-id"]||process.env.SNOW_SESSION_ID||i0.getCurrentSession(),z=J?await i0.getEnabledTools(J):new Set;if(S(`[Server] ListTools request - sessionId: ${J||"none"}`),!J)S("[Server]  No session ID found - all deferred tools will be hidden"),S("[Server]   Checked sources:"),S(`[Server]     - JWT payload: ${X?.sessionId||"none"}`),S(`[Server]     - x-session-id header: ${Y.headers?.["x-session-id"]||"none"}`),S(`[Server]     - SNOW_SESSION_ID env: ${process.env.SNOW_SESSION_ID||"none"}`),S(`[Server]     - current-session.json: ${i0.getCurrentSession()||"none"}`);let Q=process.env.SNOW_TOOL_DOMAINS,G;if(Q){let q=Q.split(",").map((A)=>A.trim()).filter(Boolean),F=U1.getAvailableDomains(),P=q.filter((A)=>!F.includes(A.toLowerCase()));if(P.length>0)S(`[Server]   Unknown domains in SNOW_TOOL_DOMAINS: ${P.join(", ")}`),S(`[Server]    Available domains: ${F.join(", ")}`);G=U1.getToolDefinitionsByDomains(q),S(`[Server] Domain filtering enabled: ${q.join(", ")}`),S(`[Server]   Tools loaded: ${G.length} (from ${q.length} domains)`)}else G=U1.getToolDefinitions();let Z=y7(Y.headers),$=Z?.role||"developer",H=fS(G,Z),W=i0.getStats(),K=U1.getToolDefinitions().length,U=tY&&tY.length>0?tY.map((q)=>q.definition):[];if(U.length===0)S("[Server]   WARNING: META_TOOLS is empty! tool_search/tool_execute not available");let B=i0.getStats();S(`[Server] Tool index: ${B.total} tools, ${B.deferred} deferred, ${B.immediate} immediate`);let O=process.env.SNOW_LAZY_TOOLS!=="false";if(S(`[Server] SNOW_LAZY_TOOLS: ${O?"ENABLED (default)":"DISABLED"}`),B.total===0)S("[Server]  Tool index is EMPTY - deferred filtering may not work correctly"),S("[Server]   All tools will be returned (not deferred)");let V=H.filter((q)=>{if(O&&B.total>0){if(!(i0.getToolFromIndex(q.name)?.deferred??!0))return!0;if(z.has(q.name))return!0;return!1}let F=i0.getToolFromIndex(q.name);if(!F){if(O)return!1;return!0}if(!F.deferred)return!0;if(z.has(q.name))return!0;return!1});if(z.size>10){S(`[Server]   Many tools enabled (${z.size}) - session may have stale data`);let q=Array.from(z).slice(0,5);S(`[Server]    First 5: ${q.join(", ")}`)}S(`[Server] Listing tools for role: ${$}`+(Q?` (domains: ${Q})`:"")),S(`[Server]   Meta-tools: ${U.length}`),S(`[Server]   Enabled this session: ${z.size}`),S(`[Server]   Filtered to return: ${V.length}`),S(`[Server]   Total available: ${K} (use tool_search to enable)`);let L=[...U.map((q)=>({name:q.name,description:q.description,inputSchema:q.inputSchema})),...V.map((q)=>({name:q.name,description:q.description,inputSchema:q.inputSchema}))];return S(`[Server] Returning ${L.length} tools total`),{tools:L}}),this.server.setRequestHandler(f5,async(Y)=>{let{name:X,arguments:J}=Y.params,z=this.formatArgsForLogging(J);if(S(`[Server] Executing tool: ${X}`),z)S(`[Server]   Parameters: ${z}`);let G=y7(Y.headers)?.sessionId||Y.headers?.["x-session-id"]||process.env.SNOW_SESSION_ID||i0.getCurrentSession();try{if(X==="tool_search"){S("[Server] Executing meta-tool: tool_search");let K={...this.context,sessionId:G},U=await k$(J,K);return{content:[{type:"text",text:JSON.stringify(U,null,2)}]}}if(X==="tool_execute"){S("[Server] Executing meta-tool: tool_execute");let K={...this.context,sessionId:G},U=await _$(J,K);return{content:[{type:"text",text:JSON.stringify(U,null,2)}]}}let Z=U1.getTool(X);if(!Z)throw new K0(B0.MethodNotFound,`Tool not found: ${X}`);if(!await i0.canExecuteTool(G,X)){let K=await i0.getToolStatus(G,X);throw new K0(B0.InvalidRequest,`Tool "${X}" is ${K} and must be enabled first. Use tool_search({query: "${X.replace("snow_","")}"}) to enable it.`)}let H=y7(Y.headers);yS(H),RS(Z.definition,H);let W=await mq(X,async()=>{return await Z.executor(J,this.context)},{retry:this.isRetryableOperation(X),context:{args:J,instanceUrl:this.context.instanceUrl}});return{content:[{type:"text",text:JSON.stringify(W,null,2)}]}}catch(Z){S(`[Server] Tool execution failed: ${X}`,Z.message);let $=Z instanceof I?Z:HY(Z);throw new K0(B0.InternalError,$.message,$.toToolResult())}}),this.server.setRequestHandler(oX,async()=>{let Y=this.promptManager.listPrompts();return S(`[Server] Listing ${Y.length} prompts`),{prompts:Y.map((X)=>({name:X.name,description:X.description,arguments:X.arguments?.map((J)=>({name:J.name,description:J.description,required:J.required}))}))}}),this.server.setRequestHandler(aX,async(Y)=>{let{name:X,arguments:J}=Y.params;S(`[Server] Getting prompt: ${X}`);try{let z=this.promptManager.getPrompt(X);if(!z)throw new K0(B0.InvalidRequest,`Prompt not found: ${X}`);let Q=await this.promptManager.executePrompt(X,J||{});return{description:Q.description||z.description,messages:Q.messages.map((G)=>({role:G.role,content:G.content}))}}catch(z){throw S(`[Server] Prompt execution failed: ${X}`,z.message),new K0(B0.InternalError,z.message)}}),this.server.onerror=(Y)=>{S("[Server] MCP Error:",Y)}}formatArgsForLogging(Y){if(!Y||typeof Y!=="object")return"";let X=[],J=100,z=(H)=>{let W=String(H);if(W.length>J)return W.substring(0,J)+"...";return W},Q=(H)=>{if(H===null||H===void 0)return"null";if(typeof H==="object"){if(Array.isArray(H))return`Array(${H.length})`;return`{${Object.keys(H).length} keys}`}return z(H)},G=["table","query","action","sys_id","name","type","identifier"],Z=new Set;for(let H of G)if(H in Y&&Z.size<5)X.push(`${H}=${Q(Y[H])}`),Z.add(H);for(let[H,W]of Object.entries(Y)){if(Z.size>=5)break;if(!Z.has(H)&&!["script","template","client_script","server_script","css"].includes(H))X.push(`${H}=${Q(W)}`),Z.add(H)}let $=Object.keys(Y).length;if($>Z.size)X.push(`...+${$-Z.size} more`);return X.join(", ")}isRetryableOperation(Y){return["snow_query_table","snow_discover_table_fields","snow_get_by_sysid","snow_comprehensive_search","snow_analyze_query"].includes(Y)}extractKeywords(Y,X){let J=new Set;return Y.replace(/^snow_/,"").split("_").forEach((G)=>{if(G.length>2)J.add(G.toLowerCase())}),X.toLowerCase().replace(/[^a-z0-9\s]/g," ").split(/\s+/).filter((G)=>G.length>3&&!["this","that","with","from","will","have","been","tool"].includes(G)).slice(0,10).forEach((G)=>J.add(G)),Array.from(J)}async initialize(){S("[Server] ServiceNow Unified MCP Server starting..."),S("[Server] ========== ENVIRONMENT CHECK =========="),S(`[Server] SNOW_LAZY_TOOLS = "${process.env.SNOW_LAZY_TOOLS||"NOT SET"}"`),S(`[Server] SNOW_SESSION_ID = "${process.env.SNOW_SESSION_ID||"NOT SET"}"`),S("[Server] ========================================");try{if(!this.hasValidCredentials()||this.loadEnterpriseAuth()){S("[Server] Checking enterprise portal for credentials...");let Z=await this.loadFromEnterprisePortal();if(Z)this.context=Z,S("[Server]  Using SECURE enterprise credentials (fetched at runtime)"),S("[Server]    No ServiceNow secrets stored locally!");else if(!this.hasValidCredentials())S("[Server] No credentials available from enterprise portal"),S("[Server] Falling back to local credentials (if any)...")}S("[Server] Instance:",this.context.instanceUrl||"NOT CONFIGURED"),S("[Server] Auth Mode:",this.context.enterprise?"ENTERPRISE (secure)":"LOCAL"),S("[Server] Discovering tools...");let Y=await U1.initialize();if(S("[Server] Tool discovery complete:"),S(`  - Domains: ${Y.domains.length}`),S(`  - Tools found: ${Y.toolsFound}`),S(`  - Tools registered: ${Y.toolsRegistered}`),S(`  - Tools failed: ${Y.toolsFailed}`),S(`  - Duration: ${Y.duration}ms`),Y.toolsFailed>0)S("[Server] Some tools failed to load:"),Y.errors.forEach((Z)=>{KM(`  - ${Z.filePath}: ${Z.error}`)});S("[Server] Building tool search index...");let J=U1.getToolDefinitions().map((Z)=>{let $=U1.getTool(Z.name);return{id:Z.name,description:Z.description.substring(0,200),category:$?.domain||"unknown",keywords:this.extractKeywords(Z.name,Z.description),deferred:!0}});if(i0.registerTools(J),S(`[Server] Tool search index populated with ${J.length} tools`),this.hasValidCredentials()){S("[Server] Testing authentication...");try{await E7.getAuthenticatedClient(this.context),S("[Server] Authentication successful")}catch(Z){S("[Server] Authentication test failed:",Z.message),S("[Server] Server will start, but tool calls may fail until credentials are valid")}}else S("[Server]   No ServiceNow credentials configured!"),S("[Server] Tools will return authentication errors."),S("[Server] To configure:"),S("[Server]   Enterprise users: snow-code auth login"),S("[Server]   Free users: Configure environment variables or auth.json");let z=U1.getStatistics();S("[Server] Server statistics:"),S(`  - Total tools: ${z.totalTools}`),S(`  - Total domains: ${z.totalDomains}`),S("  - Tools by domain:"),Object.entries(z.toolsByDomain).forEach(([Z,$])=>{S(`    - ${Z}: ${$} tools`)});let Q=process.env.SNOW_LAZY_TOOLS!=="false",G=!!process.env.SNOW_TOOL_DOMAINS;if(Q)S("[Server] \uD83D\uDE80 LAZY TOOLS MODE ACTIVE (default)"),S("[Server]    Token usage: ~2k (down from ~71k)"),S("[Server]    AI uses tool_search + tool_execute to access all tools"),S("[Server]    Set SNOW_LAZY_TOOLS=false to disable");else if(G)S("[Server] \uD83D\uDD27 Domain filtering ACTIVE via SNOW_TOOL_DOMAINS");else S("[Server]   LAZY TOOLS DISABLED - all tools loaded (~71k tokens)"),S("[Server]    Remove SNOW_LAZY_TOOLS=false to enable lazy loading");S("[Server] Initialization complete ")}catch(Y){throw S("[Server] Initialization failed:",Y.message),Y}}async start(){let Y=new Mz;await this.server.connect(Y),S("[Server] Connected via stdio transport")}async stop(){S("[Server] Stopping server..."),await this.server.close(),E7.clearCache(),S("[Server] Server stopped")}getServer(){return this.server}getAuthManager(){return E7}getToolRegistry(){return U1}}var y$=u4(Af(),1);import*as wf from"path";async function iX0(){try{let Y={SNOW_LAZY_TOOLS:process.env.SNOW_LAZY_TOOLS,SNOW_TOOL_DOMAINS:process.env.SNOW_TOOL_DOMAINS,SNOW_INSTANCE:process.env.SNOW_INSTANCE,SERVICENOW_INSTANCE_URL:process.env.SERVICENOW_INSTANCE_URL,SNOW_CLIENT_ID:process.env.SNOW_CLIENT_ID,SERVICENOW_CLIENT_ID:process.env.SERVICENOW_CLIENT_ID,SNOW_CLIENT_SECRET:process.env.SNOW_CLIENT_SECRET,SERVICENOW_CLIENT_SECRET:process.env.SERVICENOW_CLIENT_SECRET};if(y$.config().error){let z=wf.resolve(process.cwd(),"..",".env");if(y$.config({path:z}).error)S("[Main] No .env file found - using environment variables from MCP configuration");else S("[Main] Loaded environment from parent directory:",z)}else S("[Main] Loaded environment from .env file");for(let[z,Q]of Object.entries(Y))if(Q!==void 0){if(process.env[z]!==Q)S(`[Main] Restoring MCP config override: ${z}`);process.env[z]=Q}if(process.env.SNOW_LAZY_TOOLS==="true")S("[Main] SNOW_LAZY_TOOLS=true (lazy loading mode enabled)");if(process.env.SNOW_TOOL_DOMAINS)S(`[Main] SNOW_TOOL_DOMAINS=${process.env.SNOW_TOOL_DOMAINS}`);let J=new b$;await J.initialize(),await J.start(),process.on("SIGINT",async()=>{S(`
[Main] Received SIGINT, shutting down gracefully...`),await J.stop(),process.exit(0)}),process.on("SIGTERM",async()=>{S(`
[Main] Received SIGTERM, shutting down gracefully...`),await J.stop(),process.exit(0)})}catch(Y){S("[Main] Fatal error:",Y.message),S(Y.stack),process.exit(1)}}iX0();
